define(["./arrayRemoveDuplicates-198208a4","./BoundingRectangle-ab1365ab","./Transforms-62a339c3","./Matrix2-92b7fb9d","./RuntimeError-4fdc4459","./ComponentDatatype-9ed50558","./CoplanarPolygonGeometryLibrary-ce606f0c","./when-8166c7dd","./GeometryAttribute-6f4c3b93","./GeometryAttributes-50becc99","./GeometryInstance-c790ce17","./GeometryPipeline-54fb0bb4","./IndexDatatype-797210ca","./PolygonGeometryLibrary-e5495823","./PolygonPipeline-7fb6627c","./VertexFormat-c0801687","./combine-a5c4cc47","./WebGLConstants-0664004c","./OrientedBoundingBox-ed23852c","./EllipsoidTangentPlane-5d8b4bd3","./AxisAlignedBoundingBox-b0cd1e39","./IntersectionTests-4f28a69c","./Plane-049255eb","./AttributeCompression-212262a3","./EncodedCartesian3-4a314cb8","./ArcType-13a53523","./EllipsoidRhumbLine-51654311"],(function(e,t,a,n,r,o,i,s,l,p,c,y,u,m,d,g,b,v,h,f,C,x,P,A,w,F,G){"use strict";var L=new n.Cartesian3,E=new t.BoundingRectangle,T=new n.Cartesian2,k=new n.Cartesian2,D=new n.Cartesian3,_=new n.Cartesian3,V=new n.Cartesian3,R=new n.Cartesian3,I=new n.Cartesian3,M=new n.Cartesian3,B=new a.Quaternion,H=new n.Matrix3,O=new n.Matrix3,z=new n.Cartesian3;function S(e,t,r,i,s,c,y,m){var g=e.positions,b=d.PolygonPipeline.triangulate(e.positions2D,e.holes);b.length<3&&(b=[0,1,2]);var v=u.IndexDatatype.createTypedArray(g.length,b.length);v.set(b);var h=H;if(0!==i){var f=a.Quaternion.fromAxisAngle(c,i,B);if(h=n.Matrix3.fromQuaternion(f,h),t.tangent||t.bitangent){f=a.Quaternion.fromAxisAngle(c,-i,B);var C=n.Matrix3.fromQuaternion(f,O);y=n.Cartesian3.normalize(n.Matrix3.multiplyByVector(C,y,y),y),t.bitangent&&(m=n.Cartesian3.normalize(n.Cartesian3.cross(c,y,m),m))}}else h=n.Matrix3.clone(n.Matrix3.IDENTITY,h);var x=k;t.st&&(x.x=r.x,x.y=r.y);for(var P=g.length,A=3*P,w=new Float64Array(A),F=t.normal?new Float32Array(A):void 0,G=t.tangent?new Float32Array(A):void 0,E=t.bitangent?new Float32Array(A):void 0,D=t.st?new Float32Array(2*P):void 0,_=0,V=0,R=0,I=0,M=0,z=0;z<P;z++){var S=g[z];if(w[_++]=S.x,w[_++]=S.y,w[_++]=S.z,t.st){var N=n.Matrix3.multiplyByVector(h,S,L),Q=s(N,T);n.Cartesian2.subtract(Q,x,Q);var j=o.CesiumMath.clamp(Q.x/r.width,0,1),U=o.CesiumMath.clamp(Q.y/r.height,0,1);D[M++]=j,D[M++]=U}t.normal&&(F[V++]=c.x,F[V++]=c.y,F[V++]=c.z),t.tangent&&(G[I++]=y.x,G[I++]=y.y,G[I++]=y.z),t.bitangent&&(E[R++]=m.x,E[R++]=m.y,E[R++]=m.z)}var Y=new p.GeometryAttributes;return t.position&&(Y.position=new l.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:w})),t.normal&&(Y.normal=new l.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:F})),t.tangent&&(Y.tangent=new l.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),t.bitangent&&(Y.bitangent=new l.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),t.st&&(Y.st=new l.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:D})),new l.Geometry({attributes:Y,indices:v,primitiveType:l.PrimitiveType.TRIANGLES})}function N(e){e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT);var t=e.polygonHierarchy;r.Check.defined("options.polygonHierarchy",t);var a=s.defaultValue(e.vertexFormat,g.VertexFormat.DEFAULT);this._vertexFormat=g.VertexFormat.clone(a),this._polygonHierarchy=t,this._stRotation=s.defaultValue(e.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(s.defaultValue(e.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=m.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+g.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}N.fromPositions=function(e){e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT),r.Check.defined("options.positions",e.positions);var t={polygonHierarchy:{positions:e.positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid};return new N(t)},N.pack=function(e,t,a){return r.Check.typeOf.object("value",e),r.Check.defined("array",t),a=s.defaultValue(a,0),a=m.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,a),n.Ellipsoid.pack(e._ellipsoid,t,a),a+=n.Ellipsoid.packedLength,g.VertexFormat.pack(e._vertexFormat,t,a),a+=g.VertexFormat.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var Q=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),j=new g.VertexFormat,U={polygonHierarchy:{}};function Y(e,t){return s.defined(t)&&(e=N.unpack(e,t)),N.createGeometry(e)}return N.unpack=function(e,t,a){r.Check.defined("array",e),t=s.defaultValue(t,0);var o=m.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=o.startingIndex,delete o.startingIndex;var i=n.Ellipsoid.unpack(e,t,Q);t+=n.Ellipsoid.packedLength;var l=g.VertexFormat.unpack(e,t,j);t+=g.VertexFormat.packedLength;var p=e[t++],c=e[t];return s.defined(a)||(a=new N(U)),a._polygonHierarchy=o,a._ellipsoid=n.Ellipsoid.clone(i,a._ellipsoid),a._vertexFormat=g.VertexFormat.clone(l,a._vertexFormat),a._stRotation=p,a.packedLength=c,a},N.createGeometry=function(t){var r=t._vertexFormat,s=t._polygonHierarchy,p=t._stRotation,d=s.positions;if(d=e.arrayRemoveDuplicates(d,n.Cartesian3.equalsEpsilon,!0),!(d.length<3)){var g=D,b=_,v=V,h=I,f=M,C=i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(d,R,h,f);if(C){if(g=n.Cartesian3.cross(h,f,g),g=n.Cartesian3.normalize(g,g),!n.Cartesian3.equalsEpsilon(R,n.Cartesian3.ZERO,o.CesiumMath.EPSILON6)){var x=t._ellipsoid.geodeticSurfaceNormal(R,z);n.Cartesian3.dot(g,x)<0&&(g=n.Cartesian3.negate(g,g),h=n.Cartesian3.negate(h,h))}var P=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(R,h,f),A=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(R,h,f);r.tangent&&(b=n.Cartesian3.clone(h,b)),r.bitangent&&(v=n.Cartesian3.clone(f,v));var w=m.PolygonGeometryLibrary.polygonsFromHierarchy(s,P,!1),F=w.hierarchy,G=w.polygons;if(0!==F.length){d=F[0].outerRing;for(var L=a.BoundingSphere.fromPoints(d),T=m.PolygonGeometryLibrary.computeBoundingRectangle(g,A,d,p,E),k=[],B=0;B<G.length;B++){var H=new c.GeometryInstance({geometry:S(G[B],r,T,p,A,g,b,v)});k.push(H)}var O=y.GeometryPipeline.combineInstances(k)[0];O.attributes.position.values=new Float64Array(O.attributes.position.values),O.indices=u.IndexDatatype.createTypedArray(O.attributes.position.values.length/3,O.indices);var N=O.attributes;return r.position||delete N.position,new l.Geometry({attributes:N,indices:O.indices,primitiveType:O.primitiveType,boundingSphere:L})}}}},Y}));