define(["./AxisAlignedBoundingBox-b0cd1e39","./Transforms-62a339c3","./Matrix2-92b7fb9d","./when-8166c7dd","./TerrainEncoding-315b224c","./ComponentDatatype-9ed50558","./OrientedBoundingBox-ed23852c","./RuntimeError-4fdc4459","./WebMercatorProjection-6ac42c0a","./createTaskProcessorWorker","./combine-a5c4cc47","./AttributeCompression-212262a3","./WebGLConstants-0664004c","./EllipsoidTangentPlane-5d8b4bd3","./IntersectionTests-4f28a69c","./Plane-049255eb"],(function(e,t,i,n,r,a,o,s,u,h,c,d,g,l,m,p){"use strict";var v=Uint16Array.BYTES_PER_ELEMENT,I=Int32Array.BYTES_PER_ELEMENT,E=Uint32Array.BYTES_PER_ELEMENT,T=Float32Array.BYTES_PER_ELEMENT,f=Float64Array.BYTES_PER_ELEMENT;function C(e,t,i){i=n.defaultValue(i,a.CesiumMath);for(var r=e.length,o=0;o<r;++o)if(i.equalsEpsilon(e[o],t,a.CesiumMath.EPSILON12))return o;return-1}function M(e,t){e.ellipsoid=i.Ellipsoid.clone(e.ellipsoid),e.rectangle=i.Rectangle.clone(e.rectangle);var n=B(e.buffer,e.relativeToCenter,e.ellipsoid,e.rectangle,e.nativeRectangle,e.exaggeration,e.exaggerationRelativeHeight,e.skirtHeight,e.includeWebMercatorT,e.negativeAltitudeExponentBias,e.negativeElevationThreshold),r=n.vertices;t.push(r.buffer);var a=n.indices;return t.push(a.buffer),{vertices:r.buffer,indices:a.buffer,numberOfAttributes:n.encoding.stride,minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight,boundingSphere3D:n.boundingSphere3D,orientedBoundingBox:n.orientedBoundingBox,occludeePointInScaledSpace:n.occludeePointInScaledSpace,encoding:n.encoding,vertexCountWithoutSkirts:n.vertexCountWithoutSkirts,indexCountWithoutSkirts:n.indexCountWithoutSkirts,westIndicesSouthToNorth:n.westIndicesSouthToNorth,southIndicesEastToWest:n.southIndicesEastToWest,eastIndicesNorthToSouth:n.eastIndicesNorthToSouth,northIndicesWestToEast:n.northIndicesWestToEast}}var x=new i.Cartographic,N=new i.Cartesian3,b=new i.Cartesian3,S=new i.Cartesian3,w=new i.Matrix4;function B(h,c,d,g,l,m,p,M,B,A,y){var R,_,W,F,O,Y;n.defined(g)?(R=g.west,_=g.south,W=g.east,F=g.north,O=g.width,Y=g.height):(R=a.CesiumMath.toRadians(l.west),_=a.CesiumMath.toRadians(l.south),W=a.CesiumMath.toRadians(l.east),F=a.CesiumMath.toRadians(l.north),O=a.CesiumMath.toRadians(g.width),Y=a.CesiumMath.toRadians(g.height));var U,V,k=[_,F],H=[R,W],L=t.Transforms.eastNorthUpToFixedFrame(c,d),D=i.Matrix4.inverseTransformation(L,w);B&&(U=u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(_),V=1/(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(F)-U));var G=1!==m,j=G,z=new DataView(h),q=Number.POSITIVE_INFINITY,J=Number.NEGATIVE_INFINITY,K=b;K.x=Number.POSITIVE_INFINITY,K.y=Number.POSITIVE_INFINITY,K.z=Number.POSITIVE_INFINITY;var Q=S;Q.x=Number.NEGATIVE_INFINITY,Q.y=Number.NEGATIVE_INFINITY,Q.z=Number.NEGATIVE_INFINITY;var X,Z,$=0,ee=0,te=0;for(Z=0;Z<4;++Z){var ie=$;X=z.getUint32(ie,!0),ie+=E;var ne=a.CesiumMath.toRadians(180*z.getFloat64(ie,!0));ie+=f,-1===C(H,ne)&&H.push(ne);var re=a.CesiumMath.toRadians(180*z.getFloat64(ie,!0));ie+=f,-1===C(k,re)&&k.push(re),ie+=2*f;var ae=z.getInt32(ie,!0);ie+=I,ee+=ae,ae=z.getInt32(ie,!0),te+=3*ae,$+=X+E}var oe=[],se=[],ue=new Array(ee),he=new Array(ee),ce=new Array(ee),de=B?new Array(ee):[],ge=j?new Array(ee):[],le=new Array(te),me=[],pe=[],ve=[],Ie=[],Ee=0,Te=0;for($=0,Z=0;Z<4;++Z){X=z.getUint32($,!0),$+=E;var fe=$,Ce=a.CesiumMath.toRadians(180*z.getFloat64($,!0));$+=f;var Me=a.CesiumMath.toRadians(180*z.getFloat64($,!0));$+=f;var xe=a.CesiumMath.toRadians(180*z.getFloat64($,!0)),Ne=.5*xe;$+=f;var be=a.CesiumMath.toRadians(180*z.getFloat64($,!0)),Se=.5*be;$+=f;var we=z.getInt32($,!0);$+=I;var Be=z.getInt32($,!0);$+=I,$+=I;for(var Pe=new Array(we),Ae=0;Ae<we;++Ae){var ye=Ce+z.getUint8($++)*xe;x.longitude=ye;var Re=Me+z.getUint8($++)*be;x.latitude=Re;var _e=z.getFloat32($,!0);if($+=T,0!==_e&&_e<y&&(_e*=-Math.pow(2,A)),_e*=6371010,x.height=_e,-1!==C(H,ye)||-1!==C(k,Re)){var We=C(oe,x,i.Cartographic);if(-1!==We){Pe[Ae]=se[We];continue}oe.push(i.Cartographic.clone(x)),se.push(Ee)}Pe[Ae]=Ee,Math.abs(ye-R)<Ne?me.push({index:Ee,cartographic:i.Cartographic.clone(x)}):Math.abs(ye-W)<Ne?ve.push({index:Ee,cartographic:i.Cartographic.clone(x)}):Math.abs(Re-_)<Se?pe.push({index:Ee,cartographic:i.Cartographic.clone(x)}):Math.abs(Re-F)<Se&&Ie.push({index:Ee,cartographic:i.Cartographic.clone(x)}),q=Math.min(_e,q),J=Math.max(_e,J),ce[Ee]=_e;var Fe=d.cartographicToCartesian(x);if(ue[Ee]=Fe,B&&(de[Ee]=(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(Re)-U)*V),j){var Oe=d.geodeticSurfaceNormal(Fe);ge[Ee]=Oe}i.Matrix4.multiplyByPoint(D,Fe,N),i.Cartesian3.minimumByComponent(N,K,K),i.Cartesian3.maximumByComponent(N,Q,Q);var Ye=(ye-R)/(W-R);Ye=a.CesiumMath.clamp(Ye,0,1);var Ue=(Re-_)/(F-_);Ue=a.CesiumMath.clamp(Ue,0,1),he[Ee]=new i.Cartesian2(Ye,Ue),++Ee}for(var Ve=3*Be,ke=0;ke<Ve;++ke,++Te)le[Te]=Pe[z.getUint16($,!0)],$+=v;if(X!==$-fe)throw new s.RuntimeError("Invalid terrain tile.")}ue.length=Ee,he.length=Ee,ce.length=Ee,B&&(de.length=Ee),j&&(ge.length=Ee);var He=Ee,Le=Te,De={hMin:q,lastBorderPoint:void 0,skirtHeight:M,toENU:D,ellipsoid:d,minimum:K,maximum:Q};me.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),pe.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),ve.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),Ie.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude}));var Ge=1e-5;if(P(ue,ce,he,de,ge,le,De,me,-Ge*O,!0,-Ge*Y),P(ue,ce,he,de,ge,le,De,pe,-Ge*Y,!1),P(ue,ce,he,de,ge,le,De,ve,Ge*O,!0,Ge*Y),P(ue,ce,he,de,ge,le,De,Ie,Ge*Y,!1),me.length>0&&Ie.length>0){var je=me[0].index,ze=He,qe=Ie[Ie.length-1].index,Je=ue.length-1;le.push(qe,Je,ze,ze,je,qe)}ee=ue.length;var Ke,Qe=t.BoundingSphere.fromPoints(ue);n.defined(g)&&(Ke=o.OrientedBoundingBox.fromRectangle(g,q,J,d));for(var Xe=new r.EllipsoidalOccluder(d),Ze=Xe.computeHorizonCullingPointPossiblyUnderEllipsoid(c,ue,q),$e=new e.AxisAlignedBoundingBox(K,Q,c),et=new r.TerrainEncoding(c,$e,De.hMin,J,L,!1,B,j,m,p),tt=new Float32Array(ee*et.stride),it=0,nt=0;nt<ee;++nt)it=et.encode(tt,it,ue[nt],he[nt],ce[nt],void 0,de[nt],ge[nt]);var rt=me.map((function(e){return e.index})).reverse(),at=pe.map((function(e){return e.index})).reverse(),ot=ve.map((function(e){return e.index})).reverse(),st=Ie.map((function(e){return e.index})).reverse();return at.unshift(ot[ot.length-1]),at.push(rt[0]),st.unshift(rt[rt.length-1]),st.push(ot[0]),{vertices:tt,indices:new Uint16Array(le),maximumHeight:J,minimumHeight:q,encoding:et,boundingSphere3D:Qe,orientedBoundingBox:Ke,occludeePointInScaledSpace:Ze,vertexCountWithoutSkirts:He,indexCountWithoutSkirts:Le,westIndicesSouthToNorth:rt,southIndicesEastToWest:at,eastIndicesNorthToSouth:ot,northIndicesWestToEast:st}}function P(e,t,r,o,s,u,h,c,d,g,l){for(var m=c.length,p=0;p<m;++p){var v=c[p],I=v.cartographic,E=v.index,T=e.length,f=I.longitude,C=I.latitude;C=a.CesiumMath.clamp(C,-a.CesiumMath.PI_OVER_TWO,a.CesiumMath.PI_OVER_TWO);var M=I.height-h.skirtHeight;h.hMin=Math.min(h.hMin,M),i.Cartographic.fromRadians(f,C,M,x),g&&(x.longitude+=d),g?p===m-1?x.latitude+=l:0===p&&(x.latitude-=l):x.latitude+=d;var b=h.ellipsoid.cartographicToCartesian(x);e.push(b),t.push(M),r.push(i.Cartesian2.clone(r[E])),o.length>0&&o.push(o[E]),s.length>0&&s.push(s[E]),i.Matrix4.multiplyByPoint(h.toENU,b,N);var S=h.minimum,w=h.maximum;i.Cartesian3.minimumByComponent(N,S,S),i.Cartesian3.maximumByComponent(N,w,w);var B=h.lastBorderPoint;if(n.defined(B)){var P=B.index;u.push(P,T-1,T,T,E,P)}h.lastBorderPoint=v}}var A=h(M);return A}));