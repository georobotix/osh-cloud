define(["./AttributeCompression-212262a3","./Transforms-62a339c3","./Matrix2-92b7fb9d","./when-8166c7dd","./TerrainEncoding-315b224c","./IndexDatatype-797210ca","./RuntimeError-4fdc4459","./ComponentDatatype-9ed50558","./OrientedBoundingBox-ed23852c","./createTaskProcessorWorker","./combine-a5c4cc47","./WebGLConstants-0664004c","./EllipsoidTangentPlane-5d8b4bd3","./AxisAlignedBoundingBox-b0cd1e39","./IntersectionTests-4f28a69c","./Plane-049255eb"],(function(e,i,r,t,n,s,h,u,o,d,p,a,f,l,c,g){"use strict";var m={clipTriangleAtAxisAlignedThreshold:function(e,i,r,n,s,u){if(!t.defined(e))throw new h.DeveloperError("threshold is required.");if(!t.defined(i))throw new h.DeveloperError("keepAbove is required.");if(!t.defined(r))throw new h.DeveloperError("u0 is required.");if(!t.defined(n))throw new h.DeveloperError("u1 is required.");if(!t.defined(s))throw new h.DeveloperError("u2 is required.");var o,d,p;t.defined(u)?u.length=0:u=[],i?(o=r<e,d=n<e,p=s<e):(o=r>e,d=n>e,p=s>e);var a,f,l,c,g,m,w=o+d+p;return 1===w?o?(a=(e-r)/(n-r),f=(e-r)/(s-r),u.push(1),u.push(2),1!==f&&(u.push(-1),u.push(0),u.push(2),u.push(f)),1!==a&&(u.push(-1),u.push(0),u.push(1),u.push(a))):d?(l=(e-n)/(s-n),c=(e-n)/(r-n),u.push(2),u.push(0),1!==c&&(u.push(-1),u.push(1),u.push(0),u.push(c)),1!==l&&(u.push(-1),u.push(1),u.push(2),u.push(l))):p&&(g=(e-s)/(r-s),m=(e-s)/(n-s),u.push(0),u.push(1),1!==m&&(u.push(-1),u.push(2),u.push(1),u.push(m)),1!==g&&(u.push(-1),u.push(2),u.push(0),u.push(g))):2===w?o||r===e?d||n===e?p||s===e||(f=(e-r)/(s-r),l=(e-n)/(s-n),u.push(2),u.push(-1),u.push(0),u.push(2),u.push(f),u.push(-1),u.push(1),u.push(2),u.push(l)):(m=(e-s)/(n-s),a=(e-r)/(n-r),u.push(1),u.push(-1),u.push(2),u.push(1),u.push(m),u.push(-1),u.push(0),u.push(1),u.push(a)):(c=(e-n)/(r-n),g=(e-s)/(r-s),u.push(0),u.push(-1),u.push(1),u.push(0),u.push(c),u.push(-1),u.push(2),u.push(0),u.push(g)):3!==w&&(u.push(0),u.push(1),u.push(2)),u},computeBarycentricCoordinates:function(e,i,n,s,u,o,d,p,a){if(!t.defined(e))throw new h.DeveloperError("x is required.");if(!t.defined(i))throw new h.DeveloperError("y is required.");if(!t.defined(n))throw new h.DeveloperError("x1 is required.");if(!t.defined(s))throw new h.DeveloperError("y1 is required.");if(!t.defined(u))throw new h.DeveloperError("x2 is required.");if(!t.defined(o))throw new h.DeveloperError("y2 is required.");if(!t.defined(d))throw new h.DeveloperError("x3 is required.");if(!t.defined(p))throw new h.DeveloperError("y3 is required.");var f=n-d,l=d-u,c=o-p,g=s-p,m=1/(c*f+l*g),w=i-p,x=e-d,v=(c*x+l*w)*m,C=(-g*x+f*w)*m,y=1-v-C;return t.defined(a)?(a.x=v,a.y=C,a.z=y,a):new r.Cartesian3(v,C,y)},computeLineSegmentLineSegmentIntersection:function(e,i,n,s,u,o,d,p,a){h.Check.typeOf.number("x00",e),h.Check.typeOf.number("y00",i),h.Check.typeOf.number("x01",n),h.Check.typeOf.number("y01",s),h.Check.typeOf.number("x10",u),h.Check.typeOf.number("y10",o),h.Check.typeOf.number("x11",d),h.Check.typeOf.number("y11",p);var f=(d-u)*(i-o)-(p-o)*(e-u),l=(n-e)*(i-o)-(s-i)*(e-u),c=(p-o)*(n-e)-(d-u)*(s-i);if(0!==c){var g=f/c,m=l/c;return g>=0&&g<=1&&m>=0&&m<=1?(t.defined(a)||(a=new r.Cartesian2),a.x=e+g*(n-e),a.y=i+g*(s-i),a):void 0}}},w=32767,x=w/2|0,v=[],C=[],y=[],B=new r.Cartographic,b=new r.Cartesian3,A=[],I=[],E=[],D=[],T=[],O=new r.Cartesian3,z=new i.BoundingSphere,M=new o.OrientedBoundingBox,N=new r.Cartesian2,V=new r.Cartesian3;function k(e,t){var h=e.isEastChild,d=e.isNorthChild,p=h?x:0,a=h?w:x,f=d?x:0,l=d?w:x,c=A,g=I,k=E,R=T;c.length=0,g.length=0,k.length=0,R.length=0;var H=D;H.length=0;var S={},U=e.vertices,F=e.indices;F=F.subarray(0,e.indexCountWithoutSkirts);var P,X,K,L,Y,_=n.TerrainEncoding.clone(e.encoding),G=_.hasVertexNormals,J=0,Z=e.vertexCountWithoutSkirts,j=e.minimumHeight,Q=e.maximumHeight,$=new Array(Z),ee=new Array(Z),ie=new Array(Z),re=G?new Array(2*Z):void 0,te=20;for(X=0,K=0;X<Z;++X,K+=2){var ne=_.decodeTextureCoordinates(U,X,N);if(P=_.decodeHeight(U,X),L=u.CesiumMath.clamp(ne.x*w|0,0,w),Y=u.CesiumMath.clamp(ne.y*w|0,0,w),ie[X]=u.CesiumMath.clamp((P-j)/(Q-j)*w|0,0,w),L<te&&(L=0),Y<te&&(Y=0),w-L<te&&(L=w),w-Y<te&&(Y=w),$[X]=L,ee[X]=Y,G){var se=_.getOctEncodedNormal(U,X,V);re[K]=se.x,re[K+1]=se.y}(h&&L>=x||!h&&L<=x)&&(d&&Y>=x||!d&&Y<=x)&&(S[X]=J,c.push(L),g.push(Y),k.push(ie[X]),G&&(R.push(re[K]),R.push(re[K+1])),++J)}var he=[];he.push(new q),he.push(new q),he.push(new q);var ue,oe,de=[];for(de.push(new q),de.push(new q),de.push(new q),X=0;X<F.length;X+=3){var pe=F[X],ae=F[X+1],fe=F[X+2],le=$[pe],ce=$[ae],ge=$[fe];he[0].initializeIndexed($,ee,ie,re,pe),he[1].initializeIndexed($,ee,ie,re,ae),he[2].initializeIndexed($,ee,ie,re,fe);var me=m.clipTriangleAtAxisAlignedThreshold(x,h,le,ce,ge,v);ue=0,ue>=me.length||(ue=de[0].initializeFromClipResult(me,ue,he),ue>=me.length||(ue=de[1].initializeFromClipResult(me,ue,he),ue>=me.length||(ue=de[2].initializeFromClipResult(me,ue,he),oe=m.clipTriangleAtAxisAlignedThreshold(x,d,de[0].getV(),de[1].getV(),de[2].getV(),C),W(c,g,k,R,H,S,oe,de,G),ue<me.length&&(de[2].clone(de[1]),de[2].initializeFromClipResult(me,ue,he),oe=m.clipTriangleAtAxisAlignedThreshold(x,d,de[0].getV(),de[1].getV(),de[2].getV(),C),W(c,g,k,R,H,S,oe,de,G)))))}var we=h?-w:0,xe=d?-w:0,ve=[],Ce=[],ye=[],Be=[],be=Number.MAX_VALUE,Ae=-be,Ie=y;Ie.length=0;var Ee=r.Ellipsoid.clone(e.ellipsoid),De=r.Rectangle.clone(e.childRectangle),Te=De.north,Oe=De.south,ze=De.east,Me=De.west;for(ze<Me&&(ze+=u.CesiumMath.TWO_PI),X=0;X<c.length;++X)L=Math.round(c[X]),L<=p?(ve.push(X),L=0):L>=a?(ye.push(X),L=w):L=2*L+we,c[X]=L,Y=Math.round(g[X]),Y<=f?(Ce.push(X),Y=0):Y>=l?(Be.push(X),Y=w):Y=2*Y+xe,g[X]=Y,P=u.CesiumMath.lerp(j,Q,k[X]/w),P<be&&(be=P),P>Ae&&(Ae=P),k[X]=P,B.longitude=u.CesiumMath.lerp(Me,ze,L/w),B.latitude=u.CesiumMath.lerp(Oe,Te,Y/w),B.height=P,Ee.cartographicToCartesian(B,b),Ie.push(b.x),Ie.push(b.y),Ie.push(b.z);var Ne=i.BoundingSphere.fromVertices(Ie,r.Cartesian3.ZERO,3,z),Ve=o.OrientedBoundingBox.fromRectangle(De,be,Ae,Ee,M),ke=new n.EllipsoidalOccluder(Ee),qe=ke.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Ne.center,Ie,3,Ne.center,be,O),Re=Ae-be,He=new Uint16Array(c.length+g.length+k.length);for(X=0;X<c.length;++X)He[X]=c[X];var Se=c.length;for(X=0;X<g.length;++X)He[Se+X]=g[X];for(Se+=g.length,X=0;X<k.length;++X)He[Se+X]=w*(k[X]-be)/Re;var Ue,Fe=s.IndexDatatype.createTypedArray(c.length,H);if(G){var Pe=new Uint8Array(R);t.push(He.buffer,Fe.buffer,Pe.buffer),Ue=Pe.buffer}else t.push(He.buffer,Fe.buffer);return{vertices:He.buffer,encodedNormals:Ue,indices:Fe.buffer,minimumHeight:be,maximumHeight:Ae,westIndices:ve,southIndices:Ce,eastIndices:ye,northIndices:Be,boundingSphere:Ne,orientedBoundingBox:Ve,horizonOcclusionPoint:qe}}function q(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}q.prototype.clone=function(e){return t.defined(e)||(e=new q),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},q.prototype.initializeIndexed=function(e,i,r,t,n){this.uBuffer=e,this.vBuffer=i,this.heightBuffer=r,this.normalBuffer=t,this.index=n,this.first=void 0,this.second=void 0,this.ratio=void 0},q.prototype.initializeFromClipResult=function(e,i,r){var t=i+1;return-1!==e[i]?r[e[i]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=r[e[t]],++t,this.second=r[e[t]],++t,this.ratio=e[t],++t),t},q.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},q.prototype.isIndexed=function(){return t.defined(this.index)},q.prototype.getH=function(){return t.defined(this.index)?this.heightBuffer[this.index]:u.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},q.prototype.getU=function(){return t.defined(this.index)?this.uBuffer[this.index]:u.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},q.prototype.getV=function(){return t.defined(this.index)?this.vBuffer[this.index]:u.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var R=new r.Cartesian2,H=-1,S=[new r.Cartesian3,new r.Cartesian3],U=[new r.Cartesian3,new r.Cartesian3];function F(i,t){++H;var n=S[H],s=U[H];return n=e.AttributeCompression.octDecode(i.first.getNormalX(),i.first.getNormalY(),n),s=e.AttributeCompression.octDecode(i.second.getNormalX(),i.second.getNormalY(),s),b=r.Cartesian3.lerp(n,s,i.ratio,b),r.Cartesian3.normalize(b,b),e.AttributeCompression.octEncode(b,t),--H,t}q.prototype.getNormalX=function(){return t.defined(this.index)?this.normalBuffer[2*this.index]:(R=F(this,R),R.x)},q.prototype.getNormalY=function(){return t.defined(this.index)?this.normalBuffer[2*this.index+1]:(R=F(this,R),R.y)};var P=[];function W(e,i,r,n,s,h,u,o,d){if(0!==u.length){var p=0,a=0;while(a<u.length)a=P[p++].initializeFromClipResult(u,a,o);for(var f=0;f<p;++f){var l=P[f];if(l.isIndexed())l.newIndex=h[l.index],l.uBuffer=e,l.vBuffer=i,l.heightBuffer=r,d&&(l.normalBuffer=n);else{var c=l.getKey();if(t.defined(h[c]))l.newIndex=h[c];else{var g=e.length;e.push(l.getU()),i.push(l.getV()),r.push(l.getH()),d&&(n.push(l.getNormalX()),n.push(l.getNormalY())),l.newIndex=g,h[c]=g}}}3===p?(s.push(P[0].newIndex),s.push(P[1].newIndex),s.push(P[2].newIndex)):4===p&&(s.push(P[0].newIndex),s.push(P[1].newIndex),s.push(P[2].newIndex),s.push(P[0].newIndex),s.push(P[2].newIndex),s.push(P[3].newIndex))}}P.push(new q),P.push(new q),P.push(new q),P.push(new q);var X=d(k);return X}));