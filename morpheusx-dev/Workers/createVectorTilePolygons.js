define(["./AttributeCompression-212262a3","./Matrix2-92b7fb9d","./Color-0181dacd","./when-8166c7dd","./IndexDatatype-797210ca","./ComponentDatatype-9ed50558","./OrientedBoundingBox-ed23852c","./createTaskProcessorWorker","./RuntimeError-4fdc4459","./Transforms-62a339c3","./combine-a5c4cc47","./WebGLConstants-0664004c","./EllipsoidTangentPlane-5d8b4bd3","./AxisAlignedBoundingBox-b0cd1e39","./IntersectionTests-4f28a69c","./Plane-049255eb"],(function(e,a,n,r,t,i,o,s,d,f,c,u,h,l,g,p){"use strict";var b=new a.Cartesian3,v=new a.Ellipsoid,m=new a.Rectangle,y={min:void 0,max:void 0,indexBytesPerElement:void 0};function C(e){var n=new Float64Array(e),r=0;y.indexBytesPerElement=n[r++],y.min=n[r++],y.max=n[r++],a.Cartesian3.unpack(n,r,b),r+=a.Cartesian3.packedLength,a.Ellipsoid.unpack(n,r,v),r+=a.Ellipsoid.packedLength,a.Rectangle.unpack(n,r,m)}function I(e){for(var a=e.length,r=0,t=0;t<a;++t)r+=n.Color.packedLength+3+e[t].batchIds.length;return r}function w(e,a,r){var t=a.length,i=2+t*o.OrientedBoundingBox.packedLength+1+I(r),s=new Float64Array(i),d=0;s[d++]=e,s[d++]=t;for(var f=0;f<t;++f)o.OrientedBoundingBox.pack(a[f],s,d),d+=o.OrientedBoundingBox.packedLength;var c=r.length;s[d++]=c;for(var u=0;u<c;++u){var h=r[u];n.Color.pack(h.color,s,d),d+=n.Color.packedLength,s[d++]=h.offset,s[d++]=h.count;var l=h.batchIds,g=l.length;s[d++]=g;for(var p=0;p<g;++p)s[d++]=l[p]}return s}var x=32767,A=new a.Cartesian3,E=new a.Cartesian3,N=new a.Cartesian3,T=new a.Cartesian3,B=new a.Cartesian3,k=new a.Cartographic,L=new a.Rectangle;function O(s,d){var f;C(s.packedBuffer);var c=y.indexBytesPerElement;f=2===c?new Uint16Array(s.indices):new Uint32Array(s.indices);var u,h,l,g=new Uint16Array(s.positions),p=new Uint32Array(s.counts),I=new Uint32Array(s.indexCounts),O=new Uint32Array(s.batchIds),U=new Uint32Array(s.batchTableColors),P=new Array(p.length),F=b,S=v,D=m,R=y.min,M=y.max,_=s.minimumHeights,G=s.maximumHeights;r.defined(_)&&r.defined(G)&&(_=new Float32Array(_),G=new Float32Array(G));var Y=g.length/2,V=g.subarray(0,Y),H=g.subarray(Y,2*Y);e.AttributeCompression.zigZagDeltaDecode(V,H);var W=new Float64Array(3*Y);for(u=0;u<Y;++u){var z=V[u],Z=H[u],j=i.CesiumMath.lerp(D.west,D.east,z/x),q=i.CesiumMath.lerp(D.south,D.north,Z/x),J=a.Cartographic.fromRadians(j,q,0,k),K=S.cartographicToCartesian(J,A);a.Cartesian3.pack(K,W,3*u)}var Q=p.length,X=new Array(Q),$=new Array(Q),ee=0,ae=0;for(u=0;u<Q;++u)X[u]=ee,$[u]=ae,ee+=p[u],ae+=I[u];var ne,re=new Float32Array(3*Y*2),te=new Uint16Array(2*Y),ie=new Uint32Array($.length),oe=new Uint32Array(I.length),se=[],de={};for(u=0;u<Q;++u)l=U[u],r.defined(de[l])?(de[l].positionLength+=p[u],de[l].indexLength+=I[u],de[l].batchIds.push(u)):de[l]={positionLength:p[u],indexLength:I[u],offset:0,indexOffset:0,batchIds:[u]};var fe=0,ce=0;for(l in de)if(de.hasOwnProperty(l)){ne=de[l],ne.offset=fe,ne.indexOffset=ce;var ue=2*ne.positionLength,he=2*ne.indexLength+6*ne.positionLength;fe+=ue,ce+=he,ne.indexLength=he}var le=[];for(l in de)de.hasOwnProperty(l)&&(ne=de[l],le.push({color:n.Color.fromRgba(parseInt(l)),offset:ne.indexOffset,count:ne.indexLength,batchIds:ne.batchIds}));for(u=0;u<Q;++u){l=U[u],ne=de[l];var ge=ne.offset,pe=3*ge,be=ge,ve=X[u],me=p[u],ye=O[u],Ce=R,Ie=M;r.defined(_)&&r.defined(G)&&(Ce=_[u],Ie=G[u]);var we=Number.POSITIVE_INFINITY,xe=Number.NEGATIVE_INFINITY,Ae=Number.POSITIVE_INFINITY,Ee=Number.NEGATIVE_INFINITY;for(h=0;h<me;++h){var Ne=a.Cartesian3.unpack(W,3*ve+3*h,A);S.scaleToGeodeticSurface(Ne,Ne);var Te=S.cartesianToCartographic(Ne,k),Be=Te.latitude,ke=Te.longitude;we=Math.min(Be,we),xe=Math.max(Be,xe),Ae=Math.min(ke,Ae),Ee=Math.max(ke,Ee);var Le=S.geodeticSurfaceNormal(Ne,E),Oe=a.Cartesian3.multiplyByScalar(Le,Ce,N),Ue=a.Cartesian3.add(Ne,Oe,T);Oe=a.Cartesian3.multiplyByScalar(Le,Ie,Oe);var Pe=a.Cartesian3.add(Ne,Oe,B);a.Cartesian3.subtract(Pe,F,Pe),a.Cartesian3.subtract(Ue,F,Ue),a.Cartesian3.pack(Pe,re,pe),a.Cartesian3.pack(Ue,re,pe+3),te[be]=ye,te[be+1]=ye,pe+=6,be+=2}D=L,D.west=Ae,D.east=Ee,D.south=we,D.north=xe,P[u]=o.OrientedBoundingBox.fromRectangle(D,R,M,S);var Fe=ne.indexOffset,Se=$[u],De=I[u];for(ie[u]=Fe,h=0;h<De;h+=3){var Re=f[Se+h]-ve,Me=f[Se+h+1]-ve,_e=f[Se+h+2]-ve;se[Fe++]=2*Re+ge,se[Fe++]=2*Me+ge,se[Fe++]=2*_e+ge,se[Fe++]=2*_e+1+ge,se[Fe++]=2*Me+1+ge,se[Fe++]=2*Re+1+ge}for(h=0;h<me;++h){var Ge=h,Ye=(h+1)%me;se[Fe++]=2*Ge+1+ge,se[Fe++]=2*Ye+ge,se[Fe++]=2*Ge+ge,se[Fe++]=2*Ge+1+ge,se[Fe++]=2*Ye+1+ge,se[Fe++]=2*Ye+ge}ne.offset+=2*me,ne.indexOffset=Fe,oe[u]=Fe-ie[u]}se=t.IndexDatatype.createTypedArray(re.length/3,se);for(var Ve=le.length,He=0;He<Ve;++He){for(var We=le[He].batchIds,ze=0,Ze=We.length,je=0;je<Ze;++je)ze+=oe[We[je]];le[He].count=ze}var qe=2===se.BYTES_PER_ELEMENT?t.IndexDatatype.UNSIGNED_SHORT:t.IndexDatatype.UNSIGNED_INT,Je=w(qe,P,le);return d.push(re.buffer,se.buffer,ie.buffer,oe.buffer,te.buffer,Je.buffer),{positions:re.buffer,indices:se.buffer,indexOffsets:ie.buffer,indexCounts:oe.buffer,batchIds:te.buffer,packedBuffer:Je.buffer}}var U=s(O);return U}));