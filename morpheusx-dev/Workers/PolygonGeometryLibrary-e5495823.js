define(["exports","./ArcType-13a53523","./arrayRemoveDuplicates-198208a4","./Matrix2-92b7fb9d","./ComponentDatatype-9ed50558","./when-8166c7dd","./EllipsoidRhumbLine-51654311","./GeometryAttribute-6f4c3b93","./GeometryAttributes-50becc99","./GeometryPipeline-54fb0bb4","./IndexDatatype-797210ca","./PolygonPipeline-7fb6627c","./Transforms-62a339c3"],(function(e,t,r,i,n,a,o,s,u,l,h,c,p){"use strict";function f(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(f.prototype,{length:{get:function(){return this._length}}}),f.prototype.enqueue=function(e){this._array.push(e),this._length++},f.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,t++,t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},f.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},f.prototype.contains=function(e){return-1!==this._array.indexOf(e)},f.prototype.clear=function(){this._array.length=this._offset=this._length=0},f.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var d={computeHierarchyPackedLength:function(e){var t=0,r=[e];while(r.length>0){var n=r.pop();if(a.defined(n)){t+=2;var o=n.positions,s=n.holes;if(a.defined(o)&&(t+=o.length*i.Cartesian3.packedLength),a.defined(s))for(var u=s.length,l=0;l<u;++l)r.push(s[l])}}return t},packPolygonHierarchy:function(e,t,r){var n=[e];while(n.length>0){var o=n.pop();if(a.defined(o)){var s=o.positions,u=o.holes;if(t[r++]=a.defined(s)?s.length:0,t[r++]=a.defined(u)?u.length:0,a.defined(s))for(var l=s.length,h=0;h<l;++h,r+=3)i.Cartesian3.pack(s[h],t,r);if(a.defined(u))for(var c=u.length,p=0;p<c;++p)n.push(u[p])}}return r},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],n=e[t++],a=new Array(r),o=n>0?new Array(n):void 0,s=0;s<r;++s,t+=i.Cartesian3.packedLength)a[s]=i.Cartesian3.unpack(e,t);for(var u=0;u<n;++u)o[u]=d.unpackPolygonHierarchy(e,t),t=o[u].startingIndex,delete o[u].startingIndex;return{positions:a,holes:o,startingIndex:t}}},y=new i.Cartesian3;function g(e,t,r,n){return i.Cartesian3.subtract(t,e,y),i.Cartesian3.multiplyByScalar(y,r/n,y),i.Cartesian3.add(e,y,y),[y.x,y.y,y.z]}d.subdivideLineCount=function(e,t,r){var a=i.Cartesian3.distance(e,t),o=a/r,s=Math.max(0,Math.ceil(n.CesiumMath.log2(o)));return Math.pow(2,s)};var v=new i.Cartographic,m=new i.Cartographic,C=new i.Cartographic,b=new i.Cartesian3;d.subdivideRhumbLineCount=function(e,t,r,i){var a=e.cartesianToCartographic(t,v),s=e.cartesianToCartographic(r,m),u=new o.EllipsoidRhumbLine(a,s,e),l=u.surfaceDistance/i,h=Math.max(0,Math.ceil(n.CesiumMath.log2(l)));return Math.pow(2,h)},d.subdivideLine=function(e,t,r,n){var o=d.subdivideLineCount(e,t,r),s=i.Cartesian3.distance(e,t),u=s/o;a.defined(n)||(n=[]);var l=n;l.length=3*o;for(var h=0,c=0;c<o;c++){var p=g(e,t,c*u,s);l[h++]=p[0],l[h++]=p[1],l[h++]=p[2]}return l},d.subdivideRhumbLine=function(e,t,r,i,s){var u=e.cartesianToCartographic(t,v),l=e.cartesianToCartographic(r,m),h=new o.EllipsoidRhumbLine(u,l,e),c=h.surfaceDistance/i,p=Math.max(0,Math.ceil(n.CesiumMath.log2(c))),f=Math.pow(2,p),d=h.surfaceDistance/f;a.defined(s)||(s=[]);var y=s;y.length=3*f;for(var g=0,w=0;w<f;w++){var T=h.interpolateUsingSurfaceDistance(w*d,C),I=e.cartographicToCartesian(T,b);y[g++]=I.x,y[g++]=I.y,y[g++]=I.z}return y};var w=new i.Cartesian3,T=new i.Cartesian3,I=new i.Cartesian3,x=new i.Cartesian3;d.scaleToGeodeticHeightExtruded=function(e,t,r,n,o){n=a.defaultValue(n,i.Ellipsoid.WGS84);var s=w,u=T,l=I,h=x;if(a.defined(e)&&a.defined(e.attributes)&&a.defined(e.attributes.position))for(var c=e.attributes.position.values,p=c.length/2,f=0;f<p;f+=3)i.Cartesian3.fromArray(c,f,l),n.geodeticSurfaceNormal(l,s),h=n.scaleToGeodeticSurface(l,h),u=i.Cartesian3.multiplyByScalar(s,r,u),u=i.Cartesian3.add(h,u,u),c[f+p]=u.x,c[f+1+p]=u.y,c[f+2+p]=u.z,o&&(h=i.Cartesian3.clone(l,h)),u=i.Cartesian3.multiplyByScalar(s,t,u),u=i.Cartesian3.add(h,u,u),c[f]=u.x,c[f+1]=u.y,c[f+2]=u.z;return e},d.polygonOutlinesFromHierarchy=function(e,t,n){var o,s,u,l=[],h=new f;h.enqueue(e);while(0!==h.length){var c=h.dequeue(),p=c.positions;if(t)for(u=p.length,o=0;o<u;o++)n.scaleToGeodeticSurface(p[o],p[o]);if(p=r.arrayRemoveDuplicates(p,i.Cartesian3.equalsEpsilon,!0),!(p.length<3)){var d=c.holes?c.holes.length:0;for(o=0;o<d;o++){var y=c.holes[o],g=y.positions;if(t)for(u=g.length,s=0;s<u;++s)n.scaleToGeodeticSurface(g[s],g[s]);if(g=r.arrayRemoveDuplicates(g,i.Cartesian3.equalsEpsilon,!0),!(g.length<3)){l.push(g);var v=0;for(a.defined(y.holes)&&(v=y.holes.length),s=0;s<v;s++)h.enqueue(y.holes[s])}}l.push(p)}}return l},d.polygonsFromHierarchy=function(e,t,n,o){var s=[],u=[],l=new f;l.enqueue(e);while(0!==l.length){var h,p,d=l.dequeue(),y=d.positions,g=d.holes;if(n)for(p=y.length,h=0;h<p;h++)o.scaleToGeodeticSurface(y[h],y[h]);if(y=r.arrayRemoveDuplicates(y,i.Cartesian3.equalsEpsilon,!0),!(y.length<3)){var v=t(y);if(a.defined(v)){var m=[],C=c.PolygonPipeline.computeWindingOrder2D(v);C===c.WindingOrder.CLOCKWISE&&(v.reverse(),y=y.slice().reverse());var b,w=y.slice(),T=a.defined(g)?g.length:0,I=[];for(h=0;h<T;h++){var x=g[h],E=x.positions;if(n)for(p=E.length,b=0;b<p;++b)o.scaleToGeodeticSurface(E[b],E[b]);if(E=r.arrayRemoveDuplicates(E,i.Cartesian3.equalsEpsilon,!0),!(E.length<3)){var A=t(E);if(a.defined(A)){C=c.PolygonPipeline.computeWindingOrder2D(A),C===c.WindingOrder.CLOCKWISE&&(A.reverse(),E=E.slice().reverse()),I.push(E),m.push(w.length),w=w.concat(E),v=v.concat(A);var P=0;for(a.defined(x.holes)&&(P=x.holes.length),b=0;b<P;b++)l.enqueue(x.holes[b])}}}s.push({outerRing:y,holes:I}),u.push({positions:w,positions2D:v,holes:m})}}}return{hierarchy:s,polygons:u}};var E=new i.Cartesian2,A=new i.Cartesian3,P=new p.Quaternion,_=new i.Matrix3;d.computeBoundingRectangle=function(e,t,r,n,o){for(var s=p.Quaternion.fromAxisAngle(e,n,P),u=i.Matrix3.fromQuaternion(s,_),l=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,d=r.length,y=0;y<d;++y){var g=i.Cartesian3.clone(r[y],A);i.Matrix3.multiplyByVector(u,g,g);var v=t(g,E);a.defined(v)&&(l=Math.min(l,v.x),h=Math.max(h,v.x),c=Math.min(c,v.y),f=Math.max(f,v.y))}return o.x=l,o.y=c,o.width=h-l,o.height=f-c,o},d.createGeometryFromPositions=function(e,r,i,a,o,u){var h=c.PolygonPipeline.triangulate(r.positions2D,r.holes);h.length<3&&(h=[0,1,2]);var p=r.positions;if(a){for(var f=p.length,d=new Array(3*f),y=0,g=0;g<f;g++){var v=p[g];d[y++]=v.x,d[y++]=v.y,d[y++]=v.z}var m=new s.Geometry({attributes:{position:new s.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:h,primitiveType:s.PrimitiveType.TRIANGLES});return o.normal?l.GeometryPipeline.computeNormal(m):m}return u===t.ArcType.GEODESIC?c.PolygonPipeline.computeSubdivision(e,p,h,i):u===t.ArcType.RHUMB?c.PolygonPipeline.computeRhumbLineSubdivision(e,p,h,i):void 0};var G=[],L=new i.Cartesian3,M=new i.Cartesian3;d.computeWallGeometry=function(e,r,a,o,l){var c,p,f,y,g,v=e.length,m=0;if(o)for(p=3*v*2,c=new Array(2*p),f=0;f<v;f++)y=e[f],g=e[(f+1)%v],c[m]=c[m+p]=y.x,++m,c[m]=c[m+p]=y.y,++m,c[m]=c[m+p]=y.z,++m,c[m]=c[m+p]=g.x,++m,c[m]=c[m+p]=g.y,++m,c[m]=c[m+p]=g.z,++m;else{var C=n.CesiumMath.chordLength(a,r.maximumRadius),b=0;if(l===t.ArcType.GEODESIC)for(f=0;f<v;f++)b+=d.subdivideLineCount(e[f],e[(f+1)%v],C);else if(l===t.ArcType.RHUMB)for(f=0;f<v;f++)b+=d.subdivideRhumbLineCount(r,e[f],e[(f+1)%v],C);for(p=3*(b+v),c=new Array(2*p),f=0;f<v;f++){var w;y=e[f],g=e[(f+1)%v],l===t.ArcType.GEODESIC?w=d.subdivideLine(y,g,C,G):l===t.ArcType.RHUMB&&(w=d.subdivideRhumbLine(r,y,g,C,G));for(var T=w.length,I=0;I<T;++I,++m)c[m]=w[I],c[m+p]=w[I];c[m]=g.x,c[m+p]=g.x,++m,c[m]=g.y,c[m+p]=g.y,++m,c[m]=g.z,c[m+p]=g.z,++m}}v=c.length;var x=h.IndexDatatype.createTypedArray(v/3,v-6*e.length),E=0;for(v/=6,f=0;f<v;f++){var A=f,P=A+1,_=A+v,D=_+1;y=i.Cartesian3.fromArray(c,3*A,L),g=i.Cartesian3.fromArray(c,3*P,M),i.Cartesian3.equalsEpsilon(y,g,n.CesiumMath.EPSILON10,n.CesiumMath.EPSILON10)||(x[E++]=A,x[E++]=_,x[E++]=P,x[E++]=P,x[E++]=_,x[E++]=D)}return new s.Geometry({attributes:new u.GeometryAttributes({position:new s.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:c})}),indices:x,primitiveType:s.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=d}));