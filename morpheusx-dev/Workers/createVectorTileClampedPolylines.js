define(["./AttributeCompression-212262a3","./Matrix2-92b7fb9d","./combine-a5c4cc47","./IndexDatatype-797210ca","./ComponentDatatype-9ed50558","./createTaskProcessorWorker","./RuntimeError-4fdc4459","./when-8166c7dd","./WebGLConstants-0664004c"],(function(a,e,t,r,s,n,i,o,d){"use strict";var f=32767,l=Math.cos(s.CesiumMath.toRadians(150)),c=new e.Cartographic,h=new e.Cartesian3;function u(a,t,r,n,i,o,d){for(var l=a.length,u=new Float64Array(3*l),C=0;C<l;++C){var p=a[C],v=t[C],m=r[C],b=s.CesiumMath.lerp(n.west,n.east,p/f),A=s.CesiumMath.lerp(n.south,n.north,v/f),w=s.CesiumMath.lerp(i,o,m/f),g=e.Cartographic.fromRadians(b,A,w,c),y=d.cartographicToCartesian(g,h);e.Cartesian3.pack(y,u,3*C)}return u}function C(a){for(var e=a.length,t=new Uint32Array(e+1),r=0,s=0;s<e;++s)t[s]=r,r+=a[s];return t[e]=r,t}var p=new e.Cartographic,v=new e.Cartographic;function m(a,t,r,s){for(var n=s.length,i=a.length,o=new Uint8Array(i),d=p,f=v,l=0,c=0;c<n;c++){for(var h=s[c],u=h,C=1;C<h;C++){var m=l+C,b=m-1;f.longitude=a[m],f.latitude=t[m],d.longitude=a[b],d.latitude=t[b],e.Cartographic.equals(f,d)&&(u--,o[b]=1)}s[c]=u,l+=h}for(var A=0,w=0;w<i;w++)1!==o[w]&&(a[A]=a[w],t[A]=t[w],r[A]=r[w],A++)}function b(a){var e=8*a,t=3*e,s=4*e;this.startEllipsoidNormals=new Float32Array(t),this.endEllipsoidNormals=new Float32Array(t),this.startPositionAndHeights=new Float32Array(s),this.startFaceNormalAndVertexCornerIds=new Float32Array(s),this.endPositionAndHeights=new Float32Array(s),this.endFaceNormalAndHalfWidths=new Float32Array(s),this.vertexBatchIds=new Uint16Array(e),this.indices=r.IndexDatatype.createTypedArray(e,36*a),this.vec3Offset=0,this.vec4Offset=0,this.batchIdOffset=0,this.indexOffset=0,this.volumeStartIndex=0}var A=new e.Cartesian3,w=new e.Cartesian3;function g(a,t,r,s,n){var i=e.Cartesian3.subtract(r,t,w),o=e.Cartesian3.subtract(t,a,A);return e.Cartesian3.normalize(i,i),e.Cartesian3.normalize(o,o),e.Cartesian3.dot(i,o)<l&&(o=e.Cartesian3.multiplyByScalar(o,-1,A)),e.Cartesian3.add(i,o,n),e.Cartesian3.equals(n,e.Cartesian3.ZERO)&&(n=e.Cartesian3.subtract(a,t)),e.Cartesian3.cross(n,s,n),e.Cartesian3.cross(s,n,n),e.Cartesian3.normalize(n,n),n}var y=[0,2,6,0,6,4,0,1,3,0,3,2,0,4,5,0,5,1,5,3,1,5,7,3,7,5,4,7,4,6,7,6,2,7,2,3],N=y.length,k=new e.Cartesian3,I=new e.Cartesian3,x=new e.Cartesian3,E=new e.Cartesian3,F=new e.Cartesian3;b.prototype.addVolume=function(a,t,r,s,n,i,o,d,f,l){var c=e.Cartesian3.add(t,f,k),h=l.geodeticSurfaceNormal(c,I);c=e.Cartesian3.add(r,f,k);var u,C=l.geodeticSurfaceNormal(c,E),p=g(a,t,r,h,x),v=g(s,r,t,C,F),m=this.startEllipsoidNormals,b=this.endEllipsoidNormals,A=this.startPositionAndHeights,w=this.startFaceNormalAndVertexCornerIds,H=this.endPositionAndHeights,O=this.endFaceNormalAndHalfWidths,P=this.vertexBatchIds,D=this.batchIdOffset,S=this.vec3Offset,M=this.vec4Offset;for(u=0;u<8;u++)e.Cartesian3.pack(h,m,S),e.Cartesian3.pack(C,b,S),e.Cartesian3.pack(t,A,M),A[M+3]=n,e.Cartesian3.pack(r,H,M),H[M+3]=i,e.Cartesian3.pack(p,w,M),w[M+3]=u,e.Cartesian3.pack(v,O,M),O[M+3]=o,P[D++]=d,S+=3,M+=4;this.batchIdOffset=D,this.vec3Offset=S,this.vec4Offset=M;var R=this.indices,U=this.volumeStartIndex,B=this.indexOffset;for(u=0;u<N;u++)R[B+u]=y[u]+U;this.volumeStartIndex+=8,this.indexOffset+=N};var H=new e.Rectangle,O=new e.Ellipsoid,P=new e.Cartesian3,D=new e.Cartesian3,S=new e.Cartesian3,M=new e.Cartesian3,R=new e.Cartesian3;function U(n,i){var o,d=new Uint16Array(n.positions),l=new Uint16Array(n.widths),c=new Uint32Array(n.counts),h=new Uint16Array(n.batchIds),p=H,v=O,A=P,w=new Float64Array(n.packedBuffer),g=0,y=w[g++],N=w[g++];e.Rectangle.unpack(w,g,p),g+=e.Rectangle.packedLength,e.Ellipsoid.unpack(w,g,v),g+=e.Ellipsoid.packedLength,e.Cartesian3.unpack(w,g,A);var k=d.length/3,I=d.subarray(0,k),x=d.subarray(k,2*k),E=d.subarray(2*k,3*k);a.AttributeCompression.zigZagDeltaDecode(I,x,E),m(I,x,E,c);var F=c.length,U=0;for(o=0;o<F;o++){var B=c[o];U+=B-1}var T=new b(U),V=u(I,x,E,p,y,N,v);k=I.length;var W=new Float32Array(3*k);for(o=0;o<k;++o)W[3*o]=V[3*o]-A.x,W[3*o+1]=V[3*o+1]-A.y,W[3*o+2]=V[3*o+2]-A.z;var z=0,q=0;for(o=0;o<F;o++){for(var L=c[o]-1,_=.5*l[o],G=h[o],Z=z,Y=0;Y<L;Y++){var j=e.Cartesian3.unpack(W,z,S),J=e.Cartesian3.unpack(W,z+3,M),K=E[q],Q=E[q+1];K=s.CesiumMath.lerp(y,N,K/f),Q=s.CesiumMath.lerp(y,N,Q/f),q++;var X=D,$=R;if(0===Y){var aa=Z+3*L,ea=e.Cartesian3.unpack(W,aa,D);if(e.Cartesian3.equals(ea,j))e.Cartesian3.unpack(W,aa-3,X);else{var ta=e.Cartesian3.subtract(j,J,D);X=e.Cartesian3.add(ta,j,D)}}else e.Cartesian3.unpack(W,z-3,X);if(Y===L-1){var ra=e.Cartesian3.unpack(W,Z,R);if(e.Cartesian3.equals(ra,J))e.Cartesian3.unpack(W,Z+3,$);else{var sa=e.Cartesian3.subtract(J,j,R);$=e.Cartesian3.add(sa,J,R)}}else e.Cartesian3.unpack(W,z+6,$);T.addVolume(X,j,J,$,K,Q,_,G,A,v),z+=3}z+=3,q++}var na=T.indices;i.push(T.startEllipsoidNormals.buffer),i.push(T.endEllipsoidNormals.buffer),i.push(T.startPositionAndHeights.buffer),i.push(T.startFaceNormalAndVertexCornerIds.buffer),i.push(T.endPositionAndHeights.buffer),i.push(T.endFaceNormalAndHalfWidths.buffer),i.push(T.vertexBatchIds.buffer),i.push(na.buffer);var ia={indexDatatype:2===na.BYTES_PER_ELEMENT?r.IndexDatatype.UNSIGNED_SHORT:r.IndexDatatype.UNSIGNED_INT,startEllipsoidNormals:T.startEllipsoidNormals.buffer,endEllipsoidNormals:T.endEllipsoidNormals.buffer,startPositionAndHeights:T.startPositionAndHeights.buffer,startFaceNormalAndVertexCornerIds:T.startFaceNormalAndVertexCornerIds.buffer,endPositionAndHeights:T.endPositionAndHeights.buffer,endFaceNormalAndHalfWidths:T.endFaceNormalAndHalfWidths.buffer,vertexBatchIds:T.vertexBatchIds.buffer,indices:na.buffer};if(n.keepDecodedPositions){var oa=C(c);i.push(V.buffer,oa.buffer),ia=t.combine(ia,{decodedPositions:V.buffer,decodedPositionOffsets:oa.buffer})}return ia}var B=n(U);return B}));