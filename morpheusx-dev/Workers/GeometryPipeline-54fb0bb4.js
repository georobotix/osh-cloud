define(["exports","./AttributeCompression-212262a3","./Matrix2-92b7fb9d","./RuntimeError-4fdc4459","./when-8166c7dd","./ComponentDatatype-9ed50558","./Transforms-62a339c3","./EncodedCartesian3-4a314cb8","./GeometryAttribute-6f4c3b93","./IndexDatatype-797210ca","./IntersectionTests-4f28a69c","./Plane-049255eb"],(function(e,t,r,i,a,n,o,s,u,p,d,l){"use strict";var v=new r.Cartesian3,f=new r.Cartesian3,m=new r.Cartesian3;function y(e,t,o,s,u){var p,d,l,y,c,h,C,b;if(i.Check.defined("point",e),i.Check.defined("p0",t),i.Check.defined("p1",o),i.Check.defined("p2",s),a.defined(u)||(u=new r.Cartesian3),a.defined(t.z)){if(r.Cartesian3.equalsEpsilon(e,t,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_X,u);if(r.Cartesian3.equalsEpsilon(e,o,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Y,u);if(r.Cartesian3.equalsEpsilon(e,s,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Z,u);p=r.Cartesian3.subtract(o,t,v),d=r.Cartesian3.subtract(s,t,f),l=r.Cartesian3.subtract(e,t,m),y=r.Cartesian3.dot(p,p),c=r.Cartesian3.dot(p,d),h=r.Cartesian3.dot(p,l),C=r.Cartesian3.dot(d,d),b=r.Cartesian3.dot(d,l)}else{if(r.Cartesian2.equalsEpsilon(e,t,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_X,u);if(r.Cartesian2.equalsEpsilon(e,o,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Y,u);if(r.Cartesian2.equalsEpsilon(e,s,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Z,u);p=r.Cartesian2.subtract(o,t,v),d=r.Cartesian2.subtract(s,t,f),l=r.Cartesian2.subtract(e,t,m),y=r.Cartesian2.dot(p,p),c=r.Cartesian2.dot(p,d),h=r.Cartesian2.dot(p,l),C=r.Cartesian2.dot(d,d),b=r.Cartesian2.dot(d,l)}u.y=C*h-c*b,u.z=y*b-c*h;var w=y*C-c*c;return 0!==u.y&&(u.y/=w),0!==u.z&&(u.z/=w),u.x=1-u.y-u.z,u}var c={calculateACMR:function(e){e=a.defaultValue(e,a.defaultValue.EMPTY_OBJECT);var t=e.indices,r=e.maximumIndex,n=a.defaultValue(e.cacheSize,24);if(!a.defined(t))throw new i.DeveloperError("indices is required.");var o=t.length;if(o<3||o%3!==0)throw new i.DeveloperError("indices length must be a multiple of three.");if(r<=0)throw new i.DeveloperError("maximumIndex must be greater than zero.");if(n<3)throw new i.DeveloperError("cacheSize must be greater than two.");if(!a.defined(r)){r=0;var s=0,u=t[s];while(s<o)u>r&&(r=u),++s,u=t[s]}for(var p=[],d=0;d<r+1;d++)p[d]=0;for(var l=n+1,v=0;v<o;++v)l-p[t[v]]>n&&(p[t[v]]=l,++l);return(l-n+1)/(o/3)},tipsify:function(e){e=a.defaultValue(e,a.defaultValue.EMPTY_OBJECT);var t,r=e.indices,n=e.maximumIndex,o=a.defaultValue(e.cacheSize,24);function s(e,r,i,a){while(r.length>=1){var n=r[r.length-1];if(r.splice(r.length-1,1),e[n].numLiveTriangles>0)return n}while(t<a){if(e[t].numLiveTriangles>0)return++t,t-1;++t}return-1}function u(e,t,r,i,a,n,o){var u,p=-1,d=-1,l=0;while(l<r.length){var v=r[l];i[v].numLiveTriangles&&(u=0,a-i[v].timeStamp+2*i[v].numLiveTriangles<=t&&(u=a-i[v].timeStamp),(u>d||-1===d)&&(d=u,p=v)),++l}return-1===p?s(i,n,e,o):p}if(!a.defined(r))throw new i.DeveloperError("indices is required.");var p=r.length;if(p<3||p%3!==0)throw new i.DeveloperError("indices length must be a multiple of three.");if(n<=0)throw new i.DeveloperError("maximumIndex must be greater than zero.");if(o<3)throw new i.DeveloperError("cacheSize must be greater than two.");var d=0,l=0,v=r[l],f=p;if(a.defined(n))d=n+1;else{while(l<f)v>d&&(d=v),++l,v=r[l];if(-1===d)return 0;++d}var m,y=[];for(m=0;m<d;m++)y[m]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};l=0;var c=0;while(l<f)y[r[l]].vertexTriangles.push(c),++y[r[l]].numLiveTriangles,y[r[l+1]].vertexTriangles.push(c),++y[r[l+1]].numLiveTriangles,y[r[l+2]].vertexTriangles.push(c),++y[r[l+2]].numLiveTriangles,++c,l+=3;var h=0,C=o+1;t=1;var b,w,g,T,A=[],E=[],D=0,x=[],P=p/3,I=[];for(m=0;m<P;m++)I[m]=!1;while(-1!==h){A=[],w=y[h],T=w.vertexTriangles.length;for(var S=0;S<T;++S)if(c=w.vertexTriangles[S],!I[c]){I[c]=!0,l=c+c+c;for(var N=0;N<3;++N)g=r[l],A.push(g),E.push(g),x[D]=g,++D,b=y[g],--b.numLiveTriangles,C-b.timeStamp>o&&(b.timeStamp=C,++C),++l}h=u(r,o,A,y,C,E,d)}return x}},h={};function C(e,t,r,i,a){e[t++]=r,e[t++]=i,e[t++]=i,e[t++]=a,e[t++]=a,e[t]=r}function b(e){for(var t=e.length,r=t/3*6,i=p.IndexDatatype.createTypedArray(t,r),a=0,n=0;n<t;n+=3,a+=6)C(i,a,e[n],e[n+1],e[n+2]);return i}function w(e){var t=e.length;if(t>=3){var r=6*(t-2),i=p.IndexDatatype.createTypedArray(t,r);C(i,0,e[0],e[1],e[2]);for(var a=6,n=3;n<t;++n,a+=6)C(i,a,e[n-1],e[n],e[n-2]);return i}return new Uint16Array}function g(e){if(e.length>0){for(var t=e.length-1,r=6*(t-1),i=p.IndexDatatype.createTypedArray(t,r),a=e[0],n=0,o=1;o<t;++o,n+=6)C(i,n,a,e[o],e[o+1]);return i}return new Uint16Array}function T(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&a.defined(e[r])&&a.defined(e[r].values)){var i=e[r];t[r]=new u.GeometryAttribute({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]})}return t}function A(e,t,r){for(var i in t)if(t.hasOwnProperty(i)&&a.defined(t[i])&&a.defined(t[i].values))for(var n=t[i],o=0;o<n.componentsPerAttribute;++o)e[i].values.push(n.values[r*n.componentsPerAttribute+o])}h.toWireframe=function(e){if(!a.defined(e))throw new i.DeveloperError("geometry is required.");var t=e.indices;if(a.defined(t)){switch(e.primitiveType){case u.PrimitiveType.TRIANGLES:e.indices=b(t);break;case u.PrimitiveType.TRIANGLE_STRIP:e.indices=w(t);break;case u.PrimitiveType.TRIANGLE_FAN:e.indices=g(t);break;default:throw new i.DeveloperError("geometry.primitiveType must be TRIANGLES, TRIANGLE_STRIP, or TRIANGLE_FAN.")}e.primitiveType=u.PrimitiveType.LINES}return e},h.createLineSegmentsForVectors=function(e,t,r){if(t=a.defaultValue(t,"normal"),!a.defined(e))throw new i.DeveloperError("geometry is required.");if(!a.defined(e.attributes.position))throw new i.DeveloperError("geometry.attributes.position is required.");if(!a.defined(e.attributes[t]))throw new i.DeveloperError("geometry.attributes must have an attribute with the same name as the attributeName parameter, "+t+".");r=a.defaultValue(r,1e4);for(var s,p=e.attributes.position.values,d=e.attributes[t].values,l=p.length,v=new Float64Array(2*l),f=0,m=0;m<l;m+=3)v[f++]=p[m],v[f++]=p[m+1],v[f++]=p[m+2],v[f++]=p[m]+d[m]*r,v[f++]=p[m+1]+d[m+1]*r,v[f++]=p[m+2]+d[m+2]*r;var y=e.boundingSphere;return a.defined(y)&&(s=new o.BoundingSphere(y.center,y.radius+r)),new u.Geometry({attributes:{position:new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:v})},primitiveType:u.PrimitiveType.LINES,boundingSphere:s})},h.createAttributeLocations=function(e){if(!a.defined(e))throw new i.DeveloperError("geometry is required.");var t,r=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],n=e.attributes,o={},s=0,u=r.length;for(t=0;t<u;++t){var p=r[t];a.defined(n[p])&&(o[p]=s++)}for(var d in n)n.hasOwnProperty(d)&&!a.defined(o[d])&&(o[d]=s++);return o},h.reorderForPreVertexCache=function(e){if(!a.defined(e))throw new i.DeveloperError("geometry is required.");var t=u.Geometry.computeNumberOfVertices(e),r=e.indices;if(a.defined(r)){for(var o=new Int32Array(t),s=0;s<t;s++)o[s]=-1;var d,l=r,v=l.length,f=p.IndexDatatype.createTypedArray(t,v),m=0,y=0,c=0;while(m<v)d=o[l[m]],-1!==d?f[y]=d:(d=l[m],o[d]=c,f[y]=c,++c),++m,++y;e.indices=f;var h=e.attributes;for(var C in h)if(h.hasOwnProperty(C)&&a.defined(h[C])&&a.defined(h[C].values)){var b=h[C],w=b.values,g=0,T=b.componentsPerAttribute,A=n.ComponentDatatype.createTypedArray(b.componentDatatype,c*T);while(g<t){var E=o[g];if(-1!==E)for(var D=0;D<T;D++)A[T*E+D]=w[T*g+D];++g}b.values=A}}return e},h.reorderForPostVertexCache=function(e,t){if(!a.defined(e))throw new i.DeveloperError("geometry is required.");var r=e.indices;if(e.primitiveType===u.PrimitiveType.TRIANGLES&&a.defined(r)){for(var n=r.length,o=0,s=0;s<n;s++)r[s]>o&&(o=r[s]);e.indices=c.tipsify({indices:r,maximumIndex:o,cacheSize:t})}return e},h.fitToUnsignedShortIndices=function(e){if(!a.defined(e))throw new i.DeveloperError("geometry is required.");if(a.defined(e.indices)&&e.primitiveType!==u.PrimitiveType.TRIANGLES&&e.primitiveType!==u.PrimitiveType.LINES&&e.primitiveType!==u.PrimitiveType.POINTS)throw new i.DeveloperError("geometry.primitiveType must equal to PrimitiveType.TRIANGLES, PrimitiveType.LINES, or PrimitiveType.POINTS.");var t=[],r=u.Geometry.computeNumberOfVertices(e);if(a.defined(e.indices)&&r>=n.CesiumMath.SIXTY_FOUR_KILOBYTES){var o,s=[],p=[],d=0,l=T(e.attributes),v=e.indices,f=v.length;e.primitiveType===u.PrimitiveType.TRIANGLES?o=3:e.primitiveType===u.PrimitiveType.LINES?o=2:e.primitiveType===u.PrimitiveType.POINTS&&(o=1);for(var m=0;m<f;m+=o){for(var y=0;y<o;++y){var c=v[m+y],h=s[c];a.defined(h)||(h=d++,s[c]=h,A(l,e.attributes,c)),p.push(h)}d+o>=n.CesiumMath.SIXTY_FOUR_KILOBYTES&&(t.push(new u.Geometry({attributes:l,indices:p,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),s=[],p=[],d=0,l=T(e.attributes))}0!==p.length&&t.push(new u.Geometry({attributes:l,indices:p,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var E=new r.Cartesian3,D=new r.Cartographic;h.projectTo2D=function(e,t,s,p,d){if(!a.defined(e))throw new i.DeveloperError("geometry is required.");if(!a.defined(t))throw new i.DeveloperError("attributeName is required.");if(!a.defined(s))throw new i.DeveloperError("attributeName3D is required.");if(!a.defined(p))throw new i.DeveloperError("attributeName2D is required.");if(!a.defined(e.attributes[t]))throw new i.DeveloperError("geometry must have attribute matching the attributeName argument: "+t+".");if(e.attributes[t].componentDatatype!==n.ComponentDatatype.DOUBLE)throw new i.DeveloperError("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");var l=e.attributes[t];d=a.defined(d)?d:new o.GeographicProjection;for(var v=d.ellipsoid,f=l.values,m=new Float64Array(f.length),y=0,c=0;c<f.length;c+=3){var h=r.Cartesian3.fromArray(f,c,E),C=v.cartesianToCartographic(h,D);if(!a.defined(C))throw new i.DeveloperError("Could not project point ("+h.x+", "+h.y+", "+h.z+") to 2D.");var b=d.project(C,E);m[y++]=b.x,m[y++]=b.y,m[y++]=b.z}return e.attributes[s]=l,e.attributes[p]=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:m}),delete e.attributes[t],e};var x={high:0,low:0};h.encodeAttribute=function(e,t,r,o){if(!a.defined(e))throw new i.DeveloperError("geometry is required.");if(!a.defined(t))throw new i.DeveloperError("attributeName is required.");if(!a.defined(r))throw new i.DeveloperError("attributeHighName is required.");if(!a.defined(o))throw new i.DeveloperError("attributeLowName is required.");if(!a.defined(e.attributes[t]))throw new i.DeveloperError("geometry must have attribute matching the attributeName argument: "+t+".");if(e.attributes[t].componentDatatype!==n.ComponentDatatype.DOUBLE)throw new i.DeveloperError("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");for(var p=e.attributes[t],d=p.values,l=d.length,v=new Float32Array(l),f=new Float32Array(l),m=0;m<l;++m)s.EncodedCartesian3.encode(d[m],x),v[m]=x.high,f[m]=x.low;var y=p.componentsPerAttribute;return e.attributes[r]=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:y,values:v}),e.attributes[o]=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:y,values:f}),delete e.attributes[t],e};var P=new r.Cartesian3;function I(e,t){if(a.defined(t))for(var i=t.values,n=i.length,o=0;o<n;o+=3)r.Cartesian3.unpack(i,o,P),r.Matrix4.multiplyByPoint(e,P,P),r.Cartesian3.pack(P,i,o)}function S(e,t){if(a.defined(t))for(var i=t.values,n=i.length,o=0;o<n;o+=3)r.Cartesian3.unpack(i,o,P),r.Matrix3.multiplyByVector(e,P,P),P=r.Cartesian3.normalize(P,P),r.Cartesian3.pack(P,i,o)}var N=new r.Matrix4,O=new r.Matrix3;function L(e,t){var r,i=e.length,o={},s=e[0][t].attributes;for(r in s)if(s.hasOwnProperty(r)&&a.defined(s[r])&&a.defined(s[r].values)){for(var p=s[r],d=p.values.length,l=!0,v=1;v<i;++v){var f=e[v][t].attributes[r];if(!a.defined(f)||p.componentDatatype!==f.componentDatatype||p.componentsPerAttribute!==f.componentsPerAttribute||p.normalize!==f.normalize){l=!1;break}d+=f.values.length}l&&(o[r]=new u.GeometryAttribute({componentDatatype:p.componentDatatype,componentsPerAttribute:p.componentsPerAttribute,normalize:p.normalize,values:n.ComponentDatatype.createTypedArray(p.componentDatatype,d)}))}return o}h.transformToWorldCoordinates=function(e){if(!a.defined(e))throw new i.DeveloperError("instance is required.");var t=e.modelMatrix;if(r.Matrix4.equals(t,r.Matrix4.IDENTITY))return e;var n=e.geometry.attributes;I(t,n.position),I(t,n.prevPosition),I(t,n.nextPosition),(a.defined(n.normal)||a.defined(n.tangent)||a.defined(n.bitangent))&&(r.Matrix4.inverse(t,N),r.Matrix4.transpose(N,N),r.Matrix4.getMatrix3(N,O),S(O,n.normal),S(O,n.tangent),S(O,n.bitangent));var s=e.geometry.boundingSphere;return a.defined(s)&&(e.geometry.boundingSphere=o.BoundingSphere.transform(s,t,s)),e.modelMatrix=r.Matrix4.clone(r.Matrix4.IDENTITY),e};var z=new r.Cartesian3;function G(e,t){var n,s,d,l,v=e.length,f=e[0].modelMatrix,m=a.defined(e[0][t].indices),y=e[0][t].primitiveType;for(s=1;s<v;++s){if(!r.Matrix4.equals(e[s].modelMatrix,f))throw new i.DeveloperError("All instances must have the same modelMatrix.");if(a.defined(e[s][t].indices)!==m)throw new i.DeveloperError("All instance geometries must have an indices or not have one.");if(e[s][t].primitiveType!==y)throw new i.DeveloperError("All instance geometries must have the same primitiveType.")}var c,h,C,b,w=L(e,t);for(n in w)if(w.hasOwnProperty(n))for(c=w[n].values,l=0,s=0;s<v;++s)for(h=e[s][t].attributes[n].values,C=h.length,d=0;d<C;++d)c[l++]=h[d];if(m){var g=0;for(s=0;s<v;++s)g+=e[s][t].indices.length;var T=u.Geometry.computeNumberOfVertices(new u.Geometry({attributes:w,primitiveType:u.PrimitiveType.POINTS})),A=p.IndexDatatype.createTypedArray(T,g),E=0,D=0;for(s=0;s<v;++s){var x=e[s][t].indices,P=x.length;for(l=0;l<P;++l)A[E++]=D+x[l];D+=u.Geometry.computeNumberOfVertices(e[s][t])}b=A}var I,S=new r.Cartesian3,N=0;for(s=0;s<v;++s){if(I=e[s][t].boundingSphere,!a.defined(I)){S=void 0;break}r.Cartesian3.add(I.center,S,S)}if(a.defined(S))for(r.Cartesian3.divideByScalar(S,v,S),s=0;s<v;++s){I=e[s][t].boundingSphere;var O=r.Cartesian3.magnitude(r.Cartesian3.subtract(I.center,S,z))+I.radius;O>N&&(N=O)}return new u.Geometry({attributes:w,indices:b,primitiveType:y,boundingSphere:a.defined(S)?new o.BoundingSphere(S,N):void 0})}h.combineInstances=function(e){if(!a.defined(e)||e.length<1)throw new i.DeveloperError("instances is required and must have length greater than zero.");for(var t=[],r=[],n=e.length,o=0;o<n;++o){var s=e[o];a.defined(s.geometry)?t.push(s):a.defined(s.westHemisphereGeometry)&&a.defined(s.eastHemisphereGeometry)&&r.push(s)}var u=[];return t.length>0&&u.push(G(t,"geometry")),r.length>0&&(u.push(G(r,"westHemisphereGeometry")),u.push(G(r,"eastHemisphereGeometry"))),u};var M=new r.Cartesian3,q=new r.Cartesian3,R=new r.Cartesian3,B=new r.Cartesian3;h.computeNormal=function(e){if(!a.defined(e))throw new i.DeveloperError("geometry is required.");if(!a.defined(e.attributes.position)||!a.defined(e.attributes.position.values))throw new i.DeveloperError("geometry.attributes.position.values is required.");if(!a.defined(e.indices))throw new i.DeveloperError("geometry.indices is required.");if(e.indices.length<2||e.indices.length%3!==0)throw new i.DeveloperError("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==u.PrimitiveType.TRIANGLES)throw new i.DeveloperError("geometry.primitiveType must be PrimitiveType.TRIANGLES.");var t,o=e.indices,s=e.attributes,p=s.position.values,d=s.position.values.length/3,l=o.length,v=new Array(d),f=new Array(l/3),m=new Array(l);for(t=0;t<d;t++)v[t]={indexOffset:0,count:0,currentCount:0};var y=0;for(t=0;t<l;t+=3){var c=o[t],h=o[t+1],C=o[t+2],b=3*c,w=3*h,g=3*C;q.x=p[b],q.y=p[b+1],q.z=p[b+2],R.x=p[w],R.y=p[w+1],R.z=p[w+2],B.x=p[g],B.y=p[g+1],B.z=p[g+2],v[c].count++,v[h].count++,v[C].count++,r.Cartesian3.subtract(R,q,R),r.Cartesian3.subtract(B,q,B),f[y]=r.Cartesian3.cross(R,B,new r.Cartesian3),y++}var T,A=0;for(t=0;t<d;t++)v[t].indexOffset+=A,A+=v[t].count;for(y=0,t=0;t<l;t+=3){T=v[o[t]];var E=T.indexOffset+T.currentCount;m[E]=y,T.currentCount++,T=v[o[t+1]],E=T.indexOffset+T.currentCount,m[E]=y,T.currentCount++,T=v[o[t+2]],E=T.indexOffset+T.currentCount,m[E]=y,T.currentCount++,y++}var D=new Float32Array(3*d);for(t=0;t<d;t++){var x=3*t;if(T=v[t],r.Cartesian3.clone(r.Cartesian3.ZERO,M),T.count>0){for(y=0;y<T.count;y++)r.Cartesian3.add(M,f[m[T.indexOffset+y]],M);r.Cartesian3.equalsEpsilon(r.Cartesian3.ZERO,M,n.CesiumMath.EPSILON10)&&r.Cartesian3.clone(f[m[T.indexOffset]],M)}r.Cartesian3.equalsEpsilon(r.Cartesian3.ZERO,M,n.CesiumMath.EPSILON10)&&(M.z=1),r.Cartesian3.normalize(M,M),D[x]=M.x,D[x+1]=M.y,D[x+2]=M.z}return e.attributes.normal=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:D}),e};var V=new r.Cartesian3,k=new r.Cartesian3,F=new r.Cartesian3;h.computeTangentAndBitangent=function(e){if(!a.defined(e))throw new i.DeveloperError("geometry is required.");var t=e.attributes,o=e.indices;if(!a.defined(t.position)||!a.defined(t.position.values))throw new i.DeveloperError("geometry.attributes.position.values is required.");if(!a.defined(t.normal)||!a.defined(t.normal.values))throw new i.DeveloperError("geometry.attributes.normal.values is required.");if(!a.defined(t.st)||!a.defined(t.st.values))throw new i.DeveloperError("geometry.attributes.st.values is required.");if(!a.defined(o))throw new i.DeveloperError("geometry.indices is required.");if(o.length<2||o.length%3!==0)throw new i.DeveloperError("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==u.PrimitiveType.TRIANGLES)throw new i.DeveloperError("geometry.primitiveType must be PrimitiveType.TRIANGLES.");var s,p,d,l,v=e.attributes.position.values,f=e.attributes.normal.values,m=e.attributes.st.values,y=e.attributes.position.values.length/3,c=o.length,h=new Array(3*y);for(s=0;s<h.length;s++)h[s]=0;for(s=0;s<c;s+=3){var C=o[s],b=o[s+1],w=o[s+2];p=3*C,d=3*b,l=3*w;var g=2*C,T=2*b,A=2*w,E=v[p],D=v[p+1],x=v[p+2],P=m[g],I=m[g+1],S=m[T+1]-I,N=m[A+1]-I,O=1/((m[T]-P)*N-(m[A]-P)*S),L=(N*(v[d]-E)-S*(v[l]-E))*O,z=(N*(v[d+1]-D)-S*(v[l+1]-D))*O,G=(N*(v[d+2]-x)-S*(v[l+2]-x))*O;h[p]+=L,h[p+1]+=z,h[p+2]+=G,h[d]+=L,h[d+1]+=z,h[d+2]+=G,h[l]+=L,h[l+1]+=z,h[l+2]+=G}var M=new Float32Array(3*y),q=new Float32Array(3*y);for(s=0;s<y;s++){p=3*s,d=p+1,l=p+2;var R=r.Cartesian3.fromArray(f,p,V),B=r.Cartesian3.fromArray(h,p,F),_=r.Cartesian3.dot(R,B);r.Cartesian3.multiplyByScalar(R,_,k),r.Cartesian3.normalize(r.Cartesian3.subtract(B,k,B),B),M[p]=B.x,M[d]=B.y,M[l]=B.z,r.Cartesian3.normalize(r.Cartesian3.cross(R,B,B),B),q[p]=B.x,q[d]=B.y,q[l]=B.z}return e.attributes.tangent=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:M}),e.attributes.bitangent=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:q}),e};var _=new r.Cartesian2,U=new r.Cartesian3,Y=new r.Cartesian3,Z=new r.Cartesian3,H=new r.Cartesian2;function W(e){if(a.defined(e.indices))return e;var t=u.Geometry.computeNumberOfVertices(e);if(t<3)throw new i.DeveloperError("The number of vertices must be at least three.");if(t%3!==0)throw new i.DeveloperError("The number of vertices must be a multiple of three.");for(var r=p.IndexDatatype.createTypedArray(t,t),n=0;n<t;++n)r[n]=n;return e.indices=r,e}function X(e){var t=u.Geometry.computeNumberOfVertices(e);if(t<3)throw new i.DeveloperError("The number of vertices must be at least three.");var r=p.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var a=3,n=3;n<t;++n)r[a++]=n-1,r[a++]=0,r[a++]=n;return e.indices=r,e.primitiveType=u.PrimitiveType.TRIANGLES,e}function j(e){var t=u.Geometry.computeNumberOfVertices(e);if(t<3)throw new i.DeveloperError("The number of vertices must be at least 3.");var r=p.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,t>3&&(r[3]=0,r[4]=2,r[5]=3);for(var a=6,n=3;n<t-1;n+=2)r[a++]=n,r[a++]=n-1,r[a++]=n+1,n+2<t&&(r[a++]=n,r[a++]=n+1,r[a++]=n+2);return e.indices=r,e.primitiveType=u.PrimitiveType.TRIANGLES,e}function J(e){if(a.defined(e.indices))return e;var t=u.Geometry.computeNumberOfVertices(e);if(t<2)throw new i.DeveloperError("The number of vertices must be at least two.");if(t%2!==0)throw new i.DeveloperError("The number of vertices must be a multiple of 2.");for(var r=p.IndexDatatype.createTypedArray(t,t),n=0;n<t;++n)r[n]=n;return e.indices=r,e}function K(e){var t=u.Geometry.computeNumberOfVertices(e);if(t<2)throw new i.DeveloperError("The number of vertices must be at least two.");var r=p.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var a=2,n=2;n<t;++n)r[a++]=n-1,r[a++]=n;return e.indices=r,e.primitiveType=u.PrimitiveType.LINES,e}function Q(e){var t=u.Geometry.computeNumberOfVertices(e);if(t<2)throw new i.DeveloperError("The number of vertices must be at least two.");var r=p.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var a=2,n=2;n<t;++n)r[a++]=n-1,r[a++]=n;return r[a++]=t-1,r[a]=0,e.indices=r,e.primitiveType=u.PrimitiveType.LINES,e}function $(e){switch(e.primitiveType){case u.PrimitiveType.TRIANGLE_FAN:return X(e);case u.PrimitiveType.TRIANGLE_STRIP:return j(e);case u.PrimitiveType.TRIANGLES:return W(e);case u.PrimitiveType.LINE_STRIP:return K(e);case u.PrimitiveType.LINE_LOOP:return Q(e);case u.PrimitiveType.LINES:return J(e)}return e}function ee(e,t){Math.abs(e.y)<n.CesiumMath.EPSILON6&&(e.y=t?-n.CesiumMath.EPSILON6:n.CesiumMath.EPSILON6)}function te(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return ee(e,e.y<0),ee(t,t.y<0),void ee(r,r.y<0);var i,a=Math.abs(e.y),o=Math.abs(t.y),s=Math.abs(r.y);i=a>o?a>s?n.CesiumMath.sign(e.y):n.CesiumMath.sign(r.y):o>s?n.CesiumMath.sign(t.y):n.CesiumMath.sign(r.y);var u=i<0;ee(e,u),ee(t,u),ee(r,u)}h.compressVertices=function(e){if(!a.defined(e))throw new i.DeveloperError("geometry is required.");var o,s,p=e.attributes.extrudeDirection;if(a.defined(p)){var d=p.values;s=d.length/3;var l=new Float32Array(2*s),v=0;for(o=0;o<s;++o)r.Cartesian3.fromArray(d,3*o,U),r.Cartesian3.equals(U,r.Cartesian3.ZERO)?v+=2:(H=t.AttributeCompression.octEncodeInRange(U,65535,H),l[v++]=H.x,l[v++]=H.y);return e.attributes.compressedAttributes=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:l}),delete e.attributes.extrudeDirection,e}var f=e.attributes.normal,m=e.attributes.st,y=a.defined(f),c=a.defined(m);if(!y&&!c)return e;var h,C,b,w,g=e.attributes.tangent,T=e.attributes.bitangent,A=a.defined(g),E=a.defined(T);y&&(h=f.values),c&&(C=m.values),A&&(b=g.values),E&&(w=T.values);var D=y?h.length:C.length,x=y?3:2;s=D/x;var P=s,I=c&&y?2:1;I+=A||E?1:0,P*=I;var S=new Float32Array(P),N=0;for(o=0;o<s;++o){c&&(r.Cartesian2.fromArray(C,2*o,_),S[N++]=t.AttributeCompression.compressTextureCoordinates(_));var O=3*o;y&&a.defined(b)&&a.defined(w)?(r.Cartesian3.fromArray(h,O,U),r.Cartesian3.fromArray(b,O,Y),r.Cartesian3.fromArray(w,O,Z),t.AttributeCompression.octPack(U,Y,Z,_),S[N++]=_.x,S[N++]=_.y):(y&&(r.Cartesian3.fromArray(h,O,U),S[N++]=t.AttributeCompression.octEncodeFloat(U)),A&&(r.Cartesian3.fromArray(b,O,U),S[N++]=t.AttributeCompression.octEncodeFloat(U)),E&&(r.Cartesian3.fromArray(w,O,U),S[N++]=t.AttributeCompression.octEncodeFloat(U)))}return e.attributes.compressedAttributes=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:I,values:S}),y&&delete e.attributes.normal,c&&delete e.attributes.st,E&&delete e.attributes.bitangent,A&&delete e.attributes.tangent,e};var re=new r.Cartesian3;function ie(e,t,i,a){r.Cartesian3.add(e,r.Cartesian3.multiplyByScalar(r.Cartesian3.subtract(t,e,re),e.y/(e.y-t.y),re),i),r.Cartesian3.clone(i,a),ee(i,!0),ee(a,!1)}var ae=new r.Cartesian3,ne=new r.Cartesian3,oe=new r.Cartesian3,se=new r.Cartesian3,ue={positions:new Array(7),indices:new Array(9)};function pe(e,t,r){if(!(e.x>=0||t.x>=0||r.x>=0)){te(e,t,r);var i=e.y<0,a=t.y<0,n=r.y<0,o=0;o+=i?1:0,o+=a?1:0,o+=n?1:0;var s=ue.indices;1===o?(s[1]=3,s[2]=4,s[5]=6,s[7]=6,s[8]=5,i?(ie(e,t,ae,oe),ie(e,r,ne,se),s[0]=0,s[3]=1,s[4]=2,s[6]=1):a?(ie(t,r,ae,oe),ie(t,e,ne,se),s[0]=1,s[3]=2,s[4]=0,s[6]=2):n&&(ie(r,e,ae,oe),ie(r,t,ne,se),s[0]=2,s[3]=0,s[4]=1,s[6]=0)):2===o&&(s[2]=4,s[4]=4,s[5]=3,s[7]=5,s[8]=6,i?a?n||(ie(r,e,ae,oe),ie(r,t,ne,se),s[0]=0,s[1]=1,s[3]=0,s[6]=2):(ie(t,r,ae,oe),ie(t,e,ne,se),s[0]=2,s[1]=0,s[3]=2,s[6]=1):(ie(e,t,ae,oe),ie(e,r,ne,se),s[0]=1,s[1]=2,s[3]=1,s[6]=0));var u=ue.positions;return u[0]=e,u[1]=t,u[2]=r,u.length=3,1!==o&&2!==o||(u[3]=ae,u[4]=ne,u[5]=oe,u[6]=se,u.length=7),ue}}function de(e,t){var r=e.attributes;if(0!==r.position.values.length){for(var i in r)if(r.hasOwnProperty(i)&&a.defined(r[i])&&a.defined(r[i].values)){var s=r[i];s.values=n.ComponentDatatype.createTypedArray(s.componentDatatype,s.values)}var d=u.Geometry.computeNumberOfVertices(e);return e.indices=p.IndexDatatype.createTypedArray(d,e.indices),t&&(e.boundingSphere=o.BoundingSphere.fromVertices(r.position.values)),e}}function le(e){var t=e.attributes,r={};for(var i in t)if(t.hasOwnProperty(i)&&a.defined(t[i])&&a.defined(t[i].values)){var n=t[i];r[i]=new u.GeometryAttribute({componentDatatype:n.componentDatatype,componentsPerAttribute:n.componentsPerAttribute,normalize:n.normalize,values:[]})}return new u.Geometry({attributes:r,indices:[],primitiveType:e.primitiveType})}function ve(e,t,r){var i=a.defined(e.geometry.boundingSphere);t=de(t,i),r=de(r,i),a.defined(r)&&!a.defined(t)?e.geometry=r:!a.defined(r)&&a.defined(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=r,e.geometry=void 0)}function fe(e,t){var r=new e,i=new e,a=new e;return function(n,o,s,u,p,d,l,v){var f=e.fromArray(p,n*t,r),m=e.fromArray(p,o*t,i),y=e.fromArray(p,s*t,a);e.multiplyByScalar(f,u.x,f),e.multiplyByScalar(m,u.y,m),e.multiplyByScalar(y,u.z,y);var c=e.add(f,m,f);e.add(c,y,c),v&&e.normalize(c,c),e.pack(c,d,l*t)}}var me=fe(r.Cartesian4,4),ye=fe(r.Cartesian3,3),ce=fe(r.Cartesian2,2),he=function(e,t,r,i,a,o,s){var u=a[e]*i.x,p=a[t]*i.y,d=a[r]*i.z;o[s]=u+p+d>n.CesiumMath.EPSILON6?1:0},Ce=new r.Cartesian3,be=new r.Cartesian3,we=new r.Cartesian3,ge=new r.Cartesian3;function Te(e,t,i,n,o,s,u,p,d,l,v,f,m,c,h,C){if(a.defined(s)||a.defined(u)||a.defined(p)||a.defined(d)||a.defined(l)||0!==c){var b=r.Cartesian3.fromArray(o,3*e,Ce),w=r.Cartesian3.fromArray(o,3*t,be),g=r.Cartesian3.fromArray(o,3*i,we),T=y(n,b,w,g,ge);if(a.defined(s)&&ye(e,t,i,T,s,f.normal.values,C,!0),a.defined(l)){var A,E=r.Cartesian3.fromArray(l,3*e,Ce),D=r.Cartesian3.fromArray(l,3*t,be),x=r.Cartesian3.fromArray(l,3*i,we);r.Cartesian3.multiplyByScalar(E,T.x,E),r.Cartesian3.multiplyByScalar(D,T.y,D),r.Cartesian3.multiplyByScalar(x,T.z,x),r.Cartesian3.equals(E,r.Cartesian3.ZERO)&&r.Cartesian3.equals(D,r.Cartesian3.ZERO)&&r.Cartesian3.equals(x,r.Cartesian3.ZERO)?(A=Ce,A.x=0,A.y=0,A.z=0):(A=r.Cartesian3.add(E,D,E),r.Cartesian3.add(A,x,A),r.Cartesian3.normalize(A,A)),r.Cartesian3.pack(A,f.extrudeDirection.values,3*C)}if(a.defined(v)&&he(e,t,i,T,v,f.applyOffset.values,C),a.defined(u)&&ye(e,t,i,T,u,f.tangent.values,C,!0),a.defined(p)&&ye(e,t,i,T,p,f.bitangent.values,C,!0),a.defined(d)&&ce(e,t,i,T,d,f.st.values,C),c>0)for(var P=0;P<c;P++){var I=m[P];Ae(e,t,i,T,C,h[I],f[I])}}}function Ae(e,t,r,i,a,n,o){var s=n.componentsPerAttribute,u=n.values,p=o.values;switch(s){case 4:me(e,t,r,i,u,p,a,!1);break;case 3:ye(e,t,r,i,u,p,a,!1);break;case 2:ce(e,t,r,i,u,p,a,!1);break;default:p[a]=u[e]*i.x+u[t]*i.y+u[r]*i.z}}function Ee(e,t,r,i,a,n){var o=e.position.values.length/3;if(-1!==a){var s=i[a],u=r[s];return-1===u?(r[s]=o,e.position.values.push(n.x,n.y,n.z),t.push(o),o):(t.push(u),u)}return e.position.values.push(n.x,n.y,n.z),t.push(o),o}var De={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function xe(e){var t=e.geometry,i=t.attributes,n=i.position.values,o=a.defined(i.normal)?i.normal.values:void 0,s=a.defined(i.bitangent)?i.bitangent.values:void 0,u=a.defined(i.tangent)?i.tangent.values:void 0,p=a.defined(i.st)?i.st.values:void 0,d=a.defined(i.extrudeDirection)?i.extrudeDirection.values:void 0,l=a.defined(i.applyOffset)?i.applyOffset.values:void 0,v=t.indices,f=[];for(var m in i)i.hasOwnProperty(m)&&!De[m]&&a.defined(i[m])&&f.push(m);var y,c,h,C,b,w=f.length,g=le(t),T=le(t),A=[];A.length=n.length/3;var E=[];for(E.length=n.length/3,b=0;b<A.length;++b)A[b]=-1,E[b]=-1;var D=v.length;for(b=0;b<D;b+=3){var x=v[b],P=v[b+1],I=v[b+2],S=r.Cartesian3.fromArray(n,3*x),N=r.Cartesian3.fromArray(n,3*P),O=r.Cartesian3.fromArray(n,3*I),L=pe(S,N,O);if(a.defined(L)&&L.positions.length>3)for(var z=L.positions,G=L.indices,M=G.length,q=0;q<M;++q){var R=G[q],B=z[R];B.y<0?(y=T.attributes,c=T.indices,h=A):(y=g.attributes,c=g.indices,h=E),C=Ee(y,c,h,v,R<3?b+R:-1,B),Te(x,P,I,B,n,o,u,s,p,d,l,y,f,w,i,C)}else a.defined(L)&&(S=L.positions[0],N=L.positions[1],O=L.positions[2]),S.y<0?(y=T.attributes,c=T.indices,h=A):(y=g.attributes,c=g.indices,h=E),C=Ee(y,c,h,v,b,S),Te(x,P,I,S,n,o,u,s,p,d,l,y,f,w,i,C),C=Ee(y,c,h,v,b+1,N),Te(x,P,I,N,n,o,u,s,p,d,l,y,f,w,i,C),C=Ee(y,c,h,v,b+2,O),Te(x,P,I,O,n,o,u,s,p,d,l,y,f,w,i,C)}ve(e,T,g)}var Pe=l.Plane.fromPointNormal(r.Cartesian3.ZERO,r.Cartesian3.UNIT_Y),Ie=new r.Cartesian3,Se=new r.Cartesian3;function Ne(e,t,i,o,s,u,p){if(a.defined(p)){var d=r.Cartesian3.fromArray(o,3*e,Ce);r.Cartesian3.equalsEpsilon(d,i,n.CesiumMath.EPSILON10)?u.applyOffset.values[s]=p[e]:u.applyOffset.values[s]=p[t]}}function Oe(e){var t,i=e.geometry,o=i.attributes,s=o.position.values,u=a.defined(o.applyOffset)?o.applyOffset.values:void 0,p=i.indices,l=le(i),v=le(i),f=p.length,m=[];m.length=s.length/3;var y=[];for(y.length=s.length/3,t=0;t<m.length;++t)m[t]=-1,y[t]=-1;for(t=0;t<f;t+=2){var c,h=p[t],C=p[t+1],b=r.Cartesian3.fromArray(s,3*h,Ce),w=r.Cartesian3.fromArray(s,3*C,be);Math.abs(b.y)<n.CesiumMath.EPSILON6&&(b.y<0?b.y=-n.CesiumMath.EPSILON6:b.y=n.CesiumMath.EPSILON6),Math.abs(w.y)<n.CesiumMath.EPSILON6&&(w.y<0?w.y=-n.CesiumMath.EPSILON6:w.y=n.CesiumMath.EPSILON6);var g=l.attributes,T=l.indices,A=y,E=v.attributes,D=v.indices,x=m,P=d.IntersectionTests.lineSegmentPlane(b,w,Pe,we);if(a.defined(P)){var I=r.Cartesian3.multiplyByScalar(r.Cartesian3.UNIT_Y,5*n.CesiumMath.EPSILON9,Ie);b.y<0&&(r.Cartesian3.negate(I,I),g=v.attributes,T=v.indices,A=m,E=l.attributes,D=l.indices,x=y);var S=r.Cartesian3.add(P,I,Se);c=Ee(g,T,A,p,t,b),Ne(h,C,b,s,c,g,u),c=Ee(g,T,A,p,-1,S),Ne(h,C,S,s,c,g,u),r.Cartesian3.negate(I,I),r.Cartesian3.add(P,I,S),c=Ee(E,D,x,p,-1,S),Ne(h,C,S,s,c,E,u),c=Ee(E,D,x,p,t+1,w),Ne(h,C,w,s,c,E,u)}else{var N,O,L;b.y<0?(N=v.attributes,O=v.indices,L=m):(N=l.attributes,O=l.indices,L=y),c=Ee(N,O,L,p,t,b),Ne(h,C,b,s,c,N,u),c=Ee(N,O,L,p,t+1,w),Ne(h,C,w,s,c,N,u)}}ve(e,v,l)}var Le=new r.Cartesian2,ze=new r.Cartesian2,Ge=new r.Cartesian3,Me=new r.Cartesian3,qe=new r.Cartesian3,Re=new r.Cartesian3,Be=new r.Cartesian3,Ve=new r.Cartesian3,ke=new r.Cartesian4;function Fe(e){for(var t=e.attributes,i=t.position.values,a=t.prevPosition.values,n=t.nextPosition.values,o=i.length,s=0;s<o;s+=3){var u=r.Cartesian3.unpack(i,s,Ge);if(!(u.x>0)){var p=r.Cartesian3.unpack(a,s,Me);(u.y<0&&p.y>0||u.y>0&&p.y<0)&&(s-3>0?(a[s]=i[s-3],a[s+1]=i[s-2],a[s+2]=i[s-1]):r.Cartesian3.pack(u,a,s));var d=r.Cartesian3.unpack(n,s,qe);(u.y<0&&d.y>0||u.y>0&&d.y<0)&&(s+3<o?(n[s]=i[s+3],n[s+1]=i[s+4],n[s+2]=i[s+5]):r.Cartesian3.pack(u,n,s))}}}var _e=5*n.CesiumMath.EPSILON9,Ue=n.CesiumMath.EPSILON6;function Ye(e){var t,i,o,s=e.geometry,u=s.attributes,p=u.position.values,l=u.prevPosition.values,v=u.nextPosition.values,f=u.expandAndWidth.values,m=a.defined(u.st)?u.st.values:void 0,y=a.defined(u.color)?u.color.values:void 0,c=le(s),h=le(s),C=!1,b=p.length/3;for(t=0;t<b;t+=4){var w=t,g=t+2,T=r.Cartesian3.fromArray(p,3*w,Ge),A=r.Cartesian3.fromArray(p,3*g,Me);if(Math.abs(T.y)<Ue)for(T.y=Ue*(A.y<0?-1:1),p[3*t+1]=T.y,p[3*(t+1)+1]=T.y,i=3*w;i<3*w+12;i+=3)l[i]=p[3*t],l[i+1]=p[3*t+1],l[i+2]=p[3*t+2];if(Math.abs(A.y)<Ue)for(A.y=Ue*(T.y<0?-1:1),p[3*(t+2)+1]=A.y,p[3*(t+3)+1]=A.y,i=3*w;i<3*w+12;i+=3)v[i]=p[3*(t+2)],v[i+1]=p[3*(t+2)+1],v[i+2]=p[3*(t+2)+2];var E=c.attributes,D=c.indices,x=h.attributes,P=h.indices,I=d.IntersectionTests.lineSegmentPlane(T,A,Pe,Re);if(a.defined(I)){C=!0;var S=r.Cartesian3.multiplyByScalar(r.Cartesian3.UNIT_Y,_e,Be);T.y<0&&(r.Cartesian3.negate(S,S),E=h.attributes,D=h.indices,x=c.attributes,P=c.indices);var N=r.Cartesian3.add(I,S,Ve);E.position.values.push(T.x,T.y,T.z,T.x,T.y,T.z),E.position.values.push(N.x,N.y,N.z),E.position.values.push(N.x,N.y,N.z),E.prevPosition.values.push(l[3*w],l[3*w+1],l[3*w+2]),E.prevPosition.values.push(l[3*w+3],l[3*w+4],l[3*w+5]),E.prevPosition.values.push(T.x,T.y,T.z,T.x,T.y,T.z),E.nextPosition.values.push(N.x,N.y,N.z),E.nextPosition.values.push(N.x,N.y,N.z),E.nextPosition.values.push(N.x,N.y,N.z),E.nextPosition.values.push(N.x,N.y,N.z),r.Cartesian3.negate(S,S),r.Cartesian3.add(I,S,N),x.position.values.push(N.x,N.y,N.z),x.position.values.push(N.x,N.y,N.z),x.position.values.push(A.x,A.y,A.z,A.x,A.y,A.z),x.prevPosition.values.push(N.x,N.y,N.z),x.prevPosition.values.push(N.x,N.y,N.z),x.prevPosition.values.push(N.x,N.y,N.z),x.prevPosition.values.push(N.x,N.y,N.z),x.nextPosition.values.push(A.x,A.y,A.z,A.x,A.y,A.z),x.nextPosition.values.push(v[3*g],v[3*g+1],v[3*g+2]),x.nextPosition.values.push(v[3*g+3],v[3*g+4],v[3*g+5]);var O=r.Cartesian2.fromArray(f,2*w,Le),L=Math.abs(O.y);E.expandAndWidth.values.push(-1,L,1,L),E.expandAndWidth.values.push(-1,-L,1,-L),x.expandAndWidth.values.push(-1,L,1,L),x.expandAndWidth.values.push(-1,-L,1,-L);var z=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(I,T,qe));if(z/=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(A,T,qe)),a.defined(y)){var G=r.Cartesian4.fromArray(y,4*w,ke),M=r.Cartesian4.fromArray(y,4*g,ke),q=n.CesiumMath.lerp(G.x,M.x,z),R=n.CesiumMath.lerp(G.y,M.y,z),B=n.CesiumMath.lerp(G.z,M.z,z),V=n.CesiumMath.lerp(G.w,M.w,z);for(i=4*w;i<4*w+8;++i)E.color.values.push(y[i]);for(E.color.values.push(q,R,B,V),E.color.values.push(q,R,B,V),x.color.values.push(q,R,B,V),x.color.values.push(q,R,B,V),i=4*g;i<4*g+8;++i)x.color.values.push(y[i])}if(a.defined(m)){var k=r.Cartesian2.fromArray(m,2*w,Le),F=r.Cartesian2.fromArray(m,2*(t+3),ze),_=n.CesiumMath.lerp(k.x,F.x,z);for(i=2*w;i<2*w+4;++i)E.st.values.push(m[i]);for(E.st.values.push(_,k.y),E.st.values.push(_,F.y),x.st.values.push(_,k.y),x.st.values.push(_,F.y),i=2*g;i<2*g+4;++i)x.st.values.push(m[i])}o=E.position.values.length/3-4,D.push(o,o+2,o+1),D.push(o+1,o+2,o+3),o=x.position.values.length/3-4,P.push(o,o+2,o+1),P.push(o+1,o+2,o+3)}else{var U,Y;for(T.y<0?(U=h.attributes,Y=h.indices):(U=c.attributes,Y=c.indices),U.position.values.push(T.x,T.y,T.z),U.position.values.push(T.x,T.y,T.z),U.position.values.push(A.x,A.y,A.z),U.position.values.push(A.x,A.y,A.z),i=3*t;i<3*t+12;++i)U.prevPosition.values.push(l[i]),U.nextPosition.values.push(v[i]);for(i=2*t;i<2*t+8;++i)U.expandAndWidth.values.push(f[i]),a.defined(m)&&U.st.values.push(m[i]);if(a.defined(y))for(i=4*t;i<4*t+16;++i)U.color.values.push(y[i]);o=U.position.values.length/3-4,Y.push(o,o+2,o+1),Y.push(o+1,o+2,o+3)}}C&&(Fe(h),Fe(c)),ve(e,h,c)}h.splitLongitude=function(e){if(!a.defined(e))throw new i.DeveloperError("instance is required.");var t=e.geometry,r=t.boundingSphere;if(a.defined(r)){var n=r.center.x-r.radius;if(n>0||o.BoundingSphere.intersectPlane(r,l.Plane.ORIGIN_ZX_PLANE)!==o.Intersect.INTERSECTING)return e}if(t.geometryType!==u.GeometryType.NONE)switch(t.geometryType){case u.GeometryType.POLYLINES:Ye(e);break;case u.GeometryType.TRIANGLES:xe(e);break;case u.GeometryType.LINES:Oe(e);break}else $(t),t.primitiveType===u.PrimitiveType.TRIANGLES?xe(e):t.primitiveType===u.PrimitiveType.LINES&&Oe(e);return e},e.GeometryPipeline=h}));