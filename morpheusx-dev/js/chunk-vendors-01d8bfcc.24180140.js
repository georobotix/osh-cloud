"use strict";(self["webpackChunkvue3_webpack5"]=self["webpackChunkvue3_webpack5"]||[]).push([[798],{7164:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(60838);\n/* harmony import */ var _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(60216);\n/* harmony import */ var _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(63367);\n/* harmony import */ var _Core_combine_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(8182);\n/* harmony import */ var _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(84828);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(82982);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(86511);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(12572);\n/* harmony import */ var _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(38443);\n/* harmony import */ var _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(20521);\n/* harmony import */ var _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(21572);\n/* harmony import */ var _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(87721);\n/* harmony import */ var _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(8743);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Creates a texture to look up per instance attributes for batched primitives. For example, store each primitive\'s pick color in the texture.\n *\n * @alias BatchTable\n * @constructor\n * @private\n *\n * @param {Context} context The context in which the batch table is created.\n * @param {Object[]} attributes An array of objects describing a per instance attribute. Each object contains a datatype, components per attributes, whether it is normalized and a function name\n *     to retrieve the value in the vertex shader.\n * @param {Number} numberOfInstances The number of instances in a batch table.\n *\n * @example\n * // create the batch table\n * var attributes = [{\n *     functionName : \'getShow\',\n *     componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n *     componentsPerAttribute : 1\n * }, {\n *     functionName : \'getPickColor\',\n *     componentDatatype : ComponentDatatype.UNSIGNED_BYTE,\n *     componentsPerAttribute : 4,\n *     normalize : true\n * }];\n * var batchTable = new BatchTable(context, attributes, 5);\n *\n * // when creating the draw commands, update the uniform map and the vertex shader\n * vertexShaderSource = batchTable.getVertexShaderCallback()(vertexShaderSource);\n * var shaderProgram = ShaderProgram.fromCache({\n *    // ...\n *    vertexShaderSource : vertexShaderSource,\n * });\n *\n * drawCommand.shaderProgram = shaderProgram;\n * drawCommand.uniformMap = batchTable.getUniformMapCallback()(uniformMap);\n *\n * // use the attribute function names in the shader to retrieve the instance values\n * // ...\n * attribute float batchId;\n *\n * void main() {\n *     // ...\n *     float show = getShow(batchId);\n *     vec3 pickColor = getPickColor(batchId);\n *     // ...\n * }\n */\nfunction BatchTable(context, attributes, numberOfInstances) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(context)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z("context is required");\n  }\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(attributes)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z("attributes is required");\n  }\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(numberOfInstances)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z("numberOfInstances is required");\n  }\n  //>>includeEnd(\'debug\');\n\n  this._attributes = attributes;\n  this._numberOfInstances = numberOfInstances;\n\n  if (attributes.length === 0) {\n    return;\n  }\n\n  // PERFORMANCE_IDEA: We may be able to arrange the attributes so they can be packing into fewer texels.\n  // Right now, an attribute with one component uses an entire texel when 4 single component attributes can\n  // be packed into a texel.\n  //\n  // Packing floats into unsigned byte textures makes the problem worse. A single component float attribute\n  // will be packed into a single texel leaving 3 texels unused. 4 texels are reserved for each float attribute\n  // regardless of how many components it has.\n  var pixelDatatype = getDatatype(attributes);\n  var textureFloatSupported = context.floatingPointTexture;\n  var packFloats =\n    pixelDatatype === _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].FLOAT */ .Z.FLOAT && !textureFloatSupported;\n  var offsets = createOffsets(attributes, packFloats);\n\n  var stride = getStride(offsets, attributes, packFloats);\n  var maxNumberOfInstancesPerRow = Math.floor(\n    _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].maximumTextureSize */ .Z.maximumTextureSize / stride\n  );\n\n  var instancesPerWidth = Math.min(\n    numberOfInstances,\n    maxNumberOfInstancesPerRow\n  );\n  var width = stride * instancesPerWidth;\n  var height = Math.ceil(numberOfInstances / instancesPerWidth);\n\n  var stepX = 1.0 / width;\n  var centerX = stepX * 0.5;\n  var stepY = 1.0 / height;\n  var centerY = stepY * 0.5;\n\n  this._textureDimensions = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z(width, height);\n  this._textureStep = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(stepX, centerX, stepY, centerY);\n  this._pixelDatatype = !packFloats\n    ? pixelDatatype\n    : _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE;\n  this._packFloats = packFloats;\n  this._offsets = offsets;\n  this._stride = stride;\n  this._texture = undefined;\n\n  var batchLength = 4 * width * height;\n  this._batchValues =\n    pixelDatatype === _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].FLOAT */ .Z.FLOAT && !packFloats\n      ? new Float32Array(batchLength)\n      : new Uint8Array(batchLength);\n  this._batchValuesDirty = false;\n}\n\nObject.defineProperties(BatchTable.prototype, {\n  /**\n   * The attribute descriptions.\n   * @memberOf BatchTable.prototype\n   * @type {Object[]}\n   * @readonly\n   */\n  attributes: {\n    get: function () {\n      return this._attributes;\n    },\n  },\n  /**\n   * The number of instances.\n   * @memberOf BatchTable.prototype\n   * @type {Number}\n   * @readonly\n   */\n  numberOfInstances: {\n    get: function () {\n      return this._numberOfInstances;\n    },\n  },\n});\n\nfunction getDatatype(attributes) {\n  var foundFloatDatatype = false;\n  var length = attributes.length;\n  for (var i = 0; i < length; ++i) {\n    if (attributes[i].componentDatatype !== _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE) {\n      foundFloatDatatype = true;\n      break;\n    }\n  }\n  return foundFloatDatatype ? _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].FLOAT */ .Z.FLOAT : _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE;\n}\n\nfunction getAttributeType(attributes, attributeIndex) {\n  var componentsPerAttribute =\n    attributes[attributeIndex].componentsPerAttribute;\n  if (componentsPerAttribute === 2) {\n    return _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z;\n  } else if (componentsPerAttribute === 3) {\n    return _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z;\n  } else if (componentsPerAttribute === 4) {\n    return _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z;\n  }\n  return Number;\n}\n\nfunction createOffsets(attributes, packFloats) {\n  var offsets = new Array(attributes.length);\n\n  var currentOffset = 0;\n  var attributesLength = attributes.length;\n  for (var i = 0; i < attributesLength; ++i) {\n    var attribute = attributes[i];\n    var componentDatatype = attribute.componentDatatype;\n\n    offsets[i] = currentOffset;\n\n    if (componentDatatype !== _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE && packFloats) {\n      currentOffset += 4;\n    } else {\n      ++currentOffset;\n    }\n  }\n\n  return offsets;\n}\n\nfunction getStride(offsets, attributes, packFloats) {\n  var length = offsets.length;\n  var lastOffset = offsets[length - 1];\n  var lastAttribute = attributes[length - 1];\n  var componentDatatype = lastAttribute.componentDatatype;\n\n  if (componentDatatype !== _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE && packFloats) {\n    return lastOffset + 4;\n  }\n  return lastOffset + 1;\n}\n\nvar scratchPackedFloatCartesian4 = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z();\n\nfunction getPackedFloat(array, index, result) {\n  var packed = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].unpack */ .Z.unpack(array, index, scratchPackedFloatCartesian4);\n  var x = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].unpackFloat */ .Z.unpackFloat(packed);\n\n  packed = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].unpack */ .Z.unpack(array, index + 4, scratchPackedFloatCartesian4);\n  var y = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].unpackFloat */ .Z.unpackFloat(packed);\n\n  packed = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].unpack */ .Z.unpack(array, index + 8, scratchPackedFloatCartesian4);\n  var z = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].unpackFloat */ .Z.unpackFloat(packed);\n\n  packed = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].unpack */ .Z.unpack(array, index + 12, scratchPackedFloatCartesian4);\n  var w = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].unpackFloat */ .Z.unpackFloat(packed);\n\n  return _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].fromElements */ .Z.fromElements(x, y, z, w, result);\n}\n\nfunction setPackedAttribute(value, array, index) {\n  var packed = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].packFloat */ .Z.packFloat(value.x, scratchPackedFloatCartesian4);\n  _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].pack */ .Z.pack(packed, array, index);\n\n  packed = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].packFloat */ .Z.packFloat(value.y, packed);\n  _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].pack */ .Z.pack(packed, array, index + 4);\n\n  packed = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].packFloat */ .Z.packFloat(value.z, packed);\n  _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].pack */ .Z.pack(packed, array, index + 8);\n\n  packed = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].packFloat */ .Z.packFloat(value.w, packed);\n  _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].pack */ .Z.pack(packed, array, index + 12);\n}\n\nvar scratchGetAttributeCartesian4 = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z();\n\n/**\n * Gets the value of an attribute in the table.\n *\n * @param {Number} instanceIndex The index of the instance.\n * @param {Number} attributeIndex The index of the attribute.\n * @param {undefined|Cartesian2|Cartesian3|Cartesian4} [result] The object onto which to store the result. The type is dependent on the attribute\'s number of components.\n * @returns {Number|Cartesian2|Cartesian3|Cartesian4} The attribute value stored for the instance.\n *\n * @exception {DeveloperError} instanceIndex is out of range.\n * @exception {DeveloperError} attributeIndex is out of range.\n */\nBatchTable.prototype.getBatchedAttribute = function (\n  instanceIndex,\n  attributeIndex,\n  result\n) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (instanceIndex < 0 || instanceIndex >= this._numberOfInstances) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z("instanceIndex is out of range.");\n  }\n  if (attributeIndex < 0 || attributeIndex >= this._attributes.length) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z("attributeIndex is out of range");\n  }\n  //>>includeEnd(\'debug\');\n\n  var attributes = this._attributes;\n  var offset = this._offsets[attributeIndex];\n  var stride = this._stride;\n\n  var index = 4 * stride * instanceIndex + 4 * offset;\n  var value;\n\n  if (\n    this._packFloats &&\n    attributes[attributeIndex].componentDatatype !== _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE\n  ) {\n    value = getPackedFloat(\n      this._batchValues,\n      index,\n      scratchGetAttributeCartesian4\n    );\n  } else {\n    value = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].unpack */ .Z.unpack(\n      this._batchValues,\n      index,\n      scratchGetAttributeCartesian4\n    );\n  }\n\n  var attributeType = getAttributeType(attributes, attributeIndex);\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(attributeType.fromCartesian4)) {\n    return attributeType.fromCartesian4(value, result);\n  } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(attributeType.clone)) {\n    return attributeType.clone(value, result);\n  }\n\n  return value.x;\n};\n\nvar setAttributeScratchValues = [\n  undefined,\n  undefined,\n  new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z(),\n  new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z(),\n  new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(),\n];\nvar setAttributeScratchCartesian4 = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z();\n\n/**\n * Sets the value of an attribute in the table.\n *\n * @param {Number} instanceIndex The index of the instance.\n * @param {Number} attributeIndex The index of the attribute.\n * @param {Number|Cartesian2|Cartesian3|Cartesian4} value The value to be stored in the table. The type of value will depend on the number of components of the attribute.\n *\n * @exception {DeveloperError} instanceIndex is out of range.\n * @exception {DeveloperError} attributeIndex is out of range.\n */\nBatchTable.prototype.setBatchedAttribute = function (\n  instanceIndex,\n  attributeIndex,\n  value\n) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (instanceIndex < 0 || instanceIndex >= this._numberOfInstances) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z("instanceIndex is out of range.");\n  }\n  if (attributeIndex < 0 || attributeIndex >= this._attributes.length) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z("attributeIndex is out of range");\n  }\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(value)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z("value is required.");\n  }\n  //>>includeEnd(\'debug\');\n\n  var attributes = this._attributes;\n  var result =\n    setAttributeScratchValues[\n      attributes[attributeIndex].componentsPerAttribute\n    ];\n  var currentAttribute = this.getBatchedAttribute(\n    instanceIndex,\n    attributeIndex,\n    result\n  );\n  var attributeType = getAttributeType(this._attributes, attributeIndex);\n  var entriesEqual = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(attributeType.equals)\n    ? attributeType.equals(currentAttribute, value)\n    : currentAttribute === value;\n  if (entriesEqual) {\n    return;\n  }\n\n  var attributeValue = setAttributeScratchCartesian4;\n  attributeValue.x = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(value.x) ? value.x : value;\n  attributeValue.y = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(value.y) ? value.y : 0.0;\n  attributeValue.z = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(value.z) ? value.z : 0.0;\n  attributeValue.w = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(value.w) ? value.w : 0.0;\n\n  var offset = this._offsets[attributeIndex];\n  var stride = this._stride;\n  var index = 4 * stride * instanceIndex + 4 * offset;\n\n  if (\n    this._packFloats &&\n    attributes[attributeIndex].componentDatatype !== _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE\n  ) {\n    setPackedAttribute(attributeValue, this._batchValues, index);\n  } else {\n    _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].pack */ .Z.pack(attributeValue, this._batchValues, index);\n  }\n\n  this._batchValuesDirty = true;\n};\n\nfunction createTexture(batchTable, context) {\n  var dimensions = batchTable._textureDimensions;\n  batchTable._texture = new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z({\n    context: context,\n    pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].RGBA */ .Z.RGBA,\n    pixelDatatype: batchTable._pixelDatatype,\n    width: dimensions.x,\n    height: dimensions.y,\n    sampler: _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].NEAREST */ .Z.NEAREST,\n    flipY: false,\n  });\n}\n\nfunction updateTexture(batchTable) {\n  var dimensions = batchTable._textureDimensions;\n  batchTable._texture.copyFrom({\n    source: {\n      width: dimensions.x,\n      height: dimensions.y,\n      arrayBufferView: batchTable._batchValues,\n    },\n  });\n}\n\n/**\n * Creates/updates the batch table texture.\n * @param {FrameState} frameState The frame state.\n *\n * @exception {RuntimeError} The floating point texture extension is required but not supported.\n */\nBatchTable.prototype.update = function (frameState) {\n  if (\n    ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(this._texture) && !this._batchValuesDirty) ||\n    this._attributes.length === 0\n  ) {\n    return;\n  }\n\n  this._batchValuesDirty = false;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(this._texture)) {\n    createTexture(this, frameState.context);\n  }\n  updateTexture(this);\n};\n\n/**\n * Gets a function that will update a uniform map to contain values for looking up values in the batch table.\n *\n * @returns {BatchTable.updateUniformMapCallback} A callback for updating uniform maps.\n */\nBatchTable.prototype.getUniformMapCallback = function () {\n  var that = this;\n  return function (uniformMap) {\n    if (that._attributes.length === 0) {\n      return uniformMap;\n    }\n\n    var batchUniformMap = {\n      batchTexture: function () {\n        return that._texture;\n      },\n      batchTextureDimensions: function () {\n        return that._textureDimensions;\n      },\n      batchTextureStep: function () {\n        return that._textureStep;\n      },\n    };\n    return (0,_Core_combine_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z)(uniformMap, batchUniformMap);\n  };\n};\n\nfunction getGlslComputeSt(batchTable) {\n  var stride = batchTable._stride;\n\n  // GLSL batchId is zero-based: [0, numberOfInstances - 1]\n  if (batchTable._textureDimensions.y === 1) {\n    return (\n      "uniform vec4 batchTextureStep; \\n" +\n      "vec2 computeSt(float batchId) \\n" +\n      "{ \\n" +\n      "    float stepX = batchTextureStep.x; \\n" +\n      "    float centerX = batchTextureStep.y; \\n" +\n      "    float numberOfAttributes = float(" +\n      stride +\n      "); \\n" +\n      "    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); \\n" +\n      "} \\n"\n    );\n  }\n\n  return (\n    "uniform vec4 batchTextureStep; \\n" +\n    "uniform vec2 batchTextureDimensions; \\n" +\n    "vec2 computeSt(float batchId) \\n" +\n    "{ \\n" +\n    "    float stepX = batchTextureStep.x; \\n" +\n    "    float centerX = batchTextureStep.y; \\n" +\n    "    float stepY = batchTextureStep.z; \\n" +\n    "    float centerY = batchTextureStep.w; \\n" +\n    "    float numberOfAttributes = float(" +\n    stride +\n    "); \\n" +\n    "    float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x); \\n" +\n    "    float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x); \\n" +\n    "    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \\n" +\n    "} \\n"\n  );\n}\n\nfunction getComponentType(componentsPerAttribute) {\n  if (componentsPerAttribute === 1) {\n    return "float";\n  }\n  return "vec" + componentsPerAttribute;\n}\n\nfunction getComponentSwizzle(componentsPerAttribute) {\n  if (componentsPerAttribute === 1) {\n    return ".x";\n  } else if (componentsPerAttribute === 2) {\n    return ".xy";\n  } else if (componentsPerAttribute === 3) {\n    return ".xyz";\n  }\n  return "";\n}\n\nfunction getGlslAttributeFunction(batchTable, attributeIndex) {\n  var attributes = batchTable._attributes;\n  var attribute = attributes[attributeIndex];\n  var componentsPerAttribute = attribute.componentsPerAttribute;\n  var functionName = attribute.functionName;\n  var functionReturnType = getComponentType(componentsPerAttribute);\n  var functionReturnValue = getComponentSwizzle(componentsPerAttribute);\n\n  var offset = batchTable._offsets[attributeIndex];\n\n  var glslFunction =\n    functionReturnType +\n    " " +\n    functionName +\n    "(float batchId) \\n" +\n    "{ \\n" +\n    "    vec2 st = computeSt(batchId); \\n" +\n    "    st.x += batchTextureStep.x * float(" +\n    offset +\n    "); \\n";\n\n  if (\n    batchTable._packFloats &&\n    attribute.componentDatatype !== _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE\n  ) {\n    glslFunction +=\n      "vec4 textureValue; \\n" +\n      "textureValue.x = czm_unpackFloat(texture2D(batchTexture, st)); \\n" +\n      "textureValue.y = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x, 0.0))); \\n" +\n      "textureValue.z = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); \\n" +\n      "textureValue.w = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); \\n";\n  } else {\n    glslFunction += "    vec4 textureValue = texture2D(batchTexture, st); \\n";\n  }\n\n  glslFunction +=\n    "    " +\n    functionReturnType +\n    " value = textureValue" +\n    functionReturnValue +\n    "; \\n";\n\n  if (\n    batchTable._pixelDatatype === _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE &&\n    attribute.componentDatatype === _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE &&\n    !attribute.normalize\n  ) {\n    glslFunction += "value *= 255.0; \\n";\n  } else if (\n    batchTable._pixelDatatype === _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].FLOAT */ .Z.FLOAT &&\n    attribute.componentDatatype === _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE &&\n    attribute.normalize\n  ) {\n    glslFunction += "value /= 255.0; \\n";\n  }\n\n  glslFunction += "    return value; \\n" + "} \\n";\n  return glslFunction;\n}\n\n/**\n * Gets a function that will update a vertex shader to contain functions for looking up values in the batch table.\n *\n * @returns {BatchTable.updateVertexShaderSourceCallback} A callback for updating a vertex shader source.\n */\nBatchTable.prototype.getVertexShaderCallback = function () {\n  var attributes = this._attributes;\n  if (attributes.length === 0) {\n    return function (source) {\n      return source;\n    };\n  }\n\n  var batchTableShader = "uniform highp sampler2D batchTexture; \\n";\n  batchTableShader += getGlslComputeSt(this) + "\\n";\n\n  var length = attributes.length;\n  for (var i = 0; i < length; ++i) {\n    batchTableShader += getGlslAttributeFunction(this, i);\n  }\n\n  return function (source) {\n    var mainIndex = source.indexOf("void main");\n    var beforeMain = source.substring(0, mainIndex);\n    var afterMain = source.substring(mainIndex);\n    return beforeMain + "\\n" + batchTableShader + "\\n" + afterMain;\n  };\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <br /><br />\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n *\n * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n *\n * @see BatchTable#destroy\n */\nBatchTable.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n * <br /><br />\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n * @see BatchTable#isDestroyed\n */\nBatchTable.prototype.destroy = function () {\n  this._texture = this._texture && this._texture.destroy();\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(this);\n};\n\n/**\n * A callback for updating uniform maps.\n * @callback BatchTable.updateUniformMapCallback\n *\n * @param {Object} uniformMap The uniform map.\n * @returns {Object} The new uniform map with properties for retrieving values from the batch table.\n */\n\n/**\n * A callback for updating a vertex shader source.\n * @callback BatchTable.updateVertexShaderSourceCallback\n *\n * @param {String} vertexShaderSource The vertex shader source.\n * @returns {String} The new vertex shader source with the functions for retrieving batch table values injected.\n */\n/* harmony default export */ __webpack_exports__["Z"] = (BatchTable);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c0JBQXNCO0FBQ3BFO0FBQ0E7QUFDQSxlQUFlLGdCQUFnQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUywyRUFBYTtBQUN0Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixhQUFhLFFBQVE7QUFDckI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFFBQVE7QUFDbkIsYUFBYSxRQUFRO0FBQ3JCO0FBQ0EseURBQWUsVUFBVSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdnVlMy13ZWJwYWNrNS8uL25vZGVfbW9kdWxlcy9jZXNpdW0vU291cmNlL1NjZW5lL0JhdGNoVGFibGUuanM/YjFiMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ2FydGVzaWFuMiBmcm9tIFwiLi4vQ29yZS9DYXJ0ZXNpYW4yLmpzXCI7XG5pbXBvcnQgQ2FydGVzaWFuMyBmcm9tIFwiLi4vQ29yZS9DYXJ0ZXNpYW4zLmpzXCI7XG5pbXBvcnQgQ2FydGVzaWFuNCBmcm9tIFwiLi4vQ29yZS9DYXJ0ZXNpYW40LmpzXCI7XG5pbXBvcnQgY29tYmluZSBmcm9tIFwiLi4vQ29yZS9jb21iaW5lLmpzXCI7XG5pbXBvcnQgQ29tcG9uZW50RGF0YXR5cGUgZnJvbSBcIi4uL0NvcmUvQ29tcG9uZW50RGF0YXR5cGUuanNcIjtcbmltcG9ydCBkZWZpbmVkIGZyb20gXCIuLi9Db3JlL2RlZmluZWQuanNcIjtcbmltcG9ydCBkZXN0cm95T2JqZWN0IGZyb20gXCIuLi9Db3JlL2Rlc3Ryb3lPYmplY3QuanNcIjtcbmltcG9ydCBEZXZlbG9wZXJFcnJvciBmcm9tIFwiLi4vQ29yZS9EZXZlbG9wZXJFcnJvci5qc1wiO1xuaW1wb3J0IFBpeGVsRm9ybWF0IGZyb20gXCIuLi9Db3JlL1BpeGVsRm9ybWF0LmpzXCI7XG5pbXBvcnQgQ29udGV4dExpbWl0cyBmcm9tIFwiLi4vUmVuZGVyZXIvQ29udGV4dExpbWl0cy5qc1wiO1xuaW1wb3J0IFBpeGVsRGF0YXR5cGUgZnJvbSBcIi4uL1JlbmRlcmVyL1BpeGVsRGF0YXR5cGUuanNcIjtcbmltcG9ydCBTYW1wbGVyIGZyb20gXCIuLi9SZW5kZXJlci9TYW1wbGVyLmpzXCI7XG5pbXBvcnQgVGV4dHVyZSBmcm9tIFwiLi4vUmVuZGVyZXIvVGV4dHVyZS5qc1wiO1xuXG4vKipcbiAqIENyZWF0ZXMgYSB0ZXh0dXJlIHRvIGxvb2sgdXAgcGVyIGluc3RhbmNlIGF0dHJpYnV0ZXMgZm9yIGJhdGNoZWQgcHJpbWl0aXZlcy4gRm9yIGV4YW1wbGUsIHN0b3JlIGVhY2ggcHJpbWl0aXZlJ3MgcGljayBjb2xvciBpbiB0aGUgdGV4dHVyZS5cbiAqXG4gKiBAYWxpYXMgQmF0Y2hUYWJsZVxuICogQGNvbnN0cnVjdG9yXG4gKiBAcHJpdmF0ZVxuICpcbiAqIEBwYXJhbSB7Q29udGV4dH0gY29udGV4dCBUaGUgY29udGV4dCBpbiB3aGljaCB0aGUgYmF0Y2ggdGFibGUgaXMgY3JlYXRlZC5cbiAqIEBwYXJhbSB7T2JqZWN0W119IGF0dHJpYnV0ZXMgQW4gYXJyYXkgb2Ygb2JqZWN0cyBkZXNjcmliaW5nIGEgcGVyIGluc3RhbmNlIGF0dHJpYnV0ZS4gRWFjaCBvYmplY3QgY29udGFpbnMgYSBkYXRhdHlwZSwgY29tcG9uZW50cyBwZXIgYXR0cmlidXRlcywgd2hldGhlciBpdCBpcyBub3JtYWxpemVkIGFuZCBhIGZ1bmN0aW9uIG5hbWVcbiAqICAgICB0byByZXRyaWV2ZSB0aGUgdmFsdWUgaW4gdGhlIHZlcnRleCBzaGFkZXIuXG4gKiBAcGFyYW0ge051bWJlcn0gbnVtYmVyT2ZJbnN0YW5jZXMgVGhlIG51bWJlciBvZiBpbnN0YW5jZXMgaW4gYSBiYXRjaCB0YWJsZS5cbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gY3JlYXRlIHRoZSBiYXRjaCB0YWJsZVxuICogdmFyIGF0dHJpYnV0ZXMgPSBbe1xuICogICAgIGZ1bmN0aW9uTmFtZSA6ICdnZXRTaG93JyxcbiAqICAgICBjb21wb25lbnREYXRhdHlwZSA6IENvbXBvbmVudERhdGF0eXBlLlVOU0lHTkVEX0JZVEUsXG4gKiAgICAgY29tcG9uZW50c1BlckF0dHJpYnV0ZSA6IDFcbiAqIH0sIHtcbiAqICAgICBmdW5jdGlvbk5hbWUgOiAnZ2V0UGlja0NvbG9yJyxcbiAqICAgICBjb21wb25lbnREYXRhdHlwZSA6IENvbXBvbmVudERhdGF0eXBlLlVOU0lHTkVEX0JZVEUsXG4gKiAgICAgY29tcG9uZW50c1BlckF0dHJpYnV0ZSA6IDQsXG4gKiAgICAgbm9ybWFsaXplIDogdHJ1ZVxuICogfV07XG4gKiB2YXIgYmF0Y2hUYWJsZSA9IG5ldyBCYXRjaFRhYmxlKGNvbnRleHQsIGF0dHJpYnV0ZXMsIDUpO1xuICpcbiAqIC8vIHdoZW4gY3JlYXRpbmcgdGhlIGRyYXcgY29tbWFuZHMsIHVwZGF0ZSB0aGUgdW5pZm9ybSBtYXAgYW5kIHRoZSB2ZXJ0ZXggc2hhZGVyXG4gKiB2ZXJ0ZXhTaGFkZXJTb3VyY2UgPSBiYXRjaFRhYmxlLmdldFZlcnRleFNoYWRlckNhbGxiYWNrKCkodmVydGV4U2hhZGVyU291cmNlKTtcbiAqIHZhciBzaGFkZXJQcm9ncmFtID0gU2hhZGVyUHJvZ3JhbS5mcm9tQ2FjaGUoe1xuICogICAgLy8gLi4uXG4gKiAgICB2ZXJ0ZXhTaGFkZXJTb3VyY2UgOiB2ZXJ0ZXhTaGFkZXJTb3VyY2UsXG4gKiB9KTtcbiAqXG4gKiBkcmF3Q29tbWFuZC5zaGFkZXJQcm9ncmFtID0gc2hhZGVyUHJvZ3JhbTtcbiAqIGRyYXdDb21tYW5kLnVuaWZvcm1NYXAgPSBiYXRjaFRhYmxlLmdldFVuaWZvcm1NYXBDYWxsYmFjaygpKHVuaWZvcm1NYXApO1xuICpcbiAqIC8vIHVzZSB0aGUgYXR0cmlidXRlIGZ1bmN0aW9uIG5hbWVzIGluIHRoZSBzaGFkZXIgdG8gcmV0cmlldmUgdGhlIGluc3RhbmNlIHZhbHVlc1xuICogLy8gLi4uXG4gKiBhdHRyaWJ1dGUgZmxvYXQgYmF0Y2hJZDtcbiAqXG4gKiB2b2lkIG1haW4oKSB7XG4gKiAgICAgLy8gLi4uXG4gKiAgICAgZmxvYXQgc2hvdyA9IGdldFNob3coYmF0Y2hJZCk7XG4gKiAgICAgdmVjMyBwaWNrQ29sb3IgPSBnZXRQaWNrQ29sb3IoYmF0Y2hJZCk7XG4gKiAgICAgLy8gLi4uXG4gKiB9XG4gKi9cbmZ1bmN0aW9uIEJhdGNoVGFibGUoY29udGV4dCwgYXR0cmlidXRlcywgbnVtYmVyT2ZJbnN0YW5jZXMpIHtcbiAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgaWYgKCFkZWZpbmVkKGNvbnRleHQpKSB7XG4gICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwiY29udGV4dCBpcyByZXF1aXJlZFwiKTtcbiAgfVxuICBpZiAoIWRlZmluZWQoYXR0cmlidXRlcykpIHtcbiAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXCJhdHRyaWJ1dGVzIGlzIHJlcXVpcmVkXCIpO1xuICB9XG4gIGlmICghZGVmaW5lZChudW1iZXJPZkluc3RhbmNlcykpIHtcbiAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXCJudW1iZXJPZkluc3RhbmNlcyBpcyByZXF1aXJlZFwiKTtcbiAgfVxuICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICB0aGlzLl9hdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcbiAgdGhpcy5fbnVtYmVyT2ZJbnN0YW5jZXMgPSBudW1iZXJPZkluc3RhbmNlcztcblxuICBpZiAoYXR0cmlidXRlcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBQRVJGT1JNQU5DRV9JREVBOiBXZSBtYXkgYmUgYWJsZSB0byBhcnJhbmdlIHRoZSBhdHRyaWJ1dGVzIHNvIHRoZXkgY2FuIGJlIHBhY2tpbmcgaW50byBmZXdlciB0ZXhlbHMuXG4gIC8vIFJpZ2h0IG5vdywgYW4gYXR0cmlidXRlIHdpdGggb25lIGNvbXBvbmVudCB1c2VzIGFuIGVudGlyZSB0ZXhlbCB3aGVuIDQgc2luZ2xlIGNvbXBvbmVudCBhdHRyaWJ1dGVzIGNhblxuICAvLyBiZSBwYWNrZWQgaW50byBhIHRleGVsLlxuICAvL1xuICAvLyBQYWNraW5nIGZsb2F0cyBpbnRvIHVuc2lnbmVkIGJ5dGUgdGV4dHVyZXMgbWFrZXMgdGhlIHByb2JsZW0gd29yc2UuIEEgc2luZ2xlIGNvbXBvbmVudCBmbG9hdCBhdHRyaWJ1dGVcbiAgLy8gd2lsbCBiZSBwYWNrZWQgaW50byBhIHNpbmdsZSB0ZXhlbCBsZWF2aW5nIDMgdGV4ZWxzIHVudXNlZC4gNCB0ZXhlbHMgYXJlIHJlc2VydmVkIGZvciBlYWNoIGZsb2F0IGF0dHJpYnV0ZVxuICAvLyByZWdhcmRsZXNzIG9mIGhvdyBtYW55IGNvbXBvbmVudHMgaXQgaGFzLlxuICB2YXIgcGl4ZWxEYXRhdHlwZSA9IGdldERhdGF0eXBlKGF0dHJpYnV0ZXMpO1xuICB2YXIgdGV4dHVyZUZsb2F0U3VwcG9ydGVkID0gY29udGV4dC5mbG9hdGluZ1BvaW50VGV4dHVyZTtcbiAgdmFyIHBhY2tGbG9hdHMgPVxuICAgIHBpeGVsRGF0YXR5cGUgPT09IFBpeGVsRGF0YXR5cGUuRkxPQVQgJiYgIXRleHR1cmVGbG9hdFN1cHBvcnRlZDtcbiAgdmFyIG9mZnNldHMgPSBjcmVhdGVPZmZzZXRzKGF0dHJpYnV0ZXMsIHBhY2tGbG9hdHMpO1xuXG4gIHZhciBzdHJpZGUgPSBnZXRTdHJpZGUob2Zmc2V0cywgYXR0cmlidXRlcywgcGFja0Zsb2F0cyk7XG4gIHZhciBtYXhOdW1iZXJPZkluc3RhbmNlc1BlclJvdyA9IE1hdGguZmxvb3IoXG4gICAgQ29udGV4dExpbWl0cy5tYXhpbXVtVGV4dHVyZVNpemUgLyBzdHJpZGVcbiAgKTtcblxuICB2YXIgaW5zdGFuY2VzUGVyV2lkdGggPSBNYXRoLm1pbihcbiAgICBudW1iZXJPZkluc3RhbmNlcyxcbiAgICBtYXhOdW1iZXJPZkluc3RhbmNlc1BlclJvd1xuICApO1xuICB2YXIgd2lkdGggPSBzdHJpZGUgKiBpbnN0YW5jZXNQZXJXaWR0aDtcbiAgdmFyIGhlaWdodCA9IE1hdGguY2VpbChudW1iZXJPZkluc3RhbmNlcyAvIGluc3RhbmNlc1BlcldpZHRoKTtcblxuICB2YXIgc3RlcFggPSAxLjAgLyB3aWR0aDtcbiAgdmFyIGNlbnRlclggPSBzdGVwWCAqIDAuNTtcbiAgdmFyIHN0ZXBZID0gMS4wIC8gaGVpZ2h0O1xuICB2YXIgY2VudGVyWSA9IHN0ZXBZICogMC41O1xuXG4gIHRoaXMuX3RleHR1cmVEaW1lbnNpb25zID0gbmV3IENhcnRlc2lhbjIod2lkdGgsIGhlaWdodCk7XG4gIHRoaXMuX3RleHR1cmVTdGVwID0gbmV3IENhcnRlc2lhbjQoc3RlcFgsIGNlbnRlclgsIHN0ZXBZLCBjZW50ZXJZKTtcbiAgdGhpcy5fcGl4ZWxEYXRhdHlwZSA9ICFwYWNrRmxvYXRzXG4gICAgPyBwaXhlbERhdGF0eXBlXG4gICAgOiBQaXhlbERhdGF0eXBlLlVOU0lHTkVEX0JZVEU7XG4gIHRoaXMuX3BhY2tGbG9hdHMgPSBwYWNrRmxvYXRzO1xuICB0aGlzLl9vZmZzZXRzID0gb2Zmc2V0cztcbiAgdGhpcy5fc3RyaWRlID0gc3RyaWRlO1xuICB0aGlzLl90ZXh0dXJlID0gdW5kZWZpbmVkO1xuXG4gIHZhciBiYXRjaExlbmd0aCA9IDQgKiB3aWR0aCAqIGhlaWdodDtcbiAgdGhpcy5fYmF0Y2hWYWx1ZXMgPVxuICAgIHBpeGVsRGF0YXR5cGUgPT09IFBpeGVsRGF0YXR5cGUuRkxPQVQgJiYgIXBhY2tGbG9hdHNcbiAgICAgID8gbmV3IEZsb2F0MzJBcnJheShiYXRjaExlbmd0aClcbiAgICAgIDogbmV3IFVpbnQ4QXJyYXkoYmF0Y2hMZW5ndGgpO1xuICB0aGlzLl9iYXRjaFZhbHVlc0RpcnR5ID0gZmFsc2U7XG59XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEJhdGNoVGFibGUucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBUaGUgYXR0cmlidXRlIGRlc2NyaXB0aW9ucy5cbiAgICogQG1lbWJlck9mIEJhdGNoVGFibGUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtPYmplY3RbXX1cbiAgICogQHJlYWRvbmx5XG4gICAqL1xuICBhdHRyaWJ1dGVzOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYXR0cmlidXRlcztcbiAgICB9LFxuICB9LFxuICAvKipcbiAgICogVGhlIG51bWJlciBvZiBpbnN0YW5jZXMuXG4gICAqIEBtZW1iZXJPZiBCYXRjaFRhYmxlLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIG51bWJlck9mSW5zdGFuY2VzOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbnVtYmVyT2ZJbnN0YW5jZXM7XG4gICAgfSxcbiAgfSxcbn0pO1xuXG5mdW5jdGlvbiBnZXREYXRhdHlwZShhdHRyaWJ1dGVzKSB7XG4gIHZhciBmb3VuZEZsb2F0RGF0YXR5cGUgPSBmYWxzZTtcbiAgdmFyIGxlbmd0aCA9IGF0dHJpYnV0ZXMubGVuZ3RoO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgaWYgKGF0dHJpYnV0ZXNbaV0uY29tcG9uZW50RGF0YXR5cGUgIT09IENvbXBvbmVudERhdGF0eXBlLlVOU0lHTkVEX0JZVEUpIHtcbiAgICAgIGZvdW5kRmxvYXREYXRhdHlwZSA9IHRydWU7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZvdW5kRmxvYXREYXRhdHlwZSA/IFBpeGVsRGF0YXR5cGUuRkxPQVQgOiBQaXhlbERhdGF0eXBlLlVOU0lHTkVEX0JZVEU7XG59XG5cbmZ1bmN0aW9uIGdldEF0dHJpYnV0ZVR5cGUoYXR0cmlidXRlcywgYXR0cmlidXRlSW5kZXgpIHtcbiAgdmFyIGNvbXBvbmVudHNQZXJBdHRyaWJ1dGUgPVxuICAgIGF0dHJpYnV0ZXNbYXR0cmlidXRlSW5kZXhdLmNvbXBvbmVudHNQZXJBdHRyaWJ1dGU7XG4gIGlmIChjb21wb25lbnRzUGVyQXR0cmlidXRlID09PSAyKSB7XG4gICAgcmV0dXJuIENhcnRlc2lhbjI7XG4gIH0gZWxzZSBpZiAoY29tcG9uZW50c1BlckF0dHJpYnV0ZSA9PT0gMykge1xuICAgIHJldHVybiBDYXJ0ZXNpYW4zO1xuICB9IGVsc2UgaWYgKGNvbXBvbmVudHNQZXJBdHRyaWJ1dGUgPT09IDQpIHtcbiAgICByZXR1cm4gQ2FydGVzaWFuNDtcbiAgfVxuICByZXR1cm4gTnVtYmVyO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVPZmZzZXRzKGF0dHJpYnV0ZXMsIHBhY2tGbG9hdHMpIHtcbiAgdmFyIG9mZnNldHMgPSBuZXcgQXJyYXkoYXR0cmlidXRlcy5sZW5ndGgpO1xuXG4gIHZhciBjdXJyZW50T2Zmc2V0ID0gMDtcbiAgdmFyIGF0dHJpYnV0ZXNMZW5ndGggPSBhdHRyaWJ1dGVzLmxlbmd0aDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhdHRyaWJ1dGVzTGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgYXR0cmlidXRlID0gYXR0cmlidXRlc1tpXTtcbiAgICB2YXIgY29tcG9uZW50RGF0YXR5cGUgPSBhdHRyaWJ1dGUuY29tcG9uZW50RGF0YXR5cGU7XG5cbiAgICBvZmZzZXRzW2ldID0gY3VycmVudE9mZnNldDtcblxuICAgIGlmIChjb21wb25lbnREYXRhdHlwZSAhPT0gQ29tcG9uZW50RGF0YXR5cGUuVU5TSUdORURfQllURSAmJiBwYWNrRmxvYXRzKSB7XG4gICAgICBjdXJyZW50T2Zmc2V0ICs9IDQ7XG4gICAgfSBlbHNlIHtcbiAgICAgICsrY3VycmVudE9mZnNldDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gb2Zmc2V0cztcbn1cblxuZnVuY3Rpb24gZ2V0U3RyaWRlKG9mZnNldHMsIGF0dHJpYnV0ZXMsIHBhY2tGbG9hdHMpIHtcbiAgdmFyIGxlbmd0aCA9IG9mZnNldHMubGVuZ3RoO1xuICB2YXIgbGFzdE9mZnNldCA9IG9mZnNldHNbbGVuZ3RoIC0gMV07XG4gIHZhciBsYXN0QXR0cmlidXRlID0gYXR0cmlidXRlc1tsZW5ndGggLSAxXTtcbiAgdmFyIGNvbXBvbmVudERhdGF0eXBlID0gbGFzdEF0dHJpYnV0ZS5jb21wb25lbnREYXRhdHlwZTtcblxuICBpZiAoY29tcG9uZW50RGF0YXR5cGUgIT09IENvbXBvbmVudERhdGF0eXBlLlVOU0lHTkVEX0JZVEUgJiYgcGFja0Zsb2F0cykge1xuICAgIHJldHVybiBsYXN0T2Zmc2V0ICsgNDtcbiAgfVxuICByZXR1cm4gbGFzdE9mZnNldCArIDE7XG59XG5cbnZhciBzY3JhdGNoUGFja2VkRmxvYXRDYXJ0ZXNpYW40ID0gbmV3IENhcnRlc2lhbjQoKTtcblxuZnVuY3Rpb24gZ2V0UGFja2VkRmxvYXQoYXJyYXksIGluZGV4LCByZXN1bHQpIHtcbiAgdmFyIHBhY2tlZCA9IENhcnRlc2lhbjQudW5wYWNrKGFycmF5LCBpbmRleCwgc2NyYXRjaFBhY2tlZEZsb2F0Q2FydGVzaWFuNCk7XG4gIHZhciB4ID0gQ2FydGVzaWFuNC51bnBhY2tGbG9hdChwYWNrZWQpO1xuXG4gIHBhY2tlZCA9IENhcnRlc2lhbjQudW5wYWNrKGFycmF5LCBpbmRleCArIDQsIHNjcmF0Y2hQYWNrZWRGbG9hdENhcnRlc2lhbjQpO1xuICB2YXIgeSA9IENhcnRlc2lhbjQudW5wYWNrRmxvYXQocGFja2VkKTtcblxuICBwYWNrZWQgPSBDYXJ0ZXNpYW40LnVucGFjayhhcnJheSwgaW5kZXggKyA4LCBzY3JhdGNoUGFja2VkRmxvYXRDYXJ0ZXNpYW40KTtcbiAgdmFyIHogPSBDYXJ0ZXNpYW40LnVucGFja0Zsb2F0KHBhY2tlZCk7XG5cbiAgcGFja2VkID0gQ2FydGVzaWFuNC51bnBhY2soYXJyYXksIGluZGV4ICsgMTIsIHNjcmF0Y2hQYWNrZWRGbG9hdENhcnRlc2lhbjQpO1xuICB2YXIgdyA9IENhcnRlc2lhbjQudW5wYWNrRmxvYXQocGFja2VkKTtcblxuICByZXR1cm4gQ2FydGVzaWFuNC5mcm9tRWxlbWVudHMoeCwgeSwgeiwgdywgcmVzdWx0KTtcbn1cblxuZnVuY3Rpb24gc2V0UGFja2VkQXR0cmlidXRlKHZhbHVlLCBhcnJheSwgaW5kZXgpIHtcbiAgdmFyIHBhY2tlZCA9IENhcnRlc2lhbjQucGFja0Zsb2F0KHZhbHVlLngsIHNjcmF0Y2hQYWNrZWRGbG9hdENhcnRlc2lhbjQpO1xuICBDYXJ0ZXNpYW40LnBhY2socGFja2VkLCBhcnJheSwgaW5kZXgpO1xuXG4gIHBhY2tlZCA9IENhcnRlc2lhbjQucGFja0Zsb2F0KHZhbHVlLnksIHBhY2tlZCk7XG4gIENhcnRlc2lhbjQucGFjayhwYWNrZWQsIGFycmF5LCBpbmRleCArIDQpO1xuXG4gIHBhY2tlZCA9IENhcnRlc2lhbjQucGFja0Zsb2F0KHZhbHVlLnosIHBhY2tlZCk7XG4gIENhcnRlc2lhbjQucGFjayhwYWNrZWQsIGFycmF5LCBpbmRleCArIDgpO1xuXG4gIHBhY2tlZCA9IENhcnRlc2lhbjQucGFja0Zsb2F0KHZhbHVlLncsIHBhY2tlZCk7XG4gIENhcnRlc2lhbjQucGFjayhwYWNrZWQsIGFycmF5LCBpbmRleCArIDEyKTtcbn1cblxudmFyIHNjcmF0Y2hHZXRBdHRyaWJ1dGVDYXJ0ZXNpYW40ID0gbmV3IENhcnRlc2lhbjQoKTtcblxuLyoqXG4gKiBHZXRzIHRoZSB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUgaW4gdGhlIHRhYmxlLlxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBpbnN0YW5jZUluZGV4IFRoZSBpbmRleCBvZiB0aGUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge051bWJlcn0gYXR0cmlidXRlSW5kZXggVGhlIGluZGV4IG9mIHRoZSBhdHRyaWJ1dGUuXG4gKiBAcGFyYW0ge3VuZGVmaW5lZHxDYXJ0ZXNpYW4yfENhcnRlc2lhbjN8Q2FydGVzaWFuNH0gW3Jlc3VsdF0gVGhlIG9iamVjdCBvbnRvIHdoaWNoIHRvIHN0b3JlIHRoZSByZXN1bHQuIFRoZSB0eXBlIGlzIGRlcGVuZGVudCBvbiB0aGUgYXR0cmlidXRlJ3MgbnVtYmVyIG9mIGNvbXBvbmVudHMuXG4gKiBAcmV0dXJucyB7TnVtYmVyfENhcnRlc2lhbjJ8Q2FydGVzaWFuM3xDYXJ0ZXNpYW40fSBUaGUgYXR0cmlidXRlIHZhbHVlIHN0b3JlZCBmb3IgdGhlIGluc3RhbmNlLlxuICpcbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBpbnN0YW5jZUluZGV4IGlzIG91dCBvZiByYW5nZS5cbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBhdHRyaWJ1dGVJbmRleCBpcyBvdXQgb2YgcmFuZ2UuXG4gKi9cbkJhdGNoVGFibGUucHJvdG90eXBlLmdldEJhdGNoZWRBdHRyaWJ1dGUgPSBmdW5jdGlvbiAoXG4gIGluc3RhbmNlSW5kZXgsXG4gIGF0dHJpYnV0ZUluZGV4LFxuICByZXN1bHRcbikge1xuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBpZiAoaW5zdGFuY2VJbmRleCA8IDAgfHwgaW5zdGFuY2VJbmRleCA+PSB0aGlzLl9udW1iZXJPZkluc3RhbmNlcykge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcImluc3RhbmNlSW5kZXggaXMgb3V0IG9mIHJhbmdlLlwiKTtcbiAgfVxuICBpZiAoYXR0cmlidXRlSW5kZXggPCAwIHx8IGF0dHJpYnV0ZUluZGV4ID49IHRoaXMuX2F0dHJpYnV0ZXMubGVuZ3RoKSB7XG4gICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwiYXR0cmlidXRlSW5kZXggaXMgb3V0IG9mIHJhbmdlXCIpO1xuICB9XG4gIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gIHZhciBhdHRyaWJ1dGVzID0gdGhpcy5fYXR0cmlidXRlcztcbiAgdmFyIG9mZnNldCA9IHRoaXMuX29mZnNldHNbYXR0cmlidXRlSW5kZXhdO1xuICB2YXIgc3RyaWRlID0gdGhpcy5fc3RyaWRlO1xuXG4gIHZhciBpbmRleCA9IDQgKiBzdHJpZGUgKiBpbnN0YW5jZUluZGV4ICsgNCAqIG9mZnNldDtcbiAgdmFyIHZhbHVlO1xuXG4gIGlmIChcbiAgICB0aGlzLl9wYWNrRmxvYXRzICYmXG4gICAgYXR0cmlidXRlc1thdHRyaWJ1dGVJbmRleF0uY29tcG9uZW50RGF0YXR5cGUgIT09IFBpeGVsRGF0YXR5cGUuVU5TSUdORURfQllURVxuICApIHtcbiAgICB2YWx1ZSA9IGdldFBhY2tlZEZsb2F0KFxuICAgICAgdGhpcy5fYmF0Y2hWYWx1ZXMsXG4gICAgICBpbmRleCxcbiAgICAgIHNjcmF0Y2hHZXRBdHRyaWJ1dGVDYXJ0ZXNpYW40XG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICB2YWx1ZSA9IENhcnRlc2lhbjQudW5wYWNrKFxuICAgICAgdGhpcy5fYmF0Y2hWYWx1ZXMsXG4gICAgICBpbmRleCxcbiAgICAgIHNjcmF0Y2hHZXRBdHRyaWJ1dGVDYXJ0ZXNpYW40XG4gICAgKTtcbiAgfVxuXG4gIHZhciBhdHRyaWJ1dGVUeXBlID0gZ2V0QXR0cmlidXRlVHlwZShhdHRyaWJ1dGVzLCBhdHRyaWJ1dGVJbmRleCk7XG4gIGlmIChkZWZpbmVkKGF0dHJpYnV0ZVR5cGUuZnJvbUNhcnRlc2lhbjQpKSB7XG4gICAgcmV0dXJuIGF0dHJpYnV0ZVR5cGUuZnJvbUNhcnRlc2lhbjQodmFsdWUsIHJlc3VsdCk7XG4gIH0gZWxzZSBpZiAoZGVmaW5lZChhdHRyaWJ1dGVUeXBlLmNsb25lKSkge1xuICAgIHJldHVybiBhdHRyaWJ1dGVUeXBlLmNsb25lKHZhbHVlLCByZXN1bHQpO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlLng7XG59O1xuXG52YXIgc2V0QXR0cmlidXRlU2NyYXRjaFZhbHVlcyA9IFtcbiAgdW5kZWZpbmVkLFxuICB1bmRlZmluZWQsXG4gIG5ldyBDYXJ0ZXNpYW4yKCksXG4gIG5ldyBDYXJ0ZXNpYW4zKCksXG4gIG5ldyBDYXJ0ZXNpYW40KCksXG5dO1xudmFyIHNldEF0dHJpYnV0ZVNjcmF0Y2hDYXJ0ZXNpYW40ID0gbmV3IENhcnRlc2lhbjQoKTtcblxuLyoqXG4gKiBTZXRzIHRoZSB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUgaW4gdGhlIHRhYmxlLlxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBpbnN0YW5jZUluZGV4IFRoZSBpbmRleCBvZiB0aGUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge051bWJlcn0gYXR0cmlidXRlSW5kZXggVGhlIGluZGV4IG9mIHRoZSBhdHRyaWJ1dGUuXG4gKiBAcGFyYW0ge051bWJlcnxDYXJ0ZXNpYW4yfENhcnRlc2lhbjN8Q2FydGVzaWFuNH0gdmFsdWUgVGhlIHZhbHVlIHRvIGJlIHN0b3JlZCBpbiB0aGUgdGFibGUuIFRoZSB0eXBlIG9mIHZhbHVlIHdpbGwgZGVwZW5kIG9uIHRoZSBudW1iZXIgb2YgY29tcG9uZW50cyBvZiB0aGUgYXR0cmlidXRlLlxuICpcbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBpbnN0YW5jZUluZGV4IGlzIG91dCBvZiByYW5nZS5cbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBhdHRyaWJ1dGVJbmRleCBpcyBvdXQgb2YgcmFuZ2UuXG4gKi9cbkJhdGNoVGFibGUucHJvdG90eXBlLnNldEJhdGNoZWRBdHRyaWJ1dGUgPSBmdW5jdGlvbiAoXG4gIGluc3RhbmNlSW5kZXgsXG4gIGF0dHJpYnV0ZUluZGV4LFxuICB2YWx1ZVxuKSB7XG4gIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gIGlmIChpbnN0YW5jZUluZGV4IDwgMCB8fCBpbnN0YW5jZUluZGV4ID49IHRoaXMuX251bWJlck9mSW5zdGFuY2VzKSB7XG4gICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwiaW5zdGFuY2VJbmRleCBpcyBvdXQgb2YgcmFuZ2UuXCIpO1xuICB9XG4gIGlmIChhdHRyaWJ1dGVJbmRleCA8IDAgfHwgYXR0cmlidXRlSW5kZXggPj0gdGhpcy5fYXR0cmlidXRlcy5sZW5ndGgpIHtcbiAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXCJhdHRyaWJ1dGVJbmRleCBpcyBvdXQgb2YgcmFuZ2VcIik7XG4gIH1cbiAgaWYgKCFkZWZpbmVkKHZhbHVlKSkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcInZhbHVlIGlzIHJlcXVpcmVkLlwiKTtcbiAgfVxuICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICB2YXIgYXR0cmlidXRlcyA9IHRoaXMuX2F0dHJpYnV0ZXM7XG4gIHZhciByZXN1bHQgPVxuICAgIHNldEF0dHJpYnV0ZVNjcmF0Y2hWYWx1ZXNbXG4gICAgICBhdHRyaWJ1dGVzW2F0dHJpYnV0ZUluZGV4XS5jb21wb25lbnRzUGVyQXR0cmlidXRlXG4gICAgXTtcbiAgdmFyIGN1cnJlbnRBdHRyaWJ1dGUgPSB0aGlzLmdldEJhdGNoZWRBdHRyaWJ1dGUoXG4gICAgaW5zdGFuY2VJbmRleCxcbiAgICBhdHRyaWJ1dGVJbmRleCxcbiAgICByZXN1bHRcbiAgKTtcbiAgdmFyIGF0dHJpYnV0ZVR5cGUgPSBnZXRBdHRyaWJ1dGVUeXBlKHRoaXMuX2F0dHJpYnV0ZXMsIGF0dHJpYnV0ZUluZGV4KTtcbiAgdmFyIGVudHJpZXNFcXVhbCA9IGRlZmluZWQoYXR0cmlidXRlVHlwZS5lcXVhbHMpXG4gICAgPyBhdHRyaWJ1dGVUeXBlLmVxdWFscyhjdXJyZW50QXR0cmlidXRlLCB2YWx1ZSlcbiAgICA6IGN1cnJlbnRBdHRyaWJ1dGUgPT09IHZhbHVlO1xuICBpZiAoZW50cmllc0VxdWFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGF0dHJpYnV0ZVZhbHVlID0gc2V0QXR0cmlidXRlU2NyYXRjaENhcnRlc2lhbjQ7XG4gIGF0dHJpYnV0ZVZhbHVlLnggPSBkZWZpbmVkKHZhbHVlLngpID8gdmFsdWUueCA6IHZhbHVlO1xuICBhdHRyaWJ1dGVWYWx1ZS55ID0gZGVmaW5lZCh2YWx1ZS55KSA/IHZhbHVlLnkgOiAwLjA7XG4gIGF0dHJpYnV0ZVZhbHVlLnogPSBkZWZpbmVkKHZhbHVlLnopID8gdmFsdWUueiA6IDAuMDtcbiAgYXR0cmlidXRlVmFsdWUudyA9IGRlZmluZWQodmFsdWUudykgPyB2YWx1ZS53IDogMC4wO1xuXG4gIHZhciBvZmZzZXQgPSB0aGlzLl9vZmZzZXRzW2F0dHJpYnV0ZUluZGV4XTtcbiAgdmFyIHN0cmlkZSA9IHRoaXMuX3N0cmlkZTtcbiAgdmFyIGluZGV4ID0gNCAqIHN0cmlkZSAqIGluc3RhbmNlSW5kZXggKyA0ICogb2Zmc2V0O1xuXG4gIGlmIChcbiAgICB0aGlzLl9wYWNrRmxvYXRzICYmXG4gICAgYXR0cmlidXRlc1thdHRyaWJ1dGVJbmRleF0uY29tcG9uZW50RGF0YXR5cGUgIT09IFBpeGVsRGF0YXR5cGUuVU5TSUdORURfQllURVxuICApIHtcbiAgICBzZXRQYWNrZWRBdHRyaWJ1dGUoYXR0cmlidXRlVmFsdWUsIHRoaXMuX2JhdGNoVmFsdWVzLCBpbmRleCk7XG4gIH0gZWxzZSB7XG4gICAgQ2FydGVzaWFuNC5wYWNrKGF0dHJpYnV0ZVZhbHVlLCB0aGlzLl9iYXRjaFZhbHVlcywgaW5kZXgpO1xuICB9XG5cbiAgdGhpcy5fYmF0Y2hWYWx1ZXNEaXJ0eSA9IHRydWU7XG59O1xuXG5mdW5jdGlvbiBjcmVhdGVUZXh0dXJlKGJhdGNoVGFibGUsIGNvbnRleHQpIHtcbiAgdmFyIGRpbWVuc2lvbnMgPSBiYXRjaFRhYmxlLl90ZXh0dXJlRGltZW5zaW9ucztcbiAgYmF0Y2hUYWJsZS5fdGV4dHVyZSA9IG5ldyBUZXh0dXJlKHtcbiAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIHBpeGVsRm9ybWF0OiBQaXhlbEZvcm1hdC5SR0JBLFxuICAgIHBpeGVsRGF0YXR5cGU6IGJhdGNoVGFibGUuX3BpeGVsRGF0YXR5cGUsXG4gICAgd2lkdGg6IGRpbWVuc2lvbnMueCxcbiAgICBoZWlnaHQ6IGRpbWVuc2lvbnMueSxcbiAgICBzYW1wbGVyOiBTYW1wbGVyLk5FQVJFU1QsXG4gICAgZmxpcFk6IGZhbHNlLFxuICB9KTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlVGV4dHVyZShiYXRjaFRhYmxlKSB7XG4gIHZhciBkaW1lbnNpb25zID0gYmF0Y2hUYWJsZS5fdGV4dHVyZURpbWVuc2lvbnM7XG4gIGJhdGNoVGFibGUuX3RleHR1cmUuY29weUZyb20oe1xuICAgIHNvdXJjZToge1xuICAgICAgd2lkdGg6IGRpbWVuc2lvbnMueCxcbiAgICAgIGhlaWdodDogZGltZW5zaW9ucy55LFxuICAgICAgYXJyYXlCdWZmZXJWaWV3OiBiYXRjaFRhYmxlLl9iYXRjaFZhbHVlcyxcbiAgICB9LFxuICB9KTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzL3VwZGF0ZXMgdGhlIGJhdGNoIHRhYmxlIHRleHR1cmUuXG4gKiBAcGFyYW0ge0ZyYW1lU3RhdGV9IGZyYW1lU3RhdGUgVGhlIGZyYW1lIHN0YXRlLlxuICpcbiAqIEBleGNlcHRpb24ge1J1bnRpbWVFcnJvcn0gVGhlIGZsb2F0aW5nIHBvaW50IHRleHR1cmUgZXh0ZW5zaW9uIGlzIHJlcXVpcmVkIGJ1dCBub3Qgc3VwcG9ydGVkLlxuICovXG5CYXRjaFRhYmxlLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZnJhbWVTdGF0ZSkge1xuICBpZiAoXG4gICAgKGRlZmluZWQodGhpcy5fdGV4dHVyZSkgJiYgIXRoaXMuX2JhdGNoVmFsdWVzRGlydHkpIHx8XG4gICAgdGhpcy5fYXR0cmlidXRlcy5sZW5ndGggPT09IDBcbiAgKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy5fYmF0Y2hWYWx1ZXNEaXJ0eSA9IGZhbHNlO1xuXG4gIGlmICghZGVmaW5lZCh0aGlzLl90ZXh0dXJlKSkge1xuICAgIGNyZWF0ZVRleHR1cmUodGhpcywgZnJhbWVTdGF0ZS5jb250ZXh0KTtcbiAgfVxuICB1cGRhdGVUZXh0dXJlKHRoaXMpO1xufTtcblxuLyoqXG4gKiBHZXRzIGEgZnVuY3Rpb24gdGhhdCB3aWxsIHVwZGF0ZSBhIHVuaWZvcm0gbWFwIHRvIGNvbnRhaW4gdmFsdWVzIGZvciBsb29raW5nIHVwIHZhbHVlcyBpbiB0aGUgYmF0Y2ggdGFibGUuXG4gKlxuICogQHJldHVybnMge0JhdGNoVGFibGUudXBkYXRlVW5pZm9ybU1hcENhbGxiYWNrfSBBIGNhbGxiYWNrIGZvciB1cGRhdGluZyB1bmlmb3JtIG1hcHMuXG4gKi9cbkJhdGNoVGFibGUucHJvdG90eXBlLmdldFVuaWZvcm1NYXBDYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHRoYXQgPSB0aGlzO1xuICByZXR1cm4gZnVuY3Rpb24gKHVuaWZvcm1NYXApIHtcbiAgICBpZiAodGhhdC5fYXR0cmlidXRlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB1bmlmb3JtTWFwO1xuICAgIH1cblxuICAgIHZhciBiYXRjaFVuaWZvcm1NYXAgPSB7XG4gICAgICBiYXRjaFRleHR1cmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoYXQuX3RleHR1cmU7XG4gICAgICB9LFxuICAgICAgYmF0Y2hUZXh0dXJlRGltZW5zaW9uczogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhhdC5fdGV4dHVyZURpbWVuc2lvbnM7XG4gICAgICB9LFxuICAgICAgYmF0Y2hUZXh0dXJlU3RlcDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhhdC5fdGV4dHVyZVN0ZXA7XG4gICAgICB9LFxuICAgIH07XG4gICAgcmV0dXJuIGNvbWJpbmUodW5pZm9ybU1hcCwgYmF0Y2hVbmlmb3JtTWFwKTtcbiAgfTtcbn07XG5cbmZ1bmN0aW9uIGdldEdsc2xDb21wdXRlU3QoYmF0Y2hUYWJsZSkge1xuICB2YXIgc3RyaWRlID0gYmF0Y2hUYWJsZS5fc3RyaWRlO1xuXG4gIC8vIEdMU0wgYmF0Y2hJZCBpcyB6ZXJvLWJhc2VkOiBbMCwgbnVtYmVyT2ZJbnN0YW5jZXMgLSAxXVxuICBpZiAoYmF0Y2hUYWJsZS5fdGV4dHVyZURpbWVuc2lvbnMueSA9PT0gMSkge1xuICAgIHJldHVybiAoXG4gICAgICBcInVuaWZvcm0gdmVjNCBiYXRjaFRleHR1cmVTdGVwOyBcXG5cIiArXG4gICAgICBcInZlYzIgY29tcHV0ZVN0KGZsb2F0IGJhdGNoSWQpIFxcblwiICtcbiAgICAgIFwieyBcXG5cIiArXG4gICAgICBcIiAgICBmbG9hdCBzdGVwWCA9IGJhdGNoVGV4dHVyZVN0ZXAueDsgXFxuXCIgK1xuICAgICAgXCIgICAgZmxvYXQgY2VudGVyWCA9IGJhdGNoVGV4dHVyZVN0ZXAueTsgXFxuXCIgK1xuICAgICAgXCIgICAgZmxvYXQgbnVtYmVyT2ZBdHRyaWJ1dGVzID0gZmxvYXQoXCIgK1xuICAgICAgc3RyaWRlICtcbiAgICAgIFwiKTsgXFxuXCIgK1xuICAgICAgXCIgICAgcmV0dXJuIHZlYzIoY2VudGVyWCArIChiYXRjaElkICogbnVtYmVyT2ZBdHRyaWJ1dGVzICogc3RlcFgpLCAwLjUpOyBcXG5cIiArXG4gICAgICBcIn0gXFxuXCJcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICBcInVuaWZvcm0gdmVjNCBiYXRjaFRleHR1cmVTdGVwOyBcXG5cIiArXG4gICAgXCJ1bmlmb3JtIHZlYzIgYmF0Y2hUZXh0dXJlRGltZW5zaW9uczsgXFxuXCIgK1xuICAgIFwidmVjMiBjb21wdXRlU3QoZmxvYXQgYmF0Y2hJZCkgXFxuXCIgK1xuICAgIFwieyBcXG5cIiArXG4gICAgXCIgICAgZmxvYXQgc3RlcFggPSBiYXRjaFRleHR1cmVTdGVwLng7IFxcblwiICtcbiAgICBcIiAgICBmbG9hdCBjZW50ZXJYID0gYmF0Y2hUZXh0dXJlU3RlcC55OyBcXG5cIiArXG4gICAgXCIgICAgZmxvYXQgc3RlcFkgPSBiYXRjaFRleHR1cmVTdGVwLno7IFxcblwiICtcbiAgICBcIiAgICBmbG9hdCBjZW50ZXJZID0gYmF0Y2hUZXh0dXJlU3RlcC53OyBcXG5cIiArXG4gICAgXCIgICAgZmxvYXQgbnVtYmVyT2ZBdHRyaWJ1dGVzID0gZmxvYXQoXCIgK1xuICAgIHN0cmlkZSArXG4gICAgXCIpOyBcXG5cIiArXG4gICAgXCIgICAgZmxvYXQgeElkID0gbW9kKGJhdGNoSWQgKiBudW1iZXJPZkF0dHJpYnV0ZXMsIGJhdGNoVGV4dHVyZURpbWVuc2lvbnMueCk7IFxcblwiICtcbiAgICBcIiAgICBmbG9hdCB5SWQgPSBmbG9vcihiYXRjaElkICogbnVtYmVyT2ZBdHRyaWJ1dGVzIC8gYmF0Y2hUZXh0dXJlRGltZW5zaW9ucy54KTsgXFxuXCIgK1xuICAgIFwiICAgIHJldHVybiB2ZWMyKGNlbnRlclggKyAoeElkICogc3RlcFgpLCBjZW50ZXJZICsgKHlJZCAqIHN0ZXBZKSk7IFxcblwiICtcbiAgICBcIn0gXFxuXCJcbiAgKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q29tcG9uZW50VHlwZShjb21wb25lbnRzUGVyQXR0cmlidXRlKSB7XG4gIGlmIChjb21wb25lbnRzUGVyQXR0cmlidXRlID09PSAxKSB7XG4gICAgcmV0dXJuIFwiZmxvYXRcIjtcbiAgfVxuICByZXR1cm4gXCJ2ZWNcIiArIGNvbXBvbmVudHNQZXJBdHRyaWJ1dGU7XG59XG5cbmZ1bmN0aW9uIGdldENvbXBvbmVudFN3aXp6bGUoY29tcG9uZW50c1BlckF0dHJpYnV0ZSkge1xuICBpZiAoY29tcG9uZW50c1BlckF0dHJpYnV0ZSA9PT0gMSkge1xuICAgIHJldHVybiBcIi54XCI7XG4gIH0gZWxzZSBpZiAoY29tcG9uZW50c1BlckF0dHJpYnV0ZSA9PT0gMikge1xuICAgIHJldHVybiBcIi54eVwiO1xuICB9IGVsc2UgaWYgKGNvbXBvbmVudHNQZXJBdHRyaWJ1dGUgPT09IDMpIHtcbiAgICByZXR1cm4gXCIueHl6XCI7XG4gIH1cbiAgcmV0dXJuIFwiXCI7XG59XG5cbmZ1bmN0aW9uIGdldEdsc2xBdHRyaWJ1dGVGdW5jdGlvbihiYXRjaFRhYmxlLCBhdHRyaWJ1dGVJbmRleCkge1xuICB2YXIgYXR0cmlidXRlcyA9IGJhdGNoVGFibGUuX2F0dHJpYnV0ZXM7XG4gIHZhciBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzW2F0dHJpYnV0ZUluZGV4XTtcbiAgdmFyIGNvbXBvbmVudHNQZXJBdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuY29tcG9uZW50c1BlckF0dHJpYnV0ZTtcbiAgdmFyIGZ1bmN0aW9uTmFtZSA9IGF0dHJpYnV0ZS5mdW5jdGlvbk5hbWU7XG4gIHZhciBmdW5jdGlvblJldHVyblR5cGUgPSBnZXRDb21wb25lbnRUeXBlKGNvbXBvbmVudHNQZXJBdHRyaWJ1dGUpO1xuICB2YXIgZnVuY3Rpb25SZXR1cm5WYWx1ZSA9IGdldENvbXBvbmVudFN3aXp6bGUoY29tcG9uZW50c1BlckF0dHJpYnV0ZSk7XG5cbiAgdmFyIG9mZnNldCA9IGJhdGNoVGFibGUuX29mZnNldHNbYXR0cmlidXRlSW5kZXhdO1xuXG4gIHZhciBnbHNsRnVuY3Rpb24gPVxuICAgIGZ1bmN0aW9uUmV0dXJuVHlwZSArXG4gICAgXCIgXCIgK1xuICAgIGZ1bmN0aW9uTmFtZSArXG4gICAgXCIoZmxvYXQgYmF0Y2hJZCkgXFxuXCIgK1xuICAgIFwieyBcXG5cIiArXG4gICAgXCIgICAgdmVjMiBzdCA9IGNvbXB1dGVTdChiYXRjaElkKTsgXFxuXCIgK1xuICAgIFwiICAgIHN0LnggKz0gYmF0Y2hUZXh0dXJlU3RlcC54ICogZmxvYXQoXCIgK1xuICAgIG9mZnNldCArXG4gICAgXCIpOyBcXG5cIjtcblxuICBpZiAoXG4gICAgYmF0Y2hUYWJsZS5fcGFja0Zsb2F0cyAmJlxuICAgIGF0dHJpYnV0ZS5jb21wb25lbnREYXRhdHlwZSAhPT0gUGl4ZWxEYXRhdHlwZS5VTlNJR05FRF9CWVRFXG4gICkge1xuICAgIGdsc2xGdW5jdGlvbiArPVxuICAgICAgXCJ2ZWM0IHRleHR1cmVWYWx1ZTsgXFxuXCIgK1xuICAgICAgXCJ0ZXh0dXJlVmFsdWUueCA9IGN6bV91bnBhY2tGbG9hdCh0ZXh0dXJlMkQoYmF0Y2hUZXh0dXJlLCBzdCkpOyBcXG5cIiArXG4gICAgICBcInRleHR1cmVWYWx1ZS55ID0gY3ptX3VucGFja0Zsb2F0KHRleHR1cmUyRChiYXRjaFRleHR1cmUsIHN0ICsgdmVjMihiYXRjaFRleHR1cmVTdGVwLngsIDAuMCkpKTsgXFxuXCIgK1xuICAgICAgXCJ0ZXh0dXJlVmFsdWUueiA9IGN6bV91bnBhY2tGbG9hdCh0ZXh0dXJlMkQoYmF0Y2hUZXh0dXJlLCBzdCArIHZlYzIoYmF0Y2hUZXh0dXJlU3RlcC54ICogMi4wLCAwLjApKSk7IFxcblwiICtcbiAgICAgIFwidGV4dHVyZVZhbHVlLncgPSBjem1fdW5wYWNrRmxvYXQodGV4dHVyZTJEKGJhdGNoVGV4dHVyZSwgc3QgKyB2ZWMyKGJhdGNoVGV4dHVyZVN0ZXAueCAqIDMuMCwgMC4wKSkpOyBcXG5cIjtcbiAgfSBlbHNlIHtcbiAgICBnbHNsRnVuY3Rpb24gKz0gXCIgICAgdmVjNCB0ZXh0dXJlVmFsdWUgPSB0ZXh0dXJlMkQoYmF0Y2hUZXh0dXJlLCBzdCk7IFxcblwiO1xuICB9XG5cbiAgZ2xzbEZ1bmN0aW9uICs9XG4gICAgXCIgICAgXCIgK1xuICAgIGZ1bmN0aW9uUmV0dXJuVHlwZSArXG4gICAgXCIgdmFsdWUgPSB0ZXh0dXJlVmFsdWVcIiArXG4gICAgZnVuY3Rpb25SZXR1cm5WYWx1ZSArXG4gICAgXCI7IFxcblwiO1xuXG4gIGlmIChcbiAgICBiYXRjaFRhYmxlLl9waXhlbERhdGF0eXBlID09PSBQaXhlbERhdGF0eXBlLlVOU0lHTkVEX0JZVEUgJiZcbiAgICBhdHRyaWJ1dGUuY29tcG9uZW50RGF0YXR5cGUgPT09IENvbXBvbmVudERhdGF0eXBlLlVOU0lHTkVEX0JZVEUgJiZcbiAgICAhYXR0cmlidXRlLm5vcm1hbGl6ZVxuICApIHtcbiAgICBnbHNsRnVuY3Rpb24gKz0gXCJ2YWx1ZSAqPSAyNTUuMDsgXFxuXCI7XG4gIH0gZWxzZSBpZiAoXG4gICAgYmF0Y2hUYWJsZS5fcGl4ZWxEYXRhdHlwZSA9PT0gUGl4ZWxEYXRhdHlwZS5GTE9BVCAmJlxuICAgIGF0dHJpYnV0ZS5jb21wb25lbnREYXRhdHlwZSA9PT0gQ29tcG9uZW50RGF0YXR5cGUuVU5TSUdORURfQllURSAmJlxuICAgIGF0dHJpYnV0ZS5ub3JtYWxpemVcbiAgKSB7XG4gICAgZ2xzbEZ1bmN0aW9uICs9IFwidmFsdWUgLz0gMjU1LjA7IFxcblwiO1xuICB9XG5cbiAgZ2xzbEZ1bmN0aW9uICs9IFwiICAgIHJldHVybiB2YWx1ZTsgXFxuXCIgKyBcIn0gXFxuXCI7XG4gIHJldHVybiBnbHNsRnVuY3Rpb247XG59XG5cbi8qKlxuICogR2V0cyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCB1cGRhdGUgYSB2ZXJ0ZXggc2hhZGVyIHRvIGNvbnRhaW4gZnVuY3Rpb25zIGZvciBsb29raW5nIHVwIHZhbHVlcyBpbiB0aGUgYmF0Y2ggdGFibGUuXG4gKlxuICogQHJldHVybnMge0JhdGNoVGFibGUudXBkYXRlVmVydGV4U2hhZGVyU291cmNlQ2FsbGJhY2t9IEEgY2FsbGJhY2sgZm9yIHVwZGF0aW5nIGEgdmVydGV4IHNoYWRlciBzb3VyY2UuXG4gKi9cbkJhdGNoVGFibGUucHJvdG90eXBlLmdldFZlcnRleFNoYWRlckNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICB2YXIgYXR0cmlidXRlcyA9IHRoaXMuX2F0dHJpYnV0ZXM7XG4gIGlmIChhdHRyaWJ1dGVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgICByZXR1cm4gc291cmNlO1xuICAgIH07XG4gIH1cblxuICB2YXIgYmF0Y2hUYWJsZVNoYWRlciA9IFwidW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgYmF0Y2hUZXh0dXJlOyBcXG5cIjtcbiAgYmF0Y2hUYWJsZVNoYWRlciArPSBnZXRHbHNsQ29tcHV0ZVN0KHRoaXMpICsgXCJcXG5cIjtcblxuICB2YXIgbGVuZ3RoID0gYXR0cmlidXRlcy5sZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICBiYXRjaFRhYmxlU2hhZGVyICs9IGdldEdsc2xBdHRyaWJ1dGVGdW5jdGlvbih0aGlzLCBpKTtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgdmFyIG1haW5JbmRleCA9IHNvdXJjZS5pbmRleE9mKFwidm9pZCBtYWluXCIpO1xuICAgIHZhciBiZWZvcmVNYWluID0gc291cmNlLnN1YnN0cmluZygwLCBtYWluSW5kZXgpO1xuICAgIHZhciBhZnRlck1haW4gPSBzb3VyY2Uuc3Vic3RyaW5nKG1haW5JbmRleCk7XG4gICAgcmV0dXJuIGJlZm9yZU1haW4gKyBcIlxcblwiICsgYmF0Y2hUYWJsZVNoYWRlciArIFwiXFxuXCIgKyBhZnRlck1haW47XG4gIH07XG59O1xuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIG9iamVjdCB3YXMgZGVzdHJveWVkOyBvdGhlcndpc2UsIGZhbHNlLlxuICogPGJyIC8+PGJyIC8+XG4gKiBJZiB0aGlzIG9iamVjdCB3YXMgZGVzdHJveWVkLCBpdCBzaG91bGQgbm90IGJlIHVzZWQ7IGNhbGxpbmcgYW55IGZ1bmN0aW9uIG90aGVyIHRoYW5cbiAqIDxjb2RlPmlzRGVzdHJveWVkPC9jb2RlPiB3aWxsIHJlc3VsdCBpbiBhIHtAbGluayBEZXZlbG9wZXJFcnJvcn0gZXhjZXB0aW9uLlxuICpcbiAqIEByZXR1cm5zIHtCb29sZWFufSA8Y29kZT50cnVlPC9jb2RlPiBpZiB0aGlzIG9iamVjdCB3YXMgZGVzdHJveWVkOyBvdGhlcndpc2UsIDxjb2RlPmZhbHNlPC9jb2RlPi5cbiAqXG4gKiBAc2VlIEJhdGNoVGFibGUjZGVzdHJveVxuICovXG5CYXRjaFRhYmxlLnByb3RvdHlwZS5pc0Rlc3Ryb3llZCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyoqXG4gKiBEZXN0cm95cyB0aGUgV2ViR0wgcmVzb3VyY2VzIGhlbGQgYnkgdGhpcyBvYmplY3QuICBEZXN0cm95aW5nIGFuIG9iamVjdCBhbGxvd3MgZm9yIGRldGVybWluaXN0aWNcbiAqIHJlbGVhc2Ugb2YgV2ViR0wgcmVzb3VyY2VzLCBpbnN0ZWFkIG9mIHJlbHlpbmcgb24gdGhlIGdhcmJhZ2UgY29sbGVjdG9yIHRvIGRlc3Ryb3kgdGhpcyBvYmplY3QuXG4gKiA8YnIgLz48YnIgLz5cbiAqIE9uY2UgYW4gb2JqZWN0IGlzIGRlc3Ryb3llZCwgaXQgc2hvdWxkIG5vdCBiZSB1c2VkOyBjYWxsaW5nIGFueSBmdW5jdGlvbiBvdGhlciB0aGFuXG4gKiA8Y29kZT5pc0Rlc3Ryb3llZDwvY29kZT4gd2lsbCByZXN1bHQgaW4gYSB7QGxpbmsgRGV2ZWxvcGVyRXJyb3J9IGV4Y2VwdGlvbi4gIFRoZXJlZm9yZSxcbiAqIGFzc2lnbiB0aGUgcmV0dXJuIHZhbHVlICg8Y29kZT51bmRlZmluZWQ8L2NvZGU+KSB0byB0aGUgb2JqZWN0IGFzIGRvbmUgaW4gdGhlIGV4YW1wbGUuXG4gKlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IFRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQsIGkuZS4sIGRlc3Ryb3koKSB3YXMgY2FsbGVkLlxuICpcbiAqIEBzZWUgQmF0Y2hUYWJsZSNpc0Rlc3Ryb3llZFxuICovXG5CYXRjaFRhYmxlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLl90ZXh0dXJlID0gdGhpcy5fdGV4dHVyZSAmJiB0aGlzLl90ZXh0dXJlLmRlc3Ryb3koKTtcbiAgcmV0dXJuIGRlc3Ryb3lPYmplY3QodGhpcyk7XG59O1xuXG4vKipcbiAqIEEgY2FsbGJhY2sgZm9yIHVwZGF0aW5nIHVuaWZvcm0gbWFwcy5cbiAqIEBjYWxsYmFjayBCYXRjaFRhYmxlLnVwZGF0ZVVuaWZvcm1NYXBDYWxsYmFja1xuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSB1bmlmb3JtTWFwIFRoZSB1bmlmb3JtIG1hcC5cbiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBuZXcgdW5pZm9ybSBtYXAgd2l0aCBwcm9wZXJ0aWVzIGZvciByZXRyaWV2aW5nIHZhbHVlcyBmcm9tIHRoZSBiYXRjaCB0YWJsZS5cbiAqL1xuXG4vKipcbiAqIEEgY2FsbGJhY2sgZm9yIHVwZGF0aW5nIGEgdmVydGV4IHNoYWRlciBzb3VyY2UuXG4gKiBAY2FsbGJhY2sgQmF0Y2hUYWJsZS51cGRhdGVWZXJ0ZXhTaGFkZXJTb3VyY2VDYWxsYmFja1xuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSB2ZXJ0ZXhTaGFkZXJTb3VyY2UgVGhlIHZlcnRleCBzaGFkZXIgc291cmNlLlxuICogQHJldHVybnMge1N0cmluZ30gVGhlIG5ldyB2ZXJ0ZXggc2hhZGVyIHNvdXJjZSB3aXRoIHRoZSBmdW5jdGlvbnMgZm9yIHJldHJpZXZpbmcgYmF0Y2ggdGFibGUgdmFsdWVzIGluamVjdGVkLlxuICovXG5leHBvcnQgZGVmYXVsdCBCYXRjaFRhYmxlO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///7164\n')},40384:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "Z": function() { return /* binding */ BatchTableHierarchy; }\n/* harmony export */ });\n/* harmony import */ var _Core_arrayFill_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(23401);\n/* harmony import */ var _AttributeType_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(77072);\n/* harmony import */ var _Core_Check_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(66553);\n/* harmony import */ var _Core_clone_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(83856);\n/* harmony import */ var _Core_combine_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(8182);\n/* harmony import */ var _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(84828);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(82982);\n/* harmony import */ var _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(62200);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(12572);\n/* harmony import */ var _getBinaryAccessor_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(17041);\n/* harmony import */ var _Core_RuntimeError_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(9407);\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Object for handling the <code>3DTILES_batch_table_hierarchy</code> extension\n *\n * @param {Object} options Object with the following properties:\n * @param {Object} options.extension The <code>3DTILES_batch_table_hierarchy</code> extension object.\n * @param {Uint8Array} [options.binaryBody] The binary body of the batch table\n *\n * @alias BatchTableHierarchy\n * @constructor\n *\n * @private\n */\nfunction BatchTableHierarchy(options) {\n  this._classes = undefined;\n  this._classIds = undefined;\n  this._classIndexes = undefined;\n  this._parentCounts = undefined;\n  this._parentIndexes = undefined;\n  this._parentIds = undefined;\n\n  //>>includeStart(\'debug\', pragmas.debug);\n  _Core_Check_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].typeOf.object */ .Z.typeOf.object("options.extension", options.extension);\n  //>>includeEnd(\'debug\');\n\n  initialize(this, options.extension, options.binaryBody);\n\n  //>>includeStart(\'debug\', pragmas.debug);\n  validateHierarchy(this);\n  //>>includeEnd(\'debug\');\n}\n\n/**\n * Parse the batch table hierarchy from the\n * <code>3DTILES_batch_table_hierarchy</code> extension.\n *\n * @param {BatchTableHierarchy} hierarchy The hierarchy instance\n * @param {Object} hierarchyJson The JSON of the extension\n * @param {Uint8Array} [binaryBody] The binary body of the batch table for accessing binary properties\n * @private\n */\nfunction initialize(hierarchy, hierarchyJson, binaryBody) {\n  var i;\n  var classId;\n  var binaryAccessor;\n\n  var instancesLength = hierarchyJson.instancesLength;\n  var classes = hierarchyJson.classes;\n  var classIds = hierarchyJson.classIds;\n  var parentCounts = hierarchyJson.parentCounts;\n  var parentIds = hierarchyJson.parentIds;\n  var parentIdsLength = instancesLength;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(classIds.byteOffset)) {\n    classIds.componentType = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z)(\n      classIds.componentType,\n      _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].UNSIGNED_SHORT */ .Z.UNSIGNED_SHORT\n    );\n    classIds.type = _AttributeType_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].SCALAR */ .Z.SCALAR;\n    binaryAccessor = (0,_getBinaryAccessor_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z)(classIds);\n    classIds = binaryAccessor.createArrayBufferView(\n      binaryBody.buffer,\n      binaryBody.byteOffset + classIds.byteOffset,\n      instancesLength\n    );\n  }\n\n  var parentIndexes;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(parentCounts)) {\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(parentCounts.byteOffset)) {\n      parentCounts.componentType = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z)(\n        parentCounts.componentType,\n        _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].UNSIGNED_SHORT */ .Z.UNSIGNED_SHORT\n      );\n      parentCounts.type = _AttributeType_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].SCALAR */ .Z.SCALAR;\n      binaryAccessor = (0,_getBinaryAccessor_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z)(parentCounts);\n      parentCounts = binaryAccessor.createArrayBufferView(\n        binaryBody.buffer,\n        binaryBody.byteOffset + parentCounts.byteOffset,\n        instancesLength\n      );\n    }\n    parentIndexes = new Uint16Array(instancesLength);\n    parentIdsLength = 0;\n    for (i = 0; i < instancesLength; ++i) {\n      parentIndexes[i] = parentIdsLength;\n      parentIdsLength += parentCounts[i];\n    }\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(parentIds) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(parentIds.byteOffset)) {\n    parentIds.componentType = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z)(\n      parentIds.componentType,\n      _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].UNSIGNED_SHORT */ .Z.UNSIGNED_SHORT\n    );\n    parentIds.type = _AttributeType_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].SCALAR */ .Z.SCALAR;\n    binaryAccessor = (0,_getBinaryAccessor_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z)(parentIds);\n    parentIds = binaryAccessor.createArrayBufferView(\n      binaryBody.buffer,\n      binaryBody.byteOffset + parentIds.byteOffset,\n      parentIdsLength\n    );\n  }\n\n  var classesLength = classes.length;\n  for (i = 0; i < classesLength; ++i) {\n    var classInstancesLength = classes[i].length;\n    var properties = classes[i].instances;\n    var binaryProperties = getBinaryProperties(\n      classInstancesLength,\n      properties,\n      binaryBody\n    );\n    classes[i].instances = (0,_Core_combine_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z)(binaryProperties, properties);\n  }\n\n  var classCounts = (0,_Core_arrayFill_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z)(new Array(classesLength), 0);\n  var classIndexes = new Uint16Array(instancesLength);\n  for (i = 0; i < instancesLength; ++i) {\n    classId = classIds[i];\n    classIndexes[i] = classCounts[classId];\n    ++classCounts[classId];\n  }\n\n  hierarchy._classes = classes;\n  hierarchy._classIds = classIds;\n  hierarchy._classIndexes = classIndexes;\n  hierarchy._parentCounts = parentCounts;\n  hierarchy._parentIndexes = parentIndexes;\n  hierarchy._parentIds = parentIds;\n}\n\nfunction getBinaryProperties(featuresLength, properties, binaryBody) {\n  var binaryProperties;\n  for (var name in properties) {\n    if (properties.hasOwnProperty(name)) {\n      var property = properties[name];\n      var byteOffset = property.byteOffset;\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(byteOffset)) {\n        // This is a binary property\n        var componentType = property.componentType;\n        var type = property.type;\n        if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(componentType)) {\n          throw new _Core_RuntimeError_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z("componentType is required.");\n        }\n        if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(type)) {\n          throw new _Core_RuntimeError_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z("type is required.");\n        }\n        if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(binaryBody)) {\n          throw new _Core_RuntimeError_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z(\n            "Property " + name + " requires a batch table binary."\n          );\n        }\n\n        var binaryAccessor = (0,_getBinaryAccessor_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z)(property);\n        var componentCount = binaryAccessor.componentsPerAttribute;\n        var classType = binaryAccessor.classType;\n        var typedArray = binaryAccessor.createArrayBufferView(\n          binaryBody.buffer,\n          binaryBody.byteOffset + byteOffset,\n          featuresLength\n        );\n\n        if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(binaryProperties)) {\n          binaryProperties = {};\n        }\n\n        // Store any information needed to access the binary data, including the typed array,\n        // componentCount (e.g. a VEC4 would be 4), and the type used to pack and unpack (e.g. Cartesian4).\n        binaryProperties[name] = {\n          typedArray: typedArray,\n          componentCount: componentCount,\n          type: classType,\n        };\n      }\n    }\n  }\n  return binaryProperties;\n}\n\n//>>includeStart(\'debug\', pragmas.debug);\nvar scratchValidateStack = [];\nfunction validateHierarchy(hierarchy) {\n  var stack = scratchValidateStack;\n  stack.length = 0;\n\n  var classIds = hierarchy._classIds;\n  var instancesLength = classIds.length;\n\n  for (var i = 0; i < instancesLength; ++i) {\n    validateInstance(hierarchy, i, stack);\n  }\n}\n\nfunction validateInstance(hierarchy, instanceIndex, stack) {\n  var parentCounts = hierarchy._parentCounts;\n  var parentIds = hierarchy._parentIds;\n  var parentIndexes = hierarchy._parentIndexes;\n  var classIds = hierarchy._classIds;\n  var instancesLength = classIds.length;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(parentIds)) {\n    // No need to validate if there are no parents\n    return;\n  }\n\n  if (instanceIndex >= instancesLength) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z(\n      "Parent index " +\n        instanceIndex +\n        " exceeds the total number of instances: " +\n        instancesLength\n    );\n  }\n  if (stack.indexOf(instanceIndex) > -1) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z(\n      "Circular dependency detected in the batch table hierarchy."\n    );\n  }\n\n  stack.push(instanceIndex);\n  var parentCount = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(parentCounts) ? parentCounts[instanceIndex] : 1;\n  var parentIndex = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(parentCounts)\n    ? parentIndexes[instanceIndex]\n    : instanceIndex;\n  for (var i = 0; i < parentCount; ++i) {\n    var parentId = parentIds[parentIndex + i];\n    // Stop the traversal when the instance has no parent (its parentId equals itself), else continue the traversal.\n    if (parentId !== instanceIndex) {\n      validateInstance(hierarchy, parentId, stack);\n    }\n  }\n  stack.pop(instanceIndex);\n}\n//>>includeEnd(\'debug\');\n\n// The size of this array equals the maximum instance count among all loaded tiles, which has the potential to be large.\nvar scratchVisited = [];\nvar scratchStack = [];\nvar marker = 0;\nfunction traverseHierarchyMultipleParents(\n  hierarchy,\n  instanceIndex,\n  endConditionCallback\n) {\n  var classIds = hierarchy._classIds;\n  var parentCounts = hierarchy._parentCounts;\n  var parentIds = hierarchy._parentIds;\n  var parentIndexes = hierarchy._parentIndexes;\n  var instancesLength = classIds.length;\n\n  // Ignore instances that have already been visited. This occurs in diamond inheritance situations.\n  // Use a marker value to indicate that an instance has been visited, which increments with each run.\n  // This is more efficient than clearing the visited array every time.\n  var visited = scratchVisited;\n  visited.length = Math.max(visited.length, instancesLength);\n  var visitedMarker = ++marker;\n\n  var stack = scratchStack;\n  stack.length = 0;\n  stack.push(instanceIndex);\n\n  while (stack.length > 0) {\n    instanceIndex = stack.pop();\n    if (visited[instanceIndex] === visitedMarker) {\n      // This instance has already been visited, stop traversal\n      continue;\n    }\n    visited[instanceIndex] = visitedMarker;\n    var result = endConditionCallback(hierarchy, instanceIndex);\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(result)) {\n      // The end condition was met, stop the traversal and return the result\n      return result;\n    }\n    var parentCount = parentCounts[instanceIndex];\n    var parentIndex = parentIndexes[instanceIndex];\n    for (var i = 0; i < parentCount; ++i) {\n      var parentId = parentIds[parentIndex + i];\n      // Stop the traversal when the instance has no parent (its parentId equals itself)\n      // else add the parent to the stack to continue the traversal.\n      if (parentId !== instanceIndex) {\n        stack.push(parentId);\n      }\n    }\n  }\n}\n\nfunction traverseHierarchySingleParent(\n  hierarchy,\n  instanceIndex,\n  endConditionCallback\n) {\n  var hasParent = true;\n  while (hasParent) {\n    var result = endConditionCallback(hierarchy, instanceIndex);\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(result)) {\n      // The end condition was met, stop the traversal and return the result\n      return result;\n    }\n    var parentId = hierarchy._parentIds[instanceIndex];\n    hasParent = parentId !== instanceIndex;\n    instanceIndex = parentId;\n  }\n}\n\nfunction traverseHierarchy(hierarchy, instanceIndex, endConditionCallback) {\n  // Traverse over the hierarchy and process each instance with the endConditionCallback.\n  // When the endConditionCallback returns a value, the traversal stops and that value is returned.\n  var parentCounts = hierarchy._parentCounts;\n  var parentIds = hierarchy._parentIds;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(parentIds)) {\n    return endConditionCallback(hierarchy, instanceIndex);\n  } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(parentCounts)) {\n    return traverseHierarchyMultipleParents(\n      hierarchy,\n      instanceIndex,\n      endConditionCallback\n    );\n  }\n  return traverseHierarchySingleParent(\n    hierarchy,\n    instanceIndex,\n    endConditionCallback\n  );\n}\n\n/**\n * Returns whether the feature has this property.\n *\n * @param {Number} batchId the batch ID of the feature\n * @param {String} propertyId The case-sensitive ID of the property.\n * @returns {Boolean} Whether the feature has this property.\n * @private\n */\nBatchTableHierarchy.prototype.hasProperty = function (batchId, propertyId) {\n  var result = traverseHierarchy(this, batchId, function (\n    hierarchy,\n    instanceIndex\n  ) {\n    var classId = hierarchy._classIds[instanceIndex];\n    var instances = hierarchy._classes[classId].instances;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(instances[propertyId])) {\n      return true;\n    }\n  });\n  return (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(result);\n};\n\n/**\n * Returns whether any feature has this property.\n *\n * @param {String} propertyId The case-sensitive ID of the property.\n * @returns {Boolean} Whether any feature has this property.\n * @private\n */\nBatchTableHierarchy.prototype.propertyExists = function (propertyId) {\n  var classes = this._classes;\n  var classesLength = classes.length;\n  for (var i = 0; i < classesLength; ++i) {\n    var instances = classes[i].instances;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(instances[propertyId])) {\n      return true;\n    }\n  }\n  return false;\n};\n\n/**\n * Returns an array of property IDs.\n *\n * @param {Number} batchId the batch ID of the feature\n * @param {Number} index The index of the entity.\n * @param {String[]} [results] An array into which to store the results.\n * @returns {String[]} The property IDs.\n * @private\n */\nBatchTableHierarchy.prototype.getPropertyIds = function (batchId, results) {\n  results = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(results) ? results : [];\n  results.length = 0;\n\n  traverseHierarchy(this, batchId, function (hierarchy, instanceIndex) {\n    var classId = hierarchy._classIds[instanceIndex];\n    var instances = hierarchy._classes[classId].instances;\n    for (var name in instances) {\n      if (instances.hasOwnProperty(name)) {\n        if (results.indexOf(name) === -1) {\n          results.push(name);\n        }\n      }\n    }\n  });\n\n  return results;\n};\n\n/**\n * Returns a copy of the value of the property with the given ID.\n *\n * @param {Number} batchId the batch ID of the feature\n * @param {String} propertyId The case-sensitive ID of the property.\n * @returns {*} The value of the property or <code>undefined</code> if the feature does not have this property.\n * @private\n */\nBatchTableHierarchy.prototype.getProperty = function (batchId, propertyId) {\n  return traverseHierarchy(this, batchId, function (hierarchy, instanceIndex) {\n    var classId = hierarchy._classIds[instanceIndex];\n    var instanceClass = hierarchy._classes[classId];\n    var indexInClass = hierarchy._classIndexes[instanceIndex];\n    var propertyValues = instanceClass.instances[propertyId];\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(propertyValues)) {\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(propertyValues.typedArray)) {\n        return getBinaryProperty(propertyValues, indexInClass);\n      }\n      return (0,_Core_clone_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z)(propertyValues[indexInClass], true);\n    }\n  });\n};\n\nfunction getBinaryProperty(binaryProperty, index) {\n  var typedArray = binaryProperty.typedArray;\n  var componentCount = binaryProperty.componentCount;\n  if (componentCount === 1) {\n    return typedArray[index];\n  }\n  return binaryProperty.type.unpack(typedArray, index * componentCount);\n}\n\n/**\n * Sets the value of the property with the given ID. Only properties of the\n * instance may be set; parent properties may not be set.\n *\n * @param {Number} batchId The batchId of the feature\n * @param {String} propertyId The case-sensitive ID of the property.\n * @param {*} value The value of the property that will be copied.\n * @returns {Boolean} <code>true</code> if the property was set, <code>false</code> otherwise.\n *\n * @exception {DeveloperError} when setting an inherited property\n * @private\n */\nBatchTableHierarchy.prototype.setProperty = function (\n  batchId,\n  propertyId,\n  value\n) {\n  var result = traverseHierarchy(this, batchId, function (\n    hierarchy,\n    instanceIndex\n  ) {\n    var classId = hierarchy._classIds[instanceIndex];\n    var instanceClass = hierarchy._classes[classId];\n    var indexInClass = hierarchy._classIndexes[instanceIndex];\n    var propertyValues = instanceClass.instances[propertyId];\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(propertyValues)) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (instanceIndex !== batchId) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z(\n          \'Inherited property "\' + propertyId + \'" is read-only.\'\n        );\n      }\n      //>>includeEnd(\'debug\');\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(propertyValues.typedArray)) {\n        setBinaryProperty(propertyValues, indexInClass, value);\n      } else {\n        propertyValues[indexInClass] = (0,_Core_clone_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z)(value, true);\n      }\n      return true;\n    }\n  });\n  return (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(result);\n};\n\nfunction setBinaryProperty(binaryProperty, index, value) {\n  var typedArray = binaryProperty.typedArray;\n  var componentCount = binaryProperty.componentCount;\n  if (componentCount === 1) {\n    typedArray[index] = value;\n  } else {\n    binaryProperty.type.pack(value, typedArray, index * componentCount);\n  }\n}\n\n/**\n * Check if a feature belongs to a class with the given name\n *\n * @param {Number} batchId The batch ID of the feature\n * @param {String} className The name of the class\n * @return {Boolean} <code>true</code> if the feature belongs to the class given by className, or <code>false</code> otherwise\n * @private\n */\nBatchTableHierarchy.prototype.isClass = function (batchId, className) {\n  // PERFORMANCE_IDEA : cache results in the ancestor classes to speed up this check if this area becomes a hotspot\n  // PERFORMANCE_IDEA : treat class names as integers for faster comparisons\n  var result = traverseHierarchy(this, batchId, function (\n    hierarchy,\n    instanceIndex\n  ) {\n    var classId = hierarchy._classIds[instanceIndex];\n    var instanceClass = hierarchy._classes[classId];\n    if (instanceClass.name === className) {\n      return true;\n    }\n  });\n  return (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(result);\n};\n\n/**\n * Get the name of the class a given feature belongs to\n *\n * @param {Number} batchId The batch ID of the feature\n * @return {String} The name of the class this feature belongs to\n */\nBatchTableHierarchy.prototype.getClassName = function (batchId) {\n  var classId = this._classIds[batchId];\n  var instanceClass = this._classes[classId];\n  return instanceClass.name;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q25CLFlBQVksUUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92dWUzLXdlYnBhY2s1Ly4vbm9kZV9tb2R1bGVzL2Nlc2l1bS9Tb3VyY2UvU2NlbmUvQmF0Y2hUYWJsZUhpZXJhcmNoeS5qcz80ZDg1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhcnJheUZpbGwgZnJvbSBcIi4uL0NvcmUvYXJyYXlGaWxsLmpzXCI7XG5pbXBvcnQgQXR0cmlidXRlVHlwZSBmcm9tIFwiLi9BdHRyaWJ1dGVUeXBlLmpzXCI7XG5pbXBvcnQgQ2hlY2sgZnJvbSBcIi4uL0NvcmUvQ2hlY2suanNcIjtcbmltcG9ydCBjbG9uZSBmcm9tIFwiLi4vQ29yZS9jbG9uZS5qc1wiO1xuaW1wb3J0IGNvbWJpbmUgZnJvbSBcIi4uL0NvcmUvY29tYmluZS5qc1wiO1xuaW1wb3J0IENvbXBvbmVudERhdGF0eXBlIGZyb20gXCIuLi9Db3JlL0NvbXBvbmVudERhdGF0eXBlLmpzXCI7XG5pbXBvcnQgZGVmaW5lZCBmcm9tIFwiLi4vQ29yZS9kZWZpbmVkLmpzXCI7XG5pbXBvcnQgZGVmYXVsdFZhbHVlIGZyb20gXCIuLi9Db3JlL2RlZmF1bHRWYWx1ZS5qc1wiO1xuaW1wb3J0IERldmVsb3BlckVycm9yIGZyb20gXCIuLi9Db3JlL0RldmVsb3BlckVycm9yLmpzXCI7XG5pbXBvcnQgZ2V0QmluYXJ5QWNjZXNzb3IgZnJvbSBcIi4vZ2V0QmluYXJ5QWNjZXNzb3IuanNcIjtcbmltcG9ydCBSdW50aW1lRXJyb3IgZnJvbSBcIi4uL0NvcmUvUnVudGltZUVycm9yLmpzXCI7XG5cbi8qKlxuICogT2JqZWN0IGZvciBoYW5kbGluZyB0aGUgPGNvZGU+M0RUSUxFU19iYXRjaF90YWJsZV9oaWVyYXJjaHk8L2NvZGU+IGV4dGVuc2lvblxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIE9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zLmV4dGVuc2lvbiBUaGUgPGNvZGU+M0RUSUxFU19iYXRjaF90YWJsZV9oaWVyYXJjaHk8L2NvZGU+IGV4dGVuc2lvbiBvYmplY3QuXG4gKiBAcGFyYW0ge1VpbnQ4QXJyYXl9IFtvcHRpb25zLmJpbmFyeUJvZHldIFRoZSBiaW5hcnkgYm9keSBvZiB0aGUgYmF0Y2ggdGFibGVcbiAqXG4gKiBAYWxpYXMgQmF0Y2hUYWJsZUhpZXJhcmNoeVxuICogQGNvbnN0cnVjdG9yXG4gKlxuICogQHByaXZhdGVcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQmF0Y2hUYWJsZUhpZXJhcmNoeShvcHRpb25zKSB7XG4gIHRoaXMuX2NsYXNzZXMgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2NsYXNzSWRzID0gdW5kZWZpbmVkO1xuICB0aGlzLl9jbGFzc0luZGV4ZXMgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX3BhcmVudENvdW50cyA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fcGFyZW50SW5kZXhlcyA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fcGFyZW50SWRzID0gdW5kZWZpbmVkO1xuXG4gIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gIENoZWNrLnR5cGVPZi5vYmplY3QoXCJvcHRpb25zLmV4dGVuc2lvblwiLCBvcHRpb25zLmV4dGVuc2lvbik7XG4gIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gIGluaXRpYWxpemUodGhpcywgb3B0aW9ucy5leHRlbnNpb24sIG9wdGlvbnMuYmluYXJ5Qm9keSk7XG5cbiAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgdmFsaWRhdGVIaWVyYXJjaHkodGhpcyk7XG4gIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xufVxuXG4vKipcbiAqIFBhcnNlIHRoZSBiYXRjaCB0YWJsZSBoaWVyYXJjaHkgZnJvbSB0aGVcbiAqIDxjb2RlPjNEVElMRVNfYmF0Y2hfdGFibGVfaGllcmFyY2h5PC9jb2RlPiBleHRlbnNpb24uXG4gKlxuICogQHBhcmFtIHtCYXRjaFRhYmxlSGllcmFyY2h5fSBoaWVyYXJjaHkgVGhlIGhpZXJhcmNoeSBpbnN0YW5jZVxuICogQHBhcmFtIHtPYmplY3R9IGhpZXJhcmNoeUpzb24gVGhlIEpTT04gb2YgdGhlIGV4dGVuc2lvblxuICogQHBhcmFtIHtVaW50OEFycmF5fSBbYmluYXJ5Qm9keV0gVGhlIGJpbmFyeSBib2R5IG9mIHRoZSBiYXRjaCB0YWJsZSBmb3IgYWNjZXNzaW5nIGJpbmFyeSBwcm9wZXJ0aWVzXG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBpbml0aWFsaXplKGhpZXJhcmNoeSwgaGllcmFyY2h5SnNvbiwgYmluYXJ5Qm9keSkge1xuICB2YXIgaTtcbiAgdmFyIGNsYXNzSWQ7XG4gIHZhciBiaW5hcnlBY2Nlc3NvcjtcblxuICB2YXIgaW5zdGFuY2VzTGVuZ3RoID0gaGllcmFyY2h5SnNvbi5pbnN0YW5jZXNMZW5ndGg7XG4gIHZhciBjbGFzc2VzID0gaGllcmFyY2h5SnNvbi5jbGFzc2VzO1xuICB2YXIgY2xhc3NJZHMgPSBoaWVyYXJjaHlKc29uLmNsYXNzSWRzO1xuICB2YXIgcGFyZW50Q291bnRzID0gaGllcmFyY2h5SnNvbi5wYXJlbnRDb3VudHM7XG4gIHZhciBwYXJlbnRJZHMgPSBoaWVyYXJjaHlKc29uLnBhcmVudElkcztcbiAgdmFyIHBhcmVudElkc0xlbmd0aCA9IGluc3RhbmNlc0xlbmd0aDtcblxuICBpZiAoZGVmaW5lZChjbGFzc0lkcy5ieXRlT2Zmc2V0KSkge1xuICAgIGNsYXNzSWRzLmNvbXBvbmVudFR5cGUgPSBkZWZhdWx0VmFsdWUoXG4gICAgICBjbGFzc0lkcy5jb21wb25lbnRUeXBlLFxuICAgICAgQ29tcG9uZW50RGF0YXR5cGUuVU5TSUdORURfU0hPUlRcbiAgICApO1xuICAgIGNsYXNzSWRzLnR5cGUgPSBBdHRyaWJ1dGVUeXBlLlNDQUxBUjtcbiAgICBiaW5hcnlBY2Nlc3NvciA9IGdldEJpbmFyeUFjY2Vzc29yKGNsYXNzSWRzKTtcbiAgICBjbGFzc0lkcyA9IGJpbmFyeUFjY2Vzc29yLmNyZWF0ZUFycmF5QnVmZmVyVmlldyhcbiAgICAgIGJpbmFyeUJvZHkuYnVmZmVyLFxuICAgICAgYmluYXJ5Qm9keS5ieXRlT2Zmc2V0ICsgY2xhc3NJZHMuYnl0ZU9mZnNldCxcbiAgICAgIGluc3RhbmNlc0xlbmd0aFxuICAgICk7XG4gIH1cblxuICB2YXIgcGFyZW50SW5kZXhlcztcbiAgaWYgKGRlZmluZWQocGFyZW50Q291bnRzKSkge1xuICAgIGlmIChkZWZpbmVkKHBhcmVudENvdW50cy5ieXRlT2Zmc2V0KSkge1xuICAgICAgcGFyZW50Q291bnRzLmNvbXBvbmVudFR5cGUgPSBkZWZhdWx0VmFsdWUoXG4gICAgICAgIHBhcmVudENvdW50cy5jb21wb25lbnRUeXBlLFxuICAgICAgICBDb21wb25lbnREYXRhdHlwZS5VTlNJR05FRF9TSE9SVFxuICAgICAgKTtcbiAgICAgIHBhcmVudENvdW50cy50eXBlID0gQXR0cmlidXRlVHlwZS5TQ0FMQVI7XG4gICAgICBiaW5hcnlBY2Nlc3NvciA9IGdldEJpbmFyeUFjY2Vzc29yKHBhcmVudENvdW50cyk7XG4gICAgICBwYXJlbnRDb3VudHMgPSBiaW5hcnlBY2Nlc3Nvci5jcmVhdGVBcnJheUJ1ZmZlclZpZXcoXG4gICAgICAgIGJpbmFyeUJvZHkuYnVmZmVyLFxuICAgICAgICBiaW5hcnlCb2R5LmJ5dGVPZmZzZXQgKyBwYXJlbnRDb3VudHMuYnl0ZU9mZnNldCxcbiAgICAgICAgaW5zdGFuY2VzTGVuZ3RoXG4gICAgICApO1xuICAgIH1cbiAgICBwYXJlbnRJbmRleGVzID0gbmV3IFVpbnQxNkFycmF5KGluc3RhbmNlc0xlbmd0aCk7XG4gICAgcGFyZW50SWRzTGVuZ3RoID0gMDtcbiAgICBmb3IgKGkgPSAwOyBpIDwgaW5zdGFuY2VzTGVuZ3RoOyArK2kpIHtcbiAgICAgIHBhcmVudEluZGV4ZXNbaV0gPSBwYXJlbnRJZHNMZW5ndGg7XG4gICAgICBwYXJlbnRJZHNMZW5ndGggKz0gcGFyZW50Q291bnRzW2ldO1xuICAgIH1cbiAgfVxuXG4gIGlmIChkZWZpbmVkKHBhcmVudElkcykgJiYgZGVmaW5lZChwYXJlbnRJZHMuYnl0ZU9mZnNldCkpIHtcbiAgICBwYXJlbnRJZHMuY29tcG9uZW50VHlwZSA9IGRlZmF1bHRWYWx1ZShcbiAgICAgIHBhcmVudElkcy5jb21wb25lbnRUeXBlLFxuICAgICAgQ29tcG9uZW50RGF0YXR5cGUuVU5TSUdORURfU0hPUlRcbiAgICApO1xuICAgIHBhcmVudElkcy50eXBlID0gQXR0cmlidXRlVHlwZS5TQ0FMQVI7XG4gICAgYmluYXJ5QWNjZXNzb3IgPSBnZXRCaW5hcnlBY2Nlc3NvcihwYXJlbnRJZHMpO1xuICAgIHBhcmVudElkcyA9IGJpbmFyeUFjY2Vzc29yLmNyZWF0ZUFycmF5QnVmZmVyVmlldyhcbiAgICAgIGJpbmFyeUJvZHkuYnVmZmVyLFxuICAgICAgYmluYXJ5Qm9keS5ieXRlT2Zmc2V0ICsgcGFyZW50SWRzLmJ5dGVPZmZzZXQsXG4gICAgICBwYXJlbnRJZHNMZW5ndGhcbiAgICApO1xuICB9XG5cbiAgdmFyIGNsYXNzZXNMZW5ndGggPSBjbGFzc2VzLmxlbmd0aDtcbiAgZm9yIChpID0gMDsgaSA8IGNsYXNzZXNMZW5ndGg7ICsraSkge1xuICAgIHZhciBjbGFzc0luc3RhbmNlc0xlbmd0aCA9IGNsYXNzZXNbaV0ubGVuZ3RoO1xuICAgIHZhciBwcm9wZXJ0aWVzID0gY2xhc3Nlc1tpXS5pbnN0YW5jZXM7XG4gICAgdmFyIGJpbmFyeVByb3BlcnRpZXMgPSBnZXRCaW5hcnlQcm9wZXJ0aWVzKFxuICAgICAgY2xhc3NJbnN0YW5jZXNMZW5ndGgsXG4gICAgICBwcm9wZXJ0aWVzLFxuICAgICAgYmluYXJ5Qm9keVxuICAgICk7XG4gICAgY2xhc3Nlc1tpXS5pbnN0YW5jZXMgPSBjb21iaW5lKGJpbmFyeVByb3BlcnRpZXMsIHByb3BlcnRpZXMpO1xuICB9XG5cbiAgdmFyIGNsYXNzQ291bnRzID0gYXJyYXlGaWxsKG5ldyBBcnJheShjbGFzc2VzTGVuZ3RoKSwgMCk7XG4gIHZhciBjbGFzc0luZGV4ZXMgPSBuZXcgVWludDE2QXJyYXkoaW5zdGFuY2VzTGVuZ3RoKTtcbiAgZm9yIChpID0gMDsgaSA8IGluc3RhbmNlc0xlbmd0aDsgKytpKSB7XG4gICAgY2xhc3NJZCA9IGNsYXNzSWRzW2ldO1xuICAgIGNsYXNzSW5kZXhlc1tpXSA9IGNsYXNzQ291bnRzW2NsYXNzSWRdO1xuICAgICsrY2xhc3NDb3VudHNbY2xhc3NJZF07XG4gIH1cblxuICBoaWVyYXJjaHkuX2NsYXNzZXMgPSBjbGFzc2VzO1xuICBoaWVyYXJjaHkuX2NsYXNzSWRzID0gY2xhc3NJZHM7XG4gIGhpZXJhcmNoeS5fY2xhc3NJbmRleGVzID0gY2xhc3NJbmRleGVzO1xuICBoaWVyYXJjaHkuX3BhcmVudENvdW50cyA9IHBhcmVudENvdW50cztcbiAgaGllcmFyY2h5Ll9wYXJlbnRJbmRleGVzID0gcGFyZW50SW5kZXhlcztcbiAgaGllcmFyY2h5Ll9wYXJlbnRJZHMgPSBwYXJlbnRJZHM7XG59XG5cbmZ1bmN0aW9uIGdldEJpbmFyeVByb3BlcnRpZXMoZmVhdHVyZXNMZW5ndGgsIHByb3BlcnRpZXMsIGJpbmFyeUJvZHkpIHtcbiAgdmFyIGJpbmFyeVByb3BlcnRpZXM7XG4gIGZvciAodmFyIG5hbWUgaW4gcHJvcGVydGllcykge1xuICAgIGlmIChwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KG5hbWUpKSB7XG4gICAgICB2YXIgcHJvcGVydHkgPSBwcm9wZXJ0aWVzW25hbWVdO1xuICAgICAgdmFyIGJ5dGVPZmZzZXQgPSBwcm9wZXJ0eS5ieXRlT2Zmc2V0O1xuICAgICAgaWYgKGRlZmluZWQoYnl0ZU9mZnNldCkpIHtcbiAgICAgICAgLy8gVGhpcyBpcyBhIGJpbmFyeSBwcm9wZXJ0eVxuICAgICAgICB2YXIgY29tcG9uZW50VHlwZSA9IHByb3BlcnR5LmNvbXBvbmVudFR5cGU7XG4gICAgICAgIHZhciB0eXBlID0gcHJvcGVydHkudHlwZTtcbiAgICAgICAgaWYgKCFkZWZpbmVkKGNvbXBvbmVudFR5cGUpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcihcImNvbXBvbmVudFR5cGUgaXMgcmVxdWlyZWQuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGVmaW5lZCh0eXBlKSkge1xuICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXJyb3IoXCJ0eXBlIGlzIHJlcXVpcmVkLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRlZmluZWQoYmluYXJ5Qm9keSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUVycm9yKFxuICAgICAgICAgICAgXCJQcm9wZXJ0eSBcIiArIG5hbWUgKyBcIiByZXF1aXJlcyBhIGJhdGNoIHRhYmxlIGJpbmFyeS5cIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYmluYXJ5QWNjZXNzb3IgPSBnZXRCaW5hcnlBY2Nlc3Nvcihwcm9wZXJ0eSk7XG4gICAgICAgIHZhciBjb21wb25lbnRDb3VudCA9IGJpbmFyeUFjY2Vzc29yLmNvbXBvbmVudHNQZXJBdHRyaWJ1dGU7XG4gICAgICAgIHZhciBjbGFzc1R5cGUgPSBiaW5hcnlBY2Nlc3Nvci5jbGFzc1R5cGU7XG4gICAgICAgIHZhciB0eXBlZEFycmF5ID0gYmluYXJ5QWNjZXNzb3IuY3JlYXRlQXJyYXlCdWZmZXJWaWV3KFxuICAgICAgICAgIGJpbmFyeUJvZHkuYnVmZmVyLFxuICAgICAgICAgIGJpbmFyeUJvZHkuYnl0ZU9mZnNldCArIGJ5dGVPZmZzZXQsXG4gICAgICAgICAgZmVhdHVyZXNMZW5ndGhcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoIWRlZmluZWQoYmluYXJ5UHJvcGVydGllcykpIHtcbiAgICAgICAgICBiaW5hcnlQcm9wZXJ0aWVzID0ge307XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdG9yZSBhbnkgaW5mb3JtYXRpb24gbmVlZGVkIHRvIGFjY2VzcyB0aGUgYmluYXJ5IGRhdGEsIGluY2x1ZGluZyB0aGUgdHlwZWQgYXJyYXksXG4gICAgICAgIC8vIGNvbXBvbmVudENvdW50IChlLmcuIGEgVkVDNCB3b3VsZCBiZSA0KSwgYW5kIHRoZSB0eXBlIHVzZWQgdG8gcGFjayBhbmQgdW5wYWNrIChlLmcuIENhcnRlc2lhbjQpLlxuICAgICAgICBiaW5hcnlQcm9wZXJ0aWVzW25hbWVdID0ge1xuICAgICAgICAgIHR5cGVkQXJyYXk6IHR5cGVkQXJyYXksXG4gICAgICAgICAgY29tcG9uZW50Q291bnQ6IGNvbXBvbmVudENvdW50LFxuICAgICAgICAgIHR5cGU6IGNsYXNzVHlwZSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGJpbmFyeVByb3BlcnRpZXM7XG59XG5cbi8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG52YXIgc2NyYXRjaFZhbGlkYXRlU3RhY2sgPSBbXTtcbmZ1bmN0aW9uIHZhbGlkYXRlSGllcmFyY2h5KGhpZXJhcmNoeSkge1xuICB2YXIgc3RhY2sgPSBzY3JhdGNoVmFsaWRhdGVTdGFjaztcbiAgc3RhY2subGVuZ3RoID0gMDtcblxuICB2YXIgY2xhc3NJZHMgPSBoaWVyYXJjaHkuX2NsYXNzSWRzO1xuICB2YXIgaW5zdGFuY2VzTGVuZ3RoID0gY2xhc3NJZHMubGVuZ3RoO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgaW5zdGFuY2VzTGVuZ3RoOyArK2kpIHtcbiAgICB2YWxpZGF0ZUluc3RhbmNlKGhpZXJhcmNoeSwgaSwgc3RhY2spO1xuICB9XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlSW5zdGFuY2UoaGllcmFyY2h5LCBpbnN0YW5jZUluZGV4LCBzdGFjaykge1xuICB2YXIgcGFyZW50Q291bnRzID0gaGllcmFyY2h5Ll9wYXJlbnRDb3VudHM7XG4gIHZhciBwYXJlbnRJZHMgPSBoaWVyYXJjaHkuX3BhcmVudElkcztcbiAgdmFyIHBhcmVudEluZGV4ZXMgPSBoaWVyYXJjaHkuX3BhcmVudEluZGV4ZXM7XG4gIHZhciBjbGFzc0lkcyA9IGhpZXJhcmNoeS5fY2xhc3NJZHM7XG4gIHZhciBpbnN0YW5jZXNMZW5ndGggPSBjbGFzc0lkcy5sZW5ndGg7XG5cbiAgaWYgKCFkZWZpbmVkKHBhcmVudElkcykpIHtcbiAgICAvLyBObyBuZWVkIHRvIHZhbGlkYXRlIGlmIHRoZXJlIGFyZSBubyBwYXJlbnRzXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGluc3RhbmNlSW5kZXggPj0gaW5zdGFuY2VzTGVuZ3RoKSB7XG4gICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFxuICAgICAgXCJQYXJlbnQgaW5kZXggXCIgK1xuICAgICAgICBpbnN0YW5jZUluZGV4ICtcbiAgICAgICAgXCIgZXhjZWVkcyB0aGUgdG90YWwgbnVtYmVyIG9mIGluc3RhbmNlczogXCIgK1xuICAgICAgICBpbnN0YW5jZXNMZW5ndGhcbiAgICApO1xuICB9XG4gIGlmIChzdGFjay5pbmRleE9mKGluc3RhbmNlSW5kZXgpID4gLTEpIHtcbiAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXG4gICAgICBcIkNpcmN1bGFyIGRlcGVuZGVuY3kgZGV0ZWN0ZWQgaW4gdGhlIGJhdGNoIHRhYmxlIGhpZXJhcmNoeS5cIlxuICAgICk7XG4gIH1cblxuICBzdGFjay5wdXNoKGluc3RhbmNlSW5kZXgpO1xuICB2YXIgcGFyZW50Q291bnQgPSBkZWZpbmVkKHBhcmVudENvdW50cykgPyBwYXJlbnRDb3VudHNbaW5zdGFuY2VJbmRleF0gOiAxO1xuICB2YXIgcGFyZW50SW5kZXggPSBkZWZpbmVkKHBhcmVudENvdW50cylcbiAgICA/IHBhcmVudEluZGV4ZXNbaW5zdGFuY2VJbmRleF1cbiAgICA6IGluc3RhbmNlSW5kZXg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGFyZW50Q291bnQ7ICsraSkge1xuICAgIHZhciBwYXJlbnRJZCA9IHBhcmVudElkc1twYXJlbnRJbmRleCArIGldO1xuICAgIC8vIFN0b3AgdGhlIHRyYXZlcnNhbCB3aGVuIHRoZSBpbnN0YW5jZSBoYXMgbm8gcGFyZW50IChpdHMgcGFyZW50SWQgZXF1YWxzIGl0c2VsZiksIGVsc2UgY29udGludWUgdGhlIHRyYXZlcnNhbC5cbiAgICBpZiAocGFyZW50SWQgIT09IGluc3RhbmNlSW5kZXgpIHtcbiAgICAgIHZhbGlkYXRlSW5zdGFuY2UoaGllcmFyY2h5LCBwYXJlbnRJZCwgc3RhY2spO1xuICAgIH1cbiAgfVxuICBzdGFjay5wb3AoaW5zdGFuY2VJbmRleCk7XG59XG4vLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuLy8gVGhlIHNpemUgb2YgdGhpcyBhcnJheSBlcXVhbHMgdGhlIG1heGltdW0gaW5zdGFuY2UgY291bnQgYW1vbmcgYWxsIGxvYWRlZCB0aWxlcywgd2hpY2ggaGFzIHRoZSBwb3RlbnRpYWwgdG8gYmUgbGFyZ2UuXG52YXIgc2NyYXRjaFZpc2l0ZWQgPSBbXTtcbnZhciBzY3JhdGNoU3RhY2sgPSBbXTtcbnZhciBtYXJrZXIgPSAwO1xuZnVuY3Rpb24gdHJhdmVyc2VIaWVyYXJjaHlNdWx0aXBsZVBhcmVudHMoXG4gIGhpZXJhcmNoeSxcbiAgaW5zdGFuY2VJbmRleCxcbiAgZW5kQ29uZGl0aW9uQ2FsbGJhY2tcbikge1xuICB2YXIgY2xhc3NJZHMgPSBoaWVyYXJjaHkuX2NsYXNzSWRzO1xuICB2YXIgcGFyZW50Q291bnRzID0gaGllcmFyY2h5Ll9wYXJlbnRDb3VudHM7XG4gIHZhciBwYXJlbnRJZHMgPSBoaWVyYXJjaHkuX3BhcmVudElkcztcbiAgdmFyIHBhcmVudEluZGV4ZXMgPSBoaWVyYXJjaHkuX3BhcmVudEluZGV4ZXM7XG4gIHZhciBpbnN0YW5jZXNMZW5ndGggPSBjbGFzc0lkcy5sZW5ndGg7XG5cbiAgLy8gSWdub3JlIGluc3RhbmNlcyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIHZpc2l0ZWQuIFRoaXMgb2NjdXJzIGluIGRpYW1vbmQgaW5oZXJpdGFuY2Ugc2l0dWF0aW9ucy5cbiAgLy8gVXNlIGEgbWFya2VyIHZhbHVlIHRvIGluZGljYXRlIHRoYXQgYW4gaW5zdGFuY2UgaGFzIGJlZW4gdmlzaXRlZCwgd2hpY2ggaW5jcmVtZW50cyB3aXRoIGVhY2ggcnVuLlxuICAvLyBUaGlzIGlzIG1vcmUgZWZmaWNpZW50IHRoYW4gY2xlYXJpbmcgdGhlIHZpc2l0ZWQgYXJyYXkgZXZlcnkgdGltZS5cbiAgdmFyIHZpc2l0ZWQgPSBzY3JhdGNoVmlzaXRlZDtcbiAgdmlzaXRlZC5sZW5ndGggPSBNYXRoLm1heCh2aXNpdGVkLmxlbmd0aCwgaW5zdGFuY2VzTGVuZ3RoKTtcbiAgdmFyIHZpc2l0ZWRNYXJrZXIgPSArK21hcmtlcjtcblxuICB2YXIgc3RhY2sgPSBzY3JhdGNoU3RhY2s7XG4gIHN0YWNrLmxlbmd0aCA9IDA7XG4gIHN0YWNrLnB1c2goaW5zdGFuY2VJbmRleCk7XG5cbiAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHtcbiAgICBpbnN0YW5jZUluZGV4ID0gc3RhY2sucG9wKCk7XG4gICAgaWYgKHZpc2l0ZWRbaW5zdGFuY2VJbmRleF0gPT09IHZpc2l0ZWRNYXJrZXIpIHtcbiAgICAgIC8vIFRoaXMgaW5zdGFuY2UgaGFzIGFscmVhZHkgYmVlbiB2aXNpdGVkLCBzdG9wIHRyYXZlcnNhbFxuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHZpc2l0ZWRbaW5zdGFuY2VJbmRleF0gPSB2aXNpdGVkTWFya2VyO1xuICAgIHZhciByZXN1bHQgPSBlbmRDb25kaXRpb25DYWxsYmFjayhoaWVyYXJjaHksIGluc3RhbmNlSW5kZXgpO1xuICAgIGlmIChkZWZpbmVkKHJlc3VsdCkpIHtcbiAgICAgIC8vIFRoZSBlbmQgY29uZGl0aW9uIHdhcyBtZXQsIHN0b3AgdGhlIHRyYXZlcnNhbCBhbmQgcmV0dXJuIHRoZSByZXN1bHRcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIHZhciBwYXJlbnRDb3VudCA9IHBhcmVudENvdW50c1tpbnN0YW5jZUluZGV4XTtcbiAgICB2YXIgcGFyZW50SW5kZXggPSBwYXJlbnRJbmRleGVzW2luc3RhbmNlSW5kZXhdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFyZW50Q291bnQ7ICsraSkge1xuICAgICAgdmFyIHBhcmVudElkID0gcGFyZW50SWRzW3BhcmVudEluZGV4ICsgaV07XG4gICAgICAvLyBTdG9wIHRoZSB0cmF2ZXJzYWwgd2hlbiB0aGUgaW5zdGFuY2UgaGFzIG5vIHBhcmVudCAoaXRzIHBhcmVudElkIGVxdWFscyBpdHNlbGYpXG4gICAgICAvLyBlbHNlIGFkZCB0aGUgcGFyZW50IHRvIHRoZSBzdGFjayB0byBjb250aW51ZSB0aGUgdHJhdmVyc2FsLlxuICAgICAgaWYgKHBhcmVudElkICE9PSBpbnN0YW5jZUluZGV4KSB7XG4gICAgICAgIHN0YWNrLnB1c2gocGFyZW50SWQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiB0cmF2ZXJzZUhpZXJhcmNoeVNpbmdsZVBhcmVudChcbiAgaGllcmFyY2h5LFxuICBpbnN0YW5jZUluZGV4LFxuICBlbmRDb25kaXRpb25DYWxsYmFja1xuKSB7XG4gIHZhciBoYXNQYXJlbnQgPSB0cnVlO1xuICB3aGlsZSAoaGFzUGFyZW50KSB7XG4gICAgdmFyIHJlc3VsdCA9IGVuZENvbmRpdGlvbkNhbGxiYWNrKGhpZXJhcmNoeSwgaW5zdGFuY2VJbmRleCk7XG4gICAgaWYgKGRlZmluZWQocmVzdWx0KSkge1xuICAgICAgLy8gVGhlIGVuZCBjb25kaXRpb24gd2FzIG1ldCwgc3RvcCB0aGUgdHJhdmVyc2FsIGFuZCByZXR1cm4gdGhlIHJlc3VsdFxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgdmFyIHBhcmVudElkID0gaGllcmFyY2h5Ll9wYXJlbnRJZHNbaW5zdGFuY2VJbmRleF07XG4gICAgaGFzUGFyZW50ID0gcGFyZW50SWQgIT09IGluc3RhbmNlSW5kZXg7XG4gICAgaW5zdGFuY2VJbmRleCA9IHBhcmVudElkO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRyYXZlcnNlSGllcmFyY2h5KGhpZXJhcmNoeSwgaW5zdGFuY2VJbmRleCwgZW5kQ29uZGl0aW9uQ2FsbGJhY2spIHtcbiAgLy8gVHJhdmVyc2Ugb3ZlciB0aGUgaGllcmFyY2h5IGFuZCBwcm9jZXNzIGVhY2ggaW5zdGFuY2Ugd2l0aCB0aGUgZW5kQ29uZGl0aW9uQ2FsbGJhY2suXG4gIC8vIFdoZW4gdGhlIGVuZENvbmRpdGlvbkNhbGxiYWNrIHJldHVybnMgYSB2YWx1ZSwgdGhlIHRyYXZlcnNhbCBzdG9wcyBhbmQgdGhhdCB2YWx1ZSBpcyByZXR1cm5lZC5cbiAgdmFyIHBhcmVudENvdW50cyA9IGhpZXJhcmNoeS5fcGFyZW50Q291bnRzO1xuICB2YXIgcGFyZW50SWRzID0gaGllcmFyY2h5Ll9wYXJlbnRJZHM7XG4gIGlmICghZGVmaW5lZChwYXJlbnRJZHMpKSB7XG4gICAgcmV0dXJuIGVuZENvbmRpdGlvbkNhbGxiYWNrKGhpZXJhcmNoeSwgaW5zdGFuY2VJbmRleCk7XG4gIH0gZWxzZSBpZiAoZGVmaW5lZChwYXJlbnRDb3VudHMpKSB7XG4gICAgcmV0dXJuIHRyYXZlcnNlSGllcmFyY2h5TXVsdGlwbGVQYXJlbnRzKFxuICAgICAgaGllcmFyY2h5LFxuICAgICAgaW5zdGFuY2VJbmRleCxcbiAgICAgIGVuZENvbmRpdGlvbkNhbGxiYWNrXG4gICAgKTtcbiAgfVxuICByZXR1cm4gdHJhdmVyc2VIaWVyYXJjaHlTaW5nbGVQYXJlbnQoXG4gICAgaGllcmFyY2h5LFxuICAgIGluc3RhbmNlSW5kZXgsXG4gICAgZW5kQ29uZGl0aW9uQ2FsbGJhY2tcbiAgKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGZlYXR1cmUgaGFzIHRoaXMgcHJvcGVydHkuXG4gKlxuICogQHBhcmFtIHtOdW1iZXJ9IGJhdGNoSWQgdGhlIGJhdGNoIElEIG9mIHRoZSBmZWF0dXJlXG4gKiBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHlJZCBUaGUgY2FzZS1zZW5zaXRpdmUgSUQgb2YgdGhlIHByb3BlcnR5LlxuICogQHJldHVybnMge0Jvb2xlYW59IFdoZXRoZXIgdGhlIGZlYXR1cmUgaGFzIHRoaXMgcHJvcGVydHkuXG4gKiBAcHJpdmF0ZVxuICovXG5CYXRjaFRhYmxlSGllcmFyY2h5LnByb3RvdHlwZS5oYXNQcm9wZXJ0eSA9IGZ1bmN0aW9uIChiYXRjaElkLCBwcm9wZXJ0eUlkKSB7XG4gIHZhciByZXN1bHQgPSB0cmF2ZXJzZUhpZXJhcmNoeSh0aGlzLCBiYXRjaElkLCBmdW5jdGlvbiAoXG4gICAgaGllcmFyY2h5LFxuICAgIGluc3RhbmNlSW5kZXhcbiAgKSB7XG4gICAgdmFyIGNsYXNzSWQgPSBoaWVyYXJjaHkuX2NsYXNzSWRzW2luc3RhbmNlSW5kZXhdO1xuICAgIHZhciBpbnN0YW5jZXMgPSBoaWVyYXJjaHkuX2NsYXNzZXNbY2xhc3NJZF0uaW5zdGFuY2VzO1xuICAgIGlmIChkZWZpbmVkKGluc3RhbmNlc1twcm9wZXJ0eUlkXSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBkZWZpbmVkKHJlc3VsdCk7XG59O1xuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBhbnkgZmVhdHVyZSBoYXMgdGhpcyBwcm9wZXJ0eS5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHlJZCBUaGUgY2FzZS1zZW5zaXRpdmUgSUQgb2YgdGhlIHByb3BlcnR5LlxuICogQHJldHVybnMge0Jvb2xlYW59IFdoZXRoZXIgYW55IGZlYXR1cmUgaGFzIHRoaXMgcHJvcGVydHkuXG4gKiBAcHJpdmF0ZVxuICovXG5CYXRjaFRhYmxlSGllcmFyY2h5LnByb3RvdHlwZS5wcm9wZXJ0eUV4aXN0cyA9IGZ1bmN0aW9uIChwcm9wZXJ0eUlkKSB7XG4gIHZhciBjbGFzc2VzID0gdGhpcy5fY2xhc3NlcztcbiAgdmFyIGNsYXNzZXNMZW5ndGggPSBjbGFzc2VzLmxlbmd0aDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbGFzc2VzTGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgaW5zdGFuY2VzID0gY2xhc3Nlc1tpXS5pbnN0YW5jZXM7XG4gICAgaWYgKGRlZmluZWQoaW5zdGFuY2VzW3Byb3BlcnR5SWRdKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8qKlxuICogUmV0dXJucyBhbiBhcnJheSBvZiBwcm9wZXJ0eSBJRHMuXG4gKlxuICogQHBhcmFtIHtOdW1iZXJ9IGJhdGNoSWQgdGhlIGJhdGNoIElEIG9mIHRoZSBmZWF0dXJlXG4gKiBAcGFyYW0ge051bWJlcn0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBlbnRpdHkuXG4gKiBAcGFyYW0ge1N0cmluZ1tdfSBbcmVzdWx0c10gQW4gYXJyYXkgaW50byB3aGljaCB0byBzdG9yZSB0aGUgcmVzdWx0cy5cbiAqIEByZXR1cm5zIHtTdHJpbmdbXX0gVGhlIHByb3BlcnR5IElEcy5cbiAqIEBwcml2YXRlXG4gKi9cbkJhdGNoVGFibGVIaWVyYXJjaHkucHJvdG90eXBlLmdldFByb3BlcnR5SWRzID0gZnVuY3Rpb24gKGJhdGNoSWQsIHJlc3VsdHMpIHtcbiAgcmVzdWx0cyA9IGRlZmluZWQocmVzdWx0cykgPyByZXN1bHRzIDogW107XG4gIHJlc3VsdHMubGVuZ3RoID0gMDtcblxuICB0cmF2ZXJzZUhpZXJhcmNoeSh0aGlzLCBiYXRjaElkLCBmdW5jdGlvbiAoaGllcmFyY2h5LCBpbnN0YW5jZUluZGV4KSB7XG4gICAgdmFyIGNsYXNzSWQgPSBoaWVyYXJjaHkuX2NsYXNzSWRzW2luc3RhbmNlSW5kZXhdO1xuICAgIHZhciBpbnN0YW5jZXMgPSBoaWVyYXJjaHkuX2NsYXNzZXNbY2xhc3NJZF0uaW5zdGFuY2VzO1xuICAgIGZvciAodmFyIG5hbWUgaW4gaW5zdGFuY2VzKSB7XG4gICAgICBpZiAoaW5zdGFuY2VzLmhhc093blByb3BlcnR5KG5hbWUpKSB7XG4gICAgICAgIGlmIChyZXN1bHRzLmluZGV4T2YobmFtZSkgPT09IC0xKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKG5hbWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gcmVzdWx0cztcbn07XG5cbi8qKlxuICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eSB3aXRoIHRoZSBnaXZlbiBJRC5cbiAqXG4gKiBAcGFyYW0ge051bWJlcn0gYmF0Y2hJZCB0aGUgYmF0Y2ggSUQgb2YgdGhlIGZlYXR1cmVcbiAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wZXJ0eUlkIFRoZSBjYXNlLXNlbnNpdGl2ZSBJRCBvZiB0aGUgcHJvcGVydHkuXG4gKiBAcmV0dXJucyB7Kn0gVGhlIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eSBvciA8Y29kZT51bmRlZmluZWQ8L2NvZGU+IGlmIHRoZSBmZWF0dXJlIGRvZXMgbm90IGhhdmUgdGhpcyBwcm9wZXJ0eS5cbiAqIEBwcml2YXRlXG4gKi9cbkJhdGNoVGFibGVIaWVyYXJjaHkucHJvdG90eXBlLmdldFByb3BlcnR5ID0gZnVuY3Rpb24gKGJhdGNoSWQsIHByb3BlcnR5SWQpIHtcbiAgcmV0dXJuIHRyYXZlcnNlSGllcmFyY2h5KHRoaXMsIGJhdGNoSWQsIGZ1bmN0aW9uIChoaWVyYXJjaHksIGluc3RhbmNlSW5kZXgpIHtcbiAgICB2YXIgY2xhc3NJZCA9IGhpZXJhcmNoeS5fY2xhc3NJZHNbaW5zdGFuY2VJbmRleF07XG4gICAgdmFyIGluc3RhbmNlQ2xhc3MgPSBoaWVyYXJjaHkuX2NsYXNzZXNbY2xhc3NJZF07XG4gICAgdmFyIGluZGV4SW5DbGFzcyA9IGhpZXJhcmNoeS5fY2xhc3NJbmRleGVzW2luc3RhbmNlSW5kZXhdO1xuICAgIHZhciBwcm9wZXJ0eVZhbHVlcyA9IGluc3RhbmNlQ2xhc3MuaW5zdGFuY2VzW3Byb3BlcnR5SWRdO1xuICAgIGlmIChkZWZpbmVkKHByb3BlcnR5VmFsdWVzKSkge1xuICAgICAgaWYgKGRlZmluZWQocHJvcGVydHlWYWx1ZXMudHlwZWRBcnJheSkpIHtcbiAgICAgICAgcmV0dXJuIGdldEJpbmFyeVByb3BlcnR5KHByb3BlcnR5VmFsdWVzLCBpbmRleEluQ2xhc3MpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNsb25lKHByb3BlcnR5VmFsdWVzW2luZGV4SW5DbGFzc10sIHRydWUpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5mdW5jdGlvbiBnZXRCaW5hcnlQcm9wZXJ0eShiaW5hcnlQcm9wZXJ0eSwgaW5kZXgpIHtcbiAgdmFyIHR5cGVkQXJyYXkgPSBiaW5hcnlQcm9wZXJ0eS50eXBlZEFycmF5O1xuICB2YXIgY29tcG9uZW50Q291bnQgPSBiaW5hcnlQcm9wZXJ0eS5jb21wb25lbnRDb3VudDtcbiAgaWYgKGNvbXBvbmVudENvdW50ID09PSAxKSB7XG4gICAgcmV0dXJuIHR5cGVkQXJyYXlbaW5kZXhdO1xuICB9XG4gIHJldHVybiBiaW5hcnlQcm9wZXJ0eS50eXBlLnVucGFjayh0eXBlZEFycmF5LCBpbmRleCAqIGNvbXBvbmVudENvdW50KTtcbn1cblxuLyoqXG4gKiBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgcHJvcGVydHkgd2l0aCB0aGUgZ2l2ZW4gSUQuIE9ubHkgcHJvcGVydGllcyBvZiB0aGVcbiAqIGluc3RhbmNlIG1heSBiZSBzZXQ7IHBhcmVudCBwcm9wZXJ0aWVzIG1heSBub3QgYmUgc2V0LlxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBiYXRjaElkIFRoZSBiYXRjaElkIG9mIHRoZSBmZWF0dXJlXG4gKiBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHlJZCBUaGUgY2FzZS1zZW5zaXRpdmUgSUQgb2YgdGhlIHByb3BlcnR5LlxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgb2YgdGhlIHByb3BlcnR5IHRoYXQgd2lsbCBiZSBjb3BpZWQuXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gPGNvZGU+dHJ1ZTwvY29kZT4gaWYgdGhlIHByb3BlcnR5IHdhcyBzZXQsIDxjb2RlPmZhbHNlPC9jb2RlPiBvdGhlcndpc2UuXG4gKlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IHdoZW4gc2V0dGluZyBhbiBpbmhlcml0ZWQgcHJvcGVydHlcbiAqIEBwcml2YXRlXG4gKi9cbkJhdGNoVGFibGVIaWVyYXJjaHkucHJvdG90eXBlLnNldFByb3BlcnR5ID0gZnVuY3Rpb24gKFxuICBiYXRjaElkLFxuICBwcm9wZXJ0eUlkLFxuICB2YWx1ZVxuKSB7XG4gIHZhciByZXN1bHQgPSB0cmF2ZXJzZUhpZXJhcmNoeSh0aGlzLCBiYXRjaElkLCBmdW5jdGlvbiAoXG4gICAgaGllcmFyY2h5LFxuICAgIGluc3RhbmNlSW5kZXhcbiAgKSB7XG4gICAgdmFyIGNsYXNzSWQgPSBoaWVyYXJjaHkuX2NsYXNzSWRzW2luc3RhbmNlSW5kZXhdO1xuICAgIHZhciBpbnN0YW5jZUNsYXNzID0gaGllcmFyY2h5Ll9jbGFzc2VzW2NsYXNzSWRdO1xuICAgIHZhciBpbmRleEluQ2xhc3MgPSBoaWVyYXJjaHkuX2NsYXNzSW5kZXhlc1tpbnN0YW5jZUluZGV4XTtcbiAgICB2YXIgcHJvcGVydHlWYWx1ZXMgPSBpbnN0YW5jZUNsYXNzLmluc3RhbmNlc1twcm9wZXJ0eUlkXTtcbiAgICBpZiAoZGVmaW5lZChwcm9wZXJ0eVZhbHVlcykpIHtcbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBpZiAoaW5zdGFuY2VJbmRleCAhPT0gYmF0Y2hJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXG4gICAgICAgICAgJ0luaGVyaXRlZCBwcm9wZXJ0eSBcIicgKyBwcm9wZXJ0eUlkICsgJ1wiIGlzIHJlYWQtb25seS4nXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcbiAgICAgIGlmIChkZWZpbmVkKHByb3BlcnR5VmFsdWVzLnR5cGVkQXJyYXkpKSB7XG4gICAgICAgIHNldEJpbmFyeVByb3BlcnR5KHByb3BlcnR5VmFsdWVzLCBpbmRleEluQ2xhc3MsIHZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHByb3BlcnR5VmFsdWVzW2luZGV4SW5DbGFzc10gPSBjbG9uZSh2YWx1ZSwgdHJ1ZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZGVmaW5lZChyZXN1bHQpO1xufTtcblxuZnVuY3Rpb24gc2V0QmluYXJ5UHJvcGVydHkoYmluYXJ5UHJvcGVydHksIGluZGV4LCB2YWx1ZSkge1xuICB2YXIgdHlwZWRBcnJheSA9IGJpbmFyeVByb3BlcnR5LnR5cGVkQXJyYXk7XG4gIHZhciBjb21wb25lbnRDb3VudCA9IGJpbmFyeVByb3BlcnR5LmNvbXBvbmVudENvdW50O1xuICBpZiAoY29tcG9uZW50Q291bnQgPT09IDEpIHtcbiAgICB0eXBlZEFycmF5W2luZGV4XSA9IHZhbHVlO1xuICB9IGVsc2Uge1xuICAgIGJpbmFyeVByb3BlcnR5LnR5cGUucGFjayh2YWx1ZSwgdHlwZWRBcnJheSwgaW5kZXggKiBjb21wb25lbnRDb3VudCk7XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIGZlYXR1cmUgYmVsb25ncyB0byBhIGNsYXNzIHdpdGggdGhlIGdpdmVuIG5hbWVcbiAqXG4gKiBAcGFyYW0ge051bWJlcn0gYmF0Y2hJZCBUaGUgYmF0Y2ggSUQgb2YgdGhlIGZlYXR1cmVcbiAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUgVGhlIG5hbWUgb2YgdGhlIGNsYXNzXG4gKiBAcmV0dXJuIHtCb29sZWFufSA8Y29kZT50cnVlPC9jb2RlPiBpZiB0aGUgZmVhdHVyZSBiZWxvbmdzIHRvIHRoZSBjbGFzcyBnaXZlbiBieSBjbGFzc05hbWUsIG9yIDxjb2RlPmZhbHNlPC9jb2RlPiBvdGhlcndpc2VcbiAqIEBwcml2YXRlXG4gKi9cbkJhdGNoVGFibGVIaWVyYXJjaHkucHJvdG90eXBlLmlzQ2xhc3MgPSBmdW5jdGlvbiAoYmF0Y2hJZCwgY2xhc3NOYW1lKSB7XG4gIC8vIFBFUkZPUk1BTkNFX0lERUEgOiBjYWNoZSByZXN1bHRzIGluIHRoZSBhbmNlc3RvciBjbGFzc2VzIHRvIHNwZWVkIHVwIHRoaXMgY2hlY2sgaWYgdGhpcyBhcmVhIGJlY29tZXMgYSBob3RzcG90XG4gIC8vIFBFUkZPUk1BTkNFX0lERUEgOiB0cmVhdCBjbGFzcyBuYW1lcyBhcyBpbnRlZ2VycyBmb3IgZmFzdGVyIGNvbXBhcmlzb25zXG4gIHZhciByZXN1bHQgPSB0cmF2ZXJzZUhpZXJhcmNoeSh0aGlzLCBiYXRjaElkLCBmdW5jdGlvbiAoXG4gICAgaGllcmFyY2h5LFxuICAgIGluc3RhbmNlSW5kZXhcbiAgKSB7XG4gICAgdmFyIGNsYXNzSWQgPSBoaWVyYXJjaHkuX2NsYXNzSWRzW2luc3RhbmNlSW5kZXhdO1xuICAgIHZhciBpbnN0YW5jZUNsYXNzID0gaGllcmFyY2h5Ll9jbGFzc2VzW2NsYXNzSWRdO1xuICAgIGlmIChpbnN0YW5jZUNsYXNzLm5hbWUgPT09IGNsYXNzTmFtZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGRlZmluZWQocmVzdWx0KTtcbn07XG5cbi8qKlxuICogR2V0IHRoZSBuYW1lIG9mIHRoZSBjbGFzcyBhIGdpdmVuIGZlYXR1cmUgYmVsb25ncyB0b1xuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBiYXRjaElkIFRoZSBiYXRjaCBJRCBvZiB0aGUgZmVhdHVyZVxuICogQHJldHVybiB7U3RyaW5nfSBUaGUgbmFtZSBvZiB0aGUgY2xhc3MgdGhpcyBmZWF0dXJlIGJlbG9uZ3MgdG9cbiAqL1xuQmF0Y2hUYWJsZUhpZXJhcmNoeS5wcm90b3R5cGUuZ2V0Q2xhc3NOYW1lID0gZnVuY3Rpb24gKGJhdGNoSWQpIHtcbiAgdmFyIGNsYXNzSWQgPSB0aGlzLl9jbGFzc0lkc1tiYXRjaElkXTtcbiAgdmFyIGluc3RhbmNlQ2xhc3MgPSB0aGlzLl9jbGFzc2VzW2NsYXNzSWRdO1xuICByZXR1cm4gaW5zdGFuY2VDbGFzcy5uYW1lO1xufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///40384\n')},31937:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "Z": function() { return /* binding */ BatchTexture; }\n/* harmony export */ });\n/* harmony import */ var _Core_arrayFill_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(23401);\n/* harmony import */ var _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(60838);\n/* harmony import */ var _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(63367);\n/* harmony import */ var _Core_Check_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(66553);\n/* harmony import */ var _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(59947);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(82982);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(86511);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(12572);\n/* harmony import */ var _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(38443);\n/* harmony import */ var _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(20521);\n/* harmony import */ var _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(21572);\n/* harmony import */ var _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(87721);\n/* harmony import */ var _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(8743);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * An object that manages color, show/hide and picking textures for a batch\n * table or feature table.\n *\n * @param {Object} options Object with the following properties:\n * @param {Number} featuresLength The number of features in the batch table or feature table\n * @param {Cesium3DTileContent} content The content this batch texture belongs to. Used for creating the picking texture.\n * @param {Function} [colorChangedCallback] A callback function that is called whenever the color of a feature changes.\n *\n * @alias BatchTexture\n * @constructor\n *\n * @private\n */\nfunction BatchTexture(options) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  _Core_Check_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].typeOf.number */ .Z.typeOf.number("options.featuresLength", options.featuresLength);\n  _Core_Check_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].typeOf.object */ .Z.typeOf.object("options.content", options.content);\n  //>>includeEnd(\'debug\');\n\n  var featuresLength = options.featuresLength;\n\n  // PERFORMANCE_IDEA: These parallel arrays probably generate cache misses in get/set color/show\n  // and use A LOT of memory.  How can we use less memory?\n  this._showAlphaProperties = undefined; // [Show (0 or 255), Alpha (0 to 255)] property for each feature\n  this._batchValues = undefined; // Per-feature RGBA (A is based on the color\'s alpha and feature\'s show property)\n\n  this._batchValuesDirty = false;\n  this._batchTexture = undefined;\n  this._defaultTexture = undefined;\n\n  this._pickTexture = undefined;\n  this._pickIds = [];\n\n  // Dimensions for batch and pick textures\n  var textureDimensions;\n  var textureStep;\n\n  if (featuresLength > 0) {\n    // PERFORMANCE_IDEA: this can waste memory in the last row in the uncommon case\n    // when more than one row is needed (e.g., > 16K features in one tile)\n    var width = Math.min(featuresLength, _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].maximumTextureSize */ .Z.maximumTextureSize);\n    var height = Math.ceil(featuresLength / _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].maximumTextureSize */ .Z.maximumTextureSize);\n    var stepX = 1.0 / width;\n    var centerX = stepX * 0.5;\n    var stepY = 1.0 / height;\n    var centerY = stepY * 0.5;\n\n    textureDimensions = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z(width, height);\n    textureStep = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(stepX, centerX, stepY, centerY);\n  }\n\n  this._translucentFeaturesLength = 0;\n  this._featuresLength = featuresLength;\n  this._textureDimensions = textureDimensions;\n  this._textureStep = textureStep;\n  this._content = options.content;\n  this._colorChangedCallback = options.colorChangedCallback;\n}\n\nObject.defineProperties(BatchTexture.prototype, {\n  /**\n   * Number of features that are translucent\n   *\n   * @memberof BatchTexture.prototype\n   * @type {Number}\n   * @readonly\n   * @private\n   */\n  translucentFeaturesLength: {\n    get: function () {\n      return this._translucentFeaturesLength;\n    },\n  },\n\n  /**\n   * Total size of all GPU resources used by this batch texture.\n   *\n   * @memberof BatchTexture.prototype\n   * @type {Number}\n   * @readonly\n   * @private\n   */\n  memorySizeInBytes: {\n    get: function () {\n      var memory = 0;\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(this._pickTexture)) {\n        memory += this._pickTexture.sizeInBytes;\n      }\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(this._batchTexture)) {\n        memory += this._batchTexture.sizeInBytes;\n      }\n      return memory;\n    },\n  },\n\n  /**\n   * Dimensions of the underlying batch texture.\n   *\n   * @memberof BatchTexture.prototype\n   * @type {Cartesian2}\n   * @readonly\n   * @private\n   */\n  textureDimensions: {\n    get: function () {\n      return this._textureDimensions;\n    },\n  },\n\n  /**\n   * Size of each texture and distance from side to center of a texel in\n   * each direction. Stored as (stepX, centerX, stepY, centerY)\n   *\n   * @memberof BatchTexture.prototype\n   * @type {Cartesian4}\n   * @readonly\n   * @private\n   */\n  textureStep: {\n    get: function () {\n      return this._textureStep;\n    },\n  },\n\n  /**\n   * The underlying texture used for styling. The texels are accessed\n   * by batch ID, and the value is the color of this feature after accounting\n   * for show/hide settings.\n   *\n   * @memberof BatchTexture.prototype\n   * @type {Texture}\n   * @readonly\n   * @private\n   */\n  batchTexture: {\n    get: function () {\n      return this._batchTexture;\n    },\n  },\n\n  /**\n   * The default texture to use when there are no batch values\n   *\n   * @memberof BatchTexture.prototype\n   * @type {Texture}\n   * @readonly\n   * @private\n   */\n  defaultTexture: {\n    get: function () {\n      return this._defaultTexture;\n    },\n  },\n\n  /**\n   * The underlying texture used for picking. The texels are accessed by\n   * batch ID, and the value is the pick color.\n   *\n   * @memberof BatchTexture.prototype\n   * @type {Texture}\n   * @readonly\n   * @private\n   */\n  pickTexture: {\n    get: function () {\n      return this._pickTexture;\n    },\n  },\n});\n\nBatchTexture.DEFAULT_COLOR_VALUE = _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].WHITE */ .Z.WHITE;\nBatchTexture.DEFAULT_SHOW_VALUE = true;\n\nfunction getByteLength(batchTexture) {\n  var dimensions = batchTexture._textureDimensions;\n  return dimensions.x * dimensions.y * 4;\n}\n\nfunction getBatchValues(batchTexture) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(batchTexture._batchValues)) {\n    // Default batch texture to RGBA = 255: white highlight (RGB) and show/alpha = true/255 (A).\n    var byteLength = getByteLength(batchTexture);\n    var bytes = new Uint8Array(byteLength);\n    (0,_Core_arrayFill_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z)(bytes, 255);\n    batchTexture._batchValues = bytes;\n  }\n\n  return batchTexture._batchValues;\n}\n\nfunction getShowAlphaProperties(batchTexture) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(batchTexture._showAlphaProperties)) {\n    var byteLength = 2 * batchTexture._featuresLength;\n    var bytes = new Uint8Array(byteLength);\n    // [Show = true, Alpha = 255]\n    (0,_Core_arrayFill_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z)(bytes, 255);\n    batchTexture._showAlphaProperties = bytes;\n  }\n  return batchTexture._showAlphaProperties;\n}\n\nfunction checkBatchId(batchId, featuresLength) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(batchId) || batchId < 0 || batchId >= featuresLength) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z(\n      "batchId is required and between zero and featuresLength - 1 (" +\n        featuresLength -\n        +")."\n    );\n  }\n}\n\n/**\n * Set whether a feature is visible.\n *\n * @param {Number} batchId the ID of the feature\n * @param {Boolean} show <code>true</code> if the feature should be shown, <code>false</code> otherwise\n * @private\n */\nBatchTexture.prototype.setShow = function (batchId, show) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  checkBatchId(batchId, this._featuresLength);\n  _Core_Check_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].typeOf.bool */ .Z.typeOf.bool("show", show);\n  //>>includeEnd(\'debug\');\n\n  if (show && !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(this._showAlphaProperties)) {\n    // Avoid allocating since the default is show = true\n    return;\n  }\n\n  var showAlphaProperties = getShowAlphaProperties(this);\n  var propertyOffset = batchId * 2;\n\n  var newShow = show ? 255 : 0;\n  if (showAlphaProperties[propertyOffset] !== newShow) {\n    showAlphaProperties[propertyOffset] = newShow;\n\n    var batchValues = getBatchValues(this);\n\n    // Compute alpha used in the shader based on show and color.alpha properties\n    var offset = batchId * 4 + 3;\n    batchValues[offset] = show ? showAlphaProperties[propertyOffset + 1] : 0;\n\n    this._batchValuesDirty = true;\n  }\n};\n\n/**\n * Set the show for all features at once.\n *\n * @param {Boolean} show <code>true</code> if the feature should be shown, <code>false</code> otherwise\n * @private\n */\nBatchTexture.prototype.setAllShow = function (show) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  _Core_Check_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].typeOf.bool */ .Z.typeOf.bool("show", show);\n  //>>includeEnd(\'debug\');\n\n  var featuresLength = this._featuresLength;\n  for (var i = 0; i < featuresLength; ++i) {\n    this.setShow(i, show);\n  }\n};\n\n/**\n * Check the current show value for a feature\n *\n * @param {Number} batchId the ID of the feature\n * @return {Boolean} <code>true</code> if the feature is shown, or <code>false</code> otherwise\n * @private\n */\nBatchTexture.prototype.getShow = function (batchId) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  checkBatchId(batchId, this._featuresLength);\n  //>>includeEnd(\'debug\');\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(this._showAlphaProperties)) {\n    // Avoid allocating since the default is show = true\n    return true;\n  }\n\n  var offset = batchId * 2;\n  return this._showAlphaProperties[offset] === 255;\n};\n\nvar scratchColorBytes = new Array(4);\n\n/**\n * Set the styling color of a feature\n *\n * @param {Number} batchId the ID of the feature\n * @param {Color} color the color to assign to this feature.\n *\n * @private\n */\nBatchTexture.prototype.setColor = function (batchId, color) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  checkBatchId(batchId, this._featuresLength);\n  _Core_Check_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].typeOf.object */ .Z.typeOf.object("color", color);\n  //>>includeEnd(\'debug\');\n\n  if (\n    _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].equals */ .Z.equals(color, BatchTexture.DEFAULT_COLOR_VALUE) &&\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(this._batchValues)\n  ) {\n    // Avoid allocating since the default is white\n    return;\n  }\n\n  var newColor = color.toBytes(scratchColorBytes);\n  var newAlpha = newColor[3];\n\n  var batchValues = getBatchValues(this);\n  var offset = batchId * 4;\n\n  var showAlphaProperties = getShowAlphaProperties(this);\n  var propertyOffset = batchId * 2;\n\n  if (\n    batchValues[offset] !== newColor[0] ||\n    batchValues[offset + 1] !== newColor[1] ||\n    batchValues[offset + 2] !== newColor[2] ||\n    showAlphaProperties[propertyOffset + 1] !== newAlpha\n  ) {\n    batchValues[offset] = newColor[0];\n    batchValues[offset + 1] = newColor[1];\n    batchValues[offset + 2] = newColor[2];\n\n    var wasTranslucent = showAlphaProperties[propertyOffset + 1] !== 255;\n\n    // Compute alpha used in the shader based on show and color.alpha properties\n    var show = showAlphaProperties[propertyOffset] !== 0;\n    batchValues[offset + 3] = show ? newAlpha : 0;\n    showAlphaProperties[propertyOffset + 1] = newAlpha;\n\n    // Track number of translucent features so we know if this tile needs\n    // opaque commands, translucent commands, or both for rendering.\n    var isTranslucent = newAlpha !== 255;\n    if (isTranslucent && !wasTranslucent) {\n      ++this._translucentFeaturesLength;\n    } else if (!isTranslucent && wasTranslucent) {\n      --this._translucentFeaturesLength;\n    }\n\n    this._batchValuesDirty = true;\n\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(this._colorChangedCallback)) {\n      this._colorChangedCallback(batchId, color);\n    }\n  }\n};\n\n/**\n * Set the styling color for all features at once\n *\n * @param {Color} color the color to assign to all features.\n *\n * @private\n */\nBatchTexture.prototype.setAllColor = function (color) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  _Core_Check_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].typeOf.object */ .Z.typeOf.object("color", color);\n  //>>includeEnd(\'debug\');\n\n  var featuresLength = this._featuresLength;\n  for (var i = 0; i < featuresLength; ++i) {\n    this.setColor(i, color);\n  }\n};\n\n/**\n * Get the current color of a feature\n *\n * @param {Number} batchId The ID of the feature\n * @param {Color} result A color object where the result will be stored.\n * @return {Color} The color assigned to the selected feature\n *\n * @private\n */\nBatchTexture.prototype.getColor = function (batchId, result) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  checkBatchId(batchId, this._featuresLength);\n  _Core_Check_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].typeOf.object */ .Z.typeOf.object("result", result);\n  //>>includeEnd(\'debug\');\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(this._batchValues)) {\n    return _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].clone */ .Z.clone(BatchTexture.DEFAULT_COLOR_VALUE, result);\n  }\n\n  var batchValues = this._batchValues;\n  var offset = batchId * 4;\n\n  var showAlphaProperties = this._showAlphaProperties;\n  var propertyOffset = batchId * 2;\n\n  return _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].fromBytes */ .Z.fromBytes(\n    batchValues[offset],\n    batchValues[offset + 1],\n    batchValues[offset + 2],\n    showAlphaProperties[propertyOffset + 1],\n    result\n  );\n};\n\n/**\n * Get the pick color of a feature. This feature is an RGBA encoding of the\n * pick ID.\n *\n * @param {Number} batchId The ID of the feature\n * @return {PickId} The picking color assigned to this feature\n *\n * @private\n */\nBatchTexture.prototype.getPickColor = function (batchId) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  checkBatchId(batchId, this._featuresLength);\n  //>>includeEnd(\'debug\');\n  return this._pickIds[batchId];\n};\n\nfunction createTexture(batchTexture, context, bytes) {\n  var dimensions = batchTexture._textureDimensions;\n  return new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z({\n    context: context,\n    pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].RGBA */ .Z.RGBA,\n    pixelDatatype: _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE,\n    source: {\n      width: dimensions.x,\n      height: dimensions.y,\n      arrayBufferView: bytes,\n    },\n    flipY: false,\n    sampler: _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].NEAREST */ .Z.NEAREST,\n  });\n}\n\nfunction createPickTexture(batchTexture, context) {\n  var featuresLength = batchTexture._featuresLength;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(batchTexture._pickTexture) && featuresLength > 0) {\n    var pickIds = batchTexture._pickIds;\n    var byteLength = getByteLength(batchTexture);\n    var bytes = new Uint8Array(byteLength);\n    var content = batchTexture._content;\n\n    // PERFORMANCE_IDEA: we could skip the pick texture completely by allocating\n    // a continuous range of pickIds and then converting the base pickId + batchId\n    // to RGBA in the shader.  The only consider is precision issues, which might\n    // not be an issue in WebGL 2.\n    for (var i = 0; i < featuresLength; ++i) {\n      var pickId = context.createPickId(content.getFeature(i));\n      pickIds.push(pickId);\n\n      var pickColor = pickId.color;\n      var offset = i * 4;\n      bytes[offset] = _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].floatToByte */ .Z.floatToByte(pickColor.red);\n      bytes[offset + 1] = _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].floatToByte */ .Z.floatToByte(pickColor.green);\n      bytes[offset + 2] = _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].floatToByte */ .Z.floatToByte(pickColor.blue);\n      bytes[offset + 3] = _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].floatToByte */ .Z.floatToByte(pickColor.alpha);\n    }\n\n    batchTexture._pickTexture = createTexture(batchTexture, context, bytes);\n    content.tileset._statistics.batchTableByteLength +=\n      batchTexture._pickTexture.sizeInBytes;\n  }\n}\n\nfunction updateBatchTexture(batchTexture) {\n  var dimensions = batchTexture._textureDimensions;\n  // PERFORMANCE_IDEA: Instead of rewriting the entire texture, use fine-grained\n  // texture updates when less than, for example, 10%, of the values changed.  Or\n  // even just optimize the common case when one feature show/color changed.\n  batchTexture._batchTexture.copyFrom({\n    source: {\n      width: dimensions.x,\n      height: dimensions.y,\n      arrayBufferView: batchTexture._batchValues,\n    },\n  });\n}\n\nBatchTexture.prototype.update = function (tileset, frameState) {\n  var context = frameState.context;\n  this._defaultTexture = context.defaultTexture;\n\n  var passes = frameState.passes;\n  if (passes.pick || passes.postProcess) {\n    createPickTexture(this, context);\n  }\n\n  if (this._batchValuesDirty) {\n    this._batchValuesDirty = false;\n\n    // Create batch texture on-demand\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(this._batchTexture)) {\n      this._batchTexture = createTexture(this, context, this._batchValues);\n      tileset._statistics.batchTableByteLength += this._batchTexture.sizeInBytes;\n    }\n\n    updateBatchTexture(this); // Apply per-feature show/color updates\n  }\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <p>\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n * </p>\n *\n * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n *\n * @see BatchTexture#destroy\n * @private\n */\nBatchTexture.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n * <p>\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n * </p>\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n * @example\n * e = e && e.destroy();\n *\n * @see BatchTexture#isDestroyed\n * @private\n */\nBatchTexture.prototype.destroy = function () {\n  this._batchTexture = this._batchTexture && this._batchTexture.destroy();\n  this._pickTexture = this._pickTexture && this._pickTexture.destroy();\n\n  var pickIds = this._pickIds;\n  var length = pickIds.length;\n  for (var i = 0; i < length; ++i) {\n    pickIds[i].destroy();\n  }\n\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(this);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzE5MzcuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUE2QztBQUNFO0FBQ0E7QUFDVjtBQUNBO0FBQ0k7QUFDWTtBQUNFO0FBQ047QUFDUTtBQUNBO0FBQ1o7QUFDQTs7QUFFN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFFBQVE7QUFDbkIsV0FBVyxRQUFRO0FBQ25CLFdBQVcscUJBQXFCO0FBQ2hDLFdBQVcsVUFBVTtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDZTtBQUNmO0FBQ0EsRUFBRSwyRkFBbUI7QUFDckIsRUFBRSwyRkFBbUI7QUFDckI7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLHlDQUF5QztBQUN6QyxpQ0FBaUM7O0FBRWpDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsaUhBQWdDO0FBQ3pFLDRDQUE0QyxpSEFBZ0M7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsNEJBQTRCLG9FQUFVO0FBQ3RDLHNCQUFzQixvRUFBVTtBQUNoQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsc0VBQU87QUFDakI7QUFDQTtBQUNBLFVBQVUsc0VBQU87QUFDakI7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNILENBQUM7O0FBRUQsbUNBQW1DLDJFQUFXO0FBQzlDOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsT0FBTyxzRUFBTztBQUNkO0FBQ0E7QUFDQTtBQUNBLElBQUksdUVBQVM7QUFDYjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxPQUFPLHNFQUFPO0FBQ2Q7QUFDQTtBQUNBO0FBQ0EsSUFBSSx1RUFBUztBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsT0FBTyxzRUFBTztBQUNkLGNBQWMsd0VBQWM7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixXQUFXLFNBQVM7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUsdUZBQWlCO0FBQ25COztBQUVBLGVBQWUsc0VBQU87QUFDdEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsV0FBVyxTQUFTO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSx1RkFBaUI7QUFDbkI7O0FBRUE7QUFDQSxrQkFBa0Isb0JBQW9CO0FBQ3RDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFFBQVE7QUFDbkIsWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPLHNFQUFPO0FBQ2Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFFBQVE7QUFDbkIsV0FBVyxPQUFPO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUsMkZBQW1CO0FBQ3JCOztBQUVBO0FBQ0EsSUFBSSw2RUFBWTtBQUNoQixLQUFLLHNFQUFPO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTs7QUFFQSxRQUFRLHNFQUFPO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsV0FBVyxPQUFPO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLDJGQUFtQjtBQUNyQjs7QUFFQTtBQUNBLGtCQUFrQixvQkFBb0I7QUFDdEM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixXQUFXLE9BQU87QUFDbEIsWUFBWSxPQUFPO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUsMkZBQW1CO0FBQ3JCOztBQUVBLE9BQU8sc0VBQU87QUFDZCxXQUFXLDJFQUFXO0FBQ3RCOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxTQUFTLG1GQUFlO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxRQUFRO0FBQ25CLFlBQVksUUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWEsc0VBQU87QUFDcEI7QUFDQSxpQkFBaUIsK0VBQWdCO0FBQ2pDLG1CQUFtQix1R0FBMkI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxhQUFhLHNGQUFlO0FBQzVCLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0EsT0FBTyxzRUFBTztBQUNkO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLG9CQUFvQjtBQUN4QztBQUNBOztBQUVBO0FBQ0E7QUFDQSxzQkFBc0IsdUZBQWlCO0FBQ3ZDLDBCQUEwQix1RkFBaUI7QUFDM0MsMEJBQTBCLHVGQUFpQjtBQUMzQywwQkFBMEIsdUZBQWlCO0FBQzNDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsU0FBUyxzRUFBTztBQUNoQjtBQUNBO0FBQ0E7O0FBRUEsOEJBQThCO0FBQzlCO0FBQ0E7O0FBRUE7QUFDQSw4Q0FBOEM7QUFDOUM7QUFDQSx3REFBd0Q7QUFDeEQsOENBQThDLHNCQUFzQjtBQUNwRTtBQUNBO0FBQ0EsYUFBYSxTQUFTLGdEQUFnRDtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RDtBQUN2RCw4Q0FBOEMsc0JBQXNCO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBLGVBQWUsZ0JBQWdCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrQkFBa0IsWUFBWTtBQUM5QjtBQUNBOztBQUVBLFNBQVMsMkVBQWE7QUFDdEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92dWUzLXdlYnBhY2s1Ly4vbm9kZV9tb2R1bGVzL2Nlc2l1bS9Tb3VyY2UvU2NlbmUvQmF0Y2hUZXh0dXJlLmpzPzMwN2YiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFycmF5RmlsbCBmcm9tIFwiLi4vQ29yZS9hcnJheUZpbGwuanNcIjtcbmltcG9ydCBDYXJ0ZXNpYW4yIGZyb20gXCIuLi9Db3JlL0NhcnRlc2lhbjIuanNcIjtcbmltcG9ydCBDYXJ0ZXNpYW40IGZyb20gXCIuLi9Db3JlL0NhcnRlc2lhbjQuanNcIjtcbmltcG9ydCBDaGVjayBmcm9tIFwiLi4vQ29yZS9DaGVjay5qc1wiO1xuaW1wb3J0IENvbG9yIGZyb20gXCIuLi9Db3JlL0NvbG9yLmpzXCI7XG5pbXBvcnQgZGVmaW5lZCBmcm9tIFwiLi4vQ29yZS9kZWZpbmVkLmpzXCI7XG5pbXBvcnQgZGVzdHJveU9iamVjdCBmcm9tIFwiLi4vQ29yZS9kZXN0cm95T2JqZWN0LmpzXCI7XG5pbXBvcnQgRGV2ZWxvcGVyRXJyb3IgZnJvbSBcIi4uL0NvcmUvRGV2ZWxvcGVyRXJyb3IuanNcIjtcbmltcG9ydCBQaXhlbEZvcm1hdCBmcm9tIFwiLi4vQ29yZS9QaXhlbEZvcm1hdC5qc1wiO1xuaW1wb3J0IENvbnRleHRMaW1pdHMgZnJvbSBcIi4uL1JlbmRlcmVyL0NvbnRleHRMaW1pdHMuanNcIjtcbmltcG9ydCBQaXhlbERhdGF0eXBlIGZyb20gXCIuLi9SZW5kZXJlci9QaXhlbERhdGF0eXBlLmpzXCI7XG5pbXBvcnQgU2FtcGxlciBmcm9tIFwiLi4vUmVuZGVyZXIvU2FtcGxlci5qc1wiO1xuaW1wb3J0IFRleHR1cmUgZnJvbSBcIi4uL1JlbmRlcmVyL1RleHR1cmUuanNcIjtcblxuLyoqXG4gKiBBbiBvYmplY3QgdGhhdCBtYW5hZ2VzIGNvbG9yLCBzaG93L2hpZGUgYW5kIHBpY2tpbmcgdGV4dHVyZXMgZm9yIGEgYmF0Y2hcbiAqIHRhYmxlIG9yIGZlYXR1cmUgdGFibGUuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgT2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICogQHBhcmFtIHtOdW1iZXJ9IGZlYXR1cmVzTGVuZ3RoIFRoZSBudW1iZXIgb2YgZmVhdHVyZXMgaW4gdGhlIGJhdGNoIHRhYmxlIG9yIGZlYXR1cmUgdGFibGVcbiAqIEBwYXJhbSB7Q2VzaXVtM0RUaWxlQ29udGVudH0gY29udGVudCBUaGUgY29udGVudCB0aGlzIGJhdGNoIHRleHR1cmUgYmVsb25ncyB0by4gVXNlZCBmb3IgY3JlYXRpbmcgdGhlIHBpY2tpbmcgdGV4dHVyZS5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb2xvckNoYW5nZWRDYWxsYmFja10gQSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuZXZlciB0aGUgY29sb3Igb2YgYSBmZWF0dXJlIGNoYW5nZXMuXG4gKlxuICogQGFsaWFzIEJhdGNoVGV4dHVyZVxuICogQGNvbnN0cnVjdG9yXG4gKlxuICogQHByaXZhdGVcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQmF0Y2hUZXh0dXJlKG9wdGlvbnMpIHtcbiAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgQ2hlY2sudHlwZU9mLm51bWJlcihcIm9wdGlvbnMuZmVhdHVyZXNMZW5ndGhcIiwgb3B0aW9ucy5mZWF0dXJlc0xlbmd0aCk7XG4gIENoZWNrLnR5cGVPZi5vYmplY3QoXCJvcHRpb25zLmNvbnRlbnRcIiwgb3B0aW9ucy5jb250ZW50KTtcbiAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgdmFyIGZlYXR1cmVzTGVuZ3RoID0gb3B0aW9ucy5mZWF0dXJlc0xlbmd0aDtcblxuICAvLyBQRVJGT1JNQU5DRV9JREVBOiBUaGVzZSBwYXJhbGxlbCBhcnJheXMgcHJvYmFibHkgZ2VuZXJhdGUgY2FjaGUgbWlzc2VzIGluIGdldC9zZXQgY29sb3Ivc2hvd1xuICAvLyBhbmQgdXNlIEEgTE9UIG9mIG1lbW9yeS4gIEhvdyBjYW4gd2UgdXNlIGxlc3MgbWVtb3J5P1xuICB0aGlzLl9zaG93QWxwaGFQcm9wZXJ0aWVzID0gdW5kZWZpbmVkOyAvLyBbU2hvdyAoMCBvciAyNTUpLCBBbHBoYSAoMCB0byAyNTUpXSBwcm9wZXJ0eSBmb3IgZWFjaCBmZWF0dXJlXG4gIHRoaXMuX2JhdGNoVmFsdWVzID0gdW5kZWZpbmVkOyAvLyBQZXItZmVhdHVyZSBSR0JBIChBIGlzIGJhc2VkIG9uIHRoZSBjb2xvcidzIGFscGhhIGFuZCBmZWF0dXJlJ3Mgc2hvdyBwcm9wZXJ0eSlcblxuICB0aGlzLl9iYXRjaFZhbHVlc0RpcnR5ID0gZmFsc2U7XG4gIHRoaXMuX2JhdGNoVGV4dHVyZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fZGVmYXVsdFRleHR1cmUgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fcGlja1RleHR1cmUgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX3BpY2tJZHMgPSBbXTtcblxuICAvLyBEaW1lbnNpb25zIGZvciBiYXRjaCBhbmQgcGljayB0ZXh0dXJlc1xuICB2YXIgdGV4dHVyZURpbWVuc2lvbnM7XG4gIHZhciB0ZXh0dXJlU3RlcDtcblxuICBpZiAoZmVhdHVyZXNMZW5ndGggPiAwKSB7XG4gICAgLy8gUEVSRk9STUFOQ0VfSURFQTogdGhpcyBjYW4gd2FzdGUgbWVtb3J5IGluIHRoZSBsYXN0IHJvdyBpbiB0aGUgdW5jb21tb24gY2FzZVxuICAgIC8vIHdoZW4gbW9yZSB0aGFuIG9uZSByb3cgaXMgbmVlZGVkIChlLmcuLCA+IDE2SyBmZWF0dXJlcyBpbiBvbmUgdGlsZSlcbiAgICB2YXIgd2lkdGggPSBNYXRoLm1pbihmZWF0dXJlc0xlbmd0aCwgQ29udGV4dExpbWl0cy5tYXhpbXVtVGV4dHVyZVNpemUpO1xuICAgIHZhciBoZWlnaHQgPSBNYXRoLmNlaWwoZmVhdHVyZXNMZW5ndGggLyBDb250ZXh0TGltaXRzLm1heGltdW1UZXh0dXJlU2l6ZSk7XG4gICAgdmFyIHN0ZXBYID0gMS4wIC8gd2lkdGg7XG4gICAgdmFyIGNlbnRlclggPSBzdGVwWCAqIDAuNTtcbiAgICB2YXIgc3RlcFkgPSAxLjAgLyBoZWlnaHQ7XG4gICAgdmFyIGNlbnRlclkgPSBzdGVwWSAqIDAuNTtcblxuICAgIHRleHR1cmVEaW1lbnNpb25zID0gbmV3IENhcnRlc2lhbjIod2lkdGgsIGhlaWdodCk7XG4gICAgdGV4dHVyZVN0ZXAgPSBuZXcgQ2FydGVzaWFuNChzdGVwWCwgY2VudGVyWCwgc3RlcFksIGNlbnRlclkpO1xuICB9XG5cbiAgdGhpcy5fdHJhbnNsdWNlbnRGZWF0dXJlc0xlbmd0aCA9IDA7XG4gIHRoaXMuX2ZlYXR1cmVzTGVuZ3RoID0gZmVhdHVyZXNMZW5ndGg7XG4gIHRoaXMuX3RleHR1cmVEaW1lbnNpb25zID0gdGV4dHVyZURpbWVuc2lvbnM7XG4gIHRoaXMuX3RleHR1cmVTdGVwID0gdGV4dHVyZVN0ZXA7XG4gIHRoaXMuX2NvbnRlbnQgPSBvcHRpb25zLmNvbnRlbnQ7XG4gIHRoaXMuX2NvbG9yQ2hhbmdlZENhbGxiYWNrID0gb3B0aW9ucy5jb2xvckNoYW5nZWRDYWxsYmFjaztcbn1cblxuT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoQmF0Y2hUZXh0dXJlLnByb3RvdHlwZSwge1xuICAvKipcbiAgICogTnVtYmVyIG9mIGZlYXR1cmVzIHRoYXQgYXJlIHRyYW5zbHVjZW50XG4gICAqXG4gICAqIEBtZW1iZXJvZiBCYXRjaFRleHR1cmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAqIEByZWFkb25seVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdHJhbnNsdWNlbnRGZWF0dXJlc0xlbmd0aDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zbHVjZW50RmVhdHVyZXNMZW5ndGg7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVG90YWwgc2l6ZSBvZiBhbGwgR1BVIHJlc291cmNlcyB1c2VkIGJ5IHRoaXMgYmF0Y2ggdGV4dHVyZS5cbiAgICpcbiAgICogQG1lbWJlcm9mIEJhdGNoVGV4dHVyZS5wcm90b3R5cGVcbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQHJlYWRvbmx5XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBtZW1vcnlTaXplSW5CeXRlczoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG1lbW9yeSA9IDA7XG4gICAgICBpZiAoZGVmaW5lZCh0aGlzLl9waWNrVGV4dHVyZSkpIHtcbiAgICAgICAgbWVtb3J5ICs9IHRoaXMuX3BpY2tUZXh0dXJlLnNpemVJbkJ5dGVzO1xuICAgICAgfVxuICAgICAgaWYgKGRlZmluZWQodGhpcy5fYmF0Y2hUZXh0dXJlKSkge1xuICAgICAgICBtZW1vcnkgKz0gdGhpcy5fYmF0Y2hUZXh0dXJlLnNpemVJbkJ5dGVzO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1lbW9yeTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBEaW1lbnNpb25zIG9mIHRoZSB1bmRlcmx5aW5nIGJhdGNoIHRleHR1cmUuXG4gICAqXG4gICAqIEBtZW1iZXJvZiBCYXRjaFRleHR1cmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtDYXJ0ZXNpYW4yfVxuICAgKiBAcmVhZG9ubHlcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRleHR1cmVEaW1lbnNpb25zOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdGV4dHVyZURpbWVuc2lvbnM7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogU2l6ZSBvZiBlYWNoIHRleHR1cmUgYW5kIGRpc3RhbmNlIGZyb20gc2lkZSB0byBjZW50ZXIgb2YgYSB0ZXhlbCBpblxuICAgKiBlYWNoIGRpcmVjdGlvbi4gU3RvcmVkIGFzIChzdGVwWCwgY2VudGVyWCwgc3RlcFksIGNlbnRlclkpXG4gICAqXG4gICAqIEBtZW1iZXJvZiBCYXRjaFRleHR1cmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtDYXJ0ZXNpYW40fVxuICAgKiBAcmVhZG9ubHlcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRleHR1cmVTdGVwOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdGV4dHVyZVN0ZXA7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVGhlIHVuZGVybHlpbmcgdGV4dHVyZSB1c2VkIGZvciBzdHlsaW5nLiBUaGUgdGV4ZWxzIGFyZSBhY2Nlc3NlZFxuICAgKiBieSBiYXRjaCBJRCwgYW5kIHRoZSB2YWx1ZSBpcyB0aGUgY29sb3Igb2YgdGhpcyBmZWF0dXJlIGFmdGVyIGFjY291bnRpbmdcbiAgICogZm9yIHNob3cvaGlkZSBzZXR0aW5ncy5cbiAgICpcbiAgICogQG1lbWJlcm9mIEJhdGNoVGV4dHVyZS5wcm90b3R5cGVcbiAgICogQHR5cGUge1RleHR1cmV9XG4gICAqIEByZWFkb25seVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgYmF0Y2hUZXh0dXJlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYmF0Y2hUZXh0dXJlO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoZSBkZWZhdWx0IHRleHR1cmUgdG8gdXNlIHdoZW4gdGhlcmUgYXJlIG5vIGJhdGNoIHZhbHVlc1xuICAgKlxuICAgKiBAbWVtYmVyb2YgQmF0Y2hUZXh0dXJlLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7VGV4dHVyZX1cbiAgICogQHJlYWRvbmx5XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBkZWZhdWx0VGV4dHVyZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHRUZXh0dXJlO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoZSB1bmRlcmx5aW5nIHRleHR1cmUgdXNlZCBmb3IgcGlja2luZy4gVGhlIHRleGVscyBhcmUgYWNjZXNzZWQgYnlcbiAgICogYmF0Y2ggSUQsIGFuZCB0aGUgdmFsdWUgaXMgdGhlIHBpY2sgY29sb3IuXG4gICAqXG4gICAqIEBtZW1iZXJvZiBCYXRjaFRleHR1cmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtUZXh0dXJlfVxuICAgKiBAcmVhZG9ubHlcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHBpY2tUZXh0dXJlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcGlja1RleHR1cmU7XG4gICAgfSxcbiAgfSxcbn0pO1xuXG5CYXRjaFRleHR1cmUuREVGQVVMVF9DT0xPUl9WQUxVRSA9IENvbG9yLldISVRFO1xuQmF0Y2hUZXh0dXJlLkRFRkFVTFRfU0hPV19WQUxVRSA9IHRydWU7XG5cbmZ1bmN0aW9uIGdldEJ5dGVMZW5ndGgoYmF0Y2hUZXh0dXJlKSB7XG4gIHZhciBkaW1lbnNpb25zID0gYmF0Y2hUZXh0dXJlLl90ZXh0dXJlRGltZW5zaW9ucztcbiAgcmV0dXJuIGRpbWVuc2lvbnMueCAqIGRpbWVuc2lvbnMueSAqIDQ7XG59XG5cbmZ1bmN0aW9uIGdldEJhdGNoVmFsdWVzKGJhdGNoVGV4dHVyZSkge1xuICBpZiAoIWRlZmluZWQoYmF0Y2hUZXh0dXJlLl9iYXRjaFZhbHVlcykpIHtcbiAgICAvLyBEZWZhdWx0IGJhdGNoIHRleHR1cmUgdG8gUkdCQSA9IDI1NTogd2hpdGUgaGlnaGxpZ2h0IChSR0IpIGFuZCBzaG93L2FscGhhID0gdHJ1ZS8yNTUgKEEpLlxuICAgIHZhciBieXRlTGVuZ3RoID0gZ2V0Qnl0ZUxlbmd0aChiYXRjaFRleHR1cmUpO1xuICAgIHZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJ5dGVMZW5ndGgpO1xuICAgIGFycmF5RmlsbChieXRlcywgMjU1KTtcbiAgICBiYXRjaFRleHR1cmUuX2JhdGNoVmFsdWVzID0gYnl0ZXM7XG4gIH1cblxuICByZXR1cm4gYmF0Y2hUZXh0dXJlLl9iYXRjaFZhbHVlcztcbn1cblxuZnVuY3Rpb24gZ2V0U2hvd0FscGhhUHJvcGVydGllcyhiYXRjaFRleHR1cmUpIHtcbiAgaWYgKCFkZWZpbmVkKGJhdGNoVGV4dHVyZS5fc2hvd0FscGhhUHJvcGVydGllcykpIHtcbiAgICB2YXIgYnl0ZUxlbmd0aCA9IDIgKiBiYXRjaFRleHR1cmUuX2ZlYXR1cmVzTGVuZ3RoO1xuICAgIHZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJ5dGVMZW5ndGgpO1xuICAgIC8vIFtTaG93ID0gdHJ1ZSwgQWxwaGEgPSAyNTVdXG4gICAgYXJyYXlGaWxsKGJ5dGVzLCAyNTUpO1xuICAgIGJhdGNoVGV4dHVyZS5fc2hvd0FscGhhUHJvcGVydGllcyA9IGJ5dGVzO1xuICB9XG4gIHJldHVybiBiYXRjaFRleHR1cmUuX3Nob3dBbHBoYVByb3BlcnRpZXM7XG59XG5cbmZ1bmN0aW9uIGNoZWNrQmF0Y2hJZChiYXRjaElkLCBmZWF0dXJlc0xlbmd0aCkge1xuICBpZiAoIWRlZmluZWQoYmF0Y2hJZCkgfHwgYmF0Y2hJZCA8IDAgfHwgYmF0Y2hJZCA+PSBmZWF0dXJlc0xlbmd0aCkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcbiAgICAgIFwiYmF0Y2hJZCBpcyByZXF1aXJlZCBhbmQgYmV0d2VlbiB6ZXJvIGFuZCBmZWF0dXJlc0xlbmd0aCAtIDEgKFwiICtcbiAgICAgICAgZmVhdHVyZXNMZW5ndGggLVxuICAgICAgICArXCIpLlwiXG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIFNldCB3aGV0aGVyIGEgZmVhdHVyZSBpcyB2aXNpYmxlLlxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBiYXRjaElkIHRoZSBJRCBvZiB0aGUgZmVhdHVyZVxuICogQHBhcmFtIHtCb29sZWFufSBzaG93IDxjb2RlPnRydWU8L2NvZGU+IGlmIHRoZSBmZWF0dXJlIHNob3VsZCBiZSBzaG93biwgPGNvZGU+ZmFsc2U8L2NvZGU+IG90aGVyd2lzZVxuICogQHByaXZhdGVcbiAqL1xuQmF0Y2hUZXh0dXJlLnByb3RvdHlwZS5zZXRTaG93ID0gZnVuY3Rpb24gKGJhdGNoSWQsIHNob3cpIHtcbiAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgY2hlY2tCYXRjaElkKGJhdGNoSWQsIHRoaXMuX2ZlYXR1cmVzTGVuZ3RoKTtcbiAgQ2hlY2sudHlwZU9mLmJvb2woXCJzaG93XCIsIHNob3cpO1xuICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICBpZiAoc2hvdyAmJiAhZGVmaW5lZCh0aGlzLl9zaG93QWxwaGFQcm9wZXJ0aWVzKSkge1xuICAgIC8vIEF2b2lkIGFsbG9jYXRpbmcgc2luY2UgdGhlIGRlZmF1bHQgaXMgc2hvdyA9IHRydWVcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc2hvd0FscGhhUHJvcGVydGllcyA9IGdldFNob3dBbHBoYVByb3BlcnRpZXModGhpcyk7XG4gIHZhciBwcm9wZXJ0eU9mZnNldCA9IGJhdGNoSWQgKiAyO1xuXG4gIHZhciBuZXdTaG93ID0gc2hvdyA/IDI1NSA6IDA7XG4gIGlmIChzaG93QWxwaGFQcm9wZXJ0aWVzW3Byb3BlcnR5T2Zmc2V0XSAhPT0gbmV3U2hvdykge1xuICAgIHNob3dBbHBoYVByb3BlcnRpZXNbcHJvcGVydHlPZmZzZXRdID0gbmV3U2hvdztcblxuICAgIHZhciBiYXRjaFZhbHVlcyA9IGdldEJhdGNoVmFsdWVzKHRoaXMpO1xuXG4gICAgLy8gQ29tcHV0ZSBhbHBoYSB1c2VkIGluIHRoZSBzaGFkZXIgYmFzZWQgb24gc2hvdyBhbmQgY29sb3IuYWxwaGEgcHJvcGVydGllc1xuICAgIHZhciBvZmZzZXQgPSBiYXRjaElkICogNCArIDM7XG4gICAgYmF0Y2hWYWx1ZXNbb2Zmc2V0XSA9IHNob3cgPyBzaG93QWxwaGFQcm9wZXJ0aWVzW3Byb3BlcnR5T2Zmc2V0ICsgMV0gOiAwO1xuXG4gICAgdGhpcy5fYmF0Y2hWYWx1ZXNEaXJ0eSA9IHRydWU7XG4gIH1cbn07XG5cbi8qKlxuICogU2V0IHRoZSBzaG93IGZvciBhbGwgZmVhdHVyZXMgYXQgb25jZS5cbiAqXG4gKiBAcGFyYW0ge0Jvb2xlYW59IHNob3cgPGNvZGU+dHJ1ZTwvY29kZT4gaWYgdGhlIGZlYXR1cmUgc2hvdWxkIGJlIHNob3duLCA8Y29kZT5mYWxzZTwvY29kZT4gb3RoZXJ3aXNlXG4gKiBAcHJpdmF0ZVxuICovXG5CYXRjaFRleHR1cmUucHJvdG90eXBlLnNldEFsbFNob3cgPSBmdW5jdGlvbiAoc2hvdykge1xuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBDaGVjay50eXBlT2YuYm9vbChcInNob3dcIiwgc2hvdyk7XG4gIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gIHZhciBmZWF0dXJlc0xlbmd0aCA9IHRoaXMuX2ZlYXR1cmVzTGVuZ3RoO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGZlYXR1cmVzTGVuZ3RoOyArK2kpIHtcbiAgICB0aGlzLnNldFNob3coaSwgc2hvdyk7XG4gIH1cbn07XG5cbi8qKlxuICogQ2hlY2sgdGhlIGN1cnJlbnQgc2hvdyB2YWx1ZSBmb3IgYSBmZWF0dXJlXG4gKlxuICogQHBhcmFtIHtOdW1iZXJ9IGJhdGNoSWQgdGhlIElEIG9mIHRoZSBmZWF0dXJlXG4gKiBAcmV0dXJuIHtCb29sZWFufSA8Y29kZT50cnVlPC9jb2RlPiBpZiB0aGUgZmVhdHVyZSBpcyBzaG93biwgb3IgPGNvZGU+ZmFsc2U8L2NvZGU+IG90aGVyd2lzZVxuICogQHByaXZhdGVcbiAqL1xuQmF0Y2hUZXh0dXJlLnByb3RvdHlwZS5nZXRTaG93ID0gZnVuY3Rpb24gKGJhdGNoSWQpIHtcbiAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgY2hlY2tCYXRjaElkKGJhdGNoSWQsIHRoaXMuX2ZlYXR1cmVzTGVuZ3RoKTtcbiAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgaWYgKCFkZWZpbmVkKHRoaXMuX3Nob3dBbHBoYVByb3BlcnRpZXMpKSB7XG4gICAgLy8gQXZvaWQgYWxsb2NhdGluZyBzaW5jZSB0aGUgZGVmYXVsdCBpcyBzaG93ID0gdHJ1ZVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgdmFyIG9mZnNldCA9IGJhdGNoSWQgKiAyO1xuICByZXR1cm4gdGhpcy5fc2hvd0FscGhhUHJvcGVydGllc1tvZmZzZXRdID09PSAyNTU7XG59O1xuXG52YXIgc2NyYXRjaENvbG9yQnl0ZXMgPSBuZXcgQXJyYXkoNCk7XG5cbi8qKlxuICogU2V0IHRoZSBzdHlsaW5nIGNvbG9yIG9mIGEgZmVhdHVyZVxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBiYXRjaElkIHRoZSBJRCBvZiB0aGUgZmVhdHVyZVxuICogQHBhcmFtIHtDb2xvcn0gY29sb3IgdGhlIGNvbG9yIHRvIGFzc2lnbiB0byB0aGlzIGZlYXR1cmUuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuQmF0Y2hUZXh0dXJlLnByb3RvdHlwZS5zZXRDb2xvciA9IGZ1bmN0aW9uIChiYXRjaElkLCBjb2xvcikge1xuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBjaGVja0JhdGNoSWQoYmF0Y2hJZCwgdGhpcy5fZmVhdHVyZXNMZW5ndGgpO1xuICBDaGVjay50eXBlT2Yub2JqZWN0KFwiY29sb3JcIiwgY29sb3IpO1xuICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICBpZiAoXG4gICAgQ29sb3IuZXF1YWxzKGNvbG9yLCBCYXRjaFRleHR1cmUuREVGQVVMVF9DT0xPUl9WQUxVRSkgJiZcbiAgICAhZGVmaW5lZCh0aGlzLl9iYXRjaFZhbHVlcylcbiAgKSB7XG4gICAgLy8gQXZvaWQgYWxsb2NhdGluZyBzaW5jZSB0aGUgZGVmYXVsdCBpcyB3aGl0ZVxuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBuZXdDb2xvciA9IGNvbG9yLnRvQnl0ZXMoc2NyYXRjaENvbG9yQnl0ZXMpO1xuICB2YXIgbmV3QWxwaGEgPSBuZXdDb2xvclszXTtcblxuICB2YXIgYmF0Y2hWYWx1ZXMgPSBnZXRCYXRjaFZhbHVlcyh0aGlzKTtcbiAgdmFyIG9mZnNldCA9IGJhdGNoSWQgKiA0O1xuXG4gIHZhciBzaG93QWxwaGFQcm9wZXJ0aWVzID0gZ2V0U2hvd0FscGhhUHJvcGVydGllcyh0aGlzKTtcbiAgdmFyIHByb3BlcnR5T2Zmc2V0ID0gYmF0Y2hJZCAqIDI7XG5cbiAgaWYgKFxuICAgIGJhdGNoVmFsdWVzW29mZnNldF0gIT09IG5ld0NvbG9yWzBdIHx8XG4gICAgYmF0Y2hWYWx1ZXNbb2Zmc2V0ICsgMV0gIT09IG5ld0NvbG9yWzFdIHx8XG4gICAgYmF0Y2hWYWx1ZXNbb2Zmc2V0ICsgMl0gIT09IG5ld0NvbG9yWzJdIHx8XG4gICAgc2hvd0FscGhhUHJvcGVydGllc1twcm9wZXJ0eU9mZnNldCArIDFdICE9PSBuZXdBbHBoYVxuICApIHtcbiAgICBiYXRjaFZhbHVlc1tvZmZzZXRdID0gbmV3Q29sb3JbMF07XG4gICAgYmF0Y2hWYWx1ZXNbb2Zmc2V0ICsgMV0gPSBuZXdDb2xvclsxXTtcbiAgICBiYXRjaFZhbHVlc1tvZmZzZXQgKyAyXSA9IG5ld0NvbG9yWzJdO1xuXG4gICAgdmFyIHdhc1RyYW5zbHVjZW50ID0gc2hvd0FscGhhUHJvcGVydGllc1twcm9wZXJ0eU9mZnNldCArIDFdICE9PSAyNTU7XG5cbiAgICAvLyBDb21wdXRlIGFscGhhIHVzZWQgaW4gdGhlIHNoYWRlciBiYXNlZCBvbiBzaG93IGFuZCBjb2xvci5hbHBoYSBwcm9wZXJ0aWVzXG4gICAgdmFyIHNob3cgPSBzaG93QWxwaGFQcm9wZXJ0aWVzW3Byb3BlcnR5T2Zmc2V0XSAhPT0gMDtcbiAgICBiYXRjaFZhbHVlc1tvZmZzZXQgKyAzXSA9IHNob3cgPyBuZXdBbHBoYSA6IDA7XG4gICAgc2hvd0FscGhhUHJvcGVydGllc1twcm9wZXJ0eU9mZnNldCArIDFdID0gbmV3QWxwaGE7XG5cbiAgICAvLyBUcmFjayBudW1iZXIgb2YgdHJhbnNsdWNlbnQgZmVhdHVyZXMgc28gd2Uga25vdyBpZiB0aGlzIHRpbGUgbmVlZHNcbiAgICAvLyBvcGFxdWUgY29tbWFuZHMsIHRyYW5zbHVjZW50IGNvbW1hbmRzLCBvciBib3RoIGZvciByZW5kZXJpbmcuXG4gICAgdmFyIGlzVHJhbnNsdWNlbnQgPSBuZXdBbHBoYSAhPT0gMjU1O1xuICAgIGlmIChpc1RyYW5zbHVjZW50ICYmICF3YXNUcmFuc2x1Y2VudCkge1xuICAgICAgKyt0aGlzLl90cmFuc2x1Y2VudEZlYXR1cmVzTGVuZ3RoO1xuICAgIH0gZWxzZSBpZiAoIWlzVHJhbnNsdWNlbnQgJiYgd2FzVHJhbnNsdWNlbnQpIHtcbiAgICAgIC0tdGhpcy5fdHJhbnNsdWNlbnRGZWF0dXJlc0xlbmd0aDtcbiAgICB9XG5cbiAgICB0aGlzLl9iYXRjaFZhbHVlc0RpcnR5ID0gdHJ1ZTtcblxuICAgIGlmIChkZWZpbmVkKHRoaXMuX2NvbG9yQ2hhbmdlZENhbGxiYWNrKSkge1xuICAgICAgdGhpcy5fY29sb3JDaGFuZ2VkQ2FsbGJhY2soYmF0Y2hJZCwgY29sb3IpO1xuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBTZXQgdGhlIHN0eWxpbmcgY29sb3IgZm9yIGFsbCBmZWF0dXJlcyBhdCBvbmNlXG4gKlxuICogQHBhcmFtIHtDb2xvcn0gY29sb3IgdGhlIGNvbG9yIHRvIGFzc2lnbiB0byBhbGwgZmVhdHVyZXMuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuQmF0Y2hUZXh0dXJlLnByb3RvdHlwZS5zZXRBbGxDb2xvciA9IGZ1bmN0aW9uIChjb2xvcikge1xuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBDaGVjay50eXBlT2Yub2JqZWN0KFwiY29sb3JcIiwgY29sb3IpO1xuICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICB2YXIgZmVhdHVyZXNMZW5ndGggPSB0aGlzLl9mZWF0dXJlc0xlbmd0aDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBmZWF0dXJlc0xlbmd0aDsgKytpKSB7XG4gICAgdGhpcy5zZXRDb2xvcihpLCBjb2xvcik7XG4gIH1cbn07XG5cbi8qKlxuICogR2V0IHRoZSBjdXJyZW50IGNvbG9yIG9mIGEgZmVhdHVyZVxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBiYXRjaElkIFRoZSBJRCBvZiB0aGUgZmVhdHVyZVxuICogQHBhcmFtIHtDb2xvcn0gcmVzdWx0IEEgY29sb3Igb2JqZWN0IHdoZXJlIHRoZSByZXN1bHQgd2lsbCBiZSBzdG9yZWQuXG4gKiBAcmV0dXJuIHtDb2xvcn0gVGhlIGNvbG9yIGFzc2lnbmVkIHRvIHRoZSBzZWxlY3RlZCBmZWF0dXJlXG4gKlxuICogQHByaXZhdGVcbiAqL1xuQmF0Y2hUZXh0dXJlLnByb3RvdHlwZS5nZXRDb2xvciA9IGZ1bmN0aW9uIChiYXRjaElkLCByZXN1bHQpIHtcbiAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgY2hlY2tCYXRjaElkKGJhdGNoSWQsIHRoaXMuX2ZlYXR1cmVzTGVuZ3RoKTtcbiAgQ2hlY2sudHlwZU9mLm9iamVjdChcInJlc3VsdFwiLCByZXN1bHQpO1xuICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICBpZiAoIWRlZmluZWQodGhpcy5fYmF0Y2hWYWx1ZXMpKSB7XG4gICAgcmV0dXJuIENvbG9yLmNsb25lKEJhdGNoVGV4dHVyZS5ERUZBVUxUX0NPTE9SX1ZBTFVFLCByZXN1bHQpO1xuICB9XG5cbiAgdmFyIGJhdGNoVmFsdWVzID0gdGhpcy5fYmF0Y2hWYWx1ZXM7XG4gIHZhciBvZmZzZXQgPSBiYXRjaElkICogNDtcblxuICB2YXIgc2hvd0FscGhhUHJvcGVydGllcyA9IHRoaXMuX3Nob3dBbHBoYVByb3BlcnRpZXM7XG4gIHZhciBwcm9wZXJ0eU9mZnNldCA9IGJhdGNoSWQgKiAyO1xuXG4gIHJldHVybiBDb2xvci5mcm9tQnl0ZXMoXG4gICAgYmF0Y2hWYWx1ZXNbb2Zmc2V0XSxcbiAgICBiYXRjaFZhbHVlc1tvZmZzZXQgKyAxXSxcbiAgICBiYXRjaFZhbHVlc1tvZmZzZXQgKyAyXSxcbiAgICBzaG93QWxwaGFQcm9wZXJ0aWVzW3Byb3BlcnR5T2Zmc2V0ICsgMV0sXG4gICAgcmVzdWx0XG4gICk7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgcGljayBjb2xvciBvZiBhIGZlYXR1cmUuIFRoaXMgZmVhdHVyZSBpcyBhbiBSR0JBIGVuY29kaW5nIG9mIHRoZVxuICogcGljayBJRC5cbiAqXG4gKiBAcGFyYW0ge051bWJlcn0gYmF0Y2hJZCBUaGUgSUQgb2YgdGhlIGZlYXR1cmVcbiAqIEByZXR1cm4ge1BpY2tJZH0gVGhlIHBpY2tpbmcgY29sb3IgYXNzaWduZWQgdG8gdGhpcyBmZWF0dXJlXG4gKlxuICogQHByaXZhdGVcbiAqL1xuQmF0Y2hUZXh0dXJlLnByb3RvdHlwZS5nZXRQaWNrQ29sb3IgPSBmdW5jdGlvbiAoYmF0Y2hJZCkge1xuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBjaGVja0JhdGNoSWQoYmF0Y2hJZCwgdGhpcy5fZmVhdHVyZXNMZW5ndGgpO1xuICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcbiAgcmV0dXJuIHRoaXMuX3BpY2tJZHNbYmF0Y2hJZF07XG59O1xuXG5mdW5jdGlvbiBjcmVhdGVUZXh0dXJlKGJhdGNoVGV4dHVyZSwgY29udGV4dCwgYnl0ZXMpIHtcbiAgdmFyIGRpbWVuc2lvbnMgPSBiYXRjaFRleHR1cmUuX3RleHR1cmVEaW1lbnNpb25zO1xuICByZXR1cm4gbmV3IFRleHR1cmUoe1xuICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgcGl4ZWxGb3JtYXQ6IFBpeGVsRm9ybWF0LlJHQkEsXG4gICAgcGl4ZWxEYXRhdHlwZTogUGl4ZWxEYXRhdHlwZS5VTlNJR05FRF9CWVRFLFxuICAgIHNvdXJjZToge1xuICAgICAgd2lkdGg6IGRpbWVuc2lvbnMueCxcbiAgICAgIGhlaWdodDogZGltZW5zaW9ucy55LFxuICAgICAgYXJyYXlCdWZmZXJWaWV3OiBieXRlcyxcbiAgICB9LFxuICAgIGZsaXBZOiBmYWxzZSxcbiAgICBzYW1wbGVyOiBTYW1wbGVyLk5FQVJFU1QsXG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVQaWNrVGV4dHVyZShiYXRjaFRleHR1cmUsIGNvbnRleHQpIHtcbiAgdmFyIGZlYXR1cmVzTGVuZ3RoID0gYmF0Y2hUZXh0dXJlLl9mZWF0dXJlc0xlbmd0aDtcbiAgaWYgKCFkZWZpbmVkKGJhdGNoVGV4dHVyZS5fcGlja1RleHR1cmUpICYmIGZlYXR1cmVzTGVuZ3RoID4gMCkge1xuICAgIHZhciBwaWNrSWRzID0gYmF0Y2hUZXh0dXJlLl9waWNrSWRzO1xuICAgIHZhciBieXRlTGVuZ3RoID0gZ2V0Qnl0ZUxlbmd0aChiYXRjaFRleHR1cmUpO1xuICAgIHZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJ5dGVMZW5ndGgpO1xuICAgIHZhciBjb250ZW50ID0gYmF0Y2hUZXh0dXJlLl9jb250ZW50O1xuXG4gICAgLy8gUEVSRk9STUFOQ0VfSURFQTogd2UgY291bGQgc2tpcCB0aGUgcGljayB0ZXh0dXJlIGNvbXBsZXRlbHkgYnkgYWxsb2NhdGluZ1xuICAgIC8vIGEgY29udGludW91cyByYW5nZSBvZiBwaWNrSWRzIGFuZCB0aGVuIGNvbnZlcnRpbmcgdGhlIGJhc2UgcGlja0lkICsgYmF0Y2hJZFxuICAgIC8vIHRvIFJHQkEgaW4gdGhlIHNoYWRlci4gIFRoZSBvbmx5IGNvbnNpZGVyIGlzIHByZWNpc2lvbiBpc3N1ZXMsIHdoaWNoIG1pZ2h0XG4gICAgLy8gbm90IGJlIGFuIGlzc3VlIGluIFdlYkdMIDIuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmZWF0dXJlc0xlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgcGlja0lkID0gY29udGV4dC5jcmVhdGVQaWNrSWQoY29udGVudC5nZXRGZWF0dXJlKGkpKTtcbiAgICAgIHBpY2tJZHMucHVzaChwaWNrSWQpO1xuXG4gICAgICB2YXIgcGlja0NvbG9yID0gcGlja0lkLmNvbG9yO1xuICAgICAgdmFyIG9mZnNldCA9IGkgKiA0O1xuICAgICAgYnl0ZXNbb2Zmc2V0XSA9IENvbG9yLmZsb2F0VG9CeXRlKHBpY2tDb2xvci5yZWQpO1xuICAgICAgYnl0ZXNbb2Zmc2V0ICsgMV0gPSBDb2xvci5mbG9hdFRvQnl0ZShwaWNrQ29sb3IuZ3JlZW4pO1xuICAgICAgYnl0ZXNbb2Zmc2V0ICsgMl0gPSBDb2xvci5mbG9hdFRvQnl0ZShwaWNrQ29sb3IuYmx1ZSk7XG4gICAgICBieXRlc1tvZmZzZXQgKyAzXSA9IENvbG9yLmZsb2F0VG9CeXRlKHBpY2tDb2xvci5hbHBoYSk7XG4gICAgfVxuXG4gICAgYmF0Y2hUZXh0dXJlLl9waWNrVGV4dHVyZSA9IGNyZWF0ZVRleHR1cmUoYmF0Y2hUZXh0dXJlLCBjb250ZXh0LCBieXRlcyk7XG4gICAgY29udGVudC50aWxlc2V0Ll9zdGF0aXN0aWNzLmJhdGNoVGFibGVCeXRlTGVuZ3RoICs9XG4gICAgICBiYXRjaFRleHR1cmUuX3BpY2tUZXh0dXJlLnNpemVJbkJ5dGVzO1xuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUJhdGNoVGV4dHVyZShiYXRjaFRleHR1cmUpIHtcbiAgdmFyIGRpbWVuc2lvbnMgPSBiYXRjaFRleHR1cmUuX3RleHR1cmVEaW1lbnNpb25zO1xuICAvLyBQRVJGT1JNQU5DRV9JREVBOiBJbnN0ZWFkIG9mIHJld3JpdGluZyB0aGUgZW50aXJlIHRleHR1cmUsIHVzZSBmaW5lLWdyYWluZWRcbiAgLy8gdGV4dHVyZSB1cGRhdGVzIHdoZW4gbGVzcyB0aGFuLCBmb3IgZXhhbXBsZSwgMTAlLCBvZiB0aGUgdmFsdWVzIGNoYW5nZWQuICBPclxuICAvLyBldmVuIGp1c3Qgb3B0aW1pemUgdGhlIGNvbW1vbiBjYXNlIHdoZW4gb25lIGZlYXR1cmUgc2hvdy9jb2xvciBjaGFuZ2VkLlxuICBiYXRjaFRleHR1cmUuX2JhdGNoVGV4dHVyZS5jb3B5RnJvbSh7XG4gICAgc291cmNlOiB7XG4gICAgICB3aWR0aDogZGltZW5zaW9ucy54LFxuICAgICAgaGVpZ2h0OiBkaW1lbnNpb25zLnksXG4gICAgICBhcnJheUJ1ZmZlclZpZXc6IGJhdGNoVGV4dHVyZS5fYmF0Y2hWYWx1ZXMsXG4gICAgfSxcbiAgfSk7XG59XG5cbkJhdGNoVGV4dHVyZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKHRpbGVzZXQsIGZyYW1lU3RhdGUpIHtcbiAgdmFyIGNvbnRleHQgPSBmcmFtZVN0YXRlLmNvbnRleHQ7XG4gIHRoaXMuX2RlZmF1bHRUZXh0dXJlID0gY29udGV4dC5kZWZhdWx0VGV4dHVyZTtcblxuICB2YXIgcGFzc2VzID0gZnJhbWVTdGF0ZS5wYXNzZXM7XG4gIGlmIChwYXNzZXMucGljayB8fCBwYXNzZXMucG9zdFByb2Nlc3MpIHtcbiAgICBjcmVhdGVQaWNrVGV4dHVyZSh0aGlzLCBjb250ZXh0KTtcbiAgfVxuXG4gIGlmICh0aGlzLl9iYXRjaFZhbHVlc0RpcnR5KSB7XG4gICAgdGhpcy5fYmF0Y2hWYWx1ZXNEaXJ0eSA9IGZhbHNlO1xuXG4gICAgLy8gQ3JlYXRlIGJhdGNoIHRleHR1cmUgb24tZGVtYW5kXG4gICAgaWYgKCFkZWZpbmVkKHRoaXMuX2JhdGNoVGV4dHVyZSkpIHtcbiAgICAgIHRoaXMuX2JhdGNoVGV4dHVyZSA9IGNyZWF0ZVRleHR1cmUodGhpcywgY29udGV4dCwgdGhpcy5fYmF0Y2hWYWx1ZXMpO1xuICAgICAgdGlsZXNldC5fc3RhdGlzdGljcy5iYXRjaFRhYmxlQnl0ZUxlbmd0aCArPSB0aGlzLl9iYXRjaFRleHR1cmUuc2l6ZUluQnl0ZXM7XG4gICAgfVxuXG4gICAgdXBkYXRlQmF0Y2hUZXh0dXJlKHRoaXMpOyAvLyBBcHBseSBwZXItZmVhdHVyZSBzaG93L2NvbG9yIHVwZGF0ZXNcbiAgfVxufTtcblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZDsgb3RoZXJ3aXNlLCBmYWxzZS5cbiAqIDxwPlxuICogSWYgdGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZCwgaXQgc2hvdWxkIG5vdCBiZSB1c2VkOyBjYWxsaW5nIGFueSBmdW5jdGlvbiBvdGhlciB0aGFuXG4gKiA8Y29kZT5pc0Rlc3Ryb3llZDwvY29kZT4gd2lsbCByZXN1bHQgaW4gYSB7QGxpbmsgRGV2ZWxvcGVyRXJyb3J9IGV4Y2VwdGlvbi5cbiAqIDwvcD5cbiAqXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gPGNvZGU+dHJ1ZTwvY29kZT4gaWYgdGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZDsgb3RoZXJ3aXNlLCA8Y29kZT5mYWxzZTwvY29kZT4uXG4gKlxuICogQHNlZSBCYXRjaFRleHR1cmUjZGVzdHJveVxuICogQHByaXZhdGVcbiAqL1xuQmF0Y2hUZXh0dXJlLnByb3RvdHlwZS5pc0Rlc3Ryb3llZCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyoqXG4gKiBEZXN0cm95cyB0aGUgV2ViR0wgcmVzb3VyY2VzIGhlbGQgYnkgdGhpcyBvYmplY3QuICBEZXN0cm95aW5nIGFuIG9iamVjdCBhbGxvd3MgZm9yIGRldGVybWluaXN0aWNcbiAqIHJlbGVhc2Ugb2YgV2ViR0wgcmVzb3VyY2VzLCBpbnN0ZWFkIG9mIHJlbHlpbmcgb24gdGhlIGdhcmJhZ2UgY29sbGVjdG9yIHRvIGRlc3Ryb3kgdGhpcyBvYmplY3QuXG4gKiA8cD5cbiAqIE9uY2UgYW4gb2JqZWN0IGlzIGRlc3Ryb3llZCwgaXQgc2hvdWxkIG5vdCBiZSB1c2VkOyBjYWxsaW5nIGFueSBmdW5jdGlvbiBvdGhlciB0aGFuXG4gKiA8Y29kZT5pc0Rlc3Ryb3llZDwvY29kZT4gd2lsbCByZXN1bHQgaW4gYSB7QGxpbmsgRGV2ZWxvcGVyRXJyb3J9IGV4Y2VwdGlvbi4gIFRoZXJlZm9yZSxcbiAqIGFzc2lnbiB0aGUgcmV0dXJuIHZhbHVlICg8Y29kZT51bmRlZmluZWQ8L2NvZGU+KSB0byB0aGUgb2JqZWN0IGFzIGRvbmUgaW4gdGhlIGV4YW1wbGUuXG4gKiA8L3A+XG4gKlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IFRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQsIGkuZS4sIGRlc3Ryb3koKSB3YXMgY2FsbGVkLlxuICpcbiAqIEBleGFtcGxlXG4gKiBlID0gZSAmJiBlLmRlc3Ryb3koKTtcbiAqXG4gKiBAc2VlIEJhdGNoVGV4dHVyZSNpc0Rlc3Ryb3llZFxuICogQHByaXZhdGVcbiAqL1xuQmF0Y2hUZXh0dXJlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLl9iYXRjaFRleHR1cmUgPSB0aGlzLl9iYXRjaFRleHR1cmUgJiYgdGhpcy5fYmF0Y2hUZXh0dXJlLmRlc3Ryb3koKTtcbiAgdGhpcy5fcGlja1RleHR1cmUgPSB0aGlzLl9waWNrVGV4dHVyZSAmJiB0aGlzLl9waWNrVGV4dHVyZS5kZXN0cm95KCk7XG5cbiAgdmFyIHBpY2tJZHMgPSB0aGlzLl9waWNrSWRzO1xuICB2YXIgbGVuZ3RoID0gcGlja0lkcy5sZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICBwaWNrSWRzW2ldLmRlc3Ryb3koKTtcbiAgfVxuXG4gIHJldHVybiBkZXN0cm95T2JqZWN0KHRoaXMpO1xufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///31937\n')},68524:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(60216);\n/* harmony import */ var _Core_Color_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(59947);\n/* harmony import */ var _Core_combine_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(8182);\n/* harmony import */ var _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(84828);\n/* harmony import */ var _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(62200);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(82982);\n/* harmony import */ var _Core_deprecationWarning_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(11954);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(86511);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(12572);\n/* harmony import */ var _Core_ExperimentalFeatures_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(54862);\n/* harmony import */ var _Core_getJsonFromTypedArray_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(12540);\n/* harmony import */ var _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(72248);\n/* harmony import */ var _Core_RequestType_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(82968);\n/* harmony import */ var _Core_RuntimeError_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(9407);\n/* harmony import */ var _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(8379);\n/* harmony import */ var _Axis_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(66577);\n/* harmony import */ var _Cesium3DTileBatchTable_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(84020);\n/* harmony import */ var _Cesium3DTileFeature_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(52381);\n/* harmony import */ var _Cesium3DTileFeatureTable_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(79553);\n/* harmony import */ var _ClassificationModel_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(40370);\n/* harmony import */ var _Model_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(16626);\n/* harmony import */ var _ModelAnimationLoop_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(61841);\n/* harmony import */ var _ModelExperimental_ModelExperimental_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(46521);\n/* harmony import */ var _ModelUtility_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(15322);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Represents the contents of a\n * {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel|Batched 3D Model}\n * tile in a {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification|3D Tiles} tileset.\n * <p>\n * Implements the {@link Cesium3DTileContent} interface.\n * </p>\n *\n * @alias Batched3DModel3DTileContent\n * @constructor\n *\n * @private\n */\nfunction Batched3DModel3DTileContent(\n  tileset,\n  tile,\n  resource,\n  arrayBuffer,\n  byteOffset\n) {\n  this._tileset = tileset;\n  this._tile = tile;\n  this._resource = resource;\n  this._model = undefined;\n  this._batchTable = undefined;\n  this._features = undefined;\n\n  this._classificationType = tileset.vectorClassificationOnly\n    ? undefined\n    : tileset.classificationType;\n\n  // Populate from gltf when available\n  this._batchIdAttributeName = undefined;\n  this._diffuseAttributeOrUniformName = {};\n\n  this._rtcCenterTransform = undefined;\n  this._contentModelMatrix = undefined;\n\n  this.featurePropertiesDirty = false;\n  this._groupMetadata = undefined;\n\n  initialize(this, arrayBuffer, byteOffset);\n}\n\n// This can be overridden for testing purposes\nBatched3DModel3DTileContent._deprecationWarning = _Core_deprecationWarning_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z;\n\nObject.defineProperties(Batched3DModel3DTileContent.prototype, {\n  featuresLength: {\n    get: function () {\n      return this._batchTable.featuresLength;\n    },\n  },\n\n  pointsLength: {\n    get: function () {\n      return this._model.pointsLength;\n    },\n  },\n\n  trianglesLength: {\n    get: function () {\n      return this._model.trianglesLength;\n    },\n  },\n\n  geometryByteLength: {\n    get: function () {\n      return this._model.geometryByteLength;\n    },\n  },\n\n  texturesByteLength: {\n    get: function () {\n      return this._model.texturesByteLength;\n    },\n  },\n\n  batchTableByteLength: {\n    get: function () {\n      return this._batchTable.memorySizeInBytes;\n    },\n  },\n\n  innerContents: {\n    get: function () {\n      return undefined;\n    },\n  },\n\n  readyPromise: {\n    get: function () {\n      return this._model.readyPromise;\n    },\n  },\n\n  tileset: {\n    get: function () {\n      return this._tileset;\n    },\n  },\n\n  tile: {\n    get: function () {\n      return this._tile;\n    },\n  },\n\n  url: {\n    get: function () {\n      return this._resource.getUrlComponent(true);\n    },\n  },\n\n  batchTable: {\n    get: function () {\n      return this._batchTable;\n    },\n  },\n\n  groupMetadata: {\n    get: function () {\n      return this._groupMetadata;\n    },\n    set: function (value) {\n      this._groupMetadata = value;\n    },\n  },\n});\n\nvar sizeOfUint32 = Uint32Array.BYTES_PER_ELEMENT;\n\nfunction getBatchIdAttributeName(gltf) {\n  var batchIdAttributeName = _ModelUtility_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"].getAttributeOrUniformBySemantic */ .Z.getAttributeOrUniformBySemantic(\n    gltf,\n    "_BATCHID"\n  );\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(batchIdAttributeName)) {\n    batchIdAttributeName = _ModelUtility_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"].getAttributeOrUniformBySemantic */ .Z.getAttributeOrUniformBySemantic(\n      gltf,\n      "BATCHID"\n    );\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(batchIdAttributeName)) {\n      Batched3DModel3DTileContent._deprecationWarning(\n        "b3dm-legacy-batchid",\n        "The glTF in this b3dm uses the semantic `BATCHID`. Application-specific semantics should be prefixed with an underscore: `_BATCHID`."\n      );\n    }\n  }\n  return batchIdAttributeName;\n}\n\nfunction getVertexShaderCallback(content) {\n  return function (vs, programId) {\n    var batchTable = content._batchTable;\n    var handleTranslucent = !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(content._classificationType);\n\n    var gltf = content._model.gltf;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(gltf)) {\n      content._batchIdAttributeName = getBatchIdAttributeName(gltf);\n      content._diffuseAttributeOrUniformName[\n        programId\n      ] = _ModelUtility_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"].getDiffuseAttributeOrUniform */ .Z.getDiffuseAttributeOrUniform(gltf, programId);\n    }\n\n    var callback = batchTable.getVertexShaderCallback(\n      handleTranslucent,\n      content._batchIdAttributeName,\n      content._diffuseAttributeOrUniformName[programId]\n    );\n    return (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(callback) ? callback(vs) : vs;\n  };\n}\n\nfunction getFragmentShaderCallback(content) {\n  return function (fs, programId) {\n    var batchTable = content._batchTable;\n    var handleTranslucent = !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(content._classificationType);\n\n    var gltf = content._model.gltf;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(gltf)) {\n      content._diffuseAttributeOrUniformName[\n        programId\n      ] = _ModelUtility_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"].getDiffuseAttributeOrUniform */ .Z.getDiffuseAttributeOrUniform(gltf, programId);\n    }\n    var callback = batchTable.getFragmentShaderCallback(\n      handleTranslucent,\n      content._diffuseAttributeOrUniformName[programId],\n      false\n    );\n    return (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(callback) ? callback(fs) : fs;\n  };\n}\n\nfunction getPickIdCallback(content) {\n  return function () {\n    return content._batchTable.getPickId();\n  };\n}\n\nfunction getClassificationFragmentShaderCallback(content) {\n  return function (fs) {\n    var batchTable = content._batchTable;\n    var callback = batchTable.getClassificationFragmentShaderCallback();\n    return (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(callback) ? callback(fs) : fs;\n  };\n}\n\nfunction createColorChangedCallback(content) {\n  return function (batchId, color) {\n    content._model.updateCommands(batchId, color);\n  };\n}\n\nfunction initialize(content, arrayBuffer, byteOffset) {\n  var tileset = content._tileset;\n  var tile = content._tile;\n  var resource = content._resource;\n\n  var byteStart = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z)(byteOffset, 0);\n  byteOffset = byteStart;\n\n  var uint8Array = new Uint8Array(arrayBuffer);\n  var view = new DataView(arrayBuffer);\n  byteOffset += sizeOfUint32; // Skip magic\n\n  var version = view.getUint32(byteOffset, true);\n  if (version !== 1) {\n    throw new _Core_RuntimeError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z(\n      "Only Batched 3D Model version 1 is supported.  Version " +\n        version +\n        " is not."\n    );\n  }\n  byteOffset += sizeOfUint32;\n\n  var byteLength = view.getUint32(byteOffset, true);\n  byteOffset += sizeOfUint32;\n\n  var featureTableJsonByteLength = view.getUint32(byteOffset, true);\n  byteOffset += sizeOfUint32;\n\n  var featureTableBinaryByteLength = view.getUint32(byteOffset, true);\n  byteOffset += sizeOfUint32;\n\n  var batchTableJsonByteLength = view.getUint32(byteOffset, true);\n  byteOffset += sizeOfUint32;\n\n  var batchTableBinaryByteLength = view.getUint32(byteOffset, true);\n  byteOffset += sizeOfUint32;\n\n  var batchLength;\n\n  // Legacy header #1: [batchLength] [batchTableByteLength]\n  // Legacy header #2: [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]\n  // Current header: [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength]\n  // If the header is in the first legacy format \'batchTableJsonByteLength\' will be the start of the JSON string (a quotation mark) or the glTF magic.\n  // Accordingly its first byte will be either 0x22 or 0x67, and so the minimum uint32 expected is 0x22000000 = 570425344 = 570MB. It is unlikely that the feature table JSON will exceed this length.\n  // The check for the second legacy format is similar, except it checks \'batchTableBinaryByteLength\' instead\n  if (batchTableJsonByteLength >= 570425344) {\n    // First legacy check\n    byteOffset -= sizeOfUint32 * 2;\n    batchLength = featureTableJsonByteLength;\n    batchTableJsonByteLength = featureTableBinaryByteLength;\n    batchTableBinaryByteLength = 0;\n    featureTableJsonByteLength = 0;\n    featureTableBinaryByteLength = 0;\n    Batched3DModel3DTileContent._deprecationWarning(\n      "b3dm-legacy-header",\n      "This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel."\n    );\n  } else if (batchTableBinaryByteLength >= 570425344) {\n    // Second legacy check\n    byteOffset -= sizeOfUint32;\n    batchLength = batchTableJsonByteLength;\n    batchTableJsonByteLength = featureTableJsonByteLength;\n    batchTableBinaryByteLength = featureTableBinaryByteLength;\n    featureTableJsonByteLength = 0;\n    featureTableBinaryByteLength = 0;\n    Batched3DModel3DTileContent._deprecationWarning(\n      "b3dm-legacy-header",\n      "This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel."\n    );\n  }\n\n  var featureTableJson;\n  if (featureTableJsonByteLength === 0) {\n    featureTableJson = {\n      BATCH_LENGTH: (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z)(batchLength, 0),\n    };\n  } else {\n    featureTableJson = (0,_Core_getJsonFromTypedArray_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(\n      uint8Array,\n      byteOffset,\n      featureTableJsonByteLength\n    );\n    byteOffset += featureTableJsonByteLength;\n  }\n\n  var featureTableBinary = new Uint8Array(\n    arrayBuffer,\n    byteOffset,\n    featureTableBinaryByteLength\n  );\n  byteOffset += featureTableBinaryByteLength;\n\n  var featureTable = new _Cesium3DTileFeatureTable_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z(\n    featureTableJson,\n    featureTableBinary\n  );\n\n  batchLength = featureTable.getGlobalProperty("BATCH_LENGTH");\n  featureTable.featuresLength = batchLength;\n\n  var batchTableJson;\n  var batchTableBinary;\n  if (batchTableJsonByteLength > 0) {\n    // PERFORMANCE_IDEA: is it possible to allocate this on-demand?  Perhaps keep the\n    // arraybuffer/string compressed in memory and then decompress it when it is first accessed.\n    //\n    // We could also make another request for it, but that would make the property set/get\n    // API async, and would double the number of numbers in some cases.\n    batchTableJson = (0,_Core_getJsonFromTypedArray_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(\n      uint8Array,\n      byteOffset,\n      batchTableJsonByteLength\n    );\n    byteOffset += batchTableJsonByteLength;\n\n    if (batchTableBinaryByteLength > 0) {\n      // Has a batch table binary\n      batchTableBinary = new Uint8Array(\n        arrayBuffer,\n        byteOffset,\n        batchTableBinaryByteLength\n      );\n      // Copy the batchTableBinary section and let the underlying ArrayBuffer be freed\n      batchTableBinary = new Uint8Array(batchTableBinary);\n      byteOffset += batchTableBinaryByteLength;\n    }\n  }\n\n  var colorChangedCallback;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(content._classificationType)) {\n    colorChangedCallback = createColorChangedCallback(content);\n  }\n\n  var batchTable = new _Cesium3DTileBatchTable_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z(\n    content,\n    batchLength,\n    batchTableJson,\n    batchTableBinary,\n    colorChangedCallback\n  );\n  content._batchTable = batchTable;\n\n  var gltfByteLength = byteStart + byteLength - byteOffset;\n  if (gltfByteLength === 0) {\n    throw new _Core_RuntimeError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z("glTF byte length must be greater than 0.");\n  }\n\n  var gltfView;\n  if (byteOffset % 4 === 0) {\n    gltfView = new Uint8Array(arrayBuffer, byteOffset, gltfByteLength);\n  } else {\n    // Create a copy of the glb so that it is 4-byte aligned\n    Batched3DModel3DTileContent._deprecationWarning(\n      "b3dm-glb-unaligned",\n      "The embedded glb is not aligned to a 4-byte boundary."\n    );\n    gltfView = new Uint8Array(\n      uint8Array.subarray(byteOffset, byteOffset + gltfByteLength)\n    );\n  }\n\n  var pickObject = {\n    content: content,\n    primitive: tileset,\n  };\n\n  content._rtcCenterTransform = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].IDENTITY */ .Z.IDENTITY;\n  var rtcCenter = featureTable.getGlobalProperty(\n    "RTC_CENTER",\n    _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].FLOAT */ .Z.FLOAT,\n    3\n  );\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(rtcCenter)) {\n    content._rtcCenterTransform = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].fromTranslation */ .Z.fromTranslation(\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].fromArray */ .Z.fromArray(rtcCenter)\n    );\n  }\n\n  content._contentModelMatrix = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].multiply */ .Z.multiply(\n    tile.computedTransform,\n    content._rtcCenterTransform,\n    new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z()\n  );\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(content._classificationType)) {\n    var modelOptions = {\n      gltf: gltfView,\n      cull: false, // The model is already culled by 3D Tiles\n      releaseGltfJson: true, // Models are unique and will not benefit from caching so save memory\n      opaquePass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE, // Draw opaque portions of the model during the 3D Tiles pass\n      basePath: resource,\n      modelMatrix: content._contentModelMatrix,\n      upAxis: tileset._gltfUpAxis,\n      forwardAxis: _Axis_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].X */ .Z.X,\n      incrementallyLoadTextures: false,\n    };\n\n    if (_Core_ExperimentalFeatures_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].enableModelExperimental */ .Z.enableModelExperimental) {\n      modelOptions.customShader = tileset.customShader;\n      content._model = _ModelExperimental_ModelExperimental_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].fromGltf */ .Z.fromGltf(modelOptions);\n    } else {\n      modelOptions = (0,_Core_combine_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z)(modelOptions, {\n        requestType: _Core_RequestType_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].TILES3D */ .Z.TILES3D,\n        shadows: tileset.shadows,\n        debugWireframe: tileset.debugWireframe,\n        vertexShaderLoaded: getVertexShaderCallback(content),\n        fragmentShaderLoaded: getFragmentShaderCallback(content),\n        uniformMapLoaded: batchTable.getUniformMapCallback(),\n        pickIdLoaded: getPickIdCallback(content),\n        addBatchIdToGeneratedShaders: batchLength > 0, // If the batch table has values in it, generated shaders will need a batchId attribute\n        pickObject: pickObject,\n        imageBasedLightingFactor: tileset.imageBasedLightingFactor,\n        lightColor: tileset.lightColor,\n        luminanceAtZenith: tileset.luminanceAtZenith,\n        sphericalHarmonicCoefficients: tileset.sphericalHarmonicCoefficients,\n        specularEnvironmentMaps: tileset.specularEnvironmentMaps,\n        backFaceCulling: tileset.backFaceCulling,\n        showOutline: tileset.showOutline,\n      });\n      // PERFORMANCE_IDEA: patch the shader on demand, e.g., the first time show/color changes.\n      // The pick shader still needs to be patched.\n      content._model = new _Model_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z(modelOptions);\n    }\n\n    content._model.readyPromise.then(function (model) {\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(model.activeAnimations)) {\n        model.activeAnimations.addAll({\n          loop: _ModelAnimationLoop_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].REPEAT */ .Z.REPEAT,\n        });\n      }\n    });\n  } else {\n    // This transcodes glTF to an internal representation for geometry so we can take advantage of the re-batching of vector data.\n    // For a list of limitations on the input glTF, see the documentation for classificationType of Cesium3DTileset.\n    content._model = new _ClassificationModel_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z({\n      gltf: gltfView,\n      cull: false, // The model is already culled by 3D Tiles\n      basePath: resource,\n      requestType: _Core_RequestType_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].TILES3D */ .Z.TILES3D,\n      modelMatrix: content._contentModelMatrix,\n      upAxis: tileset._gltfUpAxis,\n      forwardAxis: _Axis_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].X */ .Z.X,\n      debugWireframe: tileset.debugWireframe,\n      vertexShaderLoaded: getVertexShaderCallback(content),\n      classificationShaderLoaded: getClassificationFragmentShaderCallback(\n        content\n      ),\n      uniformMapLoaded: batchTable.getUniformMapCallback(),\n      pickIdLoaded: getPickIdCallback(content),\n      classificationType: content._classificationType,\n      batchTable: batchTable,\n    });\n  }\n}\n\nfunction createFeatures(content) {\n  var featuresLength = content.featuresLength;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(content._features) && featuresLength > 0) {\n    var features = new Array(featuresLength);\n    for (var i = 0; i < featuresLength; ++i) {\n      features[i] = new _Cesium3DTileFeature_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"] */ .Z(content, i);\n    }\n    content._features = features;\n  }\n}\n\nBatched3DModel3DTileContent.prototype.hasProperty = function (batchId, name) {\n  return this._batchTable.hasProperty(batchId, name);\n};\n\nBatched3DModel3DTileContent.prototype.getFeature = function (batchId) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  var featuresLength = this.featuresLength;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(batchId) || batchId < 0 || batchId >= featuresLength) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z(\n      "batchId is required and between zero and featuresLength - 1 (" +\n        (featuresLength - 1) +\n        ")."\n    );\n  }\n  //>>includeEnd(\'debug\');\n\n  createFeatures(this);\n  return this._features[batchId];\n};\n\nBatched3DModel3DTileContent.prototype.applyDebugSettings = function (\n  enabled,\n  color\n) {\n  color = enabled ? color : _Core_Color_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].WHITE */ .Z.WHITE;\n  if (this.featuresLength === 0) {\n    this._model.color = color;\n  } else {\n    this._batchTable.setAllColor(color);\n  }\n};\n\nBatched3DModel3DTileContent.prototype.applyStyle = function (style) {\n  if (this.featuresLength === 0) {\n    var hasColorStyle = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(style) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(style.color);\n    var hasShowStyle = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(style) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(style.show);\n    this._model.color = hasColorStyle\n      ? style.color.evaluateColor(undefined, this._model.color)\n      : _Core_Color_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(_Core_Color_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].WHITE */ .Z.WHITE, this._model.color);\n    this._model.show = hasShowStyle ? style.show.evaluate(undefined) : true;\n  } else {\n    this._batchTable.applyStyle(style);\n  }\n};\n\nBatched3DModel3DTileContent.prototype.update = function (tileset, frameState) {\n  var commandStart = frameState.commandList.length;\n\n  var model = this._model;\n  var tile = this._tile;\n  var batchTable = this._batchTable;\n\n  // In the PROCESSING state we may be calling update() to move forward\n  // the content\'s resource loading.  In the READY state, it will\n  // actually generate commands.\n  batchTable.update(tileset, frameState);\n\n  this._contentModelMatrix = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].multiply */ .Z.multiply(\n    tile.computedTransform,\n    this._rtcCenterTransform,\n    this._contentModelMatrix\n  );\n  model.modelMatrix = this._contentModelMatrix;\n\n  model.shadows = tileset.shadows;\n  model.imageBasedLightingFactor = tileset.imageBasedLightingFactor;\n  model.lightColor = tileset.lightColor;\n  model.luminanceAtZenith = tileset.luminanceAtZenith;\n  model.sphericalHarmonicCoefficients = tileset.sphericalHarmonicCoefficients;\n  model.specularEnvironmentMaps = tileset.specularEnvironmentMaps;\n  model.backFaceCulling = tileset.backFaceCulling;\n  model.debugWireframe = tileset.debugWireframe;\n\n  // Update clipping planes\n  var tilesetClippingPlanes = tileset.clippingPlanes;\n  model.referenceMatrix = tileset.clippingPlanesOriginMatrix;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(tilesetClippingPlanes) && tile.clippingPlanesDirty) {\n    // Dereference the clipping planes from the model if they are irrelevant.\n    // Link/Dereference directly to avoid ownership checks.\n    // This will also trigger synchronous shader regeneration to remove or add the clipping plane and color blending code.\n    model._clippingPlanes =\n      tilesetClippingPlanes.enabled && tile._isClipped\n        ? tilesetClippingPlanes\n        : undefined;\n  }\n\n  // If the model references a different ClippingPlaneCollection due to the tileset\'s collection being replaced with a\n  // ClippingPlaneCollection that gives this tile the same clipping status, update the model to use the new ClippingPlaneCollection.\n  if (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(tilesetClippingPlanes) &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(model._clippingPlanes) &&\n    model._clippingPlanes !== tilesetClippingPlanes\n  ) {\n    model._clippingPlanes = tilesetClippingPlanes;\n  }\n\n  model.update(frameState);\n\n  // If any commands were pushed, add derived commands\n  var commandEnd = frameState.commandList.length;\n  if (\n    commandStart < commandEnd &&\n    (frameState.passes.render || frameState.passes.pick) &&\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z)(this._classificationType)\n  ) {\n    batchTable.addDerivedCommands(frameState, commandStart);\n  }\n};\n\nBatched3DModel3DTileContent.prototype.isDestroyed = function () {\n  return false;\n};\n\nBatched3DModel3DTileContent.prototype.destroy = function () {\n  this._model = this._model && this._model.destroy();\n  this._batchTable = this._batchTable && this._batchTable.destroy();\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z)(this);\n};\n/* harmony default export */ __webpack_exports__["Z"] = (Batched3DModel3DTileContent);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTSxzRUFBTztBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSSxzRUFBTztBQUNYLElBQUksc0VBQU87QUFDWDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSyxzRUFBTztBQUNaO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLDJFQUFhO0FBQ3RCO0FBQ0EseURBQWUsMkJBQTJCLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92dWUzLXdlYnBhY2s1Ly4vbm9kZV9tb2R1bGVzL2Nlc2l1bS9Tb3VyY2UvU2NlbmUvQmF0Y2hlZDNETW9kZWwzRFRpbGVDb250ZW50LmpzPzgwMGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcnRlc2lhbjMgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuMy5qc1wiO1xuaW1wb3J0IENvbG9yIGZyb20gXCIuLi9Db3JlL0NvbG9yLmpzXCI7XG5pbXBvcnQgY29tYmluZSBmcm9tIFwiLi4vQ29yZS9jb21iaW5lLmpzXCI7XG5pbXBvcnQgQ29tcG9uZW50RGF0YXR5cGUgZnJvbSBcIi4uL0NvcmUvQ29tcG9uZW50RGF0YXR5cGUuanNcIjtcbmltcG9ydCBkZWZhdWx0VmFsdWUgZnJvbSBcIi4uL0NvcmUvZGVmYXVsdFZhbHVlLmpzXCI7XG5pbXBvcnQgZGVmaW5lZCBmcm9tIFwiLi4vQ29yZS9kZWZpbmVkLmpzXCI7XG5pbXBvcnQgZGVwcmVjYXRpb25XYXJuaW5nIGZyb20gXCIuLi9Db3JlL2RlcHJlY2F0aW9uV2FybmluZy5qc1wiO1xuaW1wb3J0IGRlc3Ryb3lPYmplY3QgZnJvbSBcIi4uL0NvcmUvZGVzdHJveU9iamVjdC5qc1wiO1xuaW1wb3J0IERldmVsb3BlckVycm9yIGZyb20gXCIuLi9Db3JlL0RldmVsb3BlckVycm9yLmpzXCI7XG5pbXBvcnQgRXhwZXJpbWVudGFsRmVhdHVyZXMgZnJvbSBcIi4uL0NvcmUvRXhwZXJpbWVudGFsRmVhdHVyZXMuanNcIjtcbmltcG9ydCBnZXRKc29uRnJvbVR5cGVkQXJyYXkgZnJvbSBcIi4uL0NvcmUvZ2V0SnNvbkZyb21UeXBlZEFycmF5LmpzXCI7XG5pbXBvcnQgTWF0cml4NCBmcm9tIFwiLi4vQ29yZS9NYXRyaXg0LmpzXCI7XG5pbXBvcnQgUmVxdWVzdFR5cGUgZnJvbSBcIi4uL0NvcmUvUmVxdWVzdFR5cGUuanNcIjtcbmltcG9ydCBSdW50aW1lRXJyb3IgZnJvbSBcIi4uL0NvcmUvUnVudGltZUVycm9yLmpzXCI7XG5pbXBvcnQgUGFzcyBmcm9tIFwiLi4vUmVuZGVyZXIvUGFzcy5qc1wiO1xuaW1wb3J0IEF4aXMgZnJvbSBcIi4vQXhpcy5qc1wiO1xuaW1wb3J0IENlc2l1bTNEVGlsZUJhdGNoVGFibGUgZnJvbSBcIi4vQ2VzaXVtM0RUaWxlQmF0Y2hUYWJsZS5qc1wiO1xuaW1wb3J0IENlc2l1bTNEVGlsZUZlYXR1cmUgZnJvbSBcIi4vQ2VzaXVtM0RUaWxlRmVhdHVyZS5qc1wiO1xuaW1wb3J0IENlc2l1bTNEVGlsZUZlYXR1cmVUYWJsZSBmcm9tIFwiLi9DZXNpdW0zRFRpbGVGZWF0dXJlVGFibGUuanNcIjtcbmltcG9ydCBDbGFzc2lmaWNhdGlvbk1vZGVsIGZyb20gXCIuL0NsYXNzaWZpY2F0aW9uTW9kZWwuanNcIjtcbmltcG9ydCBNb2RlbCBmcm9tIFwiLi9Nb2RlbC5qc1wiO1xuaW1wb3J0IE1vZGVsQW5pbWF0aW9uTG9vcCBmcm9tIFwiLi9Nb2RlbEFuaW1hdGlvbkxvb3AuanNcIjtcbmltcG9ydCBNb2RlbEV4cGVyaW1lbnRhbCBmcm9tIFwiLi9Nb2RlbEV4cGVyaW1lbnRhbC9Nb2RlbEV4cGVyaW1lbnRhbC5qc1wiO1xuaW1wb3J0IE1vZGVsVXRpbGl0eSBmcm9tIFwiLi9Nb2RlbFV0aWxpdHkuanNcIjtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBjb250ZW50cyBvZiBhXG4gKiB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL0Nlc2l1bUdTLzNkLXRpbGVzL3RyZWUvbWFpbi9zcGVjaWZpY2F0aW9uL1RpbGVGb3JtYXRzL0JhdGNoZWQzRE1vZGVsfEJhdGNoZWQgM0QgTW9kZWx9XG4gKiB0aWxlIGluIGEge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9DZXNpdW1HUy8zZC10aWxlcy90cmVlL21haW4vc3BlY2lmaWNhdGlvbnwzRCBUaWxlc30gdGlsZXNldC5cbiAqIDxwPlxuICogSW1wbGVtZW50cyB0aGUge0BsaW5rIENlc2l1bTNEVGlsZUNvbnRlbnR9IGludGVyZmFjZS5cbiAqIDwvcD5cbiAqXG4gKiBAYWxpYXMgQmF0Y2hlZDNETW9kZWwzRFRpbGVDb250ZW50XG4gKiBAY29uc3RydWN0b3JcbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBCYXRjaGVkM0RNb2RlbDNEVGlsZUNvbnRlbnQoXG4gIHRpbGVzZXQsXG4gIHRpbGUsXG4gIHJlc291cmNlLFxuICBhcnJheUJ1ZmZlcixcbiAgYnl0ZU9mZnNldFxuKSB7XG4gIHRoaXMuX3RpbGVzZXQgPSB0aWxlc2V0O1xuICB0aGlzLl90aWxlID0gdGlsZTtcbiAgdGhpcy5fcmVzb3VyY2UgPSByZXNvdXJjZTtcbiAgdGhpcy5fbW9kZWwgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2JhdGNoVGFibGUgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2ZlYXR1cmVzID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMuX2NsYXNzaWZpY2F0aW9uVHlwZSA9IHRpbGVzZXQudmVjdG9yQ2xhc3NpZmljYXRpb25Pbmx5XG4gICAgPyB1bmRlZmluZWRcbiAgICA6IHRpbGVzZXQuY2xhc3NpZmljYXRpb25UeXBlO1xuXG4gIC8vIFBvcHVsYXRlIGZyb20gZ2x0ZiB3aGVuIGF2YWlsYWJsZVxuICB0aGlzLl9iYXRjaElkQXR0cmlidXRlTmFtZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fZGlmZnVzZUF0dHJpYnV0ZU9yVW5pZm9ybU5hbWUgPSB7fTtcblxuICB0aGlzLl9ydGNDZW50ZXJUcmFuc2Zvcm0gPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2NvbnRlbnRNb2RlbE1hdHJpeCA9IHVuZGVmaW5lZDtcblxuICB0aGlzLmZlYXR1cmVQcm9wZXJ0aWVzRGlydHkgPSBmYWxzZTtcbiAgdGhpcy5fZ3JvdXBNZXRhZGF0YSA9IHVuZGVmaW5lZDtcblxuICBpbml0aWFsaXplKHRoaXMsIGFycmF5QnVmZmVyLCBieXRlT2Zmc2V0KTtcbn1cblxuLy8gVGhpcyBjYW4gYmUgb3ZlcnJpZGRlbiBmb3IgdGVzdGluZyBwdXJwb3Nlc1xuQmF0Y2hlZDNETW9kZWwzRFRpbGVDb250ZW50Ll9kZXByZWNhdGlvbldhcm5pbmcgPSBkZXByZWNhdGlvbldhcm5pbmc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEJhdGNoZWQzRE1vZGVsM0RUaWxlQ29udGVudC5wcm90b3R5cGUsIHtcbiAgZmVhdHVyZXNMZW5ndGg6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9iYXRjaFRhYmxlLmZlYXR1cmVzTGVuZ3RoO1xuICAgIH0sXG4gIH0sXG5cbiAgcG9pbnRzTGVuZ3RoOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbW9kZWwucG9pbnRzTGVuZ3RoO1xuICAgIH0sXG4gIH0sXG5cbiAgdHJpYW5nbGVzTGVuZ3RoOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbW9kZWwudHJpYW5nbGVzTGVuZ3RoO1xuICAgIH0sXG4gIH0sXG5cbiAgZ2VvbWV0cnlCeXRlTGVuZ3RoOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbW9kZWwuZ2VvbWV0cnlCeXRlTGVuZ3RoO1xuICAgIH0sXG4gIH0sXG5cbiAgdGV4dHVyZXNCeXRlTGVuZ3RoOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbW9kZWwudGV4dHVyZXNCeXRlTGVuZ3RoO1xuICAgIH0sXG4gIH0sXG5cbiAgYmF0Y2hUYWJsZUJ5dGVMZW5ndGg6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9iYXRjaFRhYmxlLm1lbW9yeVNpemVJbkJ5dGVzO1xuICAgIH0sXG4gIH0sXG5cbiAgaW5uZXJDb250ZW50czoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9LFxuICB9LFxuXG4gIHJlYWR5UHJvbWlzZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX21vZGVsLnJlYWR5UHJvbWlzZTtcbiAgICB9LFxuICB9LFxuXG4gIHRpbGVzZXQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl90aWxlc2V0O1xuICAgIH0sXG4gIH0sXG5cbiAgdGlsZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3RpbGU7XG4gICAgfSxcbiAgfSxcblxuICB1cmw6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9yZXNvdXJjZS5nZXRVcmxDb21wb25lbnQodHJ1ZSk7XG4gICAgfSxcbiAgfSxcblxuICBiYXRjaFRhYmxlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYmF0Y2hUYWJsZTtcbiAgICB9LFxuICB9LFxuXG4gIGdyb3VwTWV0YWRhdGE6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9ncm91cE1ldGFkYXRhO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHRoaXMuX2dyb3VwTWV0YWRhdGEgPSB2YWx1ZTtcbiAgICB9LFxuICB9LFxufSk7XG5cbnZhciBzaXplT2ZVaW50MzIgPSBVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVDtcblxuZnVuY3Rpb24gZ2V0QmF0Y2hJZEF0dHJpYnV0ZU5hbWUoZ2x0Zikge1xuICB2YXIgYmF0Y2hJZEF0dHJpYnV0ZU5hbWUgPSBNb2RlbFV0aWxpdHkuZ2V0QXR0cmlidXRlT3JVbmlmb3JtQnlTZW1hbnRpYyhcbiAgICBnbHRmLFxuICAgIFwiX0JBVENISURcIlxuICApO1xuICBpZiAoIWRlZmluZWQoYmF0Y2hJZEF0dHJpYnV0ZU5hbWUpKSB7XG4gICAgYmF0Y2hJZEF0dHJpYnV0ZU5hbWUgPSBNb2RlbFV0aWxpdHkuZ2V0QXR0cmlidXRlT3JVbmlmb3JtQnlTZW1hbnRpYyhcbiAgICAgIGdsdGYsXG4gICAgICBcIkJBVENISURcIlxuICAgICk7XG4gICAgaWYgKGRlZmluZWQoYmF0Y2hJZEF0dHJpYnV0ZU5hbWUpKSB7XG4gICAgICBCYXRjaGVkM0RNb2RlbDNEVGlsZUNvbnRlbnQuX2RlcHJlY2F0aW9uV2FybmluZyhcbiAgICAgICAgXCJiM2RtLWxlZ2FjeS1iYXRjaGlkXCIsXG4gICAgICAgIFwiVGhlIGdsVEYgaW4gdGhpcyBiM2RtIHVzZXMgdGhlIHNlbWFudGljIGBCQVRDSElEYC4gQXBwbGljYXRpb24tc3BlY2lmaWMgc2VtYW50aWNzIHNob3VsZCBiZSBwcmVmaXhlZCB3aXRoIGFuIHVuZGVyc2NvcmU6IGBfQkFUQ0hJRGAuXCJcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIHJldHVybiBiYXRjaElkQXR0cmlidXRlTmFtZTtcbn1cblxuZnVuY3Rpb24gZ2V0VmVydGV4U2hhZGVyQ2FsbGJhY2soY29udGVudCkge1xuICByZXR1cm4gZnVuY3Rpb24gKHZzLCBwcm9ncmFtSWQpIHtcbiAgICB2YXIgYmF0Y2hUYWJsZSA9IGNvbnRlbnQuX2JhdGNoVGFibGU7XG4gICAgdmFyIGhhbmRsZVRyYW5zbHVjZW50ID0gIWRlZmluZWQoY29udGVudC5fY2xhc3NpZmljYXRpb25UeXBlKTtcblxuICAgIHZhciBnbHRmID0gY29udGVudC5fbW9kZWwuZ2x0ZjtcbiAgICBpZiAoZGVmaW5lZChnbHRmKSkge1xuICAgICAgY29udGVudC5fYmF0Y2hJZEF0dHJpYnV0ZU5hbWUgPSBnZXRCYXRjaElkQXR0cmlidXRlTmFtZShnbHRmKTtcbiAgICAgIGNvbnRlbnQuX2RpZmZ1c2VBdHRyaWJ1dGVPclVuaWZvcm1OYW1lW1xuICAgICAgICBwcm9ncmFtSWRcbiAgICAgIF0gPSBNb2RlbFV0aWxpdHkuZ2V0RGlmZnVzZUF0dHJpYnV0ZU9yVW5pZm9ybShnbHRmLCBwcm9ncmFtSWQpO1xuICAgIH1cblxuICAgIHZhciBjYWxsYmFjayA9IGJhdGNoVGFibGUuZ2V0VmVydGV4U2hhZGVyQ2FsbGJhY2soXG4gICAgICBoYW5kbGVUcmFuc2x1Y2VudCxcbiAgICAgIGNvbnRlbnQuX2JhdGNoSWRBdHRyaWJ1dGVOYW1lLFxuICAgICAgY29udGVudC5fZGlmZnVzZUF0dHJpYnV0ZU9yVW5pZm9ybU5hbWVbcHJvZ3JhbUlkXVxuICAgICk7XG4gICAgcmV0dXJuIGRlZmluZWQoY2FsbGJhY2spID8gY2FsbGJhY2sodnMpIDogdnM7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGdldEZyYWdtZW50U2hhZGVyQ2FsbGJhY2soY29udGVudCkge1xuICByZXR1cm4gZnVuY3Rpb24gKGZzLCBwcm9ncmFtSWQpIHtcbiAgICB2YXIgYmF0Y2hUYWJsZSA9IGNvbnRlbnQuX2JhdGNoVGFibGU7XG4gICAgdmFyIGhhbmRsZVRyYW5zbHVjZW50ID0gIWRlZmluZWQoY29udGVudC5fY2xhc3NpZmljYXRpb25UeXBlKTtcblxuICAgIHZhciBnbHRmID0gY29udGVudC5fbW9kZWwuZ2x0ZjtcbiAgICBpZiAoZGVmaW5lZChnbHRmKSkge1xuICAgICAgY29udGVudC5fZGlmZnVzZUF0dHJpYnV0ZU9yVW5pZm9ybU5hbWVbXG4gICAgICAgIHByb2dyYW1JZFxuICAgICAgXSA9IE1vZGVsVXRpbGl0eS5nZXREaWZmdXNlQXR0cmlidXRlT3JVbmlmb3JtKGdsdGYsIHByb2dyYW1JZCk7XG4gICAgfVxuICAgIHZhciBjYWxsYmFjayA9IGJhdGNoVGFibGUuZ2V0RnJhZ21lbnRTaGFkZXJDYWxsYmFjayhcbiAgICAgIGhhbmRsZVRyYW5zbHVjZW50LFxuICAgICAgY29udGVudC5fZGlmZnVzZUF0dHJpYnV0ZU9yVW5pZm9ybU5hbWVbcHJvZ3JhbUlkXSxcbiAgICAgIGZhbHNlXG4gICAgKTtcbiAgICByZXR1cm4gZGVmaW5lZChjYWxsYmFjaykgPyBjYWxsYmFjayhmcykgOiBmcztcbiAgfTtcbn1cblxuZnVuY3Rpb24gZ2V0UGlja0lkQ2FsbGJhY2soY29udGVudCkge1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBjb250ZW50Ll9iYXRjaFRhYmxlLmdldFBpY2tJZCgpO1xuICB9O1xufVxuXG5mdW5jdGlvbiBnZXRDbGFzc2lmaWNhdGlvbkZyYWdtZW50U2hhZGVyQ2FsbGJhY2soY29udGVudCkge1xuICByZXR1cm4gZnVuY3Rpb24gKGZzKSB7XG4gICAgdmFyIGJhdGNoVGFibGUgPSBjb250ZW50Ll9iYXRjaFRhYmxlO1xuICAgIHZhciBjYWxsYmFjayA9IGJhdGNoVGFibGUuZ2V0Q2xhc3NpZmljYXRpb25GcmFnbWVudFNoYWRlckNhbGxiYWNrKCk7XG4gICAgcmV0dXJuIGRlZmluZWQoY2FsbGJhY2spID8gY2FsbGJhY2soZnMpIDogZnM7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNvbG9yQ2hhbmdlZENhbGxiYWNrKGNvbnRlbnQpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChiYXRjaElkLCBjb2xvcikge1xuICAgIGNvbnRlbnQuX21vZGVsLnVwZGF0ZUNvbW1hbmRzKGJhdGNoSWQsIGNvbG9yKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gaW5pdGlhbGl6ZShjb250ZW50LCBhcnJheUJ1ZmZlciwgYnl0ZU9mZnNldCkge1xuICB2YXIgdGlsZXNldCA9IGNvbnRlbnQuX3RpbGVzZXQ7XG4gIHZhciB0aWxlID0gY29udGVudC5fdGlsZTtcbiAgdmFyIHJlc291cmNlID0gY29udGVudC5fcmVzb3VyY2U7XG5cbiAgdmFyIGJ5dGVTdGFydCA9IGRlZmF1bHRWYWx1ZShieXRlT2Zmc2V0LCAwKTtcbiAgYnl0ZU9mZnNldCA9IGJ5dGVTdGFydDtcblxuICB2YXIgdWludDhBcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyKTtcbiAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoYXJyYXlCdWZmZXIpO1xuICBieXRlT2Zmc2V0ICs9IHNpemVPZlVpbnQzMjsgLy8gU2tpcCBtYWdpY1xuXG4gIHZhciB2ZXJzaW9uID0gdmlldy5nZXRVaW50MzIoYnl0ZU9mZnNldCwgdHJ1ZSk7XG4gIGlmICh2ZXJzaW9uICE9PSAxKSB7XG4gICAgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcihcbiAgICAgIFwiT25seSBCYXRjaGVkIDNEIE1vZGVsIHZlcnNpb24gMSBpcyBzdXBwb3J0ZWQuICBWZXJzaW9uIFwiICtcbiAgICAgICAgdmVyc2lvbiArXG4gICAgICAgIFwiIGlzIG5vdC5cIlxuICAgICk7XG4gIH1cbiAgYnl0ZU9mZnNldCArPSBzaXplT2ZVaW50MzI7XG5cbiAgdmFyIGJ5dGVMZW5ndGggPSB2aWV3LmdldFVpbnQzMihieXRlT2Zmc2V0LCB0cnVlKTtcbiAgYnl0ZU9mZnNldCArPSBzaXplT2ZVaW50MzI7XG5cbiAgdmFyIGZlYXR1cmVUYWJsZUpzb25CeXRlTGVuZ3RoID0gdmlldy5nZXRVaW50MzIoYnl0ZU9mZnNldCwgdHJ1ZSk7XG4gIGJ5dGVPZmZzZXQgKz0gc2l6ZU9mVWludDMyO1xuXG4gIHZhciBmZWF0dXJlVGFibGVCaW5hcnlCeXRlTGVuZ3RoID0gdmlldy5nZXRVaW50MzIoYnl0ZU9mZnNldCwgdHJ1ZSk7XG4gIGJ5dGVPZmZzZXQgKz0gc2l6ZU9mVWludDMyO1xuXG4gIHZhciBiYXRjaFRhYmxlSnNvbkJ5dGVMZW5ndGggPSB2aWV3LmdldFVpbnQzMihieXRlT2Zmc2V0LCB0cnVlKTtcbiAgYnl0ZU9mZnNldCArPSBzaXplT2ZVaW50MzI7XG5cbiAgdmFyIGJhdGNoVGFibGVCaW5hcnlCeXRlTGVuZ3RoID0gdmlldy5nZXRVaW50MzIoYnl0ZU9mZnNldCwgdHJ1ZSk7XG4gIGJ5dGVPZmZzZXQgKz0gc2l6ZU9mVWludDMyO1xuXG4gIHZhciBiYXRjaExlbmd0aDtcblxuICAvLyBMZWdhY3kgaGVhZGVyICMxOiBbYmF0Y2hMZW5ndGhdIFtiYXRjaFRhYmxlQnl0ZUxlbmd0aF1cbiAgLy8gTGVnYWN5IGhlYWRlciAjMjogW2JhdGNoVGFibGVKc29uQnl0ZUxlbmd0aF0gW2JhdGNoVGFibGVCaW5hcnlCeXRlTGVuZ3RoXSBbYmF0Y2hMZW5ndGhdXG4gIC8vIEN1cnJlbnQgaGVhZGVyOiBbZmVhdHVyZVRhYmxlSnNvbkJ5dGVMZW5ndGhdIFtmZWF0dXJlVGFibGVCaW5hcnlCeXRlTGVuZ3RoXSBbYmF0Y2hUYWJsZUpzb25CeXRlTGVuZ3RoXSBbYmF0Y2hUYWJsZUJpbmFyeUJ5dGVMZW5ndGhdXG4gIC8vIElmIHRoZSBoZWFkZXIgaXMgaW4gdGhlIGZpcnN0IGxlZ2FjeSBmb3JtYXQgJ2JhdGNoVGFibGVKc29uQnl0ZUxlbmd0aCcgd2lsbCBiZSB0aGUgc3RhcnQgb2YgdGhlIEpTT04gc3RyaW5nIChhIHF1b3RhdGlvbiBtYXJrKSBvciB0aGUgZ2xURiBtYWdpYy5cbiAgLy8gQWNjb3JkaW5nbHkgaXRzIGZpcnN0IGJ5dGUgd2lsbCBiZSBlaXRoZXIgMHgyMiBvciAweDY3LCBhbmQgc28gdGhlIG1pbmltdW0gdWludDMyIGV4cGVjdGVkIGlzIDB4MjIwMDAwMDAgPSA1NzA0MjUzNDQgPSA1NzBNQi4gSXQgaXMgdW5saWtlbHkgdGhhdCB0aGUgZmVhdHVyZSB0YWJsZSBKU09OIHdpbGwgZXhjZWVkIHRoaXMgbGVuZ3RoLlxuICAvLyBUaGUgY2hlY2sgZm9yIHRoZSBzZWNvbmQgbGVnYWN5IGZvcm1hdCBpcyBzaW1pbGFyLCBleGNlcHQgaXQgY2hlY2tzICdiYXRjaFRhYmxlQmluYXJ5Qnl0ZUxlbmd0aCcgaW5zdGVhZFxuICBpZiAoYmF0Y2hUYWJsZUpzb25CeXRlTGVuZ3RoID49IDU3MDQyNTM0NCkge1xuICAgIC8vIEZpcnN0IGxlZ2FjeSBjaGVja1xuICAgIGJ5dGVPZmZzZXQgLT0gc2l6ZU9mVWludDMyICogMjtcbiAgICBiYXRjaExlbmd0aCA9IGZlYXR1cmVUYWJsZUpzb25CeXRlTGVuZ3RoO1xuICAgIGJhdGNoVGFibGVKc29uQnl0ZUxlbmd0aCA9IGZlYXR1cmVUYWJsZUJpbmFyeUJ5dGVMZW5ndGg7XG4gICAgYmF0Y2hUYWJsZUJpbmFyeUJ5dGVMZW5ndGggPSAwO1xuICAgIGZlYXR1cmVUYWJsZUpzb25CeXRlTGVuZ3RoID0gMDtcbiAgICBmZWF0dXJlVGFibGVCaW5hcnlCeXRlTGVuZ3RoID0gMDtcbiAgICBCYXRjaGVkM0RNb2RlbDNEVGlsZUNvbnRlbnQuX2RlcHJlY2F0aW9uV2FybmluZyhcbiAgICAgIFwiYjNkbS1sZWdhY3ktaGVhZGVyXCIsXG4gICAgICBcIlRoaXMgYjNkbSBoZWFkZXIgaXMgdXNpbmcgdGhlIGxlZ2FjeSBmb3JtYXQgW2JhdGNoTGVuZ3RoXSBbYmF0Y2hUYWJsZUJ5dGVMZW5ndGhdLiBUaGUgbmV3IGZvcm1hdCBpcyBbZmVhdHVyZVRhYmxlSnNvbkJ5dGVMZW5ndGhdIFtmZWF0dXJlVGFibGVCaW5hcnlCeXRlTGVuZ3RoXSBbYmF0Y2hUYWJsZUpzb25CeXRlTGVuZ3RoXSBbYmF0Y2hUYWJsZUJpbmFyeUJ5dGVMZW5ndGhdIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL0Nlc2l1bUdTLzNkLXRpbGVzL3RyZWUvbWFpbi9zcGVjaWZpY2F0aW9uL1RpbGVGb3JtYXRzL0JhdGNoZWQzRE1vZGVsLlwiXG4gICAgKTtcbiAgfSBlbHNlIGlmIChiYXRjaFRhYmxlQmluYXJ5Qnl0ZUxlbmd0aCA+PSA1NzA0MjUzNDQpIHtcbiAgICAvLyBTZWNvbmQgbGVnYWN5IGNoZWNrXG4gICAgYnl0ZU9mZnNldCAtPSBzaXplT2ZVaW50MzI7XG4gICAgYmF0Y2hMZW5ndGggPSBiYXRjaFRhYmxlSnNvbkJ5dGVMZW5ndGg7XG4gICAgYmF0Y2hUYWJsZUpzb25CeXRlTGVuZ3RoID0gZmVhdHVyZVRhYmxlSnNvbkJ5dGVMZW5ndGg7XG4gICAgYmF0Y2hUYWJsZUJpbmFyeUJ5dGVMZW5ndGggPSBmZWF0dXJlVGFibGVCaW5hcnlCeXRlTGVuZ3RoO1xuICAgIGZlYXR1cmVUYWJsZUpzb25CeXRlTGVuZ3RoID0gMDtcbiAgICBmZWF0dXJlVGFibGVCaW5hcnlCeXRlTGVuZ3RoID0gMDtcbiAgICBCYXRjaGVkM0RNb2RlbDNEVGlsZUNvbnRlbnQuX2RlcHJlY2F0aW9uV2FybmluZyhcbiAgICAgIFwiYjNkbS1sZWdhY3ktaGVhZGVyXCIsXG4gICAgICBcIlRoaXMgYjNkbSBoZWFkZXIgaXMgdXNpbmcgdGhlIGxlZ2FjeSBmb3JtYXQgW2JhdGNoVGFibGVKc29uQnl0ZUxlbmd0aF0gW2JhdGNoVGFibGVCaW5hcnlCeXRlTGVuZ3RoXSBbYmF0Y2hMZW5ndGhdLiBUaGUgbmV3IGZvcm1hdCBpcyBbZmVhdHVyZVRhYmxlSnNvbkJ5dGVMZW5ndGhdIFtmZWF0dXJlVGFibGVCaW5hcnlCeXRlTGVuZ3RoXSBbYmF0Y2hUYWJsZUpzb25CeXRlTGVuZ3RoXSBbYmF0Y2hUYWJsZUJpbmFyeUJ5dGVMZW5ndGhdIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL0Nlc2l1bUdTLzNkLXRpbGVzL3RyZWUvbWFpbi9zcGVjaWZpY2F0aW9uL1RpbGVGb3JtYXRzL0JhdGNoZWQzRE1vZGVsLlwiXG4gICAgKTtcbiAgfVxuXG4gIHZhciBmZWF0dXJlVGFibGVKc29uO1xuICBpZiAoZmVhdHVyZVRhYmxlSnNvbkJ5dGVMZW5ndGggPT09IDApIHtcbiAgICBmZWF0dXJlVGFibGVKc29uID0ge1xuICAgICAgQkFUQ0hfTEVOR1RIOiBkZWZhdWx0VmFsdWUoYmF0Y2hMZW5ndGgsIDApLFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgZmVhdHVyZVRhYmxlSnNvbiA9IGdldEpzb25Gcm9tVHlwZWRBcnJheShcbiAgICAgIHVpbnQ4QXJyYXksXG4gICAgICBieXRlT2Zmc2V0LFxuICAgICAgZmVhdHVyZVRhYmxlSnNvbkJ5dGVMZW5ndGhcbiAgICApO1xuICAgIGJ5dGVPZmZzZXQgKz0gZmVhdHVyZVRhYmxlSnNvbkJ5dGVMZW5ndGg7XG4gIH1cblxuICB2YXIgZmVhdHVyZVRhYmxlQmluYXJ5ID0gbmV3IFVpbnQ4QXJyYXkoXG4gICAgYXJyYXlCdWZmZXIsXG4gICAgYnl0ZU9mZnNldCxcbiAgICBmZWF0dXJlVGFibGVCaW5hcnlCeXRlTGVuZ3RoXG4gICk7XG4gIGJ5dGVPZmZzZXQgKz0gZmVhdHVyZVRhYmxlQmluYXJ5Qnl0ZUxlbmd0aDtcblxuICB2YXIgZmVhdHVyZVRhYmxlID0gbmV3IENlc2l1bTNEVGlsZUZlYXR1cmVUYWJsZShcbiAgICBmZWF0dXJlVGFibGVKc29uLFxuICAgIGZlYXR1cmVUYWJsZUJpbmFyeVxuICApO1xuXG4gIGJhdGNoTGVuZ3RoID0gZmVhdHVyZVRhYmxlLmdldEdsb2JhbFByb3BlcnR5KFwiQkFUQ0hfTEVOR1RIXCIpO1xuICBmZWF0dXJlVGFibGUuZmVhdHVyZXNMZW5ndGggPSBiYXRjaExlbmd0aDtcblxuICB2YXIgYmF0Y2hUYWJsZUpzb247XG4gIHZhciBiYXRjaFRhYmxlQmluYXJ5O1xuICBpZiAoYmF0Y2hUYWJsZUpzb25CeXRlTGVuZ3RoID4gMCkge1xuICAgIC8vIFBFUkZPUk1BTkNFX0lERUE6IGlzIGl0IHBvc3NpYmxlIHRvIGFsbG9jYXRlIHRoaXMgb24tZGVtYW5kPyAgUGVyaGFwcyBrZWVwIHRoZVxuICAgIC8vIGFycmF5YnVmZmVyL3N0cmluZyBjb21wcmVzc2VkIGluIG1lbW9yeSBhbmQgdGhlbiBkZWNvbXByZXNzIGl0IHdoZW4gaXQgaXMgZmlyc3QgYWNjZXNzZWQuXG4gICAgLy9cbiAgICAvLyBXZSBjb3VsZCBhbHNvIG1ha2UgYW5vdGhlciByZXF1ZXN0IGZvciBpdCwgYnV0IHRoYXQgd291bGQgbWFrZSB0aGUgcHJvcGVydHkgc2V0L2dldFxuICAgIC8vIEFQSSBhc3luYywgYW5kIHdvdWxkIGRvdWJsZSB0aGUgbnVtYmVyIG9mIG51bWJlcnMgaW4gc29tZSBjYXNlcy5cbiAgICBiYXRjaFRhYmxlSnNvbiA9IGdldEpzb25Gcm9tVHlwZWRBcnJheShcbiAgICAgIHVpbnQ4QXJyYXksXG4gICAgICBieXRlT2Zmc2V0LFxuICAgICAgYmF0Y2hUYWJsZUpzb25CeXRlTGVuZ3RoXG4gICAgKTtcbiAgICBieXRlT2Zmc2V0ICs9IGJhdGNoVGFibGVKc29uQnl0ZUxlbmd0aDtcblxuICAgIGlmIChiYXRjaFRhYmxlQmluYXJ5Qnl0ZUxlbmd0aCA+IDApIHtcbiAgICAgIC8vIEhhcyBhIGJhdGNoIHRhYmxlIGJpbmFyeVxuICAgICAgYmF0Y2hUYWJsZUJpbmFyeSA9IG5ldyBVaW50OEFycmF5KFxuICAgICAgICBhcnJheUJ1ZmZlcixcbiAgICAgICAgYnl0ZU9mZnNldCxcbiAgICAgICAgYmF0Y2hUYWJsZUJpbmFyeUJ5dGVMZW5ndGhcbiAgICAgICk7XG4gICAgICAvLyBDb3B5IHRoZSBiYXRjaFRhYmxlQmluYXJ5IHNlY3Rpb24gYW5kIGxldCB0aGUgdW5kZXJseWluZyBBcnJheUJ1ZmZlciBiZSBmcmVlZFxuICAgICAgYmF0Y2hUYWJsZUJpbmFyeSA9IG5ldyBVaW50OEFycmF5KGJhdGNoVGFibGVCaW5hcnkpO1xuICAgICAgYnl0ZU9mZnNldCArPSBiYXRjaFRhYmxlQmluYXJ5Qnl0ZUxlbmd0aDtcbiAgICB9XG4gIH1cblxuICB2YXIgY29sb3JDaGFuZ2VkQ2FsbGJhY2s7XG4gIGlmIChkZWZpbmVkKGNvbnRlbnQuX2NsYXNzaWZpY2F0aW9uVHlwZSkpIHtcbiAgICBjb2xvckNoYW5nZWRDYWxsYmFjayA9IGNyZWF0ZUNvbG9yQ2hhbmdlZENhbGxiYWNrKGNvbnRlbnQpO1xuICB9XG5cbiAgdmFyIGJhdGNoVGFibGUgPSBuZXcgQ2VzaXVtM0RUaWxlQmF0Y2hUYWJsZShcbiAgICBjb250ZW50LFxuICAgIGJhdGNoTGVuZ3RoLFxuICAgIGJhdGNoVGFibGVKc29uLFxuICAgIGJhdGNoVGFibGVCaW5hcnksXG4gICAgY29sb3JDaGFuZ2VkQ2FsbGJhY2tcbiAgKTtcbiAgY29udGVudC5fYmF0Y2hUYWJsZSA9IGJhdGNoVGFibGU7XG5cbiAgdmFyIGdsdGZCeXRlTGVuZ3RoID0gYnl0ZVN0YXJ0ICsgYnl0ZUxlbmd0aCAtIGJ5dGVPZmZzZXQ7XG4gIGlmIChnbHRmQnl0ZUxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IG5ldyBSdW50aW1lRXJyb3IoXCJnbFRGIGJ5dGUgbGVuZ3RoIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAuXCIpO1xuICB9XG5cbiAgdmFyIGdsdGZWaWV3O1xuICBpZiAoYnl0ZU9mZnNldCAlIDQgPT09IDApIHtcbiAgICBnbHRmVmlldyA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyLCBieXRlT2Zmc2V0LCBnbHRmQnl0ZUxlbmd0aCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gQ3JlYXRlIGEgY29weSBvZiB0aGUgZ2xiIHNvIHRoYXQgaXQgaXMgNC1ieXRlIGFsaWduZWRcbiAgICBCYXRjaGVkM0RNb2RlbDNEVGlsZUNvbnRlbnQuX2RlcHJlY2F0aW9uV2FybmluZyhcbiAgICAgIFwiYjNkbS1nbGItdW5hbGlnbmVkXCIsXG4gICAgICBcIlRoZSBlbWJlZGRlZCBnbGIgaXMgbm90IGFsaWduZWQgdG8gYSA0LWJ5dGUgYm91bmRhcnkuXCJcbiAgICApO1xuICAgIGdsdGZWaWV3ID0gbmV3IFVpbnQ4QXJyYXkoXG4gICAgICB1aW50OEFycmF5LnN1YmFycmF5KGJ5dGVPZmZzZXQsIGJ5dGVPZmZzZXQgKyBnbHRmQnl0ZUxlbmd0aClcbiAgICApO1xuICB9XG5cbiAgdmFyIHBpY2tPYmplY3QgPSB7XG4gICAgY29udGVudDogY29udGVudCxcbiAgICBwcmltaXRpdmU6IHRpbGVzZXQsXG4gIH07XG5cbiAgY29udGVudC5fcnRjQ2VudGVyVHJhbnNmb3JtID0gTWF0cml4NC5JREVOVElUWTtcbiAgdmFyIHJ0Y0NlbnRlciA9IGZlYXR1cmVUYWJsZS5nZXRHbG9iYWxQcm9wZXJ0eShcbiAgICBcIlJUQ19DRU5URVJcIixcbiAgICBDb21wb25lbnREYXRhdHlwZS5GTE9BVCxcbiAgICAzXG4gICk7XG4gIGlmIChkZWZpbmVkKHJ0Y0NlbnRlcikpIHtcbiAgICBjb250ZW50Ll9ydGNDZW50ZXJUcmFuc2Zvcm0gPSBNYXRyaXg0LmZyb21UcmFuc2xhdGlvbihcbiAgICAgIENhcnRlc2lhbjMuZnJvbUFycmF5KHJ0Y0NlbnRlcilcbiAgICApO1xuICB9XG5cbiAgY29udGVudC5fY29udGVudE1vZGVsTWF0cml4ID0gTWF0cml4NC5tdWx0aXBseShcbiAgICB0aWxlLmNvbXB1dGVkVHJhbnNmb3JtLFxuICAgIGNvbnRlbnQuX3J0Y0NlbnRlclRyYW5zZm9ybSxcbiAgICBuZXcgTWF0cml4NCgpXG4gICk7XG5cbiAgaWYgKCFkZWZpbmVkKGNvbnRlbnQuX2NsYXNzaWZpY2F0aW9uVHlwZSkpIHtcbiAgICB2YXIgbW9kZWxPcHRpb25zID0ge1xuICAgICAgZ2x0ZjogZ2x0ZlZpZXcsXG4gICAgICBjdWxsOiBmYWxzZSwgLy8gVGhlIG1vZGVsIGlzIGFscmVhZHkgY3VsbGVkIGJ5IDNEIFRpbGVzXG4gICAgICByZWxlYXNlR2x0Zkpzb246IHRydWUsIC8vIE1vZGVscyBhcmUgdW5pcXVlIGFuZCB3aWxsIG5vdCBiZW5lZml0IGZyb20gY2FjaGluZyBzbyBzYXZlIG1lbW9yeVxuICAgICAgb3BhcXVlUGFzczogUGFzcy5DRVNJVU1fM0RfVElMRSwgLy8gRHJhdyBvcGFxdWUgcG9ydGlvbnMgb2YgdGhlIG1vZGVsIGR1cmluZyB0aGUgM0QgVGlsZXMgcGFzc1xuICAgICAgYmFzZVBhdGg6IHJlc291cmNlLFxuICAgICAgbW9kZWxNYXRyaXg6IGNvbnRlbnQuX2NvbnRlbnRNb2RlbE1hdHJpeCxcbiAgICAgIHVwQXhpczogdGlsZXNldC5fZ2x0ZlVwQXhpcyxcbiAgICAgIGZvcndhcmRBeGlzOiBBeGlzLlgsXG4gICAgICBpbmNyZW1lbnRhbGx5TG9hZFRleHR1cmVzOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgaWYgKEV4cGVyaW1lbnRhbEZlYXR1cmVzLmVuYWJsZU1vZGVsRXhwZXJpbWVudGFsKSB7XG4gICAgICBtb2RlbE9wdGlvbnMuY3VzdG9tU2hhZGVyID0gdGlsZXNldC5jdXN0b21TaGFkZXI7XG4gICAgICBjb250ZW50Ll9tb2RlbCA9IE1vZGVsRXhwZXJpbWVudGFsLmZyb21HbHRmKG1vZGVsT3B0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1vZGVsT3B0aW9ucyA9IGNvbWJpbmUobW9kZWxPcHRpb25zLCB7XG4gICAgICAgIHJlcXVlc3RUeXBlOiBSZXF1ZXN0VHlwZS5USUxFUzNELFxuICAgICAgICBzaGFkb3dzOiB0aWxlc2V0LnNoYWRvd3MsXG4gICAgICAgIGRlYnVnV2lyZWZyYW1lOiB0aWxlc2V0LmRlYnVnV2lyZWZyYW1lLFxuICAgICAgICB2ZXJ0ZXhTaGFkZXJMb2FkZWQ6IGdldFZlcnRleFNoYWRlckNhbGxiYWNrKGNvbnRlbnQpLFxuICAgICAgICBmcmFnbWVudFNoYWRlckxvYWRlZDogZ2V0RnJhZ21lbnRTaGFkZXJDYWxsYmFjayhjb250ZW50KSxcbiAgICAgICAgdW5pZm9ybU1hcExvYWRlZDogYmF0Y2hUYWJsZS5nZXRVbmlmb3JtTWFwQ2FsbGJhY2soKSxcbiAgICAgICAgcGlja0lkTG9hZGVkOiBnZXRQaWNrSWRDYWxsYmFjayhjb250ZW50KSxcbiAgICAgICAgYWRkQmF0Y2hJZFRvR2VuZXJhdGVkU2hhZGVyczogYmF0Y2hMZW5ndGggPiAwLCAvLyBJZiB0aGUgYmF0Y2ggdGFibGUgaGFzIHZhbHVlcyBpbiBpdCwgZ2VuZXJhdGVkIHNoYWRlcnMgd2lsbCBuZWVkIGEgYmF0Y2hJZCBhdHRyaWJ1dGVcbiAgICAgICAgcGlja09iamVjdDogcGlja09iamVjdCxcbiAgICAgICAgaW1hZ2VCYXNlZExpZ2h0aW5nRmFjdG9yOiB0aWxlc2V0LmltYWdlQmFzZWRMaWdodGluZ0ZhY3RvcixcbiAgICAgICAgbGlnaHRDb2xvcjogdGlsZXNldC5saWdodENvbG9yLFxuICAgICAgICBsdW1pbmFuY2VBdFplbml0aDogdGlsZXNldC5sdW1pbmFuY2VBdFplbml0aCxcbiAgICAgICAgc3BoZXJpY2FsSGFybW9uaWNDb2VmZmljaWVudHM6IHRpbGVzZXQuc3BoZXJpY2FsSGFybW9uaWNDb2VmZmljaWVudHMsXG4gICAgICAgIHNwZWN1bGFyRW52aXJvbm1lbnRNYXBzOiB0aWxlc2V0LnNwZWN1bGFyRW52aXJvbm1lbnRNYXBzLFxuICAgICAgICBiYWNrRmFjZUN1bGxpbmc6IHRpbGVzZXQuYmFja0ZhY2VDdWxsaW5nLFxuICAgICAgICBzaG93T3V0bGluZTogdGlsZXNldC5zaG93T3V0bGluZSxcbiAgICAgIH0pO1xuICAgICAgLy8gUEVSRk9STUFOQ0VfSURFQTogcGF0Y2ggdGhlIHNoYWRlciBvbiBkZW1hbmQsIGUuZy4sIHRoZSBmaXJzdCB0aW1lIHNob3cvY29sb3IgY2hhbmdlcy5cbiAgICAgIC8vIFRoZSBwaWNrIHNoYWRlciBzdGlsbCBuZWVkcyB0byBiZSBwYXRjaGVkLlxuICAgICAgY29udGVudC5fbW9kZWwgPSBuZXcgTW9kZWwobW9kZWxPcHRpb25zKTtcbiAgICB9XG5cbiAgICBjb250ZW50Ll9tb2RlbC5yZWFkeVByb21pc2UudGhlbihmdW5jdGlvbiAobW9kZWwpIHtcbiAgICAgIGlmIChkZWZpbmVkKG1vZGVsLmFjdGl2ZUFuaW1hdGlvbnMpKSB7XG4gICAgICAgIG1vZGVsLmFjdGl2ZUFuaW1hdGlvbnMuYWRkQWxsKHtcbiAgICAgICAgICBsb29wOiBNb2RlbEFuaW1hdGlvbkxvb3AuUkVQRUFULFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICAvLyBUaGlzIHRyYW5zY29kZXMgZ2xURiB0byBhbiBpbnRlcm5hbCByZXByZXNlbnRhdGlvbiBmb3IgZ2VvbWV0cnkgc28gd2UgY2FuIHRha2UgYWR2YW50YWdlIG9mIHRoZSByZS1iYXRjaGluZyBvZiB2ZWN0b3IgZGF0YS5cbiAgICAvLyBGb3IgYSBsaXN0IG9mIGxpbWl0YXRpb25zIG9uIHRoZSBpbnB1dCBnbFRGLCBzZWUgdGhlIGRvY3VtZW50YXRpb24gZm9yIGNsYXNzaWZpY2F0aW9uVHlwZSBvZiBDZXNpdW0zRFRpbGVzZXQuXG4gICAgY29udGVudC5fbW9kZWwgPSBuZXcgQ2xhc3NpZmljYXRpb25Nb2RlbCh7XG4gICAgICBnbHRmOiBnbHRmVmlldyxcbiAgICAgIGN1bGw6IGZhbHNlLCAvLyBUaGUgbW9kZWwgaXMgYWxyZWFkeSBjdWxsZWQgYnkgM0QgVGlsZXNcbiAgICAgIGJhc2VQYXRoOiByZXNvdXJjZSxcbiAgICAgIHJlcXVlc3RUeXBlOiBSZXF1ZXN0VHlwZS5USUxFUzNELFxuICAgICAgbW9kZWxNYXRyaXg6IGNvbnRlbnQuX2NvbnRlbnRNb2RlbE1hdHJpeCxcbiAgICAgIHVwQXhpczogdGlsZXNldC5fZ2x0ZlVwQXhpcyxcbiAgICAgIGZvcndhcmRBeGlzOiBBeGlzLlgsXG4gICAgICBkZWJ1Z1dpcmVmcmFtZTogdGlsZXNldC5kZWJ1Z1dpcmVmcmFtZSxcbiAgICAgIHZlcnRleFNoYWRlckxvYWRlZDogZ2V0VmVydGV4U2hhZGVyQ2FsbGJhY2soY29udGVudCksXG4gICAgICBjbGFzc2lmaWNhdGlvblNoYWRlckxvYWRlZDogZ2V0Q2xhc3NpZmljYXRpb25GcmFnbWVudFNoYWRlckNhbGxiYWNrKFxuICAgICAgICBjb250ZW50XG4gICAgICApLFxuICAgICAgdW5pZm9ybU1hcExvYWRlZDogYmF0Y2hUYWJsZS5nZXRVbmlmb3JtTWFwQ2FsbGJhY2soKSxcbiAgICAgIHBpY2tJZExvYWRlZDogZ2V0UGlja0lkQ2FsbGJhY2soY29udGVudCksXG4gICAgICBjbGFzc2lmaWNhdGlvblR5cGU6IGNvbnRlbnQuX2NsYXNzaWZpY2F0aW9uVHlwZSxcbiAgICAgIGJhdGNoVGFibGU6IGJhdGNoVGFibGUsXG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlRmVhdHVyZXMoY29udGVudCkge1xuICB2YXIgZmVhdHVyZXNMZW5ndGggPSBjb250ZW50LmZlYXR1cmVzTGVuZ3RoO1xuICBpZiAoIWRlZmluZWQoY29udGVudC5fZmVhdHVyZXMpICYmIGZlYXR1cmVzTGVuZ3RoID4gMCkge1xuICAgIHZhciBmZWF0dXJlcyA9IG5ldyBBcnJheShmZWF0dXJlc0xlbmd0aCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmZWF0dXJlc0xlbmd0aDsgKytpKSB7XG4gICAgICBmZWF0dXJlc1tpXSA9IG5ldyBDZXNpdW0zRFRpbGVGZWF0dXJlKGNvbnRlbnQsIGkpO1xuICAgIH1cbiAgICBjb250ZW50Ll9mZWF0dXJlcyA9IGZlYXR1cmVzO1xuICB9XG59XG5cbkJhdGNoZWQzRE1vZGVsM0RUaWxlQ29udGVudC5wcm90b3R5cGUuaGFzUHJvcGVydHkgPSBmdW5jdGlvbiAoYmF0Y2hJZCwgbmFtZSkge1xuICByZXR1cm4gdGhpcy5fYmF0Y2hUYWJsZS5oYXNQcm9wZXJ0eShiYXRjaElkLCBuYW1lKTtcbn07XG5cbkJhdGNoZWQzRE1vZGVsM0RUaWxlQ29udGVudC5wcm90b3R5cGUuZ2V0RmVhdHVyZSA9IGZ1bmN0aW9uIChiYXRjaElkKSB7XG4gIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gIHZhciBmZWF0dXJlc0xlbmd0aCA9IHRoaXMuZmVhdHVyZXNMZW5ndGg7XG4gIGlmICghZGVmaW5lZChiYXRjaElkKSB8fCBiYXRjaElkIDwgMCB8fCBiYXRjaElkID49IGZlYXR1cmVzTGVuZ3RoKSB7XG4gICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFxuICAgICAgXCJiYXRjaElkIGlzIHJlcXVpcmVkIGFuZCBiZXR3ZWVuIHplcm8gYW5kIGZlYXR1cmVzTGVuZ3RoIC0gMSAoXCIgK1xuICAgICAgICAoZmVhdHVyZXNMZW5ndGggLSAxKSArXG4gICAgICAgIFwiKS5cIlxuICAgICk7XG4gIH1cbiAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgY3JlYXRlRmVhdHVyZXModGhpcyk7XG4gIHJldHVybiB0aGlzLl9mZWF0dXJlc1tiYXRjaElkXTtcbn07XG5cbkJhdGNoZWQzRE1vZGVsM0RUaWxlQ29udGVudC5wcm90b3R5cGUuYXBwbHlEZWJ1Z1NldHRpbmdzID0gZnVuY3Rpb24gKFxuICBlbmFibGVkLFxuICBjb2xvclxuKSB7XG4gIGNvbG9yID0gZW5hYmxlZCA/IGNvbG9yIDogQ29sb3IuV0hJVEU7XG4gIGlmICh0aGlzLmZlYXR1cmVzTGVuZ3RoID09PSAwKSB7XG4gICAgdGhpcy5fbW9kZWwuY29sb3IgPSBjb2xvcjtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLl9iYXRjaFRhYmxlLnNldEFsbENvbG9yKGNvbG9yKTtcbiAgfVxufTtcblxuQmF0Y2hlZDNETW9kZWwzRFRpbGVDb250ZW50LnByb3RvdHlwZS5hcHBseVN0eWxlID0gZnVuY3Rpb24gKHN0eWxlKSB7XG4gIGlmICh0aGlzLmZlYXR1cmVzTGVuZ3RoID09PSAwKSB7XG4gICAgdmFyIGhhc0NvbG9yU3R5bGUgPSBkZWZpbmVkKHN0eWxlKSAmJiBkZWZpbmVkKHN0eWxlLmNvbG9yKTtcbiAgICB2YXIgaGFzU2hvd1N0eWxlID0gZGVmaW5lZChzdHlsZSkgJiYgZGVmaW5lZChzdHlsZS5zaG93KTtcbiAgICB0aGlzLl9tb2RlbC5jb2xvciA9IGhhc0NvbG9yU3R5bGVcbiAgICAgID8gc3R5bGUuY29sb3IuZXZhbHVhdGVDb2xvcih1bmRlZmluZWQsIHRoaXMuX21vZGVsLmNvbG9yKVxuICAgICAgOiBDb2xvci5jbG9uZShDb2xvci5XSElURSwgdGhpcy5fbW9kZWwuY29sb3IpO1xuICAgIHRoaXMuX21vZGVsLnNob3cgPSBoYXNTaG93U3R5bGUgPyBzdHlsZS5zaG93LmV2YWx1YXRlKHVuZGVmaW5lZCkgOiB0cnVlO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuX2JhdGNoVGFibGUuYXBwbHlTdHlsZShzdHlsZSk7XG4gIH1cbn07XG5cbkJhdGNoZWQzRE1vZGVsM0RUaWxlQ29udGVudC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKHRpbGVzZXQsIGZyYW1lU3RhdGUpIHtcbiAgdmFyIGNvbW1hbmRTdGFydCA9IGZyYW1lU3RhdGUuY29tbWFuZExpc3QubGVuZ3RoO1xuXG4gIHZhciBtb2RlbCA9IHRoaXMuX21vZGVsO1xuICB2YXIgdGlsZSA9IHRoaXMuX3RpbGU7XG4gIHZhciBiYXRjaFRhYmxlID0gdGhpcy5fYmF0Y2hUYWJsZTtcblxuICAvLyBJbiB0aGUgUFJPQ0VTU0lORyBzdGF0ZSB3ZSBtYXkgYmUgY2FsbGluZyB1cGRhdGUoKSB0byBtb3ZlIGZvcndhcmRcbiAgLy8gdGhlIGNvbnRlbnQncyByZXNvdXJjZSBsb2FkaW5nLiAgSW4gdGhlIFJFQURZIHN0YXRlLCBpdCB3aWxsXG4gIC8vIGFjdHVhbGx5IGdlbmVyYXRlIGNvbW1hbmRzLlxuICBiYXRjaFRhYmxlLnVwZGF0ZSh0aWxlc2V0LCBmcmFtZVN0YXRlKTtcblxuICB0aGlzLl9jb250ZW50TW9kZWxNYXRyaXggPSBNYXRyaXg0Lm11bHRpcGx5KFxuICAgIHRpbGUuY29tcHV0ZWRUcmFuc2Zvcm0sXG4gICAgdGhpcy5fcnRjQ2VudGVyVHJhbnNmb3JtLFxuICAgIHRoaXMuX2NvbnRlbnRNb2RlbE1hdHJpeFxuICApO1xuICBtb2RlbC5tb2RlbE1hdHJpeCA9IHRoaXMuX2NvbnRlbnRNb2RlbE1hdHJpeDtcblxuICBtb2RlbC5zaGFkb3dzID0gdGlsZXNldC5zaGFkb3dzO1xuICBtb2RlbC5pbWFnZUJhc2VkTGlnaHRpbmdGYWN0b3IgPSB0aWxlc2V0LmltYWdlQmFzZWRMaWdodGluZ0ZhY3RvcjtcbiAgbW9kZWwubGlnaHRDb2xvciA9IHRpbGVzZXQubGlnaHRDb2xvcjtcbiAgbW9kZWwubHVtaW5hbmNlQXRaZW5pdGggPSB0aWxlc2V0Lmx1bWluYW5jZUF0WmVuaXRoO1xuICBtb2RlbC5zcGhlcmljYWxIYXJtb25pY0NvZWZmaWNpZW50cyA9IHRpbGVzZXQuc3BoZXJpY2FsSGFybW9uaWNDb2VmZmljaWVudHM7XG4gIG1vZGVsLnNwZWN1bGFyRW52aXJvbm1lbnRNYXBzID0gdGlsZXNldC5zcGVjdWxhckVudmlyb25tZW50TWFwcztcbiAgbW9kZWwuYmFja0ZhY2VDdWxsaW5nID0gdGlsZXNldC5iYWNrRmFjZUN1bGxpbmc7XG4gIG1vZGVsLmRlYnVnV2lyZWZyYW1lID0gdGlsZXNldC5kZWJ1Z1dpcmVmcmFtZTtcblxuICAvLyBVcGRhdGUgY2xpcHBpbmcgcGxhbmVzXG4gIHZhciB0aWxlc2V0Q2xpcHBpbmdQbGFuZXMgPSB0aWxlc2V0LmNsaXBwaW5nUGxhbmVzO1xuICBtb2RlbC5yZWZlcmVuY2VNYXRyaXggPSB0aWxlc2V0LmNsaXBwaW5nUGxhbmVzT3JpZ2luTWF0cml4O1xuICBpZiAoZGVmaW5lZCh0aWxlc2V0Q2xpcHBpbmdQbGFuZXMpICYmIHRpbGUuY2xpcHBpbmdQbGFuZXNEaXJ0eSkge1xuICAgIC8vIERlcmVmZXJlbmNlIHRoZSBjbGlwcGluZyBwbGFuZXMgZnJvbSB0aGUgbW9kZWwgaWYgdGhleSBhcmUgaXJyZWxldmFudC5cbiAgICAvLyBMaW5rL0RlcmVmZXJlbmNlIGRpcmVjdGx5IHRvIGF2b2lkIG93bmVyc2hpcCBjaGVja3MuXG4gICAgLy8gVGhpcyB3aWxsIGFsc28gdHJpZ2dlciBzeW5jaHJvbm91cyBzaGFkZXIgcmVnZW5lcmF0aW9uIHRvIHJlbW92ZSBvciBhZGQgdGhlIGNsaXBwaW5nIHBsYW5lIGFuZCBjb2xvciBibGVuZGluZyBjb2RlLlxuICAgIG1vZGVsLl9jbGlwcGluZ1BsYW5lcyA9XG4gICAgICB0aWxlc2V0Q2xpcHBpbmdQbGFuZXMuZW5hYmxlZCAmJiB0aWxlLl9pc0NsaXBwZWRcbiAgICAgICAgPyB0aWxlc2V0Q2xpcHBpbmdQbGFuZXNcbiAgICAgICAgOiB1bmRlZmluZWQ7XG4gIH1cblxuICAvLyBJZiB0aGUgbW9kZWwgcmVmZXJlbmNlcyBhIGRpZmZlcmVudCBDbGlwcGluZ1BsYW5lQ29sbGVjdGlvbiBkdWUgdG8gdGhlIHRpbGVzZXQncyBjb2xsZWN0aW9uIGJlaW5nIHJlcGxhY2VkIHdpdGggYVxuICAvLyBDbGlwcGluZ1BsYW5lQ29sbGVjdGlvbiB0aGF0IGdpdmVzIHRoaXMgdGlsZSB0aGUgc2FtZSBjbGlwcGluZyBzdGF0dXMsIHVwZGF0ZSB0aGUgbW9kZWwgdG8gdXNlIHRoZSBuZXcgQ2xpcHBpbmdQbGFuZUNvbGxlY3Rpb24uXG4gIGlmIChcbiAgICBkZWZpbmVkKHRpbGVzZXRDbGlwcGluZ1BsYW5lcykgJiZcbiAgICBkZWZpbmVkKG1vZGVsLl9jbGlwcGluZ1BsYW5lcykgJiZcbiAgICBtb2RlbC5fY2xpcHBpbmdQbGFuZXMgIT09IHRpbGVzZXRDbGlwcGluZ1BsYW5lc1xuICApIHtcbiAgICBtb2RlbC5fY2xpcHBpbmdQbGFuZXMgPSB0aWxlc2V0Q2xpcHBpbmdQbGFuZXM7XG4gIH1cblxuICBtb2RlbC51cGRhdGUoZnJhbWVTdGF0ZSk7XG5cbiAgLy8gSWYgYW55IGNvbW1hbmRzIHdlcmUgcHVzaGVkLCBhZGQgZGVyaXZlZCBjb21tYW5kc1xuICB2YXIgY29tbWFuZEVuZCA9IGZyYW1lU3RhdGUuY29tbWFuZExpc3QubGVuZ3RoO1xuICBpZiAoXG4gICAgY29tbWFuZFN0YXJ0IDwgY29tbWFuZEVuZCAmJlxuICAgIChmcmFtZVN0YXRlLnBhc3Nlcy5yZW5kZXIgfHwgZnJhbWVTdGF0ZS5wYXNzZXMucGljaykgJiZcbiAgICAhZGVmaW5lZCh0aGlzLl9jbGFzc2lmaWNhdGlvblR5cGUpXG4gICkge1xuICAgIGJhdGNoVGFibGUuYWRkRGVyaXZlZENvbW1hbmRzKGZyYW1lU3RhdGUsIGNvbW1hbmRTdGFydCk7XG4gIH1cbn07XG5cbkJhdGNoZWQzRE1vZGVsM0RUaWxlQ29udGVudC5wcm90b3R5cGUuaXNEZXN0cm95ZWQgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbkJhdGNoZWQzRE1vZGVsM0RUaWxlQ29udGVudC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5fbW9kZWwgPSB0aGlzLl9tb2RlbCAmJiB0aGlzLl9tb2RlbC5kZXN0cm95KCk7XG4gIHRoaXMuX2JhdGNoVGFibGUgPSB0aGlzLl9iYXRjaFRhYmxlICYmIHRoaXMuX2JhdGNoVGFibGUuZGVzdHJveSgpO1xuICByZXR1cm4gZGVzdHJveU9iamVjdCh0aGlzKTtcbn07XG5leHBvcnQgZGVmYXVsdCBCYXRjaGVkM0RNb2RlbDNEVGlsZUNvbnRlbnQ7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///68524\n')},80349:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(88108);\n/* harmony import */ var _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(60838);\n/* harmony import */ var _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(60216);\n/* harmony import */ var _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(63367);\n/* harmony import */ var _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(51688);\n/* harmony import */ var _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(66553);\n/* harmony import */ var _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(59947);\n/* harmony import */ var _Core_createGuid_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(39960);\n/* harmony import */ var _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(62200);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(82982);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(12572);\n/* harmony import */ var _Core_DistanceDisplayCondition_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(47861);\n/* harmony import */ var _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(72248);\n/* harmony import */ var _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(15720);\n/* harmony import */ var _Core_Resource_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(68985);\n/* harmony import */ var _HeightReference_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(4260);\n/* harmony import */ var _HorizontalOrigin_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(62919);\n/* harmony import */ var _SceneMode_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(89917);\n/* harmony import */ var _SceneTransforms_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(48244);\n/* harmony import */ var _VerticalOrigin_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(60473);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * A viewport-aligned image positioned in the 3D scene, that is created\n * and rendered using a {@link BillboardCollection}.  A billboard is created and its initial\n * properties are set by calling {@link BillboardCollection#add}.\n * <br /><br />\n * <div align=\'center\'>\n * <img src=\'Images/Billboard.png\' width=\'400\' height=\'300\' /><br />\n * Example billboards\n * </div>\n *\n * @alias Billboard\n *\n * @performance Reading a property, e.g., {@link Billboard#show}, is constant time.\n * Assigning to a property is constant time but results in\n * CPU to GPU traffic when {@link BillboardCollection#update} is called.  The per-billboard traffic is\n * the same regardless of how many properties were updated.  If most billboards in a collection need to be\n * updated, it may be more efficient to clear the collection with {@link BillboardCollection#removeAll}\n * and add new billboards instead of modifying each one.\n *\n * @exception {DeveloperError} scaleByDistance.far must be greater than scaleByDistance.near\n * @exception {DeveloperError} translucencyByDistance.far must be greater than translucencyByDistance.near\n * @exception {DeveloperError} pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near\n * @exception {DeveloperError} distanceDisplayCondition.far must be greater than distanceDisplayCondition.near\n *\n * @see BillboardCollection\n * @see BillboardCollection#add\n * @see Label\n *\n * @internalConstructor\n * @class\n *\n * @demo {@link https://sandcastle.cesium.com/index.html?src=Billboards.html|Cesium Sandcastle Billboard Demo}\n */\nfunction Billboard(options, billboardCollection) {\n  options = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options, _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].EMPTY_OBJECT */ .Z.EMPTY_OBJECT);\n\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(options.disableDepthTestDistance) &&\n    options.disableDepthTestDistance < 0.0\n  ) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n      "disableDepthTestDistance must be greater than or equal to 0.0."\n    );\n  }\n  //>>includeEnd(\'debug\');\n\n  var translucencyByDistance = options.translucencyByDistance;\n  var pixelOffsetScaleByDistance = options.pixelOffsetScaleByDistance;\n  var scaleByDistance = options.scaleByDistance;\n  var distanceDisplayCondition = options.distanceDisplayCondition;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(translucencyByDistance)) {\n    //>>includeStart(\'debug\', pragmas.debug);\n    if (translucencyByDistance.far <= translucencyByDistance.near) {\n      throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n        "translucencyByDistance.far must be greater than translucencyByDistance.near."\n      );\n    }\n    //>>includeEnd(\'debug\');\n    translucencyByDistance = _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clone */ .Z.clone(translucencyByDistance);\n  }\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(pixelOffsetScaleByDistance)) {\n    //>>includeStart(\'debug\', pragmas.debug);\n    if (pixelOffsetScaleByDistance.far <= pixelOffsetScaleByDistance.near) {\n      throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n        "pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near."\n      );\n    }\n    //>>includeEnd(\'debug\');\n    pixelOffsetScaleByDistance = _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clone */ .Z.clone(\n      pixelOffsetScaleByDistance\n    );\n  }\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(scaleByDistance)) {\n    //>>includeStart(\'debug\', pragmas.debug);\n    if (scaleByDistance.far <= scaleByDistance.near) {\n      throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n        "scaleByDistance.far must be greater than scaleByDistance.near."\n      );\n    }\n    //>>includeEnd(\'debug\');\n    scaleByDistance = _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clone */ .Z.clone(scaleByDistance);\n  }\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(distanceDisplayCondition)) {\n    //>>includeStart(\'debug\', pragmas.debug);\n    if (distanceDisplayCondition.far <= distanceDisplayCondition.near) {\n      throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n        "distanceDisplayCondition.far must be greater than distanceDisplayCondition.near."\n      );\n    }\n    //>>includeEnd(\'debug\');\n    distanceDisplayCondition = _Core_DistanceDisplayCondition_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].clone */ .Z.clone(\n      distanceDisplayCondition\n    );\n  }\n\n  this._show = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.show, true);\n  this._position = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(\n    (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.position, _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].ZERO */ .Z.ZERO)\n  );\n  this._actualPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(this._position); // For columbus view and 2D\n  this._pixelOffset = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(\n    (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.pixelOffset, _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].ZERO */ .Z.ZERO)\n  );\n  this._translate = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z(0.0, 0.0); // used by labels for glyph vertex translation\n  this._eyeOffset = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(\n    (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.eyeOffset, _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].ZERO */ .Z.ZERO)\n  );\n  this._heightReference = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(\n    options.heightReference,\n    _HeightReference_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].NONE */ .Z.NONE\n  );\n  this._verticalOrigin = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(\n    options.verticalOrigin,\n    _VerticalOrigin_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].CENTER */ .Z.CENTER\n  );\n  this._horizontalOrigin = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(\n    options.horizontalOrigin,\n    _HorizontalOrigin_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].CENTER */ .Z.CENTER\n  );\n  this._scale = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.scale, 1.0);\n  this._color = _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].clone */ .Z.clone((0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.color, _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].WHITE */ .Z.WHITE));\n  this._rotation = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.rotation, 0.0);\n  this._alignedAxis = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(\n    (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.alignedAxis, _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].ZERO */ .Z.ZERO)\n  );\n  this._width = options.width;\n  this._height = options.height;\n  this._scaleByDistance = scaleByDistance;\n  this._translucencyByDistance = translucencyByDistance;\n  this._pixelOffsetScaleByDistance = pixelOffsetScaleByDistance;\n  this._sizeInMeters = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.sizeInMeters, false);\n  this._distanceDisplayCondition = distanceDisplayCondition;\n  this._disableDepthTestDistance = options.disableDepthTestDistance;\n  this._id = options.id;\n  this._collection = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.collection, billboardCollection);\n\n  this._pickId = undefined;\n  this._pickPrimitive = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options._pickPrimitive, this);\n  this._billboardCollection = billboardCollection;\n  this._dirty = false;\n  this._index = -1; //Used only by BillboardCollection\n  this._batchIndex = undefined; // Used only by Vector3DTilePoints and BillboardCollection\n\n  this._imageIndex = -1;\n  this._imageIndexPromise = undefined;\n  this._imageId = undefined;\n  this._image = undefined;\n  this._imageSubRegion = undefined;\n  this._imageWidth = undefined;\n  this._imageHeight = undefined;\n\n  this._labelDimensions = undefined;\n  this._labelHorizontalOrigin = undefined;\n  this._labelTranslate = undefined;\n\n  var image = options.image;\n  var imageId = options.imageId;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(image)) {\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(imageId)) {\n      if (typeof image === "string") {\n        imageId = image;\n      } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(image.src)) {\n        imageId = image.src;\n      } else {\n        imageId = (0,_Core_createGuid_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z)();\n      }\n    }\n\n    this._imageId = imageId;\n    this._image = image;\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(options.imageSubRegion)) {\n    this._imageId = imageId;\n    this._imageSubRegion = options.imageSubRegion;\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._billboardCollection._textureAtlas)) {\n    this._loadImage();\n  }\n\n  this._actualClampedPosition = undefined;\n  this._removeCallbackFunc = undefined;\n  this._mode = _SceneMode_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].SCENE3D */ .Z.SCENE3D;\n\n  this._clusterShow = true;\n  this._outlineColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].clone */ .Z.clone(\n    (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.outlineColor, _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].BLACK */ .Z.BLACK)\n  );\n  this._outlineWidth = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.outlineWidth, 0.0);\n\n  this._updateClamping();\n}\n\nvar SHOW_INDEX = (Billboard.SHOW_INDEX = 0);\nvar POSITION_INDEX = (Billboard.POSITION_INDEX = 1);\nvar PIXEL_OFFSET_INDEX = (Billboard.PIXEL_OFFSET_INDEX = 2);\nvar EYE_OFFSET_INDEX = (Billboard.EYE_OFFSET_INDEX = 3);\nvar HORIZONTAL_ORIGIN_INDEX = (Billboard.HORIZONTAL_ORIGIN_INDEX = 4);\nvar VERTICAL_ORIGIN_INDEX = (Billboard.VERTICAL_ORIGIN_INDEX = 5);\nvar SCALE_INDEX = (Billboard.SCALE_INDEX = 6);\nvar IMAGE_INDEX_INDEX = (Billboard.IMAGE_INDEX_INDEX = 7);\nvar COLOR_INDEX = (Billboard.COLOR_INDEX = 8);\nvar ROTATION_INDEX = (Billboard.ROTATION_INDEX = 9);\nvar ALIGNED_AXIS_INDEX = (Billboard.ALIGNED_AXIS_INDEX = 10);\nvar SCALE_BY_DISTANCE_INDEX = (Billboard.SCALE_BY_DISTANCE_INDEX = 11);\nvar TRANSLUCENCY_BY_DISTANCE_INDEX = (Billboard.TRANSLUCENCY_BY_DISTANCE_INDEX = 12);\nvar PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX = (Billboard.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX = 13);\nvar DISTANCE_DISPLAY_CONDITION = (Billboard.DISTANCE_DISPLAY_CONDITION = 14);\nvar DISABLE_DEPTH_DISTANCE = (Billboard.DISABLE_DEPTH_DISTANCE = 15);\nBillboard.TEXTURE_COORDINATE_BOUNDS = 16;\nvar SDF_INDEX = (Billboard.SDF_INDEX = 17);\nBillboard.NUMBER_OF_PROPERTIES = 18;\n\nfunction makeDirty(billboard, propertyChanged) {\n  var billboardCollection = billboard._billboardCollection;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(billboardCollection)) {\n    billboardCollection._updateBillboard(billboard, propertyChanged);\n    billboard._dirty = true;\n  }\n}\n\nObject.defineProperties(Billboard.prototype, {\n  /**\n   * Determines if this billboard will be shown.  Use this to hide or show a billboard, instead\n   * of removing it and re-adding it to the collection.\n   * @memberof Billboard.prototype\n   * @type {Boolean}\n   * @default true\n   */\n  show: {\n    get: function () {\n      return this._show;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.bool */ .Z.typeOf.bool("value", value);\n      //>>includeEnd(\'debug\');\n\n      if (this._show !== value) {\n        this._show = value;\n        makeDirty(this, SHOW_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the Cartesian position of this billboard.\n   * @memberof Billboard.prototype\n   * @type {Cartesian3}\n   */\n  position: {\n    get: function () {\n      return this._position;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug)\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.object */ .Z.typeOf.object("value", value);\n      //>>includeEnd(\'debug\');\n\n      var position = this._position;\n      if (!_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].equals */ .Z.equals(position, value)) {\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(value, position);\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(value, this._actualPosition);\n        this._updateClamping();\n        makeDirty(this, POSITION_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the height reference of this billboard.\n   * @memberof Billboard.prototype\n   * @type {HeightReference}\n   * @default HeightReference.NONE\n   */\n  heightReference: {\n    get: function () {\n      return this._heightReference;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug)\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.number */ .Z.typeOf.number("value", value);\n      //>>includeEnd(\'debug\');\n\n      var heightReference = this._heightReference;\n      if (value !== heightReference) {\n        this._heightReference = value;\n        this._updateClamping();\n        makeDirty(this, POSITION_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the pixel offset in screen space from the origin of this billboard.  This is commonly used\n   * to align multiple billboards and labels at the same position, e.g., an image and text.  The\n   * screen space origin is the top, left corner of the canvas; <code>x</code> increases from\n   * left to right, and <code>y</code> increases from top to bottom.\n   * <br /><br />\n   * <div align=\'center\'>\n   * <table border=\'0\' cellpadding=\'5\'><tr>\n   * <td align=\'center\'><code>default</code><br/><img src=\'Images/Billboard.setPixelOffset.default.png\' width=\'250\' height=\'188\' /></td>\n   * <td align=\'center\'><code>b.pixeloffset = new Cartesian2(50, 25);</code><br/><img src=\'Images/Billboard.setPixelOffset.x50y-25.png\' width=\'250\' height=\'188\' /></td>\n   * </tr></table>\n   * The billboard\'s origin is indicated by the yellow point.\n   * </div>\n   * @memberof Billboard.prototype\n   * @type {Cartesian2}\n   */\n  pixelOffset: {\n    get: function () {\n      return this._pixelOffset;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.object */ .Z.typeOf.object("value", value);\n      //>>includeEnd(\'debug\');\n\n      var pixelOffset = this._pixelOffset;\n      if (!_Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(pixelOffset, value)) {\n        _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(value, pixelOffset);\n        makeDirty(this, PIXEL_OFFSET_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets near and far scaling properties of a Billboard based on the billboard\'s distance from the camera.\n   * A billboard\'s scale will interpolate between the {@link NearFarScalar#nearValue} and\n   * {@link NearFarScalar#farValue} while the camera distance falls within the lower and upper bounds\n   * of the specified {@link NearFarScalar#near} and {@link NearFarScalar#far}.\n   * Outside of these ranges the billboard\'s scale remains clamped to the nearest bound.  If undefined,\n   * scaleByDistance will be disabled.\n   * @memberof Billboard.prototype\n   * @type {NearFarScalar}\n   *\n   * @example\n   * // Example 1.\n   * // Set a billboard\'s scaleByDistance to scale by 1.5 when the\n   * // camera is 1500 meters from the billboard and disappear as\n   * // the camera distance approaches 8.0e6 meters.\n   * b.scaleByDistance = new Cesium.NearFarScalar(1.5e2, 1.5, 8.0e6, 0.0);\n   *\n   * @example\n   * // Example 2.\n   * // disable scaling by distance\n   * b.scaleByDistance = undefined;\n   */\n  scaleByDistance: {\n    get: function () {\n      return this._scaleByDistance;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value)) {\n        _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.object */ .Z.typeOf.object("value", value);\n        if (value.far <= value.near) {\n          throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n            "far distance must be greater than near distance."\n          );\n        }\n      }\n      //>>includeEnd(\'debug\');\n\n      var scaleByDistance = this._scaleByDistance;\n      if (!_Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].equals */ .Z.equals(scaleByDistance, value)) {\n        this._scaleByDistance = _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clone */ .Z.clone(value, scaleByDistance);\n        makeDirty(this, SCALE_BY_DISTANCE_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets near and far translucency properties of a Billboard based on the billboard\'s distance from the camera.\n   * A billboard\'s translucency will interpolate between the {@link NearFarScalar#nearValue} and\n   * {@link NearFarScalar#farValue} while the camera distance falls within the lower and upper bounds\n   * of the specified {@link NearFarScalar#near} and {@link NearFarScalar#far}.\n   * Outside of these ranges the billboard\'s translucency remains clamped to the nearest bound.  If undefined,\n   * translucencyByDistance will be disabled.\n   * @memberof Billboard.prototype\n   * @type {NearFarScalar}\n   *\n   * @example\n   * // Example 1.\n   * // Set a billboard\'s translucency to 1.0 when the\n   * // camera is 1500 meters from the billboard and disappear as\n   * // the camera distance approaches 8.0e6 meters.\n   * b.translucencyByDistance = new Cesium.NearFarScalar(1.5e2, 1.0, 8.0e6, 0.0);\n   *\n   * @example\n   * // Example 2.\n   * // disable translucency by distance\n   * b.translucencyByDistance = undefined;\n   */\n  translucencyByDistance: {\n    get: function () {\n      return this._translucencyByDistance;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value)) {\n        _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.object */ .Z.typeOf.object("value", value);\n        if (value.far <= value.near) {\n          throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n            "far distance must be greater than near distance."\n          );\n        }\n      }\n      //>>includeEnd(\'debug\');\n\n      var translucencyByDistance = this._translucencyByDistance;\n      if (!_Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].equals */ .Z.equals(translucencyByDistance, value)) {\n        this._translucencyByDistance = _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clone */ .Z.clone(\n          value,\n          translucencyByDistance\n        );\n        makeDirty(this, TRANSLUCENCY_BY_DISTANCE_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets near and far pixel offset scaling properties of a Billboard based on the billboard\'s distance from the camera.\n   * A billboard\'s pixel offset will be scaled between the {@link NearFarScalar#nearValue} and\n   * {@link NearFarScalar#farValue} while the camera distance falls within the lower and upper bounds\n   * of the specified {@link NearFarScalar#near} and {@link NearFarScalar#far}.\n   * Outside of these ranges the billboard\'s pixel offset scale remains clamped to the nearest bound.  If undefined,\n   * pixelOffsetScaleByDistance will be disabled.\n   * @memberof Billboard.prototype\n   * @type {NearFarScalar}\n   *\n   * @example\n   * // Example 1.\n   * // Set a billboard\'s pixel offset scale to 0.0 when the\n   * // camera is 1500 meters from the billboard and scale pixel offset to 10.0 pixels\n   * // in the y direction the camera distance approaches 8.0e6 meters.\n   * b.pixelOffset = new Cesium.Cartesian2(0.0, 1.0);\n   * b.pixelOffsetScaleByDistance = new Cesium.NearFarScalar(1.5e2, 0.0, 8.0e6, 10.0);\n   *\n   * @example\n   * // Example 2.\n   * // disable pixel offset by distance\n   * b.pixelOffsetScaleByDistance = undefined;\n   */\n  pixelOffsetScaleByDistance: {\n    get: function () {\n      return this._pixelOffsetScaleByDistance;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value)) {\n        _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.object */ .Z.typeOf.object("value", value);\n        if (value.far <= value.near) {\n          throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n            "far distance must be greater than near distance."\n          );\n        }\n      }\n      //>>includeEnd(\'debug\');\n\n      var pixelOffsetScaleByDistance = this._pixelOffsetScaleByDistance;\n      if (!_Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].equals */ .Z.equals(pixelOffsetScaleByDistance, value)) {\n        this._pixelOffsetScaleByDistance = _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clone */ .Z.clone(\n          value,\n          pixelOffsetScaleByDistance\n        );\n        makeDirty(this, PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the 3D Cartesian offset applied to this billboard in eye coordinates.  Eye coordinates is a left-handed\n   * coordinate system, where <code>x</code> points towards the viewer\'s right, <code>y</code> points up, and\n   * <code>z</code> points into the screen.  Eye coordinates use the same scale as world and model coordinates,\n   * which is typically meters.\n   * <br /><br />\n   * An eye offset is commonly used to arrange multiple billboards or objects at the same position, e.g., to\n   * arrange a billboard above its corresponding 3D model.\n   * <br /><br />\n   * Below, the billboard is positioned at the center of the Earth but an eye offset makes it always\n   * appear on top of the Earth regardless of the viewer\'s or Earth\'s orientation.\n   * <br /><br />\n   * <div align=\'center\'>\n   * <table border=\'0\' cellpadding=\'5\'><tr>\n   * <td align=\'center\'><img src=\'Images/Billboard.setEyeOffset.one.png\' width=\'250\' height=\'188\' /></td>\n   * <td align=\'center\'><img src=\'Images/Billboard.setEyeOffset.two.png\' width=\'250\' height=\'188\' /></td>\n   * </tr></table>\n   * <code>b.eyeOffset = new Cartesian3(0.0, 8000000.0, 0.0);</code><br /><br />\n   * </div>\n   * @memberof Billboard.prototype\n   * @type {Cartesian3}\n   */\n  eyeOffset: {\n    get: function () {\n      return this._eyeOffset;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.object */ .Z.typeOf.object("value", value);\n      //>>includeEnd(\'debug\');\n\n      var eyeOffset = this._eyeOffset;\n      if (!_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].equals */ .Z.equals(eyeOffset, value)) {\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(value, eyeOffset);\n        makeDirty(this, EYE_OFFSET_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the horizontal origin of this billboard, which determines if the billboard is\n   * to the left, center, or right of its anchor position.\n   * <br /><br />\n   * <div align=\'center\'>\n   * <img src=\'Images/Billboard.setHorizontalOrigin.png\' width=\'648\' height=\'196\' /><br />\n   * </div>\n   * @memberof Billboard.prototype\n   * @type {HorizontalOrigin}\n   * @example\n   * // Use a bottom, left origin\n   * b.horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n   * b.verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n   */\n  horizontalOrigin: {\n    get: function () {\n      return this._horizontalOrigin;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.number */ .Z.typeOf.number("value", value);\n      //>>includeEnd(\'debug\');\n\n      if (this._horizontalOrigin !== value) {\n        this._horizontalOrigin = value;\n        makeDirty(this, HORIZONTAL_ORIGIN_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the vertical origin of this billboard, which determines if the billboard is\n   * to the above, below, or at the center of its anchor position.\n   * <br /><br />\n   * <div align=\'center\'>\n   * <img src=\'Images/Billboard.setVerticalOrigin.png\' width=\'695\' height=\'175\' /><br />\n   * </div>\n   * @memberof Billboard.prototype\n   * @type {VerticalOrigin}\n   * @example\n   * // Use a bottom, left origin\n   * b.horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n   * b.verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n   */\n  verticalOrigin: {\n    get: function () {\n      return this._verticalOrigin;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.number */ .Z.typeOf.number("value", value);\n      //>>includeEnd(\'debug\');\n\n      if (this._verticalOrigin !== value) {\n        this._verticalOrigin = value;\n        makeDirty(this, VERTICAL_ORIGIN_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the uniform scale that is multiplied with the billboard\'s image size in pixels.\n   * A scale of <code>1.0</code> does not change the size of the billboard; a scale greater than\n   * <code>1.0</code> enlarges the billboard; a positive scale less than <code>1.0</code> shrinks\n   * the billboard.\n   * <br /><br />\n   * <div align=\'center\'>\n   * <img src=\'Images/Billboard.setScale.png\' width=\'400\' height=\'300\' /><br/>\n   * From left to right in the above image, the scales are <code>0.5</code>, <code>1.0</code>,\n   * and <code>2.0</code>.\n   * </div>\n   * @memberof Billboard.prototype\n   * @type {Number}\n   */\n  scale: {\n    get: function () {\n      return this._scale;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.number */ .Z.typeOf.number("value", value);\n      //>>includeEnd(\'debug\');\n\n      if (this._scale !== value) {\n        this._scale = value;\n        makeDirty(this, SCALE_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the color that is multiplied with the billboard\'s texture.  This has two common use cases.  First,\n   * the same white texture may be used by many different billboards, each with a different color, to create\n   * colored billboards.  Second, the color\'s alpha component can be used to make the billboard translucent as shown below.\n   * An alpha of <code>0.0</code> makes the billboard transparent, and <code>1.0</code> makes the billboard opaque.\n   * <br /><br />\n   * <div align=\'center\'>\n   * <table border=\'0\' cellpadding=\'5\'><tr>\n   * <td align=\'center\'><code>default</code><br/><img src=\'Images/Billboard.setColor.Alpha255.png\' width=\'250\' height=\'188\' /></td>\n   * <td align=\'center\'><code>alpha : 0.5</code><br/><img src=\'Images/Billboard.setColor.Alpha127.png\' width=\'250\' height=\'188\' /></td>\n   * </tr></table>\n   * </div>\n   * <br />\n   * The red, green, blue, and alpha values are indicated by <code>value</code>\'s <code>red</code>, <code>green</code>,\n   * <code>blue</code>, and <code>alpha</code> properties as shown in Example 1.  These components range from <code>0.0</code>\n   * (no intensity) to <code>1.0</code> (full intensity).\n   * @memberof Billboard.prototype\n   * @type {Color}\n   *\n   * @example\n   * // Example 1. Assign yellow.\n   * b.color = Cesium.Color.YELLOW;\n   *\n   * @example\n   * // Example 2. Make a billboard 50% translucent.\n   * b.color = new Cesium.Color(1.0, 1.0, 1.0, 0.5);\n   */\n  color: {\n    get: function () {\n      return this._color;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.object */ .Z.typeOf.object("value", value);\n      //>>includeEnd(\'debug\');\n\n      var color = this._color;\n      if (!_Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].equals */ .Z.equals(color, value)) {\n        _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].clone */ .Z.clone(value, color);\n        makeDirty(this, COLOR_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the rotation angle in radians.\n   * @memberof Billboard.prototype\n   * @type {Number}\n   */\n  rotation: {\n    get: function () {\n      return this._rotation;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.number */ .Z.typeOf.number("value", value);\n      //>>includeEnd(\'debug\');\n\n      if (this._rotation !== value) {\n        this._rotation = value;\n        makeDirty(this, ROTATION_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the aligned axis in world space. The aligned axis is the unit vector that the billboard up vector points towards.\n   * The default is the zero vector, which means the billboard is aligned to the screen up vector.\n   * @memberof Billboard.prototype\n   * @type {Cartesian3}\n   * @example\n   * // Example 1.\n   * // Have the billboard up vector point north\n   * billboard.alignedAxis = Cesium.Cartesian3.UNIT_Z;\n   *\n   * @example\n   * // Example 2.\n   * // Have the billboard point east.\n   * billboard.alignedAxis = Cesium.Cartesian3.UNIT_Z;\n   * billboard.rotation = -Cesium.Math.PI_OVER_TWO;\n   *\n   * @example\n   * // Example 3.\n   * // Reset the aligned axis\n   * billboard.alignedAxis = Cesium.Cartesian3.ZERO;\n   */\n  alignedAxis: {\n    get: function () {\n      return this._alignedAxis;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.object */ .Z.typeOf.object("value", value);\n      //>>includeEnd(\'debug\');\n\n      var alignedAxis = this._alignedAxis;\n      if (!_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].equals */ .Z.equals(alignedAxis, value)) {\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(value, alignedAxis);\n        makeDirty(this, ALIGNED_AXIS_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets a width for the billboard. If undefined, the image width will be used.\n   * @memberof Billboard.prototype\n   * @type {Number}\n   */\n  width: {\n    get: function () {\n      return (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(this._width, this._imageWidth);\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value)) {\n        _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.number */ .Z.typeOf.number("value", value);\n      }\n      //>>includeEnd(\'debug\');\n      if (this._width !== value) {\n        this._width = value;\n        makeDirty(this, IMAGE_INDEX_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets a height for the billboard. If undefined, the image height will be used.\n   * @memberof Billboard.prototype\n   * @type {Number}\n   */\n  height: {\n    get: function () {\n      return (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(this._height, this._imageHeight);\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value)) {\n        _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.number */ .Z.typeOf.number("value", value);\n      }\n      //>>includeEnd(\'debug\');\n      if (this._height !== value) {\n        this._height = value;\n        makeDirty(this, IMAGE_INDEX_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets if the billboard size is in meters or pixels. <code>true</code> to size the billboard in meters;\n   * otherwise, the size is in pixels.\n   * @memberof Billboard.prototype\n   * @type {Boolean}\n   * @default false\n   */\n  sizeInMeters: {\n    get: function () {\n      return this._sizeInMeters;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.bool */ .Z.typeOf.bool("value", value);\n      //>>includeEnd(\'debug\');\n      if (this._sizeInMeters !== value) {\n        this._sizeInMeters = value;\n        makeDirty(this, COLOR_INDEX);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the condition specifying at what distance from the camera that this billboard will be displayed.\n   * @memberof Billboard.prototype\n   * @type {DistanceDisplayCondition}\n   * @default undefined\n   */\n  distanceDisplayCondition: {\n    get: function () {\n      return this._distanceDisplayCondition;\n    },\n    set: function (value) {\n      if (\n        !_Core_DistanceDisplayCondition_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].equals */ .Z.equals(value, this._distanceDisplayCondition)\n      ) {\n        //>>includeStart(\'debug\', pragmas.debug);\n        if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value)) {\n          _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.object */ .Z.typeOf.object("value", value);\n          if (value.far <= value.near) {\n            throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n              "far distance must be greater than near distance."\n            );\n          }\n        }\n        //>>includeEnd(\'debug\');\n        this._distanceDisplayCondition = _Core_DistanceDisplayCondition_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].clone */ .Z.clone(\n          value,\n          this._distanceDisplayCondition\n        );\n        makeDirty(this, DISTANCE_DISPLAY_CONDITION);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the distance from the camera at which to disable the depth test to, for example, prevent clipping against terrain.\n   * When set to zero, the depth test is always applied. When set to Number.POSITIVE_INFINITY, the depth test is never applied.\n   * @memberof Billboard.prototype\n   * @type {Number}\n   */\n  disableDepthTestDistance: {\n    get: function () {\n      return this._disableDepthTestDistance;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value)) {\n        _Core_Check_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].typeOf.number */ .Z.typeOf.number("value", value);\n        if (value < 0.0) {\n          throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n            "disableDepthTestDistance must be greater than or equal to 0.0."\n          );\n        }\n      }\n      //>>includeEnd(\'debug\');\n      if (this._disableDepthTestDistance !== value) {\n        this._disableDepthTestDistance = value;\n        makeDirty(this, DISABLE_DEPTH_DISTANCE);\n      }\n    },\n  },\n\n  /**\n   * Gets or sets the user-defined object returned when the billboard is picked.\n   * @memberof Billboard.prototype\n   * @type {Object}\n   */\n  id: {\n    get: function () {\n      return this._id;\n    },\n    set: function (value) {\n      this._id = value;\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._pickId)) {\n        this._pickId.object.id = value;\n      }\n    },\n  },\n\n  /**\n   * The primitive to return when picking this billboard.\n   * @memberof Billboard.prototype\n   * @private\n   */\n  pickPrimitive: {\n    get: function () {\n      return this._pickPrimitive;\n    },\n    set: function (value) {\n      this._pickPrimitive = value;\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._pickId)) {\n        this._pickId.object.primitive = value;\n      }\n    },\n  },\n\n  /**\n   * @private\n   */\n  pickId: {\n    get: function () {\n      return this._pickId;\n    },\n  },\n\n  /**\n   * <p>\n   * Gets or sets the image to be used for this billboard.  If a texture has already been created for the\n   * given image, the existing texture is used.\n   * </p>\n   * <p>\n   * This property can be set to a loaded Image, a URL which will be loaded as an Image automatically,\n   * a canvas, or another billboard\'s image property (from the same billboard collection).\n   * </p>\n   *\n   * @memberof Billboard.prototype\n   * @type {String}\n   * @example\n   * // load an image from a URL\n   * b.image = \'some/image/url.png\';\n   *\n   * // assuming b1 and b2 are billboards in the same billboard collection,\n   * // use the same image for both billboards.\n   * b2.image = b1.image;\n   */\n  image: {\n    get: function () {\n      return this._imageId;\n    },\n    set: function (value) {\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value)) {\n        this._imageIndex = -1;\n        this._imageSubRegion = undefined;\n        this._imageId = undefined;\n        this._image = undefined;\n        this._imageIndexPromise = undefined;\n        makeDirty(this, IMAGE_INDEX_INDEX);\n      } else if (typeof value === "string") {\n        this.setImage(value, value);\n      } else if (value instanceof _Core_Resource_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z) {\n        this.setImage(value.url, value);\n      } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value.src)) {\n        this.setImage(value.src, value);\n      } else {\n        this.setImage((0,_Core_createGuid_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z)(), value);\n      }\n    },\n  },\n\n  /**\n   * When <code>true</code>, this billboard is ready to render, i.e., the image\n   * has been downloaded and the WebGL resources are created.\n   *\n   * @memberof Billboard.prototype\n   *\n   * @type {Boolean}\n   * @readonly\n   *\n   * @default false\n   */\n  ready: {\n    get: function () {\n      return this._imageIndex !== -1;\n    },\n  },\n\n  /**\n   * Keeps track of the position of the billboard based on the height reference.\n   * @memberof Billboard.prototype\n   * @type {Cartesian3}\n   * @private\n   */\n  _clampedPosition: {\n    get: function () {\n      return this._actualClampedPosition;\n    },\n    set: function (value) {\n      this._actualClampedPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(\n        value,\n        this._actualClampedPosition\n      );\n      makeDirty(this, POSITION_INDEX);\n    },\n  },\n\n  /**\n   * Determines whether or not this billboard will be shown or hidden because it was clustered.\n   * @memberof Billboard.prototype\n   * @type {Boolean}\n   * @private\n   */\n  clusterShow: {\n    get: function () {\n      return this._clusterShow;\n    },\n    set: function (value) {\n      if (this._clusterShow !== value) {\n        this._clusterShow = value;\n        makeDirty(this, SHOW_INDEX);\n      }\n    },\n  },\n\n  /**\n   * The outline color of this Billboard.  Effective only for SDF billboards like Label glyphs.\n   * @memberof Billboard.prototype\n   * @type {Color}\n   * @private\n   */\n  outlineColor: {\n    get: function () {\n      return this._outlineColor;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value)) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z("value is required.");\n      }\n      //>>includeEnd(\'debug\');\n\n      var outlineColor = this._outlineColor;\n      if (!_Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].equals */ .Z.equals(outlineColor, value)) {\n        _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].clone */ .Z.clone(value, outlineColor);\n        makeDirty(this, SDF_INDEX);\n      }\n    },\n  },\n\n  /**\n   * The outline width of this Billboard in pixels.  Effective only for SDF billboards like Label glyphs.\n   * @memberof Billboard.prototype\n   * @type {Number}\n   * @private\n   */\n  outlineWidth: {\n    get: function () {\n      return this._outlineWidth;\n    },\n    set: function (value) {\n      if (this._outlineWidth !== value) {\n        this._outlineWidth = value;\n        makeDirty(this, SDF_INDEX);\n      }\n    },\n  },\n});\n\nBillboard.prototype.getPickId = function (context) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._pickId)) {\n    this._pickId = context.createPickId({\n      primitive: this._pickPrimitive,\n      collection: this._collection,\n      id: this._id,\n    });\n  }\n\n  return this._pickId;\n};\n\nBillboard.prototype._updateClamping = function () {\n  Billboard._updateClamping(this._billboardCollection, this);\n};\n\nvar scratchCartographic = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z();\nvar scratchPosition = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z();\n\nBillboard._updateClamping = function (collection, owner) {\n  var scene = collection._scene;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(scene) || !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(scene.globe)) {\n    //>>includeStart(\'debug\', pragmas.debug);\n    if (owner._heightReference !== _HeightReference_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].NONE */ .Z.NONE) {\n      throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n        "Height reference is not supported without a scene and globe."\n      );\n    }\n    //>>includeEnd(\'debug\');\n    return;\n  }\n\n  var globe = scene.globe;\n  var ellipsoid = globe.ellipsoid;\n  var surface = globe._surface;\n\n  var mode = scene.frameState.mode;\n\n  var modeChanged = mode !== owner._mode;\n  owner._mode = mode;\n\n  if (\n    (owner._heightReference === _HeightReference_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].NONE */ .Z.NONE || modeChanged) &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(owner._removeCallbackFunc)\n  ) {\n    owner._removeCallbackFunc();\n    owner._removeCallbackFunc = undefined;\n    owner._clampedPosition = undefined;\n  }\n\n  if (\n    owner._heightReference === _HeightReference_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].NONE */ .Z.NONE ||\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(owner._position)\n  ) {\n    return;\n  }\n\n  var position = ellipsoid.cartesianToCartographic(owner._position);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(position)) {\n    owner._actualClampedPosition = undefined;\n    return;\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(owner._removeCallbackFunc)) {\n    owner._removeCallbackFunc();\n  }\n\n  function updateFunction(clampedPosition) {\n    if (owner._heightReference === _HeightReference_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].RELATIVE_TO_GROUND */ .Z.RELATIVE_TO_GROUND) {\n      if (owner._mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n        var clampedCart = ellipsoid.cartesianToCartographic(\n          clampedPosition,\n          scratchCartographic\n        );\n        clampedCart.height += position.height;\n        ellipsoid.cartographicToCartesian(clampedCart, clampedPosition);\n      } else {\n        clampedPosition.x += position.height;\n      }\n    }\n    owner._clampedPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(\n      clampedPosition,\n      owner._clampedPosition\n    );\n  }\n  owner._removeCallbackFunc = surface.updateHeight(position, updateFunction);\n\n  _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].clone */ .Z.clone(position, scratchCartographic);\n  var height = globe.getHeight(position);\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(height)) {\n    scratchCartographic.height = height;\n  }\n\n  ellipsoid.cartographicToCartesian(scratchCartographic, scratchPosition);\n\n  updateFunction(scratchPosition);\n};\n\nBillboard.prototype._loadImage = function () {\n  var atlas = this._billboardCollection._textureAtlas;\n\n  var imageId = this._imageId;\n  var image = this._image;\n  var imageSubRegion = this._imageSubRegion;\n  var imageIndexPromise;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(image)) {\n    imageIndexPromise = atlas.addImage(imageId, image);\n  }\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(imageSubRegion)) {\n    imageIndexPromise = atlas.addSubRegion(imageId, imageSubRegion);\n  }\n\n  this._imageIndexPromise = imageIndexPromise;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(imageIndexPromise)) {\n    return;\n  }\n\n  var that = this;\n  imageIndexPromise\n    .then(function (index) {\n      if (\n        that._imageId !== imageId ||\n        that._image !== image ||\n        !_Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(that._imageSubRegion, imageSubRegion)\n      ) {\n        // another load occurred before this one finished, ignore the index\n        return;\n      }\n\n      // fill in imageWidth and imageHeight\n      var textureCoordinates = atlas.textureCoordinates[index];\n      that._imageWidth = atlas.texture.width * textureCoordinates.width;\n      that._imageHeight = atlas.texture.height * textureCoordinates.height;\n\n      that._imageIndex = index;\n      that._ready = true;\n      that._image = undefined;\n      that._imageIndexPromise = undefined;\n      makeDirty(that, IMAGE_INDEX_INDEX);\n    })\n    .otherwise(function (error) {\n      console.error("Error loading image for billboard: " + error);\n      that._imageIndexPromise = undefined;\n    });\n};\n\n/**\n * <p>\n * Sets the image to be used for this billboard.  If a texture has already been created for the\n * given id, the existing texture is used.\n * </p>\n * <p>\n * This function is useful for dynamically creating textures that are shared across many billboards.\n * Only the first billboard will actually call the function and create the texture, while subsequent\n * billboards created with the same id will simply re-use the existing texture.\n * </p>\n * <p>\n * To load an image from a URL, setting the {@link Billboard#image} property is more convenient.\n * </p>\n *\n * @param {String} id The id of the image.  This can be any string that uniquely identifies the image.\n * @param {HTMLImageElement|HTMLCanvasElement|String|Resource|Billboard.CreateImageCallback} image The image to load.  This parameter\n *        can either be a loaded Image or Canvas, a URL which will be loaded as an Image automatically,\n *        or a function which will be called to create the image if it hasn\'t been loaded already.\n * @example\n * // create a billboard image dynamically\n * function drawImage(id) {\n *   // create and draw an image using a canvas\n *   var canvas = document.createElement(\'canvas\');\n *   var context2D = canvas.getContext(\'2d\');\n *   // ... draw image\n *   return canvas;\n * }\n * // drawImage will be called to create the texture\n * b.setImage(\'myImage\', drawImage);\n *\n * // subsequent billboards created in the same collection using the same id will use the existing\n * // texture, without the need to create the canvas or draw the image\n * b2.setImage(\'myImage\', drawImage);\n */\nBillboard.prototype.setImage = function (id, image) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(id)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z("id is required.");\n  }\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(image)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z("image is required.");\n  }\n  //>>includeEnd(\'debug\');\n\n  if (this._imageId === id) {\n    return;\n  }\n\n  this._imageIndex = -1;\n  this._imageSubRegion = undefined;\n  this._imageId = id;\n  this._image = image;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._billboardCollection._textureAtlas)) {\n    this._loadImage();\n  }\n};\n\n/**\n * Uses a sub-region of the image with the given id as the image for this billboard,\n * measured in pixels from the bottom-left.\n *\n * @param {String} id The id of the image to use.\n * @param {BoundingRectangle} subRegion The sub-region of the image.\n *\n * @exception {RuntimeError} image with id must be in the atlas\n */\nBillboard.prototype.setImageSubRegion = function (id, subRegion) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(id)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z("id is required.");\n  }\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(subRegion)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z("subRegion is required.");\n  }\n  //>>includeEnd(\'debug\');\n\n  if (\n    this._imageId === id &&\n    _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(this._imageSubRegion, subRegion)\n  ) {\n    return;\n  }\n\n  this._imageIndex = -1;\n  this._imageId = id;\n  this._imageSubRegion = _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(subRegion);\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._billboardCollection._textureAtlas)) {\n    this._loadImage();\n  }\n};\n\nBillboard.prototype._setTranslate = function (value) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(value)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z("value is required.");\n  }\n  //>>includeEnd(\'debug\');\n\n  var translate = this._translate;\n  if (!_Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(translate, value)) {\n    _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(value, translate);\n    makeDirty(this, PIXEL_OFFSET_INDEX);\n  }\n};\n\nBillboard.prototype._getActualPosition = function () {\n  return (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._clampedPosition)\n    ? this._clampedPosition\n    : this._actualPosition;\n};\n\nBillboard.prototype._setActualPosition = function (value) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._clampedPosition)) {\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(value, this._actualPosition);\n  }\n  makeDirty(this, POSITION_INDEX);\n};\n\nvar tempCartesian3 = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nBillboard._computeActualPosition = function (\n  billboard,\n  position,\n  frameState,\n  modelMatrix\n) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(billboard._clampedPosition)) {\n    if (frameState.mode !== billboard._mode) {\n      billboard._updateClamping();\n    }\n    return billboard._clampedPosition;\n  } else if (frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    return position;\n  }\n\n  _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].multiplyByPoint */ .Z.multiplyByPoint(modelMatrix, position, tempCartesian3);\n  return _SceneTransforms_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].computeActualWgs84Position */ .Z.computeActualWgs84Position(frameState, tempCartesian3);\n};\n\nvar scratchCartesian3 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z();\n\n// This function is basically a stripped-down JavaScript version of BillboardCollectionVS.glsl\nBillboard._computeScreenSpacePosition = function (\n  modelMatrix,\n  position,\n  eyeOffset,\n  pixelOffset,\n  scene,\n  result\n) {\n  // Model to world coordinates\n  var positionWorld = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].multiplyByPoint */ .Z.multiplyByPoint(\n    modelMatrix,\n    position,\n    scratchCartesian3\n  );\n\n  // World to window coordinates\n  var positionWC = _SceneTransforms_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].wgs84WithEyeOffsetToWindowCoordinates */ .Z.wgs84WithEyeOffsetToWindowCoordinates(\n    scene,\n    positionWorld,\n    eyeOffset,\n    result\n  );\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(positionWC)) {\n    return undefined;\n  }\n\n  // Apply pixel offset\n  _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(positionWC, pixelOffset, positionWC);\n\n  return positionWC;\n};\n\nvar scratchPixelOffset = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z(0.0, 0.0);\n\n/**\n * Computes the screen-space position of the billboard\'s origin, taking into account eye and pixel offsets.\n * The screen space origin is the top, left corner of the canvas; <code>x</code> increases from\n * left to right, and <code>y</code> increases from top to bottom.\n *\n * @param {Scene} scene The scene.\n * @param {Cartesian2} [result] The object onto which to store the result.\n * @returns {Cartesian2} The screen-space position of the billboard.\n *\n * @exception {DeveloperError} Billboard must be in a collection.\n *\n * @example\n * console.log(b.computeScreenSpacePosition(scene).toString());\n *\n * @see Billboard#eyeOffset\n * @see Billboard#pixelOffset\n */\nBillboard.prototype.computeScreenSpacePosition = function (scene, result) {\n  var billboardCollection = this._billboardCollection;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(result)) {\n    result = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n  }\n\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(billboardCollection)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(\n      "Billboard must be in a collection.  Was it removed?"\n    );\n  }\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(scene)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z("scene is required.");\n  }\n  //>>includeEnd(\'debug\');\n\n  // pixel offset for screen space computation is the pixelOffset + screen space translate\n  _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(this._pixelOffset, scratchPixelOffset);\n  _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(scratchPixelOffset, this._translate, scratchPixelOffset);\n\n  var modelMatrix = billboardCollection.modelMatrix;\n  var position = this._position;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._clampedPosition)) {\n    position = this._clampedPosition;\n    if (scene.mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n      // position needs to be in world coordinates\n      var projection = scene.mapProjection;\n      var ellipsoid = projection.ellipsoid;\n      var cart = projection.unproject(position, scratchCartographic);\n      position = ellipsoid.cartographicToCartesian(cart, scratchCartesian3);\n      modelMatrix = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].IDENTITY */ .Z.IDENTITY;\n    }\n  }\n\n  var windowCoordinates = Billboard._computeScreenSpacePosition(\n    modelMatrix,\n    position,\n    this._eyeOffset,\n    scratchPixelOffset,\n    scene,\n    result\n  );\n  return windowCoordinates;\n};\n\n/**\n * Gets a billboard\'s screen space bounding box centered around screenSpacePosition.\n * @param {Billboard} billboard The billboard to get the screen space bounding box for.\n * @param {Cartesian2} screenSpacePosition The screen space center of the label.\n * @param {BoundingRectangle} [result] The object onto which to store the result.\n * @returns {BoundingRectangle} The screen space bounding box.\n *\n * @private\n */\nBillboard.getScreenSpaceBoundingBox = function (\n  billboard,\n  screenSpacePosition,\n  result\n) {\n  var width = billboard.width;\n  var height = billboard.height;\n\n  var scale = billboard.scale;\n  width *= scale;\n  height *= scale;\n\n  var x = screenSpacePosition.x;\n  if (billboard.horizontalOrigin === _HorizontalOrigin_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].RIGHT */ .Z.RIGHT) {\n    x -= width;\n  } else if (billboard.horizontalOrigin === _HorizontalOrigin_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].CENTER */ .Z.CENTER) {\n    x -= width * 0.5;\n  }\n\n  var y = screenSpacePosition.y;\n  if (\n    billboard.verticalOrigin === _VerticalOrigin_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].BOTTOM */ .Z.BOTTOM ||\n    billboard.verticalOrigin === _VerticalOrigin_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].BASELINE */ .Z.BASELINE\n  ) {\n    y -= height;\n  } else if (billboard.verticalOrigin === _VerticalOrigin_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].CENTER */ .Z.CENTER) {\n    y -= height * 0.5;\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(result)) {\n    result = new _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n  }\n\n  result.x = x;\n  result.y = y;\n  result.width = width;\n  result.height = height;\n\n  return result;\n};\n\n/**\n * Determines if this billboard equals another billboard.  Billboards are equal if all their properties\n * are equal.  Billboards in different collections can be equal.\n *\n * @param {Billboard} other The billboard to compare for equality.\n * @returns {Boolean} <code>true</code> if the billboards are equal; otherwise, <code>false</code>.\n */\nBillboard.prototype.equals = function (other) {\n  return (\n    this === other ||\n    ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(other) &&\n      this._id === other._id &&\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].equals */ .Z.equals(this._position, other._position) &&\n      this._imageId === other._imageId &&\n      this._show === other._show &&\n      this._scale === other._scale &&\n      this._verticalOrigin === other._verticalOrigin &&\n      this._horizontalOrigin === other._horizontalOrigin &&\n      this._heightReference === other._heightReference &&\n      _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(this._imageSubRegion, other._imageSubRegion) &&\n      _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].equals */ .Z.equals(this._color, other._color) &&\n      _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(this._pixelOffset, other._pixelOffset) &&\n      _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(this._translate, other._translate) &&\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].equals */ .Z.equals(this._eyeOffset, other._eyeOffset) &&\n      _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].equals */ .Z.equals(this._scaleByDistance, other._scaleByDistance) &&\n      _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].equals */ .Z.equals(\n        this._translucencyByDistance,\n        other._translucencyByDistance\n      ) &&\n      _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].equals */ .Z.equals(\n        this._pixelOffsetScaleByDistance,\n        other._pixelOffsetScaleByDistance\n      ) &&\n      _Core_DistanceDisplayCondition_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].equals */ .Z.equals(\n        this._distanceDisplayCondition,\n        other._distanceDisplayCondition\n      ) &&\n      this._disableDepthTestDistance === other._disableDepthTestDistance)\n  );\n};\n\nBillboard.prototype._destroy = function () {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._customData)) {\n    this._billboardCollection._scene.globe._surface.removeTileCustomData(\n      this._customData\n    );\n    this._customData = undefined;\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(this._removeCallbackFunc)) {\n    this._removeCallbackFunc();\n    this._removeCallbackFunc = undefined;\n  }\n\n  this.image = undefined;\n  this._pickId = this._pickId && this._pickId.destroy();\n  this._billboardCollection = undefined;\n};\n\n/**\n * A function that creates an image.\n * @callback Billboard.CreateImageCallback\n * @param {String} id The identifier of the image to load.\n * @returns {HTMLImageElement|HTMLCanvasElement|Promise<HTMLImageElement|HTMLCanvasElement>} The image, or a promise that will resolve to an image.\n */\n/* harmony default export */ __webpack_exports__["Z"] = (Billboard);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O0FBQ3ZCLE1BQU0sa0ZBQWlCO0FBQ3ZCLE1BQU0sc0ZBQW9CO0FBQzFCLE1BQU0sc0ZBQW9CO0FBQzFCO0FBQ0E7QUFDQTtBQUNBLE1BQU0sc0ZBQW9CO0FBQzFCO0FBQ0E7QUFDQTtBQUNBLE1BQU0sZ0dBQStCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE1BQU0sc0VBQU87QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU0sc0VBQU87QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsV0FBVyxRQUFRO0FBQ25CLGFBQWEsZ0ZBQWdGO0FBQzdGO0FBQ0EseURBQWUsU0FBUyxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdnVlMy13ZWJwYWNrNS8uL25vZGVfbW9kdWxlcy9jZXNpdW0vU291cmNlL1NjZW5lL0JpbGxib2FyZC5qcz8xZjM1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3VuZGluZ1JlY3RhbmdsZSBmcm9tIFwiLi4vQ29yZS9Cb3VuZGluZ1JlY3RhbmdsZS5qc1wiO1xuaW1wb3J0IENhcnRlc2lhbjIgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuMi5qc1wiO1xuaW1wb3J0IENhcnRlc2lhbjMgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuMy5qc1wiO1xuaW1wb3J0IENhcnRlc2lhbjQgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuNC5qc1wiO1xuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwiLi4vQ29yZS9DYXJ0b2dyYXBoaWMuanNcIjtcbmltcG9ydCBDaGVjayBmcm9tIFwiLi4vQ29yZS9DaGVjay5qc1wiO1xuaW1wb3J0IENvbG9yIGZyb20gXCIuLi9Db3JlL0NvbG9yLmpzXCI7XG5pbXBvcnQgY3JlYXRlR3VpZCBmcm9tIFwiLi4vQ29yZS9jcmVhdGVHdWlkLmpzXCI7XG5pbXBvcnQgZGVmYXVsdFZhbHVlIGZyb20gXCIuLi9Db3JlL2RlZmF1bHRWYWx1ZS5qc1wiO1xuaW1wb3J0IGRlZmluZWQgZnJvbSBcIi4uL0NvcmUvZGVmaW5lZC5qc1wiO1xuaW1wb3J0IERldmVsb3BlckVycm9yIGZyb20gXCIuLi9Db3JlL0RldmVsb3BlckVycm9yLmpzXCI7XG5pbXBvcnQgRGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uIGZyb20gXCIuLi9Db3JlL0Rpc3RhbmNlRGlzcGxheUNvbmRpdGlvbi5qc1wiO1xuaW1wb3J0IE1hdHJpeDQgZnJvbSBcIi4uL0NvcmUvTWF0cml4NC5qc1wiO1xuaW1wb3J0IE5lYXJGYXJTY2FsYXIgZnJvbSBcIi4uL0NvcmUvTmVhckZhclNjYWxhci5qc1wiO1xuaW1wb3J0IFJlc291cmNlIGZyb20gXCIuLi9Db3JlL1Jlc291cmNlLmpzXCI7XG5pbXBvcnQgSGVpZ2h0UmVmZXJlbmNlIGZyb20gXCIuL0hlaWdodFJlZmVyZW5jZS5qc1wiO1xuaW1wb3J0IEhvcml6b250YWxPcmlnaW4gZnJvbSBcIi4vSG9yaXpvbnRhbE9yaWdpbi5qc1wiO1xuaW1wb3J0IFNjZW5lTW9kZSBmcm9tIFwiLi9TY2VuZU1vZGUuanNcIjtcbmltcG9ydCBTY2VuZVRyYW5zZm9ybXMgZnJvbSBcIi4vU2NlbmVUcmFuc2Zvcm1zLmpzXCI7XG5pbXBvcnQgVmVydGljYWxPcmlnaW4gZnJvbSBcIi4vVmVydGljYWxPcmlnaW4uanNcIjtcblxuLyoqXG4gKiBBIHZpZXdwb3J0LWFsaWduZWQgaW1hZ2UgcG9zaXRpb25lZCBpbiB0aGUgM0Qgc2NlbmUsIHRoYXQgaXMgY3JlYXRlZFxuICogYW5kIHJlbmRlcmVkIHVzaW5nIGEge0BsaW5rIEJpbGxib2FyZENvbGxlY3Rpb259LiAgQSBiaWxsYm9hcmQgaXMgY3JlYXRlZCBhbmQgaXRzIGluaXRpYWxcbiAqIHByb3BlcnRpZXMgYXJlIHNldCBieSBjYWxsaW5nIHtAbGluayBCaWxsYm9hcmRDb2xsZWN0aW9uI2FkZH0uXG4gKiA8YnIgLz48YnIgLz5cbiAqIDxkaXYgYWxpZ249J2NlbnRlcic+XG4gKiA8aW1nIHNyYz0nSW1hZ2VzL0JpbGxib2FyZC5wbmcnIHdpZHRoPSc0MDAnIGhlaWdodD0nMzAwJyAvPjxiciAvPlxuICogRXhhbXBsZSBiaWxsYm9hcmRzXG4gKiA8L2Rpdj5cbiAqXG4gKiBAYWxpYXMgQmlsbGJvYXJkXG4gKlxuICogQHBlcmZvcm1hbmNlIFJlYWRpbmcgYSBwcm9wZXJ0eSwgZS5nLiwge0BsaW5rIEJpbGxib2FyZCNzaG93fSwgaXMgY29uc3RhbnQgdGltZS5cbiAqIEFzc2lnbmluZyB0byBhIHByb3BlcnR5IGlzIGNvbnN0YW50IHRpbWUgYnV0IHJlc3VsdHMgaW5cbiAqIENQVSB0byBHUFUgdHJhZmZpYyB3aGVuIHtAbGluayBCaWxsYm9hcmRDb2xsZWN0aW9uI3VwZGF0ZX0gaXMgY2FsbGVkLiAgVGhlIHBlci1iaWxsYm9hcmQgdHJhZmZpYyBpc1xuICogdGhlIHNhbWUgcmVnYXJkbGVzcyBvZiBob3cgbWFueSBwcm9wZXJ0aWVzIHdlcmUgdXBkYXRlZC4gIElmIG1vc3QgYmlsbGJvYXJkcyBpbiBhIGNvbGxlY3Rpb24gbmVlZCB0byBiZVxuICogdXBkYXRlZCwgaXQgbWF5IGJlIG1vcmUgZWZmaWNpZW50IHRvIGNsZWFyIHRoZSBjb2xsZWN0aW9uIHdpdGgge0BsaW5rIEJpbGxib2FyZENvbGxlY3Rpb24jcmVtb3ZlQWxsfVxuICogYW5kIGFkZCBuZXcgYmlsbGJvYXJkcyBpbnN0ZWFkIG9mIG1vZGlmeWluZyBlYWNoIG9uZS5cbiAqXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gc2NhbGVCeURpc3RhbmNlLmZhciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBzY2FsZUJ5RGlzdGFuY2UubmVhclxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IHRyYW5zbHVjZW5jeUJ5RGlzdGFuY2UuZmFyIG11c3QgYmUgZ3JlYXRlciB0aGFuIHRyYW5zbHVjZW5jeUJ5RGlzdGFuY2UubmVhclxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IHBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlLmZhciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBwaXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZS5uZWFyXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gZGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uLmZhciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBkaXN0YW5jZURpc3BsYXlDb25kaXRpb24ubmVhclxuICpcbiAqIEBzZWUgQmlsbGJvYXJkQ29sbGVjdGlvblxuICogQHNlZSBCaWxsYm9hcmRDb2xsZWN0aW9uI2FkZFxuICogQHNlZSBMYWJlbFxuICpcbiAqIEBpbnRlcm5hbENvbnN0cnVjdG9yXG4gKiBAY2xhc3NcbiAqXG4gKiBAZGVtbyB7QGxpbmsgaHR0cHM6Ly9zYW5kY2FzdGxlLmNlc2l1bS5jb20vaW5kZXguaHRtbD9zcmM9QmlsbGJvYXJkcy5odG1sfENlc2l1bSBTYW5kY2FzdGxlIEJpbGxib2FyZCBEZW1vfVxuICovXG5mdW5jdGlvbiBCaWxsYm9hcmQob3B0aW9ucywgYmlsbGJvYXJkQ29sbGVjdGlvbikge1xuICBvcHRpb25zID0gZGVmYXVsdFZhbHVlKG9wdGlvbnMsIGRlZmF1bHRWYWx1ZS5FTVBUWV9PQkpFQ1QpO1xuXG4gIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gIGlmIChcbiAgICBkZWZpbmVkKG9wdGlvbnMuZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlKSAmJlxuICAgIG9wdGlvbnMuZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlIDwgMC4wXG4gICkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcbiAgICAgIFwiZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlIG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDAuMC5cIlxuICAgICk7XG4gIH1cbiAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgdmFyIHRyYW5zbHVjZW5jeUJ5RGlzdGFuY2UgPSBvcHRpb25zLnRyYW5zbHVjZW5jeUJ5RGlzdGFuY2U7XG4gIHZhciBwaXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZSA9IG9wdGlvbnMucGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2U7XG4gIHZhciBzY2FsZUJ5RGlzdGFuY2UgPSBvcHRpb25zLnNjYWxlQnlEaXN0YW5jZTtcbiAgdmFyIGRpc3RhbmNlRGlzcGxheUNvbmRpdGlvbiA9IG9wdGlvbnMuZGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uO1xuICBpZiAoZGVmaW5lZCh0cmFuc2x1Y2VuY3lCeURpc3RhbmNlKSkge1xuICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgaWYgKHRyYW5zbHVjZW5jeUJ5RGlzdGFuY2UuZmFyIDw9IHRyYW5zbHVjZW5jeUJ5RGlzdGFuY2UubmVhcikge1xuICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFxuICAgICAgICBcInRyYW5zbHVjZW5jeUJ5RGlzdGFuY2UuZmFyIG11c3QgYmUgZ3JlYXRlciB0aGFuIHRyYW5zbHVjZW5jeUJ5RGlzdGFuY2UubmVhci5cIlxuICAgICAgKTtcbiAgICB9XG4gICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG4gICAgdHJhbnNsdWNlbmN5QnlEaXN0YW5jZSA9IE5lYXJGYXJTY2FsYXIuY2xvbmUodHJhbnNsdWNlbmN5QnlEaXN0YW5jZSk7XG4gIH1cbiAgaWYgKGRlZmluZWQocGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2UpKSB7XG4gICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICBpZiAocGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2UuZmFyIDw9IHBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlLm5lYXIpIHtcbiAgICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcbiAgICAgICAgXCJwaXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZS5mYXIgbXVzdCBiZSBncmVhdGVyIHRoYW4gcGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2UubmVhci5cIlxuICAgICAgKTtcbiAgICB9XG4gICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG4gICAgcGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2UgPSBOZWFyRmFyU2NhbGFyLmNsb25lKFxuICAgICAgcGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2VcbiAgICApO1xuICB9XG4gIGlmIChkZWZpbmVkKHNjYWxlQnlEaXN0YW5jZSkpIHtcbiAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgIGlmIChzY2FsZUJ5RGlzdGFuY2UuZmFyIDw9IHNjYWxlQnlEaXN0YW5jZS5uZWFyKSB7XG4gICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXG4gICAgICAgIFwic2NhbGVCeURpc3RhbmNlLmZhciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBzY2FsZUJ5RGlzdGFuY2UubmVhci5cIlxuICAgICAgKTtcbiAgICB9XG4gICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG4gICAgc2NhbGVCeURpc3RhbmNlID0gTmVhckZhclNjYWxhci5jbG9uZShzY2FsZUJ5RGlzdGFuY2UpO1xuICB9XG4gIGlmIChkZWZpbmVkKGRpc3RhbmNlRGlzcGxheUNvbmRpdGlvbikpIHtcbiAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgIGlmIChkaXN0YW5jZURpc3BsYXlDb25kaXRpb24uZmFyIDw9IGRpc3RhbmNlRGlzcGxheUNvbmRpdGlvbi5uZWFyKSB7XG4gICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXG4gICAgICAgIFwiZGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uLmZhciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBkaXN0YW5jZURpc3BsYXlDb25kaXRpb24ubmVhci5cIlxuICAgICAgKTtcbiAgICB9XG4gICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG4gICAgZGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uID0gRGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uLmNsb25lKFxuICAgICAgZGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uXG4gICAgKTtcbiAgfVxuXG4gIHRoaXMuX3Nob3cgPSBkZWZhdWx0VmFsdWUob3B0aW9ucy5zaG93LCB0cnVlKTtcbiAgdGhpcy5fcG9zaXRpb24gPSBDYXJ0ZXNpYW4zLmNsb25lKFxuICAgIGRlZmF1bHRWYWx1ZShvcHRpb25zLnBvc2l0aW9uLCBDYXJ0ZXNpYW4zLlpFUk8pXG4gICk7XG4gIHRoaXMuX2FjdHVhbFBvc2l0aW9uID0gQ2FydGVzaWFuMy5jbG9uZSh0aGlzLl9wb3NpdGlvbik7IC8vIEZvciBjb2x1bWJ1cyB2aWV3IGFuZCAyRFxuICB0aGlzLl9waXhlbE9mZnNldCA9IENhcnRlc2lhbjIuY2xvbmUoXG4gICAgZGVmYXVsdFZhbHVlKG9wdGlvbnMucGl4ZWxPZmZzZXQsIENhcnRlc2lhbjIuWkVSTylcbiAgKTtcbiAgdGhpcy5fdHJhbnNsYXRlID0gbmV3IENhcnRlc2lhbjIoMC4wLCAwLjApOyAvLyB1c2VkIGJ5IGxhYmVscyBmb3IgZ2x5cGggdmVydGV4IHRyYW5zbGF0aW9uXG4gIHRoaXMuX2V5ZU9mZnNldCA9IENhcnRlc2lhbjMuY2xvbmUoXG4gICAgZGVmYXVsdFZhbHVlKG9wdGlvbnMuZXllT2Zmc2V0LCBDYXJ0ZXNpYW4zLlpFUk8pXG4gICk7XG4gIHRoaXMuX2hlaWdodFJlZmVyZW5jZSA9IGRlZmF1bHRWYWx1ZShcbiAgICBvcHRpb25zLmhlaWdodFJlZmVyZW5jZSxcbiAgICBIZWlnaHRSZWZlcmVuY2UuTk9ORVxuICApO1xuICB0aGlzLl92ZXJ0aWNhbE9yaWdpbiA9IGRlZmF1bHRWYWx1ZShcbiAgICBvcHRpb25zLnZlcnRpY2FsT3JpZ2luLFxuICAgIFZlcnRpY2FsT3JpZ2luLkNFTlRFUlxuICApO1xuICB0aGlzLl9ob3Jpem9udGFsT3JpZ2luID0gZGVmYXVsdFZhbHVlKFxuICAgIG9wdGlvbnMuaG9yaXpvbnRhbE9yaWdpbixcbiAgICBIb3Jpem9udGFsT3JpZ2luLkNFTlRFUlxuICApO1xuICB0aGlzLl9zY2FsZSA9IGRlZmF1bHRWYWx1ZShvcHRpb25zLnNjYWxlLCAxLjApO1xuICB0aGlzLl9jb2xvciA9IENvbG9yLmNsb25lKGRlZmF1bHRWYWx1ZShvcHRpb25zLmNvbG9yLCBDb2xvci5XSElURSkpO1xuICB0aGlzLl9yb3RhdGlvbiA9IGRlZmF1bHRWYWx1ZShvcHRpb25zLnJvdGF0aW9uLCAwLjApO1xuICB0aGlzLl9hbGlnbmVkQXhpcyA9IENhcnRlc2lhbjMuY2xvbmUoXG4gICAgZGVmYXVsdFZhbHVlKG9wdGlvbnMuYWxpZ25lZEF4aXMsIENhcnRlc2lhbjMuWkVSTylcbiAgKTtcbiAgdGhpcy5fd2lkdGggPSBvcHRpb25zLndpZHRoO1xuICB0aGlzLl9oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgdGhpcy5fc2NhbGVCeURpc3RhbmNlID0gc2NhbGVCeURpc3RhbmNlO1xuICB0aGlzLl90cmFuc2x1Y2VuY3lCeURpc3RhbmNlID0gdHJhbnNsdWNlbmN5QnlEaXN0YW5jZTtcbiAgdGhpcy5fcGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2UgPSBwaXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZTtcbiAgdGhpcy5fc2l6ZUluTWV0ZXJzID0gZGVmYXVsdFZhbHVlKG9wdGlvbnMuc2l6ZUluTWV0ZXJzLCBmYWxzZSk7XG4gIHRoaXMuX2Rpc3RhbmNlRGlzcGxheUNvbmRpdGlvbiA9IGRpc3RhbmNlRGlzcGxheUNvbmRpdGlvbjtcbiAgdGhpcy5fZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlID0gb3B0aW9ucy5kaXNhYmxlRGVwdGhUZXN0RGlzdGFuY2U7XG4gIHRoaXMuX2lkID0gb3B0aW9ucy5pZDtcbiAgdGhpcy5fY29sbGVjdGlvbiA9IGRlZmF1bHRWYWx1ZShvcHRpb25zLmNvbGxlY3Rpb24sIGJpbGxib2FyZENvbGxlY3Rpb24pO1xuXG4gIHRoaXMuX3BpY2tJZCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fcGlja1ByaW1pdGl2ZSA9IGRlZmF1bHRWYWx1ZShvcHRpb25zLl9waWNrUHJpbWl0aXZlLCB0aGlzKTtcbiAgdGhpcy5fYmlsbGJvYXJkQ29sbGVjdGlvbiA9IGJpbGxib2FyZENvbGxlY3Rpb247XG4gIHRoaXMuX2RpcnR5ID0gZmFsc2U7XG4gIHRoaXMuX2luZGV4ID0gLTE7IC8vVXNlZCBvbmx5IGJ5IEJpbGxib2FyZENvbGxlY3Rpb25cbiAgdGhpcy5fYmF0Y2hJbmRleCA9IHVuZGVmaW5lZDsgLy8gVXNlZCBvbmx5IGJ5IFZlY3RvcjNEVGlsZVBvaW50cyBhbmQgQmlsbGJvYXJkQ29sbGVjdGlvblxuXG4gIHRoaXMuX2ltYWdlSW5kZXggPSAtMTtcbiAgdGhpcy5faW1hZ2VJbmRleFByb21pc2UgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2ltYWdlSWQgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2ltYWdlID0gdW5kZWZpbmVkO1xuICB0aGlzLl9pbWFnZVN1YlJlZ2lvbiA9IHVuZGVmaW5lZDtcbiAgdGhpcy5faW1hZ2VXaWR0aCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5faW1hZ2VIZWlnaHQgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fbGFiZWxEaW1lbnNpb25zID0gdW5kZWZpbmVkO1xuICB0aGlzLl9sYWJlbEhvcml6b250YWxPcmlnaW4gPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2xhYmVsVHJhbnNsYXRlID0gdW5kZWZpbmVkO1xuXG4gIHZhciBpbWFnZSA9IG9wdGlvbnMuaW1hZ2U7XG4gIHZhciBpbWFnZUlkID0gb3B0aW9ucy5pbWFnZUlkO1xuICBpZiAoZGVmaW5lZChpbWFnZSkpIHtcbiAgICBpZiAoIWRlZmluZWQoaW1hZ2VJZCkpIHtcbiAgICAgIGlmICh0eXBlb2YgaW1hZ2UgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgaW1hZ2VJZCA9IGltYWdlO1xuICAgICAgfSBlbHNlIGlmIChkZWZpbmVkKGltYWdlLnNyYykpIHtcbiAgICAgICAgaW1hZ2VJZCA9IGltYWdlLnNyYztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGltYWdlSWQgPSBjcmVhdGVHdWlkKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5faW1hZ2VJZCA9IGltYWdlSWQ7XG4gICAgdGhpcy5faW1hZ2UgPSBpbWFnZTtcbiAgfVxuXG4gIGlmIChkZWZpbmVkKG9wdGlvbnMuaW1hZ2VTdWJSZWdpb24pKSB7XG4gICAgdGhpcy5faW1hZ2VJZCA9IGltYWdlSWQ7XG4gICAgdGhpcy5faW1hZ2VTdWJSZWdpb24gPSBvcHRpb25zLmltYWdlU3ViUmVnaW9uO1xuICB9XG5cbiAgaWYgKGRlZmluZWQodGhpcy5fYmlsbGJvYXJkQ29sbGVjdGlvbi5fdGV4dHVyZUF0bGFzKSkge1xuICAgIHRoaXMuX2xvYWRJbWFnZSgpO1xuICB9XG5cbiAgdGhpcy5fYWN0dWFsQ2xhbXBlZFBvc2l0aW9uID0gdW5kZWZpbmVkO1xuICB0aGlzLl9yZW1vdmVDYWxsYmFja0Z1bmMgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX21vZGUgPSBTY2VuZU1vZGUuU0NFTkUzRDtcblxuICB0aGlzLl9jbHVzdGVyU2hvdyA9IHRydWU7XG4gIHRoaXMuX291dGxpbmVDb2xvciA9IENvbG9yLmNsb25lKFxuICAgIGRlZmF1bHRWYWx1ZShvcHRpb25zLm91dGxpbmVDb2xvciwgQ29sb3IuQkxBQ0spXG4gICk7XG4gIHRoaXMuX291dGxpbmVXaWR0aCA9IGRlZmF1bHRWYWx1ZShvcHRpb25zLm91dGxpbmVXaWR0aCwgMC4wKTtcblxuICB0aGlzLl91cGRhdGVDbGFtcGluZygpO1xufVxuXG52YXIgU0hPV19JTkRFWCA9IChCaWxsYm9hcmQuU0hPV19JTkRFWCA9IDApO1xudmFyIFBPU0lUSU9OX0lOREVYID0gKEJpbGxib2FyZC5QT1NJVElPTl9JTkRFWCA9IDEpO1xudmFyIFBJWEVMX09GRlNFVF9JTkRFWCA9IChCaWxsYm9hcmQuUElYRUxfT0ZGU0VUX0lOREVYID0gMik7XG52YXIgRVlFX09GRlNFVF9JTkRFWCA9IChCaWxsYm9hcmQuRVlFX09GRlNFVF9JTkRFWCA9IDMpO1xudmFyIEhPUklaT05UQUxfT1JJR0lOX0lOREVYID0gKEJpbGxib2FyZC5IT1JJWk9OVEFMX09SSUdJTl9JTkRFWCA9IDQpO1xudmFyIFZFUlRJQ0FMX09SSUdJTl9JTkRFWCA9IChCaWxsYm9hcmQuVkVSVElDQUxfT1JJR0lOX0lOREVYID0gNSk7XG52YXIgU0NBTEVfSU5ERVggPSAoQmlsbGJvYXJkLlNDQUxFX0lOREVYID0gNik7XG52YXIgSU1BR0VfSU5ERVhfSU5ERVggPSAoQmlsbGJvYXJkLklNQUdFX0lOREVYX0lOREVYID0gNyk7XG52YXIgQ09MT1JfSU5ERVggPSAoQmlsbGJvYXJkLkNPTE9SX0lOREVYID0gOCk7XG52YXIgUk9UQVRJT05fSU5ERVggPSAoQmlsbGJvYXJkLlJPVEFUSU9OX0lOREVYID0gOSk7XG52YXIgQUxJR05FRF9BWElTX0lOREVYID0gKEJpbGxib2FyZC5BTElHTkVEX0FYSVNfSU5ERVggPSAxMCk7XG52YXIgU0NBTEVfQllfRElTVEFOQ0VfSU5ERVggPSAoQmlsbGJvYXJkLlNDQUxFX0JZX0RJU1RBTkNFX0lOREVYID0gMTEpO1xudmFyIFRSQU5TTFVDRU5DWV9CWV9ESVNUQU5DRV9JTkRFWCA9IChCaWxsYm9hcmQuVFJBTlNMVUNFTkNZX0JZX0RJU1RBTkNFX0lOREVYID0gMTIpO1xudmFyIFBJWEVMX09GRlNFVF9TQ0FMRV9CWV9ESVNUQU5DRV9JTkRFWCA9IChCaWxsYm9hcmQuUElYRUxfT0ZGU0VUX1NDQUxFX0JZX0RJU1RBTkNFX0lOREVYID0gMTMpO1xudmFyIERJU1RBTkNFX0RJU1BMQVlfQ09ORElUSU9OID0gKEJpbGxib2FyZC5ESVNUQU5DRV9ESVNQTEFZX0NPTkRJVElPTiA9IDE0KTtcbnZhciBESVNBQkxFX0RFUFRIX0RJU1RBTkNFID0gKEJpbGxib2FyZC5ESVNBQkxFX0RFUFRIX0RJU1RBTkNFID0gMTUpO1xuQmlsbGJvYXJkLlRFWFRVUkVfQ09PUkRJTkFURV9CT1VORFMgPSAxNjtcbnZhciBTREZfSU5ERVggPSAoQmlsbGJvYXJkLlNERl9JTkRFWCA9IDE3KTtcbkJpbGxib2FyZC5OVU1CRVJfT0ZfUFJPUEVSVElFUyA9IDE4O1xuXG5mdW5jdGlvbiBtYWtlRGlydHkoYmlsbGJvYXJkLCBwcm9wZXJ0eUNoYW5nZWQpIHtcbiAgdmFyIGJpbGxib2FyZENvbGxlY3Rpb24gPSBiaWxsYm9hcmQuX2JpbGxib2FyZENvbGxlY3Rpb247XG4gIGlmIChkZWZpbmVkKGJpbGxib2FyZENvbGxlY3Rpb24pKSB7XG4gICAgYmlsbGJvYXJkQ29sbGVjdGlvbi5fdXBkYXRlQmlsbGJvYXJkKGJpbGxib2FyZCwgcHJvcGVydHlDaGFuZ2VkKTtcbiAgICBiaWxsYm9hcmQuX2RpcnR5ID0gdHJ1ZTtcbiAgfVxufVxuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhCaWxsYm9hcmQucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIGlmIHRoaXMgYmlsbGJvYXJkIHdpbGwgYmUgc2hvd24uICBVc2UgdGhpcyB0byBoaWRlIG9yIHNob3cgYSBiaWxsYm9hcmQsIGluc3RlYWRcbiAgICogb2YgcmVtb3ZpbmcgaXQgYW5kIHJlLWFkZGluZyBpdCB0byB0aGUgY29sbGVjdGlvbi5cbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZC5wcm90b3R5cGVcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHNob3c6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zaG93O1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBDaGVjay50eXBlT2YuYm9vbChcInZhbHVlXCIsIHZhbHVlKTtcbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgICBpZiAodGhpcy5fc2hvdyAhPT0gdmFsdWUpIHtcbiAgICAgICAgdGhpcy5fc2hvdyA9IHZhbHVlO1xuICAgICAgICBtYWtlRGlydHkodGhpcywgU0hPV19JTkRFWCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBDYXJ0ZXNpYW4gcG9zaXRpb24gb2YgdGhpcyBiaWxsYm9hcmQuXG4gICAqIEBtZW1iZXJvZiBCaWxsYm9hcmQucHJvdG90eXBlXG4gICAqIEB0eXBlIHtDYXJ0ZXNpYW4zfVxuICAgKi9cbiAgcG9zaXRpb246IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbjtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpXG4gICAgICBDaGVjay50eXBlT2Yub2JqZWN0KFwidmFsdWVcIiwgdmFsdWUpO1xuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIHZhciBwb3NpdGlvbiA9IHRoaXMuX3Bvc2l0aW9uO1xuICAgICAgaWYgKCFDYXJ0ZXNpYW4zLmVxdWFscyhwb3NpdGlvbiwgdmFsdWUpKSB7XG4gICAgICAgIENhcnRlc2lhbjMuY2xvbmUodmFsdWUsIHBvc2l0aW9uKTtcbiAgICAgICAgQ2FydGVzaWFuMy5jbG9uZSh2YWx1ZSwgdGhpcy5fYWN0dWFsUG9zaXRpb24pO1xuICAgICAgICB0aGlzLl91cGRhdGVDbGFtcGluZygpO1xuICAgICAgICBtYWtlRGlydHkodGhpcywgUE9TSVRJT05fSU5ERVgpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyB0aGUgaGVpZ2h0IHJlZmVyZW5jZSBvZiB0aGlzIGJpbGxib2FyZC5cbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZC5wcm90b3R5cGVcbiAgICogQHR5cGUge0hlaWdodFJlZmVyZW5jZX1cbiAgICogQGRlZmF1bHQgSGVpZ2h0UmVmZXJlbmNlLk5PTkVcbiAgICovXG4gIGhlaWdodFJlZmVyZW5jZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodFJlZmVyZW5jZTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpXG4gICAgICBDaGVjay50eXBlT2YubnVtYmVyKFwidmFsdWVcIiwgdmFsdWUpO1xuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIHZhciBoZWlnaHRSZWZlcmVuY2UgPSB0aGlzLl9oZWlnaHRSZWZlcmVuY2U7XG4gICAgICBpZiAodmFsdWUgIT09IGhlaWdodFJlZmVyZW5jZSkge1xuICAgICAgICB0aGlzLl9oZWlnaHRSZWZlcmVuY2UgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlQ2xhbXBpbmcoKTtcbiAgICAgICAgbWFrZURpcnR5KHRoaXMsIFBPU0lUSU9OX0lOREVYKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgdGhlIHBpeGVsIG9mZnNldCBpbiBzY3JlZW4gc3BhY2UgZnJvbSB0aGUgb3JpZ2luIG9mIHRoaXMgYmlsbGJvYXJkLiAgVGhpcyBpcyBjb21tb25seSB1c2VkXG4gICAqIHRvIGFsaWduIG11bHRpcGxlIGJpbGxib2FyZHMgYW5kIGxhYmVscyBhdCB0aGUgc2FtZSBwb3NpdGlvbiwgZS5nLiwgYW4gaW1hZ2UgYW5kIHRleHQuICBUaGVcbiAgICogc2NyZWVuIHNwYWNlIG9yaWdpbiBpcyB0aGUgdG9wLCBsZWZ0IGNvcm5lciBvZiB0aGUgY2FudmFzOyA8Y29kZT54PC9jb2RlPiBpbmNyZWFzZXMgZnJvbVxuICAgKiBsZWZ0IHRvIHJpZ2h0LCBhbmQgPGNvZGU+eTwvY29kZT4gaW5jcmVhc2VzIGZyb20gdG9wIHRvIGJvdHRvbS5cbiAgICogPGJyIC8+PGJyIC8+XG4gICAqIDxkaXYgYWxpZ249J2NlbnRlcic+XG4gICAqIDx0YWJsZSBib3JkZXI9JzAnIGNlbGxwYWRkaW5nPSc1Jz48dHI+XG4gICAqIDx0ZCBhbGlnbj0nY2VudGVyJz48Y29kZT5kZWZhdWx0PC9jb2RlPjxici8+PGltZyBzcmM9J0ltYWdlcy9CaWxsYm9hcmQuc2V0UGl4ZWxPZmZzZXQuZGVmYXVsdC5wbmcnIHdpZHRoPScyNTAnIGhlaWdodD0nMTg4JyAvPjwvdGQ+XG4gICAqIDx0ZCBhbGlnbj0nY2VudGVyJz48Y29kZT5iLnBpeGVsb2Zmc2V0ID0gbmV3IENhcnRlc2lhbjIoNTAsIDI1KTs8L2NvZGU+PGJyLz48aW1nIHNyYz0nSW1hZ2VzL0JpbGxib2FyZC5zZXRQaXhlbE9mZnNldC54NTB5LTI1LnBuZycgd2lkdGg9JzI1MCcgaGVpZ2h0PScxODgnIC8+PC90ZD5cbiAgICogPC90cj48L3RhYmxlPlxuICAgKiBUaGUgYmlsbGJvYXJkJ3Mgb3JpZ2luIGlzIGluZGljYXRlZCBieSB0aGUgeWVsbG93IHBvaW50LlxuICAgKiA8L2Rpdj5cbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZC5wcm90b3R5cGVcbiAgICogQHR5cGUge0NhcnRlc2lhbjJ9XG4gICAqL1xuICBwaXhlbE9mZnNldDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3BpeGVsT2Zmc2V0O1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBDaGVjay50eXBlT2Yub2JqZWN0KFwidmFsdWVcIiwgdmFsdWUpO1xuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIHZhciBwaXhlbE9mZnNldCA9IHRoaXMuX3BpeGVsT2Zmc2V0O1xuICAgICAgaWYgKCFDYXJ0ZXNpYW4yLmVxdWFscyhwaXhlbE9mZnNldCwgdmFsdWUpKSB7XG4gICAgICAgIENhcnRlc2lhbjIuY2xvbmUodmFsdWUsIHBpeGVsT2Zmc2V0KTtcbiAgICAgICAgbWFrZURpcnR5KHRoaXMsIFBJWEVMX09GRlNFVF9JTkRFWCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIG5lYXIgYW5kIGZhciBzY2FsaW5nIHByb3BlcnRpZXMgb2YgYSBCaWxsYm9hcmQgYmFzZWQgb24gdGhlIGJpbGxib2FyZCdzIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYS5cbiAgICogQSBiaWxsYm9hcmQncyBzY2FsZSB3aWxsIGludGVycG9sYXRlIGJldHdlZW4gdGhlIHtAbGluayBOZWFyRmFyU2NhbGFyI25lYXJWYWx1ZX0gYW5kXG4gICAqIHtAbGluayBOZWFyRmFyU2NhbGFyI2ZhclZhbHVlfSB3aGlsZSB0aGUgY2FtZXJhIGRpc3RhbmNlIGZhbGxzIHdpdGhpbiB0aGUgbG93ZXIgYW5kIHVwcGVyIGJvdW5kc1xuICAgKiBvZiB0aGUgc3BlY2lmaWVkIHtAbGluayBOZWFyRmFyU2NhbGFyI25lYXJ9IGFuZCB7QGxpbmsgTmVhckZhclNjYWxhciNmYXJ9LlxuICAgKiBPdXRzaWRlIG9mIHRoZXNlIHJhbmdlcyB0aGUgYmlsbGJvYXJkJ3Mgc2NhbGUgcmVtYWlucyBjbGFtcGVkIHRvIHRoZSBuZWFyZXN0IGJvdW5kLiAgSWYgdW5kZWZpbmVkLFxuICAgKiBzY2FsZUJ5RGlzdGFuY2Ugd2lsbCBiZSBkaXNhYmxlZC5cbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZC5wcm90b3R5cGVcbiAgICogQHR5cGUge05lYXJGYXJTY2FsYXJ9XG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIC8vIEV4YW1wbGUgMS5cbiAgICogLy8gU2V0IGEgYmlsbGJvYXJkJ3Mgc2NhbGVCeURpc3RhbmNlIHRvIHNjYWxlIGJ5IDEuNSB3aGVuIHRoZVxuICAgKiAvLyBjYW1lcmEgaXMgMTUwMCBtZXRlcnMgZnJvbSB0aGUgYmlsbGJvYXJkIGFuZCBkaXNhcHBlYXIgYXNcbiAgICogLy8gdGhlIGNhbWVyYSBkaXN0YW5jZSBhcHByb2FjaGVzIDguMGU2IG1ldGVycy5cbiAgICogYi5zY2FsZUJ5RGlzdGFuY2UgPSBuZXcgQ2VzaXVtLk5lYXJGYXJTY2FsYXIoMS41ZTIsIDEuNSwgOC4wZTYsIDAuMCk7XG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIC8vIEV4YW1wbGUgMi5cbiAgICogLy8gZGlzYWJsZSBzY2FsaW5nIGJ5IGRpc3RhbmNlXG4gICAqIGIuc2NhbGVCeURpc3RhbmNlID0gdW5kZWZpbmVkO1xuICAgKi9cbiAgc2NhbGVCeURpc3RhbmNlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc2NhbGVCeURpc3RhbmNlO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBpZiAoZGVmaW5lZCh2YWx1ZSkpIHtcbiAgICAgICAgQ2hlY2sudHlwZU9mLm9iamVjdChcInZhbHVlXCIsIHZhbHVlKTtcbiAgICAgICAgaWYgKHZhbHVlLmZhciA8PSB2YWx1ZS5uZWFyKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFxuICAgICAgICAgICAgXCJmYXIgZGlzdGFuY2UgbXVzdCBiZSBncmVhdGVyIHRoYW4gbmVhciBkaXN0YW5jZS5cIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgICB2YXIgc2NhbGVCeURpc3RhbmNlID0gdGhpcy5fc2NhbGVCeURpc3RhbmNlO1xuICAgICAgaWYgKCFOZWFyRmFyU2NhbGFyLmVxdWFscyhzY2FsZUJ5RGlzdGFuY2UsIHZhbHVlKSkge1xuICAgICAgICB0aGlzLl9zY2FsZUJ5RGlzdGFuY2UgPSBOZWFyRmFyU2NhbGFyLmNsb25lKHZhbHVlLCBzY2FsZUJ5RGlzdGFuY2UpO1xuICAgICAgICBtYWtlRGlydHkodGhpcywgU0NBTEVfQllfRElTVEFOQ0VfSU5ERVgpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyBuZWFyIGFuZCBmYXIgdHJhbnNsdWNlbmN5IHByb3BlcnRpZXMgb2YgYSBCaWxsYm9hcmQgYmFzZWQgb24gdGhlIGJpbGxib2FyZCdzIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYS5cbiAgICogQSBiaWxsYm9hcmQncyB0cmFuc2x1Y2VuY3kgd2lsbCBpbnRlcnBvbGF0ZSBiZXR3ZWVuIHRoZSB7QGxpbmsgTmVhckZhclNjYWxhciNuZWFyVmFsdWV9IGFuZFxuICAgKiB7QGxpbmsgTmVhckZhclNjYWxhciNmYXJWYWx1ZX0gd2hpbGUgdGhlIGNhbWVyYSBkaXN0YW5jZSBmYWxscyB3aXRoaW4gdGhlIGxvd2VyIGFuZCB1cHBlciBib3VuZHNcbiAgICogb2YgdGhlIHNwZWNpZmllZCB7QGxpbmsgTmVhckZhclNjYWxhciNuZWFyfSBhbmQge0BsaW5rIE5lYXJGYXJTY2FsYXIjZmFyfS5cbiAgICogT3V0c2lkZSBvZiB0aGVzZSByYW5nZXMgdGhlIGJpbGxib2FyZCdzIHRyYW5zbHVjZW5jeSByZW1haW5zIGNsYW1wZWQgdG8gdGhlIG5lYXJlc3QgYm91bmQuICBJZiB1bmRlZmluZWQsXG4gICAqIHRyYW5zbHVjZW5jeUJ5RGlzdGFuY2Ugd2lsbCBiZSBkaXNhYmxlZC5cbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZC5wcm90b3R5cGVcbiAgICogQHR5cGUge05lYXJGYXJTY2FsYXJ9XG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIC8vIEV4YW1wbGUgMS5cbiAgICogLy8gU2V0IGEgYmlsbGJvYXJkJ3MgdHJhbnNsdWNlbmN5IHRvIDEuMCB3aGVuIHRoZVxuICAgKiAvLyBjYW1lcmEgaXMgMTUwMCBtZXRlcnMgZnJvbSB0aGUgYmlsbGJvYXJkIGFuZCBkaXNhcHBlYXIgYXNcbiAgICogLy8gdGhlIGNhbWVyYSBkaXN0YW5jZSBhcHByb2FjaGVzIDguMGU2IG1ldGVycy5cbiAgICogYi50cmFuc2x1Y2VuY3lCeURpc3RhbmNlID0gbmV3IENlc2l1bS5OZWFyRmFyU2NhbGFyKDEuNWUyLCAxLjAsIDguMGU2LCAwLjApO1xuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBFeGFtcGxlIDIuXG4gICAqIC8vIGRpc2FibGUgdHJhbnNsdWNlbmN5IGJ5IGRpc3RhbmNlXG4gICAqIGIudHJhbnNsdWNlbmN5QnlEaXN0YW5jZSA9IHVuZGVmaW5lZDtcbiAgICovXG4gIHRyYW5zbHVjZW5jeUJ5RGlzdGFuY2U6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl90cmFuc2x1Y2VuY3lCeURpc3RhbmNlO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBpZiAoZGVmaW5lZCh2YWx1ZSkpIHtcbiAgICAgICAgQ2hlY2sudHlwZU9mLm9iamVjdChcInZhbHVlXCIsIHZhbHVlKTtcbiAgICAgICAgaWYgKHZhbHVlLmZhciA8PSB2YWx1ZS5uZWFyKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFxuICAgICAgICAgICAgXCJmYXIgZGlzdGFuY2UgbXVzdCBiZSBncmVhdGVyIHRoYW4gbmVhciBkaXN0YW5jZS5cIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgICB2YXIgdHJhbnNsdWNlbmN5QnlEaXN0YW5jZSA9IHRoaXMuX3RyYW5zbHVjZW5jeUJ5RGlzdGFuY2U7XG4gICAgICBpZiAoIU5lYXJGYXJTY2FsYXIuZXF1YWxzKHRyYW5zbHVjZW5jeUJ5RGlzdGFuY2UsIHZhbHVlKSkge1xuICAgICAgICB0aGlzLl90cmFuc2x1Y2VuY3lCeURpc3RhbmNlID0gTmVhckZhclNjYWxhci5jbG9uZShcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICB0cmFuc2x1Y2VuY3lCeURpc3RhbmNlXG4gICAgICAgICk7XG4gICAgICAgIG1ha2VEaXJ0eSh0aGlzLCBUUkFOU0xVQ0VOQ1lfQllfRElTVEFOQ0VfSU5ERVgpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyBuZWFyIGFuZCBmYXIgcGl4ZWwgb2Zmc2V0IHNjYWxpbmcgcHJvcGVydGllcyBvZiBhIEJpbGxib2FyZCBiYXNlZCBvbiB0aGUgYmlsbGJvYXJkJ3MgZGlzdGFuY2UgZnJvbSB0aGUgY2FtZXJhLlxuICAgKiBBIGJpbGxib2FyZCdzIHBpeGVsIG9mZnNldCB3aWxsIGJlIHNjYWxlZCBiZXR3ZWVuIHRoZSB7QGxpbmsgTmVhckZhclNjYWxhciNuZWFyVmFsdWV9IGFuZFxuICAgKiB7QGxpbmsgTmVhckZhclNjYWxhciNmYXJWYWx1ZX0gd2hpbGUgdGhlIGNhbWVyYSBkaXN0YW5jZSBmYWxscyB3aXRoaW4gdGhlIGxvd2VyIGFuZCB1cHBlciBib3VuZHNcbiAgICogb2YgdGhlIHNwZWNpZmllZCB7QGxpbmsgTmVhckZhclNjYWxhciNuZWFyfSBhbmQge0BsaW5rIE5lYXJGYXJTY2FsYXIjZmFyfS5cbiAgICogT3V0c2lkZSBvZiB0aGVzZSByYW5nZXMgdGhlIGJpbGxib2FyZCdzIHBpeGVsIG9mZnNldCBzY2FsZSByZW1haW5zIGNsYW1wZWQgdG8gdGhlIG5lYXJlc3QgYm91bmQuICBJZiB1bmRlZmluZWQsXG4gICAqIHBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlIHdpbGwgYmUgZGlzYWJsZWQuXG4gICAqIEBtZW1iZXJvZiBCaWxsYm9hcmQucHJvdG90eXBlXG4gICAqIEB0eXBlIHtOZWFyRmFyU2NhbGFyfVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBFeGFtcGxlIDEuXG4gICAqIC8vIFNldCBhIGJpbGxib2FyZCdzIHBpeGVsIG9mZnNldCBzY2FsZSB0byAwLjAgd2hlbiB0aGVcbiAgICogLy8gY2FtZXJhIGlzIDE1MDAgbWV0ZXJzIGZyb20gdGhlIGJpbGxib2FyZCBhbmQgc2NhbGUgcGl4ZWwgb2Zmc2V0IHRvIDEwLjAgcGl4ZWxzXG4gICAqIC8vIGluIHRoZSB5IGRpcmVjdGlvbiB0aGUgY2FtZXJhIGRpc3RhbmNlIGFwcHJvYWNoZXMgOC4wZTYgbWV0ZXJzLlxuICAgKiBiLnBpeGVsT2Zmc2V0ID0gbmV3IENlc2l1bS5DYXJ0ZXNpYW4yKDAuMCwgMS4wKTtcbiAgICogYi5waXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZSA9IG5ldyBDZXNpdW0uTmVhckZhclNjYWxhcigxLjVlMiwgMC4wLCA4LjBlNiwgMTAuMCk7XG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIC8vIEV4YW1wbGUgMi5cbiAgICogLy8gZGlzYWJsZSBwaXhlbCBvZmZzZXQgYnkgZGlzdGFuY2VcbiAgICogYi5waXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZSA9IHVuZGVmaW5lZDtcbiAgICovXG4gIHBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2U7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICAgIGlmIChkZWZpbmVkKHZhbHVlKSkge1xuICAgICAgICBDaGVjay50eXBlT2Yub2JqZWN0KFwidmFsdWVcIiwgdmFsdWUpO1xuICAgICAgICBpZiAodmFsdWUuZmFyIDw9IHZhbHVlLm5lYXIpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXG4gICAgICAgICAgICBcImZhciBkaXN0YW5jZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBuZWFyIGRpc3RhbmNlLlwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIHZhciBwaXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZSA9IHRoaXMuX3BpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlO1xuICAgICAgaWYgKCFOZWFyRmFyU2NhbGFyLmVxdWFscyhwaXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZSwgdmFsdWUpKSB7XG4gICAgICAgIHRoaXMuX3BpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlID0gTmVhckZhclNjYWxhci5jbG9uZShcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICBwaXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZVxuICAgICAgICApO1xuICAgICAgICBtYWtlRGlydHkodGhpcywgUElYRUxfT0ZGU0VUX1NDQUxFX0JZX0RJU1RBTkNFX0lOREVYKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgdGhlIDNEIENhcnRlc2lhbiBvZmZzZXQgYXBwbGllZCB0byB0aGlzIGJpbGxib2FyZCBpbiBleWUgY29vcmRpbmF0ZXMuICBFeWUgY29vcmRpbmF0ZXMgaXMgYSBsZWZ0LWhhbmRlZFxuICAgKiBjb29yZGluYXRlIHN5c3RlbSwgd2hlcmUgPGNvZGU+eDwvY29kZT4gcG9pbnRzIHRvd2FyZHMgdGhlIHZpZXdlcidzIHJpZ2h0LCA8Y29kZT55PC9jb2RlPiBwb2ludHMgdXAsIGFuZFxuICAgKiA8Y29kZT56PC9jb2RlPiBwb2ludHMgaW50byB0aGUgc2NyZWVuLiAgRXllIGNvb3JkaW5hdGVzIHVzZSB0aGUgc2FtZSBzY2FsZSBhcyB3b3JsZCBhbmQgbW9kZWwgY29vcmRpbmF0ZXMsXG4gICAqIHdoaWNoIGlzIHR5cGljYWxseSBtZXRlcnMuXG4gICAqIDxiciAvPjxiciAvPlxuICAgKiBBbiBleWUgb2Zmc2V0IGlzIGNvbW1vbmx5IHVzZWQgdG8gYXJyYW5nZSBtdWx0aXBsZSBiaWxsYm9hcmRzIG9yIG9iamVjdHMgYXQgdGhlIHNhbWUgcG9zaXRpb24sIGUuZy4sIHRvXG4gICAqIGFycmFuZ2UgYSBiaWxsYm9hcmQgYWJvdmUgaXRzIGNvcnJlc3BvbmRpbmcgM0QgbW9kZWwuXG4gICAqIDxiciAvPjxiciAvPlxuICAgKiBCZWxvdywgdGhlIGJpbGxib2FyZCBpcyBwb3NpdGlvbmVkIGF0IHRoZSBjZW50ZXIgb2YgdGhlIEVhcnRoIGJ1dCBhbiBleWUgb2Zmc2V0IG1ha2VzIGl0IGFsd2F5c1xuICAgKiBhcHBlYXIgb24gdG9wIG9mIHRoZSBFYXJ0aCByZWdhcmRsZXNzIG9mIHRoZSB2aWV3ZXIncyBvciBFYXJ0aCdzIG9yaWVudGF0aW9uLlxuICAgKiA8YnIgLz48YnIgLz5cbiAgICogPGRpdiBhbGlnbj0nY2VudGVyJz5cbiAgICogPHRhYmxlIGJvcmRlcj0nMCcgY2VsbHBhZGRpbmc9JzUnPjx0cj5cbiAgICogPHRkIGFsaWduPSdjZW50ZXInPjxpbWcgc3JjPSdJbWFnZXMvQmlsbGJvYXJkLnNldEV5ZU9mZnNldC5vbmUucG5nJyB3aWR0aD0nMjUwJyBoZWlnaHQ9JzE4OCcgLz48L3RkPlxuICAgKiA8dGQgYWxpZ249J2NlbnRlcic+PGltZyBzcmM9J0ltYWdlcy9CaWxsYm9hcmQuc2V0RXllT2Zmc2V0LnR3by5wbmcnIHdpZHRoPScyNTAnIGhlaWdodD0nMTg4JyAvPjwvdGQ+XG4gICAqIDwvdHI+PC90YWJsZT5cbiAgICogPGNvZGU+Yi5leWVPZmZzZXQgPSBuZXcgQ2FydGVzaWFuMygwLjAsIDgwMDAwMDAuMCwgMC4wKTs8L2NvZGU+PGJyIC8+PGJyIC8+XG4gICAqIDwvZGl2PlxuICAgKiBAbWVtYmVyb2YgQmlsbGJvYXJkLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7Q2FydGVzaWFuM31cbiAgICovXG4gIGV5ZU9mZnNldDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2V5ZU9mZnNldDtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgQ2hlY2sudHlwZU9mLm9iamVjdChcInZhbHVlXCIsIHZhbHVlKTtcbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgICB2YXIgZXllT2Zmc2V0ID0gdGhpcy5fZXllT2Zmc2V0O1xuICAgICAgaWYgKCFDYXJ0ZXNpYW4zLmVxdWFscyhleWVPZmZzZXQsIHZhbHVlKSkge1xuICAgICAgICBDYXJ0ZXNpYW4zLmNsb25lKHZhbHVlLCBleWVPZmZzZXQpO1xuICAgICAgICBtYWtlRGlydHkodGhpcywgRVlFX09GRlNFVF9JTkRFWCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBob3Jpem9udGFsIG9yaWdpbiBvZiB0aGlzIGJpbGxib2FyZCwgd2hpY2ggZGV0ZXJtaW5lcyBpZiB0aGUgYmlsbGJvYXJkIGlzXG4gICAqIHRvIHRoZSBsZWZ0LCBjZW50ZXIsIG9yIHJpZ2h0IG9mIGl0cyBhbmNob3IgcG9zaXRpb24uXG4gICAqIDxiciAvPjxiciAvPlxuICAgKiA8ZGl2IGFsaWduPSdjZW50ZXInPlxuICAgKiA8aW1nIHNyYz0nSW1hZ2VzL0JpbGxib2FyZC5zZXRIb3Jpem9udGFsT3JpZ2luLnBuZycgd2lkdGg9JzY0OCcgaGVpZ2h0PScxOTYnIC8+PGJyIC8+XG4gICAqIDwvZGl2PlxuICAgKiBAbWVtYmVyb2YgQmlsbGJvYXJkLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7SG9yaXpvbnRhbE9yaWdpbn1cbiAgICogQGV4YW1wbGVcbiAgICogLy8gVXNlIGEgYm90dG9tLCBsZWZ0IG9yaWdpblxuICAgKiBiLmhvcml6b250YWxPcmlnaW4gPSBDZXNpdW0uSG9yaXpvbnRhbE9yaWdpbi5MRUZUO1xuICAgKiBiLnZlcnRpY2FsT3JpZ2luID0gQ2VzaXVtLlZlcnRpY2FsT3JpZ2luLkJPVFRPTTtcbiAgICovXG4gIGhvcml6b250YWxPcmlnaW46IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9ob3Jpem9udGFsT3JpZ2luO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBDaGVjay50eXBlT2YubnVtYmVyKFwidmFsdWVcIiwgdmFsdWUpO1xuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIGlmICh0aGlzLl9ob3Jpem9udGFsT3JpZ2luICE9PSB2YWx1ZSkge1xuICAgICAgICB0aGlzLl9ob3Jpem9udGFsT3JpZ2luID0gdmFsdWU7XG4gICAgICAgIG1ha2VEaXJ0eSh0aGlzLCBIT1JJWk9OVEFMX09SSUdJTl9JTkRFWCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSB2ZXJ0aWNhbCBvcmlnaW4gb2YgdGhpcyBiaWxsYm9hcmQsIHdoaWNoIGRldGVybWluZXMgaWYgdGhlIGJpbGxib2FyZCBpc1xuICAgKiB0byB0aGUgYWJvdmUsIGJlbG93LCBvciBhdCB0aGUgY2VudGVyIG9mIGl0cyBhbmNob3IgcG9zaXRpb24uXG4gICAqIDxiciAvPjxiciAvPlxuICAgKiA8ZGl2IGFsaWduPSdjZW50ZXInPlxuICAgKiA8aW1nIHNyYz0nSW1hZ2VzL0JpbGxib2FyZC5zZXRWZXJ0aWNhbE9yaWdpbi5wbmcnIHdpZHRoPSc2OTUnIGhlaWdodD0nMTc1JyAvPjxiciAvPlxuICAgKiA8L2Rpdj5cbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZC5wcm90b3R5cGVcbiAgICogQHR5cGUge1ZlcnRpY2FsT3JpZ2lufVxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBVc2UgYSBib3R0b20sIGxlZnQgb3JpZ2luXG4gICAqIGIuaG9yaXpvbnRhbE9yaWdpbiA9IENlc2l1bS5Ib3Jpem9udGFsT3JpZ2luLkxFRlQ7XG4gICAqIGIudmVydGljYWxPcmlnaW4gPSBDZXNpdW0uVmVydGljYWxPcmlnaW4uQk9UVE9NO1xuICAgKi9cbiAgdmVydGljYWxPcmlnaW46IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl92ZXJ0aWNhbE9yaWdpbjtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgQ2hlY2sudHlwZU9mLm51bWJlcihcInZhbHVlXCIsIHZhbHVlKTtcbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgICBpZiAodGhpcy5fdmVydGljYWxPcmlnaW4gIT09IHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3ZlcnRpY2FsT3JpZ2luID0gdmFsdWU7XG4gICAgICAgIG1ha2VEaXJ0eSh0aGlzLCBWRVJUSUNBTF9PUklHSU5fSU5ERVgpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyB0aGUgdW5pZm9ybSBzY2FsZSB0aGF0IGlzIG11bHRpcGxpZWQgd2l0aCB0aGUgYmlsbGJvYXJkJ3MgaW1hZ2Ugc2l6ZSBpbiBwaXhlbHMuXG4gICAqIEEgc2NhbGUgb2YgPGNvZGU+MS4wPC9jb2RlPiBkb2VzIG5vdCBjaGFuZ2UgdGhlIHNpemUgb2YgdGhlIGJpbGxib2FyZDsgYSBzY2FsZSBncmVhdGVyIHRoYW5cbiAgICogPGNvZGU+MS4wPC9jb2RlPiBlbmxhcmdlcyB0aGUgYmlsbGJvYXJkOyBhIHBvc2l0aXZlIHNjYWxlIGxlc3MgdGhhbiA8Y29kZT4xLjA8L2NvZGU+IHNocmlua3NcbiAgICogdGhlIGJpbGxib2FyZC5cbiAgICogPGJyIC8+PGJyIC8+XG4gICAqIDxkaXYgYWxpZ249J2NlbnRlcic+XG4gICAqIDxpbWcgc3JjPSdJbWFnZXMvQmlsbGJvYXJkLnNldFNjYWxlLnBuZycgd2lkdGg9JzQwMCcgaGVpZ2h0PSczMDAnIC8+PGJyLz5cbiAgICogRnJvbSBsZWZ0IHRvIHJpZ2h0IGluIHRoZSBhYm92ZSBpbWFnZSwgdGhlIHNjYWxlcyBhcmUgPGNvZGU+MC41PC9jb2RlPiwgPGNvZGU+MS4wPC9jb2RlPixcbiAgICogYW5kIDxjb2RlPjIuMDwvY29kZT4uXG4gICAqIDwvZGl2PlxuICAgKiBAbWVtYmVyb2YgQmlsbGJvYXJkLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKi9cbiAgc2NhbGU6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zY2FsZTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgQ2hlY2sudHlwZU9mLm51bWJlcihcInZhbHVlXCIsIHZhbHVlKTtcbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgICBpZiAodGhpcy5fc2NhbGUgIT09IHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3NjYWxlID0gdmFsdWU7XG4gICAgICAgIG1ha2VEaXJ0eSh0aGlzLCBTQ0FMRV9JTkRFWCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBjb2xvciB0aGF0IGlzIG11bHRpcGxpZWQgd2l0aCB0aGUgYmlsbGJvYXJkJ3MgdGV4dHVyZS4gIFRoaXMgaGFzIHR3byBjb21tb24gdXNlIGNhc2VzLiAgRmlyc3QsXG4gICAqIHRoZSBzYW1lIHdoaXRlIHRleHR1cmUgbWF5IGJlIHVzZWQgYnkgbWFueSBkaWZmZXJlbnQgYmlsbGJvYXJkcywgZWFjaCB3aXRoIGEgZGlmZmVyZW50IGNvbG9yLCB0byBjcmVhdGVcbiAgICogY29sb3JlZCBiaWxsYm9hcmRzLiAgU2Vjb25kLCB0aGUgY29sb3IncyBhbHBoYSBjb21wb25lbnQgY2FuIGJlIHVzZWQgdG8gbWFrZSB0aGUgYmlsbGJvYXJkIHRyYW5zbHVjZW50IGFzIHNob3duIGJlbG93LlxuICAgKiBBbiBhbHBoYSBvZiA8Y29kZT4wLjA8L2NvZGU+IG1ha2VzIHRoZSBiaWxsYm9hcmQgdHJhbnNwYXJlbnQsIGFuZCA8Y29kZT4xLjA8L2NvZGU+IG1ha2VzIHRoZSBiaWxsYm9hcmQgb3BhcXVlLlxuICAgKiA8YnIgLz48YnIgLz5cbiAgICogPGRpdiBhbGlnbj0nY2VudGVyJz5cbiAgICogPHRhYmxlIGJvcmRlcj0nMCcgY2VsbHBhZGRpbmc9JzUnPjx0cj5cbiAgICogPHRkIGFsaWduPSdjZW50ZXInPjxjb2RlPmRlZmF1bHQ8L2NvZGU+PGJyLz48aW1nIHNyYz0nSW1hZ2VzL0JpbGxib2FyZC5zZXRDb2xvci5BbHBoYTI1NS5wbmcnIHdpZHRoPScyNTAnIGhlaWdodD0nMTg4JyAvPjwvdGQ+XG4gICAqIDx0ZCBhbGlnbj0nY2VudGVyJz48Y29kZT5hbHBoYSA6IDAuNTwvY29kZT48YnIvPjxpbWcgc3JjPSdJbWFnZXMvQmlsbGJvYXJkLnNldENvbG9yLkFscGhhMTI3LnBuZycgd2lkdGg9JzI1MCcgaGVpZ2h0PScxODgnIC8+PC90ZD5cbiAgICogPC90cj48L3RhYmxlPlxuICAgKiA8L2Rpdj5cbiAgICogPGJyIC8+XG4gICAqIFRoZSByZWQsIGdyZWVuLCBibHVlLCBhbmQgYWxwaGEgdmFsdWVzIGFyZSBpbmRpY2F0ZWQgYnkgPGNvZGU+dmFsdWU8L2NvZGU+J3MgPGNvZGU+cmVkPC9jb2RlPiwgPGNvZGU+Z3JlZW48L2NvZGU+LFxuICAgKiA8Y29kZT5ibHVlPC9jb2RlPiwgYW5kIDxjb2RlPmFscGhhPC9jb2RlPiBwcm9wZXJ0aWVzIGFzIHNob3duIGluIEV4YW1wbGUgMS4gIFRoZXNlIGNvbXBvbmVudHMgcmFuZ2UgZnJvbSA8Y29kZT4wLjA8L2NvZGU+XG4gICAqIChubyBpbnRlbnNpdHkpIHRvIDxjb2RlPjEuMDwvY29kZT4gKGZ1bGwgaW50ZW5zaXR5KS5cbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZC5wcm90b3R5cGVcbiAgICogQHR5cGUge0NvbG9yfVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBFeGFtcGxlIDEuIEFzc2lnbiB5ZWxsb3cuXG4gICAqIGIuY29sb3IgPSBDZXNpdW0uQ29sb3IuWUVMTE9XO1xuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBFeGFtcGxlIDIuIE1ha2UgYSBiaWxsYm9hcmQgNTAlIHRyYW5zbHVjZW50LlxuICAgKiBiLmNvbG9yID0gbmV3IENlc2l1bS5Db2xvcigxLjAsIDEuMCwgMS4wLCAwLjUpO1xuICAgKi9cbiAgY29sb3I6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jb2xvcjtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgQ2hlY2sudHlwZU9mLm9iamVjdChcInZhbHVlXCIsIHZhbHVlKTtcbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgICB2YXIgY29sb3IgPSB0aGlzLl9jb2xvcjtcbiAgICAgIGlmICghQ29sb3IuZXF1YWxzKGNvbG9yLCB2YWx1ZSkpIHtcbiAgICAgICAgQ29sb3IuY2xvbmUodmFsdWUsIGNvbG9yKTtcbiAgICAgICAgbWFrZURpcnR5KHRoaXMsIENPTE9SX0lOREVYKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgdGhlIHJvdGF0aW9uIGFuZ2xlIGluIHJhZGlhbnMuXG4gICAqIEBtZW1iZXJvZiBCaWxsYm9hcmQucHJvdG90eXBlXG4gICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAqL1xuICByb3RhdGlvbjoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3JvdGF0aW9uO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBDaGVjay50eXBlT2YubnVtYmVyKFwidmFsdWVcIiwgdmFsdWUpO1xuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIGlmICh0aGlzLl9yb3RhdGlvbiAhPT0gdmFsdWUpIHtcbiAgICAgICAgdGhpcy5fcm90YXRpb24gPSB2YWx1ZTtcbiAgICAgICAgbWFrZURpcnR5KHRoaXMsIFJPVEFUSU9OX0lOREVYKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgdGhlIGFsaWduZWQgYXhpcyBpbiB3b3JsZCBzcGFjZS4gVGhlIGFsaWduZWQgYXhpcyBpcyB0aGUgdW5pdCB2ZWN0b3IgdGhhdCB0aGUgYmlsbGJvYXJkIHVwIHZlY3RvciBwb2ludHMgdG93YXJkcy5cbiAgICogVGhlIGRlZmF1bHQgaXMgdGhlIHplcm8gdmVjdG9yLCB3aGljaCBtZWFucyB0aGUgYmlsbGJvYXJkIGlzIGFsaWduZWQgdG8gdGhlIHNjcmVlbiB1cCB2ZWN0b3IuXG4gICAqIEBtZW1iZXJvZiBCaWxsYm9hcmQucHJvdG90eXBlXG4gICAqIEB0eXBlIHtDYXJ0ZXNpYW4zfVxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBFeGFtcGxlIDEuXG4gICAqIC8vIEhhdmUgdGhlIGJpbGxib2FyZCB1cCB2ZWN0b3IgcG9pbnQgbm9ydGhcbiAgICogYmlsbGJvYXJkLmFsaWduZWRBeGlzID0gQ2VzaXVtLkNhcnRlc2lhbjMuVU5JVF9aO1xuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBFeGFtcGxlIDIuXG4gICAqIC8vIEhhdmUgdGhlIGJpbGxib2FyZCBwb2ludCBlYXN0LlxuICAgKiBiaWxsYm9hcmQuYWxpZ25lZEF4aXMgPSBDZXNpdW0uQ2FydGVzaWFuMy5VTklUX1o7XG4gICAqIGJpbGxib2FyZC5yb3RhdGlvbiA9IC1DZXNpdW0uTWF0aC5QSV9PVkVSX1RXTztcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogLy8gRXhhbXBsZSAzLlxuICAgKiAvLyBSZXNldCB0aGUgYWxpZ25lZCBheGlzXG4gICAqIGJpbGxib2FyZC5hbGlnbmVkQXhpcyA9IENlc2l1bS5DYXJ0ZXNpYW4zLlpFUk87XG4gICAqL1xuICBhbGlnbmVkQXhpczoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2FsaWduZWRBeGlzO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBDaGVjay50eXBlT2Yub2JqZWN0KFwidmFsdWVcIiwgdmFsdWUpO1xuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIHZhciBhbGlnbmVkQXhpcyA9IHRoaXMuX2FsaWduZWRBeGlzO1xuICAgICAgaWYgKCFDYXJ0ZXNpYW4zLmVxdWFscyhhbGlnbmVkQXhpcywgdmFsdWUpKSB7XG4gICAgICAgIENhcnRlc2lhbjMuY2xvbmUodmFsdWUsIGFsaWduZWRBeGlzKTtcbiAgICAgICAgbWFrZURpcnR5KHRoaXMsIEFMSUdORURfQVhJU19JTkRFWCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIGEgd2lkdGggZm9yIHRoZSBiaWxsYm9hcmQuIElmIHVuZGVmaW5lZCwgdGhlIGltYWdlIHdpZHRoIHdpbGwgYmUgdXNlZC5cbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZC5wcm90b3R5cGVcbiAgICogQHR5cGUge051bWJlcn1cbiAgICovXG4gIHdpZHRoOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdFZhbHVlKHRoaXMuX3dpZHRoLCB0aGlzLl9pbWFnZVdpZHRoKTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgaWYgKGRlZmluZWQodmFsdWUpKSB7XG4gICAgICAgIENoZWNrLnR5cGVPZi5udW1iZXIoXCJ2YWx1ZVwiLCB2YWx1ZSk7XG4gICAgICB9XG4gICAgICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcbiAgICAgIGlmICh0aGlzLl93aWR0aCAhPT0gdmFsdWUpIHtcbiAgICAgICAgdGhpcy5fd2lkdGggPSB2YWx1ZTtcbiAgICAgICAgbWFrZURpcnR5KHRoaXMsIElNQUdFX0lOREVYX0lOREVYKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgYSBoZWlnaHQgZm9yIHRoZSBiaWxsYm9hcmQuIElmIHVuZGVmaW5lZCwgdGhlIGltYWdlIGhlaWdodCB3aWxsIGJlIHVzZWQuXG4gICAqIEBtZW1iZXJvZiBCaWxsYm9hcmQucHJvdG90eXBlXG4gICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAqL1xuICBoZWlnaHQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0VmFsdWUodGhpcy5faGVpZ2h0LCB0aGlzLl9pbWFnZUhlaWdodCk7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICAgIGlmIChkZWZpbmVkKHZhbHVlKSkge1xuICAgICAgICBDaGVjay50eXBlT2YubnVtYmVyKFwidmFsdWVcIiwgdmFsdWUpO1xuICAgICAgfVxuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG4gICAgICBpZiAodGhpcy5faGVpZ2h0ICE9PSB2YWx1ZSkge1xuICAgICAgICB0aGlzLl9oZWlnaHQgPSB2YWx1ZTtcbiAgICAgICAgbWFrZURpcnR5KHRoaXMsIElNQUdFX0lOREVYX0lOREVYKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgaWYgdGhlIGJpbGxib2FyZCBzaXplIGlzIGluIG1ldGVycyBvciBwaXhlbHMuIDxjb2RlPnRydWU8L2NvZGU+IHRvIHNpemUgdGhlIGJpbGxib2FyZCBpbiBtZXRlcnM7XG4gICAqIG90aGVyd2lzZSwgdGhlIHNpemUgaXMgaW4gcGl4ZWxzLlxuICAgKiBAbWVtYmVyb2YgQmlsbGJvYXJkLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHNpemVJbk1ldGVyczoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3NpemVJbk1ldGVycztcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgQ2hlY2sudHlwZU9mLmJvb2woXCJ2YWx1ZVwiLCB2YWx1ZSk7XG4gICAgICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcbiAgICAgIGlmICh0aGlzLl9zaXplSW5NZXRlcnMgIT09IHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3NpemVJbk1ldGVycyA9IHZhbHVlO1xuICAgICAgICBtYWtlRGlydHkodGhpcywgQ09MT1JfSU5ERVgpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyB0aGUgY29uZGl0aW9uIHNwZWNpZnlpbmcgYXQgd2hhdCBkaXN0YW5jZSBmcm9tIHRoZSBjYW1lcmEgdGhhdCB0aGlzIGJpbGxib2FyZCB3aWxsIGJlIGRpc3BsYXllZC5cbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZC5wcm90b3R5cGVcbiAgICogQHR5cGUge0Rpc3RhbmNlRGlzcGxheUNvbmRpdGlvbn1cbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkXG4gICAqL1xuICBkaXN0YW5jZURpc3BsYXlDb25kaXRpb246IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9kaXN0YW5jZURpc3BsYXlDb25kaXRpb247XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKFxuICAgICAgICAhRGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uLmVxdWFscyh2YWx1ZSwgdGhpcy5fZGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uKVxuICAgICAgKSB7XG4gICAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICAgIGlmIChkZWZpbmVkKHZhbHVlKSkge1xuICAgICAgICAgIENoZWNrLnR5cGVPZi5vYmplY3QoXCJ2YWx1ZVwiLCB2YWx1ZSk7XG4gICAgICAgICAgaWYgKHZhbHVlLmZhciA8PSB2YWx1ZS5uZWFyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXG4gICAgICAgICAgICAgIFwiZmFyIGRpc3RhbmNlIG11c3QgYmUgZ3JlYXRlciB0aGFuIG5lYXIgZGlzdGFuY2UuXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuICAgICAgICB0aGlzLl9kaXN0YW5jZURpc3BsYXlDb25kaXRpb24gPSBEaXN0YW5jZURpc3BsYXlDb25kaXRpb24uY2xvbmUoXG4gICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgdGhpcy5fZGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uXG4gICAgICAgICk7XG4gICAgICAgIG1ha2VEaXJ0eSh0aGlzLCBESVNUQU5DRV9ESVNQTEFZX0NPTkRJVElPTik7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBkaXN0YW5jZSBmcm9tIHRoZSBjYW1lcmEgYXQgd2hpY2ggdG8gZGlzYWJsZSB0aGUgZGVwdGggdGVzdCB0bywgZm9yIGV4YW1wbGUsIHByZXZlbnQgY2xpcHBpbmcgYWdhaW5zdCB0ZXJyYWluLlxuICAgKiBXaGVuIHNldCB0byB6ZXJvLCB0aGUgZGVwdGggdGVzdCBpcyBhbHdheXMgYXBwbGllZC4gV2hlbiBzZXQgdG8gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCB0aGUgZGVwdGggdGVzdCBpcyBuZXZlciBhcHBsaWVkLlxuICAgKiBAbWVtYmVyb2YgQmlsbGJvYXJkLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKi9cbiAgZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBpZiAoZGVmaW5lZCh2YWx1ZSkpIHtcbiAgICAgICAgQ2hlY2sudHlwZU9mLm51bWJlcihcInZhbHVlXCIsIHZhbHVlKTtcbiAgICAgICAgaWYgKHZhbHVlIDwgMC4wKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFxuICAgICAgICAgICAgXCJkaXNhYmxlRGVwdGhUZXN0RGlzdGFuY2UgbXVzdCBiZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gMC4wLlwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG4gICAgICBpZiAodGhpcy5fZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlICE9PSB2YWx1ZSkge1xuICAgICAgICB0aGlzLl9kaXNhYmxlRGVwdGhUZXN0RGlzdGFuY2UgPSB2YWx1ZTtcbiAgICAgICAgbWFrZURpcnR5KHRoaXMsIERJU0FCTEVfREVQVEhfRElTVEFOQ0UpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyB0aGUgdXNlci1kZWZpbmVkIG9iamVjdCByZXR1cm5lZCB3aGVuIHRoZSBiaWxsYm9hcmQgaXMgcGlja2VkLlxuICAgKiBAbWVtYmVyb2YgQmlsbGJvYXJkLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgKi9cbiAgaWQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9pZDtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLl9pZCA9IHZhbHVlO1xuICAgICAgaWYgKGRlZmluZWQodGhpcy5fcGlja0lkKSkge1xuICAgICAgICB0aGlzLl9waWNrSWQub2JqZWN0LmlkID0gdmFsdWU7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVGhlIHByaW1pdGl2ZSB0byByZXR1cm4gd2hlbiBwaWNraW5nIHRoaXMgYmlsbGJvYXJkLlxuICAgKiBAbWVtYmVyb2YgQmlsbGJvYXJkLnByb3RvdHlwZVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcGlja1ByaW1pdGl2ZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3BpY2tQcmltaXRpdmU7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5fcGlja1ByaW1pdGl2ZSA9IHZhbHVlO1xuICAgICAgaWYgKGRlZmluZWQodGhpcy5fcGlja0lkKSkge1xuICAgICAgICB0aGlzLl9waWNrSWQub2JqZWN0LnByaW1pdGl2ZSA9IHZhbHVlO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwaWNrSWQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9waWNrSWQ7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogPHA+XG4gICAqIEdldHMgb3Igc2V0cyB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhpcyBiaWxsYm9hcmQuICBJZiBhIHRleHR1cmUgaGFzIGFscmVhZHkgYmVlbiBjcmVhdGVkIGZvciB0aGVcbiAgICogZ2l2ZW4gaW1hZ2UsIHRoZSBleGlzdGluZyB0ZXh0dXJlIGlzIHVzZWQuXG4gICAqIDwvcD5cbiAgICogPHA+XG4gICAqIFRoaXMgcHJvcGVydHkgY2FuIGJlIHNldCB0byBhIGxvYWRlZCBJbWFnZSwgYSBVUkwgd2hpY2ggd2lsbCBiZSBsb2FkZWQgYXMgYW4gSW1hZ2UgYXV0b21hdGljYWxseSxcbiAgICogYSBjYW52YXMsIG9yIGFub3RoZXIgYmlsbGJvYXJkJ3MgaW1hZ2UgcHJvcGVydHkgKGZyb20gdGhlIHNhbWUgYmlsbGJvYXJkIGNvbGxlY3Rpb24pLlxuICAgKiA8L3A+XG4gICAqXG4gICAqIEBtZW1iZXJvZiBCaWxsYm9hcmQucHJvdG90eXBlXG4gICAqIEB0eXBlIHtTdHJpbmd9XG4gICAqIEBleGFtcGxlXG4gICAqIC8vIGxvYWQgYW4gaW1hZ2UgZnJvbSBhIFVSTFxuICAgKiBiLmltYWdlID0gJ3NvbWUvaW1hZ2UvdXJsLnBuZyc7XG4gICAqXG4gICAqIC8vIGFzc3VtaW5nIGIxIGFuZCBiMiBhcmUgYmlsbGJvYXJkcyBpbiB0aGUgc2FtZSBiaWxsYm9hcmQgY29sbGVjdGlvbixcbiAgICogLy8gdXNlIHRoZSBzYW1lIGltYWdlIGZvciBib3RoIGJpbGxib2FyZHMuXG4gICAqIGIyLmltYWdlID0gYjEuaW1hZ2U7XG4gICAqL1xuICBpbWFnZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlSWQ7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKCFkZWZpbmVkKHZhbHVlKSkge1xuICAgICAgICB0aGlzLl9pbWFnZUluZGV4ID0gLTE7XG4gICAgICAgIHRoaXMuX2ltYWdlU3ViUmVnaW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9pbWFnZUlkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9pbWFnZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5faW1hZ2VJbmRleFByb21pc2UgPSB1bmRlZmluZWQ7XG4gICAgICAgIG1ha2VEaXJ0eSh0aGlzLCBJTUFHRV9JTkRFWF9JTkRFWCk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0aGlzLnNldEltYWdlKHZhbHVlLCB2YWx1ZSk7XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVzb3VyY2UpIHtcbiAgICAgICAgdGhpcy5zZXRJbWFnZSh2YWx1ZS51cmwsIHZhbHVlKTtcbiAgICAgIH0gZWxzZSBpZiAoZGVmaW5lZCh2YWx1ZS5zcmMpKSB7XG4gICAgICAgIHRoaXMuc2V0SW1hZ2UodmFsdWUuc3JjLCB2YWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldEltYWdlKGNyZWF0ZUd1aWQoKSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFdoZW4gPGNvZGU+dHJ1ZTwvY29kZT4sIHRoaXMgYmlsbGJvYXJkIGlzIHJlYWR5IHRvIHJlbmRlciwgaS5lLiwgdGhlIGltYWdlXG4gICAqIGhhcyBiZWVuIGRvd25sb2FkZWQgYW5kIHRoZSBXZWJHTCByZXNvdXJjZXMgYXJlIGNyZWF0ZWQuXG4gICAqXG4gICAqIEBtZW1iZXJvZiBCaWxsYm9hcmQucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAcmVhZG9ubHlcbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHJlYWR5OiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5faW1hZ2VJbmRleCAhPT0gLTE7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogS2VlcHMgdHJhY2sgb2YgdGhlIHBvc2l0aW9uIG9mIHRoZSBiaWxsYm9hcmQgYmFzZWQgb24gdGhlIGhlaWdodCByZWZlcmVuY2UuXG4gICAqIEBtZW1iZXJvZiBCaWxsYm9hcmQucHJvdG90eXBlXG4gICAqIEB0eXBlIHtDYXJ0ZXNpYW4zfVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX2NsYW1wZWRQb3NpdGlvbjoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2FjdHVhbENsYW1wZWRQb3NpdGlvbjtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLl9hY3R1YWxDbGFtcGVkUG9zaXRpb24gPSBDYXJ0ZXNpYW4zLmNsb25lKFxuICAgICAgICB2YWx1ZSxcbiAgICAgICAgdGhpcy5fYWN0dWFsQ2xhbXBlZFBvc2l0aW9uXG4gICAgICApO1xuICAgICAgbWFrZURpcnR5KHRoaXMsIFBPU0lUSU9OX0lOREVYKTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRoaXMgYmlsbGJvYXJkIHdpbGwgYmUgc2hvd24gb3IgaGlkZGVuIGJlY2F1c2UgaXQgd2FzIGNsdXN0ZXJlZC5cbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZC5wcm90b3R5cGVcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBjbHVzdGVyU2hvdzoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NsdXN0ZXJTaG93O1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIGlmICh0aGlzLl9jbHVzdGVyU2hvdyAhPT0gdmFsdWUpIHtcbiAgICAgICAgdGhpcy5fY2x1c3RlclNob3cgPSB2YWx1ZTtcbiAgICAgICAgbWFrZURpcnR5KHRoaXMsIFNIT1dfSU5ERVgpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoZSBvdXRsaW5lIGNvbG9yIG9mIHRoaXMgQmlsbGJvYXJkLiAgRWZmZWN0aXZlIG9ubHkgZm9yIFNERiBiaWxsYm9hcmRzIGxpa2UgTGFiZWwgZ2x5cGhzLlxuICAgKiBAbWVtYmVyb2YgQmlsbGJvYXJkLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7Q29sb3J9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBvdXRsaW5lQ29sb3I6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9vdXRsaW5lQ29sb3I7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICAgIGlmICghZGVmaW5lZCh2YWx1ZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwidmFsdWUgaXMgcmVxdWlyZWQuXCIpO1xuICAgICAgfVxuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIHZhciBvdXRsaW5lQ29sb3IgPSB0aGlzLl9vdXRsaW5lQ29sb3I7XG4gICAgICBpZiAoIUNvbG9yLmVxdWFscyhvdXRsaW5lQ29sb3IsIHZhbHVlKSkge1xuICAgICAgICBDb2xvci5jbG9uZSh2YWx1ZSwgb3V0bGluZUNvbG9yKTtcbiAgICAgICAgbWFrZURpcnR5KHRoaXMsIFNERl9JTkRFWCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVGhlIG91dGxpbmUgd2lkdGggb2YgdGhpcyBCaWxsYm9hcmQgaW4gcGl4ZWxzLiAgRWZmZWN0aXZlIG9ubHkgZm9yIFNERiBiaWxsYm9hcmRzIGxpa2UgTGFiZWwgZ2x5cGhzLlxuICAgKiBAbWVtYmVyb2YgQmlsbGJvYXJkLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgb3V0bGluZVdpZHRoOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fb3V0bGluZVdpZHRoO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIGlmICh0aGlzLl9vdXRsaW5lV2lkdGggIT09IHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX291dGxpbmVXaWR0aCA9IHZhbHVlO1xuICAgICAgICBtYWtlRGlydHkodGhpcywgU0RGX0lOREVYKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxufSk7XG5cbkJpbGxib2FyZC5wcm90b3R5cGUuZ2V0UGlja0lkID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgaWYgKCFkZWZpbmVkKHRoaXMuX3BpY2tJZCkpIHtcbiAgICB0aGlzLl9waWNrSWQgPSBjb250ZXh0LmNyZWF0ZVBpY2tJZCh7XG4gICAgICBwcmltaXRpdmU6IHRoaXMuX3BpY2tQcmltaXRpdmUsXG4gICAgICBjb2xsZWN0aW9uOiB0aGlzLl9jb2xsZWN0aW9uLFxuICAgICAgaWQ6IHRoaXMuX2lkLFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHRoaXMuX3BpY2tJZDtcbn07XG5cbkJpbGxib2FyZC5wcm90b3R5cGUuX3VwZGF0ZUNsYW1waW5nID0gZnVuY3Rpb24gKCkge1xuICBCaWxsYm9hcmQuX3VwZGF0ZUNsYW1waW5nKHRoaXMuX2JpbGxib2FyZENvbGxlY3Rpb24sIHRoaXMpO1xufTtcblxudmFyIHNjcmF0Y2hDYXJ0b2dyYXBoaWMgPSBuZXcgQ2FydG9ncmFwaGljKCk7XG52YXIgc2NyYXRjaFBvc2l0aW9uID0gbmV3IENhcnRlc2lhbjMoKTtcblxuQmlsbGJvYXJkLl91cGRhdGVDbGFtcGluZyA9IGZ1bmN0aW9uIChjb2xsZWN0aW9uLCBvd25lcikge1xuICB2YXIgc2NlbmUgPSBjb2xsZWN0aW9uLl9zY2VuZTtcbiAgaWYgKCFkZWZpbmVkKHNjZW5lKSB8fCAhZGVmaW5lZChzY2VuZS5nbG9iZSkpIHtcbiAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgIGlmIChvd25lci5faGVpZ2h0UmVmZXJlbmNlICE9PSBIZWlnaHRSZWZlcmVuY2UuTk9ORSkge1xuICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFxuICAgICAgICBcIkhlaWdodCByZWZlcmVuY2UgaXMgbm90IHN1cHBvcnRlZCB3aXRob3V0IGEgc2NlbmUgYW5kIGdsb2JlLlwiXG4gICAgICApO1xuICAgIH1cbiAgICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgZ2xvYmUgPSBzY2VuZS5nbG9iZTtcbiAgdmFyIGVsbGlwc29pZCA9IGdsb2JlLmVsbGlwc29pZDtcbiAgdmFyIHN1cmZhY2UgPSBnbG9iZS5fc3VyZmFjZTtcblxuICB2YXIgbW9kZSA9IHNjZW5lLmZyYW1lU3RhdGUubW9kZTtcblxuICB2YXIgbW9kZUNoYW5nZWQgPSBtb2RlICE9PSBvd25lci5fbW9kZTtcbiAgb3duZXIuX21vZGUgPSBtb2RlO1xuXG4gIGlmIChcbiAgICAob3duZXIuX2hlaWdodFJlZmVyZW5jZSA9PT0gSGVpZ2h0UmVmZXJlbmNlLk5PTkUgfHwgbW9kZUNoYW5nZWQpICYmXG4gICAgZGVmaW5lZChvd25lci5fcmVtb3ZlQ2FsbGJhY2tGdW5jKVxuICApIHtcbiAgICBvd25lci5fcmVtb3ZlQ2FsbGJhY2tGdW5jKCk7XG4gICAgb3duZXIuX3JlbW92ZUNhbGxiYWNrRnVuYyA9IHVuZGVmaW5lZDtcbiAgICBvd25lci5fY2xhbXBlZFBvc2l0aW9uID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKFxuICAgIG93bmVyLl9oZWlnaHRSZWZlcmVuY2UgPT09IEhlaWdodFJlZmVyZW5jZS5OT05FIHx8XG4gICAgIWRlZmluZWQob3duZXIuX3Bvc2l0aW9uKVxuICApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgcG9zaXRpb24gPSBlbGxpcHNvaWQuY2FydGVzaWFuVG9DYXJ0b2dyYXBoaWMob3duZXIuX3Bvc2l0aW9uKTtcbiAgaWYgKCFkZWZpbmVkKHBvc2l0aW9uKSkge1xuICAgIG93bmVyLl9hY3R1YWxDbGFtcGVkUG9zaXRpb24gPSB1bmRlZmluZWQ7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGRlZmluZWQob3duZXIuX3JlbW92ZUNhbGxiYWNrRnVuYykpIHtcbiAgICBvd25lci5fcmVtb3ZlQ2FsbGJhY2tGdW5jKCk7XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVGdW5jdGlvbihjbGFtcGVkUG9zaXRpb24pIHtcbiAgICBpZiAob3duZXIuX2hlaWdodFJlZmVyZW5jZSA9PT0gSGVpZ2h0UmVmZXJlbmNlLlJFTEFUSVZFX1RPX0dST1VORCkge1xuICAgICAgaWYgKG93bmVyLl9tb2RlID09PSBTY2VuZU1vZGUuU0NFTkUzRCkge1xuICAgICAgICB2YXIgY2xhbXBlZENhcnQgPSBlbGxpcHNvaWQuY2FydGVzaWFuVG9DYXJ0b2dyYXBoaWMoXG4gICAgICAgICAgY2xhbXBlZFBvc2l0aW9uLFxuICAgICAgICAgIHNjcmF0Y2hDYXJ0b2dyYXBoaWNcbiAgICAgICAgKTtcbiAgICAgICAgY2xhbXBlZENhcnQuaGVpZ2h0ICs9IHBvc2l0aW9uLmhlaWdodDtcbiAgICAgICAgZWxsaXBzb2lkLmNhcnRvZ3JhcGhpY1RvQ2FydGVzaWFuKGNsYW1wZWRDYXJ0LCBjbGFtcGVkUG9zaXRpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2xhbXBlZFBvc2l0aW9uLnggKz0gcG9zaXRpb24uaGVpZ2h0O1xuICAgICAgfVxuICAgIH1cbiAgICBvd25lci5fY2xhbXBlZFBvc2l0aW9uID0gQ2FydGVzaWFuMy5jbG9uZShcbiAgICAgIGNsYW1wZWRQb3NpdGlvbixcbiAgICAgIG93bmVyLl9jbGFtcGVkUG9zaXRpb25cbiAgICApO1xuICB9XG4gIG93bmVyLl9yZW1vdmVDYWxsYmFja0Z1bmMgPSBzdXJmYWNlLnVwZGF0ZUhlaWdodChwb3NpdGlvbiwgdXBkYXRlRnVuY3Rpb24pO1xuXG4gIENhcnRvZ3JhcGhpYy5jbG9uZShwb3NpdGlvbiwgc2NyYXRjaENhcnRvZ3JhcGhpYyk7XG4gIHZhciBoZWlnaHQgPSBnbG9iZS5nZXRIZWlnaHQocG9zaXRpb24pO1xuICBpZiAoZGVmaW5lZChoZWlnaHQpKSB7XG4gICAgc2NyYXRjaENhcnRvZ3JhcGhpYy5oZWlnaHQgPSBoZWlnaHQ7XG4gIH1cblxuICBlbGxpcHNvaWQuY2FydG9ncmFwaGljVG9DYXJ0ZXNpYW4oc2NyYXRjaENhcnRvZ3JhcGhpYywgc2NyYXRjaFBvc2l0aW9uKTtcblxuICB1cGRhdGVGdW5jdGlvbihzY3JhdGNoUG9zaXRpb24pO1xufTtcblxuQmlsbGJvYXJkLnByb3RvdHlwZS5fbG9hZEltYWdlID0gZnVuY3Rpb24gKCkge1xuICB2YXIgYXRsYXMgPSB0aGlzLl9iaWxsYm9hcmRDb2xsZWN0aW9uLl90ZXh0dXJlQXRsYXM7XG5cbiAgdmFyIGltYWdlSWQgPSB0aGlzLl9pbWFnZUlkO1xuICB2YXIgaW1hZ2UgPSB0aGlzLl9pbWFnZTtcbiAgdmFyIGltYWdlU3ViUmVnaW9uID0gdGhpcy5faW1hZ2VTdWJSZWdpb247XG4gIHZhciBpbWFnZUluZGV4UHJvbWlzZTtcblxuICBpZiAoZGVmaW5lZChpbWFnZSkpIHtcbiAgICBpbWFnZUluZGV4UHJvbWlzZSA9IGF0bGFzLmFkZEltYWdlKGltYWdlSWQsIGltYWdlKTtcbiAgfVxuICBpZiAoZGVmaW5lZChpbWFnZVN1YlJlZ2lvbikpIHtcbiAgICBpbWFnZUluZGV4UHJvbWlzZSA9IGF0bGFzLmFkZFN1YlJlZ2lvbihpbWFnZUlkLCBpbWFnZVN1YlJlZ2lvbik7XG4gIH1cblxuICB0aGlzLl9pbWFnZUluZGV4UHJvbWlzZSA9IGltYWdlSW5kZXhQcm9taXNlO1xuXG4gIGlmICghZGVmaW5lZChpbWFnZUluZGV4UHJvbWlzZSkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgdGhhdCA9IHRoaXM7XG4gIGltYWdlSW5kZXhQcm9taXNlXG4gICAgLnRoZW4oZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRoYXQuX2ltYWdlSWQgIT09IGltYWdlSWQgfHxcbiAgICAgICAgdGhhdC5faW1hZ2UgIT09IGltYWdlIHx8XG4gICAgICAgICFCb3VuZGluZ1JlY3RhbmdsZS5lcXVhbHModGhhdC5faW1hZ2VTdWJSZWdpb24sIGltYWdlU3ViUmVnaW9uKVxuICAgICAgKSB7XG4gICAgICAgIC8vIGFub3RoZXIgbG9hZCBvY2N1cnJlZCBiZWZvcmUgdGhpcyBvbmUgZmluaXNoZWQsIGlnbm9yZSB0aGUgaW5kZXhcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBmaWxsIGluIGltYWdlV2lkdGggYW5kIGltYWdlSGVpZ2h0XG4gICAgICB2YXIgdGV4dHVyZUNvb3JkaW5hdGVzID0gYXRsYXMudGV4dHVyZUNvb3JkaW5hdGVzW2luZGV4XTtcbiAgICAgIHRoYXQuX2ltYWdlV2lkdGggPSBhdGxhcy50ZXh0dXJlLndpZHRoICogdGV4dHVyZUNvb3JkaW5hdGVzLndpZHRoO1xuICAgICAgdGhhdC5faW1hZ2VIZWlnaHQgPSBhdGxhcy50ZXh0dXJlLmhlaWdodCAqIHRleHR1cmVDb29yZGluYXRlcy5oZWlnaHQ7XG5cbiAgICAgIHRoYXQuX2ltYWdlSW5kZXggPSBpbmRleDtcbiAgICAgIHRoYXQuX3JlYWR5ID0gdHJ1ZTtcbiAgICAgIHRoYXQuX2ltYWdlID0gdW5kZWZpbmVkO1xuICAgICAgdGhhdC5faW1hZ2VJbmRleFByb21pc2UgPSB1bmRlZmluZWQ7XG4gICAgICBtYWtlRGlydHkodGhhdCwgSU1BR0VfSU5ERVhfSU5ERVgpO1xuICAgIH0pXG4gICAgLm90aGVyd2lzZShmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBsb2FkaW5nIGltYWdlIGZvciBiaWxsYm9hcmQ6IFwiICsgZXJyb3IpO1xuICAgICAgdGhhdC5faW1hZ2VJbmRleFByb21pc2UgPSB1bmRlZmluZWQ7XG4gICAgfSk7XG59O1xuXG4vKipcbiAqIDxwPlxuICogU2V0cyB0aGUgaW1hZ2UgdG8gYmUgdXNlZCBmb3IgdGhpcyBiaWxsYm9hcmQuICBJZiBhIHRleHR1cmUgaGFzIGFscmVhZHkgYmVlbiBjcmVhdGVkIGZvciB0aGVcbiAqIGdpdmVuIGlkLCB0aGUgZXhpc3RpbmcgdGV4dHVyZSBpcyB1c2VkLlxuICogPC9wPlxuICogPHA+XG4gKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWZ1bCBmb3IgZHluYW1pY2FsbHkgY3JlYXRpbmcgdGV4dHVyZXMgdGhhdCBhcmUgc2hhcmVkIGFjcm9zcyBtYW55IGJpbGxib2FyZHMuXG4gKiBPbmx5IHRoZSBmaXJzdCBiaWxsYm9hcmQgd2lsbCBhY3R1YWxseSBjYWxsIHRoZSBmdW5jdGlvbiBhbmQgY3JlYXRlIHRoZSB0ZXh0dXJlLCB3aGlsZSBzdWJzZXF1ZW50XG4gKiBiaWxsYm9hcmRzIGNyZWF0ZWQgd2l0aCB0aGUgc2FtZSBpZCB3aWxsIHNpbXBseSByZS11c2UgdGhlIGV4aXN0aW5nIHRleHR1cmUuXG4gKiA8L3A+XG4gKiA8cD5cbiAqIFRvIGxvYWQgYW4gaW1hZ2UgZnJvbSBhIFVSTCwgc2V0dGluZyB0aGUge0BsaW5rIEJpbGxib2FyZCNpbWFnZX0gcHJvcGVydHkgaXMgbW9yZSBjb252ZW5pZW50LlxuICogPC9wPlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBpZCBUaGUgaWQgb2YgdGhlIGltYWdlLiAgVGhpcyBjYW4gYmUgYW55IHN0cmluZyB0aGF0IHVuaXF1ZWx5IGlkZW50aWZpZXMgdGhlIGltYWdlLlxuICogQHBhcmFtIHtIVE1MSW1hZ2VFbGVtZW50fEhUTUxDYW52YXNFbGVtZW50fFN0cmluZ3xSZXNvdXJjZXxCaWxsYm9hcmQuQ3JlYXRlSW1hZ2VDYWxsYmFja30gaW1hZ2UgVGhlIGltYWdlIHRvIGxvYWQuICBUaGlzIHBhcmFtZXRlclxuICogICAgICAgIGNhbiBlaXRoZXIgYmUgYSBsb2FkZWQgSW1hZ2Ugb3IgQ2FudmFzLCBhIFVSTCB3aGljaCB3aWxsIGJlIGxvYWRlZCBhcyBhbiBJbWFnZSBhdXRvbWF0aWNhbGx5LFxuICogICAgICAgIG9yIGEgZnVuY3Rpb24gd2hpY2ggd2lsbCBiZSBjYWxsZWQgdG8gY3JlYXRlIHRoZSBpbWFnZSBpZiBpdCBoYXNuJ3QgYmVlbiBsb2FkZWQgYWxyZWFkeS5cbiAqIEBleGFtcGxlXG4gKiAvLyBjcmVhdGUgYSBiaWxsYm9hcmQgaW1hZ2UgZHluYW1pY2FsbHlcbiAqIGZ1bmN0aW9uIGRyYXdJbWFnZShpZCkge1xuICogICAvLyBjcmVhdGUgYW5kIGRyYXcgYW4gaW1hZ2UgdXNpbmcgYSBjYW52YXNcbiAqICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICogICB2YXIgY29udGV4dDJEID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gKiAgIC8vIC4uLiBkcmF3IGltYWdlXG4gKiAgIHJldHVybiBjYW52YXM7XG4gKiB9XG4gKiAvLyBkcmF3SW1hZ2Ugd2lsbCBiZSBjYWxsZWQgdG8gY3JlYXRlIHRoZSB0ZXh0dXJlXG4gKiBiLnNldEltYWdlKCdteUltYWdlJywgZHJhd0ltYWdlKTtcbiAqXG4gKiAvLyBzdWJzZXF1ZW50IGJpbGxib2FyZHMgY3JlYXRlZCBpbiB0aGUgc2FtZSBjb2xsZWN0aW9uIHVzaW5nIHRoZSBzYW1lIGlkIHdpbGwgdXNlIHRoZSBleGlzdGluZ1xuICogLy8gdGV4dHVyZSwgd2l0aG91dCB0aGUgbmVlZCB0byBjcmVhdGUgdGhlIGNhbnZhcyBvciBkcmF3IHRoZSBpbWFnZVxuICogYjIuc2V0SW1hZ2UoJ215SW1hZ2UnLCBkcmF3SW1hZ2UpO1xuICovXG5CaWxsYm9hcmQucHJvdG90eXBlLnNldEltYWdlID0gZnVuY3Rpb24gKGlkLCBpbWFnZSkge1xuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBpZiAoIWRlZmluZWQoaWQpKSB7XG4gICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwiaWQgaXMgcmVxdWlyZWQuXCIpO1xuICB9XG4gIGlmICghZGVmaW5lZChpbWFnZSkpIHtcbiAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXCJpbWFnZSBpcyByZXF1aXJlZC5cIik7XG4gIH1cbiAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgaWYgKHRoaXMuX2ltYWdlSWQgPT09IGlkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy5faW1hZ2VJbmRleCA9IC0xO1xuICB0aGlzLl9pbWFnZVN1YlJlZ2lvbiA9IHVuZGVmaW5lZDtcbiAgdGhpcy5faW1hZ2VJZCA9IGlkO1xuICB0aGlzLl9pbWFnZSA9IGltYWdlO1xuXG4gIGlmIChkZWZpbmVkKHRoaXMuX2JpbGxib2FyZENvbGxlY3Rpb24uX3RleHR1cmVBdGxhcykpIHtcbiAgICB0aGlzLl9sb2FkSW1hZ2UoKTtcbiAgfVxufTtcblxuLyoqXG4gKiBVc2VzIGEgc3ViLXJlZ2lvbiBvZiB0aGUgaW1hZ2Ugd2l0aCB0aGUgZ2l2ZW4gaWQgYXMgdGhlIGltYWdlIGZvciB0aGlzIGJpbGxib2FyZCxcbiAqIG1lYXN1cmVkIGluIHBpeGVscyBmcm9tIHRoZSBib3R0b20tbGVmdC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gaWQgVGhlIGlkIG9mIHRoZSBpbWFnZSB0byB1c2UuXG4gKiBAcGFyYW0ge0JvdW5kaW5nUmVjdGFuZ2xlfSBzdWJSZWdpb24gVGhlIHN1Yi1yZWdpb24gb2YgdGhlIGltYWdlLlxuICpcbiAqIEBleGNlcHRpb24ge1J1bnRpbWVFcnJvcn0gaW1hZ2Ugd2l0aCBpZCBtdXN0IGJlIGluIHRoZSBhdGxhc1xuICovXG5CaWxsYm9hcmQucHJvdG90eXBlLnNldEltYWdlU3ViUmVnaW9uID0gZnVuY3Rpb24gKGlkLCBzdWJSZWdpb24pIHtcbiAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgaWYgKCFkZWZpbmVkKGlkKSkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcImlkIGlzIHJlcXVpcmVkLlwiKTtcbiAgfVxuICBpZiAoIWRlZmluZWQoc3ViUmVnaW9uKSkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcInN1YlJlZ2lvbiBpcyByZXF1aXJlZC5cIik7XG4gIH1cbiAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgaWYgKFxuICAgIHRoaXMuX2ltYWdlSWQgPT09IGlkICYmXG4gICAgQm91bmRpbmdSZWN0YW5nbGUuZXF1YWxzKHRoaXMuX2ltYWdlU3ViUmVnaW9uLCBzdWJSZWdpb24pXG4gICkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuX2ltYWdlSW5kZXggPSAtMTtcbiAgdGhpcy5faW1hZ2VJZCA9IGlkO1xuICB0aGlzLl9pbWFnZVN1YlJlZ2lvbiA9IEJvdW5kaW5nUmVjdGFuZ2xlLmNsb25lKHN1YlJlZ2lvbik7XG5cbiAgaWYgKGRlZmluZWQodGhpcy5fYmlsbGJvYXJkQ29sbGVjdGlvbi5fdGV4dHVyZUF0bGFzKSkge1xuICAgIHRoaXMuX2xvYWRJbWFnZSgpO1xuICB9XG59O1xuXG5CaWxsYm9hcmQucHJvdG90eXBlLl9zZXRUcmFuc2xhdGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgaWYgKCFkZWZpbmVkKHZhbHVlKSkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcInZhbHVlIGlzIHJlcXVpcmVkLlwiKTtcbiAgfVxuICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICB2YXIgdHJhbnNsYXRlID0gdGhpcy5fdHJhbnNsYXRlO1xuICBpZiAoIUNhcnRlc2lhbjIuZXF1YWxzKHRyYW5zbGF0ZSwgdmFsdWUpKSB7XG4gICAgQ2FydGVzaWFuMi5jbG9uZSh2YWx1ZSwgdHJhbnNsYXRlKTtcbiAgICBtYWtlRGlydHkodGhpcywgUElYRUxfT0ZGU0VUX0lOREVYKTtcbiAgfVxufTtcblxuQmlsbGJvYXJkLnByb3RvdHlwZS5fZ2V0QWN0dWFsUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBkZWZpbmVkKHRoaXMuX2NsYW1wZWRQb3NpdGlvbilcbiAgICA/IHRoaXMuX2NsYW1wZWRQb3NpdGlvblxuICAgIDogdGhpcy5fYWN0dWFsUG9zaXRpb247XG59O1xuXG5CaWxsYm9hcmQucHJvdG90eXBlLl9zZXRBY3R1YWxQb3NpdGlvbiA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICBpZiAoIWRlZmluZWQodGhpcy5fY2xhbXBlZFBvc2l0aW9uKSkge1xuICAgIENhcnRlc2lhbjMuY2xvbmUodmFsdWUsIHRoaXMuX2FjdHVhbFBvc2l0aW9uKTtcbiAgfVxuICBtYWtlRGlydHkodGhpcywgUE9TSVRJT05fSU5ERVgpO1xufTtcblxudmFyIHRlbXBDYXJ0ZXNpYW4zID0gbmV3IENhcnRlc2lhbjQoKTtcbkJpbGxib2FyZC5fY29tcHV0ZUFjdHVhbFBvc2l0aW9uID0gZnVuY3Rpb24gKFxuICBiaWxsYm9hcmQsXG4gIHBvc2l0aW9uLFxuICBmcmFtZVN0YXRlLFxuICBtb2RlbE1hdHJpeFxuKSB7XG4gIGlmIChkZWZpbmVkKGJpbGxib2FyZC5fY2xhbXBlZFBvc2l0aW9uKSkge1xuICAgIGlmIChmcmFtZVN0YXRlLm1vZGUgIT09IGJpbGxib2FyZC5fbW9kZSkge1xuICAgICAgYmlsbGJvYXJkLl91cGRhdGVDbGFtcGluZygpO1xuICAgIH1cbiAgICByZXR1cm4gYmlsbGJvYXJkLl9jbGFtcGVkUG9zaXRpb247XG4gIH0gZWxzZSBpZiAoZnJhbWVTdGF0ZS5tb2RlID09PSBTY2VuZU1vZGUuU0NFTkUzRCkge1xuICAgIHJldHVybiBwb3NpdGlvbjtcbiAgfVxuXG4gIE1hdHJpeDQubXVsdGlwbHlCeVBvaW50KG1vZGVsTWF0cml4LCBwb3NpdGlvbiwgdGVtcENhcnRlc2lhbjMpO1xuICByZXR1cm4gU2NlbmVUcmFuc2Zvcm1zLmNvbXB1dGVBY3R1YWxXZ3M4NFBvc2l0aW9uKGZyYW1lU3RhdGUsIHRlbXBDYXJ0ZXNpYW4zKTtcbn07XG5cbnZhciBzY3JhdGNoQ2FydGVzaWFuMyA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG5cbi8vIFRoaXMgZnVuY3Rpb24gaXMgYmFzaWNhbGx5IGEgc3RyaXBwZWQtZG93biBKYXZhU2NyaXB0IHZlcnNpb24gb2YgQmlsbGJvYXJkQ29sbGVjdGlvblZTLmdsc2xcbkJpbGxib2FyZC5fY29tcHV0ZVNjcmVlblNwYWNlUG9zaXRpb24gPSBmdW5jdGlvbiAoXG4gIG1vZGVsTWF0cml4LFxuICBwb3NpdGlvbixcbiAgZXllT2Zmc2V0LFxuICBwaXhlbE9mZnNldCxcbiAgc2NlbmUsXG4gIHJlc3VsdFxuKSB7XG4gIC8vIE1vZGVsIHRvIHdvcmxkIGNvb3JkaW5hdGVzXG4gIHZhciBwb3NpdGlvbldvcmxkID0gTWF0cml4NC5tdWx0aXBseUJ5UG9pbnQoXG4gICAgbW9kZWxNYXRyaXgsXG4gICAgcG9zaXRpb24sXG4gICAgc2NyYXRjaENhcnRlc2lhbjNcbiAgKTtcblxuICAvLyBXb3JsZCB0byB3aW5kb3cgY29vcmRpbmF0ZXNcbiAgdmFyIHBvc2l0aW9uV0MgPSBTY2VuZVRyYW5zZm9ybXMud2dzODRXaXRoRXllT2Zmc2V0VG9XaW5kb3dDb29yZGluYXRlcyhcbiAgICBzY2VuZSxcbiAgICBwb3NpdGlvbldvcmxkLFxuICAgIGV5ZU9mZnNldCxcbiAgICByZXN1bHRcbiAgKTtcbiAgaWYgKCFkZWZpbmVkKHBvc2l0aW9uV0MpKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIC8vIEFwcGx5IHBpeGVsIG9mZnNldFxuICBDYXJ0ZXNpYW4yLmFkZChwb3NpdGlvbldDLCBwaXhlbE9mZnNldCwgcG9zaXRpb25XQyk7XG5cbiAgcmV0dXJuIHBvc2l0aW9uV0M7XG59O1xuXG52YXIgc2NyYXRjaFBpeGVsT2Zmc2V0ID0gbmV3IENhcnRlc2lhbjIoMC4wLCAwLjApO1xuXG4vKipcbiAqIENvbXB1dGVzIHRoZSBzY3JlZW4tc3BhY2UgcG9zaXRpb24gb2YgdGhlIGJpbGxib2FyZCdzIG9yaWdpbiwgdGFraW5nIGludG8gYWNjb3VudCBleWUgYW5kIHBpeGVsIG9mZnNldHMuXG4gKiBUaGUgc2NyZWVuIHNwYWNlIG9yaWdpbiBpcyB0aGUgdG9wLCBsZWZ0IGNvcm5lciBvZiB0aGUgY2FudmFzOyA8Y29kZT54PC9jb2RlPiBpbmNyZWFzZXMgZnJvbVxuICogbGVmdCB0byByaWdodCwgYW5kIDxjb2RlPnk8L2NvZGU+IGluY3JlYXNlcyBmcm9tIHRvcCB0byBib3R0b20uXG4gKlxuICogQHBhcmFtIHtTY2VuZX0gc2NlbmUgVGhlIHNjZW5lLlxuICogQHBhcmFtIHtDYXJ0ZXNpYW4yfSBbcmVzdWx0XSBUaGUgb2JqZWN0IG9udG8gd2hpY2ggdG8gc3RvcmUgdGhlIHJlc3VsdC5cbiAqIEByZXR1cm5zIHtDYXJ0ZXNpYW4yfSBUaGUgc2NyZWVuLXNwYWNlIHBvc2l0aW9uIG9mIHRoZSBiaWxsYm9hcmQuXG4gKlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IEJpbGxib2FyZCBtdXN0IGJlIGluIGEgY29sbGVjdGlvbi5cbiAqXG4gKiBAZXhhbXBsZVxuICogY29uc29sZS5sb2coYi5jb21wdXRlU2NyZWVuU3BhY2VQb3NpdGlvbihzY2VuZSkudG9TdHJpbmcoKSk7XG4gKlxuICogQHNlZSBCaWxsYm9hcmQjZXllT2Zmc2V0XG4gKiBAc2VlIEJpbGxib2FyZCNwaXhlbE9mZnNldFxuICovXG5CaWxsYm9hcmQucHJvdG90eXBlLmNvbXB1dGVTY3JlZW5TcGFjZVBvc2l0aW9uID0gZnVuY3Rpb24gKHNjZW5lLCByZXN1bHQpIHtcbiAgdmFyIGJpbGxib2FyZENvbGxlY3Rpb24gPSB0aGlzLl9iaWxsYm9hcmRDb2xsZWN0aW9uO1xuICBpZiAoIWRlZmluZWQocmVzdWx0KSkge1xuICAgIHJlc3VsdCA9IG5ldyBDYXJ0ZXNpYW4yKCk7XG4gIH1cblxuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBpZiAoIWRlZmluZWQoYmlsbGJvYXJkQ29sbGVjdGlvbikpIHtcbiAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXG4gICAgICBcIkJpbGxib2FyZCBtdXN0IGJlIGluIGEgY29sbGVjdGlvbi4gIFdhcyBpdCByZW1vdmVkP1wiXG4gICAgKTtcbiAgfVxuICBpZiAoIWRlZmluZWQoc2NlbmUpKSB7XG4gICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwic2NlbmUgaXMgcmVxdWlyZWQuXCIpO1xuICB9XG4gIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gIC8vIHBpeGVsIG9mZnNldCBmb3Igc2NyZWVuIHNwYWNlIGNvbXB1dGF0aW9uIGlzIHRoZSBwaXhlbE9mZnNldCArIHNjcmVlbiBzcGFjZSB0cmFuc2xhdGVcbiAgQ2FydGVzaWFuMi5jbG9uZSh0aGlzLl9waXhlbE9mZnNldCwgc2NyYXRjaFBpeGVsT2Zmc2V0KTtcbiAgQ2FydGVzaWFuMi5hZGQoc2NyYXRjaFBpeGVsT2Zmc2V0LCB0aGlzLl90cmFuc2xhdGUsIHNjcmF0Y2hQaXhlbE9mZnNldCk7XG5cbiAgdmFyIG1vZGVsTWF0cml4ID0gYmlsbGJvYXJkQ29sbGVjdGlvbi5tb2RlbE1hdHJpeDtcbiAgdmFyIHBvc2l0aW9uID0gdGhpcy5fcG9zaXRpb247XG4gIGlmIChkZWZpbmVkKHRoaXMuX2NsYW1wZWRQb3NpdGlvbikpIHtcbiAgICBwb3NpdGlvbiA9IHRoaXMuX2NsYW1wZWRQb3NpdGlvbjtcbiAgICBpZiAoc2NlbmUubW9kZSAhPT0gU2NlbmVNb2RlLlNDRU5FM0QpIHtcbiAgICAgIC8vIHBvc2l0aW9uIG5lZWRzIHRvIGJlIGluIHdvcmxkIGNvb3JkaW5hdGVzXG4gICAgICB2YXIgcHJvamVjdGlvbiA9IHNjZW5lLm1hcFByb2plY3Rpb247XG4gICAgICB2YXIgZWxsaXBzb2lkID0gcHJvamVjdGlvbi5lbGxpcHNvaWQ7XG4gICAgICB2YXIgY2FydCA9IHByb2plY3Rpb24udW5wcm9qZWN0KHBvc2l0aW9uLCBzY3JhdGNoQ2FydG9ncmFwaGljKTtcbiAgICAgIHBvc2l0aW9uID0gZWxsaXBzb2lkLmNhcnRvZ3JhcGhpY1RvQ2FydGVzaWFuKGNhcnQsIHNjcmF0Y2hDYXJ0ZXNpYW4zKTtcbiAgICAgIG1vZGVsTWF0cml4ID0gTWF0cml4NC5JREVOVElUWTtcbiAgICB9XG4gIH1cblxuICB2YXIgd2luZG93Q29vcmRpbmF0ZXMgPSBCaWxsYm9hcmQuX2NvbXB1dGVTY3JlZW5TcGFjZVBvc2l0aW9uKFxuICAgIG1vZGVsTWF0cml4LFxuICAgIHBvc2l0aW9uLFxuICAgIHRoaXMuX2V5ZU9mZnNldCxcbiAgICBzY3JhdGNoUGl4ZWxPZmZzZXQsXG4gICAgc2NlbmUsXG4gICAgcmVzdWx0XG4gICk7XG4gIHJldHVybiB3aW5kb3dDb29yZGluYXRlcztcbn07XG5cbi8qKlxuICogR2V0cyBhIGJpbGxib2FyZCdzIHNjcmVlbiBzcGFjZSBib3VuZGluZyBib3ggY2VudGVyZWQgYXJvdW5kIHNjcmVlblNwYWNlUG9zaXRpb24uXG4gKiBAcGFyYW0ge0JpbGxib2FyZH0gYmlsbGJvYXJkIFRoZSBiaWxsYm9hcmQgdG8gZ2V0IHRoZSBzY3JlZW4gc3BhY2UgYm91bmRpbmcgYm94IGZvci5cbiAqIEBwYXJhbSB7Q2FydGVzaWFuMn0gc2NyZWVuU3BhY2VQb3NpdGlvbiBUaGUgc2NyZWVuIHNwYWNlIGNlbnRlciBvZiB0aGUgbGFiZWwuXG4gKiBAcGFyYW0ge0JvdW5kaW5nUmVjdGFuZ2xlfSBbcmVzdWx0XSBUaGUgb2JqZWN0IG9udG8gd2hpY2ggdG8gc3RvcmUgdGhlIHJlc3VsdC5cbiAqIEByZXR1cm5zIHtCb3VuZGluZ1JlY3RhbmdsZX0gVGhlIHNjcmVlbiBzcGFjZSBib3VuZGluZyBib3guXG4gKlxuICogQHByaXZhdGVcbiAqL1xuQmlsbGJvYXJkLmdldFNjcmVlblNwYWNlQm91bmRpbmdCb3ggPSBmdW5jdGlvbiAoXG4gIGJpbGxib2FyZCxcbiAgc2NyZWVuU3BhY2VQb3NpdGlvbixcbiAgcmVzdWx0XG4pIHtcbiAgdmFyIHdpZHRoID0gYmlsbGJvYXJkLndpZHRoO1xuICB2YXIgaGVpZ2h0ID0gYmlsbGJvYXJkLmhlaWdodDtcblxuICB2YXIgc2NhbGUgPSBiaWxsYm9hcmQuc2NhbGU7XG4gIHdpZHRoICo9IHNjYWxlO1xuICBoZWlnaHQgKj0gc2NhbGU7XG5cbiAgdmFyIHggPSBzY3JlZW5TcGFjZVBvc2l0aW9uLng7XG4gIGlmIChiaWxsYm9hcmQuaG9yaXpvbnRhbE9yaWdpbiA9PT0gSG9yaXpvbnRhbE9yaWdpbi5SSUdIVCkge1xuICAgIHggLT0gd2lkdGg7XG4gIH0gZWxzZSBpZiAoYmlsbGJvYXJkLmhvcml6b250YWxPcmlnaW4gPT09IEhvcml6b250YWxPcmlnaW4uQ0VOVEVSKSB7XG4gICAgeCAtPSB3aWR0aCAqIDAuNTtcbiAgfVxuXG4gIHZhciB5ID0gc2NyZWVuU3BhY2VQb3NpdGlvbi55O1xuICBpZiAoXG4gICAgYmlsbGJvYXJkLnZlcnRpY2FsT3JpZ2luID09PSBWZXJ0aWNhbE9yaWdpbi5CT1RUT00gfHxcbiAgICBiaWxsYm9hcmQudmVydGljYWxPcmlnaW4gPT09IFZlcnRpY2FsT3JpZ2luLkJBU0VMSU5FXG4gICkge1xuICAgIHkgLT0gaGVpZ2h0O1xuICB9IGVsc2UgaWYgKGJpbGxib2FyZC52ZXJ0aWNhbE9yaWdpbiA9PT0gVmVydGljYWxPcmlnaW4uQ0VOVEVSKSB7XG4gICAgeSAtPSBoZWlnaHQgKiAwLjU7XG4gIH1cblxuICBpZiAoIWRlZmluZWQocmVzdWx0KSkge1xuICAgIHJlc3VsdCA9IG5ldyBCb3VuZGluZ1JlY3RhbmdsZSgpO1xuICB9XG5cbiAgcmVzdWx0LnggPSB4O1xuICByZXN1bHQueSA9IHk7XG4gIHJlc3VsdC53aWR0aCA9IHdpZHRoO1xuICByZXN1bHQuaGVpZ2h0ID0gaGVpZ2h0O1xuXG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG4vKipcbiAqIERldGVybWluZXMgaWYgdGhpcyBiaWxsYm9hcmQgZXF1YWxzIGFub3RoZXIgYmlsbGJvYXJkLiAgQmlsbGJvYXJkcyBhcmUgZXF1YWwgaWYgYWxsIHRoZWlyIHByb3BlcnRpZXNcbiAqIGFyZSBlcXVhbC4gIEJpbGxib2FyZHMgaW4gZGlmZmVyZW50IGNvbGxlY3Rpb25zIGNhbiBiZSBlcXVhbC5cbiAqXG4gKiBAcGFyYW0ge0JpbGxib2FyZH0gb3RoZXIgVGhlIGJpbGxib2FyZCB0byBjb21wYXJlIGZvciBlcXVhbGl0eS5cbiAqIEByZXR1cm5zIHtCb29sZWFufSA8Y29kZT50cnVlPC9jb2RlPiBpZiB0aGUgYmlsbGJvYXJkcyBhcmUgZXF1YWw7IG90aGVyd2lzZSwgPGNvZGU+ZmFsc2U8L2NvZGU+LlxuICovXG5CaWxsYm9hcmQucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvdGhlcikge1xuICByZXR1cm4gKFxuICAgIHRoaXMgPT09IG90aGVyIHx8XG4gICAgKGRlZmluZWQob3RoZXIpICYmXG4gICAgICB0aGlzLl9pZCA9PT0gb3RoZXIuX2lkICYmXG4gICAgICBDYXJ0ZXNpYW4zLmVxdWFscyh0aGlzLl9wb3NpdGlvbiwgb3RoZXIuX3Bvc2l0aW9uKSAmJlxuICAgICAgdGhpcy5faW1hZ2VJZCA9PT0gb3RoZXIuX2ltYWdlSWQgJiZcbiAgICAgIHRoaXMuX3Nob3cgPT09IG90aGVyLl9zaG93ICYmXG4gICAgICB0aGlzLl9zY2FsZSA9PT0gb3RoZXIuX3NjYWxlICYmXG4gICAgICB0aGlzLl92ZXJ0aWNhbE9yaWdpbiA9PT0gb3RoZXIuX3ZlcnRpY2FsT3JpZ2luICYmXG4gICAgICB0aGlzLl9ob3Jpem9udGFsT3JpZ2luID09PSBvdGhlci5faG9yaXpvbnRhbE9yaWdpbiAmJlxuICAgICAgdGhpcy5faGVpZ2h0UmVmZXJlbmNlID09PSBvdGhlci5faGVpZ2h0UmVmZXJlbmNlICYmXG4gICAgICBCb3VuZGluZ1JlY3RhbmdsZS5lcXVhbHModGhpcy5faW1hZ2VTdWJSZWdpb24sIG90aGVyLl9pbWFnZVN1YlJlZ2lvbikgJiZcbiAgICAgIENvbG9yLmVxdWFscyh0aGlzLl9jb2xvciwgb3RoZXIuX2NvbG9yKSAmJlxuICAgICAgQ2FydGVzaWFuMi5lcXVhbHModGhpcy5fcGl4ZWxPZmZzZXQsIG90aGVyLl9waXhlbE9mZnNldCkgJiZcbiAgICAgIENhcnRlc2lhbjIuZXF1YWxzKHRoaXMuX3RyYW5zbGF0ZSwgb3RoZXIuX3RyYW5zbGF0ZSkgJiZcbiAgICAgIENhcnRlc2lhbjMuZXF1YWxzKHRoaXMuX2V5ZU9mZnNldCwgb3RoZXIuX2V5ZU9mZnNldCkgJiZcbiAgICAgIE5lYXJGYXJTY2FsYXIuZXF1YWxzKHRoaXMuX3NjYWxlQnlEaXN0YW5jZSwgb3RoZXIuX3NjYWxlQnlEaXN0YW5jZSkgJiZcbiAgICAgIE5lYXJGYXJTY2FsYXIuZXF1YWxzKFxuICAgICAgICB0aGlzLl90cmFuc2x1Y2VuY3lCeURpc3RhbmNlLFxuICAgICAgICBvdGhlci5fdHJhbnNsdWNlbmN5QnlEaXN0YW5jZVxuICAgICAgKSAmJlxuICAgICAgTmVhckZhclNjYWxhci5lcXVhbHMoXG4gICAgICAgIHRoaXMuX3BpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlLFxuICAgICAgICBvdGhlci5fcGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2VcbiAgICAgICkgJiZcbiAgICAgIERpc3RhbmNlRGlzcGxheUNvbmRpdGlvbi5lcXVhbHMoXG4gICAgICAgIHRoaXMuX2Rpc3RhbmNlRGlzcGxheUNvbmRpdGlvbixcbiAgICAgICAgb3RoZXIuX2Rpc3RhbmNlRGlzcGxheUNvbmRpdGlvblxuICAgICAgKSAmJlxuICAgICAgdGhpcy5fZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlID09PSBvdGhlci5fZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlKVxuICApO1xufTtcblxuQmlsbGJvYXJkLnByb3RvdHlwZS5fZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKGRlZmluZWQodGhpcy5fY3VzdG9tRGF0YSkpIHtcbiAgICB0aGlzLl9iaWxsYm9hcmRDb2xsZWN0aW9uLl9zY2VuZS5nbG9iZS5fc3VyZmFjZS5yZW1vdmVUaWxlQ3VzdG9tRGF0YShcbiAgICAgIHRoaXMuX2N1c3RvbURhdGFcbiAgICApO1xuICAgIHRoaXMuX2N1c3RvbURhdGEgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBpZiAoZGVmaW5lZCh0aGlzLl9yZW1vdmVDYWxsYmFja0Z1bmMpKSB7XG4gICAgdGhpcy5fcmVtb3ZlQ2FsbGJhY2tGdW5jKCk7XG4gICAgdGhpcy5fcmVtb3ZlQ2FsbGJhY2tGdW5jID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgdGhpcy5pbWFnZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fcGlja0lkID0gdGhpcy5fcGlja0lkICYmIHRoaXMuX3BpY2tJZC5kZXN0cm95KCk7XG4gIHRoaXMuX2JpbGxib2FyZENvbGxlY3Rpb24gPSB1bmRlZmluZWQ7XG59O1xuXG4vKipcbiAqIEEgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGFuIGltYWdlLlxuICogQGNhbGxiYWNrIEJpbGxib2FyZC5DcmVhdGVJbWFnZUNhbGxiYWNrXG4gKiBAcGFyYW0ge1N0cmluZ30gaWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGltYWdlIHRvIGxvYWQuXG4gKiBAcmV0dXJucyB7SFRNTEltYWdlRWxlbWVudHxIVE1MQ2FudmFzRWxlbWVudHxQcm9taXNlPEhUTUxJbWFnZUVsZW1lbnR8SFRNTENhbnZhc0VsZW1lbnQ+fSBUaGUgaW1hZ2UsIG9yIGEgcHJvbWlzZSB0aGF0IHdpbGwgcmVzb2x2ZSB0byBhbiBpbWFnZS5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgQmlsbGJvYXJkO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///80349\n')},8044:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_AttributeCompression_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(52323);\n/* harmony import */ var _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(48243);\n/* harmony import */ var _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(60838);\n/* harmony import */ var _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(60216);\n/* harmony import */ var _Core_Check_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(66553);\n/* harmony import */ var _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(59947);\n/* harmony import */ var _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(84828);\n/* harmony import */ var _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(62200);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(82982);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(86511);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(12572);\n/* harmony import */ var _Core_EncodedCartesian3_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(74938);\n/* harmony import */ var _Core_IndexDatatype_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(22832);\n/* harmony import */ var _Core_Math_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(99417);\n/* harmony import */ var _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(72248);\n/* harmony import */ var _Core_WebGLConstants_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(52200);\n/* harmony import */ var _Renderer_Buffer_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(99095);\n/* harmony import */ var _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(58597);\n/* harmony import */ var _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(20521);\n/* harmony import */ var _Renderer_DrawCommand_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(60072);\n/* harmony import */ var _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(8379);\n/* harmony import */ var _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(10667);\n/* harmony import */ var _Renderer_ShaderProgram_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(46588);\n/* harmony import */ var _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(53642);\n/* harmony import */ var _Renderer_VertexArrayFacade_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(52851);\n/* harmony import */ var _Shaders_BillboardCollectionFS_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(39111);\n/* harmony import */ var _Shaders_BillboardCollectionVS_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(64059);\n/* harmony import */ var _Billboard_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(80349);\n/* harmony import */ var _BlendingState_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(13633);\n/* harmony import */ var _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(27384);\n/* harmony import */ var _HeightReference_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(4260);\n/* harmony import */ var _HorizontalOrigin_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(62919);\n/* harmony import */ var _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(89917);\n/* harmony import */ var _SDFSettings_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(36191);\n/* harmony import */ var _TextureAtlas_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(54230);\n/* harmony import */ var _VerticalOrigin_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(60473);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar SHOW_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].SHOW_INDEX */ .Z.SHOW_INDEX;\nvar POSITION_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].POSITION_INDEX */ .Z.POSITION_INDEX;\nvar PIXEL_OFFSET_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].PIXEL_OFFSET_INDEX */ .Z.PIXEL_OFFSET_INDEX;\nvar EYE_OFFSET_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].EYE_OFFSET_INDEX */ .Z.EYE_OFFSET_INDEX;\nvar HORIZONTAL_ORIGIN_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].HORIZONTAL_ORIGIN_INDEX */ .Z.HORIZONTAL_ORIGIN_INDEX;\nvar VERTICAL_ORIGIN_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].VERTICAL_ORIGIN_INDEX */ .Z.VERTICAL_ORIGIN_INDEX;\nvar SCALE_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].SCALE_INDEX */ .Z.SCALE_INDEX;\nvar IMAGE_INDEX_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].IMAGE_INDEX_INDEX */ .Z.IMAGE_INDEX_INDEX;\nvar COLOR_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].COLOR_INDEX */ .Z.COLOR_INDEX;\nvar ROTATION_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].ROTATION_INDEX */ .Z.ROTATION_INDEX;\nvar ALIGNED_AXIS_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].ALIGNED_AXIS_INDEX */ .Z.ALIGNED_AXIS_INDEX;\nvar SCALE_BY_DISTANCE_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].SCALE_BY_DISTANCE_INDEX */ .Z.SCALE_BY_DISTANCE_INDEX;\nvar TRANSLUCENCY_BY_DISTANCE_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].TRANSLUCENCY_BY_DISTANCE_INDEX */ .Z.TRANSLUCENCY_BY_DISTANCE_INDEX;\nvar PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX =\n  _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX */ .Z.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX;\nvar DISTANCE_DISPLAY_CONDITION_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].DISTANCE_DISPLAY_CONDITION */ .Z.DISTANCE_DISPLAY_CONDITION;\nvar DISABLE_DEPTH_DISTANCE = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].DISABLE_DEPTH_DISTANCE */ .Z.DISABLE_DEPTH_DISTANCE;\nvar TEXTURE_COORDINATE_BOUNDS = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].TEXTURE_COORDINATE_BOUNDS */ .Z.TEXTURE_COORDINATE_BOUNDS;\nvar SDF_INDEX = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].SDF_INDEX */ .Z.SDF_INDEX;\nvar NUMBER_OF_PROPERTIES = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].NUMBER_OF_PROPERTIES */ .Z.NUMBER_OF_PROPERTIES;\n\nvar attributeLocations;\n\nvar attributeLocationsBatched = {\n  positionHighAndScale: 0,\n  positionLowAndRotation: 1,\n  compressedAttribute0: 2, // pixel offset, translate, horizontal origin, vertical origin, show, direction, texture coordinates\n  compressedAttribute1: 3, // aligned axis, translucency by distance, image width\n  compressedAttribute2: 4, // image height, color, pick color, size in meters, valid aligned axis, 13 bits free\n  eyeOffset: 5, // 4 bytes free\n  scaleByDistance: 6,\n  pixelOffsetScaleByDistance: 7,\n  compressedAttribute3: 8,\n  textureCoordinateBoundsOrLabelTranslate: 9,\n  a_batchId: 10,\n  sdf: 11,\n};\n\nvar attributeLocationsInstanced = {\n  direction: 0,\n  positionHighAndScale: 1,\n  positionLowAndRotation: 2, // texture offset in w\n  compressedAttribute0: 3,\n  compressedAttribute1: 4,\n  compressedAttribute2: 5,\n  eyeOffset: 6, // texture range in w\n  scaleByDistance: 7,\n  pixelOffsetScaleByDistance: 8,\n  compressedAttribute3: 9,\n  textureCoordinateBoundsOrLabelTranslate: 10,\n  a_batchId: 11,\n  sdf: 12,\n};\n\n/**\n * A renderable collection of billboards.  Billboards are viewport-aligned\n * images positioned in the 3D scene.\n * <br /><br />\n * <div align=\'center\'>\n * <img src=\'Images/Billboard.png\' width=\'400\' height=\'300\' /><br />\n * Example billboards\n * </div>\n * <br /><br />\n * Billboards are added and removed from the collection using {@link BillboardCollection#add}\n * and {@link BillboardCollection#remove}.  Billboards in a collection automatically share textures\n * for images with the same identifier.\n *\n * @alias BillboardCollection\n * @constructor\n *\n * @param {Object} [options] Object with the following properties:\n * @param {Matrix4} [options.modelMatrix=Matrix4.IDENTITY] The 4x4 transformation matrix that transforms each billboard from model to world coordinates.\n * @param {Boolean} [options.debugShowBoundingVolume=false] For debugging only. Determines if this primitive\'s commands\' bounding spheres are shown.\n * @param {Scene} [options.scene] Must be passed in for billboards that use the height reference property or will be depth tested against the globe.\n * @param {BlendOption} [options.blendOption=BlendOption.OPAQUE_AND_TRANSLUCENT] The billboard blending option. The default\n * is used for rendering both opaque and translucent billboards. However, if either all of the billboards are completely opaque or all are completely translucent,\n * setting the technique to BlendOption.OPAQUE or BlendOption.TRANSLUCENT can improve performance by up to 2x.\n * @param {Boolean} [options.show=true] Determines if the billboards in the collection will be shown.\n *\n * @performance For best performance, prefer a few collections, each with many billboards, to\n * many collections with only a few billboards each.  Organize collections so that billboards\n * with the same update frequency are in the same collection, i.e., billboards that do not\n * change should be in one collection; billboards that change every frame should be in another\n * collection; and so on.\n *\n * @see BillboardCollection#add\n * @see BillboardCollection#remove\n * @see Billboard\n * @see LabelCollection\n *\n * @demo {@link https://sandcastle.cesium.com/index.html?src=Billboards.html|Cesium Sandcastle Billboard Demo}\n *\n * @example\n * // Create a billboard collection with two billboards\n * var billboards = scene.primitives.add(new Cesium.BillboardCollection());\n * billboards.add({\n *   position : new Cesium.Cartesian3(1.0, 2.0, 3.0),\n *   image : \'url/to/image\'\n * });\n * billboards.add({\n *   position : new Cesium.Cartesian3(4.0, 5.0, 6.0),\n *   image : \'url/to/another/image\'\n * });\n */\nfunction BillboardCollection(options) {\n  options = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options, _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].EMPTY_OBJECT */ .Z.EMPTY_OBJECT);\n\n  this._scene = options.scene;\n  this._batchTable = options.batchTable;\n\n  this._textureAtlas = undefined;\n  this._textureAtlasGUID = undefined;\n  this._destroyTextureAtlas = true;\n  this._sp = undefined;\n  this._spTranslucent = undefined;\n  this._rsOpaque = undefined;\n  this._rsTranslucent = undefined;\n  this._vaf = undefined;\n\n  this._billboards = [];\n  this._billboardsToUpdate = [];\n  this._billboardsToUpdateIndex = 0;\n  this._billboardsRemoved = false;\n  this._createVertexArray = false;\n\n  this._shaderRotation = false;\n  this._compiledShaderRotation = false;\n\n  this._shaderAlignedAxis = false;\n  this._compiledShaderAlignedAxis = false;\n\n  this._shaderScaleByDistance = false;\n  this._compiledShaderScaleByDistance = false;\n\n  this._shaderTranslucencyByDistance = false;\n  this._compiledShaderTranslucencyByDistance = false;\n\n  this._shaderPixelOffsetScaleByDistance = false;\n  this._compiledShaderPixelOffsetScaleByDistance = false;\n\n  this._shaderDistanceDisplayCondition = false;\n  this._compiledShaderDistanceDisplayCondition = false;\n\n  this._shaderDisableDepthDistance = false;\n  this._compiledShaderDisableDepthDistance = false;\n\n  this._shaderClampToGround = false;\n  this._compiledShaderClampToGround = false;\n\n  this._propertiesChanged = new Uint32Array(NUMBER_OF_PROPERTIES);\n\n  this._maxSize = 0.0;\n  this._maxEyeOffset = 0.0;\n  this._maxScale = 1.0;\n  this._maxPixelOffset = 0.0;\n  this._allHorizontalCenter = true;\n  this._allVerticalCenter = true;\n  this._allSizedInMeters = true;\n\n  this._baseVolume = new _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n  this._baseVolumeWC = new _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n  this._baseVolume2D = new _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n  this._boundingVolume = new _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n  this._boundingVolumeDirty = false;\n\n  this._colorCommands = [];\n\n  /**\n   * Determines if billboards in this collection will be shown.\n   *\n   * @type {Boolean}\n   * @default true\n   */\n  this.show = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.show, true);\n\n  /**\n   * The 4x4 transformation matrix that transforms each billboard in this collection from model to world coordinates.\n   * When this is the identity matrix, the billboards are drawn in world coordinates, i.e., Earth\'s WGS84 coordinates.\n   * Local reference frames can be used by providing a different transformation matrix, like that returned\n   * by {@link Transforms.eastNorthUpToFixedFrame}.\n   *\n   * @type {Matrix4}\n   * @default {@link Matrix4.IDENTITY}\n   *\n   *\n   * @example\n   * var center = Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883);\n   * billboards.modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(center);\n   * billboards.add({\n   *   image : \'url/to/image\',\n   *   position : new Cesium.Cartesian3(0.0, 0.0, 0.0) // center\n   * });\n   * billboards.add({\n   *   image : \'url/to/image\',\n   *   position : new Cesium.Cartesian3(1000000.0, 0.0, 0.0) // east\n   * });\n   * billboards.add({\n   *   image : \'url/to/image\',\n   *   position : new Cesium.Cartesian3(0.0, 1000000.0, 0.0) // north\n   * });\n   * billboards.add({\n   *   image : \'url/to/image\',\n   *   position : new Cesium.Cartesian3(0.0, 0.0, 1000000.0) // up\n   * });\n   *\n   * @see Transforms.eastNorthUpToFixedFrame\n   */\n  this.modelMatrix = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].clone */ .Z.clone(\n    (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(options.modelMatrix, _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].IDENTITY */ .Z.IDENTITY)\n  );\n  this._modelMatrix = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].clone */ .Z.clone(_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].IDENTITY */ .Z.IDENTITY);\n\n  /**\n   * This property is for debugging only; it is not for production use nor is it optimized.\n   * <p>\n   * Draws the bounding sphere for each draw command in the primitive.\n   * </p>\n   *\n   * @type {Boolean}\n   *\n   * @default false\n   */\n  this.debugShowBoundingVolume = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(\n    options.debugShowBoundingVolume,\n    false\n  );\n\n  /**\n   * This property is for debugging only; it is not for production use nor is it optimized.\n   * <p>\n   * Draws the texture atlas for this BillboardCollection as a fullscreen quad.\n   * </p>\n   *\n   * @type {Boolean}\n   *\n   * @default false\n   */\n  this.debugShowTextureAtlas = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(\n    options.debugShowTextureAtlas,\n    false\n  );\n\n  /**\n   * The billboard blending option. The default is used for rendering both opaque and translucent billboards.\n   * However, if either all of the billboards are completely opaque or all are completely translucent,\n   * setting the technique to BlendOption.OPAQUE or BlendOption.TRANSLUCENT can improve\n   * performance by up to 2x.\n   * @type {BlendOption}\n   * @default BlendOption.OPAQUE_AND_TRANSLUCENT\n   */\n  this.blendOption = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(\n    options.blendOption,\n    _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].OPAQUE_AND_TRANSLUCENT */ .Z.OPAQUE_AND_TRANSLUCENT\n  );\n  this._blendOption = undefined;\n\n  this._mode = _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].SCENE3D */ .Z.SCENE3D;\n\n  // The buffer usage for each attribute is determined based on the usage of the attribute over time.\n  this._buffersUsage = [\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // SHOW_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // POSITION_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // PIXEL_OFFSET_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // EYE_OFFSET_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // HORIZONTAL_ORIGIN_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // VERTICAL_ORIGIN_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // SCALE_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // IMAGE_INDEX_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // COLOR_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // ROTATION_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // ALIGNED_AXIS_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // SCALE_BY_DISTANCE_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // TRANSLUCENCY_BY_DISTANCE_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // DISTANCE_DISPLAY_CONDITION_INDEX\n    _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW, // TEXTURE_COORDINATE_BOUNDS\n  ];\n\n  this._highlightColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].clone */ .Z.clone(_Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].WHITE */ .Z.WHITE); // Only used by Vector3DTilePoints\n\n  var that = this;\n  this._uniforms = {\n    u_atlas: function () {\n      return that._textureAtlas.texture;\n    },\n    u_highlightColor: function () {\n      return that._highlightColor;\n    },\n  };\n\n  var scene = this._scene;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(scene) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(scene.terrainProviderChanged)) {\n    this._removeCallbackFunc = scene.terrainProviderChanged.addEventListener(\n      function () {\n        var billboards = this._billboards;\n        var length = billboards.length;\n        for (var i = 0; i < length; ++i) {\n          if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(billboards[i])) {\n            billboards[i]._updateClamping();\n          }\n        }\n      },\n      this\n    );\n  }\n}\n\nObject.defineProperties(BillboardCollection.prototype, {\n  /**\n   * Returns the number of billboards in this collection.  This is commonly used with\n   * {@link BillboardCollection#get} to iterate over all the billboards\n   * in the collection.\n   * @memberof BillboardCollection.prototype\n   * @type {Number}\n   */\n  length: {\n    get: function () {\n      removeBillboards(this);\n      return this._billboards.length;\n    },\n  },\n\n  /**\n   * Gets or sets the textureAtlas.\n   * @memberof BillboardCollection.prototype\n   * @type {TextureAtlas}\n   * @private\n   */\n  textureAtlas: {\n    get: function () {\n      return this._textureAtlas;\n    },\n    set: function (value) {\n      if (this._textureAtlas !== value) {\n        this._textureAtlas =\n          this._destroyTextureAtlas &&\n          this._textureAtlas &&\n          this._textureAtlas.destroy();\n        this._textureAtlas = value;\n        this._createVertexArray = true; // New per-billboard texture coordinates\n      }\n    },\n  },\n\n  /**\n   * Gets or sets a value which determines if the texture atlas is\n   * destroyed when the collection is destroyed.\n   *\n   * If the texture atlas is used by more than one collection, set this to <code>false</code>,\n   * and explicitly destroy the atlas to avoid attempting to destroy it multiple times.\n   *\n   * @memberof BillboardCollection.prototype\n   * @type {Boolean}\n   * @private\n   *\n   * @example\n   * // Set destroyTextureAtlas\n   * // Destroy a billboard collection but not its texture atlas.\n   *\n   * var atlas = new TextureAtlas({\n   *   scene : scene,\n   *   images : images\n   * });\n   * billboards.textureAtlas = atlas;\n   * billboards.destroyTextureAtlas = false;\n   * billboards = billboards.destroy();\n   * console.log(atlas.isDestroyed()); // False\n   */\n  destroyTextureAtlas: {\n    get: function () {\n      return this._destroyTextureAtlas;\n    },\n    set: function (value) {\n      this._destroyTextureAtlas = value;\n    },\n  },\n});\n\nfunction destroyBillboards(billboards) {\n  var length = billboards.length;\n  for (var i = 0; i < length; ++i) {\n    if (billboards[i]) {\n      billboards[i]._destroy();\n    }\n  }\n}\n\n/**\n * Creates and adds a billboard with the specified initial properties to the collection.\n * The added billboard is returned so it can be modified or removed from the collection later.\n *\n * @param {Object}[options] A template describing the billboard\'s properties as shown in Example 1.\n * @returns {Billboard} The billboard that was added to the collection.\n *\n * @performance Calling <code>add</code> is expected constant time.  However, the collection\'s vertex buffer\n * is rewritten - an <code>O(n)</code> operation that also incurs CPU to GPU overhead.  For\n * best performance, add as many billboards as possible before calling <code>update</code>.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * // Example 1:  Add a billboard, specifying all the default values.\n * var b = billboards.add({\n *   show : true,\n *   position : Cesium.Cartesian3.ZERO,\n *   pixelOffset : Cesium.Cartesian2.ZERO,\n *   eyeOffset : Cesium.Cartesian3.ZERO,\n *   heightReference : Cesium.HeightReference.NONE,\n *   horizontalOrigin : Cesium.HorizontalOrigin.CENTER,\n *   verticalOrigin : Cesium.VerticalOrigin.CENTER,\n *   scale : 1.0,\n *   image : \'url/to/image\',\n *   imageSubRegion : undefined,\n *   color : Cesium.Color.WHITE,\n *   id : undefined,\n *   rotation : 0.0,\n *   alignedAxis : Cesium.Cartesian3.ZERO,\n *   width : undefined,\n *   height : undefined,\n *   scaleByDistance : undefined,\n *   translucencyByDistance : undefined,\n *   pixelOffsetScaleByDistance : undefined,\n *   sizeInMeters : false,\n *   distanceDisplayCondition : undefined\n * });\n *\n * @example\n * // Example 2:  Specify only the billboard\'s cartographic position.\n * var b = billboards.add({\n *   position : Cesium.Cartesian3.fromDegrees(longitude, latitude, height)\n * });\n *\n * @see BillboardCollection#remove\n * @see BillboardCollection#removeAll\n */\nBillboardCollection.prototype.add = function (options) {\n  var billboard = new _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"] */ .Z(options, this);\n  billboard._index = this._billboards.length;\n\n  this._billboards.push(billboard);\n  this._createVertexArray = true;\n\n  return billboard;\n};\n\n/**\n * Removes a billboard from the collection.\n *\n * @param {Billboard} billboard The billboard to remove.\n * @returns {Boolean} <code>true</code> if the billboard was removed; <code>false</code> if the billboard was not found in the collection.\n *\n * @performance Calling <code>remove</code> is expected constant time.  However, the collection\'s vertex buffer\n * is rewritten - an <code>O(n)</code> operation that also incurs CPU to GPU overhead.  For\n * best performance, remove as many billboards as possible before calling <code>update</code>.\n * If you intend to temporarily hide a billboard, it is usually more efficient to call\n * {@link Billboard#show} instead of removing and re-adding the billboard.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * var b = billboards.add(...);\n * billboards.remove(b);  // Returns true\n *\n * @see BillboardCollection#add\n * @see BillboardCollection#removeAll\n * @see Billboard#show\n */\nBillboardCollection.prototype.remove = function (billboard) {\n  if (this.contains(billboard)) {\n    this._billboards[billboard._index] = undefined; // Removed later\n    this._billboardsRemoved = true;\n    this._createVertexArray = true;\n    billboard._destroy();\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * Removes all billboards from the collection.\n *\n * @performance <code>O(n)</code>.  It is more efficient to remove all the billboards\n * from a collection and then add new ones than to create a new collection entirely.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * billboards.add(...);\n * billboards.add(...);\n * billboards.removeAll();\n *\n * @see BillboardCollection#add\n * @see BillboardCollection#remove\n */\nBillboardCollection.prototype.removeAll = function () {\n  destroyBillboards(this._billboards);\n  this._billboards = [];\n  this._billboardsToUpdate = [];\n  this._billboardsToUpdateIndex = 0;\n  this._billboardsRemoved = false;\n\n  this._createVertexArray = true;\n};\n\nfunction removeBillboards(billboardCollection) {\n  if (billboardCollection._billboardsRemoved) {\n    billboardCollection._billboardsRemoved = false;\n\n    var newBillboards = [];\n    var billboards = billboardCollection._billboards;\n    var length = billboards.length;\n    for (var i = 0, j = 0; i < length; ++i) {\n      var billboard = billboards[i];\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(billboard)) {\n        billboard._index = j++;\n        newBillboards.push(billboard);\n      }\n    }\n\n    billboardCollection._billboards = newBillboards;\n  }\n}\n\nBillboardCollection.prototype._updateBillboard = function (\n  billboard,\n  propertyChanged\n) {\n  if (!billboard._dirty) {\n    this._billboardsToUpdate[this._billboardsToUpdateIndex++] = billboard;\n  }\n\n  ++this._propertiesChanged[propertyChanged];\n};\n\n/**\n * Check whether this collection contains a given billboard.\n *\n * @param {Billboard} [billboard] The billboard to check for.\n * @returns {Boolean} true if this collection contains the billboard, false otherwise.\n *\n * @see BillboardCollection#get\n */\nBillboardCollection.prototype.contains = function (billboard) {\n  return (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(billboard) && billboard._billboardCollection === this;\n};\n\n/**\n * Returns the billboard in the collection at the specified index.  Indices are zero-based\n * and increase as billboards are added.  Removing a billboard shifts all billboards after\n * it to the left, changing their indices.  This function is commonly used with\n * {@link BillboardCollection#length} to iterate over all the billboards\n * in the collection.\n *\n * @param {Number} index The zero-based index of the billboard.\n * @returns {Billboard} The billboard at the specified index.\n *\n * @performance Expected constant time.  If billboards were removed from the collection and\n * {@link BillboardCollection#update} was not called, an implicit <code>O(n)</code>\n * operation is performed.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * // Toggle the show property of every billboard in the collection\n * var len = billboards.length;\n * for (var i = 0; i < len; ++i) {\n *   var b = billboards.get(i);\n *   b.show = !b.show;\n * }\n *\n * @see BillboardCollection#length\n */\nBillboardCollection.prototype.get = function (index) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  _Core_Check_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].typeOf.number */ .Z.typeOf.number("index", index);\n  //>>includeEnd(\'debug\');\n\n  removeBillboards(this);\n  return this._billboards[index];\n};\n\nvar getIndexBuffer;\n\nfunction getIndexBufferBatched(context) {\n  var sixteenK = 16 * 1024;\n\n  var indexBuffer = context.cache.billboardCollection_indexBufferBatched;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(indexBuffer)) {\n    return indexBuffer;\n  }\n\n  // Subtract 6 because the last index is reserverd for primitive restart.\n  // https://www.khronos.org/registry/webgl/specs/latest/2.0/#5.18\n  var length = sixteenK * 6 - 6;\n  var indices = new Uint16Array(length);\n  for (var i = 0, j = 0; i < length; i += 6, j += 4) {\n    indices[i] = j;\n    indices[i + 1] = j + 1;\n    indices[i + 2] = j + 2;\n\n    indices[i + 3] = j + 0;\n    indices[i + 4] = j + 2;\n    indices[i + 5] = j + 3;\n  }\n\n  // PERFORMANCE_IDEA:  Should we reference count billboard collections, and eventually delete this?\n  // Is this too much memory to allocate up front?  Should we dynamically grow it?\n  indexBuffer = _Renderer_Buffer_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].createIndexBuffer */ .Z.createIndexBuffer({\n    context: context,\n    typedArray: indices,\n    usage: _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW,\n    indexDatatype: _Core_IndexDatatype_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].UNSIGNED_SHORT */ .Z.UNSIGNED_SHORT,\n  });\n  indexBuffer.vertexArrayDestroyable = false;\n  context.cache.billboardCollection_indexBufferBatched = indexBuffer;\n  return indexBuffer;\n}\n\nfunction getIndexBufferInstanced(context) {\n  var indexBuffer = context.cache.billboardCollection_indexBufferInstanced;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(indexBuffer)) {\n    return indexBuffer;\n  }\n\n  indexBuffer = _Renderer_Buffer_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].createIndexBuffer */ .Z.createIndexBuffer({\n    context: context,\n    typedArray: new Uint16Array([0, 1, 2, 0, 2, 3]),\n    usage: _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW,\n    indexDatatype: _Core_IndexDatatype_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].UNSIGNED_SHORT */ .Z.UNSIGNED_SHORT,\n  });\n\n  indexBuffer.vertexArrayDestroyable = false;\n  context.cache.billboardCollection_indexBufferInstanced = indexBuffer;\n  return indexBuffer;\n}\n\nfunction getVertexBufferInstanced(context) {\n  var vertexBuffer = context.cache.billboardCollection_vertexBufferInstanced;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(vertexBuffer)) {\n    return vertexBuffer;\n  }\n\n  vertexBuffer = _Renderer_Buffer_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].createVertexBuffer */ .Z.createVertexBuffer({\n    context: context,\n    typedArray: new Float32Array([0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0]),\n    usage: _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW,\n  });\n\n  vertexBuffer.vertexArrayDestroyable = false;\n  context.cache.billboardCollection_vertexBufferInstanced = vertexBuffer;\n  return vertexBuffer;\n}\n\nBillboardCollection.prototype.computeNewBuffersUsage = function () {\n  var buffersUsage = this._buffersUsage;\n  var usageChanged = false;\n\n  var properties = this._propertiesChanged;\n  for (var k = 0; k < NUMBER_OF_PROPERTIES; ++k) {\n    var newUsage =\n      properties[k] === 0 ? _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW : _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STREAM_DRAW */ .Z.STREAM_DRAW;\n    usageChanged = usageChanged || buffersUsage[k] !== newUsage;\n    buffersUsage[k] = newUsage;\n  }\n\n  return usageChanged;\n};\n\nfunction createVAF(\n  context,\n  numberOfBillboards,\n  buffersUsage,\n  instanced,\n  batchTable,\n  sdf\n) {\n  var attributes = [\n    {\n      index: attributeLocations.positionHighAndScale,\n      componentsPerAttribute: 4,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[POSITION_INDEX],\n    },\n    {\n      index: attributeLocations.positionLowAndRotation,\n      componentsPerAttribute: 4,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[POSITION_INDEX],\n    },\n    {\n      index: attributeLocations.compressedAttribute0,\n      componentsPerAttribute: 4,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[PIXEL_OFFSET_INDEX],\n    },\n    {\n      index: attributeLocations.compressedAttribute1,\n      componentsPerAttribute: 4,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[TRANSLUCENCY_BY_DISTANCE_INDEX],\n    },\n    {\n      index: attributeLocations.compressedAttribute2,\n      componentsPerAttribute: 4,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[COLOR_INDEX],\n    },\n    {\n      index: attributeLocations.eyeOffset,\n      componentsPerAttribute: 4,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[EYE_OFFSET_INDEX],\n    },\n    {\n      index: attributeLocations.scaleByDistance,\n      componentsPerAttribute: 4,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[SCALE_BY_DISTANCE_INDEX],\n    },\n    {\n      index: attributeLocations.pixelOffsetScaleByDistance,\n      componentsPerAttribute: 4,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX],\n    },\n    {\n      index: attributeLocations.compressedAttribute3,\n      componentsPerAttribute: 4,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[DISTANCE_DISPLAY_CONDITION_INDEX],\n    },\n    {\n      index: attributeLocations.textureCoordinateBoundsOrLabelTranslate,\n      componentsPerAttribute: 4,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[TEXTURE_COORDINATE_BOUNDS],\n    },\n  ];\n\n  // Instancing requires one non-instanced attribute.\n  if (instanced) {\n    attributes.push({\n      index: attributeLocations.direction,\n      componentsPerAttribute: 2,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      vertexBuffer: getVertexBufferInstanced(context),\n    });\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(batchTable)) {\n    attributes.push({\n      index: attributeLocations.a_batchId,\n      componentsPerAttribute: 1,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      bufferUsage: _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW,\n    });\n  }\n\n  if (sdf) {\n    attributes.push({\n      index: attributeLocations.sdf,\n      componentsPerAttribute: 2,\n      componentDatatype: _Core_ComponentDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT,\n      usage: buffersUsage[SDF_INDEX],\n    });\n  }\n\n  // When instancing is enabled, only one vertex is needed for each billboard.\n  var sizeInVertices = instanced ? numberOfBillboards : 4 * numberOfBillboards;\n  return new _Renderer_VertexArrayFacade_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z(context, attributes, sizeInVertices, instanced);\n}\n\n///////////////////////////////////////////////////////////////////////////\n\n// Four vertices per billboard.  Each has the same position, etc., but a different screen-space direction vector.\n\n// PERFORMANCE_IDEA:  Save memory if a property is the same for all billboards, use a latched attribute state,\n// instead of storing it in a vertex buffer.\n\nvar writePositionScratch = new _Core_EncodedCartesian3_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z();\n\nfunction writePositionScaleAndRotation(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  var i;\n  var positionHighWriter = vafWriters[attributeLocations.positionHighAndScale];\n  var positionLowWriter = vafWriters[attributeLocations.positionLowAndRotation];\n  var position = billboard._getActualPosition();\n\n  if (billboardCollection._mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].expand */ .Z.expand(\n      billboardCollection._baseVolume,\n      position,\n      billboardCollection._baseVolume\n    );\n    billboardCollection._boundingVolumeDirty = true;\n  }\n\n  _Core_EncodedCartesian3_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].fromCartesian */ .Z.fromCartesian(position, writePositionScratch);\n  var scale = billboard.scale;\n  var rotation = billboard.rotation;\n\n  if (rotation !== 0.0) {\n    billboardCollection._shaderRotation = true;\n  }\n\n  billboardCollection._maxScale = Math.max(\n    billboardCollection._maxScale,\n    scale\n  );\n\n  var high = writePositionScratch.high;\n  var low = writePositionScratch.low;\n\n  if (billboardCollection._instanced) {\n    i = billboard._index;\n    positionHighWriter(i, high.x, high.y, high.z, scale);\n    positionLowWriter(i, low.x, low.y, low.z, rotation);\n  } else {\n    i = billboard._index * 4;\n    positionHighWriter(i + 0, high.x, high.y, high.z, scale);\n    positionHighWriter(i + 1, high.x, high.y, high.z, scale);\n    positionHighWriter(i + 2, high.x, high.y, high.z, scale);\n    positionHighWriter(i + 3, high.x, high.y, high.z, scale);\n\n    positionLowWriter(i + 0, low.x, low.y, low.z, rotation);\n    positionLowWriter(i + 1, low.x, low.y, low.z, rotation);\n    positionLowWriter(i + 2, low.x, low.y, low.z, rotation);\n    positionLowWriter(i + 3, low.x, low.y, low.z, rotation);\n  }\n}\n\nvar scratchCartesian2 = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z();\n\nvar UPPER_BOUND = 32768.0; // 2^15\n\nvar LEFT_SHIFT16 = 65536.0; // 2^16\nvar LEFT_SHIFT12 = 4096.0; // 2^12\nvar LEFT_SHIFT8 = 256.0; // 2^8\nvar LEFT_SHIFT7 = 128.0;\nvar LEFT_SHIFT5 = 32.0;\nvar LEFT_SHIFT3 = 8.0;\nvar LEFT_SHIFT2 = 4.0;\n\nvar RIGHT_SHIFT8 = 1.0 / 256.0;\n\nvar LOWER_LEFT = 0.0;\nvar LOWER_RIGHT = 2.0;\nvar UPPER_RIGHT = 3.0;\nvar UPPER_LEFT = 1.0;\n\nfunction writeCompressedAttrib0(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  var i;\n  var writer = vafWriters[attributeLocations.compressedAttribute0];\n  var pixelOffset = billboard.pixelOffset;\n  var pixelOffsetX = pixelOffset.x;\n  var pixelOffsetY = pixelOffset.y;\n\n  var translate = billboard._translate;\n  var translateX = translate.x;\n  var translateY = translate.y;\n\n  billboardCollection._maxPixelOffset = Math.max(\n    billboardCollection._maxPixelOffset,\n    Math.abs(pixelOffsetX + translateX),\n    Math.abs(-pixelOffsetY + translateY)\n  );\n\n  var horizontalOrigin = billboard.horizontalOrigin;\n  var verticalOrigin = billboard._verticalOrigin;\n  var show = billboard.show && billboard.clusterShow;\n\n  // If the color alpha is zero, do not show this billboard.  This lets us avoid providing\n  // color during the pick pass and also eliminates a discard in the fragment shader.\n  if (billboard.color.alpha === 0.0) {\n    show = false;\n  }\n\n  // Raw billboards don\'t distinguish between BASELINE and BOTTOM, only LabelCollection does that.\n  if (verticalOrigin === _VerticalOrigin_js__WEBPACK_IMPORTED_MODULE_32__/* ["default"].BASELINE */ .Z.BASELINE) {\n    verticalOrigin = _VerticalOrigin_js__WEBPACK_IMPORTED_MODULE_32__/* ["default"].BOTTOM */ .Z.BOTTOM;\n  }\n\n  billboardCollection._allHorizontalCenter =\n    billboardCollection._allHorizontalCenter &&\n    horizontalOrigin === _HorizontalOrigin_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].CENTER */ .Z.CENTER;\n  billboardCollection._allVerticalCenter =\n    billboardCollection._allVerticalCenter &&\n    verticalOrigin === _VerticalOrigin_js__WEBPACK_IMPORTED_MODULE_32__/* ["default"].CENTER */ .Z.CENTER;\n\n  var bottomLeftX = 0;\n  var bottomLeftY = 0;\n  var width = 0;\n  var height = 0;\n  var index = billboard._imageIndex;\n  if (index !== -1) {\n    var imageRectangle = textureAtlasCoordinates[index];\n\n    //>>includeStart(\'debug\', pragmas.debug);\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(imageRectangle)) {\n      throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z("Invalid billboard image index: " + index);\n    }\n    //>>includeEnd(\'debug\');\n\n    bottomLeftX = imageRectangle.x;\n    bottomLeftY = imageRectangle.y;\n    width = imageRectangle.width;\n    height = imageRectangle.height;\n  }\n  var topRightX = bottomLeftX + width;\n  var topRightY = bottomLeftY + height;\n\n  var compressed0 =\n    Math.floor(\n      _Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].clamp */ .Z.clamp(pixelOffsetX, -UPPER_BOUND, UPPER_BOUND) + UPPER_BOUND\n    ) * LEFT_SHIFT7;\n  compressed0 += (horizontalOrigin + 1.0) * LEFT_SHIFT5;\n  compressed0 += (verticalOrigin + 1.0) * LEFT_SHIFT3;\n  compressed0 += (show ? 1.0 : 0.0) * LEFT_SHIFT2;\n\n  var compressed1 =\n    Math.floor(\n      _Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].clamp */ .Z.clamp(pixelOffsetY, -UPPER_BOUND, UPPER_BOUND) + UPPER_BOUND\n    ) * LEFT_SHIFT8;\n  var compressed2 =\n    Math.floor(\n      _Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].clamp */ .Z.clamp(translateX, -UPPER_BOUND, UPPER_BOUND) + UPPER_BOUND\n    ) * LEFT_SHIFT8;\n\n  var tempTanslateY =\n    (_Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].clamp */ .Z.clamp(translateY, -UPPER_BOUND, UPPER_BOUND) + UPPER_BOUND) *\n    RIGHT_SHIFT8;\n  var upperTranslateY = Math.floor(tempTanslateY);\n  var lowerTranslateY = Math.floor(\n    (tempTanslateY - upperTranslateY) * LEFT_SHIFT8\n  );\n\n  compressed1 += upperTranslateY;\n  compressed2 += lowerTranslateY;\n\n  scratchCartesian2.x = bottomLeftX;\n  scratchCartesian2.y = bottomLeftY;\n  var compressedTexCoordsLL = _Core_AttributeCompression_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].compressTextureCoordinates */ .Z.compressTextureCoordinates(\n    scratchCartesian2\n  );\n  scratchCartesian2.x = topRightX;\n  var compressedTexCoordsLR = _Core_AttributeCompression_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].compressTextureCoordinates */ .Z.compressTextureCoordinates(\n    scratchCartesian2\n  );\n  scratchCartesian2.y = topRightY;\n  var compressedTexCoordsUR = _Core_AttributeCompression_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].compressTextureCoordinates */ .Z.compressTextureCoordinates(\n    scratchCartesian2\n  );\n  scratchCartesian2.x = bottomLeftX;\n  var compressedTexCoordsUL = _Core_AttributeCompression_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].compressTextureCoordinates */ .Z.compressTextureCoordinates(\n    scratchCartesian2\n  );\n\n  if (billboardCollection._instanced) {\n    i = billboard._index;\n    writer(i, compressed0, compressed1, compressed2, compressedTexCoordsLL);\n  } else {\n    i = billboard._index * 4;\n    writer(\n      i + 0,\n      compressed0 + LOWER_LEFT,\n      compressed1,\n      compressed2,\n      compressedTexCoordsLL\n    );\n    writer(\n      i + 1,\n      compressed0 + LOWER_RIGHT,\n      compressed1,\n      compressed2,\n      compressedTexCoordsLR\n    );\n    writer(\n      i + 2,\n      compressed0 + UPPER_RIGHT,\n      compressed1,\n      compressed2,\n      compressedTexCoordsUR\n    );\n    writer(\n      i + 3,\n      compressed0 + UPPER_LEFT,\n      compressed1,\n      compressed2,\n      compressedTexCoordsUL\n    );\n  }\n}\n\nfunction writeCompressedAttrib1(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  var i;\n  var writer = vafWriters[attributeLocations.compressedAttribute1];\n  var alignedAxis = billboard.alignedAxis;\n  if (!_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].equals */ .Z.equals(alignedAxis, _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].ZERO */ .Z.ZERO)) {\n    billboardCollection._shaderAlignedAxis = true;\n  }\n\n  var near = 0.0;\n  var nearValue = 1.0;\n  var far = 1.0;\n  var farValue = 1.0;\n\n  var translucency = billboard.translucencyByDistance;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(translucency)) {\n    near = translucency.near;\n    nearValue = translucency.nearValue;\n    far = translucency.far;\n    farValue = translucency.farValue;\n\n    if (nearValue !== 1.0 || farValue !== 1.0) {\n      // translucency by distance calculation in shader need not be enabled\n      // until a billboard with near and far !== 1.0 is found\n      billboardCollection._shaderTranslucencyByDistance = true;\n    }\n  }\n\n  var width = 0;\n  var index = billboard._imageIndex;\n  if (index !== -1) {\n    var imageRectangle = textureAtlasCoordinates[index];\n\n    //>>includeStart(\'debug\', pragmas.debug);\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(imageRectangle)) {\n      throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z("Invalid billboard image index: " + index);\n    }\n    //>>includeEnd(\'debug\');\n\n    width = imageRectangle.width;\n  }\n\n  var textureWidth = billboardCollection._textureAtlas.texture.width;\n  var imageWidth = Math.round(\n    (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(billboard.width, textureWidth * width)\n  );\n  billboardCollection._maxSize = Math.max(\n    billboardCollection._maxSize,\n    imageWidth\n  );\n\n  var compressed0 = _Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].clamp */ .Z.clamp(imageWidth, 0.0, LEFT_SHIFT16);\n  var compressed1 = 0.0;\n\n  if (\n    Math.abs(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].magnitudeSquared */ .Z.magnitudeSquared(alignedAxis) - 1.0) <\n    _Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].EPSILON6 */ .Z.EPSILON6\n  ) {\n    compressed1 = _Core_AttributeCompression_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].octEncodeFloat */ .Z.octEncodeFloat(alignedAxis);\n  }\n\n  nearValue = _Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].clamp */ .Z.clamp(nearValue, 0.0, 1.0);\n  nearValue = nearValue === 1.0 ? 255.0 : (nearValue * 255.0) | 0;\n  compressed0 = compressed0 * LEFT_SHIFT8 + nearValue;\n\n  farValue = _Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].clamp */ .Z.clamp(farValue, 0.0, 1.0);\n  farValue = farValue === 1.0 ? 255.0 : (farValue * 255.0) | 0;\n  compressed1 = compressed1 * LEFT_SHIFT8 + farValue;\n\n  if (billboardCollection._instanced) {\n    i = billboard._index;\n    writer(i, compressed0, compressed1, near, far);\n  } else {\n    i = billboard._index * 4;\n    writer(i + 0, compressed0, compressed1, near, far);\n    writer(i + 1, compressed0, compressed1, near, far);\n    writer(i + 2, compressed0, compressed1, near, far);\n    writer(i + 3, compressed0, compressed1, near, far);\n  }\n}\n\nfunction writeCompressedAttrib2(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  var i;\n  var writer = vafWriters[attributeLocations.compressedAttribute2];\n  var color = billboard.color;\n  var pickColor = !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(billboardCollection._batchTable)\n    ? billboard.getPickId(frameState.context).color\n    : _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].WHITE */ .Z.WHITE;\n  var sizeInMeters = billboard.sizeInMeters ? 1.0 : 0.0;\n  var validAlignedAxis =\n    Math.abs(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].magnitudeSquared */ .Z.magnitudeSquared(billboard.alignedAxis) - 1.0) <\n    _Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].EPSILON6 */ .Z.EPSILON6\n      ? 1.0\n      : 0.0;\n\n  billboardCollection._allSizedInMeters =\n    billboardCollection._allSizedInMeters && sizeInMeters === 1.0;\n\n  var height = 0;\n  var index = billboard._imageIndex;\n  if (index !== -1) {\n    var imageRectangle = textureAtlasCoordinates[index];\n\n    //>>includeStart(\'debug\', pragmas.debug);\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(imageRectangle)) {\n      throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z("Invalid billboard image index: " + index);\n    }\n    //>>includeEnd(\'debug\');\n\n    height = imageRectangle.height;\n  }\n\n  var dimensions = billboardCollection._textureAtlas.texture.dimensions;\n  var imageHeight = Math.round(\n    (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(billboard.height, dimensions.y * height)\n  );\n  billboardCollection._maxSize = Math.max(\n    billboardCollection._maxSize,\n    imageHeight\n  );\n  var labelHorizontalOrigin = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(\n    billboard._labelHorizontalOrigin,\n    -2\n  );\n  labelHorizontalOrigin += 2;\n  var compressed3 = imageHeight * LEFT_SHIFT2 + labelHorizontalOrigin;\n\n  var red = _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(color.red);\n  var green = _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(color.green);\n  var blue = _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(color.blue);\n  var compressed0 = red * LEFT_SHIFT16 + green * LEFT_SHIFT8 + blue;\n\n  red = _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(pickColor.red);\n  green = _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(pickColor.green);\n  blue = _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(pickColor.blue);\n  var compressed1 = red * LEFT_SHIFT16 + green * LEFT_SHIFT8 + blue;\n\n  var compressed2 =\n    _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(color.alpha) * LEFT_SHIFT16 +\n    _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(pickColor.alpha) * LEFT_SHIFT8;\n  compressed2 += sizeInMeters * 2.0 + validAlignedAxis;\n\n  if (billboardCollection._instanced) {\n    i = billboard._index;\n    writer(i, compressed0, compressed1, compressed2, compressed3);\n  } else {\n    i = billboard._index * 4;\n    writer(i + 0, compressed0, compressed1, compressed2, compressed3);\n    writer(i + 1, compressed0, compressed1, compressed2, compressed3);\n    writer(i + 2, compressed0, compressed1, compressed2, compressed3);\n    writer(i + 3, compressed0, compressed1, compressed2, compressed3);\n  }\n}\n\nfunction writeEyeOffset(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  var i;\n  var writer = vafWriters[attributeLocations.eyeOffset];\n  var eyeOffset = billboard.eyeOffset;\n\n  // For billboards that are clamped to ground, move it slightly closer to the camera\n  var eyeOffsetZ = eyeOffset.z;\n  if (billboard._heightReference !== _HeightReference_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"].NONE */ .Z.NONE) {\n    eyeOffsetZ *= 1.005;\n  }\n  billboardCollection._maxEyeOffset = Math.max(\n    billboardCollection._maxEyeOffset,\n    Math.abs(eyeOffset.x),\n    Math.abs(eyeOffset.y),\n    Math.abs(eyeOffsetZ)\n  );\n\n  if (billboardCollection._instanced) {\n    var width = 0;\n    var height = 0;\n    var index = billboard._imageIndex;\n    if (index !== -1) {\n      var imageRectangle = textureAtlasCoordinates[index];\n\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(imageRectangle)) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z("Invalid billboard image index: " + index);\n      }\n      //>>includeEnd(\'debug\');\n\n      width = imageRectangle.width;\n      height = imageRectangle.height;\n    }\n\n    scratchCartesian2.x = width;\n    scratchCartesian2.y = height;\n    var compressedTexCoordsRange = _Core_AttributeCompression_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].compressTextureCoordinates */ .Z.compressTextureCoordinates(\n      scratchCartesian2\n    );\n\n    i = billboard._index;\n    writer(i, eyeOffset.x, eyeOffset.y, eyeOffsetZ, compressedTexCoordsRange);\n  } else {\n    i = billboard._index * 4;\n    writer(i + 0, eyeOffset.x, eyeOffset.y, eyeOffsetZ, 0.0);\n    writer(i + 1, eyeOffset.x, eyeOffset.y, eyeOffsetZ, 0.0);\n    writer(i + 2, eyeOffset.x, eyeOffset.y, eyeOffsetZ, 0.0);\n    writer(i + 3, eyeOffset.x, eyeOffset.y, eyeOffsetZ, 0.0);\n  }\n}\n\nfunction writeScaleByDistance(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  var i;\n  var writer = vafWriters[attributeLocations.scaleByDistance];\n  var near = 0.0;\n  var nearValue = 1.0;\n  var far = 1.0;\n  var farValue = 1.0;\n\n  var scale = billboard.scaleByDistance;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(scale)) {\n    near = scale.near;\n    nearValue = scale.nearValue;\n    far = scale.far;\n    farValue = scale.farValue;\n\n    if (nearValue !== 1.0 || farValue !== 1.0) {\n      // scale by distance calculation in shader need not be enabled\n      // until a billboard with near and far !== 1.0 is found\n      billboardCollection._shaderScaleByDistance = true;\n    }\n  }\n\n  if (billboardCollection._instanced) {\n    i = billboard._index;\n    writer(i, near, nearValue, far, farValue);\n  } else {\n    i = billboard._index * 4;\n    writer(i + 0, near, nearValue, far, farValue);\n    writer(i + 1, near, nearValue, far, farValue);\n    writer(i + 2, near, nearValue, far, farValue);\n    writer(i + 3, near, nearValue, far, farValue);\n  }\n}\n\nfunction writePixelOffsetScaleByDistance(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  var i;\n  var writer = vafWriters[attributeLocations.pixelOffsetScaleByDistance];\n  var near = 0.0;\n  var nearValue = 1.0;\n  var far = 1.0;\n  var farValue = 1.0;\n\n  var pixelOffsetScale = billboard.pixelOffsetScaleByDistance;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(pixelOffsetScale)) {\n    near = pixelOffsetScale.near;\n    nearValue = pixelOffsetScale.nearValue;\n    far = pixelOffsetScale.far;\n    farValue = pixelOffsetScale.farValue;\n\n    if (nearValue !== 1.0 || farValue !== 1.0) {\n      // pixelOffsetScale by distance calculation in shader need not be enabled\n      // until a billboard with near and far !== 1.0 is found\n      billboardCollection._shaderPixelOffsetScaleByDistance = true;\n    }\n  }\n\n  if (billboardCollection._instanced) {\n    i = billboard._index;\n    writer(i, near, nearValue, far, farValue);\n  } else {\n    i = billboard._index * 4;\n    writer(i + 0, near, nearValue, far, farValue);\n    writer(i + 1, near, nearValue, far, farValue);\n    writer(i + 2, near, nearValue, far, farValue);\n    writer(i + 3, near, nearValue, far, farValue);\n  }\n}\n\nfunction writeCompressedAttribute3(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  var i;\n  var writer = vafWriters[attributeLocations.compressedAttribute3];\n  var near = 0.0;\n  var far = Number.MAX_VALUE;\n\n  var distanceDisplayCondition = billboard.distanceDisplayCondition;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(distanceDisplayCondition)) {\n    near = distanceDisplayCondition.near;\n    far = distanceDisplayCondition.far;\n\n    near *= near;\n    far *= far;\n\n    billboardCollection._shaderDistanceDisplayCondition = true;\n  }\n\n  var disableDepthTestDistance = billboard.disableDepthTestDistance;\n  var clampToGround =\n    billboard.heightReference === _HeightReference_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"].CLAMP_TO_GROUND */ .Z.CLAMP_TO_GROUND &&\n    frameState.context.depthTexture;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(disableDepthTestDistance)) {\n    disableDepthTestDistance = clampToGround ? 5000.0 : 0.0;\n  }\n\n  disableDepthTestDistance *= disableDepthTestDistance;\n  if (clampToGround || disableDepthTestDistance > 0.0) {\n    billboardCollection._shaderDisableDepthDistance = true;\n    if (disableDepthTestDistance === Number.POSITIVE_INFINITY) {\n      disableDepthTestDistance = -1.0;\n    }\n  }\n\n  var imageHeight;\n  var imageWidth;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(billboard._labelDimensions)) {\n    var height = 0;\n    var width = 0;\n    var index = billboard._imageIndex;\n    if (index !== -1) {\n      var imageRectangle = textureAtlasCoordinates[index];\n\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(imageRectangle)) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z("Invalid billboard image index: " + index);\n      }\n      //>>includeEnd(\'debug\');\n\n      height = imageRectangle.height;\n      width = imageRectangle.width;\n    }\n\n    imageHeight = Math.round(\n      (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(\n        billboard.height,\n        billboardCollection._textureAtlas.texture.dimensions.y * height\n      )\n    );\n\n    var textureWidth = billboardCollection._textureAtlas.texture.width;\n    imageWidth = Math.round(\n      (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z)(billboard.width, textureWidth * width)\n    );\n  } else {\n    imageWidth = billboard._labelDimensions.x;\n    imageHeight = billboard._labelDimensions.y;\n  }\n\n  var w = Math.floor(_Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].clamp */ .Z.clamp(imageWidth, 0.0, LEFT_SHIFT12));\n  var h = Math.floor(_Core_Math_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].clamp */ .Z.clamp(imageHeight, 0.0, LEFT_SHIFT12));\n  var dimensions = w * LEFT_SHIFT12 + h;\n\n  if (billboardCollection._instanced) {\n    i = billboard._index;\n    writer(i, near, far, disableDepthTestDistance, dimensions);\n  } else {\n    i = billboard._index * 4;\n    writer(i + 0, near, far, disableDepthTestDistance, dimensions);\n    writer(i + 1, near, far, disableDepthTestDistance, dimensions);\n    writer(i + 2, near, far, disableDepthTestDistance, dimensions);\n    writer(i + 3, near, far, disableDepthTestDistance, dimensions);\n  }\n}\n\nfunction writeTextureCoordinateBoundsOrLabelTranslate(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  if (billboard.heightReference === _HeightReference_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"].CLAMP_TO_GROUND */ .Z.CLAMP_TO_GROUND) {\n    var scene = billboardCollection._scene;\n    var context = frameState.context;\n    var globeTranslucent = frameState.globeTranslucencyState.translucent;\n    var depthTestAgainstTerrain =\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(scene.globe) && scene.globe.depthTestAgainstTerrain;\n\n    // Only do manual depth test if the globe is opaque and writes depth\n    billboardCollection._shaderClampToGround =\n      context.depthTexture && !globeTranslucent && depthTestAgainstTerrain;\n  }\n  var i;\n  var writer =\n    vafWriters[attributeLocations.textureCoordinateBoundsOrLabelTranslate];\n\n  if (_Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].maximumVertexTextureImageUnits */ .Z.maximumVertexTextureImageUnits > 0) {\n    //write _labelTranslate, used by depth testing in the vertex shader\n    var translateX = 0;\n    var translateY = 0;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(billboard._labelTranslate)) {\n      translateX = billboard._labelTranslate.x;\n      translateY = billboard._labelTranslate.y;\n    }\n    if (billboardCollection._instanced) {\n      i = billboard._index;\n      writer(i, translateX, translateY, 0.0, 0.0);\n    } else {\n      i = billboard._index * 4;\n      writer(i + 0, translateX, translateY, 0.0, 0.0);\n      writer(i + 1, translateX, translateY, 0.0, 0.0);\n      writer(i + 2, translateX, translateY, 0.0, 0.0);\n      writer(i + 3, translateX, translateY, 0.0, 0.0);\n    }\n    return;\n  }\n\n  //write texture coordinate bounds, used by depth testing in fragment shader\n  var minX = 0;\n  var minY = 0;\n  var width = 0;\n  var height = 0;\n  var index = billboard._imageIndex;\n  if (index !== -1) {\n    var imageRectangle = textureAtlasCoordinates[index];\n\n    //>>includeStart(\'debug\', pragmas.debug);\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(imageRectangle)) {\n      throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z("Invalid billboard image index: " + index);\n    }\n    //>>includeEnd(\'debug\');\n\n    minX = imageRectangle.x;\n    minY = imageRectangle.y;\n    width = imageRectangle.width;\n    height = imageRectangle.height;\n  }\n  var maxX = minX + width;\n  var maxY = minY + height;\n\n  if (billboardCollection._instanced) {\n    i = billboard._index;\n    writer(i, minX, minY, maxX, maxY);\n  } else {\n    i = billboard._index * 4;\n    writer(i + 0, minX, minY, maxX, maxY);\n    writer(i + 1, minX, minY, maxX, maxY);\n    writer(i + 2, minX, minY, maxX, maxY);\n    writer(i + 3, minX, minY, maxX, maxY);\n  }\n}\n\nfunction writeBatchId(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(billboardCollection._batchTable)) {\n    return;\n  }\n\n  var writer = vafWriters[attributeLocations.a_batchId];\n  var id = billboard._batchIndex;\n\n  var i;\n  if (billboardCollection._instanced) {\n    i = billboard._index;\n    writer(i, id);\n  } else {\n    i = billboard._index * 4;\n    writer(i + 0, id);\n    writer(i + 1, id);\n    writer(i + 2, id);\n    writer(i + 3, id);\n  }\n}\n\nfunction writeSDF(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  if (!billboardCollection._sdf) {\n    return;\n  }\n\n  var i;\n  var writer = vafWriters[attributeLocations.sdf];\n\n  var outlineColor = billboard.outlineColor;\n  var outlineWidth = billboard.outlineWidth;\n\n  var red = _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(outlineColor.red);\n  var green = _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(outlineColor.green);\n  var blue = _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(outlineColor.blue);\n  var compressed0 = red * LEFT_SHIFT16 + green * LEFT_SHIFT8 + blue;\n\n  // Compute the relative outline distance\n  var outlineDistance = outlineWidth / _SDFSettings_js__WEBPACK_IMPORTED_MODULE_30__/* ["default"].RADIUS */ .Z.RADIUS;\n  var compressed1 =\n    _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(outlineColor.alpha) * LEFT_SHIFT16 +\n    _Core_Color_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].floatToByte */ .Z.floatToByte(outlineDistance) * LEFT_SHIFT8;\n\n  if (billboardCollection._instanced) {\n    i = billboard._index;\n    writer(i, compressed0, compressed1);\n  } else {\n    i = billboard._index * 4;\n    writer(i + 0, compressed0 + LOWER_LEFT, compressed1);\n    writer(i + 1, compressed0 + LOWER_RIGHT, compressed1);\n    writer(i + 2, compressed0 + UPPER_RIGHT, compressed1);\n    writer(i + 3, compressed0 + UPPER_LEFT, compressed1);\n  }\n}\n\nfunction writeBillboard(\n  billboardCollection,\n  frameState,\n  textureAtlasCoordinates,\n  vafWriters,\n  billboard\n) {\n  writePositionScaleAndRotation(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n  writeCompressedAttrib0(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n  writeCompressedAttrib1(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n  writeCompressedAttrib2(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n  writeEyeOffset(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n  writeScaleByDistance(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n  writePixelOffsetScaleByDistance(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n  writeCompressedAttribute3(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n  writeTextureCoordinateBoundsOrLabelTranslate(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n  writeBatchId(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n  writeSDF(\n    billboardCollection,\n    frameState,\n    textureAtlasCoordinates,\n    vafWriters,\n    billboard\n  );\n}\n\nfunction recomputeActualPositions(\n  billboardCollection,\n  billboards,\n  length,\n  frameState,\n  modelMatrix,\n  recomputeBoundingVolume\n) {\n  var boundingVolume;\n  if (frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    boundingVolume = billboardCollection._baseVolume;\n    billboardCollection._boundingVolumeDirty = true;\n  } else {\n    boundingVolume = billboardCollection._baseVolume2D;\n  }\n\n  var positions = [];\n  for (var i = 0; i < length; ++i) {\n    var billboard = billboards[i];\n    var position = billboard.position;\n    var actualPosition = _Billboard_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"]._computeActualPosition */ .Z._computeActualPosition(\n      billboard,\n      position,\n      frameState,\n      modelMatrix\n    );\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(actualPosition)) {\n      billboard._setActualPosition(actualPosition);\n\n      if (recomputeBoundingVolume) {\n        positions.push(actualPosition);\n      } else {\n        _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].expand */ .Z.expand(boundingVolume, actualPosition, boundingVolume);\n      }\n    }\n  }\n\n  if (recomputeBoundingVolume) {\n    _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromPoints */ .Z.fromPoints(positions, boundingVolume);\n  }\n}\n\nfunction updateMode(billboardCollection, frameState) {\n  var mode = frameState.mode;\n\n  var billboards = billboardCollection._billboards;\n  var billboardsToUpdate = billboardCollection._billboardsToUpdate;\n  var modelMatrix = billboardCollection._modelMatrix;\n\n  if (\n    billboardCollection._createVertexArray ||\n    billboardCollection._mode !== mode ||\n    (mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].SCENE3D */ .Z.SCENE3D &&\n      !_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].equals */ .Z.equals(modelMatrix, billboardCollection.modelMatrix))\n  ) {\n    billboardCollection._mode = mode;\n    _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].clone */ .Z.clone(billboardCollection.modelMatrix, modelMatrix);\n    billboardCollection._createVertexArray = true;\n\n    if (\n      mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].SCENE3D */ .Z.SCENE3D ||\n      mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].SCENE2D */ .Z.SCENE2D ||\n      mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW\n    ) {\n      recomputeActualPositions(\n        billboardCollection,\n        billboards,\n        billboards.length,\n        frameState,\n        modelMatrix,\n        true\n      );\n    }\n  } else if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].MORPHING */ .Z.MORPHING) {\n    recomputeActualPositions(\n      billboardCollection,\n      billboards,\n      billboards.length,\n      frameState,\n      modelMatrix,\n      true\n    );\n  } else if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].SCENE2D */ .Z.SCENE2D || mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW) {\n    recomputeActualPositions(\n      billboardCollection,\n      billboardsToUpdate,\n      billboardCollection._billboardsToUpdateIndex,\n      frameState,\n      modelMatrix,\n      false\n    );\n  }\n}\n\nfunction updateBoundingVolume(collection, frameState, boundingVolume) {\n  var pixelScale = 1.0;\n  if (!collection._allSizedInMeters || collection._maxPixelOffset !== 0.0) {\n    pixelScale = frameState.camera.getPixelSize(\n      boundingVolume,\n      frameState.context.drawingBufferWidth,\n      frameState.context.drawingBufferHeight\n    );\n  }\n\n  var size = pixelScale * collection._maxScale * collection._maxSize * 2.0;\n  if (collection._allHorizontalCenter && collection._allVerticalCenter) {\n    size *= 0.5;\n  }\n\n  var offset =\n    pixelScale * collection._maxPixelOffset + collection._maxEyeOffset;\n  boundingVolume.radius += size + offset;\n}\n\nfunction createDebugCommand(billboardCollection, context) {\n  var fs;\n  fs =\n    "uniform sampler2D billboard_texture; \\n" +\n    "varying vec2 v_textureCoordinates; \\n" +\n    "void main() \\n" +\n    "{ \\n" +\n    "    gl_FragColor = texture2D(billboard_texture, v_textureCoordinates); \\n" +\n    "} \\n";\n\n  var drawCommand = context.createViewportQuadCommand(fs, {\n    uniformMap: {\n      billboard_texture: function () {\n        return billboardCollection._textureAtlas.texture;\n      },\n    },\n  });\n  drawCommand.pass = _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].OVERLAY */ .Z.OVERLAY;\n  return drawCommand;\n}\n\nvar scratchWriterArray = [];\n\n/**\n * Called when {@link Viewer} or {@link CesiumWidget} render the scene to\n * get the draw commands needed to render this primitive.\n * <p>\n * Do not call this function directly.  This is documented just to\n * list the exceptions that may be propagated when the scene is rendered:\n * </p>\n *\n * @exception {RuntimeError} image with id must be in the atlas.\n */\nBillboardCollection.prototype.update = function (frameState) {\n  removeBillboards(this);\n\n  if (!this.show) {\n    return;\n  }\n\n  var billboards = this._billboards;\n  var billboardsLength = billboards.length;\n\n  var context = frameState.context;\n  this._instanced = context.instancedArrays;\n  attributeLocations = this._instanced\n    ? attributeLocationsInstanced\n    : attributeLocationsBatched;\n  getIndexBuffer = this._instanced\n    ? getIndexBufferInstanced\n    : getIndexBufferBatched;\n\n  var textureAtlas = this._textureAtlas;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(textureAtlas)) {\n    textureAtlas = this._textureAtlas = new _TextureAtlas_js__WEBPACK_IMPORTED_MODULE_31__/* ["default"] */ .Z({\n      context: context,\n    });\n\n    for (var ii = 0; ii < billboardsLength; ++ii) {\n      billboards[ii]._loadImage();\n    }\n  }\n\n  var textureAtlasCoordinates = textureAtlas.textureCoordinates;\n  if (textureAtlasCoordinates.length === 0) {\n    // Can\'t write billboard vertices until we have texture coordinates\n    // provided by a texture atlas\n    return;\n  }\n\n  updateMode(this, frameState);\n\n  billboards = this._billboards;\n  billboardsLength = billboards.length;\n  var billboardsToUpdate = this._billboardsToUpdate;\n  var billboardsToUpdateLength = this._billboardsToUpdateIndex;\n\n  var properties = this._propertiesChanged;\n\n  var textureAtlasGUID = textureAtlas.guid;\n  var createVertexArray =\n    this._createVertexArray || this._textureAtlasGUID !== textureAtlasGUID;\n  this._textureAtlasGUID = textureAtlasGUID;\n\n  var vafWriters;\n  var pass = frameState.passes;\n  var picking = pass.pick;\n\n  // PERFORMANCE_IDEA: Round robin multiple buffers.\n  if (createVertexArray || (!picking && this.computeNewBuffersUsage())) {\n    this._createVertexArray = false;\n\n    for (var k = 0; k < NUMBER_OF_PROPERTIES; ++k) {\n      properties[k] = 0;\n    }\n\n    this._vaf = this._vaf && this._vaf.destroy();\n\n    if (billboardsLength > 0) {\n      // PERFORMANCE_IDEA:  Instead of creating a new one, resize like std::vector.\n      this._vaf = createVAF(\n        context,\n        billboardsLength,\n        this._buffersUsage,\n        this._instanced,\n        this._batchTable,\n        this._sdf\n      );\n      vafWriters = this._vaf.writers;\n\n      // Rewrite entire buffer if billboards were added or removed.\n      for (var i = 0; i < billboardsLength; ++i) {\n        var billboard = this._billboards[i];\n        billboard._dirty = false; // In case it needed an update.\n        writeBillboard(\n          this,\n          frameState,\n          textureAtlasCoordinates,\n          vafWriters,\n          billboard\n        );\n      }\n\n      // Different billboard collections share the same index buffer.\n      this._vaf.commit(getIndexBuffer(context));\n    }\n\n    this._billboardsToUpdateIndex = 0;\n  } else if (billboardsToUpdateLength > 0) {\n    // Billboards were modified, but none were added or removed.\n    var writers = scratchWriterArray;\n    writers.length = 0;\n\n    if (\n      properties[POSITION_INDEX] ||\n      properties[ROTATION_INDEX] ||\n      properties[SCALE_INDEX]\n    ) {\n      writers.push(writePositionScaleAndRotation);\n    }\n\n    if (\n      properties[IMAGE_INDEX_INDEX] ||\n      properties[PIXEL_OFFSET_INDEX] ||\n      properties[HORIZONTAL_ORIGIN_INDEX] ||\n      properties[VERTICAL_ORIGIN_INDEX] ||\n      properties[SHOW_INDEX]\n    ) {\n      writers.push(writeCompressedAttrib0);\n      if (this._instanced) {\n        writers.push(writeEyeOffset);\n      }\n    }\n\n    if (\n      properties[IMAGE_INDEX_INDEX] ||\n      properties[ALIGNED_AXIS_INDEX] ||\n      properties[TRANSLUCENCY_BY_DISTANCE_INDEX]\n    ) {\n      writers.push(writeCompressedAttrib1);\n      writers.push(writeCompressedAttrib2);\n    }\n\n    if (properties[IMAGE_INDEX_INDEX] || properties[COLOR_INDEX]) {\n      writers.push(writeCompressedAttrib2);\n    }\n\n    if (properties[EYE_OFFSET_INDEX]) {\n      writers.push(writeEyeOffset);\n    }\n\n    if (properties[SCALE_BY_DISTANCE_INDEX]) {\n      writers.push(writeScaleByDistance);\n    }\n\n    if (properties[PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX]) {\n      writers.push(writePixelOffsetScaleByDistance);\n    }\n\n    if (\n      properties[DISTANCE_DISPLAY_CONDITION_INDEX] ||\n      properties[DISABLE_DEPTH_DISTANCE] ||\n      properties[IMAGE_INDEX_INDEX] ||\n      properties[POSITION_INDEX]\n    ) {\n      writers.push(writeCompressedAttribute3);\n    }\n\n    if (properties[IMAGE_INDEX_INDEX] || properties[POSITION_INDEX]) {\n      writers.push(writeTextureCoordinateBoundsOrLabelTranslate);\n    }\n\n    if (properties[SDF_INDEX]) {\n      writers.push(writeSDF);\n    }\n\n    var numWriters = writers.length;\n    vafWriters = this._vaf.writers;\n\n    if (billboardsToUpdateLength / billboardsLength > 0.1) {\n      // If more than 10% of billboard change, rewrite the entire buffer.\n\n      // PERFORMANCE_IDEA:  I totally made up 10% :).\n\n      for (var m = 0; m < billboardsToUpdateLength; ++m) {\n        var b = billboardsToUpdate[m];\n        b._dirty = false;\n\n        for (var n = 0; n < numWriters; ++n) {\n          writers[n](this, frameState, textureAtlasCoordinates, vafWriters, b);\n        }\n      }\n      this._vaf.commit(getIndexBuffer(context));\n    } else {\n      for (var h = 0; h < billboardsToUpdateLength; ++h) {\n        var bb = billboardsToUpdate[h];\n        bb._dirty = false;\n\n        for (var o = 0; o < numWriters; ++o) {\n          writers[o](this, frameState, textureAtlasCoordinates, vafWriters, bb);\n        }\n\n        if (this._instanced) {\n          this._vaf.subCommit(bb._index, 1);\n        } else {\n          this._vaf.subCommit(bb._index * 4, 4);\n        }\n      }\n      this._vaf.endSubCommits();\n    }\n\n    this._billboardsToUpdateIndex = 0;\n  }\n\n  // If the number of total billboards ever shrinks considerably\n  // Truncate billboardsToUpdate so that we free memory that we\'re\n  // not going to be using.\n  if (billboardsToUpdateLength > billboardsLength * 1.5) {\n    billboardsToUpdate.length = billboardsLength;\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(this._vaf) || !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(this._vaf.va)) {\n    return;\n  }\n\n  if (this._boundingVolumeDirty) {\n    this._boundingVolumeDirty = false;\n    _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].transform */ .Z.transform(\n      this._baseVolume,\n      this.modelMatrix,\n      this._baseVolumeWC\n    );\n  }\n\n  var boundingVolume;\n  var modelMatrix = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].IDENTITY */ .Z.IDENTITY;\n  if (frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    modelMatrix = this.modelMatrix;\n    boundingVolume = _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(\n      this._baseVolumeWC,\n      this._boundingVolume\n    );\n  } else {\n    boundingVolume = _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(\n      this._baseVolume2D,\n      this._boundingVolume\n    );\n  }\n  updateBoundingVolume(this, frameState, boundingVolume);\n\n  var blendOptionChanged = this._blendOption !== this.blendOption;\n  this._blendOption = this.blendOption;\n\n  if (blendOptionChanged) {\n    if (\n      this._blendOption === _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].OPAQUE */ .Z.OPAQUE ||\n      this._blendOption === _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].OPAQUE_AND_TRANSLUCENT */ .Z.OPAQUE_AND_TRANSLUCENT\n    ) {\n      this._rsOpaque = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].fromCache */ .Z.fromCache({\n        depthTest: {\n          enabled: true,\n          func: _Core_WebGLConstants_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].LESS */ .Z.LESS,\n        },\n        depthMask: true,\n      });\n    } else {\n      this._rsOpaque = undefined;\n    }\n\n    // If OPAQUE_AND_TRANSLUCENT is in use, only the opaque pass gets the benefit of the depth buffer,\n    // not the translucent pass.  Otherwise, if the TRANSLUCENT pass is on its own, it turns on\n    // a depthMask in lieu of full depth sorting (because it has opaque-ish fragments that look bad in OIT).\n    // When the TRANSLUCENT depth mask is in use, label backgrounds require the depth func to be LEQUAL.\n    var useTranslucentDepthMask = this._blendOption === _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT;\n\n    if (\n      this._blendOption === _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT ||\n      this._blendOption === _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].OPAQUE_AND_TRANSLUCENT */ .Z.OPAQUE_AND_TRANSLUCENT\n    ) {\n      this._rsTranslucent = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].fromCache */ .Z.fromCache({\n        depthTest: {\n          enabled: true,\n          func: useTranslucentDepthMask\n            ? _Core_WebGLConstants_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].LEQUAL */ .Z.LEQUAL\n            : _Core_WebGLConstants_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].LESS */ .Z.LESS,\n        },\n        depthMask: useTranslucentDepthMask,\n        blending: _BlendingState_js__WEBPACK_IMPORTED_MODULE_25__/* ["default"].ALPHA_BLEND */ .Z.ALPHA_BLEND,\n      });\n    } else {\n      this._rsTranslucent = undefined;\n    }\n  }\n\n  this._shaderDisableDepthDistance =\n    this._shaderDisableDepthDistance ||\n    frameState.minimumDisableDepthTestDistance !== 0.0;\n\n  var vsSource;\n  var fsSource;\n  var vs;\n  var fs;\n  var vertDefines;\n\n  var supportVSTextureReads = _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].maximumVertexTextureImageUnits */ .Z.maximumVertexTextureImageUnits > 0;\n\n  if (\n    blendOptionChanged ||\n    this._shaderRotation !== this._compiledShaderRotation ||\n    this._shaderAlignedAxis !== this._compiledShaderAlignedAxis ||\n    this._shaderScaleByDistance !== this._compiledShaderScaleByDistance ||\n    this._shaderTranslucencyByDistance !==\n      this._compiledShaderTranslucencyByDistance ||\n    this._shaderPixelOffsetScaleByDistance !==\n      this._compiledShaderPixelOffsetScaleByDistance ||\n    this._shaderDistanceDisplayCondition !==\n      this._compiledShaderDistanceDisplayCondition ||\n    this._shaderDisableDepthDistance !==\n      this._compiledShaderDisableDepthDistance ||\n    this._shaderClampToGround !== this._compiledShaderClampToGround ||\n    this._sdf !== this._compiledSDF\n  ) {\n    vsSource = _Shaders_BillboardCollectionVS_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"] */ .Z;\n    fsSource = _Shaders_BillboardCollectionFS_js__WEBPACK_IMPORTED_MODULE_35__/* ["default"] */ .Z;\n\n    vertDefines = [];\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(this._batchTable)) {\n      vertDefines.push("VECTOR_TILE");\n      vsSource = this._batchTable.getVertexShaderCallback(\n        false,\n        "a_batchId",\n        undefined\n      )(vsSource);\n      fsSource = this._batchTable.getFragmentShaderCallback(\n        false,\n        undefined\n      )(fsSource);\n    }\n\n    vs = new _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */ .Z({\n      defines: vertDefines,\n      sources: [vsSource],\n    });\n    if (this._instanced) {\n      vs.defines.push("INSTANCED");\n    }\n    if (this._shaderRotation) {\n      vs.defines.push("ROTATION");\n    }\n    if (this._shaderAlignedAxis) {\n      vs.defines.push("ALIGNED_AXIS");\n    }\n    if (this._shaderScaleByDistance) {\n      vs.defines.push("EYE_DISTANCE_SCALING");\n    }\n    if (this._shaderTranslucencyByDistance) {\n      vs.defines.push("EYE_DISTANCE_TRANSLUCENCY");\n    }\n    if (this._shaderPixelOffsetScaleByDistance) {\n      vs.defines.push("EYE_DISTANCE_PIXEL_OFFSET");\n    }\n    if (this._shaderDistanceDisplayCondition) {\n      vs.defines.push("DISTANCE_DISPLAY_CONDITION");\n    }\n    if (this._shaderDisableDepthDistance) {\n      vs.defines.push("DISABLE_DEPTH_DISTANCE");\n    }\n    if (this._shaderClampToGround) {\n      if (supportVSTextureReads) {\n        vs.defines.push("VERTEX_DEPTH_CHECK");\n      } else {\n        vs.defines.push("FRAGMENT_DEPTH_CHECK");\n      }\n    }\n\n    var sdfEdge = 1.0 - _SDFSettings_js__WEBPACK_IMPORTED_MODULE_30__/* ["default"].CUTOFF */ .Z.CUTOFF;\n\n    if (this._sdf) {\n      vs.defines.push("SDF");\n    }\n\n    var vectorFragDefine = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(this._batchTable) ? "VECTOR_TILE" : "";\n\n    if (this._blendOption === _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].OPAQUE_AND_TRANSLUCENT */ .Z.OPAQUE_AND_TRANSLUCENT) {\n      fs = new _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */ .Z({\n        defines: ["OPAQUE", vectorFragDefine],\n        sources: [fsSource],\n      });\n      if (this._shaderClampToGround) {\n        if (supportVSTextureReads) {\n          fs.defines.push("VERTEX_DEPTH_CHECK");\n        } else {\n          fs.defines.push("FRAGMENT_DEPTH_CHECK");\n        }\n      }\n\n      if (this._sdf) {\n        fs.defines.push("SDF");\n        fs.defines.push("SDF_EDGE " + sdfEdge);\n      }\n\n      this._sp = _Renderer_ShaderProgram_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].replaceCache */ .Z.replaceCache({\n        context: context,\n        shaderProgram: this._sp,\n        vertexShaderSource: vs,\n        fragmentShaderSource: fs,\n        attributeLocations: attributeLocations,\n      });\n\n      fs = new _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */ .Z({\n        defines: ["TRANSLUCENT", vectorFragDefine],\n        sources: [fsSource],\n      });\n      if (this._shaderClampToGround) {\n        if (supportVSTextureReads) {\n          fs.defines.push("VERTEX_DEPTH_CHECK");\n        } else {\n          fs.defines.push("FRAGMENT_DEPTH_CHECK");\n        }\n      }\n      if (this._sdf) {\n        fs.defines.push("SDF");\n        fs.defines.push("SDF_EDGE " + sdfEdge);\n      }\n      this._spTranslucent = _Renderer_ShaderProgram_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].replaceCache */ .Z.replaceCache({\n        context: context,\n        shaderProgram: this._spTranslucent,\n        vertexShaderSource: vs,\n        fragmentShaderSource: fs,\n        attributeLocations: attributeLocations,\n      });\n    }\n\n    if (this._blendOption === _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].OPAQUE */ .Z.OPAQUE) {\n      fs = new _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */ .Z({\n        defines: [vectorFragDefine],\n        sources: [fsSource],\n      });\n      if (this._shaderClampToGround) {\n        if (supportVSTextureReads) {\n          fs.defines.push("VERTEX_DEPTH_CHECK");\n        } else {\n          fs.defines.push("FRAGMENT_DEPTH_CHECK");\n        }\n      }\n      if (this._sdf) {\n        fs.defines.push("SDF");\n        fs.defines.push("SDF_EDGE " + sdfEdge);\n      }\n      this._sp = _Renderer_ShaderProgram_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].replaceCache */ .Z.replaceCache({\n        context: context,\n        shaderProgram: this._sp,\n        vertexShaderSource: vs,\n        fragmentShaderSource: fs,\n        attributeLocations: attributeLocations,\n      });\n    }\n\n    if (this._blendOption === _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT) {\n      fs = new _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */ .Z({\n        defines: [vectorFragDefine],\n        sources: [fsSource],\n      });\n      if (this._shaderClampToGround) {\n        if (supportVSTextureReads) {\n          fs.defines.push("VERTEX_DEPTH_CHECK");\n        } else {\n          fs.defines.push("FRAGMENT_DEPTH_CHECK");\n        }\n      }\n      if (this._sdf) {\n        fs.defines.push("SDF");\n        fs.defines.push("SDF_EDGE " + sdfEdge);\n      }\n      this._spTranslucent = _Renderer_ShaderProgram_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].replaceCache */ .Z.replaceCache({\n        context: context,\n        shaderProgram: this._spTranslucent,\n        vertexShaderSource: vs,\n        fragmentShaderSource: fs,\n        attributeLocations: attributeLocations,\n      });\n    }\n\n    this._compiledShaderRotation = this._shaderRotation;\n    this._compiledShaderAlignedAxis = this._shaderAlignedAxis;\n    this._compiledShaderScaleByDistance = this._shaderScaleByDistance;\n    this._compiledShaderTranslucencyByDistance = this._shaderTranslucencyByDistance;\n    this._compiledShaderPixelOffsetScaleByDistance = this._shaderPixelOffsetScaleByDistance;\n    this._compiledShaderDistanceDisplayCondition = this._shaderDistanceDisplayCondition;\n    this._compiledShaderDisableDepthDistance = this._shaderDisableDepthDistance;\n    this._compiledShaderClampToGround = this._shaderClampToGround;\n    this._compiledSDF = this._sdf;\n  }\n\n  var commandList = frameState.commandList;\n\n  if (pass.render || pass.pick) {\n    var colorList = this._colorCommands;\n\n    var opaque = this._blendOption === _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].OPAQUE */ .Z.OPAQUE;\n    var opaqueAndTranslucent =\n      this._blendOption === _BlendOption_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].OPAQUE_AND_TRANSLUCENT */ .Z.OPAQUE_AND_TRANSLUCENT;\n\n    var va = this._vaf.va;\n    var vaLength = va.length;\n\n    var uniforms = this._uniforms;\n    var pickId;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(this._batchTable)) {\n      uniforms = this._batchTable.getUniformMapCallback()(uniforms);\n      pickId = this._batchTable.getPickId();\n    } else {\n      pickId = "v_pickColor";\n    }\n\n    colorList.length = vaLength;\n    var totalLength = opaqueAndTranslucent ? vaLength * 2 : vaLength;\n    for (var j = 0; j < totalLength; ++j) {\n      var command = colorList[j];\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(command)) {\n        command = colorList[j] = new _Renderer_DrawCommand_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z();\n      }\n\n      var opaqueCommand = opaque || (opaqueAndTranslucent && j % 2 === 0);\n\n      command.pass =\n        opaqueCommand || !opaqueAndTranslucent ? _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].OPAQUE */ .Z.OPAQUE : _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT;\n      command.owner = this;\n\n      var index = opaqueAndTranslucent ? Math.floor(j / 2.0) : j;\n      command.boundingVolume = boundingVolume;\n      command.modelMatrix = modelMatrix;\n      command.count = va[index].indicesCount;\n      command.shaderProgram = opaqueCommand ? this._sp : this._spTranslucent;\n      command.uniformMap = uniforms;\n      command.vertexArray = va[index].va;\n      command.renderState = opaqueCommand\n        ? this._rsOpaque\n        : this._rsTranslucent;\n      command.debugShowBoundingVolume = this.debugShowBoundingVolume;\n      command.pickId = pickId;\n\n      if (this._instanced) {\n        command.count = 6;\n        command.instanceCount = billboardsLength;\n      }\n\n      commandList.push(command);\n    }\n\n    if (this.debugShowTextureAtlas) {\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(this.debugCommand)) {\n        this.debugCommand = createDebugCommand(this, frameState.context);\n      }\n\n      commandList.push(this.debugCommand);\n    }\n  }\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <br /><br />\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n *\n * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n *\n * @see BillboardCollection#destroy\n */\nBillboardCollection.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n * <br /><br />\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * billboards = billboards && billboards.destroy();\n *\n * @see BillboardCollection#isDestroyed\n */\nBillboardCollection.prototype.destroy = function () {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z)(this._removeCallbackFunc)) {\n    this._removeCallbackFunc();\n    this._removeCallbackFunc = undefined;\n  }\n\n  this._textureAtlas =\n    this._destroyTextureAtlas &&\n    this._textureAtlas &&\n    this._textureAtlas.destroy();\n  this._sp = this._sp && this._sp.destroy();\n  this._spTranslucent = this._spTranslucent && this._spTranslucent.destroy();\n  this._vaf = this._vaf && this._vaf.destroy();\n  destroyBillboards(this._billboards);\n\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z)(this);\n};\n/* harmony default export */ __webpack_exports__["Z"] = (BillboardCollection);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxzRUFBTztBQUNkO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsWUFBWSx1RkFBaUI7QUFDN0IsY0FBYyx1RkFBaUI7QUFDL0IsYUFBYSx1RkFBaUI7QUFDOUI7O0FBRUE7QUFDQSx1Q0FBdUMsK0VBQWtCO0FBQ3pEO0FBQ0EsSUFBSSx1RkFBaUI7QUFDckIsSUFBSSx1RkFBaUI7O0FBRXJCO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxzRUFBTztBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFNBQVMsMkVBQWE7QUFDdEI7QUFDQSx5REFBZSxtQkFBbUIsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3Z1ZTMtd2VicGFjazUvLi9ub2RlX21vZHVsZXMvY2VzaXVtL1NvdXJjZS9TY2VuZS9CaWxsYm9hcmRDb2xsZWN0aW9uLmpzPzA1OWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEF0dHJpYnV0ZUNvbXByZXNzaW9uIGZyb20gXCIuLi9Db3JlL0F0dHJpYnV0ZUNvbXByZXNzaW9uLmpzXCI7XG5pbXBvcnQgQm91bmRpbmdTcGhlcmUgZnJvbSBcIi4uL0NvcmUvQm91bmRpbmdTcGhlcmUuanNcIjtcbmltcG9ydCBDYXJ0ZXNpYW4yIGZyb20gXCIuLi9Db3JlL0NhcnRlc2lhbjIuanNcIjtcbmltcG9ydCBDYXJ0ZXNpYW4zIGZyb20gXCIuLi9Db3JlL0NhcnRlc2lhbjMuanNcIjtcbmltcG9ydCBDaGVjayBmcm9tIFwiLi4vQ29yZS9DaGVjay5qc1wiO1xuaW1wb3J0IENvbG9yIGZyb20gXCIuLi9Db3JlL0NvbG9yLmpzXCI7XG5pbXBvcnQgQ29tcG9uZW50RGF0YXR5cGUgZnJvbSBcIi4uL0NvcmUvQ29tcG9uZW50RGF0YXR5cGUuanNcIjtcbmltcG9ydCBkZWZhdWx0VmFsdWUgZnJvbSBcIi4uL0NvcmUvZGVmYXVsdFZhbHVlLmpzXCI7XG5pbXBvcnQgZGVmaW5lZCBmcm9tIFwiLi4vQ29yZS9kZWZpbmVkLmpzXCI7XG5pbXBvcnQgZGVzdHJveU9iamVjdCBmcm9tIFwiLi4vQ29yZS9kZXN0cm95T2JqZWN0LmpzXCI7XG5pbXBvcnQgRGV2ZWxvcGVyRXJyb3IgZnJvbSBcIi4uL0NvcmUvRGV2ZWxvcGVyRXJyb3IuanNcIjtcbmltcG9ydCBFbmNvZGVkQ2FydGVzaWFuMyBmcm9tIFwiLi4vQ29yZS9FbmNvZGVkQ2FydGVzaWFuMy5qc1wiO1xuaW1wb3J0IEluZGV4RGF0YXR5cGUgZnJvbSBcIi4uL0NvcmUvSW5kZXhEYXRhdHlwZS5qc1wiO1xuaW1wb3J0IENlc2l1bU1hdGggZnJvbSBcIi4uL0NvcmUvTWF0aC5qc1wiO1xuaW1wb3J0IE1hdHJpeDQgZnJvbSBcIi4uL0NvcmUvTWF0cml4NC5qc1wiO1xuaW1wb3J0IFdlYkdMQ29uc3RhbnRzIGZyb20gXCIuLi9Db3JlL1dlYkdMQ29uc3RhbnRzLmpzXCI7XG5pbXBvcnQgQnVmZmVyIGZyb20gXCIuLi9SZW5kZXJlci9CdWZmZXIuanNcIjtcbmltcG9ydCBCdWZmZXJVc2FnZSBmcm9tIFwiLi4vUmVuZGVyZXIvQnVmZmVyVXNhZ2UuanNcIjtcbmltcG9ydCBDb250ZXh0TGltaXRzIGZyb20gXCIuLi9SZW5kZXJlci9Db250ZXh0TGltaXRzLmpzXCI7XG5pbXBvcnQgRHJhd0NvbW1hbmQgZnJvbSBcIi4uL1JlbmRlcmVyL0RyYXdDb21tYW5kLmpzXCI7XG5pbXBvcnQgUGFzcyBmcm9tIFwiLi4vUmVuZGVyZXIvUGFzcy5qc1wiO1xuaW1wb3J0IFJlbmRlclN0YXRlIGZyb20gXCIuLi9SZW5kZXJlci9SZW5kZXJTdGF0ZS5qc1wiO1xuaW1wb3J0IFNoYWRlclByb2dyYW0gZnJvbSBcIi4uL1JlbmRlcmVyL1NoYWRlclByb2dyYW0uanNcIjtcbmltcG9ydCBTaGFkZXJTb3VyY2UgZnJvbSBcIi4uL1JlbmRlcmVyL1NoYWRlclNvdXJjZS5qc1wiO1xuaW1wb3J0IFZlcnRleEFycmF5RmFjYWRlIGZyb20gXCIuLi9SZW5kZXJlci9WZXJ0ZXhBcnJheUZhY2FkZS5qc1wiO1xuaW1wb3J0IEJpbGxib2FyZENvbGxlY3Rpb25GUyBmcm9tIFwiLi4vU2hhZGVycy9CaWxsYm9hcmRDb2xsZWN0aW9uRlMuanNcIjtcbmltcG9ydCBCaWxsYm9hcmRDb2xsZWN0aW9uVlMgZnJvbSBcIi4uL1NoYWRlcnMvQmlsbGJvYXJkQ29sbGVjdGlvblZTLmpzXCI7XG5pbXBvcnQgQmlsbGJvYXJkIGZyb20gXCIuL0JpbGxib2FyZC5qc1wiO1xuaW1wb3J0IEJsZW5kaW5nU3RhdGUgZnJvbSBcIi4vQmxlbmRpbmdTdGF0ZS5qc1wiO1xuaW1wb3J0IEJsZW5kT3B0aW9uIGZyb20gXCIuL0JsZW5kT3B0aW9uLmpzXCI7XG5pbXBvcnQgSGVpZ2h0UmVmZXJlbmNlIGZyb20gXCIuL0hlaWdodFJlZmVyZW5jZS5qc1wiO1xuaW1wb3J0IEhvcml6b250YWxPcmlnaW4gZnJvbSBcIi4vSG9yaXpvbnRhbE9yaWdpbi5qc1wiO1xuaW1wb3J0IFNjZW5lTW9kZSBmcm9tIFwiLi9TY2VuZU1vZGUuanNcIjtcbmltcG9ydCBTREZTZXR0aW5ncyBmcm9tIFwiLi9TREZTZXR0aW5ncy5qc1wiO1xuaW1wb3J0IFRleHR1cmVBdGxhcyBmcm9tIFwiLi9UZXh0dXJlQXRsYXMuanNcIjtcbmltcG9ydCBWZXJ0aWNhbE9yaWdpbiBmcm9tIFwiLi9WZXJ0aWNhbE9yaWdpbi5qc1wiO1xuXG52YXIgU0hPV19JTkRFWCA9IEJpbGxib2FyZC5TSE9XX0lOREVYO1xudmFyIFBPU0lUSU9OX0lOREVYID0gQmlsbGJvYXJkLlBPU0lUSU9OX0lOREVYO1xudmFyIFBJWEVMX09GRlNFVF9JTkRFWCA9IEJpbGxib2FyZC5QSVhFTF9PRkZTRVRfSU5ERVg7XG52YXIgRVlFX09GRlNFVF9JTkRFWCA9IEJpbGxib2FyZC5FWUVfT0ZGU0VUX0lOREVYO1xudmFyIEhPUklaT05UQUxfT1JJR0lOX0lOREVYID0gQmlsbGJvYXJkLkhPUklaT05UQUxfT1JJR0lOX0lOREVYO1xudmFyIFZFUlRJQ0FMX09SSUdJTl9JTkRFWCA9IEJpbGxib2FyZC5WRVJUSUNBTF9PUklHSU5fSU5ERVg7XG52YXIgU0NBTEVfSU5ERVggPSBCaWxsYm9hcmQuU0NBTEVfSU5ERVg7XG52YXIgSU1BR0VfSU5ERVhfSU5ERVggPSBCaWxsYm9hcmQuSU1BR0VfSU5ERVhfSU5ERVg7XG52YXIgQ09MT1JfSU5ERVggPSBCaWxsYm9hcmQuQ09MT1JfSU5ERVg7XG52YXIgUk9UQVRJT05fSU5ERVggPSBCaWxsYm9hcmQuUk9UQVRJT05fSU5ERVg7XG52YXIgQUxJR05FRF9BWElTX0lOREVYID0gQmlsbGJvYXJkLkFMSUdORURfQVhJU19JTkRFWDtcbnZhciBTQ0FMRV9CWV9ESVNUQU5DRV9JTkRFWCA9IEJpbGxib2FyZC5TQ0FMRV9CWV9ESVNUQU5DRV9JTkRFWDtcbnZhciBUUkFOU0xVQ0VOQ1lfQllfRElTVEFOQ0VfSU5ERVggPSBCaWxsYm9hcmQuVFJBTlNMVUNFTkNZX0JZX0RJU1RBTkNFX0lOREVYO1xudmFyIFBJWEVMX09GRlNFVF9TQ0FMRV9CWV9ESVNUQU5DRV9JTkRFWCA9XG4gIEJpbGxib2FyZC5QSVhFTF9PRkZTRVRfU0NBTEVfQllfRElTVEFOQ0VfSU5ERVg7XG52YXIgRElTVEFOQ0VfRElTUExBWV9DT05ESVRJT05fSU5ERVggPSBCaWxsYm9hcmQuRElTVEFOQ0VfRElTUExBWV9DT05ESVRJT047XG52YXIgRElTQUJMRV9ERVBUSF9ESVNUQU5DRSA9IEJpbGxib2FyZC5ESVNBQkxFX0RFUFRIX0RJU1RBTkNFO1xudmFyIFRFWFRVUkVfQ09PUkRJTkFURV9CT1VORFMgPSBCaWxsYm9hcmQuVEVYVFVSRV9DT09SRElOQVRFX0JPVU5EUztcbnZhciBTREZfSU5ERVggPSBCaWxsYm9hcmQuU0RGX0lOREVYO1xudmFyIE5VTUJFUl9PRl9QUk9QRVJUSUVTID0gQmlsbGJvYXJkLk5VTUJFUl9PRl9QUk9QRVJUSUVTO1xuXG52YXIgYXR0cmlidXRlTG9jYXRpb25zO1xuXG52YXIgYXR0cmlidXRlTG9jYXRpb25zQmF0Y2hlZCA9IHtcbiAgcG9zaXRpb25IaWdoQW5kU2NhbGU6IDAsXG4gIHBvc2l0aW9uTG93QW5kUm90YXRpb246IDEsXG4gIGNvbXByZXNzZWRBdHRyaWJ1dGUwOiAyLCAvLyBwaXhlbCBvZmZzZXQsIHRyYW5zbGF0ZSwgaG9yaXpvbnRhbCBvcmlnaW4sIHZlcnRpY2FsIG9yaWdpbiwgc2hvdywgZGlyZWN0aW9uLCB0ZXh0dXJlIGNvb3JkaW5hdGVzXG4gIGNvbXByZXNzZWRBdHRyaWJ1dGUxOiAzLCAvLyBhbGlnbmVkIGF4aXMsIHRyYW5zbHVjZW5jeSBieSBkaXN0YW5jZSwgaW1hZ2Ugd2lkdGhcbiAgY29tcHJlc3NlZEF0dHJpYnV0ZTI6IDQsIC8vIGltYWdlIGhlaWdodCwgY29sb3IsIHBpY2sgY29sb3IsIHNpemUgaW4gbWV0ZXJzLCB2YWxpZCBhbGlnbmVkIGF4aXMsIDEzIGJpdHMgZnJlZVxuICBleWVPZmZzZXQ6IDUsIC8vIDQgYnl0ZXMgZnJlZVxuICBzY2FsZUJ5RGlzdGFuY2U6IDYsXG4gIHBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlOiA3LFxuICBjb21wcmVzc2VkQXR0cmlidXRlMzogOCxcbiAgdGV4dHVyZUNvb3JkaW5hdGVCb3VuZHNPckxhYmVsVHJhbnNsYXRlOiA5LFxuICBhX2JhdGNoSWQ6IDEwLFxuICBzZGY6IDExLFxufTtcblxudmFyIGF0dHJpYnV0ZUxvY2F0aW9uc0luc3RhbmNlZCA9IHtcbiAgZGlyZWN0aW9uOiAwLFxuICBwb3NpdGlvbkhpZ2hBbmRTY2FsZTogMSxcbiAgcG9zaXRpb25Mb3dBbmRSb3RhdGlvbjogMiwgLy8gdGV4dHVyZSBvZmZzZXQgaW4gd1xuICBjb21wcmVzc2VkQXR0cmlidXRlMDogMyxcbiAgY29tcHJlc3NlZEF0dHJpYnV0ZTE6IDQsXG4gIGNvbXByZXNzZWRBdHRyaWJ1dGUyOiA1LFxuICBleWVPZmZzZXQ6IDYsIC8vIHRleHR1cmUgcmFuZ2UgaW4gd1xuICBzY2FsZUJ5RGlzdGFuY2U6IDcsXG4gIHBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlOiA4LFxuICBjb21wcmVzc2VkQXR0cmlidXRlMzogOSxcbiAgdGV4dHVyZUNvb3JkaW5hdGVCb3VuZHNPckxhYmVsVHJhbnNsYXRlOiAxMCxcbiAgYV9iYXRjaElkOiAxMSxcbiAgc2RmOiAxMixcbn07XG5cbi8qKlxuICogQSByZW5kZXJhYmxlIGNvbGxlY3Rpb24gb2YgYmlsbGJvYXJkcy4gIEJpbGxib2FyZHMgYXJlIHZpZXdwb3J0LWFsaWduZWRcbiAqIGltYWdlcyBwb3NpdGlvbmVkIGluIHRoZSAzRCBzY2VuZS5cbiAqIDxiciAvPjxiciAvPlxuICogPGRpdiBhbGlnbj0nY2VudGVyJz5cbiAqIDxpbWcgc3JjPSdJbWFnZXMvQmlsbGJvYXJkLnBuZycgd2lkdGg9JzQwMCcgaGVpZ2h0PSczMDAnIC8+PGJyIC8+XG4gKiBFeGFtcGxlIGJpbGxib2FyZHNcbiAqIDwvZGl2PlxuICogPGJyIC8+PGJyIC8+XG4gKiBCaWxsYm9hcmRzIGFyZSBhZGRlZCBhbmQgcmVtb3ZlZCBmcm9tIHRoZSBjb2xsZWN0aW9uIHVzaW5nIHtAbGluayBCaWxsYm9hcmRDb2xsZWN0aW9uI2FkZH1cbiAqIGFuZCB7QGxpbmsgQmlsbGJvYXJkQ29sbGVjdGlvbiNyZW1vdmV9LiAgQmlsbGJvYXJkcyBpbiBhIGNvbGxlY3Rpb24gYXV0b21hdGljYWxseSBzaGFyZSB0ZXh0dXJlc1xuICogZm9yIGltYWdlcyB3aXRoIHRoZSBzYW1lIGlkZW50aWZpZXIuXG4gKlxuICogQGFsaWFzIEJpbGxib2FyZENvbGxlY3Rpb25cbiAqIEBjb25zdHJ1Y3RvclxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICogQHBhcmFtIHtNYXRyaXg0fSBbb3B0aW9ucy5tb2RlbE1hdHJpeD1NYXRyaXg0LklERU5USVRZXSBUaGUgNHg0IHRyYW5zZm9ybWF0aW9uIG1hdHJpeCB0aGF0IHRyYW5zZm9ybXMgZWFjaCBiaWxsYm9hcmQgZnJvbSBtb2RlbCB0byB3b3JsZCBjb29yZGluYXRlcy5cbiAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuZGVidWdTaG93Qm91bmRpbmdWb2x1bWU9ZmFsc2VdIEZvciBkZWJ1Z2dpbmcgb25seS4gRGV0ZXJtaW5lcyBpZiB0aGlzIHByaW1pdGl2ZSdzIGNvbW1hbmRzJyBib3VuZGluZyBzcGhlcmVzIGFyZSBzaG93bi5cbiAqIEBwYXJhbSB7U2NlbmV9IFtvcHRpb25zLnNjZW5lXSBNdXN0IGJlIHBhc3NlZCBpbiBmb3IgYmlsbGJvYXJkcyB0aGF0IHVzZSB0aGUgaGVpZ2h0IHJlZmVyZW5jZSBwcm9wZXJ0eSBvciB3aWxsIGJlIGRlcHRoIHRlc3RlZCBhZ2FpbnN0IHRoZSBnbG9iZS5cbiAqIEBwYXJhbSB7QmxlbmRPcHRpb259IFtvcHRpb25zLmJsZW5kT3B0aW9uPUJsZW5kT3B0aW9uLk9QQVFVRV9BTkRfVFJBTlNMVUNFTlRdIFRoZSBiaWxsYm9hcmQgYmxlbmRpbmcgb3B0aW9uLiBUaGUgZGVmYXVsdFxuICogaXMgdXNlZCBmb3IgcmVuZGVyaW5nIGJvdGggb3BhcXVlIGFuZCB0cmFuc2x1Y2VudCBiaWxsYm9hcmRzLiBIb3dldmVyLCBpZiBlaXRoZXIgYWxsIG9mIHRoZSBiaWxsYm9hcmRzIGFyZSBjb21wbGV0ZWx5IG9wYXF1ZSBvciBhbGwgYXJlIGNvbXBsZXRlbHkgdHJhbnNsdWNlbnQsXG4gKiBzZXR0aW5nIHRoZSB0ZWNobmlxdWUgdG8gQmxlbmRPcHRpb24uT1BBUVVFIG9yIEJsZW5kT3B0aW9uLlRSQU5TTFVDRU5UIGNhbiBpbXByb3ZlIHBlcmZvcm1hbmNlIGJ5IHVwIHRvIDJ4LlxuICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5zaG93PXRydWVdIERldGVybWluZXMgaWYgdGhlIGJpbGxib2FyZHMgaW4gdGhlIGNvbGxlY3Rpb24gd2lsbCBiZSBzaG93bi5cbiAqXG4gKiBAcGVyZm9ybWFuY2UgRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHByZWZlciBhIGZldyBjb2xsZWN0aW9ucywgZWFjaCB3aXRoIG1hbnkgYmlsbGJvYXJkcywgdG9cbiAqIG1hbnkgY29sbGVjdGlvbnMgd2l0aCBvbmx5IGEgZmV3IGJpbGxib2FyZHMgZWFjaC4gIE9yZ2FuaXplIGNvbGxlY3Rpb25zIHNvIHRoYXQgYmlsbGJvYXJkc1xuICogd2l0aCB0aGUgc2FtZSB1cGRhdGUgZnJlcXVlbmN5IGFyZSBpbiB0aGUgc2FtZSBjb2xsZWN0aW9uLCBpLmUuLCBiaWxsYm9hcmRzIHRoYXQgZG8gbm90XG4gKiBjaGFuZ2Ugc2hvdWxkIGJlIGluIG9uZSBjb2xsZWN0aW9uOyBiaWxsYm9hcmRzIHRoYXQgY2hhbmdlIGV2ZXJ5IGZyYW1lIHNob3VsZCBiZSBpbiBhbm90aGVyXG4gKiBjb2xsZWN0aW9uOyBhbmQgc28gb24uXG4gKlxuICogQHNlZSBCaWxsYm9hcmRDb2xsZWN0aW9uI2FkZFxuICogQHNlZSBCaWxsYm9hcmRDb2xsZWN0aW9uI3JlbW92ZVxuICogQHNlZSBCaWxsYm9hcmRcbiAqIEBzZWUgTGFiZWxDb2xsZWN0aW9uXG4gKlxuICogQGRlbW8ge0BsaW5rIGh0dHBzOi8vc2FuZGNhc3RsZS5jZXNpdW0uY29tL2luZGV4Lmh0bWw/c3JjPUJpbGxib2FyZHMuaHRtbHxDZXNpdW0gU2FuZGNhc3RsZSBCaWxsYm9hcmQgRGVtb31cbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQ3JlYXRlIGEgYmlsbGJvYXJkIGNvbGxlY3Rpb24gd2l0aCB0d28gYmlsbGJvYXJkc1xuICogdmFyIGJpbGxib2FyZHMgPSBzY2VuZS5wcmltaXRpdmVzLmFkZChuZXcgQ2VzaXVtLkJpbGxib2FyZENvbGxlY3Rpb24oKSk7XG4gKiBiaWxsYm9hcmRzLmFkZCh7XG4gKiAgIHBvc2l0aW9uIDogbmV3IENlc2l1bS5DYXJ0ZXNpYW4zKDEuMCwgMi4wLCAzLjApLFxuICogICBpbWFnZSA6ICd1cmwvdG8vaW1hZ2UnXG4gKiB9KTtcbiAqIGJpbGxib2FyZHMuYWRkKHtcbiAqICAgcG9zaXRpb24gOiBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoNC4wLCA1LjAsIDYuMCksXG4gKiAgIGltYWdlIDogJ3VybC90by9hbm90aGVyL2ltYWdlJ1xuICogfSk7XG4gKi9cbmZ1bmN0aW9uIEJpbGxib2FyZENvbGxlY3Rpb24ob3B0aW9ucykge1xuICBvcHRpb25zID0gZGVmYXVsdFZhbHVlKG9wdGlvbnMsIGRlZmF1bHRWYWx1ZS5FTVBUWV9PQkpFQ1QpO1xuXG4gIHRoaXMuX3NjZW5lID0gb3B0aW9ucy5zY2VuZTtcbiAgdGhpcy5fYmF0Y2hUYWJsZSA9IG9wdGlvbnMuYmF0Y2hUYWJsZTtcblxuICB0aGlzLl90ZXh0dXJlQXRsYXMgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX3RleHR1cmVBdGxhc0dVSUQgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2Rlc3Ryb3lUZXh0dXJlQXRsYXMgPSB0cnVlO1xuICB0aGlzLl9zcCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fc3BUcmFuc2x1Y2VudCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fcnNPcGFxdWUgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX3JzVHJhbnNsdWNlbnQgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX3ZhZiA9IHVuZGVmaW5lZDtcblxuICB0aGlzLl9iaWxsYm9hcmRzID0gW107XG4gIHRoaXMuX2JpbGxib2FyZHNUb1VwZGF0ZSA9IFtdO1xuICB0aGlzLl9iaWxsYm9hcmRzVG9VcGRhdGVJbmRleCA9IDA7XG4gIHRoaXMuX2JpbGxib2FyZHNSZW1vdmVkID0gZmFsc2U7XG4gIHRoaXMuX2NyZWF0ZVZlcnRleEFycmF5ID0gZmFsc2U7XG5cbiAgdGhpcy5fc2hhZGVyUm90YXRpb24gPSBmYWxzZTtcbiAgdGhpcy5fY29tcGlsZWRTaGFkZXJSb3RhdGlvbiA9IGZhbHNlO1xuXG4gIHRoaXMuX3NoYWRlckFsaWduZWRBeGlzID0gZmFsc2U7XG4gIHRoaXMuX2NvbXBpbGVkU2hhZGVyQWxpZ25lZEF4aXMgPSBmYWxzZTtcblxuICB0aGlzLl9zaGFkZXJTY2FsZUJ5RGlzdGFuY2UgPSBmYWxzZTtcbiAgdGhpcy5fY29tcGlsZWRTaGFkZXJTY2FsZUJ5RGlzdGFuY2UgPSBmYWxzZTtcblxuICB0aGlzLl9zaGFkZXJUcmFuc2x1Y2VuY3lCeURpc3RhbmNlID0gZmFsc2U7XG4gIHRoaXMuX2NvbXBpbGVkU2hhZGVyVHJhbnNsdWNlbmN5QnlEaXN0YW5jZSA9IGZhbHNlO1xuXG4gIHRoaXMuX3NoYWRlclBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlID0gZmFsc2U7XG4gIHRoaXMuX2NvbXBpbGVkU2hhZGVyUGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2UgPSBmYWxzZTtcblxuICB0aGlzLl9zaGFkZXJEaXN0YW5jZURpc3BsYXlDb25kaXRpb24gPSBmYWxzZTtcbiAgdGhpcy5fY29tcGlsZWRTaGFkZXJEaXN0YW5jZURpc3BsYXlDb25kaXRpb24gPSBmYWxzZTtcblxuICB0aGlzLl9zaGFkZXJEaXNhYmxlRGVwdGhEaXN0YW5jZSA9IGZhbHNlO1xuICB0aGlzLl9jb21waWxlZFNoYWRlckRpc2FibGVEZXB0aERpc3RhbmNlID0gZmFsc2U7XG5cbiAgdGhpcy5fc2hhZGVyQ2xhbXBUb0dyb3VuZCA9IGZhbHNlO1xuICB0aGlzLl9jb21waWxlZFNoYWRlckNsYW1wVG9Hcm91bmQgPSBmYWxzZTtcblxuICB0aGlzLl9wcm9wZXJ0aWVzQ2hhbmdlZCA9IG5ldyBVaW50MzJBcnJheShOVU1CRVJfT0ZfUFJPUEVSVElFUyk7XG5cbiAgdGhpcy5fbWF4U2l6ZSA9IDAuMDtcbiAgdGhpcy5fbWF4RXllT2Zmc2V0ID0gMC4wO1xuICB0aGlzLl9tYXhTY2FsZSA9IDEuMDtcbiAgdGhpcy5fbWF4UGl4ZWxPZmZzZXQgPSAwLjA7XG4gIHRoaXMuX2FsbEhvcml6b250YWxDZW50ZXIgPSB0cnVlO1xuICB0aGlzLl9hbGxWZXJ0aWNhbENlbnRlciA9IHRydWU7XG4gIHRoaXMuX2FsbFNpemVkSW5NZXRlcnMgPSB0cnVlO1xuXG4gIHRoaXMuX2Jhc2VWb2x1bWUgPSBuZXcgQm91bmRpbmdTcGhlcmUoKTtcbiAgdGhpcy5fYmFzZVZvbHVtZVdDID0gbmV3IEJvdW5kaW5nU3BoZXJlKCk7XG4gIHRoaXMuX2Jhc2VWb2x1bWUyRCA9IG5ldyBCb3VuZGluZ1NwaGVyZSgpO1xuICB0aGlzLl9ib3VuZGluZ1ZvbHVtZSA9IG5ldyBCb3VuZGluZ1NwaGVyZSgpO1xuICB0aGlzLl9ib3VuZGluZ1ZvbHVtZURpcnR5ID0gZmFsc2U7XG5cbiAgdGhpcy5fY29sb3JDb21tYW5kcyA9IFtdO1xuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIGlmIGJpbGxib2FyZHMgaW4gdGhpcyBjb2xsZWN0aW9uIHdpbGwgYmUgc2hvd24uXG4gICAqXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICB0aGlzLnNob3cgPSBkZWZhdWx0VmFsdWUob3B0aW9ucy5zaG93LCB0cnVlKTtcblxuICAvKipcbiAgICogVGhlIDR4NCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggdGhhdCB0cmFuc2Zvcm1zIGVhY2ggYmlsbGJvYXJkIGluIHRoaXMgY29sbGVjdGlvbiBmcm9tIG1vZGVsIHRvIHdvcmxkIGNvb3JkaW5hdGVzLlxuICAgKiBXaGVuIHRoaXMgaXMgdGhlIGlkZW50aXR5IG1hdHJpeCwgdGhlIGJpbGxib2FyZHMgYXJlIGRyYXduIGluIHdvcmxkIGNvb3JkaW5hdGVzLCBpLmUuLCBFYXJ0aCdzIFdHUzg0IGNvb3JkaW5hdGVzLlxuICAgKiBMb2NhbCByZWZlcmVuY2UgZnJhbWVzIGNhbiBiZSB1c2VkIGJ5IHByb3ZpZGluZyBhIGRpZmZlcmVudCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgsIGxpa2UgdGhhdCByZXR1cm5lZFxuICAgKiBieSB7QGxpbmsgVHJhbnNmb3Jtcy5lYXN0Tm9ydGhVcFRvRml4ZWRGcmFtZX0uXG4gICAqXG4gICAqIEB0eXBlIHtNYXRyaXg0fVxuICAgKiBAZGVmYXVsdCB7QGxpbmsgTWF0cml4NC5JREVOVElUWX1cbiAgICpcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdmFyIGNlbnRlciA9IENlc2l1bS5DYXJ0ZXNpYW4zLmZyb21EZWdyZWVzKC03NS41OTc3NywgNDAuMDM4ODMpO1xuICAgKiBiaWxsYm9hcmRzLm1vZGVsTWF0cml4ID0gQ2VzaXVtLlRyYW5zZm9ybXMuZWFzdE5vcnRoVXBUb0ZpeGVkRnJhbWUoY2VudGVyKTtcbiAgICogYmlsbGJvYXJkcy5hZGQoe1xuICAgKiAgIGltYWdlIDogJ3VybC90by9pbWFnZScsXG4gICAqICAgcG9zaXRpb24gOiBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoMC4wLCAwLjAsIDAuMCkgLy8gY2VudGVyXG4gICAqIH0pO1xuICAgKiBiaWxsYm9hcmRzLmFkZCh7XG4gICAqICAgaW1hZ2UgOiAndXJsL3RvL2ltYWdlJyxcbiAgICogICBwb3NpdGlvbiA6IG5ldyBDZXNpdW0uQ2FydGVzaWFuMygxMDAwMDAwLjAsIDAuMCwgMC4wKSAvLyBlYXN0XG4gICAqIH0pO1xuICAgKiBiaWxsYm9hcmRzLmFkZCh7XG4gICAqICAgaW1hZ2UgOiAndXJsL3RvL2ltYWdlJyxcbiAgICogICBwb3NpdGlvbiA6IG5ldyBDZXNpdW0uQ2FydGVzaWFuMygwLjAsIDEwMDAwMDAuMCwgMC4wKSAvLyBub3J0aFxuICAgKiB9KTtcbiAgICogYmlsbGJvYXJkcy5hZGQoe1xuICAgKiAgIGltYWdlIDogJ3VybC90by9pbWFnZScsXG4gICAqICAgcG9zaXRpb24gOiBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoMC4wLCAwLjAsIDEwMDAwMDAuMCkgLy8gdXBcbiAgICogfSk7XG4gICAqXG4gICAqIEBzZWUgVHJhbnNmb3Jtcy5lYXN0Tm9ydGhVcFRvRml4ZWRGcmFtZVxuICAgKi9cbiAgdGhpcy5tb2RlbE1hdHJpeCA9IE1hdHJpeDQuY2xvbmUoXG4gICAgZGVmYXVsdFZhbHVlKG9wdGlvbnMubW9kZWxNYXRyaXgsIE1hdHJpeDQuSURFTlRJVFkpXG4gICk7XG4gIHRoaXMuX21vZGVsTWF0cml4ID0gTWF0cml4NC5jbG9uZShNYXRyaXg0LklERU5USVRZKTtcblxuICAvKipcbiAgICogVGhpcyBwcm9wZXJ0eSBpcyBmb3IgZGVidWdnaW5nIG9ubHk7IGl0IGlzIG5vdCBmb3IgcHJvZHVjdGlvbiB1c2Ugbm9yIGlzIGl0IG9wdGltaXplZC5cbiAgICogPHA+XG4gICAqIERyYXdzIHRoZSBib3VuZGluZyBzcGhlcmUgZm9yIGVhY2ggZHJhdyBjb21tYW5kIGluIHRoZSBwcmltaXRpdmUuXG4gICAqIDwvcD5cbiAgICpcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICB0aGlzLmRlYnVnU2hvd0JvdW5kaW5nVm9sdW1lID0gZGVmYXVsdFZhbHVlKFxuICAgIG9wdGlvbnMuZGVidWdTaG93Qm91bmRpbmdWb2x1bWUsXG4gICAgZmFsc2VcbiAgKTtcblxuICAvKipcbiAgICogVGhpcyBwcm9wZXJ0eSBpcyBmb3IgZGVidWdnaW5nIG9ubHk7IGl0IGlzIG5vdCBmb3IgcHJvZHVjdGlvbiB1c2Ugbm9yIGlzIGl0IG9wdGltaXplZC5cbiAgICogPHA+XG4gICAqIERyYXdzIHRoZSB0ZXh0dXJlIGF0bGFzIGZvciB0aGlzIEJpbGxib2FyZENvbGxlY3Rpb24gYXMgYSBmdWxsc2NyZWVuIHF1YWQuXG4gICAqIDwvcD5cbiAgICpcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICB0aGlzLmRlYnVnU2hvd1RleHR1cmVBdGxhcyA9IGRlZmF1bHRWYWx1ZShcbiAgICBvcHRpb25zLmRlYnVnU2hvd1RleHR1cmVBdGxhcyxcbiAgICBmYWxzZVxuICApO1xuXG4gIC8qKlxuICAgKiBUaGUgYmlsbGJvYXJkIGJsZW5kaW5nIG9wdGlvbi4gVGhlIGRlZmF1bHQgaXMgdXNlZCBmb3IgcmVuZGVyaW5nIGJvdGggb3BhcXVlIGFuZCB0cmFuc2x1Y2VudCBiaWxsYm9hcmRzLlxuICAgKiBIb3dldmVyLCBpZiBlaXRoZXIgYWxsIG9mIHRoZSBiaWxsYm9hcmRzIGFyZSBjb21wbGV0ZWx5IG9wYXF1ZSBvciBhbGwgYXJlIGNvbXBsZXRlbHkgdHJhbnNsdWNlbnQsXG4gICAqIHNldHRpbmcgdGhlIHRlY2huaXF1ZSB0byBCbGVuZE9wdGlvbi5PUEFRVUUgb3IgQmxlbmRPcHRpb24uVFJBTlNMVUNFTlQgY2FuIGltcHJvdmVcbiAgICogcGVyZm9ybWFuY2UgYnkgdXAgdG8gMnguXG4gICAqIEB0eXBlIHtCbGVuZE9wdGlvbn1cbiAgICogQGRlZmF1bHQgQmxlbmRPcHRpb24uT1BBUVVFX0FORF9UUkFOU0xVQ0VOVFxuICAgKi9cbiAgdGhpcy5ibGVuZE9wdGlvbiA9IGRlZmF1bHRWYWx1ZShcbiAgICBvcHRpb25zLmJsZW5kT3B0aW9uLFxuICAgIEJsZW5kT3B0aW9uLk9QQVFVRV9BTkRfVFJBTlNMVUNFTlRcbiAgKTtcbiAgdGhpcy5fYmxlbmRPcHRpb24gPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fbW9kZSA9IFNjZW5lTW9kZS5TQ0VORTNEO1xuXG4gIC8vIFRoZSBidWZmZXIgdXNhZ2UgZm9yIGVhY2ggYXR0cmlidXRlIGlzIGRldGVybWluZWQgYmFzZWQgb24gdGhlIHVzYWdlIG9mIHRoZSBhdHRyaWJ1dGUgb3ZlciB0aW1lLlxuICB0aGlzLl9idWZmZXJzVXNhZ2UgPSBbXG4gICAgQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsIC8vIFNIT1dfSU5ERVhcbiAgICBCdWZmZXJVc2FnZS5TVEFUSUNfRFJBVywgLy8gUE9TSVRJT05fSU5ERVhcbiAgICBCdWZmZXJVc2FnZS5TVEFUSUNfRFJBVywgLy8gUElYRUxfT0ZGU0VUX0lOREVYXG4gICAgQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsIC8vIEVZRV9PRkZTRVRfSU5ERVhcbiAgICBCdWZmZXJVc2FnZS5TVEFUSUNfRFJBVywgLy8gSE9SSVpPTlRBTF9PUklHSU5fSU5ERVhcbiAgICBCdWZmZXJVc2FnZS5TVEFUSUNfRFJBVywgLy8gVkVSVElDQUxfT1JJR0lOX0lOREVYXG4gICAgQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsIC8vIFNDQUxFX0lOREVYXG4gICAgQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsIC8vIElNQUdFX0lOREVYX0lOREVYXG4gICAgQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsIC8vIENPTE9SX0lOREVYXG4gICAgQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsIC8vIFJPVEFUSU9OX0lOREVYXG4gICAgQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsIC8vIEFMSUdORURfQVhJU19JTkRFWFxuICAgIEJ1ZmZlclVzYWdlLlNUQVRJQ19EUkFXLCAvLyBTQ0FMRV9CWV9ESVNUQU5DRV9JTkRFWFxuICAgIEJ1ZmZlclVzYWdlLlNUQVRJQ19EUkFXLCAvLyBUUkFOU0xVQ0VOQ1lfQllfRElTVEFOQ0VfSU5ERVhcbiAgICBCdWZmZXJVc2FnZS5TVEFUSUNfRFJBVywgLy8gUElYRUxfT0ZGU0VUX1NDQUxFX0JZX0RJU1RBTkNFX0lOREVYXG4gICAgQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsIC8vIERJU1RBTkNFX0RJU1BMQVlfQ09ORElUSU9OX0lOREVYXG4gICAgQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsIC8vIFRFWFRVUkVfQ09PUkRJTkFURV9CT1VORFNcbiAgXTtcblxuICB0aGlzLl9oaWdobGlnaHRDb2xvciA9IENvbG9yLmNsb25lKENvbG9yLldISVRFKTsgLy8gT25seSB1c2VkIGJ5IFZlY3RvcjNEVGlsZVBvaW50c1xuXG4gIHZhciB0aGF0ID0gdGhpcztcbiAgdGhpcy5fdW5pZm9ybXMgPSB7XG4gICAgdV9hdGxhczogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoYXQuX3RleHR1cmVBdGxhcy50ZXh0dXJlO1xuICAgIH0sXG4gICAgdV9oaWdobGlnaHRDb2xvcjogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoYXQuX2hpZ2hsaWdodENvbG9yO1xuICAgIH0sXG4gIH07XG5cbiAgdmFyIHNjZW5lID0gdGhpcy5fc2NlbmU7XG4gIGlmIChkZWZpbmVkKHNjZW5lKSAmJiBkZWZpbmVkKHNjZW5lLnRlcnJhaW5Qcm92aWRlckNoYW5nZWQpKSB7XG4gICAgdGhpcy5fcmVtb3ZlQ2FsbGJhY2tGdW5jID0gc2NlbmUudGVycmFpblByb3ZpZGVyQ2hhbmdlZC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYmlsbGJvYXJkcyA9IHRoaXMuX2JpbGxib2FyZHM7XG4gICAgICAgIHZhciBsZW5ndGggPSBiaWxsYm9hcmRzLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgICAgIGlmIChkZWZpbmVkKGJpbGxib2FyZHNbaV0pKSB7XG4gICAgICAgICAgICBiaWxsYm9hcmRzW2ldLl91cGRhdGVDbGFtcGluZygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRoaXNcbiAgICApO1xuICB9XG59XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEJpbGxib2FyZENvbGxlY3Rpb24ucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgYmlsbGJvYXJkcyBpbiB0aGlzIGNvbGxlY3Rpb24uICBUaGlzIGlzIGNvbW1vbmx5IHVzZWQgd2l0aFxuICAgKiB7QGxpbmsgQmlsbGJvYXJkQ29sbGVjdGlvbiNnZXR9IHRvIGl0ZXJhdGUgb3ZlciBhbGwgdGhlIGJpbGxib2FyZHNcbiAgICogaW4gdGhlIGNvbGxlY3Rpb24uXG4gICAqIEBtZW1iZXJvZiBCaWxsYm9hcmRDb2xsZWN0aW9uLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKi9cbiAgbGVuZ3RoOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZW1vdmVCaWxsYm9hcmRzKHRoaXMpO1xuICAgICAgcmV0dXJuIHRoaXMuX2JpbGxib2FyZHMubGVuZ3RoO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyB0aGUgdGV4dHVyZUF0bGFzLlxuICAgKiBAbWVtYmVyb2YgQmlsbGJvYXJkQ29sbGVjdGlvbi5wcm90b3R5cGVcbiAgICogQHR5cGUge1RleHR1cmVBdGxhc31cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRleHR1cmVBdGxhczoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3RleHR1cmVBdGxhcztcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICBpZiAodGhpcy5fdGV4dHVyZUF0bGFzICE9PSB2YWx1ZSkge1xuICAgICAgICB0aGlzLl90ZXh0dXJlQXRsYXMgPVxuICAgICAgICAgIHRoaXMuX2Rlc3Ryb3lUZXh0dXJlQXRsYXMgJiZcbiAgICAgICAgICB0aGlzLl90ZXh0dXJlQXRsYXMgJiZcbiAgICAgICAgICB0aGlzLl90ZXh0dXJlQXRsYXMuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLl90ZXh0dXJlQXRsYXMgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fY3JlYXRlVmVydGV4QXJyYXkgPSB0cnVlOyAvLyBOZXcgcGVyLWJpbGxib2FyZCB0ZXh0dXJlIGNvb3JkaW5hdGVzXG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIGEgdmFsdWUgd2hpY2ggZGV0ZXJtaW5lcyBpZiB0aGUgdGV4dHVyZSBhdGxhcyBpc1xuICAgKiBkZXN0cm95ZWQgd2hlbiB0aGUgY29sbGVjdGlvbiBpcyBkZXN0cm95ZWQuXG4gICAqXG4gICAqIElmIHRoZSB0ZXh0dXJlIGF0bGFzIGlzIHVzZWQgYnkgbW9yZSB0aGFuIG9uZSBjb2xsZWN0aW9uLCBzZXQgdGhpcyB0byA8Y29kZT5mYWxzZTwvY29kZT4sXG4gICAqIGFuZCBleHBsaWNpdGx5IGRlc3Ryb3kgdGhlIGF0bGFzIHRvIGF2b2lkIGF0dGVtcHRpbmcgdG8gZGVzdHJveSBpdCBtdWx0aXBsZSB0aW1lcy5cbiAgICpcbiAgICogQG1lbWJlcm9mIEJpbGxib2FyZENvbGxlY3Rpb24ucHJvdG90eXBlXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAcHJpdmF0ZVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBTZXQgZGVzdHJveVRleHR1cmVBdGxhc1xuICAgKiAvLyBEZXN0cm95IGEgYmlsbGJvYXJkIGNvbGxlY3Rpb24gYnV0IG5vdCBpdHMgdGV4dHVyZSBhdGxhcy5cbiAgICpcbiAgICogdmFyIGF0bGFzID0gbmV3IFRleHR1cmVBdGxhcyh7XG4gICAqICAgc2NlbmUgOiBzY2VuZSxcbiAgICogICBpbWFnZXMgOiBpbWFnZXNcbiAgICogfSk7XG4gICAqIGJpbGxib2FyZHMudGV4dHVyZUF0bGFzID0gYXRsYXM7XG4gICAqIGJpbGxib2FyZHMuZGVzdHJveVRleHR1cmVBdGxhcyA9IGZhbHNlO1xuICAgKiBiaWxsYm9hcmRzID0gYmlsbGJvYXJkcy5kZXN0cm95KCk7XG4gICAqIGNvbnNvbGUubG9nKGF0bGFzLmlzRGVzdHJveWVkKCkpOyAvLyBGYWxzZVxuICAgKi9cbiAgZGVzdHJveVRleHR1cmVBdGxhczoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2Rlc3Ryb3lUZXh0dXJlQXRsYXM7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5fZGVzdHJveVRleHR1cmVBdGxhcyA9IHZhbHVlO1xuICAgIH0sXG4gIH0sXG59KTtcblxuZnVuY3Rpb24gZGVzdHJveUJpbGxib2FyZHMoYmlsbGJvYXJkcykge1xuICB2YXIgbGVuZ3RoID0gYmlsbGJvYXJkcy5sZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICBpZiAoYmlsbGJvYXJkc1tpXSkge1xuICAgICAgYmlsbGJvYXJkc1tpXS5fZGVzdHJveSgpO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYW5kIGFkZHMgYSBiaWxsYm9hcmQgd2l0aCB0aGUgc3BlY2lmaWVkIGluaXRpYWwgcHJvcGVydGllcyB0byB0aGUgY29sbGVjdGlvbi5cbiAqIFRoZSBhZGRlZCBiaWxsYm9hcmQgaXMgcmV0dXJuZWQgc28gaXQgY2FuIGJlIG1vZGlmaWVkIG9yIHJlbW92ZWQgZnJvbSB0aGUgY29sbGVjdGlvbiBsYXRlci5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH1bb3B0aW9uc10gQSB0ZW1wbGF0ZSBkZXNjcmliaW5nIHRoZSBiaWxsYm9hcmQncyBwcm9wZXJ0aWVzIGFzIHNob3duIGluIEV4YW1wbGUgMS5cbiAqIEByZXR1cm5zIHtCaWxsYm9hcmR9IFRoZSBiaWxsYm9hcmQgdGhhdCB3YXMgYWRkZWQgdG8gdGhlIGNvbGxlY3Rpb24uXG4gKlxuICogQHBlcmZvcm1hbmNlIENhbGxpbmcgPGNvZGU+YWRkPC9jb2RlPiBpcyBleHBlY3RlZCBjb25zdGFudCB0aW1lLiAgSG93ZXZlciwgdGhlIGNvbGxlY3Rpb24ncyB2ZXJ0ZXggYnVmZmVyXG4gKiBpcyByZXdyaXR0ZW4gLSBhbiA8Y29kZT5PKG4pPC9jb2RlPiBvcGVyYXRpb24gdGhhdCBhbHNvIGluY3VycyBDUFUgdG8gR1BVIG92ZXJoZWFkLiAgRm9yXG4gKiBiZXN0IHBlcmZvcm1hbmNlLCBhZGQgYXMgbWFueSBiaWxsYm9hcmRzIGFzIHBvc3NpYmxlIGJlZm9yZSBjYWxsaW5nIDxjb2RlPnVwZGF0ZTwvY29kZT4uXG4gKlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IFRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQsIGkuZS4sIGRlc3Ryb3koKSB3YXMgY2FsbGVkLlxuICpcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gRXhhbXBsZSAxOiAgQWRkIGEgYmlsbGJvYXJkLCBzcGVjaWZ5aW5nIGFsbCB0aGUgZGVmYXVsdCB2YWx1ZXMuXG4gKiB2YXIgYiA9IGJpbGxib2FyZHMuYWRkKHtcbiAqICAgc2hvdyA6IHRydWUsXG4gKiAgIHBvc2l0aW9uIDogQ2VzaXVtLkNhcnRlc2lhbjMuWkVSTyxcbiAqICAgcGl4ZWxPZmZzZXQgOiBDZXNpdW0uQ2FydGVzaWFuMi5aRVJPLFxuICogICBleWVPZmZzZXQgOiBDZXNpdW0uQ2FydGVzaWFuMy5aRVJPLFxuICogICBoZWlnaHRSZWZlcmVuY2UgOiBDZXNpdW0uSGVpZ2h0UmVmZXJlbmNlLk5PTkUsXG4gKiAgIGhvcml6b250YWxPcmlnaW4gOiBDZXNpdW0uSG9yaXpvbnRhbE9yaWdpbi5DRU5URVIsXG4gKiAgIHZlcnRpY2FsT3JpZ2luIDogQ2VzaXVtLlZlcnRpY2FsT3JpZ2luLkNFTlRFUixcbiAqICAgc2NhbGUgOiAxLjAsXG4gKiAgIGltYWdlIDogJ3VybC90by9pbWFnZScsXG4gKiAgIGltYWdlU3ViUmVnaW9uIDogdW5kZWZpbmVkLFxuICogICBjb2xvciA6IENlc2l1bS5Db2xvci5XSElURSxcbiAqICAgaWQgOiB1bmRlZmluZWQsXG4gKiAgIHJvdGF0aW9uIDogMC4wLFxuICogICBhbGlnbmVkQXhpcyA6IENlc2l1bS5DYXJ0ZXNpYW4zLlpFUk8sXG4gKiAgIHdpZHRoIDogdW5kZWZpbmVkLFxuICogICBoZWlnaHQgOiB1bmRlZmluZWQsXG4gKiAgIHNjYWxlQnlEaXN0YW5jZSA6IHVuZGVmaW5lZCxcbiAqICAgdHJhbnNsdWNlbmN5QnlEaXN0YW5jZSA6IHVuZGVmaW5lZCxcbiAqICAgcGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2UgOiB1bmRlZmluZWQsXG4gKiAgIHNpemVJbk1ldGVycyA6IGZhbHNlLFxuICogICBkaXN0YW5jZURpc3BsYXlDb25kaXRpb24gOiB1bmRlZmluZWRcbiAqIH0pO1xuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBFeGFtcGxlIDI6ICBTcGVjaWZ5IG9ubHkgdGhlIGJpbGxib2FyZCdzIGNhcnRvZ3JhcGhpYyBwb3NpdGlvbi5cbiAqIHZhciBiID0gYmlsbGJvYXJkcy5hZGQoe1xuICogICBwb3NpdGlvbiA6IENlc2l1bS5DYXJ0ZXNpYW4zLmZyb21EZWdyZWVzKGxvbmdpdHVkZSwgbGF0aXR1ZGUsIGhlaWdodClcbiAqIH0pO1xuICpcbiAqIEBzZWUgQmlsbGJvYXJkQ29sbGVjdGlvbiNyZW1vdmVcbiAqIEBzZWUgQmlsbGJvYXJkQ29sbGVjdGlvbiNyZW1vdmVBbGxcbiAqL1xuQmlsbGJvYXJkQ29sbGVjdGlvbi5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgdmFyIGJpbGxib2FyZCA9IG5ldyBCaWxsYm9hcmQob3B0aW9ucywgdGhpcyk7XG4gIGJpbGxib2FyZC5faW5kZXggPSB0aGlzLl9iaWxsYm9hcmRzLmxlbmd0aDtcblxuICB0aGlzLl9iaWxsYm9hcmRzLnB1c2goYmlsbGJvYXJkKTtcbiAgdGhpcy5fY3JlYXRlVmVydGV4QXJyYXkgPSB0cnVlO1xuXG4gIHJldHVybiBiaWxsYm9hcmQ7XG59O1xuXG4vKipcbiAqIFJlbW92ZXMgYSBiaWxsYm9hcmQgZnJvbSB0aGUgY29sbGVjdGlvbi5cbiAqXG4gKiBAcGFyYW0ge0JpbGxib2FyZH0gYmlsbGJvYXJkIFRoZSBiaWxsYm9hcmQgdG8gcmVtb3ZlLlxuICogQHJldHVybnMge0Jvb2xlYW59IDxjb2RlPnRydWU8L2NvZGU+IGlmIHRoZSBiaWxsYm9hcmQgd2FzIHJlbW92ZWQ7IDxjb2RlPmZhbHNlPC9jb2RlPiBpZiB0aGUgYmlsbGJvYXJkIHdhcyBub3QgZm91bmQgaW4gdGhlIGNvbGxlY3Rpb24uXG4gKlxuICogQHBlcmZvcm1hbmNlIENhbGxpbmcgPGNvZGU+cmVtb3ZlPC9jb2RlPiBpcyBleHBlY3RlZCBjb25zdGFudCB0aW1lLiAgSG93ZXZlciwgdGhlIGNvbGxlY3Rpb24ncyB2ZXJ0ZXggYnVmZmVyXG4gKiBpcyByZXdyaXR0ZW4gLSBhbiA8Y29kZT5PKG4pPC9jb2RlPiBvcGVyYXRpb24gdGhhdCBhbHNvIGluY3VycyBDUFUgdG8gR1BVIG92ZXJoZWFkLiAgRm9yXG4gKiBiZXN0IHBlcmZvcm1hbmNlLCByZW1vdmUgYXMgbWFueSBiaWxsYm9hcmRzIGFzIHBvc3NpYmxlIGJlZm9yZSBjYWxsaW5nIDxjb2RlPnVwZGF0ZTwvY29kZT4uXG4gKiBJZiB5b3UgaW50ZW5kIHRvIHRlbXBvcmFyaWx5IGhpZGUgYSBiaWxsYm9hcmQsIGl0IGlzIHVzdWFsbHkgbW9yZSBlZmZpY2llbnQgdG8gY2FsbFxuICoge0BsaW5rIEJpbGxib2FyZCNzaG93fSBpbnN0ZWFkIG9mIHJlbW92aW5nIGFuZCByZS1hZGRpbmcgdGhlIGJpbGxib2FyZC5cbiAqXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gVGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZCwgaS5lLiwgZGVzdHJveSgpIHdhcyBjYWxsZWQuXG4gKlxuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgYiA9IGJpbGxib2FyZHMuYWRkKC4uLik7XG4gKiBiaWxsYm9hcmRzLnJlbW92ZShiKTsgIC8vIFJldHVybnMgdHJ1ZVxuICpcbiAqIEBzZWUgQmlsbGJvYXJkQ29sbGVjdGlvbiNhZGRcbiAqIEBzZWUgQmlsbGJvYXJkQ29sbGVjdGlvbiNyZW1vdmVBbGxcbiAqIEBzZWUgQmlsbGJvYXJkI3Nob3dcbiAqL1xuQmlsbGJvYXJkQ29sbGVjdGlvbi5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGJpbGxib2FyZCkge1xuICBpZiAodGhpcy5jb250YWlucyhiaWxsYm9hcmQpKSB7XG4gICAgdGhpcy5fYmlsbGJvYXJkc1tiaWxsYm9hcmQuX2luZGV4XSA9IHVuZGVmaW5lZDsgLy8gUmVtb3ZlZCBsYXRlclxuICAgIHRoaXMuX2JpbGxib2FyZHNSZW1vdmVkID0gdHJ1ZTtcbiAgICB0aGlzLl9jcmVhdGVWZXJ0ZXhBcnJheSA9IHRydWU7XG4gICAgYmlsbGJvYXJkLl9kZXN0cm95KCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKipcbiAqIFJlbW92ZXMgYWxsIGJpbGxib2FyZHMgZnJvbSB0aGUgY29sbGVjdGlvbi5cbiAqXG4gKiBAcGVyZm9ybWFuY2UgPGNvZGU+TyhuKTwvY29kZT4uICBJdCBpcyBtb3JlIGVmZmljaWVudCB0byByZW1vdmUgYWxsIHRoZSBiaWxsYm9hcmRzXG4gKiBmcm9tIGEgY29sbGVjdGlvbiBhbmQgdGhlbiBhZGQgbmV3IG9uZXMgdGhhbiB0byBjcmVhdGUgYSBuZXcgY29sbGVjdGlvbiBlbnRpcmVseS5cbiAqXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gVGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZCwgaS5lLiwgZGVzdHJveSgpIHdhcyBjYWxsZWQuXG4gKlxuICpcbiAqIEBleGFtcGxlXG4gKiBiaWxsYm9hcmRzLmFkZCguLi4pO1xuICogYmlsbGJvYXJkcy5hZGQoLi4uKTtcbiAqIGJpbGxib2FyZHMucmVtb3ZlQWxsKCk7XG4gKlxuICogQHNlZSBCaWxsYm9hcmRDb2xsZWN0aW9uI2FkZFxuICogQHNlZSBCaWxsYm9hcmRDb2xsZWN0aW9uI3JlbW92ZVxuICovXG5CaWxsYm9hcmRDb2xsZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbiAoKSB7XG4gIGRlc3Ryb3lCaWxsYm9hcmRzKHRoaXMuX2JpbGxib2FyZHMpO1xuICB0aGlzLl9iaWxsYm9hcmRzID0gW107XG4gIHRoaXMuX2JpbGxib2FyZHNUb1VwZGF0ZSA9IFtdO1xuICB0aGlzLl9iaWxsYm9hcmRzVG9VcGRhdGVJbmRleCA9IDA7XG4gIHRoaXMuX2JpbGxib2FyZHNSZW1vdmVkID0gZmFsc2U7XG5cbiAgdGhpcy5fY3JlYXRlVmVydGV4QXJyYXkgPSB0cnVlO1xufTtcblxuZnVuY3Rpb24gcmVtb3ZlQmlsbGJvYXJkcyhiaWxsYm9hcmRDb2xsZWN0aW9uKSB7XG4gIGlmIChiaWxsYm9hcmRDb2xsZWN0aW9uLl9iaWxsYm9hcmRzUmVtb3ZlZCkge1xuICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX2JpbGxib2FyZHNSZW1vdmVkID0gZmFsc2U7XG5cbiAgICB2YXIgbmV3QmlsbGJvYXJkcyA9IFtdO1xuICAgIHZhciBiaWxsYm9hcmRzID0gYmlsbGJvYXJkQ29sbGVjdGlvbi5fYmlsbGJvYXJkcztcbiAgICB2YXIgbGVuZ3RoID0gYmlsbGJvYXJkcy5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IDAsIGogPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBiaWxsYm9hcmQgPSBiaWxsYm9hcmRzW2ldO1xuICAgICAgaWYgKGRlZmluZWQoYmlsbGJvYXJkKSkge1xuICAgICAgICBiaWxsYm9hcmQuX2luZGV4ID0gaisrO1xuICAgICAgICBuZXdCaWxsYm9hcmRzLnB1c2goYmlsbGJvYXJkKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9iaWxsYm9hcmRzID0gbmV3QmlsbGJvYXJkcztcbiAgfVxufVxuXG5CaWxsYm9hcmRDb2xsZWN0aW9uLnByb3RvdHlwZS5fdXBkYXRlQmlsbGJvYXJkID0gZnVuY3Rpb24gKFxuICBiaWxsYm9hcmQsXG4gIHByb3BlcnR5Q2hhbmdlZFxuKSB7XG4gIGlmICghYmlsbGJvYXJkLl9kaXJ0eSkge1xuICAgIHRoaXMuX2JpbGxib2FyZHNUb1VwZGF0ZVt0aGlzLl9iaWxsYm9hcmRzVG9VcGRhdGVJbmRleCsrXSA9IGJpbGxib2FyZDtcbiAgfVxuXG4gICsrdGhpcy5fcHJvcGVydGllc0NoYW5nZWRbcHJvcGVydHlDaGFuZ2VkXTtcbn07XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciB0aGlzIGNvbGxlY3Rpb24gY29udGFpbnMgYSBnaXZlbiBiaWxsYm9hcmQuXG4gKlxuICogQHBhcmFtIHtCaWxsYm9hcmR9IFtiaWxsYm9hcmRdIFRoZSBiaWxsYm9hcmQgdG8gY2hlY2sgZm9yLlxuICogQHJldHVybnMge0Jvb2xlYW59IHRydWUgaWYgdGhpcyBjb2xsZWN0aW9uIGNvbnRhaW5zIHRoZSBiaWxsYm9hcmQsIGZhbHNlIG90aGVyd2lzZS5cbiAqXG4gKiBAc2VlIEJpbGxib2FyZENvbGxlY3Rpb24jZ2V0XG4gKi9cbkJpbGxib2FyZENvbGxlY3Rpb24ucHJvdG90eXBlLmNvbnRhaW5zID0gZnVuY3Rpb24gKGJpbGxib2FyZCkge1xuICByZXR1cm4gZGVmaW5lZChiaWxsYm9hcmQpICYmIGJpbGxib2FyZC5fYmlsbGJvYXJkQ29sbGVjdGlvbiA9PT0gdGhpcztcbn07XG5cbi8qKlxuICogUmV0dXJucyB0aGUgYmlsbGJvYXJkIGluIHRoZSBjb2xsZWN0aW9uIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXguICBJbmRpY2VzIGFyZSB6ZXJvLWJhc2VkXG4gKiBhbmQgaW5jcmVhc2UgYXMgYmlsbGJvYXJkcyBhcmUgYWRkZWQuICBSZW1vdmluZyBhIGJpbGxib2FyZCBzaGlmdHMgYWxsIGJpbGxib2FyZHMgYWZ0ZXJcbiAqIGl0IHRvIHRoZSBsZWZ0LCBjaGFuZ2luZyB0aGVpciBpbmRpY2VzLiAgVGhpcyBmdW5jdGlvbiBpcyBjb21tb25seSB1c2VkIHdpdGhcbiAqIHtAbGluayBCaWxsYm9hcmRDb2xsZWN0aW9uI2xlbmd0aH0gdG8gaXRlcmF0ZSBvdmVyIGFsbCB0aGUgYmlsbGJvYXJkc1xuICogaW4gdGhlIGNvbGxlY3Rpb24uXG4gKlxuICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4IFRoZSB6ZXJvLWJhc2VkIGluZGV4IG9mIHRoZSBiaWxsYm9hcmQuXG4gKiBAcmV0dXJucyB7QmlsbGJvYXJkfSBUaGUgYmlsbGJvYXJkIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXguXG4gKlxuICogQHBlcmZvcm1hbmNlIEV4cGVjdGVkIGNvbnN0YW50IHRpbWUuICBJZiBiaWxsYm9hcmRzIHdlcmUgcmVtb3ZlZCBmcm9tIHRoZSBjb2xsZWN0aW9uIGFuZFxuICoge0BsaW5rIEJpbGxib2FyZENvbGxlY3Rpb24jdXBkYXRlfSB3YXMgbm90IGNhbGxlZCwgYW4gaW1wbGljaXQgPGNvZGU+TyhuKTwvY29kZT5cbiAqIG9wZXJhdGlvbiBpcyBwZXJmb3JtZWQuXG4gKlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IFRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQsIGkuZS4sIGRlc3Ryb3koKSB3YXMgY2FsbGVkLlxuICpcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gVG9nZ2xlIHRoZSBzaG93IHByb3BlcnR5IG9mIGV2ZXJ5IGJpbGxib2FyZCBpbiB0aGUgY29sbGVjdGlvblxuICogdmFyIGxlbiA9IGJpbGxib2FyZHMubGVuZ3RoO1xuICogZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSkge1xuICogICB2YXIgYiA9IGJpbGxib2FyZHMuZ2V0KGkpO1xuICogICBiLnNob3cgPSAhYi5zaG93O1xuICogfVxuICpcbiAqIEBzZWUgQmlsbGJvYXJkQ29sbGVjdGlvbiNsZW5ndGhcbiAqL1xuQmlsbGJvYXJkQ29sbGVjdGlvbi5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gIENoZWNrLnR5cGVPZi5udW1iZXIoXCJpbmRleFwiLCBpbmRleCk7XG4gIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gIHJlbW92ZUJpbGxib2FyZHModGhpcyk7XG4gIHJldHVybiB0aGlzLl9iaWxsYm9hcmRzW2luZGV4XTtcbn07XG5cbnZhciBnZXRJbmRleEJ1ZmZlcjtcblxuZnVuY3Rpb24gZ2V0SW5kZXhCdWZmZXJCYXRjaGVkKGNvbnRleHQpIHtcbiAgdmFyIHNpeHRlZW5LID0gMTYgKiAxMDI0O1xuXG4gIHZhciBpbmRleEJ1ZmZlciA9IGNvbnRleHQuY2FjaGUuYmlsbGJvYXJkQ29sbGVjdGlvbl9pbmRleEJ1ZmZlckJhdGNoZWQ7XG4gIGlmIChkZWZpbmVkKGluZGV4QnVmZmVyKSkge1xuICAgIHJldHVybiBpbmRleEJ1ZmZlcjtcbiAgfVxuXG4gIC8vIFN1YnRyYWN0IDYgYmVjYXVzZSB0aGUgbGFzdCBpbmRleCBpcyByZXNlcnZlcmQgZm9yIHByaW1pdGl2ZSByZXN0YXJ0LlxuICAvLyBodHRwczovL3d3dy5raHJvbm9zLm9yZy9yZWdpc3RyeS93ZWJnbC9zcGVjcy9sYXRlc3QvMi4wLyM1LjE4XG4gIHZhciBsZW5ndGggPSBzaXh0ZWVuSyAqIDYgLSA2O1xuICB2YXIgaW5kaWNlcyA9IG5ldyBVaW50MTZBcnJheShsZW5ndGgpO1xuICBmb3IgKHZhciBpID0gMCwgaiA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gNiwgaiArPSA0KSB7XG4gICAgaW5kaWNlc1tpXSA9IGo7XG4gICAgaW5kaWNlc1tpICsgMV0gPSBqICsgMTtcbiAgICBpbmRpY2VzW2kgKyAyXSA9IGogKyAyO1xuXG4gICAgaW5kaWNlc1tpICsgM10gPSBqICsgMDtcbiAgICBpbmRpY2VzW2kgKyA0XSA9IGogKyAyO1xuICAgIGluZGljZXNbaSArIDVdID0gaiArIDM7XG4gIH1cblxuICAvLyBQRVJGT1JNQU5DRV9JREVBOiAgU2hvdWxkIHdlIHJlZmVyZW5jZSBjb3VudCBiaWxsYm9hcmQgY29sbGVjdGlvbnMsIGFuZCBldmVudHVhbGx5IGRlbGV0ZSB0aGlzP1xuICAvLyBJcyB0aGlzIHRvbyBtdWNoIG1lbW9yeSB0byBhbGxvY2F0ZSB1cCBmcm9udD8gIFNob3VsZCB3ZSBkeW5hbWljYWxseSBncm93IGl0P1xuICBpbmRleEJ1ZmZlciA9IEJ1ZmZlci5jcmVhdGVJbmRleEJ1ZmZlcih7XG4gICAgY29udGV4dDogY29udGV4dCxcbiAgICB0eXBlZEFycmF5OiBpbmRpY2VzLFxuICAgIHVzYWdlOiBCdWZmZXJVc2FnZS5TVEFUSUNfRFJBVyxcbiAgICBpbmRleERhdGF0eXBlOiBJbmRleERhdGF0eXBlLlVOU0lHTkVEX1NIT1JULFxuICB9KTtcbiAgaW5kZXhCdWZmZXIudmVydGV4QXJyYXlEZXN0cm95YWJsZSA9IGZhbHNlO1xuICBjb250ZXh0LmNhY2hlLmJpbGxib2FyZENvbGxlY3Rpb25faW5kZXhCdWZmZXJCYXRjaGVkID0gaW5kZXhCdWZmZXI7XG4gIHJldHVybiBpbmRleEJ1ZmZlcjtcbn1cblxuZnVuY3Rpb24gZ2V0SW5kZXhCdWZmZXJJbnN0YW5jZWQoY29udGV4dCkge1xuICB2YXIgaW5kZXhCdWZmZXIgPSBjb250ZXh0LmNhY2hlLmJpbGxib2FyZENvbGxlY3Rpb25faW5kZXhCdWZmZXJJbnN0YW5jZWQ7XG4gIGlmIChkZWZpbmVkKGluZGV4QnVmZmVyKSkge1xuICAgIHJldHVybiBpbmRleEJ1ZmZlcjtcbiAgfVxuXG4gIGluZGV4QnVmZmVyID0gQnVmZmVyLmNyZWF0ZUluZGV4QnVmZmVyKHtcbiAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIHR5cGVkQXJyYXk6IG5ldyBVaW50MTZBcnJheShbMCwgMSwgMiwgMCwgMiwgM10pLFxuICAgIHVzYWdlOiBCdWZmZXJVc2FnZS5TVEFUSUNfRFJBVyxcbiAgICBpbmRleERhdGF0eXBlOiBJbmRleERhdGF0eXBlLlVOU0lHTkVEX1NIT1JULFxuICB9KTtcblxuICBpbmRleEJ1ZmZlci52ZXJ0ZXhBcnJheURlc3Ryb3lhYmxlID0gZmFsc2U7XG4gIGNvbnRleHQuY2FjaGUuYmlsbGJvYXJkQ29sbGVjdGlvbl9pbmRleEJ1ZmZlckluc3RhbmNlZCA9IGluZGV4QnVmZmVyO1xuICByZXR1cm4gaW5kZXhCdWZmZXI7XG59XG5cbmZ1bmN0aW9uIGdldFZlcnRleEJ1ZmZlckluc3RhbmNlZChjb250ZXh0KSB7XG4gIHZhciB2ZXJ0ZXhCdWZmZXIgPSBjb250ZXh0LmNhY2hlLmJpbGxib2FyZENvbGxlY3Rpb25fdmVydGV4QnVmZmVySW5zdGFuY2VkO1xuICBpZiAoZGVmaW5lZCh2ZXJ0ZXhCdWZmZXIpKSB7XG4gICAgcmV0dXJuIHZlcnRleEJ1ZmZlcjtcbiAgfVxuXG4gIHZlcnRleEJ1ZmZlciA9IEJ1ZmZlci5jcmVhdGVWZXJ0ZXhCdWZmZXIoe1xuICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgdHlwZWRBcnJheTogbmV3IEZsb2F0MzJBcnJheShbMC4wLCAwLjAsIDEuMCwgMC4wLCAxLjAsIDEuMCwgMC4wLCAxLjBdKSxcbiAgICB1c2FnZTogQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsXG4gIH0pO1xuXG4gIHZlcnRleEJ1ZmZlci52ZXJ0ZXhBcnJheURlc3Ryb3lhYmxlID0gZmFsc2U7XG4gIGNvbnRleHQuY2FjaGUuYmlsbGJvYXJkQ29sbGVjdGlvbl92ZXJ0ZXhCdWZmZXJJbnN0YW5jZWQgPSB2ZXJ0ZXhCdWZmZXI7XG4gIHJldHVybiB2ZXJ0ZXhCdWZmZXI7XG59XG5cbkJpbGxib2FyZENvbGxlY3Rpb24ucHJvdG90eXBlLmNvbXB1dGVOZXdCdWZmZXJzVXNhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBidWZmZXJzVXNhZ2UgPSB0aGlzLl9idWZmZXJzVXNhZ2U7XG4gIHZhciB1c2FnZUNoYW5nZWQgPSBmYWxzZTtcblxuICB2YXIgcHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXNDaGFuZ2VkO1xuICBmb3IgKHZhciBrID0gMDsgayA8IE5VTUJFUl9PRl9QUk9QRVJUSUVTOyArK2spIHtcbiAgICB2YXIgbmV3VXNhZ2UgPVxuICAgICAgcHJvcGVydGllc1trXSA9PT0gMCA/IEJ1ZmZlclVzYWdlLlNUQVRJQ19EUkFXIDogQnVmZmVyVXNhZ2UuU1RSRUFNX0RSQVc7XG4gICAgdXNhZ2VDaGFuZ2VkID0gdXNhZ2VDaGFuZ2VkIHx8IGJ1ZmZlcnNVc2FnZVtrXSAhPT0gbmV3VXNhZ2U7XG4gICAgYnVmZmVyc1VzYWdlW2tdID0gbmV3VXNhZ2U7XG4gIH1cblxuICByZXR1cm4gdXNhZ2VDaGFuZ2VkO1xufTtcblxuZnVuY3Rpb24gY3JlYXRlVkFGKFxuICBjb250ZXh0LFxuICBudW1iZXJPZkJpbGxib2FyZHMsXG4gIGJ1ZmZlcnNVc2FnZSxcbiAgaW5zdGFuY2VkLFxuICBiYXRjaFRhYmxlLFxuICBzZGZcbikge1xuICB2YXIgYXR0cmlidXRlcyA9IFtcbiAgICB7XG4gICAgICBpbmRleDogYXR0cmlidXRlTG9jYXRpb25zLnBvc2l0aW9uSGlnaEFuZFNjYWxlLFxuICAgICAgY29tcG9uZW50c1BlckF0dHJpYnV0ZTogNCxcbiAgICAgIGNvbXBvbmVudERhdGF0eXBlOiBDb21wb25lbnREYXRhdHlwZS5GTE9BVCxcbiAgICAgIHVzYWdlOiBidWZmZXJzVXNhZ2VbUE9TSVRJT05fSU5ERVhdLFxuICAgIH0sXG4gICAge1xuICAgICAgaW5kZXg6IGF0dHJpYnV0ZUxvY2F0aW9ucy5wb3NpdGlvbkxvd0FuZFJvdGF0aW9uLFxuICAgICAgY29tcG9uZW50c1BlckF0dHJpYnV0ZTogNCxcbiAgICAgIGNvbXBvbmVudERhdGF0eXBlOiBDb21wb25lbnREYXRhdHlwZS5GTE9BVCxcbiAgICAgIHVzYWdlOiBidWZmZXJzVXNhZ2VbUE9TSVRJT05fSU5ERVhdLFxuICAgIH0sXG4gICAge1xuICAgICAgaW5kZXg6IGF0dHJpYnV0ZUxvY2F0aW9ucy5jb21wcmVzc2VkQXR0cmlidXRlMCxcbiAgICAgIGNvbXBvbmVudHNQZXJBdHRyaWJ1dGU6IDQsXG4gICAgICBjb21wb25lbnREYXRhdHlwZTogQ29tcG9uZW50RGF0YXR5cGUuRkxPQVQsXG4gICAgICB1c2FnZTogYnVmZmVyc1VzYWdlW1BJWEVMX09GRlNFVF9JTkRFWF0sXG4gICAgfSxcbiAgICB7XG4gICAgICBpbmRleDogYXR0cmlidXRlTG9jYXRpb25zLmNvbXByZXNzZWRBdHRyaWJ1dGUxLFxuICAgICAgY29tcG9uZW50c1BlckF0dHJpYnV0ZTogNCxcbiAgICAgIGNvbXBvbmVudERhdGF0eXBlOiBDb21wb25lbnREYXRhdHlwZS5GTE9BVCxcbiAgICAgIHVzYWdlOiBidWZmZXJzVXNhZ2VbVFJBTlNMVUNFTkNZX0JZX0RJU1RBTkNFX0lOREVYXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIGluZGV4OiBhdHRyaWJ1dGVMb2NhdGlvbnMuY29tcHJlc3NlZEF0dHJpYnV0ZTIsXG4gICAgICBjb21wb25lbnRzUGVyQXR0cmlidXRlOiA0LFxuICAgICAgY29tcG9uZW50RGF0YXR5cGU6IENvbXBvbmVudERhdGF0eXBlLkZMT0FULFxuICAgICAgdXNhZ2U6IGJ1ZmZlcnNVc2FnZVtDT0xPUl9JTkRFWF0sXG4gICAgfSxcbiAgICB7XG4gICAgICBpbmRleDogYXR0cmlidXRlTG9jYXRpb25zLmV5ZU9mZnNldCxcbiAgICAgIGNvbXBvbmVudHNQZXJBdHRyaWJ1dGU6IDQsXG4gICAgICBjb21wb25lbnREYXRhdHlwZTogQ29tcG9uZW50RGF0YXR5cGUuRkxPQVQsXG4gICAgICB1c2FnZTogYnVmZmVyc1VzYWdlW0VZRV9PRkZTRVRfSU5ERVhdLFxuICAgIH0sXG4gICAge1xuICAgICAgaW5kZXg6IGF0dHJpYnV0ZUxvY2F0aW9ucy5zY2FsZUJ5RGlzdGFuY2UsXG4gICAgICBjb21wb25lbnRzUGVyQXR0cmlidXRlOiA0LFxuICAgICAgY29tcG9uZW50RGF0YXR5cGU6IENvbXBvbmVudERhdGF0eXBlLkZMT0FULFxuICAgICAgdXNhZ2U6IGJ1ZmZlcnNVc2FnZVtTQ0FMRV9CWV9ESVNUQU5DRV9JTkRFWF0sXG4gICAgfSxcbiAgICB7XG4gICAgICBpbmRleDogYXR0cmlidXRlTG9jYXRpb25zLnBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlLFxuICAgICAgY29tcG9uZW50c1BlckF0dHJpYnV0ZTogNCxcbiAgICAgIGNvbXBvbmVudERhdGF0eXBlOiBDb21wb25lbnREYXRhdHlwZS5GTE9BVCxcbiAgICAgIHVzYWdlOiBidWZmZXJzVXNhZ2VbUElYRUxfT0ZGU0VUX1NDQUxFX0JZX0RJU1RBTkNFX0lOREVYXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIGluZGV4OiBhdHRyaWJ1dGVMb2NhdGlvbnMuY29tcHJlc3NlZEF0dHJpYnV0ZTMsXG4gICAgICBjb21wb25lbnRzUGVyQXR0cmlidXRlOiA0LFxuICAgICAgY29tcG9uZW50RGF0YXR5cGU6IENvbXBvbmVudERhdGF0eXBlLkZMT0FULFxuICAgICAgdXNhZ2U6IGJ1ZmZlcnNVc2FnZVtESVNUQU5DRV9ESVNQTEFZX0NPTkRJVElPTl9JTkRFWF0sXG4gICAgfSxcbiAgICB7XG4gICAgICBpbmRleDogYXR0cmlidXRlTG9jYXRpb25zLnRleHR1cmVDb29yZGluYXRlQm91bmRzT3JMYWJlbFRyYW5zbGF0ZSxcbiAgICAgIGNvbXBvbmVudHNQZXJBdHRyaWJ1dGU6IDQsXG4gICAgICBjb21wb25lbnREYXRhdHlwZTogQ29tcG9uZW50RGF0YXR5cGUuRkxPQVQsXG4gICAgICB1c2FnZTogYnVmZmVyc1VzYWdlW1RFWFRVUkVfQ09PUkRJTkFURV9CT1VORFNdLFxuICAgIH0sXG4gIF07XG5cbiAgLy8gSW5zdGFuY2luZyByZXF1aXJlcyBvbmUgbm9uLWluc3RhbmNlZCBhdHRyaWJ1dGUuXG4gIGlmIChpbnN0YW5jZWQpIHtcbiAgICBhdHRyaWJ1dGVzLnB1c2goe1xuICAgICAgaW5kZXg6IGF0dHJpYnV0ZUxvY2F0aW9ucy5kaXJlY3Rpb24sXG4gICAgICBjb21wb25lbnRzUGVyQXR0cmlidXRlOiAyLFxuICAgICAgY29tcG9uZW50RGF0YXR5cGU6IENvbXBvbmVudERhdGF0eXBlLkZMT0FULFxuICAgICAgdmVydGV4QnVmZmVyOiBnZXRWZXJ0ZXhCdWZmZXJJbnN0YW5jZWQoY29udGV4dCksXG4gICAgfSk7XG4gIH1cblxuICBpZiAoZGVmaW5lZChiYXRjaFRhYmxlKSkge1xuICAgIGF0dHJpYnV0ZXMucHVzaCh7XG4gICAgICBpbmRleDogYXR0cmlidXRlTG9jYXRpb25zLmFfYmF0Y2hJZCxcbiAgICAgIGNvbXBvbmVudHNQZXJBdHRyaWJ1dGU6IDEsXG4gICAgICBjb21wb25lbnREYXRhdHlwZTogQ29tcG9uZW50RGF0YXR5cGUuRkxPQVQsXG4gICAgICBidWZmZXJVc2FnZTogQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsXG4gICAgfSk7XG4gIH1cblxuICBpZiAoc2RmKSB7XG4gICAgYXR0cmlidXRlcy5wdXNoKHtcbiAgICAgIGluZGV4OiBhdHRyaWJ1dGVMb2NhdGlvbnMuc2RmLFxuICAgICAgY29tcG9uZW50c1BlckF0dHJpYnV0ZTogMixcbiAgICAgIGNvbXBvbmVudERhdGF0eXBlOiBDb21wb25lbnREYXRhdHlwZS5GTE9BVCxcbiAgICAgIHVzYWdlOiBidWZmZXJzVXNhZ2VbU0RGX0lOREVYXSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFdoZW4gaW5zdGFuY2luZyBpcyBlbmFibGVkLCBvbmx5IG9uZSB2ZXJ0ZXggaXMgbmVlZGVkIGZvciBlYWNoIGJpbGxib2FyZC5cbiAgdmFyIHNpemVJblZlcnRpY2VzID0gaW5zdGFuY2VkID8gbnVtYmVyT2ZCaWxsYm9hcmRzIDogNCAqIG51bWJlck9mQmlsbGJvYXJkcztcbiAgcmV0dXJuIG5ldyBWZXJ0ZXhBcnJheUZhY2FkZShjb250ZXh0LCBhdHRyaWJ1dGVzLCBzaXplSW5WZXJ0aWNlcywgaW5zdGFuY2VkKTtcbn1cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbi8vIEZvdXIgdmVydGljZXMgcGVyIGJpbGxib2FyZC4gIEVhY2ggaGFzIHRoZSBzYW1lIHBvc2l0aW9uLCBldGMuLCBidXQgYSBkaWZmZXJlbnQgc2NyZWVuLXNwYWNlIGRpcmVjdGlvbiB2ZWN0b3IuXG5cbi8vIFBFUkZPUk1BTkNFX0lERUE6ICBTYXZlIG1lbW9yeSBpZiBhIHByb3BlcnR5IGlzIHRoZSBzYW1lIGZvciBhbGwgYmlsbGJvYXJkcywgdXNlIGEgbGF0Y2hlZCBhdHRyaWJ1dGUgc3RhdGUsXG4vLyBpbnN0ZWFkIG9mIHN0b3JpbmcgaXQgaW4gYSB2ZXJ0ZXggYnVmZmVyLlxuXG52YXIgd3JpdGVQb3NpdGlvblNjcmF0Y2ggPSBuZXcgRW5jb2RlZENhcnRlc2lhbjMoKTtcblxuZnVuY3Rpb24gd3JpdGVQb3NpdGlvblNjYWxlQW5kUm90YXRpb24oXG4gIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gIGZyYW1lU3RhdGUsXG4gIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICB2YWZXcml0ZXJzLFxuICBiaWxsYm9hcmRcbikge1xuICB2YXIgaTtcbiAgdmFyIHBvc2l0aW9uSGlnaFdyaXRlciA9IHZhZldyaXRlcnNbYXR0cmlidXRlTG9jYXRpb25zLnBvc2l0aW9uSGlnaEFuZFNjYWxlXTtcbiAgdmFyIHBvc2l0aW9uTG93V3JpdGVyID0gdmFmV3JpdGVyc1thdHRyaWJ1dGVMb2NhdGlvbnMucG9zaXRpb25Mb3dBbmRSb3RhdGlvbl07XG4gIHZhciBwb3NpdGlvbiA9IGJpbGxib2FyZC5fZ2V0QWN0dWFsUG9zaXRpb24oKTtcblxuICBpZiAoYmlsbGJvYXJkQ29sbGVjdGlvbi5fbW9kZSA9PT0gU2NlbmVNb2RlLlNDRU5FM0QpIHtcbiAgICBCb3VuZGluZ1NwaGVyZS5leHBhbmQoXG4gICAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9iYXNlVm9sdW1lLFxuICAgICAgcG9zaXRpb24sXG4gICAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9iYXNlVm9sdW1lXG4gICAgKTtcbiAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9ib3VuZGluZ1ZvbHVtZURpcnR5ID0gdHJ1ZTtcbiAgfVxuXG4gIEVuY29kZWRDYXJ0ZXNpYW4zLmZyb21DYXJ0ZXNpYW4ocG9zaXRpb24sIHdyaXRlUG9zaXRpb25TY3JhdGNoKTtcbiAgdmFyIHNjYWxlID0gYmlsbGJvYXJkLnNjYWxlO1xuICB2YXIgcm90YXRpb24gPSBiaWxsYm9hcmQucm90YXRpb247XG5cbiAgaWYgKHJvdGF0aW9uICE9PSAwLjApIHtcbiAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9zaGFkZXJSb3RhdGlvbiA9IHRydWU7XG4gIH1cblxuICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9tYXhTY2FsZSA9IE1hdGgubWF4KFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX21heFNjYWxlLFxuICAgIHNjYWxlXG4gICk7XG5cbiAgdmFyIGhpZ2ggPSB3cml0ZVBvc2l0aW9uU2NyYXRjaC5oaWdoO1xuICB2YXIgbG93ID0gd3JpdGVQb3NpdGlvblNjcmF0Y2gubG93O1xuXG4gIGlmIChiaWxsYm9hcmRDb2xsZWN0aW9uLl9pbnN0YW5jZWQpIHtcbiAgICBpID0gYmlsbGJvYXJkLl9pbmRleDtcbiAgICBwb3NpdGlvbkhpZ2hXcml0ZXIoaSwgaGlnaC54LCBoaWdoLnksIGhpZ2gueiwgc2NhbGUpO1xuICAgIHBvc2l0aW9uTG93V3JpdGVyKGksIGxvdy54LCBsb3cueSwgbG93LnosIHJvdGF0aW9uKTtcbiAgfSBlbHNlIHtcbiAgICBpID0gYmlsbGJvYXJkLl9pbmRleCAqIDQ7XG4gICAgcG9zaXRpb25IaWdoV3JpdGVyKGkgKyAwLCBoaWdoLngsIGhpZ2gueSwgaGlnaC56LCBzY2FsZSk7XG4gICAgcG9zaXRpb25IaWdoV3JpdGVyKGkgKyAxLCBoaWdoLngsIGhpZ2gueSwgaGlnaC56LCBzY2FsZSk7XG4gICAgcG9zaXRpb25IaWdoV3JpdGVyKGkgKyAyLCBoaWdoLngsIGhpZ2gueSwgaGlnaC56LCBzY2FsZSk7XG4gICAgcG9zaXRpb25IaWdoV3JpdGVyKGkgKyAzLCBoaWdoLngsIGhpZ2gueSwgaGlnaC56LCBzY2FsZSk7XG5cbiAgICBwb3NpdGlvbkxvd1dyaXRlcihpICsgMCwgbG93LngsIGxvdy55LCBsb3cueiwgcm90YXRpb24pO1xuICAgIHBvc2l0aW9uTG93V3JpdGVyKGkgKyAxLCBsb3cueCwgbG93LnksIGxvdy56LCByb3RhdGlvbik7XG4gICAgcG9zaXRpb25Mb3dXcml0ZXIoaSArIDIsIGxvdy54LCBsb3cueSwgbG93LnosIHJvdGF0aW9uKTtcbiAgICBwb3NpdGlvbkxvd1dyaXRlcihpICsgMywgbG93LngsIGxvdy55LCBsb3cueiwgcm90YXRpb24pO1xuICB9XG59XG5cbnZhciBzY3JhdGNoQ2FydGVzaWFuMiA9IG5ldyBDYXJ0ZXNpYW4yKCk7XG5cbnZhciBVUFBFUl9CT1VORCA9IDMyNzY4LjA7IC8vIDJeMTVcblxudmFyIExFRlRfU0hJRlQxNiA9IDY1NTM2LjA7IC8vIDJeMTZcbnZhciBMRUZUX1NISUZUMTIgPSA0MDk2LjA7IC8vIDJeMTJcbnZhciBMRUZUX1NISUZUOCA9IDI1Ni4wOyAvLyAyXjhcbnZhciBMRUZUX1NISUZUNyA9IDEyOC4wO1xudmFyIExFRlRfU0hJRlQ1ID0gMzIuMDtcbnZhciBMRUZUX1NISUZUMyA9IDguMDtcbnZhciBMRUZUX1NISUZUMiA9IDQuMDtcblxudmFyIFJJR0hUX1NISUZUOCA9IDEuMCAvIDI1Ni4wO1xuXG52YXIgTE9XRVJfTEVGVCA9IDAuMDtcbnZhciBMT1dFUl9SSUdIVCA9IDIuMDtcbnZhciBVUFBFUl9SSUdIVCA9IDMuMDtcbnZhciBVUFBFUl9MRUZUID0gMS4wO1xuXG5mdW5jdGlvbiB3cml0ZUNvbXByZXNzZWRBdHRyaWIwKFxuICBiaWxsYm9hcmRDb2xsZWN0aW9uLFxuICBmcmFtZVN0YXRlLFxuICB0ZXh0dXJlQXRsYXNDb29yZGluYXRlcyxcbiAgdmFmV3JpdGVycyxcbiAgYmlsbGJvYXJkXG4pIHtcbiAgdmFyIGk7XG4gIHZhciB3cml0ZXIgPSB2YWZXcml0ZXJzW2F0dHJpYnV0ZUxvY2F0aW9ucy5jb21wcmVzc2VkQXR0cmlidXRlMF07XG4gIHZhciBwaXhlbE9mZnNldCA9IGJpbGxib2FyZC5waXhlbE9mZnNldDtcbiAgdmFyIHBpeGVsT2Zmc2V0WCA9IHBpeGVsT2Zmc2V0Lng7XG4gIHZhciBwaXhlbE9mZnNldFkgPSBwaXhlbE9mZnNldC55O1xuXG4gIHZhciB0cmFuc2xhdGUgPSBiaWxsYm9hcmQuX3RyYW5zbGF0ZTtcbiAgdmFyIHRyYW5zbGF0ZVggPSB0cmFuc2xhdGUueDtcbiAgdmFyIHRyYW5zbGF0ZVkgPSB0cmFuc2xhdGUueTtcblxuICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9tYXhQaXhlbE9mZnNldCA9IE1hdGgubWF4KFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX21heFBpeGVsT2Zmc2V0LFxuICAgIE1hdGguYWJzKHBpeGVsT2Zmc2V0WCArIHRyYW5zbGF0ZVgpLFxuICAgIE1hdGguYWJzKC1waXhlbE9mZnNldFkgKyB0cmFuc2xhdGVZKVxuICApO1xuXG4gIHZhciBob3Jpem9udGFsT3JpZ2luID0gYmlsbGJvYXJkLmhvcml6b250YWxPcmlnaW47XG4gIHZhciB2ZXJ0aWNhbE9yaWdpbiA9IGJpbGxib2FyZC5fdmVydGljYWxPcmlnaW47XG4gIHZhciBzaG93ID0gYmlsbGJvYXJkLnNob3cgJiYgYmlsbGJvYXJkLmNsdXN0ZXJTaG93O1xuXG4gIC8vIElmIHRoZSBjb2xvciBhbHBoYSBpcyB6ZXJvLCBkbyBub3Qgc2hvdyB0aGlzIGJpbGxib2FyZC4gIFRoaXMgbGV0cyB1cyBhdm9pZCBwcm92aWRpbmdcbiAgLy8gY29sb3IgZHVyaW5nIHRoZSBwaWNrIHBhc3MgYW5kIGFsc28gZWxpbWluYXRlcyBhIGRpc2NhcmQgaW4gdGhlIGZyYWdtZW50IHNoYWRlci5cbiAgaWYgKGJpbGxib2FyZC5jb2xvci5hbHBoYSA9PT0gMC4wKSB7XG4gICAgc2hvdyA9IGZhbHNlO1xuICB9XG5cbiAgLy8gUmF3IGJpbGxib2FyZHMgZG9uJ3QgZGlzdGluZ3Vpc2ggYmV0d2VlbiBCQVNFTElORSBhbmQgQk9UVE9NLCBvbmx5IExhYmVsQ29sbGVjdGlvbiBkb2VzIHRoYXQuXG4gIGlmICh2ZXJ0aWNhbE9yaWdpbiA9PT0gVmVydGljYWxPcmlnaW4uQkFTRUxJTkUpIHtcbiAgICB2ZXJ0aWNhbE9yaWdpbiA9IFZlcnRpY2FsT3JpZ2luLkJPVFRPTTtcbiAgfVxuXG4gIGJpbGxib2FyZENvbGxlY3Rpb24uX2FsbEhvcml6b250YWxDZW50ZXIgPVxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX2FsbEhvcml6b250YWxDZW50ZXIgJiZcbiAgICBob3Jpem9udGFsT3JpZ2luID09PSBIb3Jpem9udGFsT3JpZ2luLkNFTlRFUjtcbiAgYmlsbGJvYXJkQ29sbGVjdGlvbi5fYWxsVmVydGljYWxDZW50ZXIgPVxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX2FsbFZlcnRpY2FsQ2VudGVyICYmXG4gICAgdmVydGljYWxPcmlnaW4gPT09IFZlcnRpY2FsT3JpZ2luLkNFTlRFUjtcblxuICB2YXIgYm90dG9tTGVmdFggPSAwO1xuICB2YXIgYm90dG9tTGVmdFkgPSAwO1xuICB2YXIgd2lkdGggPSAwO1xuICB2YXIgaGVpZ2h0ID0gMDtcbiAgdmFyIGluZGV4ID0gYmlsbGJvYXJkLl9pbWFnZUluZGV4O1xuICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgdmFyIGltYWdlUmVjdGFuZ2xlID0gdGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXNbaW5kZXhdO1xuXG4gICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICBpZiAoIWRlZmluZWQoaW1hZ2VSZWN0YW5nbGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXCJJbnZhbGlkIGJpbGxib2FyZCBpbWFnZSBpbmRleDogXCIgKyBpbmRleCk7XG4gICAgfVxuICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgYm90dG9tTGVmdFggPSBpbWFnZVJlY3RhbmdsZS54O1xuICAgIGJvdHRvbUxlZnRZID0gaW1hZ2VSZWN0YW5nbGUueTtcbiAgICB3aWR0aCA9IGltYWdlUmVjdGFuZ2xlLndpZHRoO1xuICAgIGhlaWdodCA9IGltYWdlUmVjdGFuZ2xlLmhlaWdodDtcbiAgfVxuICB2YXIgdG9wUmlnaHRYID0gYm90dG9tTGVmdFggKyB3aWR0aDtcbiAgdmFyIHRvcFJpZ2h0WSA9IGJvdHRvbUxlZnRZICsgaGVpZ2h0O1xuXG4gIHZhciBjb21wcmVzc2VkMCA9XG4gICAgTWF0aC5mbG9vcihcbiAgICAgIENlc2l1bU1hdGguY2xhbXAocGl4ZWxPZmZzZXRYLCAtVVBQRVJfQk9VTkQsIFVQUEVSX0JPVU5EKSArIFVQUEVSX0JPVU5EXG4gICAgKSAqIExFRlRfU0hJRlQ3O1xuICBjb21wcmVzc2VkMCArPSAoaG9yaXpvbnRhbE9yaWdpbiArIDEuMCkgKiBMRUZUX1NISUZUNTtcbiAgY29tcHJlc3NlZDAgKz0gKHZlcnRpY2FsT3JpZ2luICsgMS4wKSAqIExFRlRfU0hJRlQzO1xuICBjb21wcmVzc2VkMCArPSAoc2hvdyA/IDEuMCA6IDAuMCkgKiBMRUZUX1NISUZUMjtcblxuICB2YXIgY29tcHJlc3NlZDEgPVxuICAgIE1hdGguZmxvb3IoXG4gICAgICBDZXNpdW1NYXRoLmNsYW1wKHBpeGVsT2Zmc2V0WSwgLVVQUEVSX0JPVU5ELCBVUFBFUl9CT1VORCkgKyBVUFBFUl9CT1VORFxuICAgICkgKiBMRUZUX1NISUZUODtcbiAgdmFyIGNvbXByZXNzZWQyID1cbiAgICBNYXRoLmZsb29yKFxuICAgICAgQ2VzaXVtTWF0aC5jbGFtcCh0cmFuc2xhdGVYLCAtVVBQRVJfQk9VTkQsIFVQUEVSX0JPVU5EKSArIFVQUEVSX0JPVU5EXG4gICAgKSAqIExFRlRfU0hJRlQ4O1xuXG4gIHZhciB0ZW1wVGFuc2xhdGVZID1cbiAgICAoQ2VzaXVtTWF0aC5jbGFtcCh0cmFuc2xhdGVZLCAtVVBQRVJfQk9VTkQsIFVQUEVSX0JPVU5EKSArIFVQUEVSX0JPVU5EKSAqXG4gICAgUklHSFRfU0hJRlQ4O1xuICB2YXIgdXBwZXJUcmFuc2xhdGVZID0gTWF0aC5mbG9vcih0ZW1wVGFuc2xhdGVZKTtcbiAgdmFyIGxvd2VyVHJhbnNsYXRlWSA9IE1hdGguZmxvb3IoXG4gICAgKHRlbXBUYW5zbGF0ZVkgLSB1cHBlclRyYW5zbGF0ZVkpICogTEVGVF9TSElGVDhcbiAgKTtcblxuICBjb21wcmVzc2VkMSArPSB1cHBlclRyYW5zbGF0ZVk7XG4gIGNvbXByZXNzZWQyICs9IGxvd2VyVHJhbnNsYXRlWTtcblxuICBzY3JhdGNoQ2FydGVzaWFuMi54ID0gYm90dG9tTGVmdFg7XG4gIHNjcmF0Y2hDYXJ0ZXNpYW4yLnkgPSBib3R0b21MZWZ0WTtcbiAgdmFyIGNvbXByZXNzZWRUZXhDb29yZHNMTCA9IEF0dHJpYnV0ZUNvbXByZXNzaW9uLmNvbXByZXNzVGV4dHVyZUNvb3JkaW5hdGVzKFxuICAgIHNjcmF0Y2hDYXJ0ZXNpYW4yXG4gICk7XG4gIHNjcmF0Y2hDYXJ0ZXNpYW4yLnggPSB0b3BSaWdodFg7XG4gIHZhciBjb21wcmVzc2VkVGV4Q29vcmRzTFIgPSBBdHRyaWJ1dGVDb21wcmVzc2lvbi5jb21wcmVzc1RleHR1cmVDb29yZGluYXRlcyhcbiAgICBzY3JhdGNoQ2FydGVzaWFuMlxuICApO1xuICBzY3JhdGNoQ2FydGVzaWFuMi55ID0gdG9wUmlnaHRZO1xuICB2YXIgY29tcHJlc3NlZFRleENvb3Jkc1VSID0gQXR0cmlidXRlQ29tcHJlc3Npb24uY29tcHJlc3NUZXh0dXJlQ29vcmRpbmF0ZXMoXG4gICAgc2NyYXRjaENhcnRlc2lhbjJcbiAgKTtcbiAgc2NyYXRjaENhcnRlc2lhbjIueCA9IGJvdHRvbUxlZnRYO1xuICB2YXIgY29tcHJlc3NlZFRleENvb3Jkc1VMID0gQXR0cmlidXRlQ29tcHJlc3Npb24uY29tcHJlc3NUZXh0dXJlQ29vcmRpbmF0ZXMoXG4gICAgc2NyYXRjaENhcnRlc2lhbjJcbiAgKTtcblxuICBpZiAoYmlsbGJvYXJkQ29sbGVjdGlvbi5faW5zdGFuY2VkKSB7XG4gICAgaSA9IGJpbGxib2FyZC5faW5kZXg7XG4gICAgd3JpdGVyKGksIGNvbXByZXNzZWQwLCBjb21wcmVzc2VkMSwgY29tcHJlc3NlZDIsIGNvbXByZXNzZWRUZXhDb29yZHNMTCk7XG4gIH0gZWxzZSB7XG4gICAgaSA9IGJpbGxib2FyZC5faW5kZXggKiA0O1xuICAgIHdyaXRlcihcbiAgICAgIGkgKyAwLFxuICAgICAgY29tcHJlc3NlZDAgKyBMT1dFUl9MRUZULFxuICAgICAgY29tcHJlc3NlZDEsXG4gICAgICBjb21wcmVzc2VkMixcbiAgICAgIGNvbXByZXNzZWRUZXhDb29yZHNMTFxuICAgICk7XG4gICAgd3JpdGVyKFxuICAgICAgaSArIDEsXG4gICAgICBjb21wcmVzc2VkMCArIExPV0VSX1JJR0hULFxuICAgICAgY29tcHJlc3NlZDEsXG4gICAgICBjb21wcmVzc2VkMixcbiAgICAgIGNvbXByZXNzZWRUZXhDb29yZHNMUlxuICAgICk7XG4gICAgd3JpdGVyKFxuICAgICAgaSArIDIsXG4gICAgICBjb21wcmVzc2VkMCArIFVQUEVSX1JJR0hULFxuICAgICAgY29tcHJlc3NlZDEsXG4gICAgICBjb21wcmVzc2VkMixcbiAgICAgIGNvbXByZXNzZWRUZXhDb29yZHNVUlxuICAgICk7XG4gICAgd3JpdGVyKFxuICAgICAgaSArIDMsXG4gICAgICBjb21wcmVzc2VkMCArIFVQUEVSX0xFRlQsXG4gICAgICBjb21wcmVzc2VkMSxcbiAgICAgIGNvbXByZXNzZWQyLFxuICAgICAgY29tcHJlc3NlZFRleENvb3Jkc1VMXG4gICAgKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB3cml0ZUNvbXByZXNzZWRBdHRyaWIxKFxuICBiaWxsYm9hcmRDb2xsZWN0aW9uLFxuICBmcmFtZVN0YXRlLFxuICB0ZXh0dXJlQXRsYXNDb29yZGluYXRlcyxcbiAgdmFmV3JpdGVycyxcbiAgYmlsbGJvYXJkXG4pIHtcbiAgdmFyIGk7XG4gIHZhciB3cml0ZXIgPSB2YWZXcml0ZXJzW2F0dHJpYnV0ZUxvY2F0aW9ucy5jb21wcmVzc2VkQXR0cmlidXRlMV07XG4gIHZhciBhbGlnbmVkQXhpcyA9IGJpbGxib2FyZC5hbGlnbmVkQXhpcztcbiAgaWYgKCFDYXJ0ZXNpYW4zLmVxdWFscyhhbGlnbmVkQXhpcywgQ2FydGVzaWFuMy5aRVJPKSkge1xuICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX3NoYWRlckFsaWduZWRBeGlzID0gdHJ1ZTtcbiAgfVxuXG4gIHZhciBuZWFyID0gMC4wO1xuICB2YXIgbmVhclZhbHVlID0gMS4wO1xuICB2YXIgZmFyID0gMS4wO1xuICB2YXIgZmFyVmFsdWUgPSAxLjA7XG5cbiAgdmFyIHRyYW5zbHVjZW5jeSA9IGJpbGxib2FyZC50cmFuc2x1Y2VuY3lCeURpc3RhbmNlO1xuICBpZiAoZGVmaW5lZCh0cmFuc2x1Y2VuY3kpKSB7XG4gICAgbmVhciA9IHRyYW5zbHVjZW5jeS5uZWFyO1xuICAgIG5lYXJWYWx1ZSA9IHRyYW5zbHVjZW5jeS5uZWFyVmFsdWU7XG4gICAgZmFyID0gdHJhbnNsdWNlbmN5LmZhcjtcbiAgICBmYXJWYWx1ZSA9IHRyYW5zbHVjZW5jeS5mYXJWYWx1ZTtcblxuICAgIGlmIChuZWFyVmFsdWUgIT09IDEuMCB8fCBmYXJWYWx1ZSAhPT0gMS4wKSB7XG4gICAgICAvLyB0cmFuc2x1Y2VuY3kgYnkgZGlzdGFuY2UgY2FsY3VsYXRpb24gaW4gc2hhZGVyIG5lZWQgbm90IGJlIGVuYWJsZWRcbiAgICAgIC8vIHVudGlsIGEgYmlsbGJvYXJkIHdpdGggbmVhciBhbmQgZmFyICE9PSAxLjAgaXMgZm91bmRcbiAgICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX3NoYWRlclRyYW5zbHVjZW5jeUJ5RGlzdGFuY2UgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHZhciB3aWR0aCA9IDA7XG4gIHZhciBpbmRleCA9IGJpbGxib2FyZC5faW1hZ2VJbmRleDtcbiAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgIHZhciBpbWFnZVJlY3RhbmdsZSA9IHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzW2luZGV4XTtcblxuICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgaWYgKCFkZWZpbmVkKGltYWdlUmVjdGFuZ2xlKSkge1xuICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwiSW52YWxpZCBiaWxsYm9hcmQgaW1hZ2UgaW5kZXg6IFwiICsgaW5kZXgpO1xuICAgIH1cbiAgICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICAgIHdpZHRoID0gaW1hZ2VSZWN0YW5nbGUud2lkdGg7XG4gIH1cblxuICB2YXIgdGV4dHVyZVdpZHRoID0gYmlsbGJvYXJkQ29sbGVjdGlvbi5fdGV4dHVyZUF0bGFzLnRleHR1cmUud2lkdGg7XG4gIHZhciBpbWFnZVdpZHRoID0gTWF0aC5yb3VuZChcbiAgICBkZWZhdWx0VmFsdWUoYmlsbGJvYXJkLndpZHRoLCB0ZXh0dXJlV2lkdGggKiB3aWR0aClcbiAgKTtcbiAgYmlsbGJvYXJkQ29sbGVjdGlvbi5fbWF4U2l6ZSA9IE1hdGgubWF4KFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX21heFNpemUsXG4gICAgaW1hZ2VXaWR0aFxuICApO1xuXG4gIHZhciBjb21wcmVzc2VkMCA9IENlc2l1bU1hdGguY2xhbXAoaW1hZ2VXaWR0aCwgMC4wLCBMRUZUX1NISUZUMTYpO1xuICB2YXIgY29tcHJlc3NlZDEgPSAwLjA7XG5cbiAgaWYgKFxuICAgIE1hdGguYWJzKENhcnRlc2lhbjMubWFnbml0dWRlU3F1YXJlZChhbGlnbmVkQXhpcykgLSAxLjApIDxcbiAgICBDZXNpdW1NYXRoLkVQU0lMT042XG4gICkge1xuICAgIGNvbXByZXNzZWQxID0gQXR0cmlidXRlQ29tcHJlc3Npb24ub2N0RW5jb2RlRmxvYXQoYWxpZ25lZEF4aXMpO1xuICB9XG5cbiAgbmVhclZhbHVlID0gQ2VzaXVtTWF0aC5jbGFtcChuZWFyVmFsdWUsIDAuMCwgMS4wKTtcbiAgbmVhclZhbHVlID0gbmVhclZhbHVlID09PSAxLjAgPyAyNTUuMCA6IChuZWFyVmFsdWUgKiAyNTUuMCkgfCAwO1xuICBjb21wcmVzc2VkMCA9IGNvbXByZXNzZWQwICogTEVGVF9TSElGVDggKyBuZWFyVmFsdWU7XG5cbiAgZmFyVmFsdWUgPSBDZXNpdW1NYXRoLmNsYW1wKGZhclZhbHVlLCAwLjAsIDEuMCk7XG4gIGZhclZhbHVlID0gZmFyVmFsdWUgPT09IDEuMCA/IDI1NS4wIDogKGZhclZhbHVlICogMjU1LjApIHwgMDtcbiAgY29tcHJlc3NlZDEgPSBjb21wcmVzc2VkMSAqIExFRlRfU0hJRlQ4ICsgZmFyVmFsdWU7XG5cbiAgaWYgKGJpbGxib2FyZENvbGxlY3Rpb24uX2luc3RhbmNlZCkge1xuICAgIGkgPSBiaWxsYm9hcmQuX2luZGV4O1xuICAgIHdyaXRlcihpLCBjb21wcmVzc2VkMCwgY29tcHJlc3NlZDEsIG5lYXIsIGZhcik7XG4gIH0gZWxzZSB7XG4gICAgaSA9IGJpbGxib2FyZC5faW5kZXggKiA0O1xuICAgIHdyaXRlcihpICsgMCwgY29tcHJlc3NlZDAsIGNvbXByZXNzZWQxLCBuZWFyLCBmYXIpO1xuICAgIHdyaXRlcihpICsgMSwgY29tcHJlc3NlZDAsIGNvbXByZXNzZWQxLCBuZWFyLCBmYXIpO1xuICAgIHdyaXRlcihpICsgMiwgY29tcHJlc3NlZDAsIGNvbXByZXNzZWQxLCBuZWFyLCBmYXIpO1xuICAgIHdyaXRlcihpICsgMywgY29tcHJlc3NlZDAsIGNvbXByZXNzZWQxLCBuZWFyLCBmYXIpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlQ29tcHJlc3NlZEF0dHJpYjIoXG4gIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gIGZyYW1lU3RhdGUsXG4gIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICB2YWZXcml0ZXJzLFxuICBiaWxsYm9hcmRcbikge1xuICB2YXIgaTtcbiAgdmFyIHdyaXRlciA9IHZhZldyaXRlcnNbYXR0cmlidXRlTG9jYXRpb25zLmNvbXByZXNzZWRBdHRyaWJ1dGUyXTtcbiAgdmFyIGNvbG9yID0gYmlsbGJvYXJkLmNvbG9yO1xuICB2YXIgcGlja0NvbG9yID0gIWRlZmluZWQoYmlsbGJvYXJkQ29sbGVjdGlvbi5fYmF0Y2hUYWJsZSlcbiAgICA/IGJpbGxib2FyZC5nZXRQaWNrSWQoZnJhbWVTdGF0ZS5jb250ZXh0KS5jb2xvclxuICAgIDogQ29sb3IuV0hJVEU7XG4gIHZhciBzaXplSW5NZXRlcnMgPSBiaWxsYm9hcmQuc2l6ZUluTWV0ZXJzID8gMS4wIDogMC4wO1xuICB2YXIgdmFsaWRBbGlnbmVkQXhpcyA9XG4gICAgTWF0aC5hYnMoQ2FydGVzaWFuMy5tYWduaXR1ZGVTcXVhcmVkKGJpbGxib2FyZC5hbGlnbmVkQXhpcykgLSAxLjApIDxcbiAgICBDZXNpdW1NYXRoLkVQU0lMT042XG4gICAgICA/IDEuMFxuICAgICAgOiAwLjA7XG5cbiAgYmlsbGJvYXJkQ29sbGVjdGlvbi5fYWxsU2l6ZWRJbk1ldGVycyA9XG4gICAgYmlsbGJvYXJkQ29sbGVjdGlvbi5fYWxsU2l6ZWRJbk1ldGVycyAmJiBzaXplSW5NZXRlcnMgPT09IDEuMDtcblxuICB2YXIgaGVpZ2h0ID0gMDtcbiAgdmFyIGluZGV4ID0gYmlsbGJvYXJkLl9pbWFnZUluZGV4O1xuICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgdmFyIGltYWdlUmVjdGFuZ2xlID0gdGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXNbaW5kZXhdO1xuXG4gICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICBpZiAoIWRlZmluZWQoaW1hZ2VSZWN0YW5nbGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXCJJbnZhbGlkIGJpbGxib2FyZCBpbWFnZSBpbmRleDogXCIgKyBpbmRleCk7XG4gICAgfVxuICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgaGVpZ2h0ID0gaW1hZ2VSZWN0YW5nbGUuaGVpZ2h0O1xuICB9XG5cbiAgdmFyIGRpbWVuc2lvbnMgPSBiaWxsYm9hcmRDb2xsZWN0aW9uLl90ZXh0dXJlQXRsYXMudGV4dHVyZS5kaW1lbnNpb25zO1xuICB2YXIgaW1hZ2VIZWlnaHQgPSBNYXRoLnJvdW5kKFxuICAgIGRlZmF1bHRWYWx1ZShiaWxsYm9hcmQuaGVpZ2h0LCBkaW1lbnNpb25zLnkgKiBoZWlnaHQpXG4gICk7XG4gIGJpbGxib2FyZENvbGxlY3Rpb24uX21heFNpemUgPSBNYXRoLm1heChcbiAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9tYXhTaXplLFxuICAgIGltYWdlSGVpZ2h0XG4gICk7XG4gIHZhciBsYWJlbEhvcml6b250YWxPcmlnaW4gPSBkZWZhdWx0VmFsdWUoXG4gICAgYmlsbGJvYXJkLl9sYWJlbEhvcml6b250YWxPcmlnaW4sXG4gICAgLTJcbiAgKTtcbiAgbGFiZWxIb3Jpem9udGFsT3JpZ2luICs9IDI7XG4gIHZhciBjb21wcmVzc2VkMyA9IGltYWdlSGVpZ2h0ICogTEVGVF9TSElGVDIgKyBsYWJlbEhvcml6b250YWxPcmlnaW47XG5cbiAgdmFyIHJlZCA9IENvbG9yLmZsb2F0VG9CeXRlKGNvbG9yLnJlZCk7XG4gIHZhciBncmVlbiA9IENvbG9yLmZsb2F0VG9CeXRlKGNvbG9yLmdyZWVuKTtcbiAgdmFyIGJsdWUgPSBDb2xvci5mbG9hdFRvQnl0ZShjb2xvci5ibHVlKTtcbiAgdmFyIGNvbXByZXNzZWQwID0gcmVkICogTEVGVF9TSElGVDE2ICsgZ3JlZW4gKiBMRUZUX1NISUZUOCArIGJsdWU7XG5cbiAgcmVkID0gQ29sb3IuZmxvYXRUb0J5dGUocGlja0NvbG9yLnJlZCk7XG4gIGdyZWVuID0gQ29sb3IuZmxvYXRUb0J5dGUocGlja0NvbG9yLmdyZWVuKTtcbiAgYmx1ZSA9IENvbG9yLmZsb2F0VG9CeXRlKHBpY2tDb2xvci5ibHVlKTtcbiAgdmFyIGNvbXByZXNzZWQxID0gcmVkICogTEVGVF9TSElGVDE2ICsgZ3JlZW4gKiBMRUZUX1NISUZUOCArIGJsdWU7XG5cbiAgdmFyIGNvbXByZXNzZWQyID1cbiAgICBDb2xvci5mbG9hdFRvQnl0ZShjb2xvci5hbHBoYSkgKiBMRUZUX1NISUZUMTYgK1xuICAgIENvbG9yLmZsb2F0VG9CeXRlKHBpY2tDb2xvci5hbHBoYSkgKiBMRUZUX1NISUZUODtcbiAgY29tcHJlc3NlZDIgKz0gc2l6ZUluTWV0ZXJzICogMi4wICsgdmFsaWRBbGlnbmVkQXhpcztcblxuICBpZiAoYmlsbGJvYXJkQ29sbGVjdGlvbi5faW5zdGFuY2VkKSB7XG4gICAgaSA9IGJpbGxib2FyZC5faW5kZXg7XG4gICAgd3JpdGVyKGksIGNvbXByZXNzZWQwLCBjb21wcmVzc2VkMSwgY29tcHJlc3NlZDIsIGNvbXByZXNzZWQzKTtcbiAgfSBlbHNlIHtcbiAgICBpID0gYmlsbGJvYXJkLl9pbmRleCAqIDQ7XG4gICAgd3JpdGVyKGkgKyAwLCBjb21wcmVzc2VkMCwgY29tcHJlc3NlZDEsIGNvbXByZXNzZWQyLCBjb21wcmVzc2VkMyk7XG4gICAgd3JpdGVyKGkgKyAxLCBjb21wcmVzc2VkMCwgY29tcHJlc3NlZDEsIGNvbXByZXNzZWQyLCBjb21wcmVzc2VkMyk7XG4gICAgd3JpdGVyKGkgKyAyLCBjb21wcmVzc2VkMCwgY29tcHJlc3NlZDEsIGNvbXByZXNzZWQyLCBjb21wcmVzc2VkMyk7XG4gICAgd3JpdGVyKGkgKyAzLCBjb21wcmVzc2VkMCwgY29tcHJlc3NlZDEsIGNvbXByZXNzZWQyLCBjb21wcmVzc2VkMyk7XG4gIH1cbn1cblxuZnVuY3Rpb24gd3JpdGVFeWVPZmZzZXQoXG4gIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gIGZyYW1lU3RhdGUsXG4gIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICB2YWZXcml0ZXJzLFxuICBiaWxsYm9hcmRcbikge1xuICB2YXIgaTtcbiAgdmFyIHdyaXRlciA9IHZhZldyaXRlcnNbYXR0cmlidXRlTG9jYXRpb25zLmV5ZU9mZnNldF07XG4gIHZhciBleWVPZmZzZXQgPSBiaWxsYm9hcmQuZXllT2Zmc2V0O1xuXG4gIC8vIEZvciBiaWxsYm9hcmRzIHRoYXQgYXJlIGNsYW1wZWQgdG8gZ3JvdW5kLCBtb3ZlIGl0IHNsaWdodGx5IGNsb3NlciB0byB0aGUgY2FtZXJhXG4gIHZhciBleWVPZmZzZXRaID0gZXllT2Zmc2V0Lno7XG4gIGlmIChiaWxsYm9hcmQuX2hlaWdodFJlZmVyZW5jZSAhPT0gSGVpZ2h0UmVmZXJlbmNlLk5PTkUpIHtcbiAgICBleWVPZmZzZXRaICo9IDEuMDA1O1xuICB9XG4gIGJpbGxib2FyZENvbGxlY3Rpb24uX21heEV5ZU9mZnNldCA9IE1hdGgubWF4KFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX21heEV5ZU9mZnNldCxcbiAgICBNYXRoLmFicyhleWVPZmZzZXQueCksXG4gICAgTWF0aC5hYnMoZXllT2Zmc2V0LnkpLFxuICAgIE1hdGguYWJzKGV5ZU9mZnNldFopXG4gICk7XG5cbiAgaWYgKGJpbGxib2FyZENvbGxlY3Rpb24uX2luc3RhbmNlZCkge1xuICAgIHZhciB3aWR0aCA9IDA7XG4gICAgdmFyIGhlaWdodCA9IDA7XG4gICAgdmFyIGluZGV4ID0gYmlsbGJvYXJkLl9pbWFnZUluZGV4O1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIHZhciBpbWFnZVJlY3RhbmdsZSA9IHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzW2luZGV4XTtcblxuICAgICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICAgIGlmICghZGVmaW5lZChpbWFnZVJlY3RhbmdsZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwiSW52YWxpZCBiaWxsYm9hcmQgaW1hZ2UgaW5kZXg6IFwiICsgaW5kZXgpO1xuICAgICAgfVxuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIHdpZHRoID0gaW1hZ2VSZWN0YW5nbGUud2lkdGg7XG4gICAgICBoZWlnaHQgPSBpbWFnZVJlY3RhbmdsZS5oZWlnaHQ7XG4gICAgfVxuXG4gICAgc2NyYXRjaENhcnRlc2lhbjIueCA9IHdpZHRoO1xuICAgIHNjcmF0Y2hDYXJ0ZXNpYW4yLnkgPSBoZWlnaHQ7XG4gICAgdmFyIGNvbXByZXNzZWRUZXhDb29yZHNSYW5nZSA9IEF0dHJpYnV0ZUNvbXByZXNzaW9uLmNvbXByZXNzVGV4dHVyZUNvb3JkaW5hdGVzKFxuICAgICAgc2NyYXRjaENhcnRlc2lhbjJcbiAgICApO1xuXG4gICAgaSA9IGJpbGxib2FyZC5faW5kZXg7XG4gICAgd3JpdGVyKGksIGV5ZU9mZnNldC54LCBleWVPZmZzZXQueSwgZXllT2Zmc2V0WiwgY29tcHJlc3NlZFRleENvb3Jkc1JhbmdlKTtcbiAgfSBlbHNlIHtcbiAgICBpID0gYmlsbGJvYXJkLl9pbmRleCAqIDQ7XG4gICAgd3JpdGVyKGkgKyAwLCBleWVPZmZzZXQueCwgZXllT2Zmc2V0LnksIGV5ZU9mZnNldFosIDAuMCk7XG4gICAgd3JpdGVyKGkgKyAxLCBleWVPZmZzZXQueCwgZXllT2Zmc2V0LnksIGV5ZU9mZnNldFosIDAuMCk7XG4gICAgd3JpdGVyKGkgKyAyLCBleWVPZmZzZXQueCwgZXllT2Zmc2V0LnksIGV5ZU9mZnNldFosIDAuMCk7XG4gICAgd3JpdGVyKGkgKyAzLCBleWVPZmZzZXQueCwgZXllT2Zmc2V0LnksIGV5ZU9mZnNldFosIDAuMCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gd3JpdGVTY2FsZUJ5RGlzdGFuY2UoXG4gIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gIGZyYW1lU3RhdGUsXG4gIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICB2YWZXcml0ZXJzLFxuICBiaWxsYm9hcmRcbikge1xuICB2YXIgaTtcbiAgdmFyIHdyaXRlciA9IHZhZldyaXRlcnNbYXR0cmlidXRlTG9jYXRpb25zLnNjYWxlQnlEaXN0YW5jZV07XG4gIHZhciBuZWFyID0gMC4wO1xuICB2YXIgbmVhclZhbHVlID0gMS4wO1xuICB2YXIgZmFyID0gMS4wO1xuICB2YXIgZmFyVmFsdWUgPSAxLjA7XG5cbiAgdmFyIHNjYWxlID0gYmlsbGJvYXJkLnNjYWxlQnlEaXN0YW5jZTtcbiAgaWYgKGRlZmluZWQoc2NhbGUpKSB7XG4gICAgbmVhciA9IHNjYWxlLm5lYXI7XG4gICAgbmVhclZhbHVlID0gc2NhbGUubmVhclZhbHVlO1xuICAgIGZhciA9IHNjYWxlLmZhcjtcbiAgICBmYXJWYWx1ZSA9IHNjYWxlLmZhclZhbHVlO1xuXG4gICAgaWYgKG5lYXJWYWx1ZSAhPT0gMS4wIHx8IGZhclZhbHVlICE9PSAxLjApIHtcbiAgICAgIC8vIHNjYWxlIGJ5IGRpc3RhbmNlIGNhbGN1bGF0aW9uIGluIHNoYWRlciBuZWVkIG5vdCBiZSBlbmFibGVkXG4gICAgICAvLyB1bnRpbCBhIGJpbGxib2FyZCB3aXRoIG5lYXIgYW5kIGZhciAhPT0gMS4wIGlzIGZvdW5kXG4gICAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9zaGFkZXJTY2FsZUJ5RGlzdGFuY2UgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChiaWxsYm9hcmRDb2xsZWN0aW9uLl9pbnN0YW5jZWQpIHtcbiAgICBpID0gYmlsbGJvYXJkLl9pbmRleDtcbiAgICB3cml0ZXIoaSwgbmVhciwgbmVhclZhbHVlLCBmYXIsIGZhclZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICBpID0gYmlsbGJvYXJkLl9pbmRleCAqIDQ7XG4gICAgd3JpdGVyKGkgKyAwLCBuZWFyLCBuZWFyVmFsdWUsIGZhciwgZmFyVmFsdWUpO1xuICAgIHdyaXRlcihpICsgMSwgbmVhciwgbmVhclZhbHVlLCBmYXIsIGZhclZhbHVlKTtcbiAgICB3cml0ZXIoaSArIDIsIG5lYXIsIG5lYXJWYWx1ZSwgZmFyLCBmYXJWYWx1ZSk7XG4gICAgd3JpdGVyKGkgKyAzLCBuZWFyLCBuZWFyVmFsdWUsIGZhciwgZmFyVmFsdWUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlUGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2UoXG4gIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gIGZyYW1lU3RhdGUsXG4gIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICB2YWZXcml0ZXJzLFxuICBiaWxsYm9hcmRcbikge1xuICB2YXIgaTtcbiAgdmFyIHdyaXRlciA9IHZhZldyaXRlcnNbYXR0cmlidXRlTG9jYXRpb25zLnBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlXTtcbiAgdmFyIG5lYXIgPSAwLjA7XG4gIHZhciBuZWFyVmFsdWUgPSAxLjA7XG4gIHZhciBmYXIgPSAxLjA7XG4gIHZhciBmYXJWYWx1ZSA9IDEuMDtcblxuICB2YXIgcGl4ZWxPZmZzZXRTY2FsZSA9IGJpbGxib2FyZC5waXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZTtcbiAgaWYgKGRlZmluZWQocGl4ZWxPZmZzZXRTY2FsZSkpIHtcbiAgICBuZWFyID0gcGl4ZWxPZmZzZXRTY2FsZS5uZWFyO1xuICAgIG5lYXJWYWx1ZSA9IHBpeGVsT2Zmc2V0U2NhbGUubmVhclZhbHVlO1xuICAgIGZhciA9IHBpeGVsT2Zmc2V0U2NhbGUuZmFyO1xuICAgIGZhclZhbHVlID0gcGl4ZWxPZmZzZXRTY2FsZS5mYXJWYWx1ZTtcblxuICAgIGlmIChuZWFyVmFsdWUgIT09IDEuMCB8fCBmYXJWYWx1ZSAhPT0gMS4wKSB7XG4gICAgICAvLyBwaXhlbE9mZnNldFNjYWxlIGJ5IGRpc3RhbmNlIGNhbGN1bGF0aW9uIGluIHNoYWRlciBuZWVkIG5vdCBiZSBlbmFibGVkXG4gICAgICAvLyB1bnRpbCBhIGJpbGxib2FyZCB3aXRoIG5lYXIgYW5kIGZhciAhPT0gMS4wIGlzIGZvdW5kXG4gICAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9zaGFkZXJQaXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgaWYgKGJpbGxib2FyZENvbGxlY3Rpb24uX2luc3RhbmNlZCkge1xuICAgIGkgPSBiaWxsYm9hcmQuX2luZGV4O1xuICAgIHdyaXRlcihpLCBuZWFyLCBuZWFyVmFsdWUsIGZhciwgZmFyVmFsdWUpO1xuICB9IGVsc2Uge1xuICAgIGkgPSBiaWxsYm9hcmQuX2luZGV4ICogNDtcbiAgICB3cml0ZXIoaSArIDAsIG5lYXIsIG5lYXJWYWx1ZSwgZmFyLCBmYXJWYWx1ZSk7XG4gICAgd3JpdGVyKGkgKyAxLCBuZWFyLCBuZWFyVmFsdWUsIGZhciwgZmFyVmFsdWUpO1xuICAgIHdyaXRlcihpICsgMiwgbmVhciwgbmVhclZhbHVlLCBmYXIsIGZhclZhbHVlKTtcbiAgICB3cml0ZXIoaSArIDMsIG5lYXIsIG5lYXJWYWx1ZSwgZmFyLCBmYXJWYWx1ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gd3JpdGVDb21wcmVzc2VkQXR0cmlidXRlMyhcbiAgYmlsbGJvYXJkQ29sbGVjdGlvbixcbiAgZnJhbWVTdGF0ZSxcbiAgdGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXMsXG4gIHZhZldyaXRlcnMsXG4gIGJpbGxib2FyZFxuKSB7XG4gIHZhciBpO1xuICB2YXIgd3JpdGVyID0gdmFmV3JpdGVyc1thdHRyaWJ1dGVMb2NhdGlvbnMuY29tcHJlc3NlZEF0dHJpYnV0ZTNdO1xuICB2YXIgbmVhciA9IDAuMDtcbiAgdmFyIGZhciA9IE51bWJlci5NQVhfVkFMVUU7XG5cbiAgdmFyIGRpc3RhbmNlRGlzcGxheUNvbmRpdGlvbiA9IGJpbGxib2FyZC5kaXN0YW5jZURpc3BsYXlDb25kaXRpb247XG4gIGlmIChkZWZpbmVkKGRpc3RhbmNlRGlzcGxheUNvbmRpdGlvbikpIHtcbiAgICBuZWFyID0gZGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uLm5lYXI7XG4gICAgZmFyID0gZGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uLmZhcjtcblxuICAgIG5lYXIgKj0gbmVhcjtcbiAgICBmYXIgKj0gZmFyO1xuXG4gICAgYmlsbGJvYXJkQ29sbGVjdGlvbi5fc2hhZGVyRGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uID0gdHJ1ZTtcbiAgfVxuXG4gIHZhciBkaXNhYmxlRGVwdGhUZXN0RGlzdGFuY2UgPSBiaWxsYm9hcmQuZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlO1xuICB2YXIgY2xhbXBUb0dyb3VuZCA9XG4gICAgYmlsbGJvYXJkLmhlaWdodFJlZmVyZW5jZSA9PT0gSGVpZ2h0UmVmZXJlbmNlLkNMQU1QX1RPX0dST1VORCAmJlxuICAgIGZyYW1lU3RhdGUuY29udGV4dC5kZXB0aFRleHR1cmU7XG4gIGlmICghZGVmaW5lZChkaXNhYmxlRGVwdGhUZXN0RGlzdGFuY2UpKSB7XG4gICAgZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlID0gY2xhbXBUb0dyb3VuZCA/IDUwMDAuMCA6IDAuMDtcbiAgfVxuXG4gIGRpc2FibGVEZXB0aFRlc3REaXN0YW5jZSAqPSBkaXNhYmxlRGVwdGhUZXN0RGlzdGFuY2U7XG4gIGlmIChjbGFtcFRvR3JvdW5kIHx8IGRpc2FibGVEZXB0aFRlc3REaXN0YW5jZSA+IDAuMCkge1xuICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX3NoYWRlckRpc2FibGVEZXB0aERpc3RhbmNlID0gdHJ1ZTtcbiAgICBpZiAoZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlID09PSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpIHtcbiAgICAgIGRpc2FibGVEZXB0aFRlc3REaXN0YW5jZSA9IC0xLjA7XG4gICAgfVxuICB9XG5cbiAgdmFyIGltYWdlSGVpZ2h0O1xuICB2YXIgaW1hZ2VXaWR0aDtcblxuICBpZiAoIWRlZmluZWQoYmlsbGJvYXJkLl9sYWJlbERpbWVuc2lvbnMpKSB7XG4gICAgdmFyIGhlaWdodCA9IDA7XG4gICAgdmFyIHdpZHRoID0gMDtcbiAgICB2YXIgaW5kZXggPSBiaWxsYm9hcmQuX2ltYWdlSW5kZXg7XG4gICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgdmFyIGltYWdlUmVjdGFuZ2xlID0gdGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXNbaW5kZXhdO1xuXG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgaWYgKCFkZWZpbmVkKGltYWdlUmVjdGFuZ2xlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXCJJbnZhbGlkIGJpbGxib2FyZCBpbWFnZSBpbmRleDogXCIgKyBpbmRleCk7XG4gICAgICB9XG4gICAgICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICAgICAgaGVpZ2h0ID0gaW1hZ2VSZWN0YW5nbGUuaGVpZ2h0O1xuICAgICAgd2lkdGggPSBpbWFnZVJlY3RhbmdsZS53aWR0aDtcbiAgICB9XG5cbiAgICBpbWFnZUhlaWdodCA9IE1hdGgucm91bmQoXG4gICAgICBkZWZhdWx0VmFsdWUoXG4gICAgICAgIGJpbGxib2FyZC5oZWlnaHQsXG4gICAgICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX3RleHR1cmVBdGxhcy50ZXh0dXJlLmRpbWVuc2lvbnMueSAqIGhlaWdodFxuICAgICAgKVxuICAgICk7XG5cbiAgICB2YXIgdGV4dHVyZVdpZHRoID0gYmlsbGJvYXJkQ29sbGVjdGlvbi5fdGV4dHVyZUF0bGFzLnRleHR1cmUud2lkdGg7XG4gICAgaW1hZ2VXaWR0aCA9IE1hdGgucm91bmQoXG4gICAgICBkZWZhdWx0VmFsdWUoYmlsbGJvYXJkLndpZHRoLCB0ZXh0dXJlV2lkdGggKiB3aWR0aClcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIGltYWdlV2lkdGggPSBiaWxsYm9hcmQuX2xhYmVsRGltZW5zaW9ucy54O1xuICAgIGltYWdlSGVpZ2h0ID0gYmlsbGJvYXJkLl9sYWJlbERpbWVuc2lvbnMueTtcbiAgfVxuXG4gIHZhciB3ID0gTWF0aC5mbG9vcihDZXNpdW1NYXRoLmNsYW1wKGltYWdlV2lkdGgsIDAuMCwgTEVGVF9TSElGVDEyKSk7XG4gIHZhciBoID0gTWF0aC5mbG9vcihDZXNpdW1NYXRoLmNsYW1wKGltYWdlSGVpZ2h0LCAwLjAsIExFRlRfU0hJRlQxMikpO1xuICB2YXIgZGltZW5zaW9ucyA9IHcgKiBMRUZUX1NISUZUMTIgKyBoO1xuXG4gIGlmIChiaWxsYm9hcmRDb2xsZWN0aW9uLl9pbnN0YW5jZWQpIHtcbiAgICBpID0gYmlsbGJvYXJkLl9pbmRleDtcbiAgICB3cml0ZXIoaSwgbmVhciwgZmFyLCBkaXNhYmxlRGVwdGhUZXN0RGlzdGFuY2UsIGRpbWVuc2lvbnMpO1xuICB9IGVsc2Uge1xuICAgIGkgPSBiaWxsYm9hcmQuX2luZGV4ICogNDtcbiAgICB3cml0ZXIoaSArIDAsIG5lYXIsIGZhciwgZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlLCBkaW1lbnNpb25zKTtcbiAgICB3cml0ZXIoaSArIDEsIG5lYXIsIGZhciwgZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlLCBkaW1lbnNpb25zKTtcbiAgICB3cml0ZXIoaSArIDIsIG5lYXIsIGZhciwgZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlLCBkaW1lbnNpb25zKTtcbiAgICB3cml0ZXIoaSArIDMsIG5lYXIsIGZhciwgZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlLCBkaW1lbnNpb25zKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB3cml0ZVRleHR1cmVDb29yZGluYXRlQm91bmRzT3JMYWJlbFRyYW5zbGF0ZShcbiAgYmlsbGJvYXJkQ29sbGVjdGlvbixcbiAgZnJhbWVTdGF0ZSxcbiAgdGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXMsXG4gIHZhZldyaXRlcnMsXG4gIGJpbGxib2FyZFxuKSB7XG4gIGlmIChiaWxsYm9hcmQuaGVpZ2h0UmVmZXJlbmNlID09PSBIZWlnaHRSZWZlcmVuY2UuQ0xBTVBfVE9fR1JPVU5EKSB7XG4gICAgdmFyIHNjZW5lID0gYmlsbGJvYXJkQ29sbGVjdGlvbi5fc2NlbmU7XG4gICAgdmFyIGNvbnRleHQgPSBmcmFtZVN0YXRlLmNvbnRleHQ7XG4gICAgdmFyIGdsb2JlVHJhbnNsdWNlbnQgPSBmcmFtZVN0YXRlLmdsb2JlVHJhbnNsdWNlbmN5U3RhdGUudHJhbnNsdWNlbnQ7XG4gICAgdmFyIGRlcHRoVGVzdEFnYWluc3RUZXJyYWluID1cbiAgICAgIGRlZmluZWQoc2NlbmUuZ2xvYmUpICYmIHNjZW5lLmdsb2JlLmRlcHRoVGVzdEFnYWluc3RUZXJyYWluO1xuXG4gICAgLy8gT25seSBkbyBtYW51YWwgZGVwdGggdGVzdCBpZiB0aGUgZ2xvYmUgaXMgb3BhcXVlIGFuZCB3cml0ZXMgZGVwdGhcbiAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9zaGFkZXJDbGFtcFRvR3JvdW5kID1cbiAgICAgIGNvbnRleHQuZGVwdGhUZXh0dXJlICYmICFnbG9iZVRyYW5zbHVjZW50ICYmIGRlcHRoVGVzdEFnYWluc3RUZXJyYWluO1xuICB9XG4gIHZhciBpO1xuICB2YXIgd3JpdGVyID1cbiAgICB2YWZXcml0ZXJzW2F0dHJpYnV0ZUxvY2F0aW9ucy50ZXh0dXJlQ29vcmRpbmF0ZUJvdW5kc09yTGFiZWxUcmFuc2xhdGVdO1xuXG4gIGlmIChDb250ZXh0TGltaXRzLm1heGltdW1WZXJ0ZXhUZXh0dXJlSW1hZ2VVbml0cyA+IDApIHtcbiAgICAvL3dyaXRlIF9sYWJlbFRyYW5zbGF0ZSwgdXNlZCBieSBkZXB0aCB0ZXN0aW5nIGluIHRoZSB2ZXJ0ZXggc2hhZGVyXG4gICAgdmFyIHRyYW5zbGF0ZVggPSAwO1xuICAgIHZhciB0cmFuc2xhdGVZID0gMDtcbiAgICBpZiAoZGVmaW5lZChiaWxsYm9hcmQuX2xhYmVsVHJhbnNsYXRlKSkge1xuICAgICAgdHJhbnNsYXRlWCA9IGJpbGxib2FyZC5fbGFiZWxUcmFuc2xhdGUueDtcbiAgICAgIHRyYW5zbGF0ZVkgPSBiaWxsYm9hcmQuX2xhYmVsVHJhbnNsYXRlLnk7XG4gICAgfVxuICAgIGlmIChiaWxsYm9hcmRDb2xsZWN0aW9uLl9pbnN0YW5jZWQpIHtcbiAgICAgIGkgPSBiaWxsYm9hcmQuX2luZGV4O1xuICAgICAgd3JpdGVyKGksIHRyYW5zbGF0ZVgsIHRyYW5zbGF0ZVksIDAuMCwgMC4wKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaSA9IGJpbGxib2FyZC5faW5kZXggKiA0O1xuICAgICAgd3JpdGVyKGkgKyAwLCB0cmFuc2xhdGVYLCB0cmFuc2xhdGVZLCAwLjAsIDAuMCk7XG4gICAgICB3cml0ZXIoaSArIDEsIHRyYW5zbGF0ZVgsIHRyYW5zbGF0ZVksIDAuMCwgMC4wKTtcbiAgICAgIHdyaXRlcihpICsgMiwgdHJhbnNsYXRlWCwgdHJhbnNsYXRlWSwgMC4wLCAwLjApO1xuICAgICAgd3JpdGVyKGkgKyAzLCB0cmFuc2xhdGVYLCB0cmFuc2xhdGVZLCAwLjAsIDAuMCk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vd3JpdGUgdGV4dHVyZSBjb29yZGluYXRlIGJvdW5kcywgdXNlZCBieSBkZXB0aCB0ZXN0aW5nIGluIGZyYWdtZW50IHNoYWRlclxuICB2YXIgbWluWCA9IDA7XG4gIHZhciBtaW5ZID0gMDtcbiAgdmFyIHdpZHRoID0gMDtcbiAgdmFyIGhlaWdodCA9IDA7XG4gIHZhciBpbmRleCA9IGJpbGxib2FyZC5faW1hZ2VJbmRleDtcbiAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgIHZhciBpbWFnZVJlY3RhbmdsZSA9IHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzW2luZGV4XTtcblxuICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgaWYgKCFkZWZpbmVkKGltYWdlUmVjdGFuZ2xlKSkge1xuICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwiSW52YWxpZCBiaWxsYm9hcmQgaW1hZ2UgaW5kZXg6IFwiICsgaW5kZXgpO1xuICAgIH1cbiAgICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICAgIG1pblggPSBpbWFnZVJlY3RhbmdsZS54O1xuICAgIG1pblkgPSBpbWFnZVJlY3RhbmdsZS55O1xuICAgIHdpZHRoID0gaW1hZ2VSZWN0YW5nbGUud2lkdGg7XG4gICAgaGVpZ2h0ID0gaW1hZ2VSZWN0YW5nbGUuaGVpZ2h0O1xuICB9XG4gIHZhciBtYXhYID0gbWluWCArIHdpZHRoO1xuICB2YXIgbWF4WSA9IG1pblkgKyBoZWlnaHQ7XG5cbiAgaWYgKGJpbGxib2FyZENvbGxlY3Rpb24uX2luc3RhbmNlZCkge1xuICAgIGkgPSBiaWxsYm9hcmQuX2luZGV4O1xuICAgIHdyaXRlcihpLCBtaW5YLCBtaW5ZLCBtYXhYLCBtYXhZKTtcbiAgfSBlbHNlIHtcbiAgICBpID0gYmlsbGJvYXJkLl9pbmRleCAqIDQ7XG4gICAgd3JpdGVyKGkgKyAwLCBtaW5YLCBtaW5ZLCBtYXhYLCBtYXhZKTtcbiAgICB3cml0ZXIoaSArIDEsIG1pblgsIG1pblksIG1heFgsIG1heFkpO1xuICAgIHdyaXRlcihpICsgMiwgbWluWCwgbWluWSwgbWF4WCwgbWF4WSk7XG4gICAgd3JpdGVyKGkgKyAzLCBtaW5YLCBtaW5ZLCBtYXhYLCBtYXhZKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB3cml0ZUJhdGNoSWQoXG4gIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gIGZyYW1lU3RhdGUsXG4gIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICB2YWZXcml0ZXJzLFxuICBiaWxsYm9hcmRcbikge1xuICBpZiAoIWRlZmluZWQoYmlsbGJvYXJkQ29sbGVjdGlvbi5fYmF0Y2hUYWJsZSkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgd3JpdGVyID0gdmFmV3JpdGVyc1thdHRyaWJ1dGVMb2NhdGlvbnMuYV9iYXRjaElkXTtcbiAgdmFyIGlkID0gYmlsbGJvYXJkLl9iYXRjaEluZGV4O1xuXG4gIHZhciBpO1xuICBpZiAoYmlsbGJvYXJkQ29sbGVjdGlvbi5faW5zdGFuY2VkKSB7XG4gICAgaSA9IGJpbGxib2FyZC5faW5kZXg7XG4gICAgd3JpdGVyKGksIGlkKTtcbiAgfSBlbHNlIHtcbiAgICBpID0gYmlsbGJvYXJkLl9pbmRleCAqIDQ7XG4gICAgd3JpdGVyKGkgKyAwLCBpZCk7XG4gICAgd3JpdGVyKGkgKyAxLCBpZCk7XG4gICAgd3JpdGVyKGkgKyAyLCBpZCk7XG4gICAgd3JpdGVyKGkgKyAzLCBpZCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gd3JpdGVTREYoXG4gIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gIGZyYW1lU3RhdGUsXG4gIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICB2YWZXcml0ZXJzLFxuICBiaWxsYm9hcmRcbikge1xuICBpZiAoIWJpbGxib2FyZENvbGxlY3Rpb24uX3NkZikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpO1xuICB2YXIgd3JpdGVyID0gdmFmV3JpdGVyc1thdHRyaWJ1dGVMb2NhdGlvbnMuc2RmXTtcblxuICB2YXIgb3V0bGluZUNvbG9yID0gYmlsbGJvYXJkLm91dGxpbmVDb2xvcjtcbiAgdmFyIG91dGxpbmVXaWR0aCA9IGJpbGxib2FyZC5vdXRsaW5lV2lkdGg7XG5cbiAgdmFyIHJlZCA9IENvbG9yLmZsb2F0VG9CeXRlKG91dGxpbmVDb2xvci5yZWQpO1xuICB2YXIgZ3JlZW4gPSBDb2xvci5mbG9hdFRvQnl0ZShvdXRsaW5lQ29sb3IuZ3JlZW4pO1xuICB2YXIgYmx1ZSA9IENvbG9yLmZsb2F0VG9CeXRlKG91dGxpbmVDb2xvci5ibHVlKTtcbiAgdmFyIGNvbXByZXNzZWQwID0gcmVkICogTEVGVF9TSElGVDE2ICsgZ3JlZW4gKiBMRUZUX1NISUZUOCArIGJsdWU7XG5cbiAgLy8gQ29tcHV0ZSB0aGUgcmVsYXRpdmUgb3V0bGluZSBkaXN0YW5jZVxuICB2YXIgb3V0bGluZURpc3RhbmNlID0gb3V0bGluZVdpZHRoIC8gU0RGU2V0dGluZ3MuUkFESVVTO1xuICB2YXIgY29tcHJlc3NlZDEgPVxuICAgIENvbG9yLmZsb2F0VG9CeXRlKG91dGxpbmVDb2xvci5hbHBoYSkgKiBMRUZUX1NISUZUMTYgK1xuICAgIENvbG9yLmZsb2F0VG9CeXRlKG91dGxpbmVEaXN0YW5jZSkgKiBMRUZUX1NISUZUODtcblxuICBpZiAoYmlsbGJvYXJkQ29sbGVjdGlvbi5faW5zdGFuY2VkKSB7XG4gICAgaSA9IGJpbGxib2FyZC5faW5kZXg7XG4gICAgd3JpdGVyKGksIGNvbXByZXNzZWQwLCBjb21wcmVzc2VkMSk7XG4gIH0gZWxzZSB7XG4gICAgaSA9IGJpbGxib2FyZC5faW5kZXggKiA0O1xuICAgIHdyaXRlcihpICsgMCwgY29tcHJlc3NlZDAgKyBMT1dFUl9MRUZULCBjb21wcmVzc2VkMSk7XG4gICAgd3JpdGVyKGkgKyAxLCBjb21wcmVzc2VkMCArIExPV0VSX1JJR0hULCBjb21wcmVzc2VkMSk7XG4gICAgd3JpdGVyKGkgKyAyLCBjb21wcmVzc2VkMCArIFVQUEVSX1JJR0hULCBjb21wcmVzc2VkMSk7XG4gICAgd3JpdGVyKGkgKyAzLCBjb21wcmVzc2VkMCArIFVQUEVSX0xFRlQsIGNvbXByZXNzZWQxKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB3cml0ZUJpbGxib2FyZChcbiAgYmlsbGJvYXJkQ29sbGVjdGlvbixcbiAgZnJhbWVTdGF0ZSxcbiAgdGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXMsXG4gIHZhZldyaXRlcnMsXG4gIGJpbGxib2FyZFxuKSB7XG4gIHdyaXRlUG9zaXRpb25TY2FsZUFuZFJvdGF0aW9uKFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gICAgZnJhbWVTdGF0ZSxcbiAgICB0ZXh0dXJlQXRsYXNDb29yZGluYXRlcyxcbiAgICB2YWZXcml0ZXJzLFxuICAgIGJpbGxib2FyZFxuICApO1xuICB3cml0ZUNvbXByZXNzZWRBdHRyaWIwKFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gICAgZnJhbWVTdGF0ZSxcbiAgICB0ZXh0dXJlQXRsYXNDb29yZGluYXRlcyxcbiAgICB2YWZXcml0ZXJzLFxuICAgIGJpbGxib2FyZFxuICApO1xuICB3cml0ZUNvbXByZXNzZWRBdHRyaWIxKFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gICAgZnJhbWVTdGF0ZSxcbiAgICB0ZXh0dXJlQXRsYXNDb29yZGluYXRlcyxcbiAgICB2YWZXcml0ZXJzLFxuICAgIGJpbGxib2FyZFxuICApO1xuICB3cml0ZUNvbXByZXNzZWRBdHRyaWIyKFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gICAgZnJhbWVTdGF0ZSxcbiAgICB0ZXh0dXJlQXRsYXNDb29yZGluYXRlcyxcbiAgICB2YWZXcml0ZXJzLFxuICAgIGJpbGxib2FyZFxuICApO1xuICB3cml0ZUV5ZU9mZnNldChcbiAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLFxuICAgIGZyYW1lU3RhdGUsXG4gICAgdGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXMsXG4gICAgdmFmV3JpdGVycyxcbiAgICBiaWxsYm9hcmRcbiAgKTtcbiAgd3JpdGVTY2FsZUJ5RGlzdGFuY2UoXG4gICAgYmlsbGJvYXJkQ29sbGVjdGlvbixcbiAgICBmcmFtZVN0YXRlLFxuICAgIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICAgIHZhZldyaXRlcnMsXG4gICAgYmlsbGJvYXJkXG4gICk7XG4gIHdyaXRlUGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2UoXG4gICAgYmlsbGJvYXJkQ29sbGVjdGlvbixcbiAgICBmcmFtZVN0YXRlLFxuICAgIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICAgIHZhZldyaXRlcnMsXG4gICAgYmlsbGJvYXJkXG4gICk7XG4gIHdyaXRlQ29tcHJlc3NlZEF0dHJpYnV0ZTMoXG4gICAgYmlsbGJvYXJkQ29sbGVjdGlvbixcbiAgICBmcmFtZVN0YXRlLFxuICAgIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICAgIHZhZldyaXRlcnMsXG4gICAgYmlsbGJvYXJkXG4gICk7XG4gIHdyaXRlVGV4dHVyZUNvb3JkaW5hdGVCb3VuZHNPckxhYmVsVHJhbnNsYXRlKFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gICAgZnJhbWVTdGF0ZSxcbiAgICB0ZXh0dXJlQXRsYXNDb29yZGluYXRlcyxcbiAgICB2YWZXcml0ZXJzLFxuICAgIGJpbGxib2FyZFxuICApO1xuICB3cml0ZUJhdGNoSWQoXG4gICAgYmlsbGJvYXJkQ29sbGVjdGlvbixcbiAgICBmcmFtZVN0YXRlLFxuICAgIHRleHR1cmVBdGxhc0Nvb3JkaW5hdGVzLFxuICAgIHZhZldyaXRlcnMsXG4gICAgYmlsbGJvYXJkXG4gICk7XG4gIHdyaXRlU0RGKFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gICAgZnJhbWVTdGF0ZSxcbiAgICB0ZXh0dXJlQXRsYXNDb29yZGluYXRlcyxcbiAgICB2YWZXcml0ZXJzLFxuICAgIGJpbGxib2FyZFxuICApO1xufVxuXG5mdW5jdGlvbiByZWNvbXB1dGVBY3R1YWxQb3NpdGlvbnMoXG4gIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gIGJpbGxib2FyZHMsXG4gIGxlbmd0aCxcbiAgZnJhbWVTdGF0ZSxcbiAgbW9kZWxNYXRyaXgsXG4gIHJlY29tcHV0ZUJvdW5kaW5nVm9sdW1lXG4pIHtcbiAgdmFyIGJvdW5kaW5nVm9sdW1lO1xuICBpZiAoZnJhbWVTdGF0ZS5tb2RlID09PSBTY2VuZU1vZGUuU0NFTkUzRCkge1xuICAgIGJvdW5kaW5nVm9sdW1lID0gYmlsbGJvYXJkQ29sbGVjdGlvbi5fYmFzZVZvbHVtZTtcbiAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9ib3VuZGluZ1ZvbHVtZURpcnR5ID0gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICBib3VuZGluZ1ZvbHVtZSA9IGJpbGxib2FyZENvbGxlY3Rpb24uX2Jhc2VWb2x1bWUyRDtcbiAgfVxuXG4gIHZhciBwb3NpdGlvbnMgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgIHZhciBiaWxsYm9hcmQgPSBiaWxsYm9hcmRzW2ldO1xuICAgIHZhciBwb3NpdGlvbiA9IGJpbGxib2FyZC5wb3NpdGlvbjtcbiAgICB2YXIgYWN0dWFsUG9zaXRpb24gPSBCaWxsYm9hcmQuX2NvbXB1dGVBY3R1YWxQb3NpdGlvbihcbiAgICAgIGJpbGxib2FyZCxcbiAgICAgIHBvc2l0aW9uLFxuICAgICAgZnJhbWVTdGF0ZSxcbiAgICAgIG1vZGVsTWF0cml4XG4gICAgKTtcbiAgICBpZiAoZGVmaW5lZChhY3R1YWxQb3NpdGlvbikpIHtcbiAgICAgIGJpbGxib2FyZC5fc2V0QWN0dWFsUG9zaXRpb24oYWN0dWFsUG9zaXRpb24pO1xuXG4gICAgICBpZiAocmVjb21wdXRlQm91bmRpbmdWb2x1bWUpIHtcbiAgICAgICAgcG9zaXRpb25zLnB1c2goYWN0dWFsUG9zaXRpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgQm91bmRpbmdTcGhlcmUuZXhwYW5kKGJvdW5kaW5nVm9sdW1lLCBhY3R1YWxQb3NpdGlvbiwgYm91bmRpbmdWb2x1bWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChyZWNvbXB1dGVCb3VuZGluZ1ZvbHVtZSkge1xuICAgIEJvdW5kaW5nU3BoZXJlLmZyb21Qb2ludHMocG9zaXRpb25zLCBib3VuZGluZ1ZvbHVtZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gdXBkYXRlTW9kZShiaWxsYm9hcmRDb2xsZWN0aW9uLCBmcmFtZVN0YXRlKSB7XG4gIHZhciBtb2RlID0gZnJhbWVTdGF0ZS5tb2RlO1xuXG4gIHZhciBiaWxsYm9hcmRzID0gYmlsbGJvYXJkQ29sbGVjdGlvbi5fYmlsbGJvYXJkcztcbiAgdmFyIGJpbGxib2FyZHNUb1VwZGF0ZSA9IGJpbGxib2FyZENvbGxlY3Rpb24uX2JpbGxib2FyZHNUb1VwZGF0ZTtcbiAgdmFyIG1vZGVsTWF0cml4ID0gYmlsbGJvYXJkQ29sbGVjdGlvbi5fbW9kZWxNYXRyaXg7XG5cbiAgaWYgKFxuICAgIGJpbGxib2FyZENvbGxlY3Rpb24uX2NyZWF0ZVZlcnRleEFycmF5IHx8XG4gICAgYmlsbGJvYXJkQ29sbGVjdGlvbi5fbW9kZSAhPT0gbW9kZSB8fFxuICAgIChtb2RlICE9PSBTY2VuZU1vZGUuU0NFTkUzRCAmJlxuICAgICAgIU1hdHJpeDQuZXF1YWxzKG1vZGVsTWF0cml4LCBiaWxsYm9hcmRDb2xsZWN0aW9uLm1vZGVsTWF0cml4KSlcbiAgKSB7XG4gICAgYmlsbGJvYXJkQ29sbGVjdGlvbi5fbW9kZSA9IG1vZGU7XG4gICAgTWF0cml4NC5jbG9uZShiaWxsYm9hcmRDb2xsZWN0aW9uLm1vZGVsTWF0cml4LCBtb2RlbE1hdHJpeCk7XG4gICAgYmlsbGJvYXJkQ29sbGVjdGlvbi5fY3JlYXRlVmVydGV4QXJyYXkgPSB0cnVlO1xuXG4gICAgaWYgKFxuICAgICAgbW9kZSA9PT0gU2NlbmVNb2RlLlNDRU5FM0QgfHxcbiAgICAgIG1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTJEIHx8XG4gICAgICBtb2RlID09PSBTY2VuZU1vZGUuQ09MVU1CVVNfVklFV1xuICAgICkge1xuICAgICAgcmVjb21wdXRlQWN0dWFsUG9zaXRpb25zKFxuICAgICAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLFxuICAgICAgICBiaWxsYm9hcmRzLFxuICAgICAgICBiaWxsYm9hcmRzLmxlbmd0aCxcbiAgICAgICAgZnJhbWVTdGF0ZSxcbiAgICAgICAgbW9kZWxNYXRyaXgsXG4gICAgICAgIHRydWVcbiAgICAgICk7XG4gICAgfVxuICB9IGVsc2UgaWYgKG1vZGUgPT09IFNjZW5lTW9kZS5NT1JQSElORykge1xuICAgIHJlY29tcHV0ZUFjdHVhbFBvc2l0aW9ucyhcbiAgICAgIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gICAgICBiaWxsYm9hcmRzLFxuICAgICAgYmlsbGJvYXJkcy5sZW5ndGgsXG4gICAgICBmcmFtZVN0YXRlLFxuICAgICAgbW9kZWxNYXRyaXgsXG4gICAgICB0cnVlXG4gICAgKTtcbiAgfSBlbHNlIGlmIChtb2RlID09PSBTY2VuZU1vZGUuU0NFTkUyRCB8fCBtb2RlID09PSBTY2VuZU1vZGUuQ09MVU1CVVNfVklFVykge1xuICAgIHJlY29tcHV0ZUFjdHVhbFBvc2l0aW9ucyhcbiAgICAgIGJpbGxib2FyZENvbGxlY3Rpb24sXG4gICAgICBiaWxsYm9hcmRzVG9VcGRhdGUsXG4gICAgICBiaWxsYm9hcmRDb2xsZWN0aW9uLl9iaWxsYm9hcmRzVG9VcGRhdGVJbmRleCxcbiAgICAgIGZyYW1lU3RhdGUsXG4gICAgICBtb2RlbE1hdHJpeCxcbiAgICAgIGZhbHNlXG4gICAgKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB1cGRhdGVCb3VuZGluZ1ZvbHVtZShjb2xsZWN0aW9uLCBmcmFtZVN0YXRlLCBib3VuZGluZ1ZvbHVtZSkge1xuICB2YXIgcGl4ZWxTY2FsZSA9IDEuMDtcbiAgaWYgKCFjb2xsZWN0aW9uLl9hbGxTaXplZEluTWV0ZXJzIHx8IGNvbGxlY3Rpb24uX21heFBpeGVsT2Zmc2V0ICE9PSAwLjApIHtcbiAgICBwaXhlbFNjYWxlID0gZnJhbWVTdGF0ZS5jYW1lcmEuZ2V0UGl4ZWxTaXplKFxuICAgICAgYm91bmRpbmdWb2x1bWUsXG4gICAgICBmcmFtZVN0YXRlLmNvbnRleHQuZHJhd2luZ0J1ZmZlcldpZHRoLFxuICAgICAgZnJhbWVTdGF0ZS5jb250ZXh0LmRyYXdpbmdCdWZmZXJIZWlnaHRcbiAgICApO1xuICB9XG5cbiAgdmFyIHNpemUgPSBwaXhlbFNjYWxlICogY29sbGVjdGlvbi5fbWF4U2NhbGUgKiBjb2xsZWN0aW9uLl9tYXhTaXplICogMi4wO1xuICBpZiAoY29sbGVjdGlvbi5fYWxsSG9yaXpvbnRhbENlbnRlciAmJiBjb2xsZWN0aW9uLl9hbGxWZXJ0aWNhbENlbnRlcikge1xuICAgIHNpemUgKj0gMC41O1xuICB9XG5cbiAgdmFyIG9mZnNldCA9XG4gICAgcGl4ZWxTY2FsZSAqIGNvbGxlY3Rpb24uX21heFBpeGVsT2Zmc2V0ICsgY29sbGVjdGlvbi5fbWF4RXllT2Zmc2V0O1xuICBib3VuZGluZ1ZvbHVtZS5yYWRpdXMgKz0gc2l6ZSArIG9mZnNldDtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRGVidWdDb21tYW5kKGJpbGxib2FyZENvbGxlY3Rpb24sIGNvbnRleHQpIHtcbiAgdmFyIGZzO1xuICBmcyA9XG4gICAgXCJ1bmlmb3JtIHNhbXBsZXIyRCBiaWxsYm9hcmRfdGV4dHVyZTsgXFxuXCIgK1xuICAgIFwidmFyeWluZyB2ZWMyIHZfdGV4dHVyZUNvb3JkaW5hdGVzOyBcXG5cIiArXG4gICAgXCJ2b2lkIG1haW4oKSBcXG5cIiArXG4gICAgXCJ7IFxcblwiICtcbiAgICBcIiAgICBnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQoYmlsbGJvYXJkX3RleHR1cmUsIHZfdGV4dHVyZUNvb3JkaW5hdGVzKTsgXFxuXCIgK1xuICAgIFwifSBcXG5cIjtcblxuICB2YXIgZHJhd0NvbW1hbmQgPSBjb250ZXh0LmNyZWF0ZVZpZXdwb3J0UXVhZENvbW1hbmQoZnMsIHtcbiAgICB1bmlmb3JtTWFwOiB7XG4gICAgICBiaWxsYm9hcmRfdGV4dHVyZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gYmlsbGJvYXJkQ29sbGVjdGlvbi5fdGV4dHVyZUF0bGFzLnRleHR1cmU7XG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuICBkcmF3Q29tbWFuZC5wYXNzID0gUGFzcy5PVkVSTEFZO1xuICByZXR1cm4gZHJhd0NvbW1hbmQ7XG59XG5cbnZhciBzY3JhdGNoV3JpdGVyQXJyYXkgPSBbXTtcblxuLyoqXG4gKiBDYWxsZWQgd2hlbiB7QGxpbmsgVmlld2VyfSBvciB7QGxpbmsgQ2VzaXVtV2lkZ2V0fSByZW5kZXIgdGhlIHNjZW5lIHRvXG4gKiBnZXQgdGhlIGRyYXcgY29tbWFuZHMgbmVlZGVkIHRvIHJlbmRlciB0aGlzIHByaW1pdGl2ZS5cbiAqIDxwPlxuICogRG8gbm90IGNhbGwgdGhpcyBmdW5jdGlvbiBkaXJlY3RseS4gIFRoaXMgaXMgZG9jdW1lbnRlZCBqdXN0IHRvXG4gKiBsaXN0IHRoZSBleGNlcHRpb25zIHRoYXQgbWF5IGJlIHByb3BhZ2F0ZWQgd2hlbiB0aGUgc2NlbmUgaXMgcmVuZGVyZWQ6XG4gKiA8L3A+XG4gKlxuICogQGV4Y2VwdGlvbiB7UnVudGltZUVycm9yfSBpbWFnZSB3aXRoIGlkIG11c3QgYmUgaW4gdGhlIGF0bGFzLlxuICovXG5CaWxsYm9hcmRDb2xsZWN0aW9uLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZnJhbWVTdGF0ZSkge1xuICByZW1vdmVCaWxsYm9hcmRzKHRoaXMpO1xuXG4gIGlmICghdGhpcy5zaG93KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGJpbGxib2FyZHMgPSB0aGlzLl9iaWxsYm9hcmRzO1xuICB2YXIgYmlsbGJvYXJkc0xlbmd0aCA9IGJpbGxib2FyZHMubGVuZ3RoO1xuXG4gIHZhciBjb250ZXh0ID0gZnJhbWVTdGF0ZS5jb250ZXh0O1xuICB0aGlzLl9pbnN0YW5jZWQgPSBjb250ZXh0Lmluc3RhbmNlZEFycmF5cztcbiAgYXR0cmlidXRlTG9jYXRpb25zID0gdGhpcy5faW5zdGFuY2VkXG4gICAgPyBhdHRyaWJ1dGVMb2NhdGlvbnNJbnN0YW5jZWRcbiAgICA6IGF0dHJpYnV0ZUxvY2F0aW9uc0JhdGNoZWQ7XG4gIGdldEluZGV4QnVmZmVyID0gdGhpcy5faW5zdGFuY2VkXG4gICAgPyBnZXRJbmRleEJ1ZmZlckluc3RhbmNlZFxuICAgIDogZ2V0SW5kZXhCdWZmZXJCYXRjaGVkO1xuXG4gIHZhciB0ZXh0dXJlQXRsYXMgPSB0aGlzLl90ZXh0dXJlQXRsYXM7XG4gIGlmICghZGVmaW5lZCh0ZXh0dXJlQXRsYXMpKSB7XG4gICAgdGV4dHVyZUF0bGFzID0gdGhpcy5fdGV4dHVyZUF0bGFzID0gbmV3IFRleHR1cmVBdGxhcyh7XG4gICAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIH0pO1xuXG4gICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IGJpbGxib2FyZHNMZW5ndGg7ICsraWkpIHtcbiAgICAgIGJpbGxib2FyZHNbaWldLl9sb2FkSW1hZ2UoKTtcbiAgICB9XG4gIH1cblxuICB2YXIgdGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQXRsYXMudGV4dHVyZUNvb3JkaW5hdGVzO1xuICBpZiAodGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgLy8gQ2FuJ3Qgd3JpdGUgYmlsbGJvYXJkIHZlcnRpY2VzIHVudGlsIHdlIGhhdmUgdGV4dHVyZSBjb29yZGluYXRlc1xuICAgIC8vIHByb3ZpZGVkIGJ5IGEgdGV4dHVyZSBhdGxhc1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHVwZGF0ZU1vZGUodGhpcywgZnJhbWVTdGF0ZSk7XG5cbiAgYmlsbGJvYXJkcyA9IHRoaXMuX2JpbGxib2FyZHM7XG4gIGJpbGxib2FyZHNMZW5ndGggPSBiaWxsYm9hcmRzLmxlbmd0aDtcbiAgdmFyIGJpbGxib2FyZHNUb1VwZGF0ZSA9IHRoaXMuX2JpbGxib2FyZHNUb1VwZGF0ZTtcbiAgdmFyIGJpbGxib2FyZHNUb1VwZGF0ZUxlbmd0aCA9IHRoaXMuX2JpbGxib2FyZHNUb1VwZGF0ZUluZGV4O1xuXG4gIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllc0NoYW5nZWQ7XG5cbiAgdmFyIHRleHR1cmVBdGxhc0dVSUQgPSB0ZXh0dXJlQXRsYXMuZ3VpZDtcbiAgdmFyIGNyZWF0ZVZlcnRleEFycmF5ID1cbiAgICB0aGlzLl9jcmVhdGVWZXJ0ZXhBcnJheSB8fCB0aGlzLl90ZXh0dXJlQXRsYXNHVUlEICE9PSB0ZXh0dXJlQXRsYXNHVUlEO1xuICB0aGlzLl90ZXh0dXJlQXRsYXNHVUlEID0gdGV4dHVyZUF0bGFzR1VJRDtcblxuICB2YXIgdmFmV3JpdGVycztcbiAgdmFyIHBhc3MgPSBmcmFtZVN0YXRlLnBhc3NlcztcbiAgdmFyIHBpY2tpbmcgPSBwYXNzLnBpY2s7XG5cbiAgLy8gUEVSRk9STUFOQ0VfSURFQTogUm91bmQgcm9iaW4gbXVsdGlwbGUgYnVmZmVycy5cbiAgaWYgKGNyZWF0ZVZlcnRleEFycmF5IHx8ICghcGlja2luZyAmJiB0aGlzLmNvbXB1dGVOZXdCdWZmZXJzVXNhZ2UoKSkpIHtcbiAgICB0aGlzLl9jcmVhdGVWZXJ0ZXhBcnJheSA9IGZhbHNlO1xuXG4gICAgZm9yICh2YXIgayA9IDA7IGsgPCBOVU1CRVJfT0ZfUFJPUEVSVElFUzsgKytrKSB7XG4gICAgICBwcm9wZXJ0aWVzW2tdID0gMDtcbiAgICB9XG5cbiAgICB0aGlzLl92YWYgPSB0aGlzLl92YWYgJiYgdGhpcy5fdmFmLmRlc3Ryb3koKTtcblxuICAgIGlmIChiaWxsYm9hcmRzTGVuZ3RoID4gMCkge1xuICAgICAgLy8gUEVSRk9STUFOQ0VfSURFQTogIEluc3RlYWQgb2YgY3JlYXRpbmcgYSBuZXcgb25lLCByZXNpemUgbGlrZSBzdGQ6OnZlY3Rvci5cbiAgICAgIHRoaXMuX3ZhZiA9IGNyZWF0ZVZBRihcbiAgICAgICAgY29udGV4dCxcbiAgICAgICAgYmlsbGJvYXJkc0xlbmd0aCxcbiAgICAgICAgdGhpcy5fYnVmZmVyc1VzYWdlLFxuICAgICAgICB0aGlzLl9pbnN0YW5jZWQsXG4gICAgICAgIHRoaXMuX2JhdGNoVGFibGUsXG4gICAgICAgIHRoaXMuX3NkZlxuICAgICAgKTtcbiAgICAgIHZhZldyaXRlcnMgPSB0aGlzLl92YWYud3JpdGVycztcblxuICAgICAgLy8gUmV3cml0ZSBlbnRpcmUgYnVmZmVyIGlmIGJpbGxib2FyZHMgd2VyZSBhZGRlZCBvciByZW1vdmVkLlxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaWxsYm9hcmRzTGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGJpbGxib2FyZCA9IHRoaXMuX2JpbGxib2FyZHNbaV07XG4gICAgICAgIGJpbGxib2FyZC5fZGlydHkgPSBmYWxzZTsgLy8gSW4gY2FzZSBpdCBuZWVkZWQgYW4gdXBkYXRlLlxuICAgICAgICB3cml0ZUJpbGxib2FyZChcbiAgICAgICAgICB0aGlzLFxuICAgICAgICAgIGZyYW1lU3RhdGUsXG4gICAgICAgICAgdGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXMsXG4gICAgICAgICAgdmFmV3JpdGVycyxcbiAgICAgICAgICBiaWxsYm9hcmRcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gRGlmZmVyZW50IGJpbGxib2FyZCBjb2xsZWN0aW9ucyBzaGFyZSB0aGUgc2FtZSBpbmRleCBidWZmZXIuXG4gICAgICB0aGlzLl92YWYuY29tbWl0KGdldEluZGV4QnVmZmVyKGNvbnRleHQpKTtcbiAgICB9XG5cbiAgICB0aGlzLl9iaWxsYm9hcmRzVG9VcGRhdGVJbmRleCA9IDA7XG4gIH0gZWxzZSBpZiAoYmlsbGJvYXJkc1RvVXBkYXRlTGVuZ3RoID4gMCkge1xuICAgIC8vIEJpbGxib2FyZHMgd2VyZSBtb2RpZmllZCwgYnV0IG5vbmUgd2VyZSBhZGRlZCBvciByZW1vdmVkLlxuICAgIHZhciB3cml0ZXJzID0gc2NyYXRjaFdyaXRlckFycmF5O1xuICAgIHdyaXRlcnMubGVuZ3RoID0gMDtcblxuICAgIGlmIChcbiAgICAgIHByb3BlcnRpZXNbUE9TSVRJT05fSU5ERVhdIHx8XG4gICAgICBwcm9wZXJ0aWVzW1JPVEFUSU9OX0lOREVYXSB8fFxuICAgICAgcHJvcGVydGllc1tTQ0FMRV9JTkRFWF1cbiAgICApIHtcbiAgICAgIHdyaXRlcnMucHVzaCh3cml0ZVBvc2l0aW9uU2NhbGVBbmRSb3RhdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgcHJvcGVydGllc1tJTUFHRV9JTkRFWF9JTkRFWF0gfHxcbiAgICAgIHByb3BlcnRpZXNbUElYRUxfT0ZGU0VUX0lOREVYXSB8fFxuICAgICAgcHJvcGVydGllc1tIT1JJWk9OVEFMX09SSUdJTl9JTkRFWF0gfHxcbiAgICAgIHByb3BlcnRpZXNbVkVSVElDQUxfT1JJR0lOX0lOREVYXSB8fFxuICAgICAgcHJvcGVydGllc1tTSE9XX0lOREVYXVxuICAgICkge1xuICAgICAgd3JpdGVycy5wdXNoKHdyaXRlQ29tcHJlc3NlZEF0dHJpYjApO1xuICAgICAgaWYgKHRoaXMuX2luc3RhbmNlZCkge1xuICAgICAgICB3cml0ZXJzLnB1c2god3JpdGVFeWVPZmZzZXQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgIHByb3BlcnRpZXNbSU1BR0VfSU5ERVhfSU5ERVhdIHx8XG4gICAgICBwcm9wZXJ0aWVzW0FMSUdORURfQVhJU19JTkRFWF0gfHxcbiAgICAgIHByb3BlcnRpZXNbVFJBTlNMVUNFTkNZX0JZX0RJU1RBTkNFX0lOREVYXVxuICAgICkge1xuICAgICAgd3JpdGVycy5wdXNoKHdyaXRlQ29tcHJlc3NlZEF0dHJpYjEpO1xuICAgICAgd3JpdGVycy5wdXNoKHdyaXRlQ29tcHJlc3NlZEF0dHJpYjIpO1xuICAgIH1cblxuICAgIGlmIChwcm9wZXJ0aWVzW0lNQUdFX0lOREVYX0lOREVYXSB8fCBwcm9wZXJ0aWVzW0NPTE9SX0lOREVYXSkge1xuICAgICAgd3JpdGVycy5wdXNoKHdyaXRlQ29tcHJlc3NlZEF0dHJpYjIpO1xuICAgIH1cblxuICAgIGlmIChwcm9wZXJ0aWVzW0VZRV9PRkZTRVRfSU5ERVhdKSB7XG4gICAgICB3cml0ZXJzLnB1c2god3JpdGVFeWVPZmZzZXQpO1xuICAgIH1cblxuICAgIGlmIChwcm9wZXJ0aWVzW1NDQUxFX0JZX0RJU1RBTkNFX0lOREVYXSkge1xuICAgICAgd3JpdGVycy5wdXNoKHdyaXRlU2NhbGVCeURpc3RhbmNlKTtcbiAgICB9XG5cbiAgICBpZiAocHJvcGVydGllc1tQSVhFTF9PRkZTRVRfU0NBTEVfQllfRElTVEFOQ0VfSU5ERVhdKSB7XG4gICAgICB3cml0ZXJzLnB1c2god3JpdGVQaXhlbE9mZnNldFNjYWxlQnlEaXN0YW5jZSk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgcHJvcGVydGllc1tESVNUQU5DRV9ESVNQTEFZX0NPTkRJVElPTl9JTkRFWF0gfHxcbiAgICAgIHByb3BlcnRpZXNbRElTQUJMRV9ERVBUSF9ESVNUQU5DRV0gfHxcbiAgICAgIHByb3BlcnRpZXNbSU1BR0VfSU5ERVhfSU5ERVhdIHx8XG4gICAgICBwcm9wZXJ0aWVzW1BPU0lUSU9OX0lOREVYXVxuICAgICkge1xuICAgICAgd3JpdGVycy5wdXNoKHdyaXRlQ29tcHJlc3NlZEF0dHJpYnV0ZTMpO1xuICAgIH1cblxuICAgIGlmIChwcm9wZXJ0aWVzW0lNQUdFX0lOREVYX0lOREVYXSB8fCBwcm9wZXJ0aWVzW1BPU0lUSU9OX0lOREVYXSkge1xuICAgICAgd3JpdGVycy5wdXNoKHdyaXRlVGV4dHVyZUNvb3JkaW5hdGVCb3VuZHNPckxhYmVsVHJhbnNsYXRlKTtcbiAgICB9XG5cbiAgICBpZiAocHJvcGVydGllc1tTREZfSU5ERVhdKSB7XG4gICAgICB3cml0ZXJzLnB1c2god3JpdGVTREYpO1xuICAgIH1cblxuICAgIHZhciBudW1Xcml0ZXJzID0gd3JpdGVycy5sZW5ndGg7XG4gICAgdmFmV3JpdGVycyA9IHRoaXMuX3ZhZi53cml0ZXJzO1xuXG4gICAgaWYgKGJpbGxib2FyZHNUb1VwZGF0ZUxlbmd0aCAvIGJpbGxib2FyZHNMZW5ndGggPiAwLjEpIHtcbiAgICAgIC8vIElmIG1vcmUgdGhhbiAxMCUgb2YgYmlsbGJvYXJkIGNoYW5nZSwgcmV3cml0ZSB0aGUgZW50aXJlIGJ1ZmZlci5cblxuICAgICAgLy8gUEVSRk9STUFOQ0VfSURFQTogIEkgdG90YWxseSBtYWRlIHVwIDEwJSA6KS5cblxuICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBiaWxsYm9hcmRzVG9VcGRhdGVMZW5ndGg7ICsrbSkge1xuICAgICAgICB2YXIgYiA9IGJpbGxib2FyZHNUb1VwZGF0ZVttXTtcbiAgICAgICAgYi5fZGlydHkgPSBmYWxzZTtcblxuICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IG51bVdyaXRlcnM7ICsrbikge1xuICAgICAgICAgIHdyaXRlcnNbbl0odGhpcywgZnJhbWVTdGF0ZSwgdGV4dHVyZUF0bGFzQ29vcmRpbmF0ZXMsIHZhZldyaXRlcnMsIGIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl92YWYuY29tbWl0KGdldEluZGV4QnVmZmVyKGNvbnRleHQpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZm9yICh2YXIgaCA9IDA7IGggPCBiaWxsYm9hcmRzVG9VcGRhdGVMZW5ndGg7ICsraCkge1xuICAgICAgICB2YXIgYmIgPSBiaWxsYm9hcmRzVG9VcGRhdGVbaF07XG4gICAgICAgIGJiLl9kaXJ0eSA9IGZhbHNlO1xuXG4gICAgICAgIGZvciAodmFyIG8gPSAwOyBvIDwgbnVtV3JpdGVyczsgKytvKSB7XG4gICAgICAgICAgd3JpdGVyc1tvXSh0aGlzLCBmcmFtZVN0YXRlLCB0ZXh0dXJlQXRsYXNDb29yZGluYXRlcywgdmFmV3JpdGVycywgYmIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX2luc3RhbmNlZCkge1xuICAgICAgICAgIHRoaXMuX3ZhZi5zdWJDb21taXQoYmIuX2luZGV4LCAxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLl92YWYuc3ViQ29tbWl0KGJiLl9pbmRleCAqIDQsIDQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl92YWYuZW5kU3ViQ29tbWl0cygpO1xuICAgIH1cblxuICAgIHRoaXMuX2JpbGxib2FyZHNUb1VwZGF0ZUluZGV4ID0gMDtcbiAgfVxuXG4gIC8vIElmIHRoZSBudW1iZXIgb2YgdG90YWwgYmlsbGJvYXJkcyBldmVyIHNocmlua3MgY29uc2lkZXJhYmx5XG4gIC8vIFRydW5jYXRlIGJpbGxib2FyZHNUb1VwZGF0ZSBzbyB0aGF0IHdlIGZyZWUgbWVtb3J5IHRoYXQgd2UncmVcbiAgLy8gbm90IGdvaW5nIHRvIGJlIHVzaW5nLlxuICBpZiAoYmlsbGJvYXJkc1RvVXBkYXRlTGVuZ3RoID4gYmlsbGJvYXJkc0xlbmd0aCAqIDEuNSkge1xuICAgIGJpbGxib2FyZHNUb1VwZGF0ZS5sZW5ndGggPSBiaWxsYm9hcmRzTGVuZ3RoO1xuICB9XG5cbiAgaWYgKCFkZWZpbmVkKHRoaXMuX3ZhZikgfHwgIWRlZmluZWQodGhpcy5fdmFmLnZhKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICh0aGlzLl9ib3VuZGluZ1ZvbHVtZURpcnR5KSB7XG4gICAgdGhpcy5fYm91bmRpbmdWb2x1bWVEaXJ0eSA9IGZhbHNlO1xuICAgIEJvdW5kaW5nU3BoZXJlLnRyYW5zZm9ybShcbiAgICAgIHRoaXMuX2Jhc2VWb2x1bWUsXG4gICAgICB0aGlzLm1vZGVsTWF0cml4LFxuICAgICAgdGhpcy5fYmFzZVZvbHVtZVdDXG4gICAgKTtcbiAgfVxuXG4gIHZhciBib3VuZGluZ1ZvbHVtZTtcbiAgdmFyIG1vZGVsTWF0cml4ID0gTWF0cml4NC5JREVOVElUWTtcbiAgaWYgKGZyYW1lU3RhdGUubW9kZSA9PT0gU2NlbmVNb2RlLlNDRU5FM0QpIHtcbiAgICBtb2RlbE1hdHJpeCA9IHRoaXMubW9kZWxNYXRyaXg7XG4gICAgYm91bmRpbmdWb2x1bWUgPSBCb3VuZGluZ1NwaGVyZS5jbG9uZShcbiAgICAgIHRoaXMuX2Jhc2VWb2x1bWVXQyxcbiAgICAgIHRoaXMuX2JvdW5kaW5nVm9sdW1lXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICBib3VuZGluZ1ZvbHVtZSA9IEJvdW5kaW5nU3BoZXJlLmNsb25lKFxuICAgICAgdGhpcy5fYmFzZVZvbHVtZTJELFxuICAgICAgdGhpcy5fYm91bmRpbmdWb2x1bWVcbiAgICApO1xuICB9XG4gIHVwZGF0ZUJvdW5kaW5nVm9sdW1lKHRoaXMsIGZyYW1lU3RhdGUsIGJvdW5kaW5nVm9sdW1lKTtcblxuICB2YXIgYmxlbmRPcHRpb25DaGFuZ2VkID0gdGhpcy5fYmxlbmRPcHRpb24gIT09IHRoaXMuYmxlbmRPcHRpb247XG4gIHRoaXMuX2JsZW5kT3B0aW9uID0gdGhpcy5ibGVuZE9wdGlvbjtcblxuICBpZiAoYmxlbmRPcHRpb25DaGFuZ2VkKSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5fYmxlbmRPcHRpb24gPT09IEJsZW5kT3B0aW9uLk9QQVFVRSB8fFxuICAgICAgdGhpcy5fYmxlbmRPcHRpb24gPT09IEJsZW5kT3B0aW9uLk9QQVFVRV9BTkRfVFJBTlNMVUNFTlRcbiAgICApIHtcbiAgICAgIHRoaXMuX3JzT3BhcXVlID0gUmVuZGVyU3RhdGUuZnJvbUNhY2hlKHtcbiAgICAgICAgZGVwdGhUZXN0OiB7XG4gICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICBmdW5jOiBXZWJHTENvbnN0YW50cy5MRVNTLFxuICAgICAgICB9LFxuICAgICAgICBkZXB0aE1hc2s6IHRydWUsXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fcnNPcGFxdWUgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLy8gSWYgT1BBUVVFX0FORF9UUkFOU0xVQ0VOVCBpcyBpbiB1c2UsIG9ubHkgdGhlIG9wYXF1ZSBwYXNzIGdldHMgdGhlIGJlbmVmaXQgb2YgdGhlIGRlcHRoIGJ1ZmZlcixcbiAgICAvLyBub3QgdGhlIHRyYW5zbHVjZW50IHBhc3MuICBPdGhlcndpc2UsIGlmIHRoZSBUUkFOU0xVQ0VOVCBwYXNzIGlzIG9uIGl0cyBvd24sIGl0IHR1cm5zIG9uXG4gICAgLy8gYSBkZXB0aE1hc2sgaW4gbGlldSBvZiBmdWxsIGRlcHRoIHNvcnRpbmcgKGJlY2F1c2UgaXQgaGFzIG9wYXF1ZS1pc2ggZnJhZ21lbnRzIHRoYXQgbG9vayBiYWQgaW4gT0lUKS5cbiAgICAvLyBXaGVuIHRoZSBUUkFOU0xVQ0VOVCBkZXB0aCBtYXNrIGlzIGluIHVzZSwgbGFiZWwgYmFja2dyb3VuZHMgcmVxdWlyZSB0aGUgZGVwdGggZnVuYyB0byBiZSBMRVFVQUwuXG4gICAgdmFyIHVzZVRyYW5zbHVjZW50RGVwdGhNYXNrID0gdGhpcy5fYmxlbmRPcHRpb24gPT09IEJsZW5kT3B0aW9uLlRSQU5TTFVDRU5UO1xuXG4gICAgaWYgKFxuICAgICAgdGhpcy5fYmxlbmRPcHRpb24gPT09IEJsZW5kT3B0aW9uLlRSQU5TTFVDRU5UIHx8XG4gICAgICB0aGlzLl9ibGVuZE9wdGlvbiA9PT0gQmxlbmRPcHRpb24uT1BBUVVFX0FORF9UUkFOU0xVQ0VOVFxuICAgICkge1xuICAgICAgdGhpcy5fcnNUcmFuc2x1Y2VudCA9IFJlbmRlclN0YXRlLmZyb21DYWNoZSh7XG4gICAgICAgIGRlcHRoVGVzdDoge1xuICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgZnVuYzogdXNlVHJhbnNsdWNlbnREZXB0aE1hc2tcbiAgICAgICAgICAgID8gV2ViR0xDb25zdGFudHMuTEVRVUFMXG4gICAgICAgICAgICA6IFdlYkdMQ29uc3RhbnRzLkxFU1MsXG4gICAgICAgIH0sXG4gICAgICAgIGRlcHRoTWFzazogdXNlVHJhbnNsdWNlbnREZXB0aE1hc2ssXG4gICAgICAgIGJsZW5kaW5nOiBCbGVuZGluZ1N0YXRlLkFMUEhBX0JMRU5ELFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3JzVHJhbnNsdWNlbnQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG5cbiAgdGhpcy5fc2hhZGVyRGlzYWJsZURlcHRoRGlzdGFuY2UgPVxuICAgIHRoaXMuX3NoYWRlckRpc2FibGVEZXB0aERpc3RhbmNlIHx8XG4gICAgZnJhbWVTdGF0ZS5taW5pbXVtRGlzYWJsZURlcHRoVGVzdERpc3RhbmNlICE9PSAwLjA7XG5cbiAgdmFyIHZzU291cmNlO1xuICB2YXIgZnNTb3VyY2U7XG4gIHZhciB2cztcbiAgdmFyIGZzO1xuICB2YXIgdmVydERlZmluZXM7XG5cbiAgdmFyIHN1cHBvcnRWU1RleHR1cmVSZWFkcyA9IENvbnRleHRMaW1pdHMubWF4aW11bVZlcnRleFRleHR1cmVJbWFnZVVuaXRzID4gMDtcblxuICBpZiAoXG4gICAgYmxlbmRPcHRpb25DaGFuZ2VkIHx8XG4gICAgdGhpcy5fc2hhZGVyUm90YXRpb24gIT09IHRoaXMuX2NvbXBpbGVkU2hhZGVyUm90YXRpb24gfHxcbiAgICB0aGlzLl9zaGFkZXJBbGlnbmVkQXhpcyAhPT0gdGhpcy5fY29tcGlsZWRTaGFkZXJBbGlnbmVkQXhpcyB8fFxuICAgIHRoaXMuX3NoYWRlclNjYWxlQnlEaXN0YW5jZSAhPT0gdGhpcy5fY29tcGlsZWRTaGFkZXJTY2FsZUJ5RGlzdGFuY2UgfHxcbiAgICB0aGlzLl9zaGFkZXJUcmFuc2x1Y2VuY3lCeURpc3RhbmNlICE9PVxuICAgICAgdGhpcy5fY29tcGlsZWRTaGFkZXJUcmFuc2x1Y2VuY3lCeURpc3RhbmNlIHx8XG4gICAgdGhpcy5fc2hhZGVyUGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2UgIT09XG4gICAgICB0aGlzLl9jb21waWxlZFNoYWRlclBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlIHx8XG4gICAgdGhpcy5fc2hhZGVyRGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uICE9PVxuICAgICAgdGhpcy5fY29tcGlsZWRTaGFkZXJEaXN0YW5jZURpc3BsYXlDb25kaXRpb24gfHxcbiAgICB0aGlzLl9zaGFkZXJEaXNhYmxlRGVwdGhEaXN0YW5jZSAhPT1cbiAgICAgIHRoaXMuX2NvbXBpbGVkU2hhZGVyRGlzYWJsZURlcHRoRGlzdGFuY2UgfHxcbiAgICB0aGlzLl9zaGFkZXJDbGFtcFRvR3JvdW5kICE9PSB0aGlzLl9jb21waWxlZFNoYWRlckNsYW1wVG9Hcm91bmQgfHxcbiAgICB0aGlzLl9zZGYgIT09IHRoaXMuX2NvbXBpbGVkU0RGXG4gICkge1xuICAgIHZzU291cmNlID0gQmlsbGJvYXJkQ29sbGVjdGlvblZTO1xuICAgIGZzU291cmNlID0gQmlsbGJvYXJkQ29sbGVjdGlvbkZTO1xuXG4gICAgdmVydERlZmluZXMgPSBbXTtcbiAgICBpZiAoZGVmaW5lZCh0aGlzLl9iYXRjaFRhYmxlKSkge1xuICAgICAgdmVydERlZmluZXMucHVzaChcIlZFQ1RPUl9USUxFXCIpO1xuICAgICAgdnNTb3VyY2UgPSB0aGlzLl9iYXRjaFRhYmxlLmdldFZlcnRleFNoYWRlckNhbGxiYWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgXCJhX2JhdGNoSWRcIixcbiAgICAgICAgdW5kZWZpbmVkXG4gICAgICApKHZzU291cmNlKTtcbiAgICAgIGZzU291cmNlID0gdGhpcy5fYmF0Y2hUYWJsZS5nZXRGcmFnbWVudFNoYWRlckNhbGxiYWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgdW5kZWZpbmVkXG4gICAgICApKGZzU291cmNlKTtcbiAgICB9XG5cbiAgICB2cyA9IG5ldyBTaGFkZXJTb3VyY2Uoe1xuICAgICAgZGVmaW5lczogdmVydERlZmluZXMsXG4gICAgICBzb3VyY2VzOiBbdnNTb3VyY2VdLFxuICAgIH0pO1xuICAgIGlmICh0aGlzLl9pbnN0YW5jZWQpIHtcbiAgICAgIHZzLmRlZmluZXMucHVzaChcIklOU1RBTkNFRFwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3NoYWRlclJvdGF0aW9uKSB7XG4gICAgICB2cy5kZWZpbmVzLnB1c2goXCJST1RBVElPTlwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3NoYWRlckFsaWduZWRBeGlzKSB7XG4gICAgICB2cy5kZWZpbmVzLnB1c2goXCJBTElHTkVEX0FYSVNcIik7XG4gICAgfVxuICAgIGlmICh0aGlzLl9zaGFkZXJTY2FsZUJ5RGlzdGFuY2UpIHtcbiAgICAgIHZzLmRlZmluZXMucHVzaChcIkVZRV9ESVNUQU5DRV9TQ0FMSU5HXCIpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fc2hhZGVyVHJhbnNsdWNlbmN5QnlEaXN0YW5jZSkge1xuICAgICAgdnMuZGVmaW5lcy5wdXNoKFwiRVlFX0RJU1RBTkNFX1RSQU5TTFVDRU5DWVwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3NoYWRlclBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlKSB7XG4gICAgICB2cy5kZWZpbmVzLnB1c2goXCJFWUVfRElTVEFOQ0VfUElYRUxfT0ZGU0VUXCIpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fc2hhZGVyRGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uKSB7XG4gICAgICB2cy5kZWZpbmVzLnB1c2goXCJESVNUQU5DRV9ESVNQTEFZX0NPTkRJVElPTlwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3NoYWRlckRpc2FibGVEZXB0aERpc3RhbmNlKSB7XG4gICAgICB2cy5kZWZpbmVzLnB1c2goXCJESVNBQkxFX0RFUFRIX0RJU1RBTkNFXCIpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fc2hhZGVyQ2xhbXBUb0dyb3VuZCkge1xuICAgICAgaWYgKHN1cHBvcnRWU1RleHR1cmVSZWFkcykge1xuICAgICAgICB2cy5kZWZpbmVzLnB1c2goXCJWRVJURVhfREVQVEhfQ0hFQ0tcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2cy5kZWZpbmVzLnB1c2goXCJGUkFHTUVOVF9ERVBUSF9DSEVDS1wiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgc2RmRWRnZSA9IDEuMCAtIFNERlNldHRpbmdzLkNVVE9GRjtcblxuICAgIGlmICh0aGlzLl9zZGYpIHtcbiAgICAgIHZzLmRlZmluZXMucHVzaChcIlNERlwiKTtcbiAgICB9XG5cbiAgICB2YXIgdmVjdG9yRnJhZ0RlZmluZSA9IGRlZmluZWQodGhpcy5fYmF0Y2hUYWJsZSkgPyBcIlZFQ1RPUl9USUxFXCIgOiBcIlwiO1xuXG4gICAgaWYgKHRoaXMuX2JsZW5kT3B0aW9uID09PSBCbGVuZE9wdGlvbi5PUEFRVUVfQU5EX1RSQU5TTFVDRU5UKSB7XG4gICAgICBmcyA9IG5ldyBTaGFkZXJTb3VyY2Uoe1xuICAgICAgICBkZWZpbmVzOiBbXCJPUEFRVUVcIiwgdmVjdG9yRnJhZ0RlZmluZV0sXG4gICAgICAgIHNvdXJjZXM6IFtmc1NvdXJjZV0sXG4gICAgICB9KTtcbiAgICAgIGlmICh0aGlzLl9zaGFkZXJDbGFtcFRvR3JvdW5kKSB7XG4gICAgICAgIGlmIChzdXBwb3J0VlNUZXh0dXJlUmVhZHMpIHtcbiAgICAgICAgICBmcy5kZWZpbmVzLnB1c2goXCJWRVJURVhfREVQVEhfQ0hFQ0tcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiRlJBR01FTlRfREVQVEhfQ0hFQ0tcIik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuX3NkZikge1xuICAgICAgICBmcy5kZWZpbmVzLnB1c2goXCJTREZcIik7XG4gICAgICAgIGZzLmRlZmluZXMucHVzaChcIlNERl9FREdFIFwiICsgc2RmRWRnZSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX3NwID0gU2hhZGVyUHJvZ3JhbS5yZXBsYWNlQ2FjaGUoe1xuICAgICAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgICAgICBzaGFkZXJQcm9ncmFtOiB0aGlzLl9zcCxcbiAgICAgICAgdmVydGV4U2hhZGVyU291cmNlOiB2cyxcbiAgICAgICAgZnJhZ21lbnRTaGFkZXJTb3VyY2U6IGZzLFxuICAgICAgICBhdHRyaWJ1dGVMb2NhdGlvbnM6IGF0dHJpYnV0ZUxvY2F0aW9ucyxcbiAgICAgIH0pO1xuXG4gICAgICBmcyA9IG5ldyBTaGFkZXJTb3VyY2Uoe1xuICAgICAgICBkZWZpbmVzOiBbXCJUUkFOU0xVQ0VOVFwiLCB2ZWN0b3JGcmFnRGVmaW5lXSxcbiAgICAgICAgc291cmNlczogW2ZzU291cmNlXSxcbiAgICAgIH0pO1xuICAgICAgaWYgKHRoaXMuX3NoYWRlckNsYW1wVG9Hcm91bmQpIHtcbiAgICAgICAgaWYgKHN1cHBvcnRWU1RleHR1cmVSZWFkcykge1xuICAgICAgICAgIGZzLmRlZmluZXMucHVzaChcIlZFUlRFWF9ERVBUSF9DSEVDS1wiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmcy5kZWZpbmVzLnB1c2goXCJGUkFHTUVOVF9ERVBUSF9DSEVDS1wiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuX3NkZikge1xuICAgICAgICBmcy5kZWZpbmVzLnB1c2goXCJTREZcIik7XG4gICAgICAgIGZzLmRlZmluZXMucHVzaChcIlNERl9FREdFIFwiICsgc2RmRWRnZSk7XG4gICAgICB9XG4gICAgICB0aGlzLl9zcFRyYW5zbHVjZW50ID0gU2hhZGVyUHJvZ3JhbS5yZXBsYWNlQ2FjaGUoe1xuICAgICAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgICAgICBzaGFkZXJQcm9ncmFtOiB0aGlzLl9zcFRyYW5zbHVjZW50LFxuICAgICAgICB2ZXJ0ZXhTaGFkZXJTb3VyY2U6IHZzLFxuICAgICAgICBmcmFnbWVudFNoYWRlclNvdXJjZTogZnMsXG4gICAgICAgIGF0dHJpYnV0ZUxvY2F0aW9uczogYXR0cmlidXRlTG9jYXRpb25zLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX2JsZW5kT3B0aW9uID09PSBCbGVuZE9wdGlvbi5PUEFRVUUpIHtcbiAgICAgIGZzID0gbmV3IFNoYWRlclNvdXJjZSh7XG4gICAgICAgIGRlZmluZXM6IFt2ZWN0b3JGcmFnRGVmaW5lXSxcbiAgICAgICAgc291cmNlczogW2ZzU291cmNlXSxcbiAgICAgIH0pO1xuICAgICAgaWYgKHRoaXMuX3NoYWRlckNsYW1wVG9Hcm91bmQpIHtcbiAgICAgICAgaWYgKHN1cHBvcnRWU1RleHR1cmVSZWFkcykge1xuICAgICAgICAgIGZzLmRlZmluZXMucHVzaChcIlZFUlRFWF9ERVBUSF9DSEVDS1wiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmcy5kZWZpbmVzLnB1c2goXCJGUkFHTUVOVF9ERVBUSF9DSEVDS1wiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuX3NkZikge1xuICAgICAgICBmcy5kZWZpbmVzLnB1c2goXCJTREZcIik7XG4gICAgICAgIGZzLmRlZmluZXMucHVzaChcIlNERl9FREdFIFwiICsgc2RmRWRnZSk7XG4gICAgICB9XG4gICAgICB0aGlzLl9zcCA9IFNoYWRlclByb2dyYW0ucmVwbGFjZUNhY2hlKHtcbiAgICAgICAgY29udGV4dDogY29udGV4dCxcbiAgICAgICAgc2hhZGVyUHJvZ3JhbTogdGhpcy5fc3AsXG4gICAgICAgIHZlcnRleFNoYWRlclNvdXJjZTogdnMsXG4gICAgICAgIGZyYWdtZW50U2hhZGVyU291cmNlOiBmcyxcbiAgICAgICAgYXR0cmlidXRlTG9jYXRpb25zOiBhdHRyaWJ1dGVMb2NhdGlvbnMsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fYmxlbmRPcHRpb24gPT09IEJsZW5kT3B0aW9uLlRSQU5TTFVDRU5UKSB7XG4gICAgICBmcyA9IG5ldyBTaGFkZXJTb3VyY2Uoe1xuICAgICAgICBkZWZpbmVzOiBbdmVjdG9yRnJhZ0RlZmluZV0sXG4gICAgICAgIHNvdXJjZXM6IFtmc1NvdXJjZV0sXG4gICAgICB9KTtcbiAgICAgIGlmICh0aGlzLl9zaGFkZXJDbGFtcFRvR3JvdW5kKSB7XG4gICAgICAgIGlmIChzdXBwb3J0VlNUZXh0dXJlUmVhZHMpIHtcbiAgICAgICAgICBmcy5kZWZpbmVzLnB1c2goXCJWRVJURVhfREVQVEhfQ0hFQ0tcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiRlJBR01FTlRfREVQVEhfQ0hFQ0tcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLl9zZGYpIHtcbiAgICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiU0RGXCIpO1xuICAgICAgICBmcy5kZWZpbmVzLnB1c2goXCJTREZfRURHRSBcIiArIHNkZkVkZ2UpO1xuICAgICAgfVxuICAgICAgdGhpcy5fc3BUcmFuc2x1Y2VudCA9IFNoYWRlclByb2dyYW0ucmVwbGFjZUNhY2hlKHtcbiAgICAgICAgY29udGV4dDogY29udGV4dCxcbiAgICAgICAgc2hhZGVyUHJvZ3JhbTogdGhpcy5fc3BUcmFuc2x1Y2VudCxcbiAgICAgICAgdmVydGV4U2hhZGVyU291cmNlOiB2cyxcbiAgICAgICAgZnJhZ21lbnRTaGFkZXJTb3VyY2U6IGZzLFxuICAgICAgICBhdHRyaWJ1dGVMb2NhdGlvbnM6IGF0dHJpYnV0ZUxvY2F0aW9ucyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuX2NvbXBpbGVkU2hhZGVyUm90YXRpb24gPSB0aGlzLl9zaGFkZXJSb3RhdGlvbjtcbiAgICB0aGlzLl9jb21waWxlZFNoYWRlckFsaWduZWRBeGlzID0gdGhpcy5fc2hhZGVyQWxpZ25lZEF4aXM7XG4gICAgdGhpcy5fY29tcGlsZWRTaGFkZXJTY2FsZUJ5RGlzdGFuY2UgPSB0aGlzLl9zaGFkZXJTY2FsZUJ5RGlzdGFuY2U7XG4gICAgdGhpcy5fY29tcGlsZWRTaGFkZXJUcmFuc2x1Y2VuY3lCeURpc3RhbmNlID0gdGhpcy5fc2hhZGVyVHJhbnNsdWNlbmN5QnlEaXN0YW5jZTtcbiAgICB0aGlzLl9jb21waWxlZFNoYWRlclBpeGVsT2Zmc2V0U2NhbGVCeURpc3RhbmNlID0gdGhpcy5fc2hhZGVyUGl4ZWxPZmZzZXRTY2FsZUJ5RGlzdGFuY2U7XG4gICAgdGhpcy5fY29tcGlsZWRTaGFkZXJEaXN0YW5jZURpc3BsYXlDb25kaXRpb24gPSB0aGlzLl9zaGFkZXJEaXN0YW5jZURpc3BsYXlDb25kaXRpb247XG4gICAgdGhpcy5fY29tcGlsZWRTaGFkZXJEaXNhYmxlRGVwdGhEaXN0YW5jZSA9IHRoaXMuX3NoYWRlckRpc2FibGVEZXB0aERpc3RhbmNlO1xuICAgIHRoaXMuX2NvbXBpbGVkU2hhZGVyQ2xhbXBUb0dyb3VuZCA9IHRoaXMuX3NoYWRlckNsYW1wVG9Hcm91bmQ7XG4gICAgdGhpcy5fY29tcGlsZWRTREYgPSB0aGlzLl9zZGY7XG4gIH1cblxuICB2YXIgY29tbWFuZExpc3QgPSBmcmFtZVN0YXRlLmNvbW1hbmRMaXN0O1xuXG4gIGlmIChwYXNzLnJlbmRlciB8fCBwYXNzLnBpY2spIHtcbiAgICB2YXIgY29sb3JMaXN0ID0gdGhpcy5fY29sb3JDb21tYW5kcztcblxuICAgIHZhciBvcGFxdWUgPSB0aGlzLl9ibGVuZE9wdGlvbiA9PT0gQmxlbmRPcHRpb24uT1BBUVVFO1xuICAgIHZhciBvcGFxdWVBbmRUcmFuc2x1Y2VudCA9XG4gICAgICB0aGlzLl9ibGVuZE9wdGlvbiA9PT0gQmxlbmRPcHRpb24uT1BBUVVFX0FORF9UUkFOU0xVQ0VOVDtcblxuICAgIHZhciB2YSA9IHRoaXMuX3ZhZi52YTtcbiAgICB2YXIgdmFMZW5ndGggPSB2YS5sZW5ndGg7XG5cbiAgICB2YXIgdW5pZm9ybXMgPSB0aGlzLl91bmlmb3JtcztcbiAgICB2YXIgcGlja0lkO1xuICAgIGlmIChkZWZpbmVkKHRoaXMuX2JhdGNoVGFibGUpKSB7XG4gICAgICB1bmlmb3JtcyA9IHRoaXMuX2JhdGNoVGFibGUuZ2V0VW5pZm9ybU1hcENhbGxiYWNrKCkodW5pZm9ybXMpO1xuICAgICAgcGlja0lkID0gdGhpcy5fYmF0Y2hUYWJsZS5nZXRQaWNrSWQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGlja0lkID0gXCJ2X3BpY2tDb2xvclwiO1xuICAgIH1cblxuICAgIGNvbG9yTGlzdC5sZW5ndGggPSB2YUxlbmd0aDtcbiAgICB2YXIgdG90YWxMZW5ndGggPSBvcGFxdWVBbmRUcmFuc2x1Y2VudCA/IHZhTGVuZ3RoICogMiA6IHZhTGVuZ3RoO1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgdG90YWxMZW5ndGg7ICsraikge1xuICAgICAgdmFyIGNvbW1hbmQgPSBjb2xvckxpc3Rbal07XG4gICAgICBpZiAoIWRlZmluZWQoY29tbWFuZCkpIHtcbiAgICAgICAgY29tbWFuZCA9IGNvbG9yTGlzdFtqXSA9IG5ldyBEcmF3Q29tbWFuZCgpO1xuICAgICAgfVxuXG4gICAgICB2YXIgb3BhcXVlQ29tbWFuZCA9IG9wYXF1ZSB8fCAob3BhcXVlQW5kVHJhbnNsdWNlbnQgJiYgaiAlIDIgPT09IDApO1xuXG4gICAgICBjb21tYW5kLnBhc3MgPVxuICAgICAgICBvcGFxdWVDb21tYW5kIHx8ICFvcGFxdWVBbmRUcmFuc2x1Y2VudCA/IFBhc3MuT1BBUVVFIDogUGFzcy5UUkFOU0xVQ0VOVDtcbiAgICAgIGNvbW1hbmQub3duZXIgPSB0aGlzO1xuXG4gICAgICB2YXIgaW5kZXggPSBvcGFxdWVBbmRUcmFuc2x1Y2VudCA/IE1hdGguZmxvb3IoaiAvIDIuMCkgOiBqO1xuICAgICAgY29tbWFuZC5ib3VuZGluZ1ZvbHVtZSA9IGJvdW5kaW5nVm9sdW1lO1xuICAgICAgY29tbWFuZC5tb2RlbE1hdHJpeCA9IG1vZGVsTWF0cml4O1xuICAgICAgY29tbWFuZC5jb3VudCA9IHZhW2luZGV4XS5pbmRpY2VzQ291bnQ7XG4gICAgICBjb21tYW5kLnNoYWRlclByb2dyYW0gPSBvcGFxdWVDb21tYW5kID8gdGhpcy5fc3AgOiB0aGlzLl9zcFRyYW5zbHVjZW50O1xuICAgICAgY29tbWFuZC51bmlmb3JtTWFwID0gdW5pZm9ybXM7XG4gICAgICBjb21tYW5kLnZlcnRleEFycmF5ID0gdmFbaW5kZXhdLnZhO1xuICAgICAgY29tbWFuZC5yZW5kZXJTdGF0ZSA9IG9wYXF1ZUNvbW1hbmRcbiAgICAgICAgPyB0aGlzLl9yc09wYXF1ZVxuICAgICAgICA6IHRoaXMuX3JzVHJhbnNsdWNlbnQ7XG4gICAgICBjb21tYW5kLmRlYnVnU2hvd0JvdW5kaW5nVm9sdW1lID0gdGhpcy5kZWJ1Z1Nob3dCb3VuZGluZ1ZvbHVtZTtcbiAgICAgIGNvbW1hbmQucGlja0lkID0gcGlja0lkO1xuXG4gICAgICBpZiAodGhpcy5faW5zdGFuY2VkKSB7XG4gICAgICAgIGNvbW1hbmQuY291bnQgPSA2O1xuICAgICAgICBjb21tYW5kLmluc3RhbmNlQ291bnQgPSBiaWxsYm9hcmRzTGVuZ3RoO1xuICAgICAgfVxuXG4gICAgICBjb21tYW5kTGlzdC5wdXNoKGNvbW1hbmQpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmRlYnVnU2hvd1RleHR1cmVBdGxhcykge1xuICAgICAgaWYgKCFkZWZpbmVkKHRoaXMuZGVidWdDb21tYW5kKSkge1xuICAgICAgICB0aGlzLmRlYnVnQ29tbWFuZCA9IGNyZWF0ZURlYnVnQ29tbWFuZCh0aGlzLCBmcmFtZVN0YXRlLmNvbnRleHQpO1xuICAgICAgfVxuXG4gICAgICBjb21tYW5kTGlzdC5wdXNoKHRoaXMuZGVidWdDb21tYW5kKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQ7IG90aGVyd2lzZSwgZmFsc2UuXG4gKiA8YnIgLz48YnIgLz5cbiAqIElmIHRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQsIGl0IHNob3VsZCBub3QgYmUgdXNlZDsgY2FsbGluZyBhbnkgZnVuY3Rpb24gb3RoZXIgdGhhblxuICogPGNvZGU+aXNEZXN0cm95ZWQ8L2NvZGU+IHdpbGwgcmVzdWx0IGluIGEge0BsaW5rIERldmVsb3BlckVycm9yfSBleGNlcHRpb24uXG4gKlxuICogQHJldHVybnMge0Jvb2xlYW59IDxjb2RlPnRydWU8L2NvZGU+IGlmIHRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQ7IG90aGVyd2lzZSwgPGNvZGU+ZmFsc2U8L2NvZGU+LlxuICpcbiAqIEBzZWUgQmlsbGJvYXJkQ29sbGVjdGlvbiNkZXN0cm95XG4gKi9cbkJpbGxib2FyZENvbGxlY3Rpb24ucHJvdG90eXBlLmlzRGVzdHJveWVkID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKipcbiAqIERlc3Ryb3lzIHRoZSBXZWJHTCByZXNvdXJjZXMgaGVsZCBieSB0aGlzIG9iamVjdC4gIERlc3Ryb3lpbmcgYW4gb2JqZWN0IGFsbG93cyBmb3IgZGV0ZXJtaW5pc3RpY1xuICogcmVsZWFzZSBvZiBXZWJHTCByZXNvdXJjZXMsIGluc3RlYWQgb2YgcmVseWluZyBvbiB0aGUgZ2FyYmFnZSBjb2xsZWN0b3IgdG8gZGVzdHJveSB0aGlzIG9iamVjdC5cbiAqIDxiciAvPjxiciAvPlxuICogT25jZSBhbiBvYmplY3QgaXMgZGVzdHJveWVkLCBpdCBzaG91bGQgbm90IGJlIHVzZWQ7IGNhbGxpbmcgYW55IGZ1bmN0aW9uIG90aGVyIHRoYW5cbiAqIDxjb2RlPmlzRGVzdHJveWVkPC9jb2RlPiB3aWxsIHJlc3VsdCBpbiBhIHtAbGluayBEZXZlbG9wZXJFcnJvcn0gZXhjZXB0aW9uLiAgVGhlcmVmb3JlLFxuICogYXNzaWduIHRoZSByZXR1cm4gdmFsdWUgKDxjb2RlPnVuZGVmaW5lZDwvY29kZT4pIHRvIHRoZSBvYmplY3QgYXMgZG9uZSBpbiB0aGUgZXhhbXBsZS5cbiAqXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gVGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZCwgaS5lLiwgZGVzdHJveSgpIHdhcyBjYWxsZWQuXG4gKlxuICpcbiAqIEBleGFtcGxlXG4gKiBiaWxsYm9hcmRzID0gYmlsbGJvYXJkcyAmJiBiaWxsYm9hcmRzLmRlc3Ryb3koKTtcbiAqXG4gKiBAc2VlIEJpbGxib2FyZENvbGxlY3Rpb24jaXNEZXN0cm95ZWRcbiAqL1xuQmlsbGJvYXJkQ29sbGVjdGlvbi5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKGRlZmluZWQodGhpcy5fcmVtb3ZlQ2FsbGJhY2tGdW5jKSkge1xuICAgIHRoaXMuX3JlbW92ZUNhbGxiYWNrRnVuYygpO1xuICAgIHRoaXMuX3JlbW92ZUNhbGxiYWNrRnVuYyA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHRoaXMuX3RleHR1cmVBdGxhcyA9XG4gICAgdGhpcy5fZGVzdHJveVRleHR1cmVBdGxhcyAmJlxuICAgIHRoaXMuX3RleHR1cmVBdGxhcyAmJlxuICAgIHRoaXMuX3RleHR1cmVBdGxhcy5kZXN0cm95KCk7XG4gIHRoaXMuX3NwID0gdGhpcy5fc3AgJiYgdGhpcy5fc3AuZGVzdHJveSgpO1xuICB0aGlzLl9zcFRyYW5zbHVjZW50ID0gdGhpcy5fc3BUcmFuc2x1Y2VudCAmJiB0aGlzLl9zcFRyYW5zbHVjZW50LmRlc3Ryb3koKTtcbiAgdGhpcy5fdmFmID0gdGhpcy5fdmFmICYmIHRoaXMuX3ZhZi5kZXN0cm95KCk7XG4gIGRlc3Ryb3lCaWxsYm9hcmRzKHRoaXMuX2JpbGxib2FyZHMpO1xuXG4gIHJldHVybiBkZXN0cm95T2JqZWN0KHRoaXMpO1xufTtcbmV4cG9ydCBkZWZhdWx0IEJpbGxib2FyZENvbGxlY3Rpb247XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///8044\n')}}]);