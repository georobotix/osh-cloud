"use strict";(self["webpackChunkvue3_webpack5"]=self["webpackChunkvue3_webpack5"]||[]).push([[9233],{36033:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(88108);\n/* harmony import */ var _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(48243);\n/* harmony import */ var _Core_BoxGeometry_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(20305);\n/* harmony import */ var _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(60216);\n/* harmony import */ var _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(51688);\n/* harmony import */ var _Core_clone_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(83856);\n/* harmony import */ var _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(59947);\n/* harmony import */ var _Core_ColorGeometryInstanceAttribute_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(92062);\n/* harmony import */ var _Core_createGuid_js__WEBPACK_IMPORTED_MODULE_71__ = __webpack_require__(39960);\n/* harmony import */ var _Core_CullingVolume_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(17711);\n/* harmony import */ var _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(62200);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_70__ = __webpack_require__(82982);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(86511);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(12572);\n/* harmony import */ var _Core_EllipsoidGeometry_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(64727);\n/* harmony import */ var _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(14459);\n/* harmony import */ var _Core_GeographicProjection_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(39756);\n/* harmony import */ var _Core_GeometryInstance_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(26865);\n/* harmony import */ var _Core_GeometryPipeline_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(57552);\n/* harmony import */ var _Core_Intersect_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(84935);\n/* harmony import */ var _Core_JulianDate_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(55293);\n/* harmony import */ var _Core_Math_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(99417);\n/* harmony import */ var _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(72248);\n/* harmony import */ var _Core_mergeSort_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(4197);\n/* harmony import */ var _Core_Occluder_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(52293);\n/* harmony import */ var _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(91473);\n/* harmony import */ var _Core_OrthographicOffCenterFrustum_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(35131);\n/* harmony import */ var _Core_PerspectiveFrustum_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(66854);\n/* harmony import */ var _Core_PerspectiveOffCenterFrustum_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(36135);\n/* harmony import */ var _Core_RequestScheduler_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(63181);\n/* harmony import */ var _Core_TaskProcessor_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(2819);\n/* harmony import */ var _Core_Transforms_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(95555);\n/* harmony import */ var _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(39899);\n/* harmony import */ var _Renderer_ComputeEngine_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(18157);\n/* harmony import */ var _Renderer_Context_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(19385);\n/* harmony import */ var _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(20521);\n/* harmony import */ var _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(8379);\n/* harmony import */ var _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(10667);\n/* harmony import */ var _BrdfLutGenerator_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(24725);\n/* harmony import */ var _Camera_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(70561);\n/* harmony import */ var _Cesium3DTilePass_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(94170);\n/* harmony import */ var _Cesium3DTilePassState_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(55715);\n/* harmony import */ var _CreditDisplay_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(67442);\n/* harmony import */ var _DebugCameraPrimitive_js__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(96548);\n/* harmony import */ var _DepthPlane_js__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(47056);\n/* harmony import */ var _DerivedCommand_js__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(999);\n/* harmony import */ var _DeviceOrientationCameraController_js__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(52440);\n/* harmony import */ var _Fog_js__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(8403);\n/* harmony import */ var _FrameState_js__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(85079);\n/* harmony import */ var _GlobeDepth_js__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(55977);\n/* harmony import */ var _GlobeTranslucencyState_js__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(85985);\n/* harmony import */ var _InvertClassification_js__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(94229);\n/* harmony import */ var _JobScheduler_js__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(38347);\n/* harmony import */ var _MapMode2D_js__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(95757);\n/* harmony import */ var _OctahedralProjectedCubeMap_js__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(22277);\n/* harmony import */ var _PerformanceDisplay_js__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(73829);\n/* harmony import */ var _PerInstanceColorAppearance_js__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(64060);\n/* harmony import */ var _Picking_js__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(18441);\n/* harmony import */ var _PostProcessStageCollection_js__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(13638);\n/* harmony import */ var _Primitive_js__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(34380);\n/* harmony import */ var _PrimitiveCollection_js__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(73316);\n/* harmony import */ var _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(89917);\n/* harmony import */ var _SceneTransforms_js__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(48244);\n/* harmony import */ var _SceneTransitioner_js__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(72984);\n/* harmony import */ var _ScreenSpaceCameraController_js__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(60442);\n/* harmony import */ var _ShadowMap_js__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(79162);\n/* harmony import */ var _StencilConstants_js__WEBPACK_IMPORTED_MODULE_64__ = __webpack_require__(87233);\n/* harmony import */ var _SunLight_js__WEBPACK_IMPORTED_MODULE_65__ = __webpack_require__(44747);\n/* harmony import */ var _SunPostProcess_js__WEBPACK_IMPORTED_MODULE_66__ = __webpack_require__(80480);\n/* harmony import */ var _TweenCollection_js__WEBPACK_IMPORTED_MODULE_67__ = __webpack_require__(74476);\n/* harmony import */ var _View_js__WEBPACK_IMPORTED_MODULE_68__ = __webpack_require__(70419);\n/* harmony import */ var _DebugInspector_js__WEBPACK_IMPORTED_MODULE_69__ = __webpack_require__(55757);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar requestRenderAfterFrame = function (scene) {\n  return function () {\n    scene.frameState.afterRender.push(function () {\n      scene.requestRender();\n    });\n  };\n};\n\n/**\n * The container for all 3D graphical objects and state in a Cesium virtual scene.  Generally,\n * a scene is not created directly; instead, it is implicitly created by {@link CesiumWidget}.\n * <p>\n * <em><code>contextOptions</code> parameter details:</em>\n * </p>\n * <p>\n * The default values are:\n * <code>\n * {\n *   webgl : {\n *     alpha : false,\n *     depth : true,\n *     stencil : false,\n *     antialias : true,\n *     powerPreference: \'high-performance\',\n *     premultipliedAlpha : true,\n *     preserveDrawingBuffer : false,\n *     failIfMajorPerformanceCaveat : false\n *   },\n *   allowTextureFilterAnisotropic : true\n * }\n * </code>\n * </p>\n * <p>\n * The <code>webgl</code> property corresponds to the {@link http://www.khronos.org/registry/webgl/specs/latest/#5.2|WebGLContextAttributes}\n * object used to create the WebGL context.\n * </p>\n * <p>\n * <code>webgl.alpha</code> defaults to false, which can improve performance compared to the standard WebGL default\n * of true.  If an application needs to composite Cesium above other HTML elements using alpha-blending, set\n * <code>webgl.alpha</code> to true.\n * </p>\n * <p>\n * The other <code>webgl</code> properties match the WebGL defaults for {@link http://www.khronos.org/registry/webgl/specs/latest/#5.2|WebGLContextAttributes}.\n * </p>\n * <p>\n * <code>allowTextureFilterAnisotropic</code> defaults to true, which enables anisotropic texture filtering when the\n * WebGL extension is supported.  Setting this to false will improve performance, but hurt visual quality, especially for horizon views.\n * </p>\n *\n * @alias Scene\n * @constructor\n *\n * @param {Object} options Object with the following properties:\n * @param {HTMLCanvasElement} options.canvas The HTML canvas element to create the scene for.\n * @param {Object} [options.contextOptions] Context and WebGL creation properties.  See details above.\n * @param {Element} [options.creditContainer] The HTML element in which the credits will be displayed.\n * @param {Element} [options.creditViewport] The HTML element in which to display the credit popup.  If not specified, the viewport will be a added as a sibling of the canvas.\n * @param {MapProjection} [options.mapProjection=new GeographicProjection()] The map projection to use in 2D and Columbus View modes.\n * @param {Boolean} [options.orderIndependentTranslucency=true] If true and the configuration supports it, use order independent translucency.\n * @param {Boolean} [options.scene3DOnly=false] If true, optimizes memory use and performance for 3D mode but disables the ability to use 2D or Columbus View.\n * @param {Boolean} [options.shadows=false] Determines if shadows are cast by light sources.\n * @param {MapMode2D} [options.mapMode2D=MapMode2D.INFINITE_SCROLL] Determines if the 2D map is rotatable or can be scrolled infinitely in the horizontal direction.\n * @param {Boolean} [options.requestRenderMode=false] If true, rendering a frame will only occur when needed as determined by changes within the scene. Enabling improves performance of the application, but requires using {@link Scene#requestRender} to render a new frame explicitly in this mode. This will be necessary in many cases after making changes to the scene in other parts of the API. See {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}.\n * @param {Number} [options.maximumRenderTimeChange=0.0] If requestRenderMode is true, this value defines the maximum change in simulation time allowed before a render is requested. See {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}.\n *\n * @see CesiumWidget\n * @see {@link http://www.khronos.org/registry/webgl/specs/latest/#5.2|WebGLContextAttributes}\n *\n * @exception {DeveloperError} options and options.canvas are required.\n *\n * @example\n * // Create scene without anisotropic texture filtering\n * var scene = new Cesium.Scene({\n *   canvas : canvas,\n *   contextOptions : {\n *     allowTextureFilterAnisotropic : false\n *   }\n * });\n */\nfunction Scene(options) {\n  options = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(options, _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].EMPTY_OBJECT */ .Z.EMPTY_OBJECT);\n  var canvas = options.canvas;\n  var creditContainer = options.creditContainer;\n  var creditViewport = options.creditViewport;\n\n  var contextOptions = (0,_Core_clone_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(options.contextOptions);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(contextOptions)) {\n    contextOptions = {};\n  }\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(contextOptions.webgl)) {\n    contextOptions.webgl = {};\n  }\n  contextOptions.webgl.powerPreference = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(\n    contextOptions.webgl.powerPreference,\n    "high-performance"\n  );\n\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(canvas)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z("options and options.canvas are required.");\n  }\n  //>>includeEnd(\'debug\');\n  var hasCreditContainer = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(creditContainer);\n  var context = new _Renderer_Context_js__WEBPACK_IMPORTED_MODULE_32__/* ["default"] */ .Z(canvas, contextOptions);\n  if (!hasCreditContainer) {\n    creditContainer = document.createElement("div");\n    creditContainer.style.position = "absolute";\n    creditContainer.style.bottom = "0";\n    creditContainer.style["text-shadow"] = "0 0 2px #000000";\n    creditContainer.style.color = "#ffffff";\n    creditContainer.style["font-size"] = "10px";\n    creditContainer.style["padding-right"] = "5px";\n    canvas.parentNode.appendChild(creditContainer);\n  }\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(creditViewport)) {\n    creditViewport = canvas.parentNode;\n  }\n\n  this._id = (0,_Core_createGuid_js__WEBPACK_IMPORTED_MODULE_71__/* ["default"] */ .Z)();\n  this._jobScheduler = new _JobScheduler_js__WEBPACK_IMPORTED_MODULE_50__/* ["default"] */ .Z();\n  this._frameState = new _FrameState_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"] */ .Z(\n    context,\n    new _CreditDisplay_js__WEBPACK_IMPORTED_MODULE_40__/* ["default"] */ .Z(creditContainer, " • ", creditViewport),\n    this._jobScheduler\n  );\n  this._frameState.scene3DOnly = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(options.scene3DOnly, false);\n  this._removeCreditContainer = !hasCreditContainer;\n  this._creditContainer = creditContainer;\n\n  this._canvas = canvas;\n  this._context = context;\n  this._computeEngine = new _Renderer_ComputeEngine_js__WEBPACK_IMPORTED_MODULE_31__/* ["default"] */ .Z(context);\n  this._globe = undefined;\n  this._globeTranslucencyState = new _GlobeTranslucencyState_js__WEBPACK_IMPORTED_MODULE_48__/* ["default"] */ .Z();\n  this._primitives = new _PrimitiveCollection_js__WEBPACK_IMPORTED_MODULE_58__/* ["default"] */ .Z();\n  this._groundPrimitives = new _PrimitiveCollection_js__WEBPACK_IMPORTED_MODULE_58__/* ["default"] */ .Z();\n\n  this._globeHeight = undefined;\n  this._cameraUnderground = false;\n\n  this._logDepthBuffer = context.fragmentDepth;\n  this._logDepthBufferDirty = true;\n\n  this._tweens = new _TweenCollection_js__WEBPACK_IMPORTED_MODULE_67__/* ["default"] */ .Z();\n\n  this._shaderFrameCount = 0;\n\n  this._sunPostProcess = undefined;\n\n  this._computeCommandList = [];\n  this._overlayCommandList = [];\n\n  this._useOIT = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(options.orderIndependentTranslucency, true);\n  this._executeOITFunction = undefined;\n\n  this._depthPlane = new _DepthPlane_js__WEBPACK_IMPORTED_MODULE_42__/* ["default"] */ .Z();\n\n  this._clearColorCommand = new _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_30__/* ["default"] */ .Z({\n    color: new _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z(),\n    stencil: 0,\n    owner: this,\n  });\n  this._depthClearCommand = new _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_30__/* ["default"] */ .Z({\n    depth: 1.0,\n    owner: this,\n  });\n  this._stencilClearCommand = new _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_30__/* ["default"] */ .Z({\n    stencil: 0,\n  });\n  this._classificationStencilClearCommand = new _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_30__/* ["default"] */ .Z({\n    stencil: 0,\n    renderState: _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_35__/* ["default"].fromCache */ .Z.fromCache({\n      stencilMask: _StencilConstants_js__WEBPACK_IMPORTED_MODULE_64__/* ["default"].CLASSIFICATION_MASK */ .Z.CLASSIFICATION_MASK,\n    }),\n  });\n\n  this._depthOnlyRenderStateCache = {};\n\n  this._transitioner = new _SceneTransitioner_js__WEBPACK_IMPORTED_MODULE_61__/* ["default"] */ .Z(this);\n\n  this._preUpdate = new _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\n  this._postUpdate = new _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\n\n  this._renderError = new _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\n  this._preRender = new _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\n  this._postRender = new _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\n\n  this._minimumDisableDepthTestDistance = 0.0;\n  this._debugInspector = new _DebugInspector_js__WEBPACK_IMPORTED_MODULE_69__/* ["default"] */ .Z();\n\n  /**\n   * Exceptions occurring in <code>render</code> are always caught in order to raise the\n   * <code>renderError</code> event.  If this property is true, the error is rethrown\n   * after the event is raised.  If this property is false, the <code>render</code> function\n   * returns normally after raising the event.\n   *\n   * @type {Boolean}\n   * @default false\n   */\n  this.rethrowRenderErrors = false;\n\n  /**\n   * Determines whether or not to instantly complete the\n   * scene transition animation on user input.\n   *\n   * @type {Boolean}\n   * @default true\n   */\n  this.completeMorphOnUserInput = true;\n\n  /**\n   * The event fired at the beginning of a scene transition.\n   * @type {Event}\n   * @default Event()\n   */\n  this.morphStart = new _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\n\n  /**\n   * The event fired at the completion of a scene transition.\n   * @type {Event}\n   * @default Event()\n   */\n  this.morphComplete = new _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\n\n  /**\n   * The {@link SkyBox} used to draw the stars.\n   *\n   * @type {SkyBox}\n   * @default undefined\n   *\n   * @see Scene#backgroundColor\n   */\n  this.skyBox = undefined;\n\n  /**\n   * The sky atmosphere drawn around the globe.\n   *\n   * @type {SkyAtmosphere}\n   * @default undefined\n   */\n  this.skyAtmosphere = undefined;\n\n  /**\n   * The {@link Sun}.\n   *\n   * @type {Sun}\n   * @default undefined\n   */\n  this.sun = undefined;\n\n  /**\n   * Uses a bloom filter on the sun when enabled.\n   *\n   * @type {Boolean}\n   * @default true\n   */\n  this.sunBloom = true;\n  this._sunBloom = undefined;\n\n  /**\n   * The {@link Moon}\n   *\n   * @type Moon\n   * @default undefined\n   */\n  this.moon = undefined;\n\n  /**\n   * The background color, which is only visible if there is no sky box, i.e., {@link Scene#skyBox} is undefined.\n   *\n   * @type {Color}\n   * @default {@link Color.BLACK}\n   *\n   * @see Scene#skyBox\n   */\n  this.backgroundColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].clone */ .Z.clone(_Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].BLACK */ .Z.BLACK);\n\n  this._mode = _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE3D */ .Z.SCENE3D;\n\n  this._mapProjection = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(options.mapProjection)\n    ? options.mapProjection\n    : new _Core_GeographicProjection_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"] */ .Z();\n\n  /**\n   * The current morph transition time between 2D/Columbus View and 3D,\n   * with 0.0 being 2D or Columbus View and 1.0 being 3D.\n   *\n   * @type {Number}\n   * @default 1.0\n   */\n  this.morphTime = 1.0;\n\n  /**\n   * The far-to-near ratio of the multi-frustum when using a normal depth buffer.\n   * <p>\n   * This value is used to create the near and far values for each frustum of the multi-frustum. It is only used\n   * when {@link Scene#logarithmicDepthBuffer} is <code>false</code>. When <code>logarithmicDepthBuffer</code> is\n   * <code>true</code>, use {@link Scene#logarithmicDepthFarToNearRatio}.\n   * </p>\n   *\n   * @type {Number}\n   * @default 1000.0\n   */\n  this.farToNearRatio = 1000.0;\n\n  /**\n   * The far-to-near ratio of the multi-frustum when using a logarithmic depth buffer.\n   * <p>\n   * This value is used to create the near and far values for each frustum of the multi-frustum. It is only used\n   * when {@link Scene#logarithmicDepthBuffer} is <code>true</code>. When <code>logarithmicDepthBuffer</code> is\n   * <code>false</code>, use {@link Scene#farToNearRatio}.\n   * </p>\n   *\n   * @type {Number}\n   * @default 1e9\n   */\n  this.logarithmicDepthFarToNearRatio = 1e9;\n\n  /**\n   * Determines the uniform depth size in meters of each frustum of the multifrustum in 2D. If a primitive or model close\n   * to the surface shows z-fighting, decreasing this will eliminate the artifact, but decrease performance. On the\n   * other hand, increasing this will increase performance but may cause z-fighting among primitives close to the surface.\n   *\n   * @type {Number}\n   * @default 1.75e6\n   */\n  this.nearToFarDistance2D = 1.75e6;\n\n  /**\n   * This property is for debugging only; it is not for production use.\n   * <p>\n   * A function that determines what commands are executed.  As shown in the examples below,\n   * the function receives the command\'s <code>owner</code> as an argument, and returns a boolean indicating if the\n   * command should be executed.\n   * </p>\n   * <p>\n   * The default is <code>undefined</code>, indicating that all commands are executed.\n   * </p>\n   *\n   * @type Function\n   *\n   * @default undefined\n   *\n   * @example\n   * // Do not execute any commands.\n   * scene.debugCommandFilter = function(command) {\n   *     return false;\n   * };\n   *\n   * // Execute only the billboard\'s commands.  That is, only draw the billboard.\n   * var billboards = new Cesium.BillboardCollection();\n   * scene.debugCommandFilter = function(command) {\n   *     return command.owner === billboards;\n   * };\n   */\n  this.debugCommandFilter = undefined;\n\n  /**\n   * This property is for debugging only; it is not for production use.\n   * <p>\n   * When <code>true</code>, commands are randomly shaded.  This is useful\n   * for performance analysis to see what parts of a scene or model are\n   * command-dense and could benefit from batching.\n   * </p>\n   *\n   * @type Boolean\n   *\n   * @default false\n   */\n  this.debugShowCommands = false;\n\n  /**\n   * This property is for debugging only; it is not for production use.\n   * <p>\n   * When <code>true</code>, commands are shaded based on the frustums they\n   * overlap.  Commands in the closest frustum are tinted red, commands in\n   * the next closest are green, and commands in the farthest frustum are\n   * blue.  If a command overlaps more than one frustum, the color components\n   * are combined, e.g., a command overlapping the first two frustums is tinted\n   * yellow.\n   * </p>\n   *\n   * @type Boolean\n   *\n   * @default false\n   */\n  this.debugShowFrustums = false;\n\n  /**\n   * This property is for debugging only; it is not for production use.\n   * <p>\n   * Displays frames per second and time between frames.\n   * </p>\n   *\n   * @type Boolean\n   *\n   * @default false\n   */\n  this.debugShowFramesPerSecond = false;\n\n  /**\n   * This property is for debugging only; it is not for production use.\n   * <p>\n   * Displays depth information for the indicated frustum.\n   * </p>\n   *\n   * @type Boolean\n   *\n   * @default false\n   */\n  this.debugShowGlobeDepth = false;\n\n  /**\n   * This property is for debugging only; it is not for production use.\n   * <p>\n   * Indicates which frustum will have depth information displayed.\n   * </p>\n   *\n   * @type Number\n   *\n   * @default 1\n   */\n  this.debugShowDepthFrustum = 1;\n\n  /**\n   * This property is for debugging only; it is not for production use.\n   * <p>\n   * When <code>true</code>, draws outlines to show the boundaries of the camera frustums\n   * </p>\n   *\n   * @type Boolean\n   *\n   * @default false\n   */\n  this.debugShowFrustumPlanes = false;\n  this._debugShowFrustumPlanes = false;\n  this._debugFrustumPlanes = undefined;\n\n  /**\n   * When <code>true</code>, enables picking using the depth buffer.\n   *\n   * @type Boolean\n   * @default true\n   */\n  this.useDepthPicking = true;\n\n  /**\n   * When <code>true</code>, enables picking translucent geometry using the depth buffer. Note that {@link Scene#useDepthPicking} must also be true for enabling this to work.\n   *\n   * <p>\n   * Render must be called between picks.\n   * <br>There is a decrease in performance when enabled. There are extra draw calls to write depth for\n   * translucent geometry.\n   * </p>\n   *\n   * @example\n   * // picking the position of a translucent primitive\n   * viewer.screenSpaceEventHandler.setInputAction(function onLeftClick(movement) {\n   *      var pickedFeature = viewer.scene.pick(movement.position);\n   *      if (!Cesium.defined(pickedFeature)) {\n   *          // nothing picked\n   *          return;\n   *      }\n   *      viewer.scene.render();\n   *      var worldPosition = viewer.scene.pickPosition(movement.position);\n   * }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\n   *\n   * @type {Boolean}\n   * @default false\n   */\n  this.pickTranslucentDepth = false;\n\n  /**\n   * The time in milliseconds to wait before checking if the camera has not moved and fire the cameraMoveEnd event.\n   * @type {Number}\n   * @default 500.0\n   * @private\n   */\n  this.cameraEventWaitTime = 500.0;\n\n  /**\n   * Blends the atmosphere to geometry far from the camera for horizon views. Allows for additional\n   * performance improvements by rendering less geometry and dispatching less terrain requests.\n   * @type {Fog}\n   */\n  this.fog = new _Fog_js__WEBPACK_IMPORTED_MODULE_45__/* ["default"] */ .Z();\n\n  this._shadowMapCamera = new _Camera_js__WEBPACK_IMPORTED_MODULE_37__/* ["default"] */ .Z(this);\n\n  /**\n   * The shadow map for the scene\'s light source. When enabled, models, primitives, and the globe may cast and receive shadows.\n   * @type {ShadowMap}\n   */\n  this.shadowMap = new _ShadowMap_js__WEBPACK_IMPORTED_MODULE_63__/* ["default"] */ .Z({\n    context: context,\n    lightCamera: this._shadowMapCamera,\n    enabled: (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(options.shadows, false),\n  });\n\n  /**\n   * When <code>false</code>, 3D Tiles will render normally. When <code>true</code>, classified 3D Tile geometry will render normally and\n   * unclassified 3D Tile geometry will render with the color multiplied by {@link Scene#invertClassificationColor}.\n   * @type {Boolean}\n   * @default false\n   */\n  this.invertClassification = false;\n\n  /**\n   * The highlight color of unclassified 3D Tile geometry when {@link Scene#invertClassification} is <code>true</code>.\n   * <p>When the color\'s alpha is less than 1.0, the unclassified portions of the 3D Tiles will not blend correctly with the classified positions of the 3D Tiles.</p>\n   * <p>Also, when the color\'s alpha is less than 1.0, the WEBGL_depth_texture and EXT_frag_depth WebGL extensions must be supported.</p>\n   * @type {Color}\n   * @default Color.WHITE\n   */\n  this.invertClassificationColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].clone */ .Z.clone(_Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].WHITE */ .Z.WHITE);\n\n  this._actualInvertClassificationColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].clone */ .Z.clone(\n    this._invertClassificationColor\n  );\n  this._invertClassification = new _InvertClassification_js__WEBPACK_IMPORTED_MODULE_49__/* ["default"] */ .Z();\n\n  /**\n   * The focal length for use when with cardboard or WebVR.\n   * @type {Number}\n   */\n  this.focalLength = undefined;\n\n  /**\n   * The eye separation distance in meters for use with cardboard or WebVR.\n   * @type {Number}\n   */\n  this.eyeSeparation = undefined;\n\n  /**\n   * Post processing effects applied to the final render.\n   * @type {PostProcessStageCollection}\n   */\n  this.postProcessStages = new _PostProcessStageCollection_js__WEBPACK_IMPORTED_MODULE_56__/* ["default"] */ .Z();\n\n  this._brdfLutGenerator = new _BrdfLutGenerator_js__WEBPACK_IMPORTED_MODULE_36__/* ["default"] */ .Z();\n\n  this._performanceDisplay = undefined;\n  this._debugVolume = undefined;\n\n  this._screenSpaceCameraController = new _ScreenSpaceCameraController_js__WEBPACK_IMPORTED_MODULE_62__/* ["default"] */ .Z(this);\n  this._cameraUnderground = false;\n  this._mapMode2D = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(options.mapMode2D, _MapMode2D_js__WEBPACK_IMPORTED_MODULE_51__/* ["default"].INFINITE_SCROLL */ .Z.INFINITE_SCROLL);\n\n  // Keeps track of the state of a frame. FrameState is the state across\n  // the primitives of the scene. This state is for internally keeping track\n  // of celestial and environment effects that need to be updated/rendered in\n  // a certain order as well as updating/tracking framebuffer usage.\n  this._environmentState = {\n    skyBoxCommand: undefined,\n    skyAtmosphereCommand: undefined,\n    sunDrawCommand: undefined,\n    sunComputeCommand: undefined,\n    moonCommand: undefined,\n\n    isSunVisible: false,\n    isMoonVisible: false,\n    isReadyForAtmosphere: false,\n    isSkyAtmosphereVisible: false,\n\n    clearGlobeDepth: false,\n    useDepthPlane: false,\n    renderTranslucentDepthForPick: false,\n\n    originalFramebuffer: undefined,\n    useGlobeDepthFramebuffer: false,\n    separatePrimitiveFramebuffer: false,\n    useOIT: false,\n    useInvertClassification: false,\n    usePostProcess: false,\n    usePostProcessSelected: false,\n    useWebVR: false,\n  };\n\n  this._useWebVR = false;\n  this._cameraVR = undefined;\n  this._aspectRatioVR = undefined;\n\n  /**\n   * When <code>true</code>, rendering a frame will only occur when needed as determined by changes within the scene.\n   * Enabling improves performance of the application, but requires using {@link Scene#requestRender}\n   * to render a new frame explicitly in this mode. This will be necessary in many cases after making changes\n   * to the scene in other parts of the API.\n   *\n   * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n   * @see Scene#maximumRenderTimeChange\n   * @see Scene#requestRender\n   *\n   * @type {Boolean}\n   * @default false\n   */\n  this.requestRenderMode = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(options.requestRenderMode, false);\n  this._renderRequested = true;\n\n  /**\n   * If {@link Scene#requestRenderMode} is <code>true</code>, this value defines the maximum change in\n   * simulation time allowed before a render is requested. Lower values increase the number of frames rendered\n   * and higher values decrease the number of frames rendered. If <code>undefined</code>, changes to\n   * the simulation time will never request a render.\n   * This value impacts the rate of rendering for changes in the scene like lighting, entity property updates,\n   * and animations.\n   *\n   * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n   * @see Scene#requestRenderMode\n   *\n   * @type {Number}\n   * @default 0.0\n   */\n  this.maximumRenderTimeChange = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(\n    options.maximumRenderTimeChange,\n    0.0\n  );\n  this._lastRenderTime = undefined;\n  this._frameRateMonitor = undefined;\n\n  this._removeRequestListenerCallback = _Core_RequestScheduler_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"].requestCompletedEvent.addEventListener */ .Z.requestCompletedEvent.addEventListener(\n    requestRenderAfterFrame(this)\n  );\n  this._removeTaskProcessorListenerCallback = _Core_TaskProcessor_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].taskCompletedEvent.addEventListener */ .Z.taskCompletedEvent.addEventListener(\n    requestRenderAfterFrame(this)\n  );\n  this._removeGlobeCallbacks = [];\n\n  var viewport = new _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z(\n    0,\n    0,\n    context.drawingBufferWidth,\n    context.drawingBufferHeight\n  );\n  var camera = new _Camera_js__WEBPACK_IMPORTED_MODULE_37__/* ["default"] */ .Z(this);\n\n  if (this._logDepthBuffer) {\n    camera.frustum.near = 0.1;\n    camera.frustum.far = 10000000000.0;\n  }\n\n  /**\n   * The camera view for the scene camera flight destination. Used for preloading flight destination tiles.\n   * @type {Camera}\n   * @private\n   */\n  this.preloadFlightCamera = new _Camera_js__WEBPACK_IMPORTED_MODULE_37__/* ["default"] */ .Z(this);\n\n  /**\n   * The culling volume for the scene camera flight destination. Used for preloading flight destination tiles.\n   * @type {CullingVolume}\n   * @private\n   */\n  this.preloadFlightCullingVolume = undefined;\n\n  this._picking = new _Picking_js__WEBPACK_IMPORTED_MODULE_55__/* ["default"] */ .Z(this);\n  this._defaultView = new _View_js__WEBPACK_IMPORTED_MODULE_68__/* ["default"] */ .Z(this, camera, viewport);\n  this._view = this._defaultView;\n\n  this._hdr = undefined;\n  this._hdrDirty = undefined;\n  this.highDynamicRange = false;\n  this.gamma = 2.2;\n\n  /**\n   * The spherical harmonic coefficients for image-based lighting of PBR models.\n   * @type {Cartesian3[]}\n   */\n  this.sphericalHarmonicCoefficients = undefined;\n\n  /**\n   * The url to the KTX2 file containing the specular environment map and convoluted mipmaps for image-based lighting of PBR models.\n   * @type {String}\n   */\n  this.specularEnvironmentMaps = undefined;\n  this._specularEnvironmentMapAtlas = undefined;\n\n  /**\n   * The light source for shading. Defaults to a directional light from the Sun.\n   * @type {Light}\n   */\n  this.light = new _SunLight_js__WEBPACK_IMPORTED_MODULE_65__/* ["default"] */ .Z();\n\n  // Give frameState, camera, and screen space camera controller initial state before rendering\n  updateFrameNumber(this, 0.0, _Core_JulianDate_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].now */ .Z.now());\n  this.updateFrameState();\n  this.initializeFrame();\n}\n\nfunction updateGlobeListeners(scene, globe) {\n  for (var i = 0; i < scene._removeGlobeCallbacks.length; ++i) {\n    scene._removeGlobeCallbacks[i]();\n  }\n  scene._removeGlobeCallbacks.length = 0;\n\n  var removeGlobeCallbacks = [];\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globe)) {\n    removeGlobeCallbacks.push(\n      globe.imageryLayersUpdatedEvent.addEventListener(\n        requestRenderAfterFrame(scene)\n      )\n    );\n    removeGlobeCallbacks.push(\n      globe.terrainProviderChanged.addEventListener(\n        requestRenderAfterFrame(scene)\n      )\n    );\n  }\n  scene._removeGlobeCallbacks = removeGlobeCallbacks;\n}\n\nObject.defineProperties(Scene.prototype, {\n  /**\n   * Gets the canvas element to which this scene is bound.\n   * @memberof Scene.prototype\n   *\n   * @type {HTMLCanvasElement}\n   * @readonly\n   */\n  canvas: {\n    get: function () {\n      return this._canvas;\n    },\n  },\n\n  /**\n   * The drawingBufferHeight of the underlying GL context.\n   * @memberof Scene.prototype\n   *\n   * @type {Number}\n   * @readonly\n   *\n   * @see {@link https://www.khronos.org/registry/webgl/specs/1.0/#DOM-WebGLRenderingContext-drawingBufferHeight|drawingBufferHeight}\n   */\n  drawingBufferHeight: {\n    get: function () {\n      return this._context.drawingBufferHeight;\n    },\n  },\n\n  /**\n   * The drawingBufferHeight of the underlying GL context.\n   * @memberof Scene.prototype\n   *\n   * @type {Number}\n   * @readonly\n   *\n   * @see {@link https://www.khronos.org/registry/webgl/specs/1.0/#DOM-WebGLRenderingContext-drawingBufferHeight|drawingBufferHeight}\n   */\n  drawingBufferWidth: {\n    get: function () {\n      return this._context.drawingBufferWidth;\n    },\n  },\n\n  /**\n   * The maximum aliased line width, in pixels, supported by this WebGL implementation.  It will be at least one.\n   * @memberof Scene.prototype\n   *\n   * @type {Number}\n   * @readonly\n   *\n   * @see {@link https://www.khronos.org/opengles/sdk/docs/man/xhtml/glGet.xml|glGet} with <code>ALIASED_LINE_WIDTH_RANGE</code>.\n   */\n  maximumAliasedLineWidth: {\n    get: function () {\n      return _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"].maximumAliasedLineWidth */ .Z.maximumAliasedLineWidth;\n    },\n  },\n\n  /**\n   * The maximum length in pixels of one edge of a cube map, supported by this WebGL implementation.  It will be at least 16.\n   * @memberof Scene.prototype\n   *\n   * @type {Number}\n   * @readonly\n   *\n   * @see {@link https://www.khronos.org/opengles/sdk/docs/man/xhtml/glGet.xml|glGet} with <code>GL_MAX_CUBE_MAP_TEXTURE_SIZE</code>.\n   */\n  maximumCubeMapSize: {\n    get: function () {\n      return _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"].maximumCubeMapSize */ .Z.maximumCubeMapSize;\n    },\n  },\n\n  /**\n   * Returns <code>true</code> if the {@link Scene#pickPosition} function is supported.\n   * @memberof Scene.prototype\n   *\n   * @type {Boolean}\n   * @readonly\n   *\n   * @see Scene#pickPosition\n   */\n  pickPositionSupported: {\n    get: function () {\n      return this._context.depthTexture;\n    },\n  },\n\n  /**\n   * Returns <code>true</code> if the {@link Scene#sampleHeight} and {@link Scene#sampleHeightMostDetailed} functions are supported.\n   * @memberof Scene.prototype\n   *\n   * @type {Boolean}\n   * @readonly\n   *\n   * @see Scene#sampleHeight\n   * @see Scene#sampleHeightMostDetailed\n   */\n  sampleHeightSupported: {\n    get: function () {\n      return this._context.depthTexture;\n    },\n  },\n\n  /**\n   * Returns <code>true</code> if the {@link Scene#clampToHeight} and {@link Scene#clampToHeightMostDetailed} functions are supported.\n   * @memberof Scene.prototype\n   *\n   * @type {Boolean}\n   * @readonly\n   *\n   * @see Scene#clampToHeight\n   * @see Scene#clampToHeightMostDetailed\n   */\n  clampToHeightSupported: {\n    get: function () {\n      return this._context.depthTexture;\n    },\n  },\n\n  /**\n   * Returns <code>true</code> if the {@link Scene#invertClassification} is supported.\n   * @memberof Scene.prototype\n   *\n   * @type {Boolean}\n   * @readonly\n   *\n   * @see Scene#invertClassification\n   */\n  invertClassificationSupported: {\n    get: function () {\n      return this._context.depthTexture;\n    },\n  },\n\n  /**\n   * Returns <code>true</code> if specular environment maps are supported.\n   * @memberof Scene.prototype\n   *\n   * @type {Boolean}\n   * @readonly\n   *\n   * @see Scene#specularEnvironmentMaps\n   */\n  specularEnvironmentMapsSupported: {\n    get: function () {\n      return _OctahedralProjectedCubeMap_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"].isSupported */ .Z.isSupported(this._context);\n    },\n  },\n\n  /**\n   * Gets or sets the depth-test ellipsoid.\n   * @memberof Scene.prototype\n   *\n   * @type {Globe}\n   */\n  globe: {\n    get: function () {\n      return this._globe;\n    },\n\n    set: function (globe) {\n      this._globe = this._globe && this._globe.destroy();\n      this._globe = globe;\n\n      updateGlobeListeners(this, globe);\n    },\n  },\n\n  /**\n   * Gets the collection of primitives.\n   * @memberof Scene.prototype\n   *\n   * @type {PrimitiveCollection}\n   * @readonly\n   */\n  primitives: {\n    get: function () {\n      return this._primitives;\n    },\n  },\n\n  /**\n   * Gets the collection of ground primitives.\n   * @memberof Scene.prototype\n   *\n   * @type {PrimitiveCollection}\n   * @readonly\n   */\n  groundPrimitives: {\n    get: function () {\n      return this._groundPrimitives;\n    },\n  },\n\n  /**\n   * Gets or sets the camera.\n   * @memberof Scene.prototype\n   *\n   * @type {Camera}\n   * @readonly\n   */\n  camera: {\n    get: function () {\n      return this._view.camera;\n    },\n    set: function (camera) {\n      // For internal use only. Documentation is still @readonly.\n      this._view.camera = camera;\n    },\n  },\n\n  /**\n   * Gets or sets the view.\n   * @memberof Scene.prototype\n   *\n   * @type {View}\n   * @readonly\n   *\n   * @private\n   */\n  view: {\n    get: function () {\n      return this._view;\n    },\n    set: function (view) {\n      // For internal use only. Documentation is still @readonly.\n      this._view = view;\n    },\n  },\n\n  /**\n   * Gets the default view.\n   * @memberof Scene.prototype\n   *\n   * @type {View}\n   * @readonly\n   *\n   * @private\n   */\n  defaultView: {\n    get: function () {\n      return this._defaultView;\n    },\n  },\n\n  /**\n   * Gets picking functions and state\n   * @memberof Scene.prototype\n   *\n   * @type {Picking}\n   * @readonly\n   *\n   * @private\n   */\n  picking: {\n    get: function () {\n      return this._picking;\n    },\n  },\n\n  /**\n   * Gets the controller for camera input handling.\n   * @memberof Scene.prototype\n   *\n   * @type {ScreenSpaceCameraController}\n   * @readonly\n   */\n  screenSpaceCameraController: {\n    get: function () {\n      return this._screenSpaceCameraController;\n    },\n  },\n\n  /**\n   * Get the map projection to use in 2D and Columbus View modes.\n   * @memberof Scene.prototype\n   *\n   * @type {MapProjection}\n   * @readonly\n   *\n   * @default new GeographicProjection()\n   */\n  mapProjection: {\n    get: function () {\n      return this._mapProjection;\n    },\n  },\n\n  /**\n   * Gets the job scheduler\n   * @memberof Scene.prototype\n   * @type {JobScheduler}\n   * @readonly\n   *\n   * @private\n   */\n  jobScheduler: {\n    get: function () {\n      return this._jobScheduler;\n    },\n  },\n\n  /**\n   * Gets state information about the current scene. If called outside of a primitive\'s <code>update</code>\n   * function, the previous frame\'s state is returned.\n   * @memberof Scene.prototype\n   *\n   * @type {FrameState}\n   * @readonly\n   *\n   * @private\n   */\n  frameState: {\n    get: function () {\n      return this._frameState;\n    },\n  },\n\n  /**\n   * Gets the environment state.\n   * @memberof Scene.prototype\n   *\n   * @type {EnvironmentState}\n   * @readonly\n   *\n   * @private\n   */\n  environmentState: {\n    get: function () {\n      return this._environmentState;\n    },\n  },\n\n  /**\n   * Gets the collection of tweens taking place in the scene.\n   * @memberof Scene.prototype\n   *\n   * @type {TweenCollection}\n   * @readonly\n   *\n   * @private\n   */\n  tweens: {\n    get: function () {\n      return this._tweens;\n    },\n  },\n\n  /**\n   * Gets the collection of image layers that will be rendered on the globe.\n   * @memberof Scene.prototype\n   *\n   * @type {ImageryLayerCollection}\n   * @readonly\n   */\n  imageryLayers: {\n    get: function () {\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this.globe)) {\n        return undefined;\n      }\n\n      return this.globe.imageryLayers;\n    },\n  },\n\n  /**\n   * The terrain provider providing surface geometry for the globe.\n   * @memberof Scene.prototype\n   *\n   * @type {TerrainProvider}\n   */\n  terrainProvider: {\n    get: function () {\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this.globe)) {\n        return undefined;\n      }\n\n      return this.globe.terrainProvider;\n    },\n    set: function (terrainProvider) {\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this.globe)) {\n        this.globe.terrainProvider = terrainProvider;\n      }\n    },\n  },\n\n  /**\n   * Gets an event that\'s raised when the terrain provider is changed\n   * @memberof Scene.prototype\n   *\n   * @type {Event}\n   * @readonly\n   */\n  terrainProviderChanged: {\n    get: function () {\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this.globe)) {\n        return undefined;\n      }\n\n      return this.globe.terrainProviderChanged;\n    },\n  },\n\n  /**\n   * Gets the event that will be raised before the scene is updated or rendered.  Subscribers to the event\n   * receive the Scene instance as the first parameter and the current time as the second parameter.\n   * @memberof Scene.prototype\n   *\n   * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n   * @see Scene#postUpdate\n   * @see Scene#preRender\n   * @see Scene#postRender\n   *\n   * @type {Event}\n   * @readonly\n   */\n  preUpdate: {\n    get: function () {\n      return this._preUpdate;\n    },\n  },\n\n  /**\n   * Gets the event that will be raised immediately after the scene is updated and before the scene is rendered.\n   * Subscribers to the event receive the Scene instance as the first parameter and the current time as the second\n   * parameter.\n   * @memberof Scene.prototype\n   *\n   * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n   * @see Scene#preUpdate\n   * @see Scene#preRender\n   * @see Scene#postRender\n   *\n   * @type {Event}\n   * @readonly\n   */\n  postUpdate: {\n    get: function () {\n      return this._postUpdate;\n    },\n  },\n\n  /**\n   * Gets the event that will be raised when an error is thrown inside the <code>render</code> function.\n   * The Scene instance and the thrown error are the only two parameters passed to the event handler.\n   * By default, errors are not rethrown after this event is raised, but that can be changed by setting\n   * the <code>rethrowRenderErrors</code> property.\n   * @memberof Scene.prototype\n   *\n   * @type {Event}\n   * @readonly\n   */\n  renderError: {\n    get: function () {\n      return this._renderError;\n    },\n  },\n\n  /**\n   * Gets the event that will be raised after the scene is updated and immediately before the scene is rendered.\n   * Subscribers to the event receive the Scene instance as the first parameter and the current time as the second\n   * parameter.\n   * @memberof Scene.prototype\n   *\n   * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n   * @see Scene#preUpdate\n   * @see Scene#postUpdate\n   * @see Scene#postRender\n   *\n   * @type {Event}\n   * @readonly\n   */\n  preRender: {\n    get: function () {\n      return this._preRender;\n    },\n  },\n\n  /**\n   * Gets the event that will be raised immediately after the scene is rendered.  Subscribers to the event\n   * receive the Scene instance as the first parameter and the current time as the second parameter.\n   * @memberof Scene.prototype\n   *\n   * @see {@link https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/|Improving Performance with Explicit Rendering}\n   * @see Scene#preUpdate\n   * @see Scene#postUpdate\n   * @see Scene#postRender\n   *\n   * @type {Event}\n   * @readonly\n   */\n  postRender: {\n    get: function () {\n      return this._postRender;\n    },\n  },\n\n  /**\n   * Gets the simulation time when the scene was last rendered. Returns undefined if the scene has not yet been\n   * rendered.\n   * @memberof Scene.prototype\n   *\n   * @type {JulianDate}\n   * @readonly\n   */\n  lastRenderTime: {\n    get: function () {\n      return this._lastRenderTime;\n    },\n  },\n\n  /**\n   * @memberof Scene.prototype\n   * @private\n   * @readonly\n   */\n  context: {\n    get: function () {\n      return this._context;\n    },\n  },\n\n  /**\n   * This property is for debugging only; it is not for production use.\n   * <p>\n   * When {@link Scene.debugShowFrustums} is <code>true</code>, this contains\n   * properties with statistics about the number of command execute per frustum.\n   * <code>totalCommands</code> is the total number of commands executed, ignoring\n   * overlap. <code>commandsInFrustums</code> is an array with the number of times\n   * commands are executed redundantly, e.g., how many commands overlap two or\n   * three frustums.\n   * </p>\n   *\n   * @memberof Scene.prototype\n   *\n   * @type {Object}\n   * @readonly\n   *\n   * @default undefined\n   */\n  debugFrustumStatistics: {\n    get: function () {\n      return this._view.debugFrustumStatistics;\n    },\n  },\n\n  /**\n   * Gets whether or not the scene is optimized for 3D only viewing.\n   * @memberof Scene.prototype\n   * @type {Boolean}\n   * @readonly\n   */\n  scene3DOnly: {\n    get: function () {\n      return this._frameState.scene3DOnly;\n    },\n  },\n\n  /**\n   * Gets whether or not the scene has order independent translucency enabled.\n   * Note that this only reflects the original construction option, and there are\n   * other factors that could prevent OIT from functioning on a given system configuration.\n   * @memberof Scene.prototype\n   * @type {Boolean}\n   * @readonly\n   */\n  orderIndependentTranslucency: {\n    get: function () {\n      return this._useOIT;\n    },\n  },\n\n  /**\n   * Gets the unique identifier for this scene.\n   * @memberof Scene.prototype\n   * @type {String}\n   * @readonly\n   */\n  id: {\n    get: function () {\n      return this._id;\n    },\n  },\n\n  /**\n   * Gets or sets the current mode of the scene.\n   * @memberof Scene.prototype\n   * @type {SceneMode}\n   * @default {@link SceneMode.SCENE3D}\n   */\n  mode: {\n    get: function () {\n      return this._mode;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (this.scene3DOnly && value !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z(\n          "Only SceneMode.SCENE3D is valid when scene3DOnly is true."\n        );\n      }\n      //>>includeEnd(\'debug\');\n      if (value === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE2D */ .Z.SCENE2D) {\n        this.morphTo2D(0);\n      } else if (value === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n        this.morphTo3D(0);\n      } else if (value === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW) {\n        this.morphToColumbusView(0);\n        //>>includeStart(\'debug\', pragmas.debug);\n      } else {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z(\n          "value must be a valid SceneMode enumeration."\n        );\n        //>>includeEnd(\'debug\');\n      }\n      this._mode = value;\n    },\n  },\n\n  /**\n   * Gets the number of frustums used in the last frame.\n   * @memberof Scene.prototype\n   * @type {FrustumCommands[]}\n   *\n   * @private\n   */\n  frustumCommandsList: {\n    get: function () {\n      return this._view.frustumCommandsList;\n    },\n  },\n\n  /**\n   * Gets the number of frustums used in the last frame.\n   * @memberof Scene.prototype\n   * @type {Number}\n   *\n   * @private\n   */\n  numberOfFrustums: {\n    get: function () {\n      return this._view.frustumCommandsList.length;\n    },\n  },\n\n  /**\n   * When <code>true</code>, splits the scene into two viewports with steroscopic views for the left and right eyes.\n   * Used for cardboard and WebVR.\n   * @memberof Scene.prototype\n   * @type {Boolean}\n   * @default false\n   */\n  useWebVR: {\n    get: function () {\n      return this._useWebVR;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (this.camera.frustum instanceof _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z(\n          "VR is unsupported with an orthographic projection."\n        );\n      }\n      //>>includeEnd(\'debug\');\n      this._useWebVR = value;\n      if (this._useWebVR) {\n        this._frameState.creditDisplay.container.style.visibility = "hidden";\n        this._cameraVR = new _Camera_js__WEBPACK_IMPORTED_MODULE_37__/* ["default"] */ .Z(this);\n        if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this._deviceOrientationCameraController)) {\n          this._deviceOrientationCameraController = new _DeviceOrientationCameraController_js__WEBPACK_IMPORTED_MODULE_44__/* ["default"] */ .Z(\n            this\n          );\n        }\n\n        this._aspectRatioVR = this.camera.frustum.aspectRatio;\n      } else {\n        this._frameState.creditDisplay.container.style.visibility = "visible";\n        this._cameraVR = undefined;\n        this._deviceOrientationCameraController =\n          this._deviceOrientationCameraController &&\n          !this._deviceOrientationCameraController.isDestroyed() &&\n          this._deviceOrientationCameraController.destroy();\n\n        this.camera.frustum.aspectRatio = this._aspectRatioVR;\n        this.camera.frustum.xOffset = 0.0;\n      }\n    },\n  },\n\n  /**\n   * Determines if the 2D map is rotatable or can be scrolled infinitely in the horizontal direction.\n   * @memberof Scene.prototype\n   * @type {MapMode2D}\n   * @readonly\n   */\n  mapMode2D: {\n    get: function () {\n      return this._mapMode2D;\n    },\n  },\n\n  /**\n   * Gets or sets the position of the Imagery splitter within the viewport.  Valid values are between 0.0 and 1.0.\n   * @memberof Scene.prototype\n   *\n   * @type {Number}\n   */\n  imagerySplitPosition: {\n    get: function () {\n      return this._frameState.imagerySplitPosition;\n    },\n    set: function (value) {\n      this._frameState.imagerySplitPosition = value;\n    },\n  },\n\n  /**\n   * The distance from the camera at which to disable the depth test of billboards, labels and points\n   * to, for example, prevent clipping against terrain. When set to zero, the depth test should always\n   * be applied. When less than zero, the depth test should never be applied. Setting the disableDepthTestDistance\n   * property of a billboard, label or point will override this value.\n   * @memberof Scene.prototype\n   * @type {Number}\n   * @default 0.0\n   */\n  minimumDisableDepthTestDistance: {\n    get: function () {\n      return this._minimumDisableDepthTestDistance;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(value) || value < 0.0) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z(\n          "minimumDisableDepthTestDistance must be greater than or equal to 0.0."\n        );\n      }\n      //>>includeEnd(\'debug\');\n      this._minimumDisableDepthTestDistance = value;\n    },\n  },\n\n  /**\n   * Whether or not to use a logarithmic depth buffer. Enabling this option will allow for less frustums in the multi-frustum,\n   * increasing performance. This property relies on fragmentDepth being supported.\n   * @memberof Scene.prototype\n   * @type {Boolean}\n   */\n  logarithmicDepthBuffer: {\n    get: function () {\n      return this._logDepthBuffer;\n    },\n    set: function (value) {\n      value = this._context.fragmentDepth && value;\n      if (this._logDepthBuffer !== value) {\n        this._logDepthBuffer = value;\n        this._logDepthBufferDirty = true;\n      }\n    },\n  },\n\n  /**\n   * The value used for gamma correction. This is only used when rendering with high dynamic range.\n   * @memberof Scene.prototype\n   * @type {Number}\n   * @default 2.2\n   */\n  gamma: {\n    get: function () {\n      return this._context.uniformState.gamma;\n    },\n    set: function (value) {\n      this._context.uniformState.gamma = value;\n    },\n  },\n\n  /**\n   * Whether or not to use high dynamic range rendering.\n   * @memberof Scene.prototype\n   * @type {Boolean}\n   * @default true\n   */\n  highDynamicRange: {\n    get: function () {\n      return this._hdr;\n    },\n    set: function (value) {\n      var context = this._context;\n      var hdr =\n        value &&\n        context.depthTexture &&\n        (context.colorBufferFloat || context.colorBufferHalfFloat);\n      this._hdrDirty = hdr !== this._hdr;\n      this._hdr = hdr;\n    },\n  },\n\n  /**\n   * Whether or not high dynamic range rendering is supported.\n   * @memberof Scene.prototype\n   * @type {Boolean}\n   * @readonly\n   * @default true\n   */\n  highDynamicRangeSupported: {\n    get: function () {\n      var context = this._context;\n      return (\n        context.depthTexture &&\n        (context.colorBufferFloat || context.colorBufferHalfFloat)\n      );\n    },\n  },\n\n  /**\n   * Whether or not the camera is underneath the globe.\n   * @memberof Scene.prototype\n   * @type {Boolean}\n   * @readonly\n   * @default false\n   */\n  cameraUnderground: {\n    get: function () {\n      return this._cameraUnderground;\n    },\n  },\n\n  /**\n   * Ratio between a pixel and a density-independent pixel. Provides a standard unit of\n   * measure for real pixel measurements appropriate to a particular device.\n   *\n   * @memberof Scene.prototype\n   * @type {Number}\n   * @default 1.0\n   * @private\n   */\n  pixelRatio: {\n    get: function () {\n      return this._frameState.pixelRatio;\n    },\n    set: function (value) {\n      this._frameState.pixelRatio = value;\n    },\n  },\n\n  /**\n   * @private\n   */\n  opaqueFrustumNearOffset: {\n    get: function () {\n      return 0.9999;\n    },\n  },\n\n  /**\n   * @private\n   */\n  globeHeight: {\n    get: function () {\n      return this._globeHeight;\n    },\n  },\n});\n\n/**\n * Determines if a compressed texture format is supported.\n * @param {String} format The texture format. May be the name of the format or the WebGL extension name, e.g. s3tc or WEBGL_compressed_texture_s3tc.\n * @return {boolean} Whether or not the format is supported.\n */\nScene.prototype.getCompressedTextureFormatSupported = function (format) {\n  var context = this.context;\n  return (\n    ((format === "WEBGL_compressed_texture_s3tc" || format === "s3tc") &&\n      context.s3tc) ||\n    ((format === "WEBGL_compressed_texture_pvrtc" || format === "pvrtc") &&\n      context.pvrtc) ||\n    ((format === "WEBGL_compressed_texture_etc" || format === "etc") &&\n      context.etc) ||\n    ((format === "WEBGL_compressed_texture_etc1" || format === "etc1") &&\n      context.etc1) ||\n    ((format === "WEBGL_compressed_texture_astc" || format === "astc") &&\n      context.astc) ||\n    ((format === "EXT_texture_compression_bptc" || format === "bc7") &&\n      context.bc7)\n  );\n};\n\nfunction updateDerivedCommands(scene, command, shadowsDirty) {\n  var frameState = scene._frameState;\n  var context = scene._context;\n  var oit = scene._view.oit;\n  var lightShadowMaps = frameState.shadowState.lightShadowMaps;\n  var lightShadowsEnabled = frameState.shadowState.lightShadowsEnabled;\n\n  var derivedCommands = command.derivedCommands;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command.pickId)) {\n    derivedCommands.picking = _DerivedCommand_js__WEBPACK_IMPORTED_MODULE_43__/* ["default"].createPickDerivedCommand */ .Z.createPickDerivedCommand(\n      scene,\n      command,\n      context,\n      derivedCommands.picking\n    );\n  }\n\n  if (!command.pickOnly) {\n    derivedCommands.depth = _DerivedCommand_js__WEBPACK_IMPORTED_MODULE_43__/* ["default"].createDepthOnlyDerivedCommand */ .Z.createDepthOnlyDerivedCommand(\n      scene,\n      command,\n      context,\n      derivedCommands.depth\n    );\n  }\n\n  derivedCommands.originalCommand = command;\n\n  if (scene._hdr) {\n    derivedCommands.hdr = _DerivedCommand_js__WEBPACK_IMPORTED_MODULE_43__/* ["default"].createHdrCommand */ .Z.createHdrCommand(\n      command,\n      context,\n      derivedCommands.hdr\n    );\n    command = derivedCommands.hdr.command;\n    derivedCommands = command.derivedCommands;\n  }\n\n  if (lightShadowsEnabled && command.receiveShadows) {\n    derivedCommands.shadows = _ShadowMap_js__WEBPACK_IMPORTED_MODULE_63__/* ["default"].createReceiveDerivedCommand */ .Z.createReceiveDerivedCommand(\n      lightShadowMaps,\n      command,\n      shadowsDirty,\n      context,\n      derivedCommands.shadows\n    );\n  }\n\n  if (command.pass === _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(oit) && oit.isSupported()) {\n    if (lightShadowsEnabled && command.receiveShadows) {\n      derivedCommands.oit = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(derivedCommands.oit)\n        ? derivedCommands.oit\n        : {};\n      derivedCommands.oit.shadows = oit.createDerivedCommands(\n        derivedCommands.shadows.receiveCommand,\n        context,\n        derivedCommands.oit.shadows\n      );\n    } else {\n      derivedCommands.oit = oit.createDerivedCommands(\n        command,\n        context,\n        derivedCommands.oit\n      );\n    }\n  }\n}\n\n/**\n * @private\n */\nScene.prototype.updateDerivedCommands = function (command) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command.derivedCommands)) {\n    // Is not a DrawCommand\n    return;\n  }\n\n  var frameState = this._frameState;\n  var context = this._context;\n\n  // Update derived commands when any shadow maps become dirty\n  var shadowsDirty = false;\n  var lastDirtyTime = frameState.shadowState.lastDirtyTime;\n  if (command.lastDirtyTime !== lastDirtyTime) {\n    command.lastDirtyTime = lastDirtyTime;\n    command.dirty = true;\n    shadowsDirty = true;\n  }\n\n  var useLogDepth = frameState.useLogDepth;\n  var useHdr = this._hdr;\n  var derivedCommands = command.derivedCommands;\n  var hasLogDepthDerivedCommands = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(derivedCommands.logDepth);\n  var hasHdrCommands = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(derivedCommands.hdr);\n  var hasDerivedCommands = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(derivedCommands.originalCommand);\n  var needsLogDepthDerivedCommands = useLogDepth && !hasLogDepthDerivedCommands;\n  var needsHdrCommands = useHdr && !hasHdrCommands;\n  var needsDerivedCommands = (!useLogDepth || !useHdr) && !hasDerivedCommands;\n  command.dirty =\n    command.dirty ||\n    needsLogDepthDerivedCommands ||\n    needsHdrCommands ||\n    needsDerivedCommands;\n\n  if (command.dirty) {\n    command.dirty = false;\n\n    var shadowMaps = frameState.shadowState.shadowMaps;\n    var shadowsEnabled = frameState.shadowState.shadowsEnabled;\n    if (shadowsEnabled && command.castShadows) {\n      derivedCommands.shadows = _ShadowMap_js__WEBPACK_IMPORTED_MODULE_63__/* ["default"].createCastDerivedCommand */ .Z.createCastDerivedCommand(\n        shadowMaps,\n        command,\n        shadowsDirty,\n        context,\n        derivedCommands.shadows\n      );\n    }\n\n    if (hasLogDepthDerivedCommands || needsLogDepthDerivedCommands) {\n      derivedCommands.logDepth = _DerivedCommand_js__WEBPACK_IMPORTED_MODULE_43__/* ["default"].createLogDepthCommand */ .Z.createLogDepthCommand(\n        command,\n        context,\n        derivedCommands.logDepth\n      );\n      updateDerivedCommands(\n        this,\n        derivedCommands.logDepth.command,\n        shadowsDirty\n      );\n    }\n    if (hasDerivedCommands || needsDerivedCommands) {\n      updateDerivedCommands(this, command, shadowsDirty);\n    }\n  }\n};\n\nvar renderTilesetPassState = new _Cesium3DTilePassState_js__WEBPACK_IMPORTED_MODULE_39__/* ["default"] */ .Z({\n  pass: _Cesium3DTilePass_js__WEBPACK_IMPORTED_MODULE_38__/* ["default"].RENDER */ .Z.RENDER,\n});\n\nvar preloadTilesetPassState = new _Cesium3DTilePassState_js__WEBPACK_IMPORTED_MODULE_39__/* ["default"] */ .Z({\n  pass: _Cesium3DTilePass_js__WEBPACK_IMPORTED_MODULE_38__/* ["default"].PRELOAD */ .Z.PRELOAD,\n});\n\nvar preloadFlightTilesetPassState = new _Cesium3DTilePassState_js__WEBPACK_IMPORTED_MODULE_39__/* ["default"] */ .Z({\n  pass: _Cesium3DTilePass_js__WEBPACK_IMPORTED_MODULE_38__/* ["default"].PRELOAD_FLIGHT */ .Z.PRELOAD_FLIGHT,\n});\n\nvar requestRenderModeDeferCheckPassState = new _Cesium3DTilePassState_js__WEBPACK_IMPORTED_MODULE_39__/* ["default"] */ .Z({\n  pass: _Cesium3DTilePass_js__WEBPACK_IMPORTED_MODULE_38__/* ["default"].REQUEST_RENDER_MODE_DEFER_CHECK */ .Z.REQUEST_RENDER_MODE_DEFER_CHECK,\n});\n\nvar scratchOccluderBoundingSphere = new _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchOccluder;\n\nfunction getOccluder(scene) {\n  // TODO: The occluder is the top-level globe. When we add\n  //       support for multiple central bodies, this should be the closest one.\n  var globe = scene.globe;\n  if (\n    scene._mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE3D */ .Z.SCENE3D &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globe) &&\n    globe.show &&\n    !scene._cameraUnderground &&\n    !scene._globeTranslucencyState.translucent\n  ) {\n    var ellipsoid = globe.ellipsoid;\n    var minimumTerrainHeight = scene.frameState.minimumTerrainHeight;\n    scratchOccluderBoundingSphere.radius =\n      ellipsoid.minimumRadius + minimumTerrainHeight;\n    scratchOccluder = _Core_Occluder_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"].fromBoundingSphere */ .Z.fromBoundingSphere(\n      scratchOccluderBoundingSphere,\n      scene.camera.positionWC,\n      scratchOccluder\n    );\n    return scratchOccluder;\n  }\n\n  return undefined;\n}\n\n/**\n * @private\n */\nScene.prototype.clearPasses = function (passes) {\n  passes.render = false;\n  passes.pick = false;\n  passes.depth = false;\n  passes.postProcess = false;\n  passes.offscreen = false;\n};\n\nfunction updateFrameNumber(scene, frameNumber, time) {\n  var frameState = scene._frameState;\n  frameState.frameNumber = frameNumber;\n  frameState.time = _Core_JulianDate_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].clone */ .Z.clone(time, frameState.time);\n}\n\n/**\n * @private\n */\nScene.prototype.updateFrameState = function () {\n  var camera = this.camera;\n\n  var frameState = this._frameState;\n  frameState.commandList.length = 0;\n  frameState.shadowMaps.length = 0;\n  frameState.brdfLutGenerator = this._brdfLutGenerator;\n  frameState.environmentMap = this.skyBox && this.skyBox._cubeMap;\n  frameState.mode = this._mode;\n  frameState.morphTime = this.morphTime;\n  frameState.mapProjection = this.mapProjection;\n  frameState.camera = camera;\n  frameState.cullingVolume = camera.frustum.computeCullingVolume(\n    camera.positionWC,\n    camera.directionWC,\n    camera.upWC\n  );\n  frameState.occluder = getOccluder(this);\n  frameState.minimumTerrainHeight = 0.0;\n  frameState.minimumDisableDepthTestDistance = this._minimumDisableDepthTestDistance;\n  frameState.invertClassification = this.invertClassification;\n  frameState.useLogDepth =\n    this._logDepthBuffer &&\n    !(\n      this.camera.frustum instanceof _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z ||\n      this.camera.frustum instanceof _Core_OrthographicOffCenterFrustum_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"] */ .Z\n    );\n  frameState.light = this.light;\n  frameState.cameraUnderground = this._cameraUnderground;\n  frameState.globeTranslucencyState = this._globeTranslucencyState;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this.globe)) {\n    frameState.terrainExaggeration = this.globe.terrainExaggeration;\n    frameState.terrainExaggerationRelativeHeight = this.globe.terrainExaggerationRelativeHeight;\n  }\n\n  if (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this._specularEnvironmentMapAtlas) &&\n    this._specularEnvironmentMapAtlas.ready\n  ) {\n    frameState.specularEnvironmentMaps = this._specularEnvironmentMapAtlas.texture;\n    frameState.specularEnvironmentMapsMaximumLOD = this._specularEnvironmentMapAtlas.maximumMipmapLevel;\n  } else {\n    frameState.specularEnvironmentMaps = undefined;\n    frameState.specularEnvironmentMapsMaximumLOD = undefined;\n  }\n\n  frameState.sphericalHarmonicCoefficients = this.sphericalHarmonicCoefficients;\n\n  this._actualInvertClassificationColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].clone */ .Z.clone(\n    this.invertClassificationColor,\n    this._actualInvertClassificationColor\n  );\n  if (!_InvertClassification_js__WEBPACK_IMPORTED_MODULE_49__/* ["default"].isTranslucencySupported */ .Z.isTranslucencySupported(this._context)) {\n    this._actualInvertClassificationColor.alpha = 1.0;\n  }\n\n  frameState.invertClassificationColor = this._actualInvertClassificationColor;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this.globe)) {\n    frameState.maximumScreenSpaceError = this.globe.maximumScreenSpaceError;\n  } else {\n    frameState.maximumScreenSpaceError = 2;\n  }\n\n  this.clearPasses(frameState.passes);\n\n  frameState.tilesetPassState = undefined;\n};\n\n/**\n * @private\n */\nScene.prototype.isVisible = function (command, cullingVolume, occluder) {\n  return (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command) &&\n    (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command.boundingVolume) ||\n      !command.cull ||\n      (cullingVolume.computeVisibility(command.boundingVolume) !==\n        _Core_Intersect_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].OUTSIDE */ .Z.OUTSIDE &&\n        (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(occluder) ||\n          !command.occlude ||\n          !command.boundingVolume.isOccluded(occluder))))\n  );\n};\n\nvar transformFrom2D = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"] */ .Z(\n  0.0,\n  0.0,\n  1.0,\n  0.0,\n  1.0,\n  0.0,\n  0.0,\n  0.0,\n  0.0,\n  1.0,\n  0.0,\n  0.0,\n  0.0,\n  0.0,\n  0.0,\n  1.0\n);\ntransformFrom2D = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].inverseTransformation */ .Z.inverseTransformation(\n  transformFrom2D,\n  transformFrom2D\n);\n\nfunction debugShowBoundingVolume(command, scene, passState, debugFramebuffer) {\n  // Debug code to draw bounding volume for command.  Not optimized!\n  // Assumes bounding volume is a bounding sphere or box\n  var frameState = scene._frameState;\n  var context = frameState.context;\n  var boundingVolume = command.boundingVolume;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene._debugVolume)) {\n    scene._debugVolume.destroy();\n  }\n\n  var geometry;\n\n  var center = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(boundingVolume.center);\n  if (frameState.mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    center = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].multiplyByPoint */ .Z.multiplyByPoint(transformFrom2D, center, center);\n    var projection = frameState.mapProjection;\n    var centerCartographic = projection.unproject(center);\n    center = projection.ellipsoid.cartographicToCartesian(centerCartographic);\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(boundingVolume.radius)) {\n    var radius = boundingVolume.radius;\n\n    geometry = _Core_GeometryPipeline_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].toWireframe */ .Z.toWireframe(\n      _Core_EllipsoidGeometry_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].createGeometry */ .Z.createGeometry(\n        new _Core_EllipsoidGeometry_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z({\n          radii: new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z(radius, radius, radius),\n          vertexFormat: _PerInstanceColorAppearance_js__WEBPACK_IMPORTED_MODULE_54__/* ["default"].FLAT_VERTEX_FORMAT */ .Z.FLAT_VERTEX_FORMAT,\n        })\n      )\n    );\n\n    scene._debugVolume = new _Primitive_js__WEBPACK_IMPORTED_MODULE_57__/* ["default"] */ .Z({\n      geometryInstances: new _Core_GeometryInstance_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z({\n        geometry: geometry,\n        modelMatrix: _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].fromTranslation */ .Z.fromTranslation(center),\n        attributes: {\n          color: new _Core_ColorGeometryInstanceAttribute_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z(1.0, 0.0, 0.0, 1.0),\n        },\n      }),\n      appearance: new _PerInstanceColorAppearance_js__WEBPACK_IMPORTED_MODULE_54__/* ["default"] */ .Z({\n        flat: true,\n        translucent: false,\n      }),\n      asynchronous: false,\n    });\n  } else {\n    var halfAxes = boundingVolume.halfAxes;\n\n    geometry = _Core_GeometryPipeline_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].toWireframe */ .Z.toWireframe(\n      _Core_BoxGeometry_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].createGeometry */ .Z.createGeometry(\n        _Core_BoxGeometry_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].fromDimensions */ .Z.fromDimensions({\n          dimensions: new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z(2.0, 2.0, 2.0),\n          vertexFormat: _PerInstanceColorAppearance_js__WEBPACK_IMPORTED_MODULE_54__/* ["default"].FLAT_VERTEX_FORMAT */ .Z.FLAT_VERTEX_FORMAT,\n        })\n      )\n    );\n\n    scene._debugVolume = new _Primitive_js__WEBPACK_IMPORTED_MODULE_57__/* ["default"] */ .Z({\n      geometryInstances: new _Core_GeometryInstance_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z({\n        geometry: geometry,\n        modelMatrix: _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].fromRotationTranslation */ .Z.fromRotationTranslation(\n          halfAxes,\n          center,\n          new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"] */ .Z()\n        ),\n        attributes: {\n          color: new _Core_ColorGeometryInstanceAttribute_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z(1.0, 0.0, 0.0, 1.0),\n        },\n      }),\n      appearance: new _PerInstanceColorAppearance_js__WEBPACK_IMPORTED_MODULE_54__/* ["default"] */ .Z({\n        flat: true,\n        translucent: false,\n      }),\n      asynchronous: false,\n    });\n  }\n\n  var savedCommandList = frameState.commandList;\n  var commandList = (frameState.commandList = []);\n  scene._debugVolume.update(frameState);\n\n  command = commandList[0];\n\n  if (frameState.useLogDepth) {\n    var logDepth = _DerivedCommand_js__WEBPACK_IMPORTED_MODULE_43__/* ["default"].createLogDepthCommand */ .Z.createLogDepthCommand(command, context);\n    command = logDepth.command;\n  }\n\n  var framebuffer;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(debugFramebuffer)) {\n    framebuffer = passState.framebuffer;\n    passState.framebuffer = debugFramebuffer;\n  }\n\n  command.execute(context, passState);\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(framebuffer)) {\n    passState.framebuffer = framebuffer;\n  }\n\n  frameState.commandList = savedCommandList;\n}\n\nfunction executeCommand(command, scene, context, passState, debugFramebuffer) {\n  var frameState = scene._frameState;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene.debugCommandFilter) && !scene.debugCommandFilter(command)) {\n    return;\n  }\n\n  if (command instanceof _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_30__/* ["default"] */ .Z) {\n    command.execute(context, passState);\n    return;\n  }\n\n  if (command.debugShowBoundingVolume && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command.boundingVolume)) {\n    debugShowBoundingVolume(command, scene, passState, debugFramebuffer);\n  }\n\n  if (frameState.useLogDepth && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command.derivedCommands.logDepth)) {\n    command = command.derivedCommands.logDepth.command;\n  }\n\n  var passes = frameState.passes;\n  if (\n    !passes.pick &&\n    !passes.depth &&\n    scene._hdr &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command.derivedCommands) &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command.derivedCommands.hdr)\n  ) {\n    command = command.derivedCommands.hdr.command;\n  }\n\n  if (passes.pick || passes.depth) {\n    if (\n      passes.pick &&\n      !passes.depth &&\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command.derivedCommands.picking)\n    ) {\n      command = command.derivedCommands.picking.pickCommand;\n      command.execute(context, passState);\n      return;\n    } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command.derivedCommands.depth)) {\n      command = command.derivedCommands.depth.depthOnlyCommand;\n      command.execute(context, passState);\n      return;\n    }\n  }\n\n  if (scene.debugShowCommands || scene.debugShowFrustums) {\n    scene._debugInspector.executeDebugShowFrustumsCommand(\n      scene,\n      command,\n      passState\n    );\n    return;\n  }\n\n  if (\n    frameState.shadowState.lightShadowsEnabled &&\n    command.receiveShadows &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(command.derivedCommands.shadows)\n  ) {\n    // If the command receives shadows, execute the derived shadows command.\n    // Some commands, such as OIT derived commands, do not have derived shadow commands themselves\n    // and instead shadowing is built-in. In this case execute the command regularly below.\n    command.derivedCommands.shadows.receiveCommand.execute(context, passState);\n  } else {\n    command.execute(context, passState);\n  }\n}\n\nfunction executeIdCommand(command, scene, context, passState) {\n  var frameState = scene._frameState;\n  var derivedCommands = command.derivedCommands;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(derivedCommands)) {\n    return;\n  }\n\n  if (frameState.useLogDepth && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(derivedCommands.logDepth)) {\n    command = derivedCommands.logDepth.command;\n  }\n\n  derivedCommands = command.derivedCommands;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(derivedCommands.picking)) {\n    command = derivedCommands.picking.pickCommand;\n    command.execute(context, passState);\n  } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(derivedCommands.depth)) {\n    command = derivedCommands.depth.depthOnlyCommand;\n    command.execute(context, passState);\n  }\n}\n\nfunction backToFront(a, b, position) {\n  return (\n    b.boundingVolume.distanceSquaredTo(position) -\n    a.boundingVolume.distanceSquaredTo(position)\n  );\n}\n\nfunction frontToBack(a, b, position) {\n  // When distances are equal equal favor sorting b before a. This gives render priority to commands later in the list.\n  return (\n    a.boundingVolume.distanceSquaredTo(position) -\n    b.boundingVolume.distanceSquaredTo(position) +\n    _Core_Math_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].EPSILON12 */ .Z.EPSILON12\n  );\n}\n\nfunction executeTranslucentCommandsBackToFront(\n  scene,\n  executeFunction,\n  passState,\n  commands,\n  invertClassification\n) {\n  var context = scene.context;\n\n  (0,_Core_mergeSort_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"] */ .Z)(commands, backToFront, scene.camera.positionWC);\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(invertClassification)) {\n    executeFunction(\n      invertClassification.unclassifiedCommand,\n      scene,\n      context,\n      passState\n    );\n  }\n\n  var length = commands.length;\n  for (var i = 0; i < length; ++i) {\n    executeFunction(commands[i], scene, context, passState);\n  }\n}\n\nfunction executeTranslucentCommandsFrontToBack(\n  scene,\n  executeFunction,\n  passState,\n  commands,\n  invertClassification\n) {\n  var context = scene.context;\n\n  (0,_Core_mergeSort_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"] */ .Z)(commands, frontToBack, scene.camera.positionWC);\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(invertClassification)) {\n    executeFunction(\n      invertClassification.unclassifiedCommand,\n      scene,\n      context,\n      passState\n    );\n  }\n\n  var length = commands.length;\n  for (var i = 0; i < length; ++i) {\n    executeFunction(commands[i], scene, context, passState);\n  }\n}\n\nfunction getDebugGlobeDepth(scene, index) {\n  var globeDepths = scene._view.debugGlobeDepths;\n  var globeDepth = globeDepths[index];\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globeDepth) && scene.context.depthTexture) {\n    globeDepth = new _GlobeDepth_js__WEBPACK_IMPORTED_MODULE_47__/* ["default"] */ .Z();\n    globeDepths[index] = globeDepth;\n  }\n  return globeDepth;\n}\n\nvar scratchPerspectiveFrustum = new _Core_PerspectiveFrustum_js__WEBPACK_IMPORTED_MODULE_25__/* ["default"] */ .Z();\nvar scratchPerspectiveOffCenterFrustum = new _Core_PerspectiveOffCenterFrustum_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z();\nvar scratchOrthographicFrustum = new _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z();\nvar scratchOrthographicOffCenterFrustum = new _Core_OrthographicOffCenterFrustum_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"] */ .Z();\n\nfunction executeCommands(scene, passState) {\n  var camera = scene.camera;\n  var context = scene.context;\n  var frameState = scene.frameState;\n  var us = context.uniformState;\n\n  us.updateCamera(camera);\n\n  // Create a working frustum from the original camera frustum.\n  var frustum;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(camera.frustum.fov)) {\n    frustum = camera.frustum.clone(scratchPerspectiveFrustum);\n  } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(camera.frustum.infiniteProjectionMatrix)) {\n    frustum = camera.frustum.clone(scratchPerspectiveOffCenterFrustum);\n  } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(camera.frustum.width)) {\n    frustum = camera.frustum.clone(scratchOrthographicFrustum);\n  } else {\n    frustum = camera.frustum.clone(scratchOrthographicOffCenterFrustum);\n  }\n\n  // Ideally, we would render the sky box and atmosphere last for\n  // early-z, but we would have to draw it in each frustum\n  frustum.near = camera.frustum.near;\n  frustum.far = camera.frustum.far;\n  us.updateFrustum(frustum);\n  us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].ENVIRONMENT */ .Z.ENVIRONMENT);\n\n  var passes = frameState.passes;\n  var picking = passes.pick;\n  var environmentState = scene._environmentState;\n  var view = scene._view;\n  var renderTranslucentDepthForPick =\n    environmentState.renderTranslucentDepthForPick;\n  var useWebVR = environmentState.useWebVR;\n\n  // Do not render environment primitives during a pick pass since they do not generate picking commands.\n  if (!picking) {\n    var skyBoxCommand = environmentState.skyBoxCommand;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(skyBoxCommand)) {\n      executeCommand(skyBoxCommand, scene, context, passState);\n    }\n\n    if (environmentState.isSkyAtmosphereVisible) {\n      executeCommand(\n        environmentState.skyAtmosphereCommand,\n        scene,\n        context,\n        passState\n      );\n    }\n\n    if (environmentState.isSunVisible) {\n      environmentState.sunDrawCommand.execute(context, passState);\n      if (scene.sunBloom && !useWebVR) {\n        var framebuffer;\n        if (environmentState.useGlobeDepthFramebuffer) {\n          framebuffer = view.globeDepth.framebuffer;\n        } else if (environmentState.usePostProcess) {\n          framebuffer = view.sceneFramebuffer.getFramebuffer();\n        } else {\n          framebuffer = environmentState.originalFramebuffer;\n        }\n        scene._sunPostProcess.execute(context);\n        scene._sunPostProcess.copy(context, framebuffer);\n        passState.framebuffer = framebuffer;\n      }\n    }\n\n    // Moon can be seen through the atmosphere, since the sun is rendered after the atmosphere.\n    if (environmentState.isMoonVisible) {\n      environmentState.moonCommand.execute(context, passState);\n    }\n  }\n\n  // Determine how translucent surfaces will be handled.\n  var executeTranslucentCommands;\n  if (environmentState.useOIT) {\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene._executeOITFunction)) {\n      scene._executeOITFunction = function (\n        scene,\n        executeFunction,\n        passState,\n        commands,\n        invertClassification\n      ) {\n        view.oit.executeCommands(\n          scene,\n          executeFunction,\n          passState,\n          commands,\n          invertClassification\n        );\n      };\n    }\n    executeTranslucentCommands = scene._executeOITFunction;\n  } else if (passes.render) {\n    executeTranslucentCommands = executeTranslucentCommandsBackToFront;\n  } else {\n    executeTranslucentCommands = executeTranslucentCommandsFrontToBack;\n  }\n\n  var frustumCommandsList = view.frustumCommandsList;\n  var numFrustums = frustumCommandsList.length;\n\n  var clearGlobeDepth = environmentState.clearGlobeDepth;\n  var useDepthPlane = environmentState.useDepthPlane;\n  var globeTranslucencyState = scene._globeTranslucencyState;\n  var globeTranslucent = globeTranslucencyState.translucent;\n  var globeTranslucencyFramebuffer = scene._view.globeTranslucencyFramebuffer;\n  var separatePrimitiveFramebuffer = (environmentState.separatePrimitiveFramebuffer = false);\n  var clearDepth = scene._depthClearCommand;\n  var clearStencil = scene._stencilClearCommand;\n  var clearClassificationStencil = scene._classificationStencilClearCommand;\n  var depthPlane = scene._depthPlane;\n  var usePostProcessSelected = environmentState.usePostProcessSelected;\n\n  var height2D = camera.position.z;\n\n  // Execute commands in each frustum in back to front order\n  var j;\n  for (var i = 0; i < numFrustums; ++i) {\n    var index = numFrustums - i - 1;\n    var frustumCommands = frustumCommandsList[index];\n\n    if (scene.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE2D */ .Z.SCENE2D) {\n      // To avoid z-fighting in 2D, move the camera to just before the frustum\n      // and scale the frustum depth to be in [1.0, nearToFarDistance2D].\n      camera.position.z = height2D - frustumCommands.near + 1.0;\n      frustum.far = Math.max(1.0, frustumCommands.far - frustumCommands.near);\n      frustum.near = 1.0;\n      us.update(frameState);\n      us.updateFrustum(frustum);\n    } else {\n      // Avoid tearing artifacts between adjacent frustums in the opaque passes\n      frustum.near =\n        index !== 0\n          ? frustumCommands.near * scene.opaqueFrustumNearOffset\n          : frustumCommands.near;\n      frustum.far = frustumCommands.far;\n      us.updateFrustum(frustum);\n    }\n\n    var globeDepth = scene.debugShowGlobeDepth\n      ? getDebugGlobeDepth(scene, index)\n      : view.globeDepth;\n\n    if (separatePrimitiveFramebuffer) {\n      // Render to globe framebuffer in GLOBE pass\n      passState.framebuffer = globeDepth.framebuffer;\n    }\n\n    var fb;\n    if (\n      scene.debugShowGlobeDepth &&\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globeDepth) &&\n      environmentState.useGlobeDepthFramebuffer\n    ) {\n      globeDepth.update(\n        context,\n        passState,\n        view.viewport,\n        scene._hdr,\n        clearGlobeDepth\n      );\n      globeDepth.clear(context, passState, scene._clearColorCommand.color);\n      fb = passState.framebuffer;\n      passState.framebuffer = globeDepth.framebuffer;\n    }\n\n    clearDepth.execute(context, passState);\n\n    if (context.stencilBuffer) {\n      clearStencil.execute(context, passState);\n    }\n\n    us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].GLOBE */ .Z.GLOBE);\n    var commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].GLOBE */ .Z.GLOBE];\n    var length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].GLOBE */ .Z.GLOBE];\n\n    if (globeTranslucent) {\n      globeTranslucencyState.executeGlobeCommands(\n        frustumCommands,\n        executeCommand,\n        globeTranslucencyFramebuffer,\n        scene,\n        passState\n      );\n    } else {\n      for (j = 0; j < length; ++j) {\n        executeCommand(commands[j], scene, context, passState);\n      }\n    }\n\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globeDepth) && environmentState.useGlobeDepthFramebuffer) {\n      globeDepth.executeCopyDepth(context, passState);\n    }\n\n    if (\n      scene.debugShowGlobeDepth &&\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globeDepth) &&\n      environmentState.useGlobeDepthFramebuffer\n    ) {\n      passState.framebuffer = fb;\n    }\n\n    // Draw terrain classification\n    if (!environmentState.renderTranslucentDepthForPick) {\n      us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TERRAIN_CLASSIFICATION */ .Z.TERRAIN_CLASSIFICATION);\n      commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TERRAIN_CLASSIFICATION */ .Z.TERRAIN_CLASSIFICATION];\n      length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TERRAIN_CLASSIFICATION */ .Z.TERRAIN_CLASSIFICATION];\n\n      if (globeTranslucent) {\n        globeTranslucencyState.executeGlobeClassificationCommands(\n          frustumCommands,\n          executeCommand,\n          globeTranslucencyFramebuffer,\n          scene,\n          passState\n        );\n      } else {\n        for (j = 0; j < length; ++j) {\n          executeCommand(commands[j], scene, context, passState);\n        }\n      }\n    }\n\n    if (clearGlobeDepth) {\n      clearDepth.execute(context, passState);\n      if (useDepthPlane) {\n        depthPlane.execute(context, passState);\n      }\n    }\n\n    if (separatePrimitiveFramebuffer) {\n      // Render to primitive framebuffer in all other passes\n      passState.framebuffer = globeDepth.primitiveFramebuffer;\n    }\n\n    if (\n      !environmentState.useInvertClassification ||\n      picking ||\n      environmentState.renderTranslucentDepthForPick\n    ) {\n      // Common/fastest path. Draw 3D Tiles and classification normally.\n\n      // Draw 3D Tiles\n      us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE);\n      commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE];\n      length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE];\n      for (j = 0; j < length; ++j) {\n        executeCommand(commands[j], scene, context, passState);\n      }\n\n      if (length > 0) {\n        if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globeDepth) && environmentState.useGlobeDepthFramebuffer) {\n          globeDepth.executeUpdateDepth(context, passState, clearGlobeDepth);\n        }\n\n        // Draw classifications. Modifies 3D Tiles color.\n        if (!environmentState.renderTranslucentDepthForPick) {\n          us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE_CLASSIFICATION */ .Z.CESIUM_3D_TILE_CLASSIFICATION);\n          commands =\n            frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE_CLASSIFICATION */ .Z.CESIUM_3D_TILE_CLASSIFICATION];\n          length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE_CLASSIFICATION */ .Z.CESIUM_3D_TILE_CLASSIFICATION];\n          for (j = 0; j < length; ++j) {\n            executeCommand(commands[j], scene, context, passState);\n          }\n        }\n      }\n    } else {\n      // When the invert classification color is opaque:\n      //    Main FBO (FBO1):                   Main_Color   + Main_DepthStencil\n      //    Invert classification FBO (FBO2) : Invert_Color + Main_DepthStencil\n      //\n      //    1. Clear FBO2 color to vec4(0.0) for each frustum\n      //    2. Draw 3D Tiles to FBO2\n      //    3. Draw classification to FBO2\n      //    4. Fullscreen pass to FBO1, draw Invert_Color when:\n      //           * Main_DepthStencil has the stencil bit set > 0 (classified)\n      //    5. Fullscreen pass to FBO1, draw Invert_Color * czm_invertClassificationColor when:\n      //           * Main_DepthStencil has stencil bit set to 0 (unclassified) and\n      //           * Invert_Color !== vec4(0.0)\n      //\n      // When the invert classification color is translucent:\n      //    Main FBO (FBO1):                  Main_Color         + Main_DepthStencil\n      //    Invert classification FBO (FBO2): Invert_Color       + Invert_DepthStencil\n      //    IsClassified FBO (FBO3):          IsClassified_Color + Invert_DepthStencil\n      //\n      //    1. Clear FBO2 and FBO3 color to vec4(0.0), stencil to 0, and depth to 1.0\n      //    2. Draw 3D Tiles to FBO2\n      //    3. Draw classification to FBO2\n      //    4. Fullscreen pass to FBO3, draw any color when\n      //           * Invert_DepthStencil has the stencil bit set > 0 (classified)\n      //    5. Fullscreen pass to FBO1, draw Invert_Color when:\n      //           * Invert_Color !== vec4(0.0) and\n      //           * IsClassified_Color !== vec4(0.0)\n      //    6. Fullscreen pass to FBO1, draw Invert_Color * czm_invertClassificationColor when:\n      //           * Invert_Color !== vec4(0.0) and\n      //           * IsClassified_Color === vec4(0.0)\n      //\n      // NOTE: Step six when translucent invert color occurs after the TRANSLUCENT pass\n      //\n      scene._invertClassification.clear(context, passState);\n\n      var opaqueClassificationFramebuffer = passState.framebuffer;\n      passState.framebuffer = scene._invertClassification._fbo;\n\n      // Draw normally\n      us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE);\n      commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE];\n      length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE];\n      for (j = 0; j < length; ++j) {\n        executeCommand(commands[j], scene, context, passState);\n      }\n\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globeDepth) && environmentState.useGlobeDepthFramebuffer) {\n        globeDepth.executeUpdateDepth(context, passState, clearGlobeDepth);\n      }\n\n      // Set stencil\n      us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW */ .Z.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW);\n      commands =\n        frustumCommands.commands[\n          _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW */ .Z.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW\n        ];\n      length =\n        frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW */ .Z.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW];\n      for (j = 0; j < length; ++j) {\n        executeCommand(commands[j], scene, context, passState);\n      }\n\n      passState.framebuffer = opaqueClassificationFramebuffer;\n\n      // Fullscreen pass to copy classified fragments\n      scene._invertClassification.executeClassified(context, passState);\n      if (frameState.invertClassificationColor.alpha === 1.0) {\n        // Fullscreen pass to copy unclassified fragments when alpha == 1.0\n        scene._invertClassification.executeUnclassified(context, passState);\n      }\n\n      // Clear stencil set by the classification for the next classification pass\n      if (length > 0 && context.stencilBuffer) {\n        clearClassificationStencil.execute(context, passState);\n      }\n\n      // Draw style over classification.\n      us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE_CLASSIFICATION */ .Z.CESIUM_3D_TILE_CLASSIFICATION);\n      commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE_CLASSIFICATION */ .Z.CESIUM_3D_TILE_CLASSIFICATION];\n      length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE_CLASSIFICATION */ .Z.CESIUM_3D_TILE_CLASSIFICATION];\n      for (j = 0; j < length; ++j) {\n        executeCommand(commands[j], scene, context, passState);\n      }\n    }\n\n    if (length > 0 && context.stencilBuffer) {\n      clearStencil.execute(context, passState);\n    }\n\n    us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].OPAQUE */ .Z.OPAQUE);\n    commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].OPAQUE */ .Z.OPAQUE];\n    length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].OPAQUE */ .Z.OPAQUE];\n    for (j = 0; j < length; ++j) {\n      executeCommand(commands[j], scene, context, passState);\n    }\n\n    if (index !== 0 && scene.mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE2D */ .Z.SCENE2D) {\n      // Do not overlap frustums in the translucent pass to avoid blending artifacts\n      frustum.near = frustumCommands.near;\n      us.updateFrustum(frustum);\n    }\n\n    var invertClassification;\n    if (\n      !picking &&\n      environmentState.useInvertClassification &&\n      frameState.invertClassificationColor.alpha < 1.0\n    ) {\n      // Fullscreen pass to copy unclassified fragments when alpha < 1.0.\n      // Not executed when undefined.\n      invertClassification = scene._invertClassification;\n    }\n\n    us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT);\n    commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT];\n    commands.length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT];\n    executeTranslucentCommands(\n      scene,\n      executeCommand,\n      passState,\n      commands,\n      invertClassification\n    );\n\n    // Classification for translucent 3D Tiles\n    var has3DTilesClassificationCommands =\n      frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE_CLASSIFICATION */ .Z.CESIUM_3D_TILE_CLASSIFICATION] > 0;\n    if (\n      has3DTilesClassificationCommands &&\n      view.translucentTileClassification.isSupported()\n    ) {\n      view.translucentTileClassification.executeTranslucentCommands(\n        scene,\n        executeCommand,\n        passState,\n        commands,\n        globeDepth.framebuffer\n      );\n      view.translucentTileClassification.executeClassificationCommands(\n        scene,\n        executeCommand,\n        passState,\n        frustumCommands\n      );\n    }\n\n    if (\n      context.depthTexture &&\n      scene.useDepthPicking &&\n      (environmentState.useGlobeDepthFramebuffer ||\n        renderTranslucentDepthForPick)\n    ) {\n      // PERFORMANCE_IDEA: Use MRT to avoid the extra copy.\n      var depthStencilTexture = renderTranslucentDepthForPick\n        ? passState.framebuffer.depthStencilTexture\n        : globeDepth.framebuffer.depthStencilTexture;\n      var pickDepth = scene._picking.getPickDepth(scene, index);\n      pickDepth.update(context, depthStencilTexture);\n      pickDepth.executeCopyDepth(context, passState);\n    }\n\n    if (separatePrimitiveFramebuffer) {\n      // Reset framebuffer\n      passState.framebuffer = globeDepth.framebuffer;\n    }\n\n    if (picking || !usePostProcessSelected) {\n      continue;\n    }\n\n    var originalFramebuffer = passState.framebuffer;\n    passState.framebuffer = view.sceneFramebuffer.getIdFramebuffer();\n\n    // reset frustum\n    frustum.near =\n      index !== 0\n        ? frustumCommands.near * scene.opaqueFrustumNearOffset\n        : frustumCommands.near;\n    frustum.far = frustumCommands.far;\n    us.updateFrustum(frustum);\n\n    us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].GLOBE */ .Z.GLOBE);\n    commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].GLOBE */ .Z.GLOBE];\n    length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].GLOBE */ .Z.GLOBE];\n\n    if (globeTranslucent) {\n      globeTranslucencyState.executeGlobeCommands(\n        frustumCommands,\n        executeIdCommand,\n        globeTranslucencyFramebuffer,\n        scene,\n        passState\n      );\n    } else {\n      for (j = 0; j < length; ++j) {\n        executeIdCommand(commands[j], scene, context, passState);\n      }\n    }\n\n    if (clearGlobeDepth) {\n      clearDepth.framebuffer = passState.framebuffer;\n      clearDepth.execute(context, passState);\n      clearDepth.framebuffer = undefined;\n    }\n\n    if (clearGlobeDepth && useDepthPlane) {\n      depthPlane.execute(context, passState);\n    }\n\n    us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE);\n    commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE];\n    length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE];\n    for (j = 0; j < length; ++j) {\n      executeIdCommand(commands[j], scene, context, passState);\n    }\n\n    us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].OPAQUE */ .Z.OPAQUE);\n    commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].OPAQUE */ .Z.OPAQUE];\n    length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].OPAQUE */ .Z.OPAQUE];\n    for (j = 0; j < length; ++j) {\n      executeIdCommand(commands[j], scene, context, passState);\n    }\n\n    us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT);\n    commands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT];\n    length = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT];\n    for (j = 0; j < length; ++j) {\n      executeIdCommand(commands[j], scene, context, passState);\n    }\n\n    passState.framebuffer = originalFramebuffer;\n  }\n}\n\nfunction executeComputeCommands(scene) {\n  var us = scene.context.uniformState;\n  us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].COMPUTE */ .Z.COMPUTE);\n\n  var sunComputeCommand = scene._environmentState.sunComputeCommand;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(sunComputeCommand)) {\n    sunComputeCommand.execute(scene._computeEngine);\n  }\n\n  var commandList = scene._computeCommandList;\n  var length = commandList.length;\n  for (var i = 0; i < length; ++i) {\n    commandList[i].execute(scene._computeEngine);\n  }\n}\n\nfunction executeOverlayCommands(scene, passState) {\n  var us = scene.context.uniformState;\n  us.updatePass(_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].OVERLAY */ .Z.OVERLAY);\n\n  var context = scene.context;\n  var commandList = scene._overlayCommandList;\n  var length = commandList.length;\n  for (var i = 0; i < length; ++i) {\n    commandList[i].execute(context, passState);\n  }\n}\n\nfunction insertShadowCastCommands(scene, commandList, shadowMap) {\n  var shadowVolume = shadowMap.shadowMapCullingVolume;\n  var isPointLight = shadowMap.isPointLight;\n  var passes = shadowMap.passes;\n  var numberOfPasses = passes.length;\n\n  var length = commandList.length;\n  for (var i = 0; i < length; ++i) {\n    var command = commandList[i];\n    scene.updateDerivedCommands(command);\n\n    if (\n      command.castShadows &&\n      (command.pass === _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].GLOBE */ .Z.GLOBE ||\n        command.pass === _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].CESIUM_3D_TILE */ .Z.CESIUM_3D_TILE ||\n        command.pass === _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].OPAQUE */ .Z.OPAQUE ||\n        command.pass === _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT)\n    ) {\n      if (scene.isVisible(command, shadowVolume)) {\n        if (isPointLight) {\n          for (var k = 0; k < numberOfPasses; ++k) {\n            passes[k].commandList.push(command);\n          }\n        } else if (numberOfPasses === 1) {\n          passes[0].commandList.push(command);\n        } else {\n          var wasVisible = false;\n          // Loop over cascades from largest to smallest\n          for (var j = numberOfPasses - 1; j >= 0; --j) {\n            var cascadeVolume = passes[j].cullingVolume;\n            if (scene.isVisible(command, cascadeVolume)) {\n              passes[j].commandList.push(command);\n              wasVisible = true;\n            } else if (wasVisible) {\n              // If it was visible in the previous cascade but now isn\'t\n              // then there is no need to check any more cascades\n              break;\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction executeShadowMapCastCommands(scene) {\n  var frameState = scene.frameState;\n  var shadowMaps = frameState.shadowState.shadowMaps;\n  var shadowMapLength = shadowMaps.length;\n\n  if (!frameState.shadowState.shadowsEnabled) {\n    return;\n  }\n\n  var context = scene.context;\n  var uniformState = context.uniformState;\n\n  for (var i = 0; i < shadowMapLength; ++i) {\n    var shadowMap = shadowMaps[i];\n    if (shadowMap.outOfView) {\n      continue;\n    }\n\n    // Reset the command lists\n    var j;\n    var passes = shadowMap.passes;\n    var numberOfPasses = passes.length;\n    for (j = 0; j < numberOfPasses; ++j) {\n      passes[j].commandList.length = 0;\n    }\n\n    // Insert the primitive/model commands into the command lists\n    var sceneCommands = scene.frameState.commandList;\n    insertShadowCastCommands(scene, sceneCommands, shadowMap);\n\n    for (j = 0; j < numberOfPasses; ++j) {\n      var pass = shadowMap.passes[j];\n      uniformState.updateCamera(pass.camera);\n      shadowMap.updatePass(context, j);\n      var numberOfCommands = pass.commandList.length;\n      for (var k = 0; k < numberOfCommands; ++k) {\n        var command = pass.commandList[k];\n        // Set the correct pass before rendering into the shadow map because some shaders\n        // conditionally render based on whether the pass is translucent or opaque.\n        uniformState.updatePass(command.pass);\n        executeCommand(\n          command.derivedCommands.shadows.castCommands[i],\n          scene,\n          context,\n          pass.passState\n        );\n      }\n    }\n  }\n}\n\nvar scratchEyeTranslation = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\n\n/**\n * @private\n */\nScene.prototype.updateAndExecuteCommands = function (\n  passState,\n  backgroundColor\n) {\n  var frameState = this._frameState;\n  var mode = frameState.mode;\n  var useWebVR = this._environmentState.useWebVR;\n\n  if (useWebVR) {\n    executeWebVRCommands(this, passState, backgroundColor);\n  } else if (\n    mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE2D */ .Z.SCENE2D ||\n    this._mapMode2D === _MapMode2D_js__WEBPACK_IMPORTED_MODULE_51__/* ["default"].ROTATE */ .Z.ROTATE\n  ) {\n    executeCommandsInViewport(true, this, passState, backgroundColor);\n  } else {\n    updateAndClearFramebuffers(this, passState, backgroundColor);\n    execute2DViewportCommands(this, passState);\n  }\n};\n\nfunction executeWebVRCommands(scene, passState, backgroundColor) {\n  var view = scene._view;\n  var camera = view.camera;\n  var environmentState = scene._environmentState;\n  var renderTranslucentDepthForPick =\n    environmentState.renderTranslucentDepthForPick;\n\n  updateAndClearFramebuffers(scene, passState, backgroundColor);\n\n  if (!renderTranslucentDepthForPick) {\n    updateAndRenderPrimitives(scene);\n  }\n\n  view.createPotentiallyVisibleSet(scene);\n\n  if (!renderTranslucentDepthForPick) {\n    executeComputeCommands(scene);\n    executeShadowMapCastCommands(scene);\n  }\n\n  // Based on Calculating Stereo pairs by Paul Bourke\n  // http://paulbourke.net/stereographics/stereorender/\n  var viewport = passState.viewport;\n  viewport.x = 0;\n  viewport.y = 0;\n  viewport.width = viewport.width * 0.5;\n\n  var savedCamera = _Camera_js__WEBPACK_IMPORTED_MODULE_37__/* ["default"].clone */ .Z.clone(camera, scene._cameraVR);\n  savedCamera.frustum = camera.frustum;\n\n  var near = camera.frustum.near;\n  var fo = near * (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(scene.focalLength, 5.0);\n  var eyeSeparation = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(scene.eyeSeparation, fo / 30.0);\n  var eyeTranslation = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n    savedCamera.right,\n    eyeSeparation * 0.5,\n    scratchEyeTranslation\n  );\n\n  camera.frustum.aspectRatio = viewport.width / viewport.height;\n\n  var offset = (0.5 * eyeSeparation * near) / fo;\n\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].add */ .Z.add(savedCamera.position, eyeTranslation, camera.position);\n  camera.frustum.xOffset = offset;\n\n  executeCommands(scene, passState);\n\n  viewport.x = viewport.width;\n\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].subtract */ .Z.subtract(savedCamera.position, eyeTranslation, camera.position);\n  camera.frustum.xOffset = -offset;\n\n  executeCommands(scene, passState);\n\n  _Camera_js__WEBPACK_IMPORTED_MODULE_37__/* ["default"].clone */ .Z.clone(savedCamera, camera);\n}\n\nvar scratch2DViewportCartographic = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(\n  Math.PI,\n  _Core_Math_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].PI_OVER_TWO */ .Z.PI_OVER_TWO\n);\nvar scratch2DViewportMaxCoord = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar scratch2DViewportSavedPosition = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar scratch2DViewportTransform = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"] */ .Z();\nvar scratch2DViewportCameraTransform = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"] */ .Z();\nvar scratch2DViewportEyePoint = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar scratch2DViewportWindowCoords = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar scratch2DViewport = new _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n\nfunction execute2DViewportCommands(scene, passState) {\n  var context = scene.context;\n  var frameState = scene.frameState;\n  var camera = scene.camera;\n\n  var originalViewport = passState.viewport;\n  var viewport = _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(originalViewport, scratch2DViewport);\n  passState.viewport = viewport;\n\n  var maxCartographic = scratch2DViewportCartographic;\n  var maxCoord = scratch2DViewportMaxCoord;\n\n  var projection = scene.mapProjection;\n  projection.project(maxCartographic, maxCoord);\n\n  var position = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(\n    camera.position,\n    scratch2DViewportSavedPosition\n  );\n  var transform = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].clone */ .Z.clone(\n    camera.transform,\n    scratch2DViewportCameraTransform\n  );\n  var frustum = camera.frustum.clone();\n\n  camera._setTransform(_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].IDENTITY */ .Z.IDENTITY);\n\n  var viewportTransformation = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].computeViewportTransformation */ .Z.computeViewportTransformation(\n    viewport,\n    0.0,\n    1.0,\n    scratch2DViewportTransform\n  );\n  var projectionMatrix = camera.frustum.projectionMatrix;\n\n  var x = camera.positionWC.y;\n  var eyePoint = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].fromElements */ .Z.fromElements(\n    _Core_Math_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].sign */ .Z.sign(x) * maxCoord.x - x,\n    0.0,\n    -camera.positionWC.x,\n    scratch2DViewportEyePoint\n  );\n  var windowCoordinates = _Core_Transforms_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].pointToGLWindowCoordinates */ .Z.pointToGLWindowCoordinates(\n    projectionMatrix,\n    viewportTransformation,\n    eyePoint,\n    scratch2DViewportWindowCoords\n  );\n\n  windowCoordinates.x = Math.floor(windowCoordinates.x);\n\n  var viewportX = viewport.x;\n  var viewportWidth = viewport.width;\n\n  if (\n    x === 0.0 ||\n    windowCoordinates.x <= viewportX ||\n    windowCoordinates.x >= viewportX + viewportWidth\n  ) {\n    executeCommandsInViewport(true, scene, passState);\n  } else if (\n    Math.abs(viewportX + viewportWidth * 0.5 - windowCoordinates.x) < 1.0\n  ) {\n    viewport.width = windowCoordinates.x - viewport.x;\n\n    camera.position.x *= _Core_Math_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].sign */ .Z.sign(camera.position.x);\n\n    camera.frustum.right = 0.0;\n\n    frameState.cullingVolume = camera.frustum.computeCullingVolume(\n      camera.positionWC,\n      camera.directionWC,\n      camera.upWC\n    );\n    context.uniformState.update(frameState);\n\n    executeCommandsInViewport(true, scene, passState);\n\n    viewport.x = windowCoordinates.x;\n\n    camera.position.x = -camera.position.x;\n\n    camera.frustum.right = -camera.frustum.left;\n    camera.frustum.left = 0.0;\n\n    frameState.cullingVolume = camera.frustum.computeCullingVolume(\n      camera.positionWC,\n      camera.directionWC,\n      camera.upWC\n    );\n    context.uniformState.update(frameState);\n\n    executeCommandsInViewport(false, scene, passState);\n  } else if (windowCoordinates.x > viewportX + viewportWidth * 0.5) {\n    viewport.width = windowCoordinates.x - viewportX;\n\n    var right = camera.frustum.right;\n    camera.frustum.right = maxCoord.x - x;\n\n    frameState.cullingVolume = camera.frustum.computeCullingVolume(\n      camera.positionWC,\n      camera.directionWC,\n      camera.upWC\n    );\n    context.uniformState.update(frameState);\n\n    executeCommandsInViewport(true, scene, passState);\n\n    viewport.x = windowCoordinates.x;\n    viewport.width = viewportX + viewportWidth - windowCoordinates.x;\n\n    camera.position.x = -camera.position.x;\n\n    camera.frustum.left = -camera.frustum.right;\n    camera.frustum.right = right - camera.frustum.right * 2.0;\n\n    frameState.cullingVolume = camera.frustum.computeCullingVolume(\n      camera.positionWC,\n      camera.directionWC,\n      camera.upWC\n    );\n    context.uniformState.update(frameState);\n\n    executeCommandsInViewport(false, scene, passState);\n  } else {\n    viewport.x = windowCoordinates.x;\n    viewport.width = viewportX + viewportWidth - windowCoordinates.x;\n\n    var left = camera.frustum.left;\n    camera.frustum.left = -maxCoord.x - x;\n\n    frameState.cullingVolume = camera.frustum.computeCullingVolume(\n      camera.positionWC,\n      camera.directionWC,\n      camera.upWC\n    );\n    context.uniformState.update(frameState);\n\n    executeCommandsInViewport(true, scene, passState);\n\n    viewport.x = viewportX;\n    viewport.width = windowCoordinates.x - viewportX;\n\n    camera.position.x = -camera.position.x;\n\n    camera.frustum.right = -camera.frustum.left;\n    camera.frustum.left = left - camera.frustum.left * 2.0;\n\n    frameState.cullingVolume = camera.frustum.computeCullingVolume(\n      camera.positionWC,\n      camera.directionWC,\n      camera.upWC\n    );\n    context.uniformState.update(frameState);\n\n    executeCommandsInViewport(false, scene, passState);\n  }\n\n  camera._setTransform(transform);\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(position, camera.position);\n  camera.frustum = frustum.clone();\n  passState.viewport = originalViewport;\n}\n\nfunction executeCommandsInViewport(\n  firstViewport,\n  scene,\n  passState,\n  backgroundColor\n) {\n  var environmentState = scene._environmentState;\n  var view = scene._view;\n  var renderTranslucentDepthForPick =\n    environmentState.renderTranslucentDepthForPick;\n\n  if (!firstViewport && !renderTranslucentDepthForPick) {\n    scene.frameState.commandList.length = 0;\n  }\n\n  if (!renderTranslucentDepthForPick) {\n    updateAndRenderPrimitives(scene);\n  }\n\n  view.createPotentiallyVisibleSet(scene);\n\n  if (firstViewport) {\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(backgroundColor)) {\n      updateAndClearFramebuffers(scene, passState, backgroundColor);\n    }\n    if (!renderTranslucentDepthForPick) {\n      executeComputeCommands(scene);\n      executeShadowMapCastCommands(scene);\n    }\n  }\n\n  executeCommands(scene, passState);\n}\n\nvar scratchCullingVolume = new _Core_CullingVolume_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z();\n\n/**\n * @private\n */\nScene.prototype.updateEnvironment = function () {\n  var frameState = this._frameState;\n  var view = this._view;\n\n  // Update celestial and terrestrial environment effects.\n  var environmentState = this._environmentState;\n  var renderPass = frameState.passes.render;\n  var offscreenPass = frameState.passes.offscreen;\n  var skyAtmosphere = this.skyAtmosphere;\n  var globe = this.globe;\n  var globeTranslucencyState = this._globeTranslucencyState;\n\n  if (\n    !renderPass ||\n    (this._mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE2D */ .Z.SCENE2D &&\n      view.camera.frustum instanceof _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z) ||\n    !globeTranslucencyState.environmentVisible\n  ) {\n    environmentState.skyAtmosphereCommand = undefined;\n    environmentState.skyBoxCommand = undefined;\n    environmentState.sunDrawCommand = undefined;\n    environmentState.sunComputeCommand = undefined;\n    environmentState.moonCommand = undefined;\n  } else {\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(skyAtmosphere)) {\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globe)) {\n        skyAtmosphere.setDynamicAtmosphereColor(\n          globe.enableLighting && globe.dynamicAtmosphereLighting,\n          globe.dynamicAtmosphereLightingFromSun\n        );\n        environmentState.isReadyForAtmosphere =\n          environmentState.isReadyForAtmosphere ||\n          globe._surface._tilesToRender.length > 0;\n      }\n      environmentState.skyAtmosphereCommand = skyAtmosphere.update(\n        frameState,\n        globe\n      );\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(environmentState.skyAtmosphereCommand)) {\n        this.updateDerivedCommands(environmentState.skyAtmosphereCommand);\n      }\n    } else {\n      environmentState.skyAtmosphereCommand = undefined;\n    }\n\n    environmentState.skyBoxCommand = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this.skyBox)\n      ? this.skyBox.update(frameState, this._hdr)\n      : undefined;\n    var sunCommands = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this.sun)\n      ? this.sun.update(frameState, view.passState, this._hdr)\n      : undefined;\n    environmentState.sunDrawCommand = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(sunCommands)\n      ? sunCommands.drawCommand\n      : undefined;\n    environmentState.sunComputeCommand = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(sunCommands)\n      ? sunCommands.computeCommand\n      : undefined;\n    environmentState.moonCommand = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this.moon)\n      ? this.moon.update(frameState)\n      : undefined;\n  }\n\n  var clearGlobeDepth = (environmentState.clearGlobeDepth =\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globe) &&\n    globe.show &&\n    (!globe.depthTestAgainstTerrain || this.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE2D */ .Z.SCENE2D));\n  var useDepthPlane = (environmentState.useDepthPlane =\n    clearGlobeDepth &&\n    this.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE3D */ .Z.SCENE3D &&\n    globeTranslucencyState.useDepthPlane);\n  if (useDepthPlane) {\n    // Update the depth plane that is rendered in 3D when the primitives are\n    // not depth tested against terrain so primitives on the backface\n    // of the globe are not picked.\n    this._depthPlane.update(frameState);\n  }\n\n  environmentState.renderTranslucentDepthForPick = false;\n  environmentState.useWebVR =\n    this._useWebVR && this.mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE2D */ .Z.SCENE2D && !offscreenPass;\n\n  var occluder =\n    frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE3D */ .Z.SCENE3D &&\n    !globeTranslucencyState.sunVisibleThroughGlobe\n      ? frameState.occluder\n      : undefined;\n  var cullingVolume = frameState.cullingVolume;\n\n  // get user culling volume minus the far plane.\n  var planes = scratchCullingVolume.planes;\n  for (var k = 0; k < 5; ++k) {\n    planes[k] = cullingVolume.planes[k];\n  }\n  cullingVolume = scratchCullingVolume;\n\n  // Determine visibility of celestial and terrestrial environment effects.\n  environmentState.isSkyAtmosphereVisible =\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(environmentState.skyAtmosphereCommand) &&\n    environmentState.isReadyForAtmosphere;\n  environmentState.isSunVisible = this.isVisible(\n    environmentState.sunDrawCommand,\n    cullingVolume,\n    occluder\n  );\n  environmentState.isMoonVisible = this.isVisible(\n    environmentState.moonCommand,\n    cullingVolume,\n    occluder\n  );\n\n  var envMaps = this.specularEnvironmentMaps;\n  var envMapAtlas = this._specularEnvironmentMapAtlas;\n  if (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(envMaps) &&\n    (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(envMapAtlas) || envMapAtlas.url !== envMaps)\n  ) {\n    envMapAtlas = envMapAtlas && envMapAtlas.destroy();\n    this._specularEnvironmentMapAtlas = new _OctahedralProjectedCubeMap_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z(envMaps);\n  } else if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(envMaps) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(envMapAtlas)) {\n    envMapAtlas.destroy();\n    this._specularEnvironmentMapAtlas = undefined;\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this._specularEnvironmentMapAtlas)) {\n    this._specularEnvironmentMapAtlas.update(frameState);\n  }\n};\n\nfunction updateDebugFrustumPlanes(scene) {\n  var frameState = scene._frameState;\n  if (scene.debugShowFrustumPlanes !== scene._debugShowFrustumPlanes) {\n    if (scene.debugShowFrustumPlanes) {\n      scene._debugFrustumPlanes = new _DebugCameraPrimitive_js__WEBPACK_IMPORTED_MODULE_41__/* ["default"] */ .Z({\n        camera: scene.camera,\n        updateOnChange: false,\n        frustumSplits: frameState.frustumSplits,\n      });\n    } else {\n      scene._debugFrustumPlanes =\n        scene._debugFrustumPlanes && scene._debugFrustumPlanes.destroy();\n    }\n    scene._debugShowFrustumPlanes = scene.debugShowFrustumPlanes;\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene._debugFrustumPlanes)) {\n    scene._debugFrustumPlanes.update(frameState);\n  }\n}\n\nfunction updateShadowMaps(scene) {\n  var frameState = scene._frameState;\n  var shadowMaps = frameState.shadowMaps;\n  var length = shadowMaps.length;\n\n  var shadowsEnabled =\n    length > 0 && !frameState.passes.pick && scene.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE3D */ .Z.SCENE3D;\n  if (shadowsEnabled !== frameState.shadowState.shadowsEnabled) {\n    // Update derived commands when shadowsEnabled changes\n    ++frameState.shadowState.lastDirtyTime;\n    frameState.shadowState.shadowsEnabled = shadowsEnabled;\n  }\n\n  frameState.shadowState.lightShadowsEnabled = false;\n\n  if (!shadowsEnabled) {\n    return;\n  }\n\n  // Check if the shadow maps are different than the shadow maps last frame.\n  // If so, the derived commands need to be updated.\n  for (var j = 0; j < length; ++j) {\n    if (shadowMaps[j] !== frameState.shadowState.shadowMaps[j]) {\n      ++frameState.shadowState.lastDirtyTime;\n      break;\n    }\n  }\n\n  frameState.shadowState.shadowMaps.length = 0;\n  frameState.shadowState.lightShadowMaps.length = 0;\n\n  for (var i = 0; i < length; ++i) {\n    var shadowMap = shadowMaps[i];\n    shadowMap.update(frameState);\n\n    frameState.shadowState.shadowMaps.push(shadowMap);\n\n    if (shadowMap.fromLightSource) {\n      frameState.shadowState.lightShadowMaps.push(shadowMap);\n      frameState.shadowState.lightShadowsEnabled = true;\n    }\n\n    if (shadowMap.dirty) {\n      ++frameState.shadowState.lastDirtyTime;\n      shadowMap.dirty = false;\n    }\n  }\n}\n\nfunction updateAndRenderPrimitives(scene) {\n  var frameState = scene._frameState;\n\n  scene._groundPrimitives.update(frameState);\n  scene._primitives.update(frameState);\n\n  updateDebugFrustumPlanes(scene);\n  updateShadowMaps(scene);\n\n  if (scene._globe) {\n    scene._globe.render(frameState);\n  }\n}\n\nfunction updateAndClearFramebuffers(scene, passState, clearColor) {\n  var context = scene._context;\n  var frameState = scene._frameState;\n  var environmentState = scene._environmentState;\n  var view = scene._view;\n\n  var passes = scene._frameState.passes;\n  var picking = passes.pick;\n  var useWebVR = environmentState.useWebVR;\n\n  // Preserve the reference to the original framebuffer.\n  environmentState.originalFramebuffer = passState.framebuffer;\n\n  // Manage sun bloom post-processing effect.\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene.sun) && scene.sunBloom !== scene._sunBloom) {\n    if (scene.sunBloom && !useWebVR) {\n      scene._sunPostProcess = new _SunPostProcess_js__WEBPACK_IMPORTED_MODULE_66__/* ["default"] */ .Z();\n    } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene._sunPostProcess)) {\n      scene._sunPostProcess = scene._sunPostProcess.destroy();\n    }\n\n    scene._sunBloom = scene.sunBloom;\n  } else if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene.sun) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene._sunPostProcess)) {\n    scene._sunPostProcess = scene._sunPostProcess.destroy();\n    scene._sunBloom = false;\n  }\n\n  // Clear the pass state framebuffer.\n  var clear = scene._clearColorCommand;\n  _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].clone */ .Z.clone(clearColor, clear.color);\n  clear.execute(context, passState);\n\n  // Update globe depth rendering based on the current context and clear the globe depth framebuffer.\n  // Globe depth is copied for the pick pass to support picking batched geometries in GroundPrimitives.\n  var useGlobeDepthFramebuffer = (environmentState.useGlobeDepthFramebuffer = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(\n    view.globeDepth\n  ));\n  if (useGlobeDepthFramebuffer) {\n    view.globeDepth.update(\n      context,\n      passState,\n      view.viewport,\n      scene._hdr,\n      environmentState.clearGlobeDepth\n    );\n    view.globeDepth.clear(context, passState, clearColor);\n  }\n\n  // If supported, configure OIT to use the globe depth framebuffer and clear the OIT framebuffer.\n  var oit = view.oit;\n  var useOIT = (environmentState.useOIT =\n    !picking && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(oit) && oit.isSupported());\n  if (useOIT) {\n    oit.update(context, passState, view.globeDepth.framebuffer, scene._hdr);\n    oit.clear(context, passState, clearColor);\n    environmentState.useOIT = oit.isSupported();\n  }\n\n  var postProcess = scene.postProcessStages;\n  var usePostProcess = (environmentState.usePostProcess =\n    !picking &&\n    (scene._hdr ||\n      postProcess.length > 0 ||\n      postProcess.ambientOcclusion.enabled ||\n      postProcess.fxaa.enabled ||\n      postProcess.bloom.enabled));\n  environmentState.usePostProcessSelected = false;\n  if (usePostProcess) {\n    view.sceneFramebuffer.update(context, view.viewport, scene._hdr);\n    view.sceneFramebuffer.clear(context, passState, clearColor);\n\n    postProcess.update(context, frameState.useLogDepth, scene._hdr);\n    postProcess.clear(context);\n\n    usePostProcess = environmentState.usePostProcess = postProcess.ready;\n    environmentState.usePostProcessSelected =\n      usePostProcess && postProcess.hasSelected;\n  }\n\n  if (environmentState.isSunVisible && scene.sunBloom && !useWebVR) {\n    passState.framebuffer = scene._sunPostProcess.update(passState);\n    scene._sunPostProcess.clear(context, passState, clearColor);\n  } else if (useGlobeDepthFramebuffer) {\n    passState.framebuffer = view.globeDepth.framebuffer;\n  } else if (usePostProcess) {\n    passState.framebuffer = view.sceneFramebuffer.getFramebuffer();\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(passState.framebuffer)) {\n    clear.execute(context, passState);\n  }\n\n  var useInvertClassification = (environmentState.useInvertClassification =\n    !picking && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(passState.framebuffer) && scene.invertClassification);\n  if (useInvertClassification) {\n    var depthFramebuffer;\n    if (scene.frameState.invertClassificationColor.alpha === 1.0) {\n      if (environmentState.useGlobeDepthFramebuffer) {\n        depthFramebuffer = view.globeDepth.framebuffer;\n      }\n    }\n\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(depthFramebuffer) || context.depthTexture) {\n      scene._invertClassification.previousFramebuffer = depthFramebuffer;\n      scene._invertClassification.update(context);\n      scene._invertClassification.clear(context, passState);\n\n      if (scene.frameState.invertClassificationColor.alpha < 1.0 && useOIT) {\n        var command = scene._invertClassification.unclassifiedCommand;\n        var derivedCommands = command.derivedCommands;\n        derivedCommands.oit = oit.createDerivedCommands(\n          command,\n          context,\n          derivedCommands.oit\n        );\n      }\n    } else {\n      environmentState.useInvertClassification = false;\n    }\n  }\n\n  if (scene._globeTranslucencyState.translucent) {\n    view.globeTranslucencyFramebuffer.updateAndClear(\n      scene._hdr,\n      view.viewport,\n      context,\n      passState\n    );\n  }\n}\n\n/**\n * @private\n */\nScene.prototype.resolveFramebuffers = function (passState) {\n  var context = this._context;\n  var frameState = this._frameState;\n  var environmentState = this._environmentState;\n  var view = this._view;\n  var globeDepth = view.globeDepth;\n\n  var useOIT = environmentState.useOIT;\n  var useGlobeDepthFramebuffer = environmentState.useGlobeDepthFramebuffer;\n  var usePostProcess = environmentState.usePostProcess;\n\n  var defaultFramebuffer = environmentState.originalFramebuffer;\n  var globeFramebuffer = useGlobeDepthFramebuffer\n    ? globeDepth.framebuffer\n    : undefined;\n  var sceneFramebuffer = view.sceneFramebuffer.getFramebuffer();\n  var idFramebuffer = view.sceneFramebuffer.getIdFramebuffer();\n\n  if (environmentState.separatePrimitiveFramebuffer) {\n    // Merge primitive framebuffer into globe framebuffer\n    globeDepth.executeMergeColor(context, passState);\n  }\n\n  if (useOIT) {\n    passState.framebuffer = usePostProcess\n      ? sceneFramebuffer\n      : defaultFramebuffer;\n    view.oit.execute(context, passState);\n  }\n\n  var translucentTileClassification = view.translucentTileClassification;\n  if (\n    translucentTileClassification.hasTranslucentDepth &&\n    translucentTileClassification.isSupported()\n  ) {\n    translucentTileClassification.execute(this, passState);\n  }\n\n  if (usePostProcess) {\n    var inputFramebuffer = sceneFramebuffer;\n    if (useGlobeDepthFramebuffer && !useOIT) {\n      inputFramebuffer = globeFramebuffer;\n    }\n\n    var postProcess = this.postProcessStages;\n    var colorTexture = inputFramebuffer.getColorTexture(0);\n    var idTexture = idFramebuffer.getColorTexture(0);\n    var depthTexture = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(globeFramebuffer, sceneFramebuffer)\n      .depthStencilTexture;\n    postProcess.execute(context, colorTexture, depthTexture, idTexture);\n    postProcess.copy(context, defaultFramebuffer);\n  }\n\n  if (!useOIT && !usePostProcess && useGlobeDepthFramebuffer) {\n    passState.framebuffer = defaultFramebuffer;\n    globeDepth.executeCopyColor(context, passState);\n  }\n\n  var useLogDepth = frameState.useLogDepth;\n\n  if (this.debugShowGlobeDepth && useGlobeDepthFramebuffer) {\n    var gd = getDebugGlobeDepth(this, this.debugShowDepthFrustum - 1);\n    gd.executeDebugGlobeDepth(context, passState, useLogDepth);\n  }\n\n  if (this.debugShowPickDepth && useGlobeDepthFramebuffer) {\n    var pd = this._picking.getPickDepth(this, this.debugShowDepthFrustum - 1);\n    pd.executeDebugPickDepth(context, passState, useLogDepth);\n  }\n};\n\nfunction callAfterRenderFunctions(scene) {\n  // Functions are queued up during primitive update and executed here in case\n  // the function modifies scene state that should remain constant over the frame.\n  var functions = scene._frameState.afterRender;\n  for (var i = 0, length = functions.length; i < length; ++i) {\n    functions[i]();\n    scene.requestRender();\n  }\n\n  functions.length = 0;\n}\n\nfunction getGlobeHeight(scene) {\n  var globe = scene._globe;\n  var camera = scene.camera;\n  var cartographic = camera.positionCartographic;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globe) && globe.show && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(cartographic)) {\n    return globe.getHeight(cartographic);\n  }\n  return undefined;\n}\n\nfunction isCameraUnderground(scene) {\n  var camera = scene.camera;\n  var mode = scene._mode;\n  var globe = scene.globe;\n  var cameraController = scene._screenSpaceCameraController;\n  var cartographic = camera.positionCartographic;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(cartographic)) {\n    return false;\n  }\n\n  if (!cameraController.onMap() && cartographic.height < 0.0) {\n    // The camera can go off the map while in Columbus View.\n    // Make a best guess as to whether it\'s underground by checking if its height is less than zero.\n    return true;\n  }\n\n  if (\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globe) ||\n    !globe.show ||\n    mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].SCENE2D */ .Z.SCENE2D ||\n    mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].MORPHING */ .Z.MORPHING\n  ) {\n    return false;\n  }\n\n  var globeHeight = scene._globeHeight;\n  return (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globeHeight) && cartographic.height < globeHeight;\n}\n\n/**\n * @private\n */\nScene.prototype.initializeFrame = function () {\n  // Destroy released shaders and textures once every 120 frames to avoid thrashing the cache\n  if (this._shaderFrameCount++ === 120) {\n    this._shaderFrameCount = 0;\n    this._context.shaderCache.destroyReleasedShaderPrograms();\n    this._context.textureCache.destroyReleasedTextures();\n  }\n\n  this._tweens.update();\n\n  this._globeHeight = getGlobeHeight(this);\n  this._cameraUnderground = isCameraUnderground(this);\n  this._globeTranslucencyState.update(this);\n\n  this._screenSpaceCameraController.update();\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this._deviceOrientationCameraController)) {\n    this._deviceOrientationCameraController.update();\n  }\n\n  this.camera.update(this._mode);\n  this.camera._updateCameraChanged();\n};\n\nfunction updateDebugShowFramesPerSecond(scene, renderedThisFrame) {\n  if (scene.debugShowFramesPerSecond) {\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene._performanceDisplay)) {\n      var performanceContainer = document.createElement("div");\n      performanceContainer.className =\n        "cesium-performanceDisplay-defaultContainer";\n      var container = scene._canvas.parentNode;\n      container.appendChild(performanceContainer);\n      var performanceDisplay = new _PerformanceDisplay_js__WEBPACK_IMPORTED_MODULE_53__/* ["default"] */ .Z({\n        container: performanceContainer,\n      });\n      scene._performanceDisplay = performanceDisplay;\n      scene._performanceContainer = performanceContainer;\n    }\n\n    scene._performanceDisplay.throttled = scene.requestRenderMode;\n    scene._performanceDisplay.update(renderedThisFrame);\n  } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene._performanceDisplay)) {\n    scene._performanceDisplay =\n      scene._performanceDisplay && scene._performanceDisplay.destroy();\n    scene._performanceContainer.parentNode.removeChild(\n      scene._performanceContainer\n    );\n  }\n}\n\nfunction prePassesUpdate(scene) {\n  scene._jobScheduler.resetBudgets();\n\n  var frameState = scene._frameState;\n  var primitives = scene.primitives;\n  primitives.prePassesUpdate(frameState);\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene.globe)) {\n    scene.globe.update(frameState);\n  }\n\n  scene._picking.update();\n  frameState.creditDisplay.update();\n}\n\nfunction postPassesUpdate(scene) {\n  var frameState = scene._frameState;\n  var primitives = scene.primitives;\n  primitives.postPassesUpdate(frameState);\n\n  _Core_RequestScheduler_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"].update */ .Z.update();\n}\n\nvar scratchBackgroundColor = new _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z();\n\nfunction render(scene) {\n  var frameState = scene._frameState;\n\n  var context = scene.context;\n  var us = context.uniformState;\n\n  var view = scene._defaultView;\n  scene._view = view;\n\n  scene.updateFrameState();\n  frameState.passes.render = true;\n  frameState.passes.postProcess = scene.postProcessStages.hasSelected;\n  frameState.tilesetPassState = renderTilesetPassState;\n\n  var backgroundColor = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(scene.backgroundColor, _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].BLACK */ .Z.BLACK);\n  if (scene._hdr) {\n    backgroundColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].clone */ .Z.clone(backgroundColor, scratchBackgroundColor);\n    backgroundColor.red = Math.pow(backgroundColor.red, scene.gamma);\n    backgroundColor.green = Math.pow(backgroundColor.green, scene.gamma);\n    backgroundColor.blue = Math.pow(backgroundColor.blue, scene.gamma);\n  }\n  frameState.backgroundColor = backgroundColor;\n\n  scene.fog.update(frameState);\n\n  us.update(frameState);\n\n  var shadowMap = scene.shadowMap;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(shadowMap) && shadowMap.enabled) {\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene.light) || scene.light instanceof _SunLight_js__WEBPACK_IMPORTED_MODULE_65__/* ["default"] */ .Z) {\n      // Negate the sun direction so that it is from the Sun, not to the Sun\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].negate */ .Z.negate(us.sunDirectionWC, scene._shadowMapCamera.direction);\n    } else {\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(scene.light.direction, scene._shadowMapCamera.direction);\n    }\n    frameState.shadowMaps.push(shadowMap);\n  }\n\n  scene._computeCommandList.length = 0;\n  scene._overlayCommandList.length = 0;\n\n  var viewport = view.viewport;\n  viewport.x = 0;\n  viewport.y = 0;\n  viewport.width = context.drawingBufferWidth;\n  viewport.height = context.drawingBufferHeight;\n\n  var passState = view.passState;\n  passState.framebuffer = undefined;\n  passState.blendingEnabled = undefined;\n  passState.scissorTest = undefined;\n  passState.viewport = _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(viewport, passState.viewport);\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene.globe)) {\n    scene.globe.beginFrame(frameState);\n  }\n\n  scene.updateEnvironment();\n  scene.updateAndExecuteCommands(passState, backgroundColor);\n  scene.resolveFramebuffers(passState);\n\n  passState.framebuffer = undefined;\n  executeOverlayCommands(scene, passState);\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(scene.globe)) {\n    scene.globe.endFrame(frameState);\n\n    if (!scene.globe.tilesLoaded) {\n      scene._renderRequested = true;\n    }\n  }\n\n  context.endFrame();\n}\n\nfunction tryAndCatchError(scene, functionToExecute) {\n  try {\n    functionToExecute(scene);\n  } catch (error) {\n    scene._renderError.raiseEvent(scene, error);\n\n    if (scene.rethrowRenderErrors) {\n      throw error;\n    }\n  }\n}\n\nfunction updateMostDetailedRayPicks(scene) {\n  return scene._picking.updateMostDetailedRayPicks(scene);\n}\n\n/**\n * Update and render the scene. It is usually not necessary to call this function\n * directly because {@link CesiumWidget} or {@link Viewer} do it automatically.\n * @param {JulianDate} [time] The simulation time at which to render.\n */\nScene.prototype.render = function (time) {\n  /**\n   *\n   * Pre passes update. Execute any pass invariant code that should run before the passes here.\n   *\n   */\n  this._preUpdate.raiseEvent(this, time);\n\n  var frameState = this._frameState;\n  frameState.newFrame = false;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(time)) {\n    time = _Core_JulianDate_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].now */ .Z.now();\n  }\n\n  // Determine if shouldRender\n  var cameraChanged = this._view.checkForCameraUpdates(this);\n  var shouldRender =\n    !this.requestRenderMode ||\n    this._renderRequested ||\n    cameraChanged ||\n    this._logDepthBufferDirty ||\n    this._hdrDirty ||\n    this.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_59__/* ["default"].MORPHING */ .Z.MORPHING;\n  if (\n    !shouldRender &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this.maximumRenderTimeChange) &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this._lastRenderTime)\n  ) {\n    var difference = Math.abs(\n      _Core_JulianDate_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].secondsDifference */ .Z.secondsDifference(this._lastRenderTime, time)\n    );\n    shouldRender = shouldRender || difference > this.maximumRenderTimeChange;\n  }\n\n  if (shouldRender) {\n    this._lastRenderTime = _Core_JulianDate_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].clone */ .Z.clone(time, this._lastRenderTime);\n    this._renderRequested = false;\n    this._logDepthBufferDirty = false;\n    this._hdrDirty = false;\n\n    var frameNumber = _Core_Math_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].incrementWrap */ .Z.incrementWrap(\n      frameState.frameNumber,\n      15000000.0,\n      1.0\n    );\n    updateFrameNumber(this, frameNumber, time);\n    frameState.newFrame = true;\n  }\n\n  tryAndCatchError(this, prePassesUpdate);\n\n  /**\n   *\n   * Passes update. Add any passes here\n   *\n   */\n  if (this.primitives.show) {\n    tryAndCatchError(this, updateMostDetailedRayPicks);\n    tryAndCatchError(this, updatePreloadPass);\n    tryAndCatchError(this, updatePreloadFlightPass);\n    if (!shouldRender) {\n      tryAndCatchError(this, updateRequestRenderModeDeferCheckPass);\n    }\n  }\n\n  this._postUpdate.raiseEvent(this, time);\n\n  if (shouldRender) {\n    this._preRender.raiseEvent(this, time);\n    frameState.creditDisplay.beginFrame();\n    tryAndCatchError(this, render);\n  }\n\n  /**\n   *\n   * Post passes update. Execute any pass invariant code that should run after the passes here.\n   *\n   */\n  updateDebugShowFramesPerSecond(this, shouldRender);\n  tryAndCatchError(this, postPassesUpdate);\n\n  // Often used to trigger events (so don\'t want in trycatch) that the user might be subscribed to. Things like the tile load events, ready promises, etc.\n  // We don\'t want those events to resolve during the render loop because the events might add new primitives\n  callAfterRenderFunctions(this);\n\n  if (shouldRender) {\n    this._postRender.raiseEvent(this, time);\n    frameState.creditDisplay.endFrame();\n  }\n};\n\n/**\n * Update and render the scene. Always forces a new render frame regardless of whether a render was\n * previously requested.\n * @param {JulianDate} [time] The simulation time at which to render.\n *\n * @private\n */\nScene.prototype.forceRender = function (time) {\n  this._renderRequested = true;\n  this.render(time);\n};\n\n/**\n * Requests a new rendered frame when {@link Scene#requestRenderMode} is set to <code>true</code>.\n * The render rate will not exceed the {@link CesiumWidget#targetFrameRate}.\n *\n * @see Scene#requestRenderMode\n */\nScene.prototype.requestRender = function () {\n  this._renderRequested = true;\n};\n\n/**\n * @private\n */\nScene.prototype.clampLineWidth = function (width) {\n  return Math.max(\n    _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"].minimumAliasedLineWidth */ .Z.minimumAliasedLineWidth,\n    Math.min(width, _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"].maximumAliasedLineWidth */ .Z.maximumAliasedLineWidth)\n  );\n};\n\n/**\n * Returns an object with a `primitive` property that contains the first (top) primitive in the scene\n * at a particular window coordinate or undefined if nothing is at the location. Other properties may\n * potentially be set depending on the type of primitive and may be used to further identify the picked object.\n * <p>\n * When a feature of a 3D Tiles tileset is picked, <code>pick</code> returns a {@link Cesium3DTileFeature} object.\n * </p>\n *\n * @example\n * // On mouse over, color the feature yellow.\n * handler.setInputAction(function(movement) {\n *     var feature = scene.pick(movement.endPosition);\n *     if (feature instanceof Cesium.Cesium3DTileFeature) {\n *         feature.color = Cesium.Color.YELLOW;\n *     }\n * }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\n *\n * @param {Cartesian2} windowPosition Window coordinates to perform picking on.\n * @param {Number} [width=3] Width of the pick rectangle.\n * @param {Number} [height=3] Height of the pick rectangle.\n * @returns {Object} Object containing the picked primitive.\n */\nScene.prototype.pick = function (windowPosition, width, height) {\n  return this._picking.pick(this, windowPosition, width, height);\n};\n\n/**\n * Returns the cartesian position reconstructed from the depth buffer and window position.\n * The returned position is in world coordinates. Used internally by camera functions to\n * prevent conversion to projected 2D coordinates and then back.\n * <p>\n * Set {@link Scene#pickTranslucentDepth} to <code>true</code> to include the depth of\n * translucent primitives; otherwise, this essentially picks through translucent primitives.\n * </p>\n *\n * @private\n *\n * @param {Cartesian2} windowPosition Window coordinates to perform picking on.\n * @param {Cartesian3} [result] The object on which to restore the result.\n * @returns {Cartesian3} The cartesian position in world coordinates.\n *\n * @exception {DeveloperError} Picking from the depth buffer is not supported. Check pickPositionSupported.\n */\nScene.prototype.pickPositionWorldCoordinates = function (\n  windowPosition,\n  result\n) {\n  return this._picking.pickPositionWorldCoordinates(\n    this,\n    windowPosition,\n    result\n  );\n};\n\n/**\n * Returns the cartesian position reconstructed from the depth buffer and window position.\n * <p>\n * The position reconstructed from the depth buffer in 2D may be slightly different from those\n * reconstructed in 3D and Columbus view. This is caused by the difference in the distribution\n * of depth values of perspective and orthographic projection.\n * </p>\n * <p>\n * Set {@link Scene#pickTranslucentDepth} to <code>true</code> to include the depth of\n * translucent primitives; otherwise, this essentially picks through translucent primitives.\n * </p>\n *\n * @param {Cartesian2} windowPosition Window coordinates to perform picking on.\n * @param {Cartesian3} [result] The object on which to restore the result.\n * @returns {Cartesian3} The cartesian position.\n *\n * @exception {DeveloperError} Picking from the depth buffer is not supported. Check pickPositionSupported.\n */\nScene.prototype.pickPosition = function (windowPosition, result) {\n  return this._picking.pickPosition(this, windowPosition, result);\n};\n\n/**\n * Returns a list of objects, each containing a `primitive` property, for all primitives at\n * a particular window coordinate position. Other properties may also be set depending on the\n * type of primitive and may be used to further identify the picked object. The primitives in\n * the list are ordered by their visual order in the scene (front to back).\n *\n * @param {Cartesian2} windowPosition Window coordinates to perform picking on.\n * @param {Number} [limit] If supplied, stop drilling after collecting this many picks.\n * @param {Number} [width=3] Width of the pick rectangle.\n * @param {Number} [height=3] Height of the pick rectangle.\n * @returns {Array.<*>} Array of objects, each containing 1 picked primitives.\n *\n * @exception {DeveloperError} windowPosition is undefined.\n *\n * @example\n * var pickedObjects = scene.drillPick(new Cesium.Cartesian2(100.0, 200.0));\n *\n * @see Scene#pick\n */\nScene.prototype.drillPick = function (windowPosition, limit, width, height) {\n  return this._picking.drillPick(this, windowPosition, limit, width, height);\n};\n\nfunction updatePreloadPass(scene) {\n  var frameState = scene._frameState;\n  preloadTilesetPassState.camera = frameState.camera;\n  preloadTilesetPassState.cullingVolume = frameState.cullingVolume;\n\n  var primitives = scene.primitives;\n  primitives.updateForPass(frameState, preloadTilesetPassState);\n}\n\nfunction updatePreloadFlightPass(scene) {\n  var frameState = scene._frameState;\n  var camera = frameState.camera;\n  if (!camera.canPreloadFlight()) {\n    return;\n  }\n\n  preloadFlightTilesetPassState.camera = scene.preloadFlightCamera;\n  preloadFlightTilesetPassState.cullingVolume =\n    scene.preloadFlightCullingVolume;\n\n  var primitives = scene.primitives;\n  primitives.updateForPass(frameState, preloadFlightTilesetPassState);\n}\n\nfunction updateRequestRenderModeDeferCheckPass(scene) {\n  // Check if any ignored requests are ready to go (to wake rendering up again)\n  scene.primitives.updateForPass(\n    scene._frameState,\n    requestRenderModeDeferCheckPassState\n  );\n}\n\n/**\n * Returns an object containing the first object intersected by the ray and the position of intersection,\n * or <code>undefined</code> if there were no intersections. The intersected object has a <code>primitive</code>\n * property that contains the intersected primitive. Other properties may be set depending on the type of primitive\n * and may be used to further identify the picked object. The ray must be given in world coordinates.\n * <p>\n * This function only picks globe tiles and 3D Tiles that are rendered in the current view. Picks all other\n * primitives regardless of their visibility.\n * </p>\n *\n * @private\n *\n * @param {Ray} ray The ray.\n * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to exclude from the ray intersection.\n * @param {Number} [width=0.1] Width of the intersection volume in meters.\n * @returns {Object} An object containing the object and position of the first intersection.\n *\n * @exception {DeveloperError} Ray intersections are only supported in 3D mode.\n */\nScene.prototype.pickFromRay = function (ray, objectsToExclude, width) {\n  return this._picking.pickFromRay(this, ray, objectsToExclude, width);\n};\n\n/**\n * Returns a list of objects, each containing the object intersected by the ray and the position of intersection.\n * The intersected object has a <code>primitive</code> property that contains the intersected primitive. Other\n * properties may also be set depending on the type of primitive and may be used to further identify the picked object.\n * The primitives in the list are ordered by first intersection to last intersection. The ray must be given in\n * world coordinates.\n * <p>\n * This function only picks globe tiles and 3D Tiles that are rendered in the current view. Picks all other\n * primitives regardless of their visibility.\n * </p>\n *\n * @private\n *\n * @param {Ray} ray The ray.\n * @param {Number} [limit=Number.MAX_VALUE] If supplied, stop finding intersections after this many intersections.\n * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to exclude from the ray intersection.\n * @param {Number} [width=0.1] Width of the intersection volume in meters.\n * @returns {Object[]} List of objects containing the object and position of each intersection.\n *\n * @exception {DeveloperError} Ray intersections are only supported in 3D mode.\n */\nScene.prototype.drillPickFromRay = function (\n  ray,\n  limit,\n  objectsToExclude,\n  width\n) {\n  return this._picking.drillPickFromRay(\n    this,\n    ray,\n    limit,\n    objectsToExclude,\n    width\n  );\n};\n\n/**\n * Initiates an asynchronous {@link Scene#pickFromRay} request using the maximum level of detail for 3D Tilesets\n * regardless of visibility.\n *\n * @private\n *\n * @param {Ray} ray The ray.\n * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to exclude from the ray intersection.\n * @param {Number} [width=0.1] Width of the intersection volume in meters.\n * @returns {Promise.<Object>} A promise that resolves to an object containing the object and position of the first intersection.\n *\n * @exception {DeveloperError} Ray intersections are only supported in 3D mode.\n */\nScene.prototype.pickFromRayMostDetailed = function (\n  ray,\n  objectsToExclude,\n  width\n) {\n  return this._picking.pickFromRayMostDetailed(\n    this,\n    ray,\n    objectsToExclude,\n    width\n  );\n};\n\n/**\n * Initiates an asynchronous {@link Scene#drillPickFromRay} request using the maximum level of detail for 3D Tilesets\n * regardless of visibility.\n *\n * @private\n *\n * @param {Ray} ray The ray.\n * @param {Number} [limit=Number.MAX_VALUE] If supplied, stop finding intersections after this many intersections.\n * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to exclude from the ray intersection.\n * @param {Number} [width=0.1] Width of the intersection volume in meters.\n * @returns {Promise.<Object[]>} A promise that resolves to a list of objects containing the object and position of each intersection.\n *\n * @exception {DeveloperError} Ray intersections are only supported in 3D mode.\n */\nScene.prototype.drillPickFromRayMostDetailed = function (\n  ray,\n  limit,\n  objectsToExclude,\n  width\n) {\n  return this._picking.drillPickFromRayMostDetailed(\n    this,\n    ray,\n    limit,\n    objectsToExclude,\n    width\n  );\n};\n\n/**\n * Returns the height of scene geometry at the given cartographic position or <code>undefined</code> if there was no\n * scene geometry to sample height from. The height of the input position is ignored. May be used to clamp objects to\n * the globe, 3D Tiles, or primitives in the scene.\n * <p>\n * This function only samples height from globe tiles and 3D Tiles that are rendered in the current view. Samples height\n * from all other primitives regardless of their visibility.\n * </p>\n *\n * @param {Cartographic} position The cartographic position to sample height from.\n * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to not sample height from.\n * @param {Number} [width=0.1] Width of the intersection volume in meters.\n * @returns {Number} The height. This may be <code>undefined</code> if there was no scene geometry to sample height from.\n *\n * @example\n * var position = new Cesium.Cartographic(-1.31968, 0.698874);\n * var height = viewer.scene.sampleHeight(position);\n * console.log(height);\n *\n * @see Scene#clampToHeight\n * @see Scene#clampToHeightMostDetailed\n * @see Scene#sampleHeightMostDetailed\n *\n * @exception {DeveloperError} sampleHeight is only supported in 3D mode.\n * @exception {DeveloperError} sampleHeight requires depth texture support. Check sampleHeightSupported.\n */\nScene.prototype.sampleHeight = function (position, objectsToExclude, width) {\n  return this._picking.sampleHeight(this, position, objectsToExclude, width);\n};\n\n/**\n * Clamps the given cartesian position to the scene geometry along the geodetic surface normal. Returns the\n * clamped position or <code>undefined</code> if there was no scene geometry to clamp to. May be used to clamp\n * objects to the globe, 3D Tiles, or primitives in the scene.\n * <p>\n * This function only clamps to globe tiles and 3D Tiles that are rendered in the current view. Clamps to\n * all other primitives regardless of their visibility.\n * </p>\n *\n * @param {Cartesian3} cartesian The cartesian position.\n * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to not clamp to.\n * @param {Number} [width=0.1] Width of the intersection volume in meters.\n * @param {Cartesian3} [result] An optional object to return the clamped position.\n * @returns {Cartesian3} The modified result parameter or a new Cartesian3 instance if one was not provided. This may be <code>undefined</code> if there was no scene geometry to clamp to.\n *\n * @example\n * // Clamp an entity to the underlying scene geometry\n * var position = entity.position.getValue(Cesium.JulianDate.now());\n * entity.position = viewer.scene.clampToHeight(position);\n *\n * @see Scene#sampleHeight\n * @see Scene#sampleHeightMostDetailed\n * @see Scene#clampToHeightMostDetailed\n *\n * @exception {DeveloperError} clampToHeight is only supported in 3D mode.\n * @exception {DeveloperError} clampToHeight requires depth texture support. Check clampToHeightSupported.\n */\nScene.prototype.clampToHeight = function (\n  cartesian,\n  objectsToExclude,\n  width,\n  result\n) {\n  return this._picking.clampToHeight(\n    this,\n    cartesian,\n    objectsToExclude,\n    width,\n    result\n  );\n};\n\n/**\n * Initiates an asynchronous {@link Scene#sampleHeight} query for an array of {@link Cartographic} positions\n * using the maximum level of detail for 3D Tilesets in the scene. The height of the input positions is ignored.\n * Returns a promise that is resolved when the query completes. Each point height is modified in place.\n * If a height cannot be determined because no geometry can be sampled at that location, or another error occurs,\n * the height is set to undefined.\n *\n * @param {Cartographic[]} positions The cartographic positions to update with sampled heights.\n * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to not sample height from.\n * @param {Number} [width=0.1] Width of the intersection volume in meters.\n * @returns {Promise.<Cartographic[]>} A promise that resolves to the provided list of positions when the query has completed.\n *\n * @example\n * var positions = [\n *     new Cesium.Cartographic(-1.31968, 0.69887),\n *     new Cesium.Cartographic(-1.10489, 0.83923)\n * ];\n * var promise = viewer.scene.sampleHeightMostDetailed(positions);\n * promise.then(function(updatedPosition) {\n *     // positions[0].height and positions[1].height have been updated.\n *     // updatedPositions is just a reference to positions.\n * }\n *\n * @see Scene#sampleHeight\n *\n * @exception {DeveloperError} sampleHeightMostDetailed is only supported in 3D mode.\n * @exception {DeveloperError} sampleHeightMostDetailed requires depth texture support. Check sampleHeightSupported.\n */\nScene.prototype.sampleHeightMostDetailed = function (\n  positions,\n  objectsToExclude,\n  width\n) {\n  return this._picking.sampleHeightMostDetailed(\n    this,\n    positions,\n    objectsToExclude,\n    width\n  );\n};\n\n/**\n * Initiates an asynchronous {@link Scene#clampToHeight} query for an array of {@link Cartesian3} positions\n * using the maximum level of detail for 3D Tilesets in the scene. Returns a promise that is resolved when\n * the query completes. Each position is modified in place. If a position cannot be clamped because no geometry\n * can be sampled at that location, or another error occurs, the element in the array is set to undefined.\n *\n * @param {Cartesian3[]} cartesians The cartesian positions to update with clamped positions.\n * @param {Object[]} [objectsToExclude] A list of primitives, entities, or 3D Tiles features to not clamp to.\n * @param {Number} [width=0.1] Width of the intersection volume in meters.\n * @returns {Promise.<Cartesian3[]>} A promise that resolves to the provided list of positions when the query has completed.\n *\n * @example\n * var cartesians = [\n *     entities[0].position.getValue(Cesium.JulianDate.now()),\n *     entities[1].position.getValue(Cesium.JulianDate.now())\n * ];\n * var promise = viewer.scene.clampToHeightMostDetailed(cartesians);\n * promise.then(function(updatedCartesians) {\n *     entities[0].position = updatedCartesians[0];\n *     entities[1].position = updatedCartesians[1];\n * }\n *\n * @see Scene#clampToHeight\n *\n * @exception {DeveloperError} clampToHeightMostDetailed is only supported in 3D mode.\n * @exception {DeveloperError} clampToHeightMostDetailed requires depth texture support. Check clampToHeightSupported.\n */\nScene.prototype.clampToHeightMostDetailed = function (\n  cartesians,\n  objectsToExclude,\n  width\n) {\n  return this._picking.clampToHeightMostDetailed(\n    this,\n    cartesians,\n    objectsToExclude,\n    width\n  );\n};\n\n/**\n * Transforms a position in cartesian coordinates to canvas coordinates.  This is commonly used to place an\n * HTML element at the same screen position as an object in the scene.\n *\n * @param {Cartesian3} position The position in cartesian coordinates.\n * @param {Cartesian2} [result] An optional object to return the input position transformed to canvas coordinates.\n * @returns {Cartesian2} The modified result parameter or a new Cartesian2 instance if one was not provided.  This may be <code>undefined</code> if the input position is near the center of the ellipsoid.\n *\n * @example\n * // Output the canvas position of longitude/latitude (0, 0) every time the mouse moves.\n * var scene = widget.scene;\n * var ellipsoid = scene.globe.ellipsoid;\n * var position = Cesium.Cartesian3.fromDegrees(0.0, 0.0);\n * var handler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\n * handler.setInputAction(function(movement) {\n *     console.log(scene.cartesianToCanvasCoordinates(position));\n * }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\n */\nScene.prototype.cartesianToCanvasCoordinates = function (position, result) {\n  return _SceneTransforms_js__WEBPACK_IMPORTED_MODULE_60__/* ["default"].wgs84ToWindowCoordinates */ .Z.wgs84ToWindowCoordinates(this, position, result);\n};\n\n/**\n * Instantly completes an active transition.\n */\nScene.prototype.completeMorph = function () {\n  this._transitioner.completeMorph();\n};\n\n/**\n * Asynchronously transitions the scene to 2D.\n * @param {Number} [duration=2.0] The amount of time, in seconds, for transition animations to complete.\n */\nScene.prototype.morphTo2D = function (duration) {\n  var ellipsoid;\n  var globe = this.globe;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globe)) {\n    ellipsoid = globe.ellipsoid;\n  } else {\n    ellipsoid = this.mapProjection.ellipsoid;\n  }\n  duration = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(duration, 2.0);\n  this._transitioner.morphTo2D(duration, ellipsoid);\n};\n\n/**\n * Asynchronously transitions the scene to Columbus View.\n * @param {Number} [duration=2.0] The amount of time, in seconds, for transition animations to complete.\n */\nScene.prototype.morphToColumbusView = function (duration) {\n  var ellipsoid;\n  var globe = this.globe;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globe)) {\n    ellipsoid = globe.ellipsoid;\n  } else {\n    ellipsoid = this.mapProjection.ellipsoid;\n  }\n  duration = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(duration, 2.0);\n  this._transitioner.morphToColumbusView(duration, ellipsoid);\n};\n\n/**\n * Asynchronously transitions the scene to 3D.\n * @param {Number} [duration=2.0] The amount of time, in seconds, for transition animations to complete.\n */\nScene.prototype.morphTo3D = function (duration) {\n  var ellipsoid;\n  var globe = this.globe;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(globe)) {\n    ellipsoid = globe.ellipsoid;\n  } else {\n    ellipsoid = this.mapProjection.ellipsoid;\n  }\n  duration = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(duration, 2.0);\n  this._transitioner.morphTo3D(duration, ellipsoid);\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <br /><br />\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n *\n * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n *\n * @see Scene#destroy\n */\nScene.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n * <br /><br />\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * scene = scene && scene.destroy();\n *\n * @see Scene#isDestroyed\n */\nScene.prototype.destroy = function () {\n  this._tweens.removeAll();\n  this._computeEngine = this._computeEngine && this._computeEngine.destroy();\n  this._screenSpaceCameraController =\n    this._screenSpaceCameraController &&\n    this._screenSpaceCameraController.destroy();\n  this._deviceOrientationCameraController =\n    this._deviceOrientationCameraController &&\n    !this._deviceOrientationCameraController.isDestroyed() &&\n    this._deviceOrientationCameraController.destroy();\n  this._primitives = this._primitives && this._primitives.destroy();\n  this._groundPrimitives =\n    this._groundPrimitives && this._groundPrimitives.destroy();\n  this._globe = this._globe && this._globe.destroy();\n  this.skyBox = this.skyBox && this.skyBox.destroy();\n  this.skyAtmosphere = this.skyAtmosphere && this.skyAtmosphere.destroy();\n  this._debugSphere = this._debugSphere && this._debugSphere.destroy();\n  this.sun = this.sun && this.sun.destroy();\n  this._sunPostProcess = this._sunPostProcess && this._sunPostProcess.destroy();\n  this._depthPlane = this._depthPlane && this._depthPlane.destroy();\n  this._transitioner = this._transitioner && this._transitioner.destroy();\n  this._debugFrustumPlanes =\n    this._debugFrustumPlanes && this._debugFrustumPlanes.destroy();\n  this._brdfLutGenerator =\n    this._brdfLutGenerator && this._brdfLutGenerator.destroy();\n  this._picking = this._picking && this._picking.destroy();\n\n  this._defaultView = this._defaultView && this._defaultView.destroy();\n  this._view = undefined;\n\n  if (this._removeCreditContainer) {\n    this._canvas.parentNode.removeChild(this._creditContainer);\n  }\n\n  this.postProcessStages =\n    this.postProcessStages && this.postProcessStages.destroy();\n\n  this._context = this._context && this._context.destroy();\n  this._frameState.creditDisplay =\n    this._frameState.creditDisplay && this._frameState.creditDisplay.destroy();\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_70__/* ["default"] */ .Z)(this._performanceDisplay)) {\n    this._performanceDisplay =\n      this._performanceDisplay && this._performanceDisplay.destroy();\n    this._performanceContainer.parentNode.removeChild(\n      this._performanceContainer\n    );\n  }\n\n  this._removeRequestListenerCallback();\n  this._removeTaskProcessorListenerCallback();\n  for (var i = 0; i < this._removeGlobeCallbacks.length; ++i) {\n    this._removeGlobeCallbacks[i]();\n  }\n  this._removeGlobeCallbacks.length = 0;\n\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(this);\n};\n/* harmony default export */ __webpack_exports__["Z"] = (Scene);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsd0dBQXNDO0FBQ25ELEtBQUs7QUFDTCxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLO0FBQ0wsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHOztB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNLHNFQUFPO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrQkFBa0IsdUNBQXVDO0FBQ3pEO0FBQ0E7QUFDQTs7QUFFQSxTQUFTLDRFQUFhO0FBQ3RCO0FBQ0EseURBQWUsS0FBSyxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdnVlMy13ZWJwYWNrNS8uL25vZGVfbW9kdWxlcy9jZXNpdW0vU291cmNlL1NjZW5lL1NjZW5lLmpzP2EyMjQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJvdW5kaW5nUmVjdGFuZ2xlIGZyb20gXCIuLi9Db3JlL0JvdW5kaW5nUmVjdGFuZ2xlLmpzXCI7XG5pbXBvcnQgQm91bmRpbmdTcGhlcmUgZnJvbSBcIi4uL0NvcmUvQm91bmRpbmdTcGhlcmUuanNcIjtcbmltcG9ydCBCb3hHZW9tZXRyeSBmcm9tIFwiLi4vQ29yZS9Cb3hHZW9tZXRyeS5qc1wiO1xuaW1wb3J0IENhcnRlc2lhbjMgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuMy5qc1wiO1xuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwiLi4vQ29yZS9DYXJ0b2dyYXBoaWMuanNcIjtcbmltcG9ydCBjbG9uZSBmcm9tIFwiLi4vQ29yZS9jbG9uZS5qc1wiO1xuaW1wb3J0IENvbG9yIGZyb20gXCIuLi9Db3JlL0NvbG9yLmpzXCI7XG5pbXBvcnQgQ29sb3JHZW9tZXRyeUluc3RhbmNlQXR0cmlidXRlIGZyb20gXCIuLi9Db3JlL0NvbG9yR2VvbWV0cnlJbnN0YW5jZUF0dHJpYnV0ZS5qc1wiO1xuaW1wb3J0IGNyZWF0ZUd1aWQgZnJvbSBcIi4uL0NvcmUvY3JlYXRlR3VpZC5qc1wiO1xuaW1wb3J0IEN1bGxpbmdWb2x1bWUgZnJvbSBcIi4uL0NvcmUvQ3VsbGluZ1ZvbHVtZS5qc1wiO1xuaW1wb3J0IGRlZmF1bHRWYWx1ZSBmcm9tIFwiLi4vQ29yZS9kZWZhdWx0VmFsdWUuanNcIjtcbmltcG9ydCBkZWZpbmVkIGZyb20gXCIuLi9Db3JlL2RlZmluZWQuanNcIjtcbmltcG9ydCBkZXN0cm95T2JqZWN0IGZyb20gXCIuLi9Db3JlL2Rlc3Ryb3lPYmplY3QuanNcIjtcbmltcG9ydCBEZXZlbG9wZXJFcnJvciBmcm9tIFwiLi4vQ29yZS9EZXZlbG9wZXJFcnJvci5qc1wiO1xuaW1wb3J0IEVsbGlwc29pZEdlb21ldHJ5IGZyb20gXCIuLi9Db3JlL0VsbGlwc29pZEdlb21ldHJ5LmpzXCI7XG5pbXBvcnQgRXZlbnQgZnJvbSBcIi4uL0NvcmUvRXZlbnQuanNcIjtcbmltcG9ydCBHZW9ncmFwaGljUHJvamVjdGlvbiBmcm9tIFwiLi4vQ29yZS9HZW9ncmFwaGljUHJvamVjdGlvbi5qc1wiO1xuaW1wb3J0IEdlb21ldHJ5SW5zdGFuY2UgZnJvbSBcIi4uL0NvcmUvR2VvbWV0cnlJbnN0YW5jZS5qc1wiO1xuaW1wb3J0IEdlb21ldHJ5UGlwZWxpbmUgZnJvbSBcIi4uL0NvcmUvR2VvbWV0cnlQaXBlbGluZS5qc1wiO1xuaW1wb3J0IEludGVyc2VjdCBmcm9tIFwiLi4vQ29yZS9JbnRlcnNlY3QuanNcIjtcbmltcG9ydCBKdWxpYW5EYXRlIGZyb20gXCIuLi9Db3JlL0p1bGlhbkRhdGUuanNcIjtcbmltcG9ydCBDZXNpdW1NYXRoIGZyb20gXCIuLi9Db3JlL01hdGguanNcIjtcbmltcG9ydCBNYXRyaXg0IGZyb20gXCIuLi9Db3JlL01hdHJpeDQuanNcIjtcbmltcG9ydCBtZXJnZVNvcnQgZnJvbSBcIi4uL0NvcmUvbWVyZ2VTb3J0LmpzXCI7XG5pbXBvcnQgT2NjbHVkZXIgZnJvbSBcIi4uL0NvcmUvT2NjbHVkZXIuanNcIjtcbmltcG9ydCBPcnRob2dyYXBoaWNGcnVzdHVtIGZyb20gXCIuLi9Db3JlL09ydGhvZ3JhcGhpY0ZydXN0dW0uanNcIjtcbmltcG9ydCBPcnRob2dyYXBoaWNPZmZDZW50ZXJGcnVzdHVtIGZyb20gXCIuLi9Db3JlL09ydGhvZ3JhcGhpY09mZkNlbnRlckZydXN0dW0uanNcIjtcbmltcG9ydCBQZXJzcGVjdGl2ZUZydXN0dW0gZnJvbSBcIi4uL0NvcmUvUGVyc3BlY3RpdmVGcnVzdHVtLmpzXCI7XG5pbXBvcnQgUGVyc3BlY3RpdmVPZmZDZW50ZXJGcnVzdHVtIGZyb20gXCIuLi9Db3JlL1BlcnNwZWN0aXZlT2ZmQ2VudGVyRnJ1c3R1bS5qc1wiO1xuaW1wb3J0IFJlcXVlc3RTY2hlZHVsZXIgZnJvbSBcIi4uL0NvcmUvUmVxdWVzdFNjaGVkdWxlci5qc1wiO1xuaW1wb3J0IFRhc2tQcm9jZXNzb3IgZnJvbSBcIi4uL0NvcmUvVGFza1Byb2Nlc3Nvci5qc1wiO1xuaW1wb3J0IFRyYW5zZm9ybXMgZnJvbSBcIi4uL0NvcmUvVHJhbnNmb3Jtcy5qc1wiO1xuaW1wb3J0IENsZWFyQ29tbWFuZCBmcm9tIFwiLi4vUmVuZGVyZXIvQ2xlYXJDb21tYW5kLmpzXCI7XG5pbXBvcnQgQ29tcHV0ZUVuZ2luZSBmcm9tIFwiLi4vUmVuZGVyZXIvQ29tcHV0ZUVuZ2luZS5qc1wiO1xuaW1wb3J0IENvbnRleHQgZnJvbSBcIi4uL1JlbmRlcmVyL0NvbnRleHQuanNcIjtcbmltcG9ydCBDb250ZXh0TGltaXRzIGZyb20gXCIuLi9SZW5kZXJlci9Db250ZXh0TGltaXRzLmpzXCI7XG5pbXBvcnQgUGFzcyBmcm9tIFwiLi4vUmVuZGVyZXIvUGFzcy5qc1wiO1xuaW1wb3J0IFJlbmRlclN0YXRlIGZyb20gXCIuLi9SZW5kZXJlci9SZW5kZXJTdGF0ZS5qc1wiO1xuaW1wb3J0IEJyZGZMdXRHZW5lcmF0b3IgZnJvbSBcIi4vQnJkZkx1dEdlbmVyYXRvci5qc1wiO1xuaW1wb3J0IENhbWVyYSBmcm9tIFwiLi9DYW1lcmEuanNcIjtcbmltcG9ydCBDZXNpdW0zRFRpbGVQYXNzIGZyb20gXCIuL0Nlc2l1bTNEVGlsZVBhc3MuanNcIjtcbmltcG9ydCBDZXNpdW0zRFRpbGVQYXNzU3RhdGUgZnJvbSBcIi4vQ2VzaXVtM0RUaWxlUGFzc1N0YXRlLmpzXCI7XG5pbXBvcnQgQ3JlZGl0RGlzcGxheSBmcm9tIFwiLi9DcmVkaXREaXNwbGF5LmpzXCI7XG5pbXBvcnQgRGVidWdDYW1lcmFQcmltaXRpdmUgZnJvbSBcIi4vRGVidWdDYW1lcmFQcmltaXRpdmUuanNcIjtcbmltcG9ydCBEZXB0aFBsYW5lIGZyb20gXCIuL0RlcHRoUGxhbmUuanNcIjtcbmltcG9ydCBEZXJpdmVkQ29tbWFuZCBmcm9tIFwiLi9EZXJpdmVkQ29tbWFuZC5qc1wiO1xuaW1wb3J0IERldmljZU9yaWVudGF0aW9uQ2FtZXJhQ29udHJvbGxlciBmcm9tIFwiLi9EZXZpY2VPcmllbnRhdGlvbkNhbWVyYUNvbnRyb2xsZXIuanNcIjtcbmltcG9ydCBGb2cgZnJvbSBcIi4vRm9nLmpzXCI7XG5pbXBvcnQgRnJhbWVTdGF0ZSBmcm9tIFwiLi9GcmFtZVN0YXRlLmpzXCI7XG5pbXBvcnQgR2xvYmVEZXB0aCBmcm9tIFwiLi9HbG9iZURlcHRoLmpzXCI7XG5pbXBvcnQgR2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZSBmcm9tIFwiLi9HbG9iZVRyYW5zbHVjZW5jeVN0YXRlLmpzXCI7XG5pbXBvcnQgSW52ZXJ0Q2xhc3NpZmljYXRpb24gZnJvbSBcIi4vSW52ZXJ0Q2xhc3NpZmljYXRpb24uanNcIjtcbmltcG9ydCBKb2JTY2hlZHVsZXIgZnJvbSBcIi4vSm9iU2NoZWR1bGVyLmpzXCI7XG5pbXBvcnQgTWFwTW9kZTJEIGZyb20gXCIuL01hcE1vZGUyRC5qc1wiO1xuaW1wb3J0IE9jdGFoZWRyYWxQcm9qZWN0ZWRDdWJlTWFwIGZyb20gXCIuL09jdGFoZWRyYWxQcm9qZWN0ZWRDdWJlTWFwLmpzXCI7XG5pbXBvcnQgUGVyZm9ybWFuY2VEaXNwbGF5IGZyb20gXCIuL1BlcmZvcm1hbmNlRGlzcGxheS5qc1wiO1xuaW1wb3J0IFBlckluc3RhbmNlQ29sb3JBcHBlYXJhbmNlIGZyb20gXCIuL1Blckluc3RhbmNlQ29sb3JBcHBlYXJhbmNlLmpzXCI7XG5pbXBvcnQgUGlja2luZyBmcm9tIFwiLi9QaWNraW5nLmpzXCI7XG5pbXBvcnQgUG9zdFByb2Nlc3NTdGFnZUNvbGxlY3Rpb24gZnJvbSBcIi4vUG9zdFByb2Nlc3NTdGFnZUNvbGxlY3Rpb24uanNcIjtcbmltcG9ydCBQcmltaXRpdmUgZnJvbSBcIi4vUHJpbWl0aXZlLmpzXCI7XG5pbXBvcnQgUHJpbWl0aXZlQ29sbGVjdGlvbiBmcm9tIFwiLi9QcmltaXRpdmVDb2xsZWN0aW9uLmpzXCI7XG5pbXBvcnQgU2NlbmVNb2RlIGZyb20gXCIuL1NjZW5lTW9kZS5qc1wiO1xuaW1wb3J0IFNjZW5lVHJhbnNmb3JtcyBmcm9tIFwiLi9TY2VuZVRyYW5zZm9ybXMuanNcIjtcbmltcG9ydCBTY2VuZVRyYW5zaXRpb25lciBmcm9tIFwiLi9TY2VuZVRyYW5zaXRpb25lci5qc1wiO1xuaW1wb3J0IFNjcmVlblNwYWNlQ2FtZXJhQ29udHJvbGxlciBmcm9tIFwiLi9TY3JlZW5TcGFjZUNhbWVyYUNvbnRyb2xsZXIuanNcIjtcbmltcG9ydCBTaGFkb3dNYXAgZnJvbSBcIi4vU2hhZG93TWFwLmpzXCI7XG5pbXBvcnQgU3RlbmNpbENvbnN0YW50cyBmcm9tIFwiLi9TdGVuY2lsQ29uc3RhbnRzLmpzXCI7XG5pbXBvcnQgU3VuTGlnaHQgZnJvbSBcIi4vU3VuTGlnaHQuanNcIjtcbmltcG9ydCBTdW5Qb3N0UHJvY2VzcyBmcm9tIFwiLi9TdW5Qb3N0UHJvY2Vzcy5qc1wiO1xuaW1wb3J0IFR3ZWVuQ29sbGVjdGlvbiBmcm9tIFwiLi9Ud2VlbkNvbGxlY3Rpb24uanNcIjtcbmltcG9ydCBWaWV3IGZyb20gXCIuL1ZpZXcuanNcIjtcbmltcG9ydCBEZWJ1Z0luc3BlY3RvciBmcm9tIFwiLi9EZWJ1Z0luc3BlY3Rvci5qc1wiO1xuXG52YXIgcmVxdWVzdFJlbmRlckFmdGVyRnJhbWUgPSBmdW5jdGlvbiAoc2NlbmUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBzY2VuZS5mcmFtZVN0YXRlLmFmdGVyUmVuZGVyLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgc2NlbmUucmVxdWVzdFJlbmRlcigpO1xuICAgIH0pO1xuICB9O1xufTtcblxuLyoqXG4gKiBUaGUgY29udGFpbmVyIGZvciBhbGwgM0QgZ3JhcGhpY2FsIG9iamVjdHMgYW5kIHN0YXRlIGluIGEgQ2VzaXVtIHZpcnR1YWwgc2NlbmUuICBHZW5lcmFsbHksXG4gKiBhIHNjZW5lIGlzIG5vdCBjcmVhdGVkIGRpcmVjdGx5OyBpbnN0ZWFkLCBpdCBpcyBpbXBsaWNpdGx5IGNyZWF0ZWQgYnkge0BsaW5rIENlc2l1bVdpZGdldH0uXG4gKiA8cD5cbiAqIDxlbT48Y29kZT5jb250ZXh0T3B0aW9uczwvY29kZT4gcGFyYW1ldGVyIGRldGFpbHM6PC9lbT5cbiAqIDwvcD5cbiAqIDxwPlxuICogVGhlIGRlZmF1bHQgdmFsdWVzIGFyZTpcbiAqIDxjb2RlPlxuICoge1xuICogICB3ZWJnbCA6IHtcbiAqICAgICBhbHBoYSA6IGZhbHNlLFxuICogICAgIGRlcHRoIDogdHJ1ZSxcbiAqICAgICBzdGVuY2lsIDogZmFsc2UsXG4gKiAgICAgYW50aWFsaWFzIDogdHJ1ZSxcbiAqICAgICBwb3dlclByZWZlcmVuY2U6ICdoaWdoLXBlcmZvcm1hbmNlJyxcbiAqICAgICBwcmVtdWx0aXBsaWVkQWxwaGEgOiB0cnVlLFxuICogICAgIHByZXNlcnZlRHJhd2luZ0J1ZmZlciA6IGZhbHNlLFxuICogICAgIGZhaWxJZk1ham9yUGVyZm9ybWFuY2VDYXZlYXQgOiBmYWxzZVxuICogICB9LFxuICogICBhbGxvd1RleHR1cmVGaWx0ZXJBbmlzb3Ryb3BpYyA6IHRydWVcbiAqIH1cbiAqIDwvY29kZT5cbiAqIDwvcD5cbiAqIDxwPlxuICogVGhlIDxjb2RlPndlYmdsPC9jb2RlPiBwcm9wZXJ0eSBjb3JyZXNwb25kcyB0byB0aGUge0BsaW5rIGh0dHA6Ly93d3cua2hyb25vcy5vcmcvcmVnaXN0cnkvd2ViZ2wvc3BlY3MvbGF0ZXN0LyM1LjJ8V2ViR0xDb250ZXh0QXR0cmlidXRlc31cbiAqIG9iamVjdCB1c2VkIHRvIGNyZWF0ZSB0aGUgV2ViR0wgY29udGV4dC5cbiAqIDwvcD5cbiAqIDxwPlxuICogPGNvZGU+d2ViZ2wuYWxwaGE8L2NvZGU+IGRlZmF1bHRzIHRvIGZhbHNlLCB3aGljaCBjYW4gaW1wcm92ZSBwZXJmb3JtYW5jZSBjb21wYXJlZCB0byB0aGUgc3RhbmRhcmQgV2ViR0wgZGVmYXVsdFxuICogb2YgdHJ1ZS4gIElmIGFuIGFwcGxpY2F0aW9uIG5lZWRzIHRvIGNvbXBvc2l0ZSBDZXNpdW0gYWJvdmUgb3RoZXIgSFRNTCBlbGVtZW50cyB1c2luZyBhbHBoYS1ibGVuZGluZywgc2V0XG4gKiA8Y29kZT53ZWJnbC5hbHBoYTwvY29kZT4gdG8gdHJ1ZS5cbiAqIDwvcD5cbiAqIDxwPlxuICogVGhlIG90aGVyIDxjb2RlPndlYmdsPC9jb2RlPiBwcm9wZXJ0aWVzIG1hdGNoIHRoZSBXZWJHTCBkZWZhdWx0cyBmb3Ige0BsaW5rIGh0dHA6Ly93d3cua2hyb25vcy5vcmcvcmVnaXN0cnkvd2ViZ2wvc3BlY3MvbGF0ZXN0LyM1LjJ8V2ViR0xDb250ZXh0QXR0cmlidXRlc30uXG4gKiA8L3A+XG4gKiA8cD5cbiAqIDxjb2RlPmFsbG93VGV4dHVyZUZpbHRlckFuaXNvdHJvcGljPC9jb2RlPiBkZWZhdWx0cyB0byB0cnVlLCB3aGljaCBlbmFibGVzIGFuaXNvdHJvcGljIHRleHR1cmUgZmlsdGVyaW5nIHdoZW4gdGhlXG4gKiBXZWJHTCBleHRlbnNpb24gaXMgc3VwcG9ydGVkLiAgU2V0dGluZyB0aGlzIHRvIGZhbHNlIHdpbGwgaW1wcm92ZSBwZXJmb3JtYW5jZSwgYnV0IGh1cnQgdmlzdWFsIHF1YWxpdHksIGVzcGVjaWFsbHkgZm9yIGhvcml6b24gdmlld3MuXG4gKiA8L3A+XG4gKlxuICogQGFsaWFzIFNjZW5lXG4gKiBAY29uc3RydWN0b3JcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBPYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6XG4gKiBAcGFyYW0ge0hUTUxDYW52YXNFbGVtZW50fSBvcHRpb25zLmNhbnZhcyBUaGUgSFRNTCBjYW52YXMgZWxlbWVudCB0byBjcmVhdGUgdGhlIHNjZW5lIGZvci5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucy5jb250ZXh0T3B0aW9uc10gQ29udGV4dCBhbmQgV2ViR0wgY3JlYXRpb24gcHJvcGVydGllcy4gIFNlZSBkZXRhaWxzIGFib3ZlLlxuICogQHBhcmFtIHtFbGVtZW50fSBbb3B0aW9ucy5jcmVkaXRDb250YWluZXJdIFRoZSBIVE1MIGVsZW1lbnQgaW4gd2hpY2ggdGhlIGNyZWRpdHMgd2lsbCBiZSBkaXNwbGF5ZWQuXG4gKiBAcGFyYW0ge0VsZW1lbnR9IFtvcHRpb25zLmNyZWRpdFZpZXdwb3J0XSBUaGUgSFRNTCBlbGVtZW50IGluIHdoaWNoIHRvIGRpc3BsYXkgdGhlIGNyZWRpdCBwb3B1cC4gIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB2aWV3cG9ydCB3aWxsIGJlIGEgYWRkZWQgYXMgYSBzaWJsaW5nIG9mIHRoZSBjYW52YXMuXG4gKiBAcGFyYW0ge01hcFByb2plY3Rpb259IFtvcHRpb25zLm1hcFByb2plY3Rpb249bmV3IEdlb2dyYXBoaWNQcm9qZWN0aW9uKCldIFRoZSBtYXAgcHJvamVjdGlvbiB0byB1c2UgaW4gMkQgYW5kIENvbHVtYnVzIFZpZXcgbW9kZXMuXG4gKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLm9yZGVySW5kZXBlbmRlbnRUcmFuc2x1Y2VuY3k9dHJ1ZV0gSWYgdHJ1ZSBhbmQgdGhlIGNvbmZpZ3VyYXRpb24gc3VwcG9ydHMgaXQsIHVzZSBvcmRlciBpbmRlcGVuZGVudCB0cmFuc2x1Y2VuY3kuXG4gKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLnNjZW5lM0RPbmx5PWZhbHNlXSBJZiB0cnVlLCBvcHRpbWl6ZXMgbWVtb3J5IHVzZSBhbmQgcGVyZm9ybWFuY2UgZm9yIDNEIG1vZGUgYnV0IGRpc2FibGVzIHRoZSBhYmlsaXR5IHRvIHVzZSAyRCBvciBDb2x1bWJ1cyBWaWV3LlxuICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5zaGFkb3dzPWZhbHNlXSBEZXRlcm1pbmVzIGlmIHNoYWRvd3MgYXJlIGNhc3QgYnkgbGlnaHQgc291cmNlcy5cbiAqIEBwYXJhbSB7TWFwTW9kZTJEfSBbb3B0aW9ucy5tYXBNb2RlMkQ9TWFwTW9kZTJELklORklOSVRFX1NDUk9MTF0gRGV0ZXJtaW5lcyBpZiB0aGUgMkQgbWFwIGlzIHJvdGF0YWJsZSBvciBjYW4gYmUgc2Nyb2xsZWQgaW5maW5pdGVseSBpbiB0aGUgaG9yaXpvbnRhbCBkaXJlY3Rpb24uXG4gKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLnJlcXVlc3RSZW5kZXJNb2RlPWZhbHNlXSBJZiB0cnVlLCByZW5kZXJpbmcgYSBmcmFtZSB3aWxsIG9ubHkgb2NjdXIgd2hlbiBuZWVkZWQgYXMgZGV0ZXJtaW5lZCBieSBjaGFuZ2VzIHdpdGhpbiB0aGUgc2NlbmUuIEVuYWJsaW5nIGltcHJvdmVzIHBlcmZvcm1hbmNlIG9mIHRoZSBhcHBsaWNhdGlvbiwgYnV0IHJlcXVpcmVzIHVzaW5nIHtAbGluayBTY2VuZSNyZXF1ZXN0UmVuZGVyfSB0byByZW5kZXIgYSBuZXcgZnJhbWUgZXhwbGljaXRseSBpbiB0aGlzIG1vZGUuIFRoaXMgd2lsbCBiZSBuZWNlc3NhcnkgaW4gbWFueSBjYXNlcyBhZnRlciBtYWtpbmcgY2hhbmdlcyB0byB0aGUgc2NlbmUgaW4gb3RoZXIgcGFydHMgb2YgdGhlIEFQSS4gU2VlIHtAbGluayBodHRwczovL2Nlc2l1bS5jb20vYmxvZy8yMDE4LzAxLzI0L2Nlc2l1bS1zY2VuZS1yZW5kZXJpbmctcGVyZm9ybWFuY2UvfEltcHJvdmluZyBQZXJmb3JtYW5jZSB3aXRoIEV4cGxpY2l0IFJlbmRlcmluZ30uXG4gKiBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMubWF4aW11bVJlbmRlclRpbWVDaGFuZ2U9MC4wXSBJZiByZXF1ZXN0UmVuZGVyTW9kZSBpcyB0cnVlLCB0aGlzIHZhbHVlIGRlZmluZXMgdGhlIG1heGltdW0gY2hhbmdlIGluIHNpbXVsYXRpb24gdGltZSBhbGxvd2VkIGJlZm9yZSBhIHJlbmRlciBpcyByZXF1ZXN0ZWQuIFNlZSB7QGxpbmsgaHR0cHM6Ly9jZXNpdW0uY29tL2Jsb2cvMjAxOC8wMS8yNC9jZXNpdW0tc2NlbmUtcmVuZGVyaW5nLXBlcmZvcm1hbmNlL3xJbXByb3ZpbmcgUGVyZm9ybWFuY2Ugd2l0aCBFeHBsaWNpdCBSZW5kZXJpbmd9LlxuICpcbiAqIEBzZWUgQ2VzaXVtV2lkZ2V0XG4gKiBAc2VlIHtAbGluayBodHRwOi8vd3d3Lmtocm9ub3Mub3JnL3JlZ2lzdHJ5L3dlYmdsL3NwZWNzL2xhdGVzdC8jNS4yfFdlYkdMQ29udGV4dEF0dHJpYnV0ZXN9XG4gKlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IG9wdGlvbnMgYW5kIG9wdGlvbnMuY2FudmFzIGFyZSByZXF1aXJlZC5cbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQ3JlYXRlIHNjZW5lIHdpdGhvdXQgYW5pc290cm9waWMgdGV4dHVyZSBmaWx0ZXJpbmdcbiAqIHZhciBzY2VuZSA9IG5ldyBDZXNpdW0uU2NlbmUoe1xuICogICBjYW52YXMgOiBjYW52YXMsXG4gKiAgIGNvbnRleHRPcHRpb25zIDoge1xuICogICAgIGFsbG93VGV4dHVyZUZpbHRlckFuaXNvdHJvcGljIDogZmFsc2VcbiAqICAgfVxuICogfSk7XG4gKi9cbmZ1bmN0aW9uIFNjZW5lKG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IGRlZmF1bHRWYWx1ZShvcHRpb25zLCBkZWZhdWx0VmFsdWUuRU1QVFlfT0JKRUNUKTtcbiAgdmFyIGNhbnZhcyA9IG9wdGlvbnMuY2FudmFzO1xuICB2YXIgY3JlZGl0Q29udGFpbmVyID0gb3B0aW9ucy5jcmVkaXRDb250YWluZXI7XG4gIHZhciBjcmVkaXRWaWV3cG9ydCA9IG9wdGlvbnMuY3JlZGl0Vmlld3BvcnQ7XG5cbiAgdmFyIGNvbnRleHRPcHRpb25zID0gY2xvbmUob3B0aW9ucy5jb250ZXh0T3B0aW9ucyk7XG4gIGlmICghZGVmaW5lZChjb250ZXh0T3B0aW9ucykpIHtcbiAgICBjb250ZXh0T3B0aW9ucyA9IHt9O1xuICB9XG4gIGlmICghZGVmaW5lZChjb250ZXh0T3B0aW9ucy53ZWJnbCkpIHtcbiAgICBjb250ZXh0T3B0aW9ucy53ZWJnbCA9IHt9O1xuICB9XG4gIGNvbnRleHRPcHRpb25zLndlYmdsLnBvd2VyUHJlZmVyZW5jZSA9IGRlZmF1bHRWYWx1ZShcbiAgICBjb250ZXh0T3B0aW9ucy53ZWJnbC5wb3dlclByZWZlcmVuY2UsXG4gICAgXCJoaWdoLXBlcmZvcm1hbmNlXCJcbiAgKTtcblxuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBpZiAoIWRlZmluZWQoY2FudmFzKSkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcIm9wdGlvbnMgYW5kIG9wdGlvbnMuY2FudmFzIGFyZSByZXF1aXJlZC5cIik7XG4gIH1cbiAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG4gIHZhciBoYXNDcmVkaXRDb250YWluZXIgPSBkZWZpbmVkKGNyZWRpdENvbnRhaW5lcik7XG4gIHZhciBjb250ZXh0ID0gbmV3IENvbnRleHQoY2FudmFzLCBjb250ZXh0T3B0aW9ucyk7XG4gIGlmICghaGFzQ3JlZGl0Q29udGFpbmVyKSB7XG4gICAgY3JlZGl0Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjcmVkaXRDb250YWluZXIuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgY3JlZGl0Q29udGFpbmVyLnN0eWxlLmJvdHRvbSA9IFwiMFwiO1xuICAgIGNyZWRpdENvbnRhaW5lci5zdHlsZVtcInRleHQtc2hhZG93XCJdID0gXCIwIDAgMnB4ICMwMDAwMDBcIjtcbiAgICBjcmVkaXRDb250YWluZXIuc3R5bGUuY29sb3IgPSBcIiNmZmZmZmZcIjtcbiAgICBjcmVkaXRDb250YWluZXIuc3R5bGVbXCJmb250LXNpemVcIl0gPSBcIjEwcHhcIjtcbiAgICBjcmVkaXRDb250YWluZXIuc3R5bGVbXCJwYWRkaW5nLXJpZ2h0XCJdID0gXCI1cHhcIjtcbiAgICBjYW52YXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChjcmVkaXRDb250YWluZXIpO1xuICB9XG4gIGlmICghZGVmaW5lZChjcmVkaXRWaWV3cG9ydCkpIHtcbiAgICBjcmVkaXRWaWV3cG9ydCA9IGNhbnZhcy5wYXJlbnROb2RlO1xuICB9XG5cbiAgdGhpcy5faWQgPSBjcmVhdGVHdWlkKCk7XG4gIHRoaXMuX2pvYlNjaGVkdWxlciA9IG5ldyBKb2JTY2hlZHVsZXIoKTtcbiAgdGhpcy5fZnJhbWVTdGF0ZSA9IG5ldyBGcmFtZVN0YXRlKFxuICAgIGNvbnRleHQsXG4gICAgbmV3IENyZWRpdERpc3BsYXkoY3JlZGl0Q29udGFpbmVyLCBcIiDigKIgXCIsIGNyZWRpdFZpZXdwb3J0KSxcbiAgICB0aGlzLl9qb2JTY2hlZHVsZXJcbiAgKTtcbiAgdGhpcy5fZnJhbWVTdGF0ZS5zY2VuZTNET25seSA9IGRlZmF1bHRWYWx1ZShvcHRpb25zLnNjZW5lM0RPbmx5LCBmYWxzZSk7XG4gIHRoaXMuX3JlbW92ZUNyZWRpdENvbnRhaW5lciA9ICFoYXNDcmVkaXRDb250YWluZXI7XG4gIHRoaXMuX2NyZWRpdENvbnRhaW5lciA9IGNyZWRpdENvbnRhaW5lcjtcblxuICB0aGlzLl9jYW52YXMgPSBjYW52YXM7XG4gIHRoaXMuX2NvbnRleHQgPSBjb250ZXh0O1xuICB0aGlzLl9jb21wdXRlRW5naW5lID0gbmV3IENvbXB1dGVFbmdpbmUoY29udGV4dCk7XG4gIHRoaXMuX2dsb2JlID0gdW5kZWZpbmVkO1xuICB0aGlzLl9nbG9iZVRyYW5zbHVjZW5jeVN0YXRlID0gbmV3IEdsb2JlVHJhbnNsdWNlbmN5U3RhdGUoKTtcbiAgdGhpcy5fcHJpbWl0aXZlcyA9IG5ldyBQcmltaXRpdmVDb2xsZWN0aW9uKCk7XG4gIHRoaXMuX2dyb3VuZFByaW1pdGl2ZXMgPSBuZXcgUHJpbWl0aXZlQ29sbGVjdGlvbigpO1xuXG4gIHRoaXMuX2dsb2JlSGVpZ2h0ID0gdW5kZWZpbmVkO1xuICB0aGlzLl9jYW1lcmFVbmRlcmdyb3VuZCA9IGZhbHNlO1xuXG4gIHRoaXMuX2xvZ0RlcHRoQnVmZmVyID0gY29udGV4dC5mcmFnbWVudERlcHRoO1xuICB0aGlzLl9sb2dEZXB0aEJ1ZmZlckRpcnR5ID0gdHJ1ZTtcblxuICB0aGlzLl90d2VlbnMgPSBuZXcgVHdlZW5Db2xsZWN0aW9uKCk7XG5cbiAgdGhpcy5fc2hhZGVyRnJhbWVDb3VudCA9IDA7XG5cbiAgdGhpcy5fc3VuUG9zdFByb2Nlc3MgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fY29tcHV0ZUNvbW1hbmRMaXN0ID0gW107XG4gIHRoaXMuX292ZXJsYXlDb21tYW5kTGlzdCA9IFtdO1xuXG4gIHRoaXMuX3VzZU9JVCA9IGRlZmF1bHRWYWx1ZShvcHRpb25zLm9yZGVySW5kZXBlbmRlbnRUcmFuc2x1Y2VuY3ksIHRydWUpO1xuICB0aGlzLl9leGVjdXRlT0lURnVuY3Rpb24gPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fZGVwdGhQbGFuZSA9IG5ldyBEZXB0aFBsYW5lKCk7XG5cbiAgdGhpcy5fY2xlYXJDb2xvckNvbW1hbmQgPSBuZXcgQ2xlYXJDb21tYW5kKHtcbiAgICBjb2xvcjogbmV3IENvbG9yKCksXG4gICAgc3RlbmNpbDogMCxcbiAgICBvd25lcjogdGhpcyxcbiAgfSk7XG4gIHRoaXMuX2RlcHRoQ2xlYXJDb21tYW5kID0gbmV3IENsZWFyQ29tbWFuZCh7XG4gICAgZGVwdGg6IDEuMCxcbiAgICBvd25lcjogdGhpcyxcbiAgfSk7XG4gIHRoaXMuX3N0ZW5jaWxDbGVhckNvbW1hbmQgPSBuZXcgQ2xlYXJDb21tYW5kKHtcbiAgICBzdGVuY2lsOiAwLFxuICB9KTtcbiAgdGhpcy5fY2xhc3NpZmljYXRpb25TdGVuY2lsQ2xlYXJDb21tYW5kID0gbmV3IENsZWFyQ29tbWFuZCh7XG4gICAgc3RlbmNpbDogMCxcbiAgICByZW5kZXJTdGF0ZTogUmVuZGVyU3RhdGUuZnJvbUNhY2hlKHtcbiAgICAgIHN0ZW5jaWxNYXNrOiBTdGVuY2lsQ29uc3RhbnRzLkNMQVNTSUZJQ0FUSU9OX01BU0ssXG4gICAgfSksXG4gIH0pO1xuXG4gIHRoaXMuX2RlcHRoT25seVJlbmRlclN0YXRlQ2FjaGUgPSB7fTtcblxuICB0aGlzLl90cmFuc2l0aW9uZXIgPSBuZXcgU2NlbmVUcmFuc2l0aW9uZXIodGhpcyk7XG5cbiAgdGhpcy5fcHJlVXBkYXRlID0gbmV3IEV2ZW50KCk7XG4gIHRoaXMuX3Bvc3RVcGRhdGUgPSBuZXcgRXZlbnQoKTtcblxuICB0aGlzLl9yZW5kZXJFcnJvciA9IG5ldyBFdmVudCgpO1xuICB0aGlzLl9wcmVSZW5kZXIgPSBuZXcgRXZlbnQoKTtcbiAgdGhpcy5fcG9zdFJlbmRlciA9IG5ldyBFdmVudCgpO1xuXG4gIHRoaXMuX21pbmltdW1EaXNhYmxlRGVwdGhUZXN0RGlzdGFuY2UgPSAwLjA7XG4gIHRoaXMuX2RlYnVnSW5zcGVjdG9yID0gbmV3IERlYnVnSW5zcGVjdG9yKCk7XG5cbiAgLyoqXG4gICAqIEV4Y2VwdGlvbnMgb2NjdXJyaW5nIGluIDxjb2RlPnJlbmRlcjwvY29kZT4gYXJlIGFsd2F5cyBjYXVnaHQgaW4gb3JkZXIgdG8gcmFpc2UgdGhlXG4gICAqIDxjb2RlPnJlbmRlckVycm9yPC9jb2RlPiBldmVudC4gIElmIHRoaXMgcHJvcGVydHkgaXMgdHJ1ZSwgdGhlIGVycm9yIGlzIHJldGhyb3duXG4gICAqIGFmdGVyIHRoZSBldmVudCBpcyByYWlzZWQuICBJZiB0aGlzIHByb3BlcnR5IGlzIGZhbHNlLCB0aGUgPGNvZGU+cmVuZGVyPC9jb2RlPiBmdW5jdGlvblxuICAgKiByZXR1cm5zIG5vcm1hbGx5IGFmdGVyIHJhaXNpbmcgdGhlIGV2ZW50LlxuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHRoaXMucmV0aHJvd1JlbmRlckVycm9ycyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRvIGluc3RhbnRseSBjb21wbGV0ZSB0aGVcbiAgICogc2NlbmUgdHJhbnNpdGlvbiBhbmltYXRpb24gb24gdXNlciBpbnB1dC5cbiAgICpcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHRoaXMuY29tcGxldGVNb3JwaE9uVXNlcklucHV0ID0gdHJ1ZTtcblxuICAvKipcbiAgICogVGhlIGV2ZW50IGZpcmVkIGF0IHRoZSBiZWdpbm5pbmcgb2YgYSBzY2VuZSB0cmFuc2l0aW9uLlxuICAgKiBAdHlwZSB7RXZlbnR9XG4gICAqIEBkZWZhdWx0IEV2ZW50KClcbiAgICovXG4gIHRoaXMubW9ycGhTdGFydCA9IG5ldyBFdmVudCgpO1xuXG4gIC8qKlxuICAgKiBUaGUgZXZlbnQgZmlyZWQgYXQgdGhlIGNvbXBsZXRpb24gb2YgYSBzY2VuZSB0cmFuc2l0aW9uLlxuICAgKiBAdHlwZSB7RXZlbnR9XG4gICAqIEBkZWZhdWx0IEV2ZW50KClcbiAgICovXG4gIHRoaXMubW9ycGhDb21wbGV0ZSA9IG5ldyBFdmVudCgpO1xuXG4gIC8qKlxuICAgKiBUaGUge0BsaW5rIFNreUJveH0gdXNlZCB0byBkcmF3IHRoZSBzdGFycy5cbiAgICpcbiAgICogQHR5cGUge1NreUJveH1cbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkXG4gICAqXG4gICAqIEBzZWUgU2NlbmUjYmFja2dyb3VuZENvbG9yXG4gICAqL1xuICB0aGlzLnNreUJveCA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogVGhlIHNreSBhdG1vc3BoZXJlIGRyYXduIGFyb3VuZCB0aGUgZ2xvYmUuXG4gICAqXG4gICAqIEB0eXBlIHtTa3lBdG1vc3BoZXJlfVxuICAgKiBAZGVmYXVsdCB1bmRlZmluZWRcbiAgICovXG4gIHRoaXMuc2t5QXRtb3NwaGVyZSA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogVGhlIHtAbGluayBTdW59LlxuICAgKlxuICAgKiBAdHlwZSB7U3VufVxuICAgKiBAZGVmYXVsdCB1bmRlZmluZWRcbiAgICovXG4gIHRoaXMuc3VuID0gdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBVc2VzIGEgYmxvb20gZmlsdGVyIG9uIHRoZSBzdW4gd2hlbiBlbmFibGVkLlxuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgdGhpcy5zdW5CbG9vbSA9IHRydWU7XG4gIHRoaXMuX3N1bkJsb29tID0gdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBUaGUge0BsaW5rIE1vb259XG4gICAqXG4gICAqIEB0eXBlIE1vb25cbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkXG4gICAqL1xuICB0aGlzLm1vb24gPSB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIFRoZSBiYWNrZ3JvdW5kIGNvbG9yLCB3aGljaCBpcyBvbmx5IHZpc2libGUgaWYgdGhlcmUgaXMgbm8gc2t5IGJveCwgaS5lLiwge0BsaW5rIFNjZW5lI3NreUJveH0gaXMgdW5kZWZpbmVkLlxuICAgKlxuICAgKiBAdHlwZSB7Q29sb3J9XG4gICAqIEBkZWZhdWx0IHtAbGluayBDb2xvci5CTEFDS31cbiAgICpcbiAgICogQHNlZSBTY2VuZSNza3lCb3hcbiAgICovXG4gIHRoaXMuYmFja2dyb3VuZENvbG9yID0gQ29sb3IuY2xvbmUoQ29sb3IuQkxBQ0spO1xuXG4gIHRoaXMuX21vZGUgPSBTY2VuZU1vZGUuU0NFTkUzRDtcblxuICB0aGlzLl9tYXBQcm9qZWN0aW9uID0gZGVmaW5lZChvcHRpb25zLm1hcFByb2plY3Rpb24pXG4gICAgPyBvcHRpb25zLm1hcFByb2plY3Rpb25cbiAgICA6IG5ldyBHZW9ncmFwaGljUHJvamVjdGlvbigpO1xuXG4gIC8qKlxuICAgKiBUaGUgY3VycmVudCBtb3JwaCB0cmFuc2l0aW9uIHRpbWUgYmV0d2VlbiAyRC9Db2x1bWJ1cyBWaWV3IGFuZCAzRCxcbiAgICogd2l0aCAwLjAgYmVpbmcgMkQgb3IgQ29sdW1idXMgVmlldyBhbmQgMS4wIGJlaW5nIDNELlxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAxLjBcbiAgICovXG4gIHRoaXMubW9ycGhUaW1lID0gMS4wO1xuXG4gIC8qKlxuICAgKiBUaGUgZmFyLXRvLW5lYXIgcmF0aW8gb2YgdGhlIG11bHRpLWZydXN0dW0gd2hlbiB1c2luZyBhIG5vcm1hbCBkZXB0aCBidWZmZXIuXG4gICAqIDxwPlxuICAgKiBUaGlzIHZhbHVlIGlzIHVzZWQgdG8gY3JlYXRlIHRoZSBuZWFyIGFuZCBmYXIgdmFsdWVzIGZvciBlYWNoIGZydXN0dW0gb2YgdGhlIG11bHRpLWZydXN0dW0uIEl0IGlzIG9ubHkgdXNlZFxuICAgKiB3aGVuIHtAbGluayBTY2VuZSNsb2dhcml0aG1pY0RlcHRoQnVmZmVyfSBpcyA8Y29kZT5mYWxzZTwvY29kZT4uIFdoZW4gPGNvZGU+bG9nYXJpdGhtaWNEZXB0aEJ1ZmZlcjwvY29kZT4gaXNcbiAgICogPGNvZGU+dHJ1ZTwvY29kZT4sIHVzZSB7QGxpbmsgU2NlbmUjbG9nYXJpdGhtaWNEZXB0aEZhclRvTmVhclJhdGlvfS5cbiAgICogPC9wPlxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAxMDAwLjBcbiAgICovXG4gIHRoaXMuZmFyVG9OZWFyUmF0aW8gPSAxMDAwLjA7XG5cbiAgLyoqXG4gICAqIFRoZSBmYXItdG8tbmVhciByYXRpbyBvZiB0aGUgbXVsdGktZnJ1c3R1bSB3aGVuIHVzaW5nIGEgbG9nYXJpdGhtaWMgZGVwdGggYnVmZmVyLlxuICAgKiA8cD5cbiAgICogVGhpcyB2YWx1ZSBpcyB1c2VkIHRvIGNyZWF0ZSB0aGUgbmVhciBhbmQgZmFyIHZhbHVlcyBmb3IgZWFjaCBmcnVzdHVtIG9mIHRoZSBtdWx0aS1mcnVzdHVtLiBJdCBpcyBvbmx5IHVzZWRcbiAgICogd2hlbiB7QGxpbmsgU2NlbmUjbG9nYXJpdGhtaWNEZXB0aEJ1ZmZlcn0gaXMgPGNvZGU+dHJ1ZTwvY29kZT4uIFdoZW4gPGNvZGU+bG9nYXJpdGhtaWNEZXB0aEJ1ZmZlcjwvY29kZT4gaXNcbiAgICogPGNvZGU+ZmFsc2U8L2NvZGU+LCB1c2Uge0BsaW5rIFNjZW5lI2ZhclRvTmVhclJhdGlvfS5cbiAgICogPC9wPlxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAxZTlcbiAgICovXG4gIHRoaXMubG9nYXJpdGhtaWNEZXB0aEZhclRvTmVhclJhdGlvID0gMWU5O1xuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIHRoZSB1bmlmb3JtIGRlcHRoIHNpemUgaW4gbWV0ZXJzIG9mIGVhY2ggZnJ1c3R1bSBvZiB0aGUgbXVsdGlmcnVzdHVtIGluIDJELiBJZiBhIHByaW1pdGl2ZSBvciBtb2RlbCBjbG9zZVxuICAgKiB0byB0aGUgc3VyZmFjZSBzaG93cyB6LWZpZ2h0aW5nLCBkZWNyZWFzaW5nIHRoaXMgd2lsbCBlbGltaW5hdGUgdGhlIGFydGlmYWN0LCBidXQgZGVjcmVhc2UgcGVyZm9ybWFuY2UuIE9uIHRoZVxuICAgKiBvdGhlciBoYW5kLCBpbmNyZWFzaW5nIHRoaXMgd2lsbCBpbmNyZWFzZSBwZXJmb3JtYW5jZSBidXQgbWF5IGNhdXNlIHotZmlnaHRpbmcgYW1vbmcgcHJpbWl0aXZlcyBjbG9zZSB0byB0aGUgc3VyZmFjZS5cbiAgICpcbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMS43NWU2XG4gICAqL1xuICB0aGlzLm5lYXJUb0ZhckRpc3RhbmNlMkQgPSAxLjc1ZTY7XG5cbiAgLyoqXG4gICAqIFRoaXMgcHJvcGVydHkgaXMgZm9yIGRlYnVnZ2luZyBvbmx5OyBpdCBpcyBub3QgZm9yIHByb2R1Y3Rpb24gdXNlLlxuICAgKiA8cD5cbiAgICogQSBmdW5jdGlvbiB0aGF0IGRldGVybWluZXMgd2hhdCBjb21tYW5kcyBhcmUgZXhlY3V0ZWQuICBBcyBzaG93biBpbiB0aGUgZXhhbXBsZXMgYmVsb3csXG4gICAqIHRoZSBmdW5jdGlvbiByZWNlaXZlcyB0aGUgY29tbWFuZCdzIDxjb2RlPm93bmVyPC9jb2RlPiBhcyBhbiBhcmd1bWVudCwgYW5kIHJldHVybnMgYSBib29sZWFuIGluZGljYXRpbmcgaWYgdGhlXG4gICAqIGNvbW1hbmQgc2hvdWxkIGJlIGV4ZWN1dGVkLlxuICAgKiA8L3A+XG4gICAqIDxwPlxuICAgKiBUaGUgZGVmYXVsdCBpcyA8Y29kZT51bmRlZmluZWQ8L2NvZGU+LCBpbmRpY2F0aW5nIHRoYXQgYWxsIGNvbW1hbmRzIGFyZSBleGVjdXRlZC5cbiAgICogPC9wPlxuICAgKlxuICAgKiBAdHlwZSBGdW5jdGlvblxuICAgKlxuICAgKiBAZGVmYXVsdCB1bmRlZmluZWRcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogLy8gRG8gbm90IGV4ZWN1dGUgYW55IGNvbW1hbmRzLlxuICAgKiBzY2VuZS5kZWJ1Z0NvbW1hbmRGaWx0ZXIgPSBmdW5jdGlvbihjb21tYW5kKSB7XG4gICAqICAgICByZXR1cm4gZmFsc2U7XG4gICAqIH07XG4gICAqXG4gICAqIC8vIEV4ZWN1dGUgb25seSB0aGUgYmlsbGJvYXJkJ3MgY29tbWFuZHMuICBUaGF0IGlzLCBvbmx5IGRyYXcgdGhlIGJpbGxib2FyZC5cbiAgICogdmFyIGJpbGxib2FyZHMgPSBuZXcgQ2VzaXVtLkJpbGxib2FyZENvbGxlY3Rpb24oKTtcbiAgICogc2NlbmUuZGVidWdDb21tYW5kRmlsdGVyID0gZnVuY3Rpb24oY29tbWFuZCkge1xuICAgKiAgICAgcmV0dXJuIGNvbW1hbmQub3duZXIgPT09IGJpbGxib2FyZHM7XG4gICAqIH07XG4gICAqL1xuICB0aGlzLmRlYnVnQ29tbWFuZEZpbHRlciA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogVGhpcyBwcm9wZXJ0eSBpcyBmb3IgZGVidWdnaW5nIG9ubHk7IGl0IGlzIG5vdCBmb3IgcHJvZHVjdGlvbiB1c2UuXG4gICAqIDxwPlxuICAgKiBXaGVuIDxjb2RlPnRydWU8L2NvZGU+LCBjb21tYW5kcyBhcmUgcmFuZG9tbHkgc2hhZGVkLiAgVGhpcyBpcyB1c2VmdWxcbiAgICogZm9yIHBlcmZvcm1hbmNlIGFuYWx5c2lzIHRvIHNlZSB3aGF0IHBhcnRzIG9mIGEgc2NlbmUgb3IgbW9kZWwgYXJlXG4gICAqIGNvbW1hbmQtZGVuc2UgYW5kIGNvdWxkIGJlbmVmaXQgZnJvbSBiYXRjaGluZy5cbiAgICogPC9wPlxuICAgKlxuICAgKiBAdHlwZSBCb29sZWFuXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICB0aGlzLmRlYnVnU2hvd0NvbW1hbmRzID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFRoaXMgcHJvcGVydHkgaXMgZm9yIGRlYnVnZ2luZyBvbmx5OyBpdCBpcyBub3QgZm9yIHByb2R1Y3Rpb24gdXNlLlxuICAgKiA8cD5cbiAgICogV2hlbiA8Y29kZT50cnVlPC9jb2RlPiwgY29tbWFuZHMgYXJlIHNoYWRlZCBiYXNlZCBvbiB0aGUgZnJ1c3R1bXMgdGhleVxuICAgKiBvdmVybGFwLiAgQ29tbWFuZHMgaW4gdGhlIGNsb3Nlc3QgZnJ1c3R1bSBhcmUgdGludGVkIHJlZCwgY29tbWFuZHMgaW5cbiAgICogdGhlIG5leHQgY2xvc2VzdCBhcmUgZ3JlZW4sIGFuZCBjb21tYW5kcyBpbiB0aGUgZmFydGhlc3QgZnJ1c3R1bSBhcmVcbiAgICogYmx1ZS4gIElmIGEgY29tbWFuZCBvdmVybGFwcyBtb3JlIHRoYW4gb25lIGZydXN0dW0sIHRoZSBjb2xvciBjb21wb25lbnRzXG4gICAqIGFyZSBjb21iaW5lZCwgZS5nLiwgYSBjb21tYW5kIG92ZXJsYXBwaW5nIHRoZSBmaXJzdCB0d28gZnJ1c3R1bXMgaXMgdGludGVkXG4gICAqIHllbGxvdy5cbiAgICogPC9wPlxuICAgKlxuICAgKiBAdHlwZSBCb29sZWFuXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICB0aGlzLmRlYnVnU2hvd0ZydXN0dW1zID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFRoaXMgcHJvcGVydHkgaXMgZm9yIGRlYnVnZ2luZyBvbmx5OyBpdCBpcyBub3QgZm9yIHByb2R1Y3Rpb24gdXNlLlxuICAgKiA8cD5cbiAgICogRGlzcGxheXMgZnJhbWVzIHBlciBzZWNvbmQgYW5kIHRpbWUgYmV0d2VlbiBmcmFtZXMuXG4gICAqIDwvcD5cbiAgICpcbiAgICogQHR5cGUgQm9vbGVhblxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgdGhpcy5kZWJ1Z1Nob3dGcmFtZXNQZXJTZWNvbmQgPSBmYWxzZTtcblxuICAvKipcbiAgICogVGhpcyBwcm9wZXJ0eSBpcyBmb3IgZGVidWdnaW5nIG9ubHk7IGl0IGlzIG5vdCBmb3IgcHJvZHVjdGlvbiB1c2UuXG4gICAqIDxwPlxuICAgKiBEaXNwbGF5cyBkZXB0aCBpbmZvcm1hdGlvbiBmb3IgdGhlIGluZGljYXRlZCBmcnVzdHVtLlxuICAgKiA8L3A+XG4gICAqXG4gICAqIEB0eXBlIEJvb2xlYW5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHRoaXMuZGVidWdTaG93R2xvYmVEZXB0aCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBUaGlzIHByb3BlcnR5IGlzIGZvciBkZWJ1Z2dpbmcgb25seTsgaXQgaXMgbm90IGZvciBwcm9kdWN0aW9uIHVzZS5cbiAgICogPHA+XG4gICAqIEluZGljYXRlcyB3aGljaCBmcnVzdHVtIHdpbGwgaGF2ZSBkZXB0aCBpbmZvcm1hdGlvbiBkaXNwbGF5ZWQuXG4gICAqIDwvcD5cbiAgICpcbiAgICogQHR5cGUgTnVtYmVyXG4gICAqXG4gICAqIEBkZWZhdWx0IDFcbiAgICovXG4gIHRoaXMuZGVidWdTaG93RGVwdGhGcnVzdHVtID0gMTtcblxuICAvKipcbiAgICogVGhpcyBwcm9wZXJ0eSBpcyBmb3IgZGVidWdnaW5nIG9ubHk7IGl0IGlzIG5vdCBmb3IgcHJvZHVjdGlvbiB1c2UuXG4gICAqIDxwPlxuICAgKiBXaGVuIDxjb2RlPnRydWU8L2NvZGU+LCBkcmF3cyBvdXRsaW5lcyB0byBzaG93IHRoZSBib3VuZGFyaWVzIG9mIHRoZSBjYW1lcmEgZnJ1c3R1bXNcbiAgICogPC9wPlxuICAgKlxuICAgKiBAdHlwZSBCb29sZWFuXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICB0aGlzLmRlYnVnU2hvd0ZydXN0dW1QbGFuZXMgPSBmYWxzZTtcbiAgdGhpcy5fZGVidWdTaG93RnJ1c3R1bVBsYW5lcyA9IGZhbHNlO1xuICB0aGlzLl9kZWJ1Z0ZydXN0dW1QbGFuZXMgPSB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIFdoZW4gPGNvZGU+dHJ1ZTwvY29kZT4sIGVuYWJsZXMgcGlja2luZyB1c2luZyB0aGUgZGVwdGggYnVmZmVyLlxuICAgKlxuICAgKiBAdHlwZSBCb29sZWFuXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHRoaXMudXNlRGVwdGhQaWNraW5nID0gdHJ1ZTtcblxuICAvKipcbiAgICogV2hlbiA8Y29kZT50cnVlPC9jb2RlPiwgZW5hYmxlcyBwaWNraW5nIHRyYW5zbHVjZW50IGdlb21ldHJ5IHVzaW5nIHRoZSBkZXB0aCBidWZmZXIuIE5vdGUgdGhhdCB7QGxpbmsgU2NlbmUjdXNlRGVwdGhQaWNraW5nfSBtdXN0IGFsc28gYmUgdHJ1ZSBmb3IgZW5hYmxpbmcgdGhpcyB0byB3b3JrLlxuICAgKlxuICAgKiA8cD5cbiAgICogUmVuZGVyIG11c3QgYmUgY2FsbGVkIGJldHdlZW4gcGlja3MuXG4gICAqIDxicj5UaGVyZSBpcyBhIGRlY3JlYXNlIGluIHBlcmZvcm1hbmNlIHdoZW4gZW5hYmxlZC4gVGhlcmUgYXJlIGV4dHJhIGRyYXcgY2FsbHMgdG8gd3JpdGUgZGVwdGggZm9yXG4gICAqIHRyYW5zbHVjZW50IGdlb21ldHJ5LlxuICAgKiA8L3A+XG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIC8vIHBpY2tpbmcgdGhlIHBvc2l0aW9uIG9mIGEgdHJhbnNsdWNlbnQgcHJpbWl0aXZlXG4gICAqIHZpZXdlci5zY3JlZW5TcGFjZUV2ZW50SGFuZGxlci5zZXRJbnB1dEFjdGlvbihmdW5jdGlvbiBvbkxlZnRDbGljayhtb3ZlbWVudCkge1xuICAgKiAgICAgIHZhciBwaWNrZWRGZWF0dXJlID0gdmlld2VyLnNjZW5lLnBpY2sobW92ZW1lbnQucG9zaXRpb24pO1xuICAgKiAgICAgIGlmICghQ2VzaXVtLmRlZmluZWQocGlja2VkRmVhdHVyZSkpIHtcbiAgICogICAgICAgICAgLy8gbm90aGluZyBwaWNrZWRcbiAgICogICAgICAgICAgcmV0dXJuO1xuICAgKiAgICAgIH1cbiAgICogICAgICB2aWV3ZXIuc2NlbmUucmVuZGVyKCk7XG4gICAqICAgICAgdmFyIHdvcmxkUG9zaXRpb24gPSB2aWV3ZXIuc2NlbmUucGlja1Bvc2l0aW9uKG1vdmVtZW50LnBvc2l0aW9uKTtcbiAgICogfSwgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLkxFRlRfQ0xJQ0spO1xuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHRoaXMucGlja1RyYW5zbHVjZW50RGVwdGggPSBmYWxzZTtcblxuICAvKipcbiAgICogVGhlIHRpbWUgaW4gbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIGNoZWNraW5nIGlmIHRoZSBjYW1lcmEgaGFzIG5vdCBtb3ZlZCBhbmQgZmlyZSB0aGUgY2FtZXJhTW92ZUVuZCBldmVudC5cbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgNTAwLjBcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMuY2FtZXJhRXZlbnRXYWl0VGltZSA9IDUwMC4wO1xuXG4gIC8qKlxuICAgKiBCbGVuZHMgdGhlIGF0bW9zcGhlcmUgdG8gZ2VvbWV0cnkgZmFyIGZyb20gdGhlIGNhbWVyYSBmb3IgaG9yaXpvbiB2aWV3cy4gQWxsb3dzIGZvciBhZGRpdGlvbmFsXG4gICAqIHBlcmZvcm1hbmNlIGltcHJvdmVtZW50cyBieSByZW5kZXJpbmcgbGVzcyBnZW9tZXRyeSBhbmQgZGlzcGF0Y2hpbmcgbGVzcyB0ZXJyYWluIHJlcXVlc3RzLlxuICAgKiBAdHlwZSB7Rm9nfVxuICAgKi9cbiAgdGhpcy5mb2cgPSBuZXcgRm9nKCk7XG5cbiAgdGhpcy5fc2hhZG93TWFwQ2FtZXJhID0gbmV3IENhbWVyYSh0aGlzKTtcblxuICAvKipcbiAgICogVGhlIHNoYWRvdyBtYXAgZm9yIHRoZSBzY2VuZSdzIGxpZ2h0IHNvdXJjZS4gV2hlbiBlbmFibGVkLCBtb2RlbHMsIHByaW1pdGl2ZXMsIGFuZCB0aGUgZ2xvYmUgbWF5IGNhc3QgYW5kIHJlY2VpdmUgc2hhZG93cy5cbiAgICogQHR5cGUge1NoYWRvd01hcH1cbiAgICovXG4gIHRoaXMuc2hhZG93TWFwID0gbmV3IFNoYWRvd01hcCh7XG4gICAgY29udGV4dDogY29udGV4dCxcbiAgICBsaWdodENhbWVyYTogdGhpcy5fc2hhZG93TWFwQ2FtZXJhLFxuICAgIGVuYWJsZWQ6IGRlZmF1bHRWYWx1ZShvcHRpb25zLnNoYWRvd3MsIGZhbHNlKSxcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFdoZW4gPGNvZGU+ZmFsc2U8L2NvZGU+LCAzRCBUaWxlcyB3aWxsIHJlbmRlciBub3JtYWxseS4gV2hlbiA8Y29kZT50cnVlPC9jb2RlPiwgY2xhc3NpZmllZCAzRCBUaWxlIGdlb21ldHJ5IHdpbGwgcmVuZGVyIG5vcm1hbGx5IGFuZFxuICAgKiB1bmNsYXNzaWZpZWQgM0QgVGlsZSBnZW9tZXRyeSB3aWxsIHJlbmRlciB3aXRoIHRoZSBjb2xvciBtdWx0aXBsaWVkIGJ5IHtAbGluayBTY2VuZSNpbnZlcnRDbGFzc2lmaWNhdGlvbkNvbG9yfS5cbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICB0aGlzLmludmVydENsYXNzaWZpY2F0aW9uID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFRoZSBoaWdobGlnaHQgY29sb3Igb2YgdW5jbGFzc2lmaWVkIDNEIFRpbGUgZ2VvbWV0cnkgd2hlbiB7QGxpbmsgU2NlbmUjaW52ZXJ0Q2xhc3NpZmljYXRpb259IGlzIDxjb2RlPnRydWU8L2NvZGU+LlxuICAgKiA8cD5XaGVuIHRoZSBjb2xvcidzIGFscGhhIGlzIGxlc3MgdGhhbiAxLjAsIHRoZSB1bmNsYXNzaWZpZWQgcG9ydGlvbnMgb2YgdGhlIDNEIFRpbGVzIHdpbGwgbm90IGJsZW5kIGNvcnJlY3RseSB3aXRoIHRoZSBjbGFzc2lmaWVkIHBvc2l0aW9ucyBvZiB0aGUgM0QgVGlsZXMuPC9wPlxuICAgKiA8cD5BbHNvLCB3aGVuIHRoZSBjb2xvcidzIGFscGhhIGlzIGxlc3MgdGhhbiAxLjAsIHRoZSBXRUJHTF9kZXB0aF90ZXh0dXJlIGFuZCBFWFRfZnJhZ19kZXB0aCBXZWJHTCBleHRlbnNpb25zIG11c3QgYmUgc3VwcG9ydGVkLjwvcD5cbiAgICogQHR5cGUge0NvbG9yfVxuICAgKiBAZGVmYXVsdCBDb2xvci5XSElURVxuICAgKi9cbiAgdGhpcy5pbnZlcnRDbGFzc2lmaWNhdGlvbkNvbG9yID0gQ29sb3IuY2xvbmUoQ29sb3IuV0hJVEUpO1xuXG4gIHRoaXMuX2FjdHVhbEludmVydENsYXNzaWZpY2F0aW9uQ29sb3IgPSBDb2xvci5jbG9uZShcbiAgICB0aGlzLl9pbnZlcnRDbGFzc2lmaWNhdGlvbkNvbG9yXG4gICk7XG4gIHRoaXMuX2ludmVydENsYXNzaWZpY2F0aW9uID0gbmV3IEludmVydENsYXNzaWZpY2F0aW9uKCk7XG5cbiAgLyoqXG4gICAqIFRoZSBmb2NhbCBsZW5ndGggZm9yIHVzZSB3aGVuIHdpdGggY2FyZGJvYXJkIG9yIFdlYlZSLlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKi9cbiAgdGhpcy5mb2NhbExlbmd0aCA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogVGhlIGV5ZSBzZXBhcmF0aW9uIGRpc3RhbmNlIGluIG1ldGVycyBmb3IgdXNlIHdpdGggY2FyZGJvYXJkIG9yIFdlYlZSLlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKi9cbiAgdGhpcy5leWVTZXBhcmF0aW9uID0gdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBQb3N0IHByb2Nlc3NpbmcgZWZmZWN0cyBhcHBsaWVkIHRvIHRoZSBmaW5hbCByZW5kZXIuXG4gICAqIEB0eXBlIHtQb3N0UHJvY2Vzc1N0YWdlQ29sbGVjdGlvbn1cbiAgICovXG4gIHRoaXMucG9zdFByb2Nlc3NTdGFnZXMgPSBuZXcgUG9zdFByb2Nlc3NTdGFnZUNvbGxlY3Rpb24oKTtcblxuICB0aGlzLl9icmRmTHV0R2VuZXJhdG9yID0gbmV3IEJyZGZMdXRHZW5lcmF0b3IoKTtcblxuICB0aGlzLl9wZXJmb3JtYW5jZURpc3BsYXkgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2RlYnVnVm9sdW1lID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMuX3NjcmVlblNwYWNlQ2FtZXJhQ29udHJvbGxlciA9IG5ldyBTY3JlZW5TcGFjZUNhbWVyYUNvbnRyb2xsZXIodGhpcyk7XG4gIHRoaXMuX2NhbWVyYVVuZGVyZ3JvdW5kID0gZmFsc2U7XG4gIHRoaXMuX21hcE1vZGUyRCA9IGRlZmF1bHRWYWx1ZShvcHRpb25zLm1hcE1vZGUyRCwgTWFwTW9kZTJELklORklOSVRFX1NDUk9MTCk7XG5cbiAgLy8gS2VlcHMgdHJhY2sgb2YgdGhlIHN0YXRlIG9mIGEgZnJhbWUuIEZyYW1lU3RhdGUgaXMgdGhlIHN0YXRlIGFjcm9zc1xuICAvLyB0aGUgcHJpbWl0aXZlcyBvZiB0aGUgc2NlbmUuIFRoaXMgc3RhdGUgaXMgZm9yIGludGVybmFsbHkga2VlcGluZyB0cmFja1xuICAvLyBvZiBjZWxlc3RpYWwgYW5kIGVudmlyb25tZW50IGVmZmVjdHMgdGhhdCBuZWVkIHRvIGJlIHVwZGF0ZWQvcmVuZGVyZWQgaW5cbiAgLy8gYSBjZXJ0YWluIG9yZGVyIGFzIHdlbGwgYXMgdXBkYXRpbmcvdHJhY2tpbmcgZnJhbWVidWZmZXIgdXNhZ2UuXG4gIHRoaXMuX2Vudmlyb25tZW50U3RhdGUgPSB7XG4gICAgc2t5Qm94Q29tbWFuZDogdW5kZWZpbmVkLFxuICAgIHNreUF0bW9zcGhlcmVDb21tYW5kOiB1bmRlZmluZWQsXG4gICAgc3VuRHJhd0NvbW1hbmQ6IHVuZGVmaW5lZCxcbiAgICBzdW5Db21wdXRlQ29tbWFuZDogdW5kZWZpbmVkLFxuICAgIG1vb25Db21tYW5kOiB1bmRlZmluZWQsXG5cbiAgICBpc1N1blZpc2libGU6IGZhbHNlLFxuICAgIGlzTW9vblZpc2libGU6IGZhbHNlLFxuICAgIGlzUmVhZHlGb3JBdG1vc3BoZXJlOiBmYWxzZSxcbiAgICBpc1NreUF0bW9zcGhlcmVWaXNpYmxlOiBmYWxzZSxcblxuICAgIGNsZWFyR2xvYmVEZXB0aDogZmFsc2UsXG4gICAgdXNlRGVwdGhQbGFuZTogZmFsc2UsXG4gICAgcmVuZGVyVHJhbnNsdWNlbnREZXB0aEZvclBpY2s6IGZhbHNlLFxuXG4gICAgb3JpZ2luYWxGcmFtZWJ1ZmZlcjogdW5kZWZpbmVkLFxuICAgIHVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlcjogZmFsc2UsXG4gICAgc2VwYXJhdGVQcmltaXRpdmVGcmFtZWJ1ZmZlcjogZmFsc2UsXG4gICAgdXNlT0lUOiBmYWxzZSxcbiAgICB1c2VJbnZlcnRDbGFzc2lmaWNhdGlvbjogZmFsc2UsXG4gICAgdXNlUG9zdFByb2Nlc3M6IGZhbHNlLFxuICAgIHVzZVBvc3RQcm9jZXNzU2VsZWN0ZWQ6IGZhbHNlLFxuICAgIHVzZVdlYlZSOiBmYWxzZSxcbiAgfTtcblxuICB0aGlzLl91c2VXZWJWUiA9IGZhbHNlO1xuICB0aGlzLl9jYW1lcmFWUiA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fYXNwZWN0UmF0aW9WUiA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogV2hlbiA8Y29kZT50cnVlPC9jb2RlPiwgcmVuZGVyaW5nIGEgZnJhbWUgd2lsbCBvbmx5IG9jY3VyIHdoZW4gbmVlZGVkIGFzIGRldGVybWluZWQgYnkgY2hhbmdlcyB3aXRoaW4gdGhlIHNjZW5lLlxuICAgKiBFbmFibGluZyBpbXByb3ZlcyBwZXJmb3JtYW5jZSBvZiB0aGUgYXBwbGljYXRpb24sIGJ1dCByZXF1aXJlcyB1c2luZyB7QGxpbmsgU2NlbmUjcmVxdWVzdFJlbmRlcn1cbiAgICogdG8gcmVuZGVyIGEgbmV3IGZyYW1lIGV4cGxpY2l0bHkgaW4gdGhpcyBtb2RlLiBUaGlzIHdpbGwgYmUgbmVjZXNzYXJ5IGluIG1hbnkgY2FzZXMgYWZ0ZXIgbWFraW5nIGNoYW5nZXNcbiAgICogdG8gdGhlIHNjZW5lIGluIG90aGVyIHBhcnRzIG9mIHRoZSBBUEkuXG4gICAqXG4gICAqIEBzZWUge0BsaW5rIGh0dHBzOi8vY2VzaXVtLmNvbS9ibG9nLzIwMTgvMDEvMjQvY2VzaXVtLXNjZW5lLXJlbmRlcmluZy1wZXJmb3JtYW5jZS98SW1wcm92aW5nIFBlcmZvcm1hbmNlIHdpdGggRXhwbGljaXQgUmVuZGVyaW5nfVxuICAgKiBAc2VlIFNjZW5lI21heGltdW1SZW5kZXJUaW1lQ2hhbmdlXG4gICAqIEBzZWUgU2NlbmUjcmVxdWVzdFJlbmRlclxuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHRoaXMucmVxdWVzdFJlbmRlck1vZGUgPSBkZWZhdWx0VmFsdWUob3B0aW9ucy5yZXF1ZXN0UmVuZGVyTW9kZSwgZmFsc2UpO1xuICB0aGlzLl9yZW5kZXJSZXF1ZXN0ZWQgPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBJZiB7QGxpbmsgU2NlbmUjcmVxdWVzdFJlbmRlck1vZGV9IGlzIDxjb2RlPnRydWU8L2NvZGU+LCB0aGlzIHZhbHVlIGRlZmluZXMgdGhlIG1heGltdW0gY2hhbmdlIGluXG4gICAqIHNpbXVsYXRpb24gdGltZSBhbGxvd2VkIGJlZm9yZSBhIHJlbmRlciBpcyByZXF1ZXN0ZWQuIExvd2VyIHZhbHVlcyBpbmNyZWFzZSB0aGUgbnVtYmVyIG9mIGZyYW1lcyByZW5kZXJlZFxuICAgKiBhbmQgaGlnaGVyIHZhbHVlcyBkZWNyZWFzZSB0aGUgbnVtYmVyIG9mIGZyYW1lcyByZW5kZXJlZC4gSWYgPGNvZGU+dW5kZWZpbmVkPC9jb2RlPiwgY2hhbmdlcyB0b1xuICAgKiB0aGUgc2ltdWxhdGlvbiB0aW1lIHdpbGwgbmV2ZXIgcmVxdWVzdCBhIHJlbmRlci5cbiAgICogVGhpcyB2YWx1ZSBpbXBhY3RzIHRoZSByYXRlIG9mIHJlbmRlcmluZyBmb3IgY2hhbmdlcyBpbiB0aGUgc2NlbmUgbGlrZSBsaWdodGluZywgZW50aXR5IHByb3BlcnR5IHVwZGF0ZXMsXG4gICAqIGFuZCBhbmltYXRpb25zLlxuICAgKlxuICAgKiBAc2VlIHtAbGluayBodHRwczovL2Nlc2l1bS5jb20vYmxvZy8yMDE4LzAxLzI0L2Nlc2l1bS1zY2VuZS1yZW5kZXJpbmctcGVyZm9ybWFuY2UvfEltcHJvdmluZyBQZXJmb3JtYW5jZSB3aXRoIEV4cGxpY2l0IFJlbmRlcmluZ31cbiAgICogQHNlZSBTY2VuZSNyZXF1ZXN0UmVuZGVyTW9kZVxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAwLjBcbiAgICovXG4gIHRoaXMubWF4aW11bVJlbmRlclRpbWVDaGFuZ2UgPSBkZWZhdWx0VmFsdWUoXG4gICAgb3B0aW9ucy5tYXhpbXVtUmVuZGVyVGltZUNoYW5nZSxcbiAgICAwLjBcbiAgKTtcbiAgdGhpcy5fbGFzdFJlbmRlclRpbWUgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2ZyYW1lUmF0ZU1vbml0b3IgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fcmVtb3ZlUmVxdWVzdExpc3RlbmVyQ2FsbGJhY2sgPSBSZXF1ZXN0U2NoZWR1bGVyLnJlcXVlc3RDb21wbGV0ZWRFdmVudC5hZGRFdmVudExpc3RlbmVyKFxuICAgIHJlcXVlc3RSZW5kZXJBZnRlckZyYW1lKHRoaXMpXG4gICk7XG4gIHRoaXMuX3JlbW92ZVRhc2tQcm9jZXNzb3JMaXN0ZW5lckNhbGxiYWNrID0gVGFza1Byb2Nlc3Nvci50YXNrQ29tcGxldGVkRXZlbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICByZXF1ZXN0UmVuZGVyQWZ0ZXJGcmFtZSh0aGlzKVxuICApO1xuICB0aGlzLl9yZW1vdmVHbG9iZUNhbGxiYWNrcyA9IFtdO1xuXG4gIHZhciB2aWV3cG9ydCA9IG5ldyBCb3VuZGluZ1JlY3RhbmdsZShcbiAgICAwLFxuICAgIDAsXG4gICAgY29udGV4dC5kcmF3aW5nQnVmZmVyV2lkdGgsXG4gICAgY29udGV4dC5kcmF3aW5nQnVmZmVySGVpZ2h0XG4gICk7XG4gIHZhciBjYW1lcmEgPSBuZXcgQ2FtZXJhKHRoaXMpO1xuXG4gIGlmICh0aGlzLl9sb2dEZXB0aEJ1ZmZlcikge1xuICAgIGNhbWVyYS5mcnVzdHVtLm5lYXIgPSAwLjE7XG4gICAgY2FtZXJhLmZydXN0dW0uZmFyID0gMTAwMDAwMDAwMDAuMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgY2FtZXJhIHZpZXcgZm9yIHRoZSBzY2VuZSBjYW1lcmEgZmxpZ2h0IGRlc3RpbmF0aW9uLiBVc2VkIGZvciBwcmVsb2FkaW5nIGZsaWdodCBkZXN0aW5hdGlvbiB0aWxlcy5cbiAgICogQHR5cGUge0NhbWVyYX1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMucHJlbG9hZEZsaWdodENhbWVyYSA9IG5ldyBDYW1lcmEodGhpcyk7XG5cbiAgLyoqXG4gICAqIFRoZSBjdWxsaW5nIHZvbHVtZSBmb3IgdGhlIHNjZW5lIGNhbWVyYSBmbGlnaHQgZGVzdGluYXRpb24uIFVzZWQgZm9yIHByZWxvYWRpbmcgZmxpZ2h0IGRlc3RpbmF0aW9uIHRpbGVzLlxuICAgKiBAdHlwZSB7Q3VsbGluZ1ZvbHVtZX1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMucHJlbG9hZEZsaWdodEN1bGxpbmdWb2x1bWUgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fcGlja2luZyA9IG5ldyBQaWNraW5nKHRoaXMpO1xuICB0aGlzLl9kZWZhdWx0VmlldyA9IG5ldyBWaWV3KHRoaXMsIGNhbWVyYSwgdmlld3BvcnQpO1xuICB0aGlzLl92aWV3ID0gdGhpcy5fZGVmYXVsdFZpZXc7XG5cbiAgdGhpcy5faGRyID0gdW5kZWZpbmVkO1xuICB0aGlzLl9oZHJEaXJ0eSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5oaWdoRHluYW1pY1JhbmdlID0gZmFsc2U7XG4gIHRoaXMuZ2FtbWEgPSAyLjI7XG5cbiAgLyoqXG4gICAqIFRoZSBzcGhlcmljYWwgaGFybW9uaWMgY29lZmZpY2llbnRzIGZvciBpbWFnZS1iYXNlZCBsaWdodGluZyBvZiBQQlIgbW9kZWxzLlxuICAgKiBAdHlwZSB7Q2FydGVzaWFuM1tdfVxuICAgKi9cbiAgdGhpcy5zcGhlcmljYWxIYXJtb25pY0NvZWZmaWNpZW50cyA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogVGhlIHVybCB0byB0aGUgS1RYMiBmaWxlIGNvbnRhaW5pbmcgdGhlIHNwZWN1bGFyIGVudmlyb25tZW50IG1hcCBhbmQgY29udm9sdXRlZCBtaXBtYXBzIGZvciBpbWFnZS1iYXNlZCBsaWdodGluZyBvZiBQQlIgbW9kZWxzLlxuICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgKi9cbiAgdGhpcy5zcGVjdWxhckVudmlyb25tZW50TWFwcyA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fc3BlY3VsYXJFbnZpcm9ubWVudE1hcEF0bGFzID0gdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBUaGUgbGlnaHQgc291cmNlIGZvciBzaGFkaW5nLiBEZWZhdWx0cyB0byBhIGRpcmVjdGlvbmFsIGxpZ2h0IGZyb20gdGhlIFN1bi5cbiAgICogQHR5cGUge0xpZ2h0fVxuICAgKi9cbiAgdGhpcy5saWdodCA9IG5ldyBTdW5MaWdodCgpO1xuXG4gIC8vIEdpdmUgZnJhbWVTdGF0ZSwgY2FtZXJhLCBhbmQgc2NyZWVuIHNwYWNlIGNhbWVyYSBjb250cm9sbGVyIGluaXRpYWwgc3RhdGUgYmVmb3JlIHJlbmRlcmluZ1xuICB1cGRhdGVGcmFtZU51bWJlcih0aGlzLCAwLjAsIEp1bGlhbkRhdGUubm93KCkpO1xuICB0aGlzLnVwZGF0ZUZyYW1lU3RhdGUoKTtcbiAgdGhpcy5pbml0aWFsaXplRnJhbWUoKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlR2xvYmVMaXN0ZW5lcnMoc2NlbmUsIGdsb2JlKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc2NlbmUuX3JlbW92ZUdsb2JlQ2FsbGJhY2tzLmxlbmd0aDsgKytpKSB7XG4gICAgc2NlbmUuX3JlbW92ZUdsb2JlQ2FsbGJhY2tzW2ldKCk7XG4gIH1cbiAgc2NlbmUuX3JlbW92ZUdsb2JlQ2FsbGJhY2tzLmxlbmd0aCA9IDA7XG5cbiAgdmFyIHJlbW92ZUdsb2JlQ2FsbGJhY2tzID0gW107XG4gIGlmIChkZWZpbmVkKGdsb2JlKSkge1xuICAgIHJlbW92ZUdsb2JlQ2FsbGJhY2tzLnB1c2goXG4gICAgICBnbG9iZS5pbWFnZXJ5TGF5ZXJzVXBkYXRlZEV2ZW50LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgIHJlcXVlc3RSZW5kZXJBZnRlckZyYW1lKHNjZW5lKVxuICAgICAgKVxuICAgICk7XG4gICAgcmVtb3ZlR2xvYmVDYWxsYmFja3MucHVzaChcbiAgICAgIGdsb2JlLnRlcnJhaW5Qcm92aWRlckNoYW5nZWQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgcmVxdWVzdFJlbmRlckFmdGVyRnJhbWUoc2NlbmUpXG4gICAgICApXG4gICAgKTtcbiAgfVxuICBzY2VuZS5fcmVtb3ZlR2xvYmVDYWxsYmFja3MgPSByZW1vdmVHbG9iZUNhbGxiYWNrcztcbn1cblxuT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoU2NlbmUucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjYW52YXMgZWxlbWVudCB0byB3aGljaCB0aGlzIHNjZW5lIGlzIGJvdW5kLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtIVE1MQ2FudmFzRWxlbWVudH1cbiAgICogQHJlYWRvbmx5XG4gICAqL1xuICBjYW52YXM6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jYW52YXM7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVGhlIGRyYXdpbmdCdWZmZXJIZWlnaHQgb2YgdGhlIHVuZGVybHlpbmcgR0wgY29udGV4dC5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAcmVhZG9ubHlcbiAgICpcbiAgICogQHNlZSB7QGxpbmsgaHR0cHM6Ly93d3cua2hyb25vcy5vcmcvcmVnaXN0cnkvd2ViZ2wvc3BlY3MvMS4wLyNET00tV2ViR0xSZW5kZXJpbmdDb250ZXh0LWRyYXdpbmdCdWZmZXJIZWlnaHR8ZHJhd2luZ0J1ZmZlckhlaWdodH1cbiAgICovXG4gIGRyYXdpbmdCdWZmZXJIZWlnaHQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jb250ZXh0LmRyYXdpbmdCdWZmZXJIZWlnaHQ7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVGhlIGRyYXdpbmdCdWZmZXJIZWlnaHQgb2YgdGhlIHVuZGVybHlpbmcgR0wgY29udGV4dC5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAcmVhZG9ubHlcbiAgICpcbiAgICogQHNlZSB7QGxpbmsgaHR0cHM6Ly93d3cua2hyb25vcy5vcmcvcmVnaXN0cnkvd2ViZ2wvc3BlY3MvMS4wLyNET00tV2ViR0xSZW5kZXJpbmdDb250ZXh0LWRyYXdpbmdCdWZmZXJIZWlnaHR8ZHJhd2luZ0J1ZmZlckhlaWdodH1cbiAgICovXG4gIGRyYXdpbmdCdWZmZXJXaWR0aDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHQuZHJhd2luZ0J1ZmZlcldpZHRoO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoZSBtYXhpbXVtIGFsaWFzZWQgbGluZSB3aWR0aCwgaW4gcGl4ZWxzLCBzdXBwb3J0ZWQgYnkgdGhpcyBXZWJHTCBpbXBsZW1lbnRhdGlvbi4gIEl0IHdpbGwgYmUgYXQgbGVhc3Qgb25lLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAqIEByZWFkb25seVxuICAgKlxuICAgKiBAc2VlIHtAbGluayBodHRwczovL3d3dy5raHJvbm9zLm9yZy9vcGVuZ2xlcy9zZGsvZG9jcy9tYW4veGh0bWwvZ2xHZXQueG1sfGdsR2V0fSB3aXRoIDxjb2RlPkFMSUFTRURfTElORV9XSURUSF9SQU5HRTwvY29kZT4uXG4gICAqL1xuICBtYXhpbXVtQWxpYXNlZExpbmVXaWR0aDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIENvbnRleHRMaW1pdHMubWF4aW11bUFsaWFzZWRMaW5lV2lkdGg7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVGhlIG1heGltdW0gbGVuZ3RoIGluIHBpeGVscyBvZiBvbmUgZWRnZSBvZiBhIGN1YmUgbWFwLCBzdXBwb3J0ZWQgYnkgdGhpcyBXZWJHTCBpbXBsZW1lbnRhdGlvbi4gIEl0IHdpbGwgYmUgYXQgbGVhc3QgMTYuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICpcbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQHJlYWRvbmx5XG4gICAqXG4gICAqIEBzZWUge0BsaW5rIGh0dHBzOi8vd3d3Lmtocm9ub3Mub3JnL29wZW5nbGVzL3Nkay9kb2NzL21hbi94aHRtbC9nbEdldC54bWx8Z2xHZXR9IHdpdGggPGNvZGU+R0xfTUFYX0NVQkVfTUFQX1RFWFRVUkVfU0laRTwvY29kZT4uXG4gICAqL1xuICBtYXhpbXVtQ3ViZU1hcFNpemU6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBDb250ZXh0TGltaXRzLm1heGltdW1DdWJlTWFwU2l6ZTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIDxjb2RlPnRydWU8L2NvZGU+IGlmIHRoZSB7QGxpbmsgU2NlbmUjcGlja1Bvc2l0aW9ufSBmdW5jdGlvbiBpcyBzdXBwb3J0ZWQuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICpcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEByZWFkb25seVxuICAgKlxuICAgKiBAc2VlIFNjZW5lI3BpY2tQb3NpdGlvblxuICAgKi9cbiAgcGlja1Bvc2l0aW9uU3VwcG9ydGVkOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fY29udGV4dC5kZXB0aFRleHR1cmU7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJucyA8Y29kZT50cnVlPC9jb2RlPiBpZiB0aGUge0BsaW5rIFNjZW5lI3NhbXBsZUhlaWdodH0gYW5kIHtAbGluayBTY2VuZSNzYW1wbGVIZWlnaHRNb3N0RGV0YWlsZWR9IGZ1bmN0aW9ucyBhcmUgc3VwcG9ydGVkLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAcmVhZG9ubHlcbiAgICpcbiAgICogQHNlZSBTY2VuZSNzYW1wbGVIZWlnaHRcbiAgICogQHNlZSBTY2VuZSNzYW1wbGVIZWlnaHRNb3N0RGV0YWlsZWRcbiAgICovXG4gIHNhbXBsZUhlaWdodFN1cHBvcnRlZDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHQuZGVwdGhUZXh0dXJlO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybnMgPGNvZGU+dHJ1ZTwvY29kZT4gaWYgdGhlIHtAbGluayBTY2VuZSNjbGFtcFRvSGVpZ2h0fSBhbmQge0BsaW5rIFNjZW5lI2NsYW1wVG9IZWlnaHRNb3N0RGV0YWlsZWR9IGZ1bmN0aW9ucyBhcmUgc3VwcG9ydGVkLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAcmVhZG9ubHlcbiAgICpcbiAgICogQHNlZSBTY2VuZSNjbGFtcFRvSGVpZ2h0XG4gICAqIEBzZWUgU2NlbmUjY2xhbXBUb0hlaWdodE1vc3REZXRhaWxlZFxuICAgKi9cbiAgY2xhbXBUb0hlaWdodFN1cHBvcnRlZDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHQuZGVwdGhUZXh0dXJlO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybnMgPGNvZGU+dHJ1ZTwvY29kZT4gaWYgdGhlIHtAbGluayBTY2VuZSNpbnZlcnRDbGFzc2lmaWNhdGlvbn0gaXMgc3VwcG9ydGVkLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAcmVhZG9ubHlcbiAgICpcbiAgICogQHNlZSBTY2VuZSNpbnZlcnRDbGFzc2lmaWNhdGlvblxuICAgKi9cbiAgaW52ZXJ0Q2xhc3NpZmljYXRpb25TdXBwb3J0ZWQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jb250ZXh0LmRlcHRoVGV4dHVyZTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIDxjb2RlPnRydWU8L2NvZGU+IGlmIHNwZWN1bGFyIGVudmlyb25tZW50IG1hcHMgYXJlIHN1cHBvcnRlZC5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQHJlYWRvbmx5XG4gICAqXG4gICAqIEBzZWUgU2NlbmUjc3BlY3VsYXJFbnZpcm9ubWVudE1hcHNcbiAgICovXG4gIHNwZWN1bGFyRW52aXJvbm1lbnRNYXBzU3VwcG9ydGVkOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gT2N0YWhlZHJhbFByb2plY3RlZEN1YmVNYXAuaXNTdXBwb3J0ZWQodGhpcy5fY29udGV4dCk7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBkZXB0aC10ZXN0IGVsbGlwc29pZC5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7R2xvYmV9XG4gICAqL1xuICBnbG9iZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2dsb2JlO1xuICAgIH0sXG5cbiAgICBzZXQ6IGZ1bmN0aW9uIChnbG9iZSkge1xuICAgICAgdGhpcy5fZ2xvYmUgPSB0aGlzLl9nbG9iZSAmJiB0aGlzLl9nbG9iZS5kZXN0cm95KCk7XG4gICAgICB0aGlzLl9nbG9iZSA9IGdsb2JlO1xuXG4gICAgICB1cGRhdGVHbG9iZUxpc3RlbmVycyh0aGlzLCBnbG9iZSk7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyB0aGUgY29sbGVjdGlvbiBvZiBwcmltaXRpdmVzLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtQcmltaXRpdmVDb2xsZWN0aW9ufVxuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIHByaW1pdGl2ZXM6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wcmltaXRpdmVzO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGNvbGxlY3Rpb24gb2YgZ3JvdW5kIHByaW1pdGl2ZXMuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICpcbiAgICogQHR5cGUge1ByaW1pdGl2ZUNvbGxlY3Rpb259XG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgZ3JvdW5kUHJpbWl0aXZlczoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2dyb3VuZFByaW1pdGl2ZXM7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBjYW1lcmEuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICpcbiAgICogQHR5cGUge0NhbWVyYX1cbiAgICogQHJlYWRvbmx5XG4gICAqL1xuICBjYW1lcmE6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl92aWV3LmNhbWVyYTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKGNhbWVyYSkge1xuICAgICAgLy8gRm9yIGludGVybmFsIHVzZSBvbmx5LiBEb2N1bWVudGF0aW9uIGlzIHN0aWxsIEByZWFkb25seS5cbiAgICAgIHRoaXMuX3ZpZXcuY2FtZXJhID0gY2FtZXJhO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyB0aGUgdmlldy5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7Vmlld31cbiAgICogQHJlYWRvbmx5XG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB2aWV3OiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdmlldztcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZpZXcpIHtcbiAgICAgIC8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4gRG9jdW1lbnRhdGlvbiBpcyBzdGlsbCBAcmVhZG9ubHkuXG4gICAgICB0aGlzLl92aWV3ID0gdmlldztcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBkZWZhdWx0IHZpZXcuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICpcbiAgICogQHR5cGUge1ZpZXd9XG4gICAqIEByZWFkb25seVxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZGVmYXVsdFZpZXc6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0VmlldztcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHBpY2tpbmcgZnVuY3Rpb25zIGFuZCBzdGF0ZVxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtQaWNraW5nfVxuICAgKiBAcmVhZG9ubHlcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHBpY2tpbmc6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9waWNraW5nO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGNvbnRyb2xsZXIgZm9yIGNhbWVyYSBpbnB1dCBoYW5kbGluZy5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7U2NyZWVuU3BhY2VDYW1lcmFDb250cm9sbGVyfVxuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIHNjcmVlblNwYWNlQ2FtZXJhQ29udHJvbGxlcjoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3NjcmVlblNwYWNlQ2FtZXJhQ29udHJvbGxlcjtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIG1hcCBwcm9qZWN0aW9uIHRvIHVzZSBpbiAyRCBhbmQgQ29sdW1idXMgVmlldyBtb2Rlcy5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7TWFwUHJvamVjdGlvbn1cbiAgICogQHJlYWRvbmx5XG4gICAqXG4gICAqIEBkZWZhdWx0IG5ldyBHZW9ncmFwaGljUHJvamVjdGlvbigpXG4gICAqL1xuICBtYXBQcm9qZWN0aW9uOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbWFwUHJvamVjdGlvbjtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBqb2Igc2NoZWR1bGVyXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICogQHR5cGUge0pvYlNjaGVkdWxlcn1cbiAgICogQHJlYWRvbmx5XG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBqb2JTY2hlZHVsZXI6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9qb2JTY2hlZHVsZXI7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBzdGF0ZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgY3VycmVudCBzY2VuZS4gSWYgY2FsbGVkIG91dHNpZGUgb2YgYSBwcmltaXRpdmUncyA8Y29kZT51cGRhdGU8L2NvZGU+XG4gICAqIGZ1bmN0aW9uLCB0aGUgcHJldmlvdXMgZnJhbWUncyBzdGF0ZSBpcyByZXR1cm5lZC5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7RnJhbWVTdGF0ZX1cbiAgICogQHJlYWRvbmx5XG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBmcmFtZVN0YXRlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZnJhbWVTdGF0ZTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBlbnZpcm9ubWVudCBzdGF0ZS5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7RW52aXJvbm1lbnRTdGF0ZX1cbiAgICogQHJlYWRvbmx5XG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBlbnZpcm9ubWVudFN0YXRlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZW52aXJvbm1lbnRTdGF0ZTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjb2xsZWN0aW9uIG9mIHR3ZWVucyB0YWtpbmcgcGxhY2UgaW4gdGhlIHNjZW5lLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtUd2VlbkNvbGxlY3Rpb259XG4gICAqIEByZWFkb25seVxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdHdlZW5zOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdHdlZW5zO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGNvbGxlY3Rpb24gb2YgaW1hZ2UgbGF5ZXJzIHRoYXQgd2lsbCBiZSByZW5kZXJlZCBvbiB0aGUgZ2xvYmUuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICpcbiAgICogQHR5cGUge0ltYWdlcnlMYXllckNvbGxlY3Rpb259XG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgaW1hZ2VyeUxheWVyczoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCFkZWZpbmVkKHRoaXMuZ2xvYmUpKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmdsb2JlLmltYWdlcnlMYXllcnM7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVGhlIHRlcnJhaW4gcHJvdmlkZXIgcHJvdmlkaW5nIHN1cmZhY2UgZ2VvbWV0cnkgZm9yIHRoZSBnbG9iZS5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7VGVycmFpblByb3ZpZGVyfVxuICAgKi9cbiAgdGVycmFpblByb3ZpZGVyOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoIWRlZmluZWQodGhpcy5nbG9iZSkpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuZ2xvYmUudGVycmFpblByb3ZpZGVyO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodGVycmFpblByb3ZpZGVyKSB7XG4gICAgICBpZiAoZGVmaW5lZCh0aGlzLmdsb2JlKSkge1xuICAgICAgICB0aGlzLmdsb2JlLnRlcnJhaW5Qcm92aWRlciA9IHRlcnJhaW5Qcm92aWRlcjtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIGFuIGV2ZW50IHRoYXQncyByYWlzZWQgd2hlbiB0aGUgdGVycmFpbiBwcm92aWRlciBpcyBjaGFuZ2VkXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICpcbiAgICogQHR5cGUge0V2ZW50fVxuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIHRlcnJhaW5Qcm92aWRlckNoYW5nZWQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghZGVmaW5lZCh0aGlzLmdsb2JlKSkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5nbG9iZS50ZXJyYWluUHJvdmlkZXJDaGFuZ2VkO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGV2ZW50IHRoYXQgd2lsbCBiZSByYWlzZWQgYmVmb3JlIHRoZSBzY2VuZSBpcyB1cGRhdGVkIG9yIHJlbmRlcmVkLiAgU3Vic2NyaWJlcnMgdG8gdGhlIGV2ZW50XG4gICAqIHJlY2VpdmUgdGhlIFNjZW5lIGluc3RhbmNlIGFzIHRoZSBmaXJzdCBwYXJhbWV0ZXIgYW5kIHRoZSBjdXJyZW50IHRpbWUgYXMgdGhlIHNlY29uZCBwYXJhbWV0ZXIuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICpcbiAgICogQHNlZSB7QGxpbmsgaHR0cHM6Ly9jZXNpdW0uY29tL2Jsb2cvMjAxOC8wMS8yNC9jZXNpdW0tc2NlbmUtcmVuZGVyaW5nLXBlcmZvcm1hbmNlL3xJbXByb3ZpbmcgUGVyZm9ybWFuY2Ugd2l0aCBFeHBsaWNpdCBSZW5kZXJpbmd9XG4gICAqIEBzZWUgU2NlbmUjcG9zdFVwZGF0ZVxuICAgKiBAc2VlIFNjZW5lI3ByZVJlbmRlclxuICAgKiBAc2VlIFNjZW5lI3Bvc3RSZW5kZXJcbiAgICpcbiAgICogQHR5cGUge0V2ZW50fVxuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIHByZVVwZGF0ZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3ByZVVwZGF0ZTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBldmVudCB0aGF0IHdpbGwgYmUgcmFpc2VkIGltbWVkaWF0ZWx5IGFmdGVyIHRoZSBzY2VuZSBpcyB1cGRhdGVkIGFuZCBiZWZvcmUgdGhlIHNjZW5lIGlzIHJlbmRlcmVkLlxuICAgKiBTdWJzY3JpYmVycyB0byB0aGUgZXZlbnQgcmVjZWl2ZSB0aGUgU2NlbmUgaW5zdGFuY2UgYXMgdGhlIGZpcnN0IHBhcmFtZXRlciBhbmQgdGhlIGN1cnJlbnQgdGltZSBhcyB0aGUgc2Vjb25kXG4gICAqIHBhcmFtZXRlci5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAc2VlIHtAbGluayBodHRwczovL2Nlc2l1bS5jb20vYmxvZy8yMDE4LzAxLzI0L2Nlc2l1bS1zY2VuZS1yZW5kZXJpbmctcGVyZm9ybWFuY2UvfEltcHJvdmluZyBQZXJmb3JtYW5jZSB3aXRoIEV4cGxpY2l0IFJlbmRlcmluZ31cbiAgICogQHNlZSBTY2VuZSNwcmVVcGRhdGVcbiAgICogQHNlZSBTY2VuZSNwcmVSZW5kZXJcbiAgICogQHNlZSBTY2VuZSNwb3N0UmVuZGVyXG4gICAqXG4gICAqIEB0eXBlIHtFdmVudH1cbiAgICogQHJlYWRvbmx5XG4gICAqL1xuICBwb3N0VXBkYXRlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcG9zdFVwZGF0ZTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBldmVudCB0aGF0IHdpbGwgYmUgcmFpc2VkIHdoZW4gYW4gZXJyb3IgaXMgdGhyb3duIGluc2lkZSB0aGUgPGNvZGU+cmVuZGVyPC9jb2RlPiBmdW5jdGlvbi5cbiAgICogVGhlIFNjZW5lIGluc3RhbmNlIGFuZCB0aGUgdGhyb3duIGVycm9yIGFyZSB0aGUgb25seSB0d28gcGFyYW1ldGVycyBwYXNzZWQgdG8gdGhlIGV2ZW50IGhhbmRsZXIuXG4gICAqIEJ5IGRlZmF1bHQsIGVycm9ycyBhcmUgbm90IHJldGhyb3duIGFmdGVyIHRoaXMgZXZlbnQgaXMgcmFpc2VkLCBidXQgdGhhdCBjYW4gYmUgY2hhbmdlZCBieSBzZXR0aW5nXG4gICAqIHRoZSA8Y29kZT5yZXRocm93UmVuZGVyRXJyb3JzPC9jb2RlPiBwcm9wZXJ0eS5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7RXZlbnR9XG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgcmVuZGVyRXJyb3I6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJFcnJvcjtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBldmVudCB0aGF0IHdpbGwgYmUgcmFpc2VkIGFmdGVyIHRoZSBzY2VuZSBpcyB1cGRhdGVkIGFuZCBpbW1lZGlhdGVseSBiZWZvcmUgdGhlIHNjZW5lIGlzIHJlbmRlcmVkLlxuICAgKiBTdWJzY3JpYmVycyB0byB0aGUgZXZlbnQgcmVjZWl2ZSB0aGUgU2NlbmUgaW5zdGFuY2UgYXMgdGhlIGZpcnN0IHBhcmFtZXRlciBhbmQgdGhlIGN1cnJlbnQgdGltZSBhcyB0aGUgc2Vjb25kXG4gICAqIHBhcmFtZXRlci5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAc2VlIHtAbGluayBodHRwczovL2Nlc2l1bS5jb20vYmxvZy8yMDE4LzAxLzI0L2Nlc2l1bS1zY2VuZS1yZW5kZXJpbmctcGVyZm9ybWFuY2UvfEltcHJvdmluZyBQZXJmb3JtYW5jZSB3aXRoIEV4cGxpY2l0IFJlbmRlcmluZ31cbiAgICogQHNlZSBTY2VuZSNwcmVVcGRhdGVcbiAgICogQHNlZSBTY2VuZSNwb3N0VXBkYXRlXG4gICAqIEBzZWUgU2NlbmUjcG9zdFJlbmRlclxuICAgKlxuICAgKiBAdHlwZSB7RXZlbnR9XG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgcHJlUmVuZGVyOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcHJlUmVuZGVyO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGV2ZW50IHRoYXQgd2lsbCBiZSByYWlzZWQgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlIHNjZW5lIGlzIHJlbmRlcmVkLiAgU3Vic2NyaWJlcnMgdG8gdGhlIGV2ZW50XG4gICAqIHJlY2VpdmUgdGhlIFNjZW5lIGluc3RhbmNlIGFzIHRoZSBmaXJzdCBwYXJhbWV0ZXIgYW5kIHRoZSBjdXJyZW50IHRpbWUgYXMgdGhlIHNlY29uZCBwYXJhbWV0ZXIuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICpcbiAgICogQHNlZSB7QGxpbmsgaHR0cHM6Ly9jZXNpdW0uY29tL2Jsb2cvMjAxOC8wMS8yNC9jZXNpdW0tc2NlbmUtcmVuZGVyaW5nLXBlcmZvcm1hbmNlL3xJbXByb3ZpbmcgUGVyZm9ybWFuY2Ugd2l0aCBFeHBsaWNpdCBSZW5kZXJpbmd9XG4gICAqIEBzZWUgU2NlbmUjcHJlVXBkYXRlXG4gICAqIEBzZWUgU2NlbmUjcG9zdFVwZGF0ZVxuICAgKiBAc2VlIFNjZW5lI3Bvc3RSZW5kZXJcbiAgICpcbiAgICogQHR5cGUge0V2ZW50fVxuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIHBvc3RSZW5kZXI6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wb3N0UmVuZGVyO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHNpbXVsYXRpb24gdGltZSB3aGVuIHRoZSBzY2VuZSB3YXMgbGFzdCByZW5kZXJlZC4gUmV0dXJucyB1bmRlZmluZWQgaWYgdGhlIHNjZW5lIGhhcyBub3QgeWV0IGJlZW5cbiAgICogcmVuZGVyZWQuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICpcbiAgICogQHR5cGUge0p1bGlhbkRhdGV9XG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgbGFzdFJlbmRlclRpbWU6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9sYXN0UmVuZGVyVGltZTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqIEBwcml2YXRlXG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgY29udGV4dDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHQ7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVGhpcyBwcm9wZXJ0eSBpcyBmb3IgZGVidWdnaW5nIG9ubHk7IGl0IGlzIG5vdCBmb3IgcHJvZHVjdGlvbiB1c2UuXG4gICAqIDxwPlxuICAgKiBXaGVuIHtAbGluayBTY2VuZS5kZWJ1Z1Nob3dGcnVzdHVtc30gaXMgPGNvZGU+dHJ1ZTwvY29kZT4sIHRoaXMgY29udGFpbnNcbiAgICogcHJvcGVydGllcyB3aXRoIHN0YXRpc3RpY3MgYWJvdXQgdGhlIG51bWJlciBvZiBjb21tYW5kIGV4ZWN1dGUgcGVyIGZydXN0dW0uXG4gICAqIDxjb2RlPnRvdGFsQ29tbWFuZHM8L2NvZGU+IGlzIHRoZSB0b3RhbCBudW1iZXIgb2YgY29tbWFuZHMgZXhlY3V0ZWQsIGlnbm9yaW5nXG4gICAqIG92ZXJsYXAuIDxjb2RlPmNvbW1hbmRzSW5GcnVzdHVtczwvY29kZT4gaXMgYW4gYXJyYXkgd2l0aCB0aGUgbnVtYmVyIG9mIHRpbWVzXG4gICAqIGNvbW1hbmRzIGFyZSBleGVjdXRlZCByZWR1bmRhbnRseSwgZS5nLiwgaG93IG1hbnkgY29tbWFuZHMgb3ZlcmxhcCB0d28gb3JcbiAgICogdGhyZWUgZnJ1c3R1bXMuXG4gICAqIDwvcD5cbiAgICpcbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgKiBAcmVhZG9ubHlcbiAgICpcbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkXG4gICAqL1xuICBkZWJ1Z0ZydXN0dW1TdGF0aXN0aWNzOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdmlldy5kZWJ1Z0ZydXN0dW1TdGF0aXN0aWNzO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgd2hldGhlciBvciBub3QgdGhlIHNjZW5lIGlzIG9wdGltaXplZCBmb3IgM0Qgb25seSB2aWV3aW5nLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIHNjZW5lM0RPbmx5OiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZnJhbWVTdGF0ZS5zY2VuZTNET25seTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzY2VuZSBoYXMgb3JkZXIgaW5kZXBlbmRlbnQgdHJhbnNsdWNlbmN5IGVuYWJsZWQuXG4gICAqIE5vdGUgdGhhdCB0aGlzIG9ubHkgcmVmbGVjdHMgdGhlIG9yaWdpbmFsIGNvbnN0cnVjdGlvbiBvcHRpb24sIGFuZCB0aGVyZSBhcmVcbiAgICogb3RoZXIgZmFjdG9ycyB0aGF0IGNvdWxkIHByZXZlbnQgT0lUIGZyb20gZnVuY3Rpb25pbmcgb24gYSBnaXZlbiBzeXN0ZW0gY29uZmlndXJhdGlvbi5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQHJlYWRvbmx5XG4gICAqL1xuICBvcmRlckluZGVwZW5kZW50VHJhbnNsdWNlbmN5OiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdXNlT0lUO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGlzIHNjZW5lLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtTdHJpbmd9XG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgaWQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9pZDtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgdGhlIGN1cnJlbnQgbW9kZSBvZiB0aGUgc2NlbmUuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICogQHR5cGUge1NjZW5lTW9kZX1cbiAgICogQGRlZmF1bHQge0BsaW5rIFNjZW5lTW9kZS5TQ0VORTNEfVxuICAgKi9cbiAgbW9kZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX21vZGU7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICAgIGlmICh0aGlzLnNjZW5lM0RPbmx5ICYmIHZhbHVlICE9PSBTY2VuZU1vZGUuU0NFTkUzRCkge1xuICAgICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXG4gICAgICAgICAgXCJPbmx5IFNjZW5lTW9kZS5TQ0VORTNEIGlzIHZhbGlkIHdoZW4gc2NlbmUzRE9ubHkgaXMgdHJ1ZS5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG4gICAgICBpZiAodmFsdWUgPT09IFNjZW5lTW9kZS5TQ0VORTJEKSB7XG4gICAgICAgIHRoaXMubW9ycGhUbzJEKDApO1xuICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gU2NlbmVNb2RlLlNDRU5FM0QpIHtcbiAgICAgICAgdGhpcy5tb3JwaFRvM0QoMCk7XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSBTY2VuZU1vZGUuQ09MVU1CVVNfVklFVykge1xuICAgICAgICB0aGlzLm1vcnBoVG9Db2x1bWJ1c1ZpZXcoMCk7XG4gICAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXG4gICAgICAgICAgXCJ2YWx1ZSBtdXN0IGJlIGEgdmFsaWQgU2NlbmVNb2RlIGVudW1lcmF0aW9uLlwiXG4gICAgICAgICk7XG4gICAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuICAgICAgfVxuICAgICAgdGhpcy5fbW9kZSA9IHZhbHVlO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIG51bWJlciBvZiBmcnVzdHVtcyB1c2VkIGluIHRoZSBsYXN0IGZyYW1lLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtGcnVzdHVtQ29tbWFuZHNbXX1cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZydXN0dW1Db21tYW5kc0xpc3Q6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl92aWV3LmZydXN0dW1Db21tYW5kc0xpc3Q7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyB0aGUgbnVtYmVyIG9mIGZydXN0dW1zIHVzZWQgaW4gdGhlIGxhc3QgZnJhbWUuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICogQHR5cGUge051bWJlcn1cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIG51bWJlck9mRnJ1c3R1bXM6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl92aWV3LmZydXN0dW1Db21tYW5kc0xpc3QubGVuZ3RoO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFdoZW4gPGNvZGU+dHJ1ZTwvY29kZT4sIHNwbGl0cyB0aGUgc2NlbmUgaW50byB0d28gdmlld3BvcnRzIHdpdGggc3Rlcm9zY29waWMgdmlld3MgZm9yIHRoZSBsZWZ0IGFuZCByaWdodCBleWVzLlxuICAgKiBVc2VkIGZvciBjYXJkYm9hcmQgYW5kIFdlYlZSLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgdXNlV2ViVlI6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl91c2VXZWJWUjtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgaWYgKHRoaXMuY2FtZXJhLmZydXN0dW0gaW5zdGFuY2VvZiBPcnRob2dyYXBoaWNGcnVzdHVtKSB7XG4gICAgICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcbiAgICAgICAgICBcIlZSIGlzIHVuc3VwcG9ydGVkIHdpdGggYW4gb3J0aG9ncmFwaGljIHByb2plY3Rpb24uXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuICAgICAgdGhpcy5fdXNlV2ViVlIgPSB2YWx1ZTtcbiAgICAgIGlmICh0aGlzLl91c2VXZWJWUikge1xuICAgICAgICB0aGlzLl9mcmFtZVN0YXRlLmNyZWRpdERpc3BsYXkuY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICAgICAgICB0aGlzLl9jYW1lcmFWUiA9IG5ldyBDYW1lcmEodGhpcyk7XG4gICAgICAgIGlmICghZGVmaW5lZCh0aGlzLl9kZXZpY2VPcmllbnRhdGlvbkNhbWVyYUNvbnRyb2xsZXIpKSB7XG4gICAgICAgICAgdGhpcy5fZGV2aWNlT3JpZW50YXRpb25DYW1lcmFDb250cm9sbGVyID0gbmV3IERldmljZU9yaWVudGF0aW9uQ2FtZXJhQ29udHJvbGxlcihcbiAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fYXNwZWN0UmF0aW9WUiA9IHRoaXMuY2FtZXJhLmZydXN0dW0uYXNwZWN0UmF0aW87XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9mcmFtZVN0YXRlLmNyZWRpdERpc3BsYXkuY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgICAgICAgdGhpcy5fY2FtZXJhVlIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuX2RldmljZU9yaWVudGF0aW9uQ2FtZXJhQ29udHJvbGxlciA9XG4gICAgICAgICAgdGhpcy5fZGV2aWNlT3JpZW50YXRpb25DYW1lcmFDb250cm9sbGVyICYmXG4gICAgICAgICAgIXRoaXMuX2RldmljZU9yaWVudGF0aW9uQ2FtZXJhQ29udHJvbGxlci5pc0Rlc3Ryb3llZCgpICYmXG4gICAgICAgICAgdGhpcy5fZGV2aWNlT3JpZW50YXRpb25DYW1lcmFDb250cm9sbGVyLmRlc3Ryb3koKTtcblxuICAgICAgICB0aGlzLmNhbWVyYS5mcnVzdHVtLmFzcGVjdFJhdGlvID0gdGhpcy5fYXNwZWN0UmF0aW9WUjtcbiAgICAgICAgdGhpcy5jYW1lcmEuZnJ1c3R1bS54T2Zmc2V0ID0gMC4wO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgaWYgdGhlIDJEIG1hcCBpcyByb3RhdGFibGUgb3IgY2FuIGJlIHNjcm9sbGVkIGluZmluaXRlbHkgaW4gdGhlIGhvcml6b250YWwgZGlyZWN0aW9uLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtNYXBNb2RlMkR9XG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgbWFwTW9kZTJEOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbWFwTW9kZTJEO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyB0aGUgcG9zaXRpb24gb2YgdGhlIEltYWdlcnkgc3BsaXR0ZXIgd2l0aGluIHRoZSB2aWV3cG9ydC4gIFZhbGlkIHZhbHVlcyBhcmUgYmV0d2VlbiAwLjAgYW5kIDEuMC5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKi9cbiAgaW1hZ2VyeVNwbGl0UG9zaXRpb246IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9mcmFtZVN0YXRlLmltYWdlcnlTcGxpdFBvc2l0aW9uO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHRoaXMuX2ZyYW1lU3RhdGUuaW1hZ2VyeVNwbGl0UG9zaXRpb24gPSB2YWx1ZTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBUaGUgZGlzdGFuY2UgZnJvbSB0aGUgY2FtZXJhIGF0IHdoaWNoIHRvIGRpc2FibGUgdGhlIGRlcHRoIHRlc3Qgb2YgYmlsbGJvYXJkcywgbGFiZWxzIGFuZCBwb2ludHNcbiAgICogdG8sIGZvciBleGFtcGxlLCBwcmV2ZW50IGNsaXBwaW5nIGFnYWluc3QgdGVycmFpbi4gV2hlbiBzZXQgdG8gemVybywgdGhlIGRlcHRoIHRlc3Qgc2hvdWxkIGFsd2F5c1xuICAgKiBiZSBhcHBsaWVkLiBXaGVuIGxlc3MgdGhhbiB6ZXJvLCB0aGUgZGVwdGggdGVzdCBzaG91bGQgbmV2ZXIgYmUgYXBwbGllZC4gU2V0dGluZyB0aGUgZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlXG4gICAqIHByb3BlcnR5IG9mIGEgYmlsbGJvYXJkLCBsYWJlbCBvciBwb2ludCB3aWxsIG92ZXJyaWRlIHRoaXMgdmFsdWUuXG4gICAqIEBtZW1iZXJvZiBTY2VuZS5wcm90b3R5cGVcbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMC4wXG4gICAqL1xuICBtaW5pbXVtRGlzYWJsZURlcHRoVGVzdERpc3RhbmNlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbWluaW11bURpc2FibGVEZXB0aFRlc3REaXN0YW5jZTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgaWYgKCFkZWZpbmVkKHZhbHVlKSB8fCB2YWx1ZSA8IDAuMCkge1xuICAgICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXG4gICAgICAgICAgXCJtaW5pbXVtRGlzYWJsZURlcHRoVGVzdERpc3RhbmNlIG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDAuMC5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG4gICAgICB0aGlzLl9taW5pbXVtRGlzYWJsZURlcHRoVGVzdERpc3RhbmNlID0gdmFsdWU7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogV2hldGhlciBvciBub3QgdG8gdXNlIGEgbG9nYXJpdGhtaWMgZGVwdGggYnVmZmVyLiBFbmFibGluZyB0aGlzIG9wdGlvbiB3aWxsIGFsbG93IGZvciBsZXNzIGZydXN0dW1zIGluIHRoZSBtdWx0aS1mcnVzdHVtLFxuICAgKiBpbmNyZWFzaW5nIHBlcmZvcm1hbmNlLiBUaGlzIHByb3BlcnR5IHJlbGllcyBvbiBmcmFnbWVudERlcHRoIGJlaW5nIHN1cHBvcnRlZC5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICovXG4gIGxvZ2FyaXRobWljRGVwdGhCdWZmZXI6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9sb2dEZXB0aEJ1ZmZlcjtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB2YWx1ZSA9IHRoaXMuX2NvbnRleHQuZnJhZ21lbnREZXB0aCAmJiB2YWx1ZTtcbiAgICAgIGlmICh0aGlzLl9sb2dEZXB0aEJ1ZmZlciAhPT0gdmFsdWUpIHtcbiAgICAgICAgdGhpcy5fbG9nRGVwdGhCdWZmZXIgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fbG9nRGVwdGhCdWZmZXJEaXJ0eSA9IHRydWU7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVGhlIHZhbHVlIHVzZWQgZm9yIGdhbW1hIGNvcnJlY3Rpb24uIFRoaXMgaXMgb25seSB1c2VkIHdoZW4gcmVuZGVyaW5nIHdpdGggaGlnaCBkeW5hbWljIHJhbmdlLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAqIEBkZWZhdWx0IDIuMlxuICAgKi9cbiAgZ2FtbWE6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jb250ZXh0LnVuaWZvcm1TdGF0ZS5nYW1tYTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLl9jb250ZXh0LnVuaWZvcm1TdGF0ZS5nYW1tYSA9IHZhbHVlO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IHRvIHVzZSBoaWdoIGR5bmFtaWMgcmFuZ2UgcmVuZGVyaW5nLlxuICAgKiBAbWVtYmVyb2YgU2NlbmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICBoaWdoRHluYW1pY1JhbmdlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGRyO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5fY29udGV4dDtcbiAgICAgIHZhciBoZHIgPVxuICAgICAgICB2YWx1ZSAmJlxuICAgICAgICBjb250ZXh0LmRlcHRoVGV4dHVyZSAmJlxuICAgICAgICAoY29udGV4dC5jb2xvckJ1ZmZlckZsb2F0IHx8IGNvbnRleHQuY29sb3JCdWZmZXJIYWxmRmxvYXQpO1xuICAgICAgdGhpcy5faGRyRGlydHkgPSBoZHIgIT09IHRoaXMuX2hkcjtcbiAgICAgIHRoaXMuX2hkciA9IGhkcjtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIG9yIG5vdCBoaWdoIGR5bmFtaWMgcmFuZ2UgcmVuZGVyaW5nIGlzIHN1cHBvcnRlZC5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQHJlYWRvbmx5XG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIGhpZ2hEeW5hbWljUmFuZ2VTdXBwb3J0ZWQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5fY29udGV4dDtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGNvbnRleHQuZGVwdGhUZXh0dXJlICYmXG4gICAgICAgIChjb250ZXh0LmNvbG9yQnVmZmVyRmxvYXQgfHwgY29udGV4dC5jb2xvckJ1ZmZlckhhbGZGbG9hdClcbiAgICAgICk7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogV2hldGhlciBvciBub3QgdGhlIGNhbWVyYSBpcyB1bmRlcm5lYXRoIHRoZSBnbG9iZS5cbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQHJlYWRvbmx5XG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICBjYW1lcmFVbmRlcmdyb3VuZDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NhbWVyYVVuZGVyZ3JvdW5kO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFJhdGlvIGJldHdlZW4gYSBwaXhlbCBhbmQgYSBkZW5zaXR5LWluZGVwZW5kZW50IHBpeGVsLiBQcm92aWRlcyBhIHN0YW5kYXJkIHVuaXQgb2ZcbiAgICogbWVhc3VyZSBmb3IgcmVhbCBwaXhlbCBtZWFzdXJlbWVudHMgYXBwcm9wcmlhdGUgdG8gYSBwYXJ0aWN1bGFyIGRldmljZS5cbiAgICpcbiAgICogQG1lbWJlcm9mIFNjZW5lLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAxLjBcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHBpeGVsUmF0aW86IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9mcmFtZVN0YXRlLnBpeGVsUmF0aW87XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5fZnJhbWVTdGF0ZS5waXhlbFJhdGlvID0gdmFsdWU7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICovXG4gIG9wYXF1ZUZydXN0dW1OZWFyT2Zmc2V0OiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gMC45OTk5O1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBnbG9iZUhlaWdodDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2dsb2JlSGVpZ2h0O1xuICAgIH0sXG4gIH0sXG59KTtcblxuLyoqXG4gKiBEZXRlcm1pbmVzIGlmIGEgY29tcHJlc3NlZCB0ZXh0dXJlIGZvcm1hdCBpcyBzdXBwb3J0ZWQuXG4gKiBAcGFyYW0ge1N0cmluZ30gZm9ybWF0IFRoZSB0ZXh0dXJlIGZvcm1hdC4gTWF5IGJlIHRoZSBuYW1lIG9mIHRoZSBmb3JtYXQgb3IgdGhlIFdlYkdMIGV4dGVuc2lvbiBuYW1lLCBlLmcuIHMzdGMgb3IgV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIG9yIG5vdCB0aGUgZm9ybWF0IGlzIHN1cHBvcnRlZC5cbiAqL1xuU2NlbmUucHJvdG90eXBlLmdldENvbXByZXNzZWRUZXh0dXJlRm9ybWF0U3VwcG9ydGVkID0gZnVuY3Rpb24gKGZvcm1hdCkge1xuICB2YXIgY29udGV4dCA9IHRoaXMuY29udGV4dDtcbiAgcmV0dXJuIChcbiAgICAoKGZvcm1hdCA9PT0gXCJXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0Y1wiIHx8IGZvcm1hdCA9PT0gXCJzM3RjXCIpICYmXG4gICAgICBjb250ZXh0LnMzdGMpIHx8XG4gICAgKChmb3JtYXQgPT09IFwiV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3B2cnRjXCIgfHwgZm9ybWF0ID09PSBcInB2cnRjXCIpICYmXG4gICAgICBjb250ZXh0LnB2cnRjKSB8fFxuICAgICgoZm9ybWF0ID09PSBcIldFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9ldGNcIiB8fCBmb3JtYXQgPT09IFwiZXRjXCIpICYmXG4gICAgICBjb250ZXh0LmV0YykgfHxcbiAgICAoKGZvcm1hdCA9PT0gXCJXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfZXRjMVwiIHx8IGZvcm1hdCA9PT0gXCJldGMxXCIpICYmXG4gICAgICBjb250ZXh0LmV0YzEpIHx8XG4gICAgKChmb3JtYXQgPT09IFwiV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX2FzdGNcIiB8fCBmb3JtYXQgPT09IFwiYXN0Y1wiKSAmJlxuICAgICAgY29udGV4dC5hc3RjKSB8fFxuICAgICgoZm9ybWF0ID09PSBcIkVYVF90ZXh0dXJlX2NvbXByZXNzaW9uX2JwdGNcIiB8fCBmb3JtYXQgPT09IFwiYmM3XCIpICYmXG4gICAgICBjb250ZXh0LmJjNylcbiAgKTtcbn07XG5cbmZ1bmN0aW9uIHVwZGF0ZURlcml2ZWRDb21tYW5kcyhzY2VuZSwgY29tbWFuZCwgc2hhZG93c0RpcnR5KSB7XG4gIHZhciBmcmFtZVN0YXRlID0gc2NlbmUuX2ZyYW1lU3RhdGU7XG4gIHZhciBjb250ZXh0ID0gc2NlbmUuX2NvbnRleHQ7XG4gIHZhciBvaXQgPSBzY2VuZS5fdmlldy5vaXQ7XG4gIHZhciBsaWdodFNoYWRvd01hcHMgPSBmcmFtZVN0YXRlLnNoYWRvd1N0YXRlLmxpZ2h0U2hhZG93TWFwcztcbiAgdmFyIGxpZ2h0U2hhZG93c0VuYWJsZWQgPSBmcmFtZVN0YXRlLnNoYWRvd1N0YXRlLmxpZ2h0U2hhZG93c0VuYWJsZWQ7XG5cbiAgdmFyIGRlcml2ZWRDb21tYW5kcyA9IGNvbW1hbmQuZGVyaXZlZENvbW1hbmRzO1xuXG4gIGlmIChkZWZpbmVkKGNvbW1hbmQucGlja0lkKSkge1xuICAgIGRlcml2ZWRDb21tYW5kcy5waWNraW5nID0gRGVyaXZlZENvbW1hbmQuY3JlYXRlUGlja0Rlcml2ZWRDb21tYW5kKFxuICAgICAgc2NlbmUsXG4gICAgICBjb21tYW5kLFxuICAgICAgY29udGV4dCxcbiAgICAgIGRlcml2ZWRDb21tYW5kcy5waWNraW5nXG4gICAgKTtcbiAgfVxuXG4gIGlmICghY29tbWFuZC5waWNrT25seSkge1xuICAgIGRlcml2ZWRDb21tYW5kcy5kZXB0aCA9IERlcml2ZWRDb21tYW5kLmNyZWF0ZURlcHRoT25seURlcml2ZWRDb21tYW5kKFxuICAgICAgc2NlbmUsXG4gICAgICBjb21tYW5kLFxuICAgICAgY29udGV4dCxcbiAgICAgIGRlcml2ZWRDb21tYW5kcy5kZXB0aFxuICAgICk7XG4gIH1cblxuICBkZXJpdmVkQ29tbWFuZHMub3JpZ2luYWxDb21tYW5kID0gY29tbWFuZDtcblxuICBpZiAoc2NlbmUuX2hkcikge1xuICAgIGRlcml2ZWRDb21tYW5kcy5oZHIgPSBEZXJpdmVkQ29tbWFuZC5jcmVhdGVIZHJDb21tYW5kKFxuICAgICAgY29tbWFuZCxcbiAgICAgIGNvbnRleHQsXG4gICAgICBkZXJpdmVkQ29tbWFuZHMuaGRyXG4gICAgKTtcbiAgICBjb21tYW5kID0gZGVyaXZlZENvbW1hbmRzLmhkci5jb21tYW5kO1xuICAgIGRlcml2ZWRDb21tYW5kcyA9IGNvbW1hbmQuZGVyaXZlZENvbW1hbmRzO1xuICB9XG5cbiAgaWYgKGxpZ2h0U2hhZG93c0VuYWJsZWQgJiYgY29tbWFuZC5yZWNlaXZlU2hhZG93cykge1xuICAgIGRlcml2ZWRDb21tYW5kcy5zaGFkb3dzID0gU2hhZG93TWFwLmNyZWF0ZVJlY2VpdmVEZXJpdmVkQ29tbWFuZChcbiAgICAgIGxpZ2h0U2hhZG93TWFwcyxcbiAgICAgIGNvbW1hbmQsXG4gICAgICBzaGFkb3dzRGlydHksXG4gICAgICBjb250ZXh0LFxuICAgICAgZGVyaXZlZENvbW1hbmRzLnNoYWRvd3NcbiAgICApO1xuICB9XG5cbiAgaWYgKGNvbW1hbmQucGFzcyA9PT0gUGFzcy5UUkFOU0xVQ0VOVCAmJiBkZWZpbmVkKG9pdCkgJiYgb2l0LmlzU3VwcG9ydGVkKCkpIHtcbiAgICBpZiAobGlnaHRTaGFkb3dzRW5hYmxlZCAmJiBjb21tYW5kLnJlY2VpdmVTaGFkb3dzKSB7XG4gICAgICBkZXJpdmVkQ29tbWFuZHMub2l0ID0gZGVmaW5lZChkZXJpdmVkQ29tbWFuZHMub2l0KVxuICAgICAgICA/IGRlcml2ZWRDb21tYW5kcy5vaXRcbiAgICAgICAgOiB7fTtcbiAgICAgIGRlcml2ZWRDb21tYW5kcy5vaXQuc2hhZG93cyA9IG9pdC5jcmVhdGVEZXJpdmVkQ29tbWFuZHMoXG4gICAgICAgIGRlcml2ZWRDb21tYW5kcy5zaGFkb3dzLnJlY2VpdmVDb21tYW5kLFxuICAgICAgICBjb250ZXh0LFxuICAgICAgICBkZXJpdmVkQ29tbWFuZHMub2l0LnNoYWRvd3NcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlcml2ZWRDb21tYW5kcy5vaXQgPSBvaXQuY3JlYXRlRGVyaXZlZENvbW1hbmRzKFxuICAgICAgICBjb21tYW5kLFxuICAgICAgICBjb250ZXh0LFxuICAgICAgICBkZXJpdmVkQ29tbWFuZHMub2l0XG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cblNjZW5lLnByb3RvdHlwZS51cGRhdGVEZXJpdmVkQ29tbWFuZHMgPSBmdW5jdGlvbiAoY29tbWFuZCkge1xuICBpZiAoIWRlZmluZWQoY29tbWFuZC5kZXJpdmVkQ29tbWFuZHMpKSB7XG4gICAgLy8gSXMgbm90IGEgRHJhd0NvbW1hbmRcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgZnJhbWVTdGF0ZSA9IHRoaXMuX2ZyYW1lU3RhdGU7XG4gIHZhciBjb250ZXh0ID0gdGhpcy5fY29udGV4dDtcblxuICAvLyBVcGRhdGUgZGVyaXZlZCBjb21tYW5kcyB3aGVuIGFueSBzaGFkb3cgbWFwcyBiZWNvbWUgZGlydHlcbiAgdmFyIHNoYWRvd3NEaXJ0eSA9IGZhbHNlO1xuICB2YXIgbGFzdERpcnR5VGltZSA9IGZyYW1lU3RhdGUuc2hhZG93U3RhdGUubGFzdERpcnR5VGltZTtcbiAgaWYgKGNvbW1hbmQubGFzdERpcnR5VGltZSAhPT0gbGFzdERpcnR5VGltZSkge1xuICAgIGNvbW1hbmQubGFzdERpcnR5VGltZSA9IGxhc3REaXJ0eVRpbWU7XG4gICAgY29tbWFuZC5kaXJ0eSA9IHRydWU7XG4gICAgc2hhZG93c0RpcnR5ID0gdHJ1ZTtcbiAgfVxuXG4gIHZhciB1c2VMb2dEZXB0aCA9IGZyYW1lU3RhdGUudXNlTG9nRGVwdGg7XG4gIHZhciB1c2VIZHIgPSB0aGlzLl9oZHI7XG4gIHZhciBkZXJpdmVkQ29tbWFuZHMgPSBjb21tYW5kLmRlcml2ZWRDb21tYW5kcztcbiAgdmFyIGhhc0xvZ0RlcHRoRGVyaXZlZENvbW1hbmRzID0gZGVmaW5lZChkZXJpdmVkQ29tbWFuZHMubG9nRGVwdGgpO1xuICB2YXIgaGFzSGRyQ29tbWFuZHMgPSBkZWZpbmVkKGRlcml2ZWRDb21tYW5kcy5oZHIpO1xuICB2YXIgaGFzRGVyaXZlZENvbW1hbmRzID0gZGVmaW5lZChkZXJpdmVkQ29tbWFuZHMub3JpZ2luYWxDb21tYW5kKTtcbiAgdmFyIG5lZWRzTG9nRGVwdGhEZXJpdmVkQ29tbWFuZHMgPSB1c2VMb2dEZXB0aCAmJiAhaGFzTG9nRGVwdGhEZXJpdmVkQ29tbWFuZHM7XG4gIHZhciBuZWVkc0hkckNvbW1hbmRzID0gdXNlSGRyICYmICFoYXNIZHJDb21tYW5kcztcbiAgdmFyIG5lZWRzRGVyaXZlZENvbW1hbmRzID0gKCF1c2VMb2dEZXB0aCB8fCAhdXNlSGRyKSAmJiAhaGFzRGVyaXZlZENvbW1hbmRzO1xuICBjb21tYW5kLmRpcnR5ID1cbiAgICBjb21tYW5kLmRpcnR5IHx8XG4gICAgbmVlZHNMb2dEZXB0aERlcml2ZWRDb21tYW5kcyB8fFxuICAgIG5lZWRzSGRyQ29tbWFuZHMgfHxcbiAgICBuZWVkc0Rlcml2ZWRDb21tYW5kcztcblxuICBpZiAoY29tbWFuZC5kaXJ0eSkge1xuICAgIGNvbW1hbmQuZGlydHkgPSBmYWxzZTtcblxuICAgIHZhciBzaGFkb3dNYXBzID0gZnJhbWVTdGF0ZS5zaGFkb3dTdGF0ZS5zaGFkb3dNYXBzO1xuICAgIHZhciBzaGFkb3dzRW5hYmxlZCA9IGZyYW1lU3RhdGUuc2hhZG93U3RhdGUuc2hhZG93c0VuYWJsZWQ7XG4gICAgaWYgKHNoYWRvd3NFbmFibGVkICYmIGNvbW1hbmQuY2FzdFNoYWRvd3MpIHtcbiAgICAgIGRlcml2ZWRDb21tYW5kcy5zaGFkb3dzID0gU2hhZG93TWFwLmNyZWF0ZUNhc3REZXJpdmVkQ29tbWFuZChcbiAgICAgICAgc2hhZG93TWFwcyxcbiAgICAgICAgY29tbWFuZCxcbiAgICAgICAgc2hhZG93c0RpcnR5LFxuICAgICAgICBjb250ZXh0LFxuICAgICAgICBkZXJpdmVkQ29tbWFuZHMuc2hhZG93c1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoaGFzTG9nRGVwdGhEZXJpdmVkQ29tbWFuZHMgfHwgbmVlZHNMb2dEZXB0aERlcml2ZWRDb21tYW5kcykge1xuICAgICAgZGVyaXZlZENvbW1hbmRzLmxvZ0RlcHRoID0gRGVyaXZlZENvbW1hbmQuY3JlYXRlTG9nRGVwdGhDb21tYW5kKFxuICAgICAgICBjb21tYW5kLFxuICAgICAgICBjb250ZXh0LFxuICAgICAgICBkZXJpdmVkQ29tbWFuZHMubG9nRGVwdGhcbiAgICAgICk7XG4gICAgICB1cGRhdGVEZXJpdmVkQ29tbWFuZHMoXG4gICAgICAgIHRoaXMsXG4gICAgICAgIGRlcml2ZWRDb21tYW5kcy5sb2dEZXB0aC5jb21tYW5kLFxuICAgICAgICBzaGFkb3dzRGlydHlcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChoYXNEZXJpdmVkQ29tbWFuZHMgfHwgbmVlZHNEZXJpdmVkQ29tbWFuZHMpIHtcbiAgICAgIHVwZGF0ZURlcml2ZWRDb21tYW5kcyh0aGlzLCBjb21tYW5kLCBzaGFkb3dzRGlydHkpO1xuICAgIH1cbiAgfVxufTtcblxudmFyIHJlbmRlclRpbGVzZXRQYXNzU3RhdGUgPSBuZXcgQ2VzaXVtM0RUaWxlUGFzc1N0YXRlKHtcbiAgcGFzczogQ2VzaXVtM0RUaWxlUGFzcy5SRU5ERVIsXG59KTtcblxudmFyIHByZWxvYWRUaWxlc2V0UGFzc1N0YXRlID0gbmV3IENlc2l1bTNEVGlsZVBhc3NTdGF0ZSh7XG4gIHBhc3M6IENlc2l1bTNEVGlsZVBhc3MuUFJFTE9BRCxcbn0pO1xuXG52YXIgcHJlbG9hZEZsaWdodFRpbGVzZXRQYXNzU3RhdGUgPSBuZXcgQ2VzaXVtM0RUaWxlUGFzc1N0YXRlKHtcbiAgcGFzczogQ2VzaXVtM0RUaWxlUGFzcy5QUkVMT0FEX0ZMSUdIVCxcbn0pO1xuXG52YXIgcmVxdWVzdFJlbmRlck1vZGVEZWZlckNoZWNrUGFzc1N0YXRlID0gbmV3IENlc2l1bTNEVGlsZVBhc3NTdGF0ZSh7XG4gIHBhc3M6IENlc2l1bTNEVGlsZVBhc3MuUkVRVUVTVF9SRU5ERVJfTU9ERV9ERUZFUl9DSEVDSyxcbn0pO1xuXG52YXIgc2NyYXRjaE9jY2x1ZGVyQm91bmRpbmdTcGhlcmUgPSBuZXcgQm91bmRpbmdTcGhlcmUoKTtcbnZhciBzY3JhdGNoT2NjbHVkZXI7XG5cbmZ1bmN0aW9uIGdldE9jY2x1ZGVyKHNjZW5lKSB7XG4gIC8vIFRPRE86IFRoZSBvY2NsdWRlciBpcyB0aGUgdG9wLWxldmVsIGdsb2JlLiBXaGVuIHdlIGFkZFxuICAvLyAgICAgICBzdXBwb3J0IGZvciBtdWx0aXBsZSBjZW50cmFsIGJvZGllcywgdGhpcyBzaG91bGQgYmUgdGhlIGNsb3Nlc3Qgb25lLlxuICB2YXIgZ2xvYmUgPSBzY2VuZS5nbG9iZTtcbiAgaWYgKFxuICAgIHNjZW5lLl9tb2RlID09PSBTY2VuZU1vZGUuU0NFTkUzRCAmJlxuICAgIGRlZmluZWQoZ2xvYmUpICYmXG4gICAgZ2xvYmUuc2hvdyAmJlxuICAgICFzY2VuZS5fY2FtZXJhVW5kZXJncm91bmQgJiZcbiAgICAhc2NlbmUuX2dsb2JlVHJhbnNsdWNlbmN5U3RhdGUudHJhbnNsdWNlbnRcbiAgKSB7XG4gICAgdmFyIGVsbGlwc29pZCA9IGdsb2JlLmVsbGlwc29pZDtcbiAgICB2YXIgbWluaW11bVRlcnJhaW5IZWlnaHQgPSBzY2VuZS5mcmFtZVN0YXRlLm1pbmltdW1UZXJyYWluSGVpZ2h0O1xuICAgIHNjcmF0Y2hPY2NsdWRlckJvdW5kaW5nU3BoZXJlLnJhZGl1cyA9XG4gICAgICBlbGxpcHNvaWQubWluaW11bVJhZGl1cyArIG1pbmltdW1UZXJyYWluSGVpZ2h0O1xuICAgIHNjcmF0Y2hPY2NsdWRlciA9IE9jY2x1ZGVyLmZyb21Cb3VuZGluZ1NwaGVyZShcbiAgICAgIHNjcmF0Y2hPY2NsdWRlckJvdW5kaW5nU3BoZXJlLFxuICAgICAgc2NlbmUuY2FtZXJhLnBvc2l0aW9uV0MsXG4gICAgICBzY3JhdGNoT2NjbHVkZXJcbiAgICApO1xuICAgIHJldHVybiBzY3JhdGNoT2NjbHVkZXI7XG4gIH1cblxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cblNjZW5lLnByb3RvdHlwZS5jbGVhclBhc3NlcyA9IGZ1bmN0aW9uIChwYXNzZXMpIHtcbiAgcGFzc2VzLnJlbmRlciA9IGZhbHNlO1xuICBwYXNzZXMucGljayA9IGZhbHNlO1xuICBwYXNzZXMuZGVwdGggPSBmYWxzZTtcbiAgcGFzc2VzLnBvc3RQcm9jZXNzID0gZmFsc2U7XG4gIHBhc3Nlcy5vZmZzY3JlZW4gPSBmYWxzZTtcbn07XG5cbmZ1bmN0aW9uIHVwZGF0ZUZyYW1lTnVtYmVyKHNjZW5lLCBmcmFtZU51bWJlciwgdGltZSkge1xuICB2YXIgZnJhbWVTdGF0ZSA9IHNjZW5lLl9mcmFtZVN0YXRlO1xuICBmcmFtZVN0YXRlLmZyYW1lTnVtYmVyID0gZnJhbWVOdW1iZXI7XG4gIGZyYW1lU3RhdGUudGltZSA9IEp1bGlhbkRhdGUuY2xvbmUodGltZSwgZnJhbWVTdGF0ZS50aW1lKTtcbn1cblxuLyoqXG4gKiBAcHJpdmF0ZVxuICovXG5TY2VuZS5wcm90b3R5cGUudXBkYXRlRnJhbWVTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNhbWVyYSA9IHRoaXMuY2FtZXJhO1xuXG4gIHZhciBmcmFtZVN0YXRlID0gdGhpcy5fZnJhbWVTdGF0ZTtcbiAgZnJhbWVTdGF0ZS5jb21tYW5kTGlzdC5sZW5ndGggPSAwO1xuICBmcmFtZVN0YXRlLnNoYWRvd01hcHMubGVuZ3RoID0gMDtcbiAgZnJhbWVTdGF0ZS5icmRmTHV0R2VuZXJhdG9yID0gdGhpcy5fYnJkZkx1dEdlbmVyYXRvcjtcbiAgZnJhbWVTdGF0ZS5lbnZpcm9ubWVudE1hcCA9IHRoaXMuc2t5Qm94ICYmIHRoaXMuc2t5Qm94Ll9jdWJlTWFwO1xuICBmcmFtZVN0YXRlLm1vZGUgPSB0aGlzLl9tb2RlO1xuICBmcmFtZVN0YXRlLm1vcnBoVGltZSA9IHRoaXMubW9ycGhUaW1lO1xuICBmcmFtZVN0YXRlLm1hcFByb2plY3Rpb24gPSB0aGlzLm1hcFByb2plY3Rpb247XG4gIGZyYW1lU3RhdGUuY2FtZXJhID0gY2FtZXJhO1xuICBmcmFtZVN0YXRlLmN1bGxpbmdWb2x1bWUgPSBjYW1lcmEuZnJ1c3R1bS5jb21wdXRlQ3VsbGluZ1ZvbHVtZShcbiAgICBjYW1lcmEucG9zaXRpb25XQyxcbiAgICBjYW1lcmEuZGlyZWN0aW9uV0MsXG4gICAgY2FtZXJhLnVwV0NcbiAgKTtcbiAgZnJhbWVTdGF0ZS5vY2NsdWRlciA9IGdldE9jY2x1ZGVyKHRoaXMpO1xuICBmcmFtZVN0YXRlLm1pbmltdW1UZXJyYWluSGVpZ2h0ID0gMC4wO1xuICBmcmFtZVN0YXRlLm1pbmltdW1EaXNhYmxlRGVwdGhUZXN0RGlzdGFuY2UgPSB0aGlzLl9taW5pbXVtRGlzYWJsZURlcHRoVGVzdERpc3RhbmNlO1xuICBmcmFtZVN0YXRlLmludmVydENsYXNzaWZpY2F0aW9uID0gdGhpcy5pbnZlcnRDbGFzc2lmaWNhdGlvbjtcbiAgZnJhbWVTdGF0ZS51c2VMb2dEZXB0aCA9XG4gICAgdGhpcy5fbG9nRGVwdGhCdWZmZXIgJiZcbiAgICAhKFxuICAgICAgdGhpcy5jYW1lcmEuZnJ1c3R1bSBpbnN0YW5jZW9mIE9ydGhvZ3JhcGhpY0ZydXN0dW0gfHxcbiAgICAgIHRoaXMuY2FtZXJhLmZydXN0dW0gaW5zdGFuY2VvZiBPcnRob2dyYXBoaWNPZmZDZW50ZXJGcnVzdHVtXG4gICAgKTtcbiAgZnJhbWVTdGF0ZS5saWdodCA9IHRoaXMubGlnaHQ7XG4gIGZyYW1lU3RhdGUuY2FtZXJhVW5kZXJncm91bmQgPSB0aGlzLl9jYW1lcmFVbmRlcmdyb3VuZDtcbiAgZnJhbWVTdGF0ZS5nbG9iZVRyYW5zbHVjZW5jeVN0YXRlID0gdGhpcy5fZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZTtcblxuICBpZiAoZGVmaW5lZCh0aGlzLmdsb2JlKSkge1xuICAgIGZyYW1lU3RhdGUudGVycmFpbkV4YWdnZXJhdGlvbiA9IHRoaXMuZ2xvYmUudGVycmFpbkV4YWdnZXJhdGlvbjtcbiAgICBmcmFtZVN0YXRlLnRlcnJhaW5FeGFnZ2VyYXRpb25SZWxhdGl2ZUhlaWdodCA9IHRoaXMuZ2xvYmUudGVycmFpbkV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0O1xuICB9XG5cbiAgaWYgKFxuICAgIGRlZmluZWQodGhpcy5fc3BlY3VsYXJFbnZpcm9ubWVudE1hcEF0bGFzKSAmJlxuICAgIHRoaXMuX3NwZWN1bGFyRW52aXJvbm1lbnRNYXBBdGxhcy5yZWFkeVxuICApIHtcbiAgICBmcmFtZVN0YXRlLnNwZWN1bGFyRW52aXJvbm1lbnRNYXBzID0gdGhpcy5fc3BlY3VsYXJFbnZpcm9ubWVudE1hcEF0bGFzLnRleHR1cmU7XG4gICAgZnJhbWVTdGF0ZS5zcGVjdWxhckVudmlyb25tZW50TWFwc01heGltdW1MT0QgPSB0aGlzLl9zcGVjdWxhckVudmlyb25tZW50TWFwQXRsYXMubWF4aW11bU1pcG1hcExldmVsO1xuICB9IGVsc2Uge1xuICAgIGZyYW1lU3RhdGUuc3BlY3VsYXJFbnZpcm9ubWVudE1hcHMgPSB1bmRlZmluZWQ7XG4gICAgZnJhbWVTdGF0ZS5zcGVjdWxhckVudmlyb25tZW50TWFwc01heGltdW1MT0QgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBmcmFtZVN0YXRlLnNwaGVyaWNhbEhhcm1vbmljQ29lZmZpY2llbnRzID0gdGhpcy5zcGhlcmljYWxIYXJtb25pY0NvZWZmaWNpZW50cztcblxuICB0aGlzLl9hY3R1YWxJbnZlcnRDbGFzc2lmaWNhdGlvbkNvbG9yID0gQ29sb3IuY2xvbmUoXG4gICAgdGhpcy5pbnZlcnRDbGFzc2lmaWNhdGlvbkNvbG9yLFxuICAgIHRoaXMuX2FjdHVhbEludmVydENsYXNzaWZpY2F0aW9uQ29sb3JcbiAgKTtcbiAgaWYgKCFJbnZlcnRDbGFzc2lmaWNhdGlvbi5pc1RyYW5zbHVjZW5jeVN1cHBvcnRlZCh0aGlzLl9jb250ZXh0KSkge1xuICAgIHRoaXMuX2FjdHVhbEludmVydENsYXNzaWZpY2F0aW9uQ29sb3IuYWxwaGEgPSAxLjA7XG4gIH1cblxuICBmcmFtZVN0YXRlLmludmVydENsYXNzaWZpY2F0aW9uQ29sb3IgPSB0aGlzLl9hY3R1YWxJbnZlcnRDbGFzc2lmaWNhdGlvbkNvbG9yO1xuXG4gIGlmIChkZWZpbmVkKHRoaXMuZ2xvYmUpKSB7XG4gICAgZnJhbWVTdGF0ZS5tYXhpbXVtU2NyZWVuU3BhY2VFcnJvciA9IHRoaXMuZ2xvYmUubWF4aW11bVNjcmVlblNwYWNlRXJyb3I7XG4gIH0gZWxzZSB7XG4gICAgZnJhbWVTdGF0ZS5tYXhpbXVtU2NyZWVuU3BhY2VFcnJvciA9IDI7XG4gIH1cblxuICB0aGlzLmNsZWFyUGFzc2VzKGZyYW1lU3RhdGUucGFzc2VzKTtcblxuICBmcmFtZVN0YXRlLnRpbGVzZXRQYXNzU3RhdGUgPSB1bmRlZmluZWQ7XG59O1xuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cblNjZW5lLnByb3RvdHlwZS5pc1Zpc2libGUgPSBmdW5jdGlvbiAoY29tbWFuZCwgY3VsbGluZ1ZvbHVtZSwgb2NjbHVkZXIpIHtcbiAgcmV0dXJuIChcbiAgICBkZWZpbmVkKGNvbW1hbmQpICYmXG4gICAgKCFkZWZpbmVkKGNvbW1hbmQuYm91bmRpbmdWb2x1bWUpIHx8XG4gICAgICAhY29tbWFuZC5jdWxsIHx8XG4gICAgICAoY3VsbGluZ1ZvbHVtZS5jb21wdXRlVmlzaWJpbGl0eShjb21tYW5kLmJvdW5kaW5nVm9sdW1lKSAhPT1cbiAgICAgICAgSW50ZXJzZWN0Lk9VVFNJREUgJiZcbiAgICAgICAgKCFkZWZpbmVkKG9jY2x1ZGVyKSB8fFxuICAgICAgICAgICFjb21tYW5kLm9jY2x1ZGUgfHxcbiAgICAgICAgICAhY29tbWFuZC5ib3VuZGluZ1ZvbHVtZS5pc09jY2x1ZGVkKG9jY2x1ZGVyKSkpKVxuICApO1xufTtcblxudmFyIHRyYW5zZm9ybUZyb20yRCA9IG5ldyBNYXRyaXg0KFxuICAwLjAsXG4gIDAuMCxcbiAgMS4wLFxuICAwLjAsXG4gIDEuMCxcbiAgMC4wLFxuICAwLjAsXG4gIDAuMCxcbiAgMC4wLFxuICAxLjAsXG4gIDAuMCxcbiAgMC4wLFxuICAwLjAsXG4gIDAuMCxcbiAgMC4wLFxuICAxLjBcbik7XG50cmFuc2Zvcm1Gcm9tMkQgPSBNYXRyaXg0LmludmVyc2VUcmFuc2Zvcm1hdGlvbihcbiAgdHJhbnNmb3JtRnJvbTJELFxuICB0cmFuc2Zvcm1Gcm9tMkRcbik7XG5cbmZ1bmN0aW9uIGRlYnVnU2hvd0JvdW5kaW5nVm9sdW1lKGNvbW1hbmQsIHNjZW5lLCBwYXNzU3RhdGUsIGRlYnVnRnJhbWVidWZmZXIpIHtcbiAgLy8gRGVidWcgY29kZSB0byBkcmF3IGJvdW5kaW5nIHZvbHVtZSBmb3IgY29tbWFuZC4gIE5vdCBvcHRpbWl6ZWQhXG4gIC8vIEFzc3VtZXMgYm91bmRpbmcgdm9sdW1lIGlzIGEgYm91bmRpbmcgc3BoZXJlIG9yIGJveFxuICB2YXIgZnJhbWVTdGF0ZSA9IHNjZW5lLl9mcmFtZVN0YXRlO1xuICB2YXIgY29udGV4dCA9IGZyYW1lU3RhdGUuY29udGV4dDtcbiAgdmFyIGJvdW5kaW5nVm9sdW1lID0gY29tbWFuZC5ib3VuZGluZ1ZvbHVtZTtcblxuICBpZiAoZGVmaW5lZChzY2VuZS5fZGVidWdWb2x1bWUpKSB7XG4gICAgc2NlbmUuX2RlYnVnVm9sdW1lLmRlc3Ryb3koKTtcbiAgfVxuXG4gIHZhciBnZW9tZXRyeTtcblxuICB2YXIgY2VudGVyID0gQ2FydGVzaWFuMy5jbG9uZShib3VuZGluZ1ZvbHVtZS5jZW50ZXIpO1xuICBpZiAoZnJhbWVTdGF0ZS5tb2RlICE9PSBTY2VuZU1vZGUuU0NFTkUzRCkge1xuICAgIGNlbnRlciA9IE1hdHJpeDQubXVsdGlwbHlCeVBvaW50KHRyYW5zZm9ybUZyb20yRCwgY2VudGVyLCBjZW50ZXIpO1xuICAgIHZhciBwcm9qZWN0aW9uID0gZnJhbWVTdGF0ZS5tYXBQcm9qZWN0aW9uO1xuICAgIHZhciBjZW50ZXJDYXJ0b2dyYXBoaWMgPSBwcm9qZWN0aW9uLnVucHJvamVjdChjZW50ZXIpO1xuICAgIGNlbnRlciA9IHByb2plY3Rpb24uZWxsaXBzb2lkLmNhcnRvZ3JhcGhpY1RvQ2FydGVzaWFuKGNlbnRlckNhcnRvZ3JhcGhpYyk7XG4gIH1cblxuICBpZiAoZGVmaW5lZChib3VuZGluZ1ZvbHVtZS5yYWRpdXMpKSB7XG4gICAgdmFyIHJhZGl1cyA9IGJvdW5kaW5nVm9sdW1lLnJhZGl1cztcblxuICAgIGdlb21ldHJ5ID0gR2VvbWV0cnlQaXBlbGluZS50b1dpcmVmcmFtZShcbiAgICAgIEVsbGlwc29pZEdlb21ldHJ5LmNyZWF0ZUdlb21ldHJ5KFxuICAgICAgICBuZXcgRWxsaXBzb2lkR2VvbWV0cnkoe1xuICAgICAgICAgIHJhZGlpOiBuZXcgQ2FydGVzaWFuMyhyYWRpdXMsIHJhZGl1cywgcmFkaXVzKSxcbiAgICAgICAgICB2ZXJ0ZXhGb3JtYXQ6IFBlckluc3RhbmNlQ29sb3JBcHBlYXJhbmNlLkZMQVRfVkVSVEVYX0ZPUk1BVCxcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICApO1xuXG4gICAgc2NlbmUuX2RlYnVnVm9sdW1lID0gbmV3IFByaW1pdGl2ZSh7XG4gICAgICBnZW9tZXRyeUluc3RhbmNlczogbmV3IEdlb21ldHJ5SW5zdGFuY2Uoe1xuICAgICAgICBnZW9tZXRyeTogZ2VvbWV0cnksXG4gICAgICAgIG1vZGVsTWF0cml4OiBNYXRyaXg0LmZyb21UcmFuc2xhdGlvbihjZW50ZXIpLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgY29sb3I6IG5ldyBDb2xvckdlb21ldHJ5SW5zdGFuY2VBdHRyaWJ1dGUoMS4wLCAwLjAsIDAuMCwgMS4wKSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICAgYXBwZWFyYW5jZTogbmV3IFBlckluc3RhbmNlQ29sb3JBcHBlYXJhbmNlKHtcbiAgICAgICAgZmxhdDogdHJ1ZSxcbiAgICAgICAgdHJhbnNsdWNlbnQ6IGZhbHNlLFxuICAgICAgfSksXG4gICAgICBhc3luY2hyb25vdXM6IGZhbHNlLFxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHZhciBoYWxmQXhlcyA9IGJvdW5kaW5nVm9sdW1lLmhhbGZBeGVzO1xuXG4gICAgZ2VvbWV0cnkgPSBHZW9tZXRyeVBpcGVsaW5lLnRvV2lyZWZyYW1lKFxuICAgICAgQm94R2VvbWV0cnkuY3JlYXRlR2VvbWV0cnkoXG4gICAgICAgIEJveEdlb21ldHJ5LmZyb21EaW1lbnNpb25zKHtcbiAgICAgICAgICBkaW1lbnNpb25zOiBuZXcgQ2FydGVzaWFuMygyLjAsIDIuMCwgMi4wKSxcbiAgICAgICAgICB2ZXJ0ZXhGb3JtYXQ6IFBlckluc3RhbmNlQ29sb3JBcHBlYXJhbmNlLkZMQVRfVkVSVEVYX0ZPUk1BVCxcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICApO1xuXG4gICAgc2NlbmUuX2RlYnVnVm9sdW1lID0gbmV3IFByaW1pdGl2ZSh7XG4gICAgICBnZW9tZXRyeUluc3RhbmNlczogbmV3IEdlb21ldHJ5SW5zdGFuY2Uoe1xuICAgICAgICBnZW9tZXRyeTogZ2VvbWV0cnksXG4gICAgICAgIG1vZGVsTWF0cml4OiBNYXRyaXg0LmZyb21Sb3RhdGlvblRyYW5zbGF0aW9uKFxuICAgICAgICAgIGhhbGZBeGVzLFxuICAgICAgICAgIGNlbnRlcixcbiAgICAgICAgICBuZXcgTWF0cml4NCgpXG4gICAgICAgICksXG4gICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICBjb2xvcjogbmV3IENvbG9yR2VvbWV0cnlJbnN0YW5jZUF0dHJpYnV0ZSgxLjAsIDAuMCwgMC4wLCAxLjApLFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgICBhcHBlYXJhbmNlOiBuZXcgUGVySW5zdGFuY2VDb2xvckFwcGVhcmFuY2Uoe1xuICAgICAgICBmbGF0OiB0cnVlLFxuICAgICAgICB0cmFuc2x1Y2VudDogZmFsc2UsXG4gICAgICB9KSxcbiAgICAgIGFzeW5jaHJvbm91czogZmFsc2UsXG4gICAgfSk7XG4gIH1cblxuICB2YXIgc2F2ZWRDb21tYW5kTGlzdCA9IGZyYW1lU3RhdGUuY29tbWFuZExpc3Q7XG4gIHZhciBjb21tYW5kTGlzdCA9IChmcmFtZVN0YXRlLmNvbW1hbmRMaXN0ID0gW10pO1xuICBzY2VuZS5fZGVidWdWb2x1bWUudXBkYXRlKGZyYW1lU3RhdGUpO1xuXG4gIGNvbW1hbmQgPSBjb21tYW5kTGlzdFswXTtcblxuICBpZiAoZnJhbWVTdGF0ZS51c2VMb2dEZXB0aCkge1xuICAgIHZhciBsb2dEZXB0aCA9IERlcml2ZWRDb21tYW5kLmNyZWF0ZUxvZ0RlcHRoQ29tbWFuZChjb21tYW5kLCBjb250ZXh0KTtcbiAgICBjb21tYW5kID0gbG9nRGVwdGguY29tbWFuZDtcbiAgfVxuXG4gIHZhciBmcmFtZWJ1ZmZlcjtcbiAgaWYgKGRlZmluZWQoZGVidWdGcmFtZWJ1ZmZlcikpIHtcbiAgICBmcmFtZWJ1ZmZlciA9IHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlcjtcbiAgICBwYXNzU3RhdGUuZnJhbWVidWZmZXIgPSBkZWJ1Z0ZyYW1lYnVmZmVyO1xuICB9XG5cbiAgY29tbWFuZC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG5cbiAgaWYgKGRlZmluZWQoZnJhbWVidWZmZXIpKSB7XG4gICAgcGFzc1N0YXRlLmZyYW1lYnVmZmVyID0gZnJhbWVidWZmZXI7XG4gIH1cblxuICBmcmFtZVN0YXRlLmNvbW1hbmRMaXN0ID0gc2F2ZWRDb21tYW5kTGlzdDtcbn1cblxuZnVuY3Rpb24gZXhlY3V0ZUNvbW1hbmQoY29tbWFuZCwgc2NlbmUsIGNvbnRleHQsIHBhc3NTdGF0ZSwgZGVidWdGcmFtZWJ1ZmZlcikge1xuICB2YXIgZnJhbWVTdGF0ZSA9IHNjZW5lLl9mcmFtZVN0YXRlO1xuXG4gIGlmIChkZWZpbmVkKHNjZW5lLmRlYnVnQ29tbWFuZEZpbHRlcikgJiYgIXNjZW5lLmRlYnVnQ29tbWFuZEZpbHRlcihjb21tYW5kKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChjb21tYW5kIGluc3RhbmNlb2YgQ2xlYXJDb21tYW5kKSB7XG4gICAgY29tbWFuZC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGNvbW1hbmQuZGVidWdTaG93Qm91bmRpbmdWb2x1bWUgJiYgZGVmaW5lZChjb21tYW5kLmJvdW5kaW5nVm9sdW1lKSkge1xuICAgIGRlYnVnU2hvd0JvdW5kaW5nVm9sdW1lKGNvbW1hbmQsIHNjZW5lLCBwYXNzU3RhdGUsIGRlYnVnRnJhbWVidWZmZXIpO1xuICB9XG5cbiAgaWYgKGZyYW1lU3RhdGUudXNlTG9nRGVwdGggJiYgZGVmaW5lZChjb21tYW5kLmRlcml2ZWRDb21tYW5kcy5sb2dEZXB0aCkpIHtcbiAgICBjb21tYW5kID0gY29tbWFuZC5kZXJpdmVkQ29tbWFuZHMubG9nRGVwdGguY29tbWFuZDtcbiAgfVxuXG4gIHZhciBwYXNzZXMgPSBmcmFtZVN0YXRlLnBhc3NlcztcbiAgaWYgKFxuICAgICFwYXNzZXMucGljayAmJlxuICAgICFwYXNzZXMuZGVwdGggJiZcbiAgICBzY2VuZS5faGRyICYmXG4gICAgZGVmaW5lZChjb21tYW5kLmRlcml2ZWRDb21tYW5kcykgJiZcbiAgICBkZWZpbmVkKGNvbW1hbmQuZGVyaXZlZENvbW1hbmRzLmhkcilcbiAgKSB7XG4gICAgY29tbWFuZCA9IGNvbW1hbmQuZGVyaXZlZENvbW1hbmRzLmhkci5jb21tYW5kO1xuICB9XG5cbiAgaWYgKHBhc3Nlcy5waWNrIHx8IHBhc3Nlcy5kZXB0aCkge1xuICAgIGlmIChcbiAgICAgIHBhc3Nlcy5waWNrICYmXG4gICAgICAhcGFzc2VzLmRlcHRoICYmXG4gICAgICBkZWZpbmVkKGNvbW1hbmQuZGVyaXZlZENvbW1hbmRzLnBpY2tpbmcpXG4gICAgKSB7XG4gICAgICBjb21tYW5kID0gY29tbWFuZC5kZXJpdmVkQ29tbWFuZHMucGlja2luZy5waWNrQ29tbWFuZDtcbiAgICAgIGNvbW1hbmQuZXhlY3V0ZShjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAoZGVmaW5lZChjb21tYW5kLmRlcml2ZWRDb21tYW5kcy5kZXB0aCkpIHtcbiAgICAgIGNvbW1hbmQgPSBjb21tYW5kLmRlcml2ZWRDb21tYW5kcy5kZXB0aC5kZXB0aE9ubHlDb21tYW5kO1xuICAgICAgY29tbWFuZC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgaWYgKHNjZW5lLmRlYnVnU2hvd0NvbW1hbmRzIHx8IHNjZW5lLmRlYnVnU2hvd0ZydXN0dW1zKSB7XG4gICAgc2NlbmUuX2RlYnVnSW5zcGVjdG9yLmV4ZWN1dGVEZWJ1Z1Nob3dGcnVzdHVtc0NvbW1hbmQoXG4gICAgICBzY2VuZSxcbiAgICAgIGNvbW1hbmQsXG4gICAgICBwYXNzU3RhdGVcbiAgICApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChcbiAgICBmcmFtZVN0YXRlLnNoYWRvd1N0YXRlLmxpZ2h0U2hhZG93c0VuYWJsZWQgJiZcbiAgICBjb21tYW5kLnJlY2VpdmVTaGFkb3dzICYmXG4gICAgZGVmaW5lZChjb21tYW5kLmRlcml2ZWRDb21tYW5kcy5zaGFkb3dzKVxuICApIHtcbiAgICAvLyBJZiB0aGUgY29tbWFuZCByZWNlaXZlcyBzaGFkb3dzLCBleGVjdXRlIHRoZSBkZXJpdmVkIHNoYWRvd3MgY29tbWFuZC5cbiAgICAvLyBTb21lIGNvbW1hbmRzLCBzdWNoIGFzIE9JVCBkZXJpdmVkIGNvbW1hbmRzLCBkbyBub3QgaGF2ZSBkZXJpdmVkIHNoYWRvdyBjb21tYW5kcyB0aGVtc2VsdmVzXG4gICAgLy8gYW5kIGluc3RlYWQgc2hhZG93aW5nIGlzIGJ1aWx0LWluLiBJbiB0aGlzIGNhc2UgZXhlY3V0ZSB0aGUgY29tbWFuZCByZWd1bGFybHkgYmVsb3cuXG4gICAgY29tbWFuZC5kZXJpdmVkQ29tbWFuZHMuc2hhZG93cy5yZWNlaXZlQ29tbWFuZC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gIH0gZWxzZSB7XG4gICAgY29tbWFuZC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZXhlY3V0ZUlkQ29tbWFuZChjb21tYW5kLCBzY2VuZSwgY29udGV4dCwgcGFzc1N0YXRlKSB7XG4gIHZhciBmcmFtZVN0YXRlID0gc2NlbmUuX2ZyYW1lU3RhdGU7XG4gIHZhciBkZXJpdmVkQ29tbWFuZHMgPSBjb21tYW5kLmRlcml2ZWRDb21tYW5kcztcbiAgaWYgKCFkZWZpbmVkKGRlcml2ZWRDb21tYW5kcykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoZnJhbWVTdGF0ZS51c2VMb2dEZXB0aCAmJiBkZWZpbmVkKGRlcml2ZWRDb21tYW5kcy5sb2dEZXB0aCkpIHtcbiAgICBjb21tYW5kID0gZGVyaXZlZENvbW1hbmRzLmxvZ0RlcHRoLmNvbW1hbmQ7XG4gIH1cblxuICBkZXJpdmVkQ29tbWFuZHMgPSBjb21tYW5kLmRlcml2ZWRDb21tYW5kcztcbiAgaWYgKGRlZmluZWQoZGVyaXZlZENvbW1hbmRzLnBpY2tpbmcpKSB7XG4gICAgY29tbWFuZCA9IGRlcml2ZWRDb21tYW5kcy5waWNraW5nLnBpY2tDb21tYW5kO1xuICAgIGNvbW1hbmQuZXhlY3V0ZShjb250ZXh0LCBwYXNzU3RhdGUpO1xuICB9IGVsc2UgaWYgKGRlZmluZWQoZGVyaXZlZENvbW1hbmRzLmRlcHRoKSkge1xuICAgIGNvbW1hbmQgPSBkZXJpdmVkQ29tbWFuZHMuZGVwdGguZGVwdGhPbmx5Q29tbWFuZDtcbiAgICBjb21tYW5kLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBiYWNrVG9Gcm9udChhLCBiLCBwb3NpdGlvbikge1xuICByZXR1cm4gKFxuICAgIGIuYm91bmRpbmdWb2x1bWUuZGlzdGFuY2VTcXVhcmVkVG8ocG9zaXRpb24pIC1cbiAgICBhLmJvdW5kaW5nVm9sdW1lLmRpc3RhbmNlU3F1YXJlZFRvKHBvc2l0aW9uKVxuICApO1xufVxuXG5mdW5jdGlvbiBmcm9udFRvQmFjayhhLCBiLCBwb3NpdGlvbikge1xuICAvLyBXaGVuIGRpc3RhbmNlcyBhcmUgZXF1YWwgZXF1YWwgZmF2b3Igc29ydGluZyBiIGJlZm9yZSBhLiBUaGlzIGdpdmVzIHJlbmRlciBwcmlvcml0eSB0byBjb21tYW5kcyBsYXRlciBpbiB0aGUgbGlzdC5cbiAgcmV0dXJuIChcbiAgICBhLmJvdW5kaW5nVm9sdW1lLmRpc3RhbmNlU3F1YXJlZFRvKHBvc2l0aW9uKSAtXG4gICAgYi5ib3VuZGluZ1ZvbHVtZS5kaXN0YW5jZVNxdWFyZWRUbyhwb3NpdGlvbikgK1xuICAgIENlc2l1bU1hdGguRVBTSUxPTjEyXG4gICk7XG59XG5cbmZ1bmN0aW9uIGV4ZWN1dGVUcmFuc2x1Y2VudENvbW1hbmRzQmFja1RvRnJvbnQoXG4gIHNjZW5lLFxuICBleGVjdXRlRnVuY3Rpb24sXG4gIHBhc3NTdGF0ZSxcbiAgY29tbWFuZHMsXG4gIGludmVydENsYXNzaWZpY2F0aW9uXG4pIHtcbiAgdmFyIGNvbnRleHQgPSBzY2VuZS5jb250ZXh0O1xuXG4gIG1lcmdlU29ydChjb21tYW5kcywgYmFja1RvRnJvbnQsIHNjZW5lLmNhbWVyYS5wb3NpdGlvbldDKTtcblxuICBpZiAoZGVmaW5lZChpbnZlcnRDbGFzc2lmaWNhdGlvbikpIHtcbiAgICBleGVjdXRlRnVuY3Rpb24oXG4gICAgICBpbnZlcnRDbGFzc2lmaWNhdGlvbi51bmNsYXNzaWZpZWRDb21tYW5kLFxuICAgICAgc2NlbmUsXG4gICAgICBjb250ZXh0LFxuICAgICAgcGFzc1N0YXRlXG4gICAgKTtcbiAgfVxuXG4gIHZhciBsZW5ndGggPSBjb21tYW5kcy5sZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICBleGVjdXRlRnVuY3Rpb24oY29tbWFuZHNbaV0sIHNjZW5lLCBjb250ZXh0LCBwYXNzU3RhdGUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGV4ZWN1dGVUcmFuc2x1Y2VudENvbW1hbmRzRnJvbnRUb0JhY2soXG4gIHNjZW5lLFxuICBleGVjdXRlRnVuY3Rpb24sXG4gIHBhc3NTdGF0ZSxcbiAgY29tbWFuZHMsXG4gIGludmVydENsYXNzaWZpY2F0aW9uXG4pIHtcbiAgdmFyIGNvbnRleHQgPSBzY2VuZS5jb250ZXh0O1xuXG4gIG1lcmdlU29ydChjb21tYW5kcywgZnJvbnRUb0JhY2ssIHNjZW5lLmNhbWVyYS5wb3NpdGlvbldDKTtcblxuICBpZiAoZGVmaW5lZChpbnZlcnRDbGFzc2lmaWNhdGlvbikpIHtcbiAgICBleGVjdXRlRnVuY3Rpb24oXG4gICAgICBpbnZlcnRDbGFzc2lmaWNhdGlvbi51bmNsYXNzaWZpZWRDb21tYW5kLFxuICAgICAgc2NlbmUsXG4gICAgICBjb250ZXh0LFxuICAgICAgcGFzc1N0YXRlXG4gICAgKTtcbiAgfVxuXG4gIHZhciBsZW5ndGggPSBjb21tYW5kcy5sZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICBleGVjdXRlRnVuY3Rpb24oY29tbWFuZHNbaV0sIHNjZW5lLCBjb250ZXh0LCBwYXNzU3RhdGUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldERlYnVnR2xvYmVEZXB0aChzY2VuZSwgaW5kZXgpIHtcbiAgdmFyIGdsb2JlRGVwdGhzID0gc2NlbmUuX3ZpZXcuZGVidWdHbG9iZURlcHRocztcbiAgdmFyIGdsb2JlRGVwdGggPSBnbG9iZURlcHRoc1tpbmRleF07XG4gIGlmICghZGVmaW5lZChnbG9iZURlcHRoKSAmJiBzY2VuZS5jb250ZXh0LmRlcHRoVGV4dHVyZSkge1xuICAgIGdsb2JlRGVwdGggPSBuZXcgR2xvYmVEZXB0aCgpO1xuICAgIGdsb2JlRGVwdGhzW2luZGV4XSA9IGdsb2JlRGVwdGg7XG4gIH1cbiAgcmV0dXJuIGdsb2JlRGVwdGg7XG59XG5cbnZhciBzY3JhdGNoUGVyc3BlY3RpdmVGcnVzdHVtID0gbmV3IFBlcnNwZWN0aXZlRnJ1c3R1bSgpO1xudmFyIHNjcmF0Y2hQZXJzcGVjdGl2ZU9mZkNlbnRlckZydXN0dW0gPSBuZXcgUGVyc3BlY3RpdmVPZmZDZW50ZXJGcnVzdHVtKCk7XG52YXIgc2NyYXRjaE9ydGhvZ3JhcGhpY0ZydXN0dW0gPSBuZXcgT3J0aG9ncmFwaGljRnJ1c3R1bSgpO1xudmFyIHNjcmF0Y2hPcnRob2dyYXBoaWNPZmZDZW50ZXJGcnVzdHVtID0gbmV3IE9ydGhvZ3JhcGhpY09mZkNlbnRlckZydXN0dW0oKTtcblxuZnVuY3Rpb24gZXhlY3V0ZUNvbW1hbmRzKHNjZW5lLCBwYXNzU3RhdGUpIHtcbiAgdmFyIGNhbWVyYSA9IHNjZW5lLmNhbWVyYTtcbiAgdmFyIGNvbnRleHQgPSBzY2VuZS5jb250ZXh0O1xuICB2YXIgZnJhbWVTdGF0ZSA9IHNjZW5lLmZyYW1lU3RhdGU7XG4gIHZhciB1cyA9IGNvbnRleHQudW5pZm9ybVN0YXRlO1xuXG4gIHVzLnVwZGF0ZUNhbWVyYShjYW1lcmEpO1xuXG4gIC8vIENyZWF0ZSBhIHdvcmtpbmcgZnJ1c3R1bSBmcm9tIHRoZSBvcmlnaW5hbCBjYW1lcmEgZnJ1c3R1bS5cbiAgdmFyIGZydXN0dW07XG4gIGlmIChkZWZpbmVkKGNhbWVyYS5mcnVzdHVtLmZvdikpIHtcbiAgICBmcnVzdHVtID0gY2FtZXJhLmZydXN0dW0uY2xvbmUoc2NyYXRjaFBlcnNwZWN0aXZlRnJ1c3R1bSk7XG4gIH0gZWxzZSBpZiAoZGVmaW5lZChjYW1lcmEuZnJ1c3R1bS5pbmZpbml0ZVByb2plY3Rpb25NYXRyaXgpKSB7XG4gICAgZnJ1c3R1bSA9IGNhbWVyYS5mcnVzdHVtLmNsb25lKHNjcmF0Y2hQZXJzcGVjdGl2ZU9mZkNlbnRlckZydXN0dW0pO1xuICB9IGVsc2UgaWYgKGRlZmluZWQoY2FtZXJhLmZydXN0dW0ud2lkdGgpKSB7XG4gICAgZnJ1c3R1bSA9IGNhbWVyYS5mcnVzdHVtLmNsb25lKHNjcmF0Y2hPcnRob2dyYXBoaWNGcnVzdHVtKTtcbiAgfSBlbHNlIHtcbiAgICBmcnVzdHVtID0gY2FtZXJhLmZydXN0dW0uY2xvbmUoc2NyYXRjaE9ydGhvZ3JhcGhpY09mZkNlbnRlckZydXN0dW0pO1xuICB9XG5cbiAgLy8gSWRlYWxseSwgd2Ugd291bGQgcmVuZGVyIHRoZSBza3kgYm94IGFuZCBhdG1vc3BoZXJlIGxhc3QgZm9yXG4gIC8vIGVhcmx5LXosIGJ1dCB3ZSB3b3VsZCBoYXZlIHRvIGRyYXcgaXQgaW4gZWFjaCBmcnVzdHVtXG4gIGZydXN0dW0ubmVhciA9IGNhbWVyYS5mcnVzdHVtLm5lYXI7XG4gIGZydXN0dW0uZmFyID0gY2FtZXJhLmZydXN0dW0uZmFyO1xuICB1cy51cGRhdGVGcnVzdHVtKGZydXN0dW0pO1xuICB1cy51cGRhdGVQYXNzKFBhc3MuRU5WSVJPTk1FTlQpO1xuXG4gIHZhciBwYXNzZXMgPSBmcmFtZVN0YXRlLnBhc3NlcztcbiAgdmFyIHBpY2tpbmcgPSBwYXNzZXMucGljaztcbiAgdmFyIGVudmlyb25tZW50U3RhdGUgPSBzY2VuZS5fZW52aXJvbm1lbnRTdGF0ZTtcbiAgdmFyIHZpZXcgPSBzY2VuZS5fdmlldztcbiAgdmFyIHJlbmRlclRyYW5zbHVjZW50RGVwdGhGb3JQaWNrID1cbiAgICBlbnZpcm9ubWVudFN0YXRlLnJlbmRlclRyYW5zbHVjZW50RGVwdGhGb3JQaWNrO1xuICB2YXIgdXNlV2ViVlIgPSBlbnZpcm9ubWVudFN0YXRlLnVzZVdlYlZSO1xuXG4gIC8vIERvIG5vdCByZW5kZXIgZW52aXJvbm1lbnQgcHJpbWl0aXZlcyBkdXJpbmcgYSBwaWNrIHBhc3Mgc2luY2UgdGhleSBkbyBub3QgZ2VuZXJhdGUgcGlja2luZyBjb21tYW5kcy5cbiAgaWYgKCFwaWNraW5nKSB7XG4gICAgdmFyIHNreUJveENvbW1hbmQgPSBlbnZpcm9ubWVudFN0YXRlLnNreUJveENvbW1hbmQ7XG4gICAgaWYgKGRlZmluZWQoc2t5Qm94Q29tbWFuZCkpIHtcbiAgICAgIGV4ZWN1dGVDb21tYW5kKHNreUJveENvbW1hbmQsIHNjZW5lLCBjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgIH1cblxuICAgIGlmIChlbnZpcm9ubWVudFN0YXRlLmlzU2t5QXRtb3NwaGVyZVZpc2libGUpIHtcbiAgICAgIGV4ZWN1dGVDb21tYW5kKFxuICAgICAgICBlbnZpcm9ubWVudFN0YXRlLnNreUF0bW9zcGhlcmVDb21tYW5kLFxuICAgICAgICBzY2VuZSxcbiAgICAgICAgY29udGV4dCxcbiAgICAgICAgcGFzc1N0YXRlXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChlbnZpcm9ubWVudFN0YXRlLmlzU3VuVmlzaWJsZSkge1xuICAgICAgZW52aXJvbm1lbnRTdGF0ZS5zdW5EcmF3Q29tbWFuZC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgICBpZiAoc2NlbmUuc3VuQmxvb20gJiYgIXVzZVdlYlZSKSB7XG4gICAgICAgIHZhciBmcmFtZWJ1ZmZlcjtcbiAgICAgICAgaWYgKGVudmlyb25tZW50U3RhdGUudXNlR2xvYmVEZXB0aEZyYW1lYnVmZmVyKSB7XG4gICAgICAgICAgZnJhbWVidWZmZXIgPSB2aWV3Lmdsb2JlRGVwdGguZnJhbWVidWZmZXI7XG4gICAgICAgIH0gZWxzZSBpZiAoZW52aXJvbm1lbnRTdGF0ZS51c2VQb3N0UHJvY2Vzcykge1xuICAgICAgICAgIGZyYW1lYnVmZmVyID0gdmlldy5zY2VuZUZyYW1lYnVmZmVyLmdldEZyYW1lYnVmZmVyKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZnJhbWVidWZmZXIgPSBlbnZpcm9ubWVudFN0YXRlLm9yaWdpbmFsRnJhbWVidWZmZXI7XG4gICAgICAgIH1cbiAgICAgICAgc2NlbmUuX3N1blBvc3RQcm9jZXNzLmV4ZWN1dGUoY29udGV4dCk7XG4gICAgICAgIHNjZW5lLl9zdW5Qb3N0UHJvY2Vzcy5jb3B5KGNvbnRleHQsIGZyYW1lYnVmZmVyKTtcbiAgICAgICAgcGFzc1N0YXRlLmZyYW1lYnVmZmVyID0gZnJhbWVidWZmZXI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTW9vbiBjYW4gYmUgc2VlbiB0aHJvdWdoIHRoZSBhdG1vc3BoZXJlLCBzaW5jZSB0aGUgc3VuIGlzIHJlbmRlcmVkIGFmdGVyIHRoZSBhdG1vc3BoZXJlLlxuICAgIGlmIChlbnZpcm9ubWVudFN0YXRlLmlzTW9vblZpc2libGUpIHtcbiAgICAgIGVudmlyb25tZW50U3RhdGUubW9vbkNvbW1hbmQuZXhlY3V0ZShjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIERldGVybWluZSBob3cgdHJhbnNsdWNlbnQgc3VyZmFjZXMgd2lsbCBiZSBoYW5kbGVkLlxuICB2YXIgZXhlY3V0ZVRyYW5zbHVjZW50Q29tbWFuZHM7XG4gIGlmIChlbnZpcm9ubWVudFN0YXRlLnVzZU9JVCkge1xuICAgIGlmICghZGVmaW5lZChzY2VuZS5fZXhlY3V0ZU9JVEZ1bmN0aW9uKSkge1xuICAgICAgc2NlbmUuX2V4ZWN1dGVPSVRGdW5jdGlvbiA9IGZ1bmN0aW9uIChcbiAgICAgICAgc2NlbmUsXG4gICAgICAgIGV4ZWN1dGVGdW5jdGlvbixcbiAgICAgICAgcGFzc1N0YXRlLFxuICAgICAgICBjb21tYW5kcyxcbiAgICAgICAgaW52ZXJ0Q2xhc3NpZmljYXRpb25cbiAgICAgICkge1xuICAgICAgICB2aWV3Lm9pdC5leGVjdXRlQ29tbWFuZHMoXG4gICAgICAgICAgc2NlbmUsXG4gICAgICAgICAgZXhlY3V0ZUZ1bmN0aW9uLFxuICAgICAgICAgIHBhc3NTdGF0ZSxcbiAgICAgICAgICBjb21tYW5kcyxcbiAgICAgICAgICBpbnZlcnRDbGFzc2lmaWNhdGlvblxuICAgICAgICApO1xuICAgICAgfTtcbiAgICB9XG4gICAgZXhlY3V0ZVRyYW5zbHVjZW50Q29tbWFuZHMgPSBzY2VuZS5fZXhlY3V0ZU9JVEZ1bmN0aW9uO1xuICB9IGVsc2UgaWYgKHBhc3Nlcy5yZW5kZXIpIHtcbiAgICBleGVjdXRlVHJhbnNsdWNlbnRDb21tYW5kcyA9IGV4ZWN1dGVUcmFuc2x1Y2VudENvbW1hbmRzQmFja1RvRnJvbnQ7XG4gIH0gZWxzZSB7XG4gICAgZXhlY3V0ZVRyYW5zbHVjZW50Q29tbWFuZHMgPSBleGVjdXRlVHJhbnNsdWNlbnRDb21tYW5kc0Zyb250VG9CYWNrO1xuICB9XG5cbiAgdmFyIGZydXN0dW1Db21tYW5kc0xpc3QgPSB2aWV3LmZydXN0dW1Db21tYW5kc0xpc3Q7XG4gIHZhciBudW1GcnVzdHVtcyA9IGZydXN0dW1Db21tYW5kc0xpc3QubGVuZ3RoO1xuXG4gIHZhciBjbGVhckdsb2JlRGVwdGggPSBlbnZpcm9ubWVudFN0YXRlLmNsZWFyR2xvYmVEZXB0aDtcbiAgdmFyIHVzZURlcHRoUGxhbmUgPSBlbnZpcm9ubWVudFN0YXRlLnVzZURlcHRoUGxhbmU7XG4gIHZhciBnbG9iZVRyYW5zbHVjZW5jeVN0YXRlID0gc2NlbmUuX2dsb2JlVHJhbnNsdWNlbmN5U3RhdGU7XG4gIHZhciBnbG9iZVRyYW5zbHVjZW50ID0gZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZS50cmFuc2x1Y2VudDtcbiAgdmFyIGdsb2JlVHJhbnNsdWNlbmN5RnJhbWVidWZmZXIgPSBzY2VuZS5fdmlldy5nbG9iZVRyYW5zbHVjZW5jeUZyYW1lYnVmZmVyO1xuICB2YXIgc2VwYXJhdGVQcmltaXRpdmVGcmFtZWJ1ZmZlciA9IChlbnZpcm9ubWVudFN0YXRlLnNlcGFyYXRlUHJpbWl0aXZlRnJhbWVidWZmZXIgPSBmYWxzZSk7XG4gIHZhciBjbGVhckRlcHRoID0gc2NlbmUuX2RlcHRoQ2xlYXJDb21tYW5kO1xuICB2YXIgY2xlYXJTdGVuY2lsID0gc2NlbmUuX3N0ZW5jaWxDbGVhckNvbW1hbmQ7XG4gIHZhciBjbGVhckNsYXNzaWZpY2F0aW9uU3RlbmNpbCA9IHNjZW5lLl9jbGFzc2lmaWNhdGlvblN0ZW5jaWxDbGVhckNvbW1hbmQ7XG4gIHZhciBkZXB0aFBsYW5lID0gc2NlbmUuX2RlcHRoUGxhbmU7XG4gIHZhciB1c2VQb3N0UHJvY2Vzc1NlbGVjdGVkID0gZW52aXJvbm1lbnRTdGF0ZS51c2VQb3N0UHJvY2Vzc1NlbGVjdGVkO1xuXG4gIHZhciBoZWlnaHQyRCA9IGNhbWVyYS5wb3NpdGlvbi56O1xuXG4gIC8vIEV4ZWN1dGUgY29tbWFuZHMgaW4gZWFjaCBmcnVzdHVtIGluIGJhY2sgdG8gZnJvbnQgb3JkZXJcbiAgdmFyIGo7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtRnJ1c3R1bXM7ICsraSkge1xuICAgIHZhciBpbmRleCA9IG51bUZydXN0dW1zIC0gaSAtIDE7XG4gICAgdmFyIGZydXN0dW1Db21tYW5kcyA9IGZydXN0dW1Db21tYW5kc0xpc3RbaW5kZXhdO1xuXG4gICAgaWYgKHNjZW5lLm1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTJEKSB7XG4gICAgICAvLyBUbyBhdm9pZCB6LWZpZ2h0aW5nIGluIDJELCBtb3ZlIHRoZSBjYW1lcmEgdG8ganVzdCBiZWZvcmUgdGhlIGZydXN0dW1cbiAgICAgIC8vIGFuZCBzY2FsZSB0aGUgZnJ1c3R1bSBkZXB0aCB0byBiZSBpbiBbMS4wLCBuZWFyVG9GYXJEaXN0YW5jZTJEXS5cbiAgICAgIGNhbWVyYS5wb3NpdGlvbi56ID0gaGVpZ2h0MkQgLSBmcnVzdHVtQ29tbWFuZHMubmVhciArIDEuMDtcbiAgICAgIGZydXN0dW0uZmFyID0gTWF0aC5tYXgoMS4wLCBmcnVzdHVtQ29tbWFuZHMuZmFyIC0gZnJ1c3R1bUNvbW1hbmRzLm5lYXIpO1xuICAgICAgZnJ1c3R1bS5uZWFyID0gMS4wO1xuICAgICAgdXMudXBkYXRlKGZyYW1lU3RhdGUpO1xuICAgICAgdXMudXBkYXRlRnJ1c3R1bShmcnVzdHVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQXZvaWQgdGVhcmluZyBhcnRpZmFjdHMgYmV0d2VlbiBhZGphY2VudCBmcnVzdHVtcyBpbiB0aGUgb3BhcXVlIHBhc3Nlc1xuICAgICAgZnJ1c3R1bS5uZWFyID1cbiAgICAgICAgaW5kZXggIT09IDBcbiAgICAgICAgICA/IGZydXN0dW1Db21tYW5kcy5uZWFyICogc2NlbmUub3BhcXVlRnJ1c3R1bU5lYXJPZmZzZXRcbiAgICAgICAgICA6IGZydXN0dW1Db21tYW5kcy5uZWFyO1xuICAgICAgZnJ1c3R1bS5mYXIgPSBmcnVzdHVtQ29tbWFuZHMuZmFyO1xuICAgICAgdXMudXBkYXRlRnJ1c3R1bShmcnVzdHVtKTtcbiAgICB9XG5cbiAgICB2YXIgZ2xvYmVEZXB0aCA9IHNjZW5lLmRlYnVnU2hvd0dsb2JlRGVwdGhcbiAgICAgID8gZ2V0RGVidWdHbG9iZURlcHRoKHNjZW5lLCBpbmRleClcbiAgICAgIDogdmlldy5nbG9iZURlcHRoO1xuXG4gICAgaWYgKHNlcGFyYXRlUHJpbWl0aXZlRnJhbWVidWZmZXIpIHtcbiAgICAgIC8vIFJlbmRlciB0byBnbG9iZSBmcmFtZWJ1ZmZlciBpbiBHTE9CRSBwYXNzXG4gICAgICBwYXNzU3RhdGUuZnJhbWVidWZmZXIgPSBnbG9iZURlcHRoLmZyYW1lYnVmZmVyO1xuICAgIH1cblxuICAgIHZhciBmYjtcbiAgICBpZiAoXG4gICAgICBzY2VuZS5kZWJ1Z1Nob3dHbG9iZURlcHRoICYmXG4gICAgICBkZWZpbmVkKGdsb2JlRGVwdGgpICYmXG4gICAgICBlbnZpcm9ubWVudFN0YXRlLnVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlclxuICAgICkge1xuICAgICAgZ2xvYmVEZXB0aC51cGRhdGUoXG4gICAgICAgIGNvbnRleHQsXG4gICAgICAgIHBhc3NTdGF0ZSxcbiAgICAgICAgdmlldy52aWV3cG9ydCxcbiAgICAgICAgc2NlbmUuX2hkcixcbiAgICAgICAgY2xlYXJHbG9iZURlcHRoXG4gICAgICApO1xuICAgICAgZ2xvYmVEZXB0aC5jbGVhcihjb250ZXh0LCBwYXNzU3RhdGUsIHNjZW5lLl9jbGVhckNvbG9yQ29tbWFuZC5jb2xvcik7XG4gICAgICBmYiA9IHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlcjtcbiAgICAgIHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlciA9IGdsb2JlRGVwdGguZnJhbWVidWZmZXI7XG4gICAgfVxuXG4gICAgY2xlYXJEZXB0aC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG5cbiAgICBpZiAoY29udGV4dC5zdGVuY2lsQnVmZmVyKSB7XG4gICAgICBjbGVhclN0ZW5jaWwuZXhlY3V0ZShjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgIH1cblxuICAgIHVzLnVwZGF0ZVBhc3MoUGFzcy5HTE9CRSk7XG4gICAgdmFyIGNvbW1hbmRzID0gZnJ1c3R1bUNvbW1hbmRzLmNvbW1hbmRzW1Bhc3MuR0xPQkVdO1xuICAgIHZhciBsZW5ndGggPSBmcnVzdHVtQ29tbWFuZHMuaW5kaWNlc1tQYXNzLkdMT0JFXTtcblxuICAgIGlmIChnbG9iZVRyYW5zbHVjZW50KSB7XG4gICAgICBnbG9iZVRyYW5zbHVjZW5jeVN0YXRlLmV4ZWN1dGVHbG9iZUNvbW1hbmRzKFxuICAgICAgICBmcnVzdHVtQ29tbWFuZHMsXG4gICAgICAgIGV4ZWN1dGVDb21tYW5kLFxuICAgICAgICBnbG9iZVRyYW5zbHVjZW5jeUZyYW1lYnVmZmVyLFxuICAgICAgICBzY2VuZSxcbiAgICAgICAgcGFzc1N0YXRlXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGogPSAwOyBqIDwgbGVuZ3RoOyArK2opIHtcbiAgICAgICAgZXhlY3V0ZUNvbW1hbmQoY29tbWFuZHNbal0sIHNjZW5lLCBjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkZWZpbmVkKGdsb2JlRGVwdGgpICYmIGVudmlyb25tZW50U3RhdGUudXNlR2xvYmVEZXB0aEZyYW1lYnVmZmVyKSB7XG4gICAgICBnbG9iZURlcHRoLmV4ZWN1dGVDb3B5RGVwdGgoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICBzY2VuZS5kZWJ1Z1Nob3dHbG9iZURlcHRoICYmXG4gICAgICBkZWZpbmVkKGdsb2JlRGVwdGgpICYmXG4gICAgICBlbnZpcm9ubWVudFN0YXRlLnVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlclxuICAgICkge1xuICAgICAgcGFzc1N0YXRlLmZyYW1lYnVmZmVyID0gZmI7XG4gICAgfVxuXG4gICAgLy8gRHJhdyB0ZXJyYWluIGNsYXNzaWZpY2F0aW9uXG4gICAgaWYgKCFlbnZpcm9ubWVudFN0YXRlLnJlbmRlclRyYW5zbHVjZW50RGVwdGhGb3JQaWNrKSB7XG4gICAgICB1cy51cGRhdGVQYXNzKFBhc3MuVEVSUkFJTl9DTEFTU0lGSUNBVElPTik7XG4gICAgICBjb21tYW5kcyA9IGZydXN0dW1Db21tYW5kcy5jb21tYW5kc1tQYXNzLlRFUlJBSU5fQ0xBU1NJRklDQVRJT05dO1xuICAgICAgbGVuZ3RoID0gZnJ1c3R1bUNvbW1hbmRzLmluZGljZXNbUGFzcy5URVJSQUlOX0NMQVNTSUZJQ0FUSU9OXTtcblxuICAgICAgaWYgKGdsb2JlVHJhbnNsdWNlbnQpIHtcbiAgICAgICAgZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZS5leGVjdXRlR2xvYmVDbGFzc2lmaWNhdGlvbkNvbW1hbmRzKFxuICAgICAgICAgIGZydXN0dW1Db21tYW5kcyxcbiAgICAgICAgICBleGVjdXRlQ29tbWFuZCxcbiAgICAgICAgICBnbG9iZVRyYW5zbHVjZW5jeUZyYW1lYnVmZmVyLFxuICAgICAgICAgIHNjZW5lLFxuICAgICAgICAgIHBhc3NTdGF0ZVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9yIChqID0gMDsgaiA8IGxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgZXhlY3V0ZUNvbW1hbmQoY29tbWFuZHNbal0sIHNjZW5lLCBjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNsZWFyR2xvYmVEZXB0aCkge1xuICAgICAgY2xlYXJEZXB0aC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgICBpZiAodXNlRGVwdGhQbGFuZSkge1xuICAgICAgICBkZXB0aFBsYW5lLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc2VwYXJhdGVQcmltaXRpdmVGcmFtZWJ1ZmZlcikge1xuICAgICAgLy8gUmVuZGVyIHRvIHByaW1pdGl2ZSBmcmFtZWJ1ZmZlciBpbiBhbGwgb3RoZXIgcGFzc2VzXG4gICAgICBwYXNzU3RhdGUuZnJhbWVidWZmZXIgPSBnbG9iZURlcHRoLnByaW1pdGl2ZUZyYW1lYnVmZmVyO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgICFlbnZpcm9ubWVudFN0YXRlLnVzZUludmVydENsYXNzaWZpY2F0aW9uIHx8XG4gICAgICBwaWNraW5nIHx8XG4gICAgICBlbnZpcm9ubWVudFN0YXRlLnJlbmRlclRyYW5zbHVjZW50RGVwdGhGb3JQaWNrXG4gICAgKSB7XG4gICAgICAvLyBDb21tb24vZmFzdGVzdCBwYXRoLiBEcmF3IDNEIFRpbGVzIGFuZCBjbGFzc2lmaWNhdGlvbiBub3JtYWxseS5cblxuICAgICAgLy8gRHJhdyAzRCBUaWxlc1xuICAgICAgdXMudXBkYXRlUGFzcyhQYXNzLkNFU0lVTV8zRF9USUxFKTtcbiAgICAgIGNvbW1hbmRzID0gZnJ1c3R1bUNvbW1hbmRzLmNvbW1hbmRzW1Bhc3MuQ0VTSVVNXzNEX1RJTEVdO1xuICAgICAgbGVuZ3RoID0gZnJ1c3R1bUNvbW1hbmRzLmluZGljZXNbUGFzcy5DRVNJVU1fM0RfVElMRV07XG4gICAgICBmb3IgKGogPSAwOyBqIDwgbGVuZ3RoOyArK2opIHtcbiAgICAgICAgZXhlY3V0ZUNvbW1hbmQoY29tbWFuZHNbal0sIHNjZW5lLCBjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgICAgfVxuXG4gICAgICBpZiAobGVuZ3RoID4gMCkge1xuICAgICAgICBpZiAoZGVmaW5lZChnbG9iZURlcHRoKSAmJiBlbnZpcm9ubWVudFN0YXRlLnVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlcikge1xuICAgICAgICAgIGdsb2JlRGVwdGguZXhlY3V0ZVVwZGF0ZURlcHRoKGNvbnRleHQsIHBhc3NTdGF0ZSwgY2xlYXJHbG9iZURlcHRoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERyYXcgY2xhc3NpZmljYXRpb25zLiBNb2RpZmllcyAzRCBUaWxlcyBjb2xvci5cbiAgICAgICAgaWYgKCFlbnZpcm9ubWVudFN0YXRlLnJlbmRlclRyYW5zbHVjZW50RGVwdGhGb3JQaWNrKSB7XG4gICAgICAgICAgdXMudXBkYXRlUGFzcyhQYXNzLkNFU0lVTV8zRF9USUxFX0NMQVNTSUZJQ0FUSU9OKTtcbiAgICAgICAgICBjb21tYW5kcyA9XG4gICAgICAgICAgICBmcnVzdHVtQ29tbWFuZHMuY29tbWFuZHNbUGFzcy5DRVNJVU1fM0RfVElMRV9DTEFTU0lGSUNBVElPTl07XG4gICAgICAgICAgbGVuZ3RoID0gZnJ1c3R1bUNvbW1hbmRzLmluZGljZXNbUGFzcy5DRVNJVU1fM0RfVElMRV9DTEFTU0lGSUNBVElPTl07XG4gICAgICAgICAgZm9yIChqID0gMDsgaiA8IGxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICBleGVjdXRlQ29tbWFuZChjb21tYW5kc1tqXSwgc2NlbmUsIGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFdoZW4gdGhlIGludmVydCBjbGFzc2lmaWNhdGlvbiBjb2xvciBpcyBvcGFxdWU6XG4gICAgICAvLyAgICBNYWluIEZCTyAoRkJPMSk6ICAgICAgICAgICAgICAgICAgIE1haW5fQ29sb3IgICArIE1haW5fRGVwdGhTdGVuY2lsXG4gICAgICAvLyAgICBJbnZlcnQgY2xhc3NpZmljYXRpb24gRkJPIChGQk8yKSA6IEludmVydF9Db2xvciArIE1haW5fRGVwdGhTdGVuY2lsXG4gICAgICAvL1xuICAgICAgLy8gICAgMS4gQ2xlYXIgRkJPMiBjb2xvciB0byB2ZWM0KDAuMCkgZm9yIGVhY2ggZnJ1c3R1bVxuICAgICAgLy8gICAgMi4gRHJhdyAzRCBUaWxlcyB0byBGQk8yXG4gICAgICAvLyAgICAzLiBEcmF3IGNsYXNzaWZpY2F0aW9uIHRvIEZCTzJcbiAgICAgIC8vICAgIDQuIEZ1bGxzY3JlZW4gcGFzcyB0byBGQk8xLCBkcmF3IEludmVydF9Db2xvciB3aGVuOlxuICAgICAgLy8gICAgICAgICAgICogTWFpbl9EZXB0aFN0ZW5jaWwgaGFzIHRoZSBzdGVuY2lsIGJpdCBzZXQgPiAwIChjbGFzc2lmaWVkKVxuICAgICAgLy8gICAgNS4gRnVsbHNjcmVlbiBwYXNzIHRvIEZCTzEsIGRyYXcgSW52ZXJ0X0NvbG9yICogY3ptX2ludmVydENsYXNzaWZpY2F0aW9uQ29sb3Igd2hlbjpcbiAgICAgIC8vICAgICAgICAgICAqIE1haW5fRGVwdGhTdGVuY2lsIGhhcyBzdGVuY2lsIGJpdCBzZXQgdG8gMCAodW5jbGFzc2lmaWVkKSBhbmRcbiAgICAgIC8vICAgICAgICAgICAqIEludmVydF9Db2xvciAhPT0gdmVjNCgwLjApXG4gICAgICAvL1xuICAgICAgLy8gV2hlbiB0aGUgaW52ZXJ0IGNsYXNzaWZpY2F0aW9uIGNvbG9yIGlzIHRyYW5zbHVjZW50OlxuICAgICAgLy8gICAgTWFpbiBGQk8gKEZCTzEpOiAgICAgICAgICAgICAgICAgIE1haW5fQ29sb3IgICAgICAgICArIE1haW5fRGVwdGhTdGVuY2lsXG4gICAgICAvLyAgICBJbnZlcnQgY2xhc3NpZmljYXRpb24gRkJPIChGQk8yKTogSW52ZXJ0X0NvbG9yICAgICAgICsgSW52ZXJ0X0RlcHRoU3RlbmNpbFxuICAgICAgLy8gICAgSXNDbGFzc2lmaWVkIEZCTyAoRkJPMyk6ICAgICAgICAgIElzQ2xhc3NpZmllZF9Db2xvciArIEludmVydF9EZXB0aFN0ZW5jaWxcbiAgICAgIC8vXG4gICAgICAvLyAgICAxLiBDbGVhciBGQk8yIGFuZCBGQk8zIGNvbG9yIHRvIHZlYzQoMC4wKSwgc3RlbmNpbCB0byAwLCBhbmQgZGVwdGggdG8gMS4wXG4gICAgICAvLyAgICAyLiBEcmF3IDNEIFRpbGVzIHRvIEZCTzJcbiAgICAgIC8vICAgIDMuIERyYXcgY2xhc3NpZmljYXRpb24gdG8gRkJPMlxuICAgICAgLy8gICAgNC4gRnVsbHNjcmVlbiBwYXNzIHRvIEZCTzMsIGRyYXcgYW55IGNvbG9yIHdoZW5cbiAgICAgIC8vICAgICAgICAgICAqIEludmVydF9EZXB0aFN0ZW5jaWwgaGFzIHRoZSBzdGVuY2lsIGJpdCBzZXQgPiAwIChjbGFzc2lmaWVkKVxuICAgICAgLy8gICAgNS4gRnVsbHNjcmVlbiBwYXNzIHRvIEZCTzEsIGRyYXcgSW52ZXJ0X0NvbG9yIHdoZW46XG4gICAgICAvLyAgICAgICAgICAgKiBJbnZlcnRfQ29sb3IgIT09IHZlYzQoMC4wKSBhbmRcbiAgICAgIC8vICAgICAgICAgICAqIElzQ2xhc3NpZmllZF9Db2xvciAhPT0gdmVjNCgwLjApXG4gICAgICAvLyAgICA2LiBGdWxsc2NyZWVuIHBhc3MgdG8gRkJPMSwgZHJhdyBJbnZlcnRfQ29sb3IgKiBjem1faW52ZXJ0Q2xhc3NpZmljYXRpb25Db2xvciB3aGVuOlxuICAgICAgLy8gICAgICAgICAgICogSW52ZXJ0X0NvbG9yICE9PSB2ZWM0KDAuMCkgYW5kXG4gICAgICAvLyAgICAgICAgICAgKiBJc0NsYXNzaWZpZWRfQ29sb3IgPT09IHZlYzQoMC4wKVxuICAgICAgLy9cbiAgICAgIC8vIE5PVEU6IFN0ZXAgc2l4IHdoZW4gdHJhbnNsdWNlbnQgaW52ZXJ0IGNvbG9yIG9jY3VycyBhZnRlciB0aGUgVFJBTlNMVUNFTlQgcGFzc1xuICAgICAgLy9cbiAgICAgIHNjZW5lLl9pbnZlcnRDbGFzc2lmaWNhdGlvbi5jbGVhcihjb250ZXh0LCBwYXNzU3RhdGUpO1xuXG4gICAgICB2YXIgb3BhcXVlQ2xhc3NpZmljYXRpb25GcmFtZWJ1ZmZlciA9IHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlcjtcbiAgICAgIHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlciA9IHNjZW5lLl9pbnZlcnRDbGFzc2lmaWNhdGlvbi5fZmJvO1xuXG4gICAgICAvLyBEcmF3IG5vcm1hbGx5XG4gICAgICB1cy51cGRhdGVQYXNzKFBhc3MuQ0VTSVVNXzNEX1RJTEUpO1xuICAgICAgY29tbWFuZHMgPSBmcnVzdHVtQ29tbWFuZHMuY29tbWFuZHNbUGFzcy5DRVNJVU1fM0RfVElMRV07XG4gICAgICBsZW5ndGggPSBmcnVzdHVtQ29tbWFuZHMuaW5kaWNlc1tQYXNzLkNFU0lVTV8zRF9USUxFXTtcbiAgICAgIGZvciAoaiA9IDA7IGogPCBsZW5ndGg7ICsraikge1xuICAgICAgICBleGVjdXRlQ29tbWFuZChjb21tYW5kc1tqXSwgc2NlbmUsIGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChkZWZpbmVkKGdsb2JlRGVwdGgpICYmIGVudmlyb25tZW50U3RhdGUudXNlR2xvYmVEZXB0aEZyYW1lYnVmZmVyKSB7XG4gICAgICAgIGdsb2JlRGVwdGguZXhlY3V0ZVVwZGF0ZURlcHRoKGNvbnRleHQsIHBhc3NTdGF0ZSwgY2xlYXJHbG9iZURlcHRoKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2V0IHN0ZW5jaWxcbiAgICAgIHVzLnVwZGF0ZVBhc3MoUGFzcy5DRVNJVU1fM0RfVElMRV9DTEFTU0lGSUNBVElPTl9JR05PUkVfU0hPVyk7XG4gICAgICBjb21tYW5kcyA9XG4gICAgICAgIGZydXN0dW1Db21tYW5kcy5jb21tYW5kc1tcbiAgICAgICAgICBQYXNzLkNFU0lVTV8zRF9USUxFX0NMQVNTSUZJQ0FUSU9OX0lHTk9SRV9TSE9XXG4gICAgICAgIF07XG4gICAgICBsZW5ndGggPVxuICAgICAgICBmcnVzdHVtQ29tbWFuZHMuaW5kaWNlc1tQYXNzLkNFU0lVTV8zRF9USUxFX0NMQVNTSUZJQ0FUSU9OX0lHTk9SRV9TSE9XXTtcbiAgICAgIGZvciAoaiA9IDA7IGogPCBsZW5ndGg7ICsraikge1xuICAgICAgICBleGVjdXRlQ29tbWFuZChjb21tYW5kc1tqXSwgc2NlbmUsIGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgICB9XG5cbiAgICAgIHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlciA9IG9wYXF1ZUNsYXNzaWZpY2F0aW9uRnJhbWVidWZmZXI7XG5cbiAgICAgIC8vIEZ1bGxzY3JlZW4gcGFzcyB0byBjb3B5IGNsYXNzaWZpZWQgZnJhZ21lbnRzXG4gICAgICBzY2VuZS5faW52ZXJ0Q2xhc3NpZmljYXRpb24uZXhlY3V0ZUNsYXNzaWZpZWQoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgICAgIGlmIChmcmFtZVN0YXRlLmludmVydENsYXNzaWZpY2F0aW9uQ29sb3IuYWxwaGEgPT09IDEuMCkge1xuICAgICAgICAvLyBGdWxsc2NyZWVuIHBhc3MgdG8gY29weSB1bmNsYXNzaWZpZWQgZnJhZ21lbnRzIHdoZW4gYWxwaGEgPT0gMS4wXG4gICAgICAgIHNjZW5lLl9pbnZlcnRDbGFzc2lmaWNhdGlvbi5leGVjdXRlVW5jbGFzc2lmaWVkKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFyIHN0ZW5jaWwgc2V0IGJ5IHRoZSBjbGFzc2lmaWNhdGlvbiBmb3IgdGhlIG5leHQgY2xhc3NpZmljYXRpb24gcGFzc1xuICAgICAgaWYgKGxlbmd0aCA+IDAgJiYgY29udGV4dC5zdGVuY2lsQnVmZmVyKSB7XG4gICAgICAgIGNsZWFyQ2xhc3NpZmljYXRpb25TdGVuY2lsLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgICAgIH1cblxuICAgICAgLy8gRHJhdyBzdHlsZSBvdmVyIGNsYXNzaWZpY2F0aW9uLlxuICAgICAgdXMudXBkYXRlUGFzcyhQYXNzLkNFU0lVTV8zRF9USUxFX0NMQVNTSUZJQ0FUSU9OKTtcbiAgICAgIGNvbW1hbmRzID0gZnJ1c3R1bUNvbW1hbmRzLmNvbW1hbmRzW1Bhc3MuQ0VTSVVNXzNEX1RJTEVfQ0xBU1NJRklDQVRJT05dO1xuICAgICAgbGVuZ3RoID0gZnJ1c3R1bUNvbW1hbmRzLmluZGljZXNbUGFzcy5DRVNJVU1fM0RfVElMRV9DTEFTU0lGSUNBVElPTl07XG4gICAgICBmb3IgKGogPSAwOyBqIDwgbGVuZ3RoOyArK2opIHtcbiAgICAgICAgZXhlY3V0ZUNvbW1hbmQoY29tbWFuZHNbal0sIHNjZW5lLCBjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChsZW5ndGggPiAwICYmIGNvbnRleHQuc3RlbmNpbEJ1ZmZlcikge1xuICAgICAgY2xlYXJTdGVuY2lsLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgICB9XG5cbiAgICB1cy51cGRhdGVQYXNzKFBhc3MuT1BBUVVFKTtcbiAgICBjb21tYW5kcyA9IGZydXN0dW1Db21tYW5kcy5jb21tYW5kc1tQYXNzLk9QQVFVRV07XG4gICAgbGVuZ3RoID0gZnJ1c3R1bUNvbW1hbmRzLmluZGljZXNbUGFzcy5PUEFRVUVdO1xuICAgIGZvciAoaiA9IDA7IGogPCBsZW5ndGg7ICsraikge1xuICAgICAgZXhlY3V0ZUNvbW1hbmQoY29tbWFuZHNbal0sIHNjZW5lLCBjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgIH1cblxuICAgIGlmIChpbmRleCAhPT0gMCAmJiBzY2VuZS5tb2RlICE9PSBTY2VuZU1vZGUuU0NFTkUyRCkge1xuICAgICAgLy8gRG8gbm90IG92ZXJsYXAgZnJ1c3R1bXMgaW4gdGhlIHRyYW5zbHVjZW50IHBhc3MgdG8gYXZvaWQgYmxlbmRpbmcgYXJ0aWZhY3RzXG4gICAgICBmcnVzdHVtLm5lYXIgPSBmcnVzdHVtQ29tbWFuZHMubmVhcjtcbiAgICAgIHVzLnVwZGF0ZUZydXN0dW0oZnJ1c3R1bSk7XG4gICAgfVxuXG4gICAgdmFyIGludmVydENsYXNzaWZpY2F0aW9uO1xuICAgIGlmIChcbiAgICAgICFwaWNraW5nICYmXG4gICAgICBlbnZpcm9ubWVudFN0YXRlLnVzZUludmVydENsYXNzaWZpY2F0aW9uICYmXG4gICAgICBmcmFtZVN0YXRlLmludmVydENsYXNzaWZpY2F0aW9uQ29sb3IuYWxwaGEgPCAxLjBcbiAgICApIHtcbiAgICAgIC8vIEZ1bGxzY3JlZW4gcGFzcyB0byBjb3B5IHVuY2xhc3NpZmllZCBmcmFnbWVudHMgd2hlbiBhbHBoYSA8IDEuMC5cbiAgICAgIC8vIE5vdCBleGVjdXRlZCB3aGVuIHVuZGVmaW5lZC5cbiAgICAgIGludmVydENsYXNzaWZpY2F0aW9uID0gc2NlbmUuX2ludmVydENsYXNzaWZpY2F0aW9uO1xuICAgIH1cblxuICAgIHVzLnVwZGF0ZVBhc3MoUGFzcy5UUkFOU0xVQ0VOVCk7XG4gICAgY29tbWFuZHMgPSBmcnVzdHVtQ29tbWFuZHMuY29tbWFuZHNbUGFzcy5UUkFOU0xVQ0VOVF07XG4gICAgY29tbWFuZHMubGVuZ3RoID0gZnJ1c3R1bUNvbW1hbmRzLmluZGljZXNbUGFzcy5UUkFOU0xVQ0VOVF07XG4gICAgZXhlY3V0ZVRyYW5zbHVjZW50Q29tbWFuZHMoXG4gICAgICBzY2VuZSxcbiAgICAgIGV4ZWN1dGVDb21tYW5kLFxuICAgICAgcGFzc1N0YXRlLFxuICAgICAgY29tbWFuZHMsXG4gICAgICBpbnZlcnRDbGFzc2lmaWNhdGlvblxuICAgICk7XG5cbiAgICAvLyBDbGFzc2lmaWNhdGlvbiBmb3IgdHJhbnNsdWNlbnQgM0QgVGlsZXNcbiAgICB2YXIgaGFzM0RUaWxlc0NsYXNzaWZpY2F0aW9uQ29tbWFuZHMgPVxuICAgICAgZnJ1c3R1bUNvbW1hbmRzLmluZGljZXNbUGFzcy5DRVNJVU1fM0RfVElMRV9DTEFTU0lGSUNBVElPTl0gPiAwO1xuICAgIGlmIChcbiAgICAgIGhhczNEVGlsZXNDbGFzc2lmaWNhdGlvbkNvbW1hbmRzICYmXG4gICAgICB2aWV3LnRyYW5zbHVjZW50VGlsZUNsYXNzaWZpY2F0aW9uLmlzU3VwcG9ydGVkKClcbiAgICApIHtcbiAgICAgIHZpZXcudHJhbnNsdWNlbnRUaWxlQ2xhc3NpZmljYXRpb24uZXhlY3V0ZVRyYW5zbHVjZW50Q29tbWFuZHMoXG4gICAgICAgIHNjZW5lLFxuICAgICAgICBleGVjdXRlQ29tbWFuZCxcbiAgICAgICAgcGFzc1N0YXRlLFxuICAgICAgICBjb21tYW5kcyxcbiAgICAgICAgZ2xvYmVEZXB0aC5mcmFtZWJ1ZmZlclxuICAgICAgKTtcbiAgICAgIHZpZXcudHJhbnNsdWNlbnRUaWxlQ2xhc3NpZmljYXRpb24uZXhlY3V0ZUNsYXNzaWZpY2F0aW9uQ29tbWFuZHMoXG4gICAgICAgIHNjZW5lLFxuICAgICAgICBleGVjdXRlQ29tbWFuZCxcbiAgICAgICAgcGFzc1N0YXRlLFxuICAgICAgICBmcnVzdHVtQ29tbWFuZHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgY29udGV4dC5kZXB0aFRleHR1cmUgJiZcbiAgICAgIHNjZW5lLnVzZURlcHRoUGlja2luZyAmJlxuICAgICAgKGVudmlyb25tZW50U3RhdGUudXNlR2xvYmVEZXB0aEZyYW1lYnVmZmVyIHx8XG4gICAgICAgIHJlbmRlclRyYW5zbHVjZW50RGVwdGhGb3JQaWNrKVxuICAgICkge1xuICAgICAgLy8gUEVSRk9STUFOQ0VfSURFQTogVXNlIE1SVCB0byBhdm9pZCB0aGUgZXh0cmEgY29weS5cbiAgICAgIHZhciBkZXB0aFN0ZW5jaWxUZXh0dXJlID0gcmVuZGVyVHJhbnNsdWNlbnREZXB0aEZvclBpY2tcbiAgICAgICAgPyBwYXNzU3RhdGUuZnJhbWVidWZmZXIuZGVwdGhTdGVuY2lsVGV4dHVyZVxuICAgICAgICA6IGdsb2JlRGVwdGguZnJhbWVidWZmZXIuZGVwdGhTdGVuY2lsVGV4dHVyZTtcbiAgICAgIHZhciBwaWNrRGVwdGggPSBzY2VuZS5fcGlja2luZy5nZXRQaWNrRGVwdGgoc2NlbmUsIGluZGV4KTtcbiAgICAgIHBpY2tEZXB0aC51cGRhdGUoY29udGV4dCwgZGVwdGhTdGVuY2lsVGV4dHVyZSk7XG4gICAgICBwaWNrRGVwdGguZXhlY3V0ZUNvcHlEZXB0aChjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgIH1cblxuICAgIGlmIChzZXBhcmF0ZVByaW1pdGl2ZUZyYW1lYnVmZmVyKSB7XG4gICAgICAvLyBSZXNldCBmcmFtZWJ1ZmZlclxuICAgICAgcGFzc1N0YXRlLmZyYW1lYnVmZmVyID0gZ2xvYmVEZXB0aC5mcmFtZWJ1ZmZlcjtcbiAgICB9XG5cbiAgICBpZiAocGlja2luZyB8fCAhdXNlUG9zdFByb2Nlc3NTZWxlY3RlZCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgdmFyIG9yaWdpbmFsRnJhbWVidWZmZXIgPSBwYXNzU3RhdGUuZnJhbWVidWZmZXI7XG4gICAgcGFzc1N0YXRlLmZyYW1lYnVmZmVyID0gdmlldy5zY2VuZUZyYW1lYnVmZmVyLmdldElkRnJhbWVidWZmZXIoKTtcblxuICAgIC8vIHJlc2V0IGZydXN0dW1cbiAgICBmcnVzdHVtLm5lYXIgPVxuICAgICAgaW5kZXggIT09IDBcbiAgICAgICAgPyBmcnVzdHVtQ29tbWFuZHMubmVhciAqIHNjZW5lLm9wYXF1ZUZydXN0dW1OZWFyT2Zmc2V0XG4gICAgICAgIDogZnJ1c3R1bUNvbW1hbmRzLm5lYXI7XG4gICAgZnJ1c3R1bS5mYXIgPSBmcnVzdHVtQ29tbWFuZHMuZmFyO1xuICAgIHVzLnVwZGF0ZUZydXN0dW0oZnJ1c3R1bSk7XG5cbiAgICB1cy51cGRhdGVQYXNzKFBhc3MuR0xPQkUpO1xuICAgIGNvbW1hbmRzID0gZnJ1c3R1bUNvbW1hbmRzLmNvbW1hbmRzW1Bhc3MuR0xPQkVdO1xuICAgIGxlbmd0aCA9IGZydXN0dW1Db21tYW5kcy5pbmRpY2VzW1Bhc3MuR0xPQkVdO1xuXG4gICAgaWYgKGdsb2JlVHJhbnNsdWNlbnQpIHtcbiAgICAgIGdsb2JlVHJhbnNsdWNlbmN5U3RhdGUuZXhlY3V0ZUdsb2JlQ29tbWFuZHMoXG4gICAgICAgIGZydXN0dW1Db21tYW5kcyxcbiAgICAgICAgZXhlY3V0ZUlkQ29tbWFuZCxcbiAgICAgICAgZ2xvYmVUcmFuc2x1Y2VuY3lGcmFtZWJ1ZmZlcixcbiAgICAgICAgc2NlbmUsXG4gICAgICAgIHBhc3NTdGF0ZVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChqID0gMDsgaiA8IGxlbmd0aDsgKytqKSB7XG4gICAgICAgIGV4ZWN1dGVJZENvbW1hbmQoY29tbWFuZHNbal0sIHNjZW5lLCBjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjbGVhckdsb2JlRGVwdGgpIHtcbiAgICAgIGNsZWFyRGVwdGguZnJhbWVidWZmZXIgPSBwYXNzU3RhdGUuZnJhbWVidWZmZXI7XG4gICAgICBjbGVhckRlcHRoLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgICAgIGNsZWFyRGVwdGguZnJhbWVidWZmZXIgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaWYgKGNsZWFyR2xvYmVEZXB0aCAmJiB1c2VEZXB0aFBsYW5lKSB7XG4gICAgICBkZXB0aFBsYW5lLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgICB9XG5cbiAgICB1cy51cGRhdGVQYXNzKFBhc3MuQ0VTSVVNXzNEX1RJTEUpO1xuICAgIGNvbW1hbmRzID0gZnJ1c3R1bUNvbW1hbmRzLmNvbW1hbmRzW1Bhc3MuQ0VTSVVNXzNEX1RJTEVdO1xuICAgIGxlbmd0aCA9IGZydXN0dW1Db21tYW5kcy5pbmRpY2VzW1Bhc3MuQ0VTSVVNXzNEX1RJTEVdO1xuICAgIGZvciAoaiA9IDA7IGogPCBsZW5ndGg7ICsraikge1xuICAgICAgZXhlY3V0ZUlkQ29tbWFuZChjb21tYW5kc1tqXSwgc2NlbmUsIGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgfVxuXG4gICAgdXMudXBkYXRlUGFzcyhQYXNzLk9QQVFVRSk7XG4gICAgY29tbWFuZHMgPSBmcnVzdHVtQ29tbWFuZHMuY29tbWFuZHNbUGFzcy5PUEFRVUVdO1xuICAgIGxlbmd0aCA9IGZydXN0dW1Db21tYW5kcy5pbmRpY2VzW1Bhc3MuT1BBUVVFXTtcbiAgICBmb3IgKGogPSAwOyBqIDwgbGVuZ3RoOyArK2opIHtcbiAgICAgIGV4ZWN1dGVJZENvbW1hbmQoY29tbWFuZHNbal0sIHNjZW5lLCBjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgIH1cblxuICAgIHVzLnVwZGF0ZVBhc3MoUGFzcy5UUkFOU0xVQ0VOVCk7XG4gICAgY29tbWFuZHMgPSBmcnVzdHVtQ29tbWFuZHMuY29tbWFuZHNbUGFzcy5UUkFOU0xVQ0VOVF07XG4gICAgbGVuZ3RoID0gZnJ1c3R1bUNvbW1hbmRzLmluZGljZXNbUGFzcy5UUkFOU0xVQ0VOVF07XG4gICAgZm9yIChqID0gMDsgaiA8IGxlbmd0aDsgKytqKSB7XG4gICAgICBleGVjdXRlSWRDb21tYW5kKGNvbW1hbmRzW2pdLCBzY2VuZSwgY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgICB9XG5cbiAgICBwYXNzU3RhdGUuZnJhbWVidWZmZXIgPSBvcmlnaW5hbEZyYW1lYnVmZmVyO1xuICB9XG59XG5cbmZ1bmN0aW9uIGV4ZWN1dGVDb21wdXRlQ29tbWFuZHMoc2NlbmUpIHtcbiAgdmFyIHVzID0gc2NlbmUuY29udGV4dC51bmlmb3JtU3RhdGU7XG4gIHVzLnVwZGF0ZVBhc3MoUGFzcy5DT01QVVRFKTtcblxuICB2YXIgc3VuQ29tcHV0ZUNvbW1hbmQgPSBzY2VuZS5fZW52aXJvbm1lbnRTdGF0ZS5zdW5Db21wdXRlQ29tbWFuZDtcbiAgaWYgKGRlZmluZWQoc3VuQ29tcHV0ZUNvbW1hbmQpKSB7XG4gICAgc3VuQ29tcHV0ZUNvbW1hbmQuZXhlY3V0ZShzY2VuZS5fY29tcHV0ZUVuZ2luZSk7XG4gIH1cblxuICB2YXIgY29tbWFuZExpc3QgPSBzY2VuZS5fY29tcHV0ZUNvbW1hbmRMaXN0O1xuICB2YXIgbGVuZ3RoID0gY29tbWFuZExpc3QubGVuZ3RoO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgY29tbWFuZExpc3RbaV0uZXhlY3V0ZShzY2VuZS5fY29tcHV0ZUVuZ2luZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZXhlY3V0ZU92ZXJsYXlDb21tYW5kcyhzY2VuZSwgcGFzc1N0YXRlKSB7XG4gIHZhciB1cyA9IHNjZW5lLmNvbnRleHQudW5pZm9ybVN0YXRlO1xuICB1cy51cGRhdGVQYXNzKFBhc3MuT1ZFUkxBWSk7XG5cbiAgdmFyIGNvbnRleHQgPSBzY2VuZS5jb250ZXh0O1xuICB2YXIgY29tbWFuZExpc3QgPSBzY2VuZS5fb3ZlcmxheUNvbW1hbmRMaXN0O1xuICB2YXIgbGVuZ3RoID0gY29tbWFuZExpc3QubGVuZ3RoO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgY29tbWFuZExpc3RbaV0uZXhlY3V0ZShjb250ZXh0LCBwYXNzU3RhdGUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGluc2VydFNoYWRvd0Nhc3RDb21tYW5kcyhzY2VuZSwgY29tbWFuZExpc3QsIHNoYWRvd01hcCkge1xuICB2YXIgc2hhZG93Vm9sdW1lID0gc2hhZG93TWFwLnNoYWRvd01hcEN1bGxpbmdWb2x1bWU7XG4gIHZhciBpc1BvaW50TGlnaHQgPSBzaGFkb3dNYXAuaXNQb2ludExpZ2h0O1xuICB2YXIgcGFzc2VzID0gc2hhZG93TWFwLnBhc3NlcztcbiAgdmFyIG51bWJlck9mUGFzc2VzID0gcGFzc2VzLmxlbmd0aDtcblxuICB2YXIgbGVuZ3RoID0gY29tbWFuZExpc3QubGVuZ3RoO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgdmFyIGNvbW1hbmQgPSBjb21tYW5kTGlzdFtpXTtcbiAgICBzY2VuZS51cGRhdGVEZXJpdmVkQ29tbWFuZHMoY29tbWFuZCk7XG5cbiAgICBpZiAoXG4gICAgICBjb21tYW5kLmNhc3RTaGFkb3dzICYmXG4gICAgICAoY29tbWFuZC5wYXNzID09PSBQYXNzLkdMT0JFIHx8XG4gICAgICAgIGNvbW1hbmQucGFzcyA9PT0gUGFzcy5DRVNJVU1fM0RfVElMRSB8fFxuICAgICAgICBjb21tYW5kLnBhc3MgPT09IFBhc3MuT1BBUVVFIHx8XG4gICAgICAgIGNvbW1hbmQucGFzcyA9PT0gUGFzcy5UUkFOU0xVQ0VOVClcbiAgICApIHtcbiAgICAgIGlmIChzY2VuZS5pc1Zpc2libGUoY29tbWFuZCwgc2hhZG93Vm9sdW1lKSkge1xuICAgICAgICBpZiAoaXNQb2ludExpZ2h0KSB7XG4gICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBudW1iZXJPZlBhc3NlczsgKytrKSB7XG4gICAgICAgICAgICBwYXNzZXNba10uY29tbWFuZExpc3QucHVzaChjb21tYW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAobnVtYmVyT2ZQYXNzZXMgPT09IDEpIHtcbiAgICAgICAgICBwYXNzZXNbMF0uY29tbWFuZExpc3QucHVzaChjb21tYW5kKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgd2FzVmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgIC8vIExvb3Agb3ZlciBjYXNjYWRlcyBmcm9tIGxhcmdlc3QgdG8gc21hbGxlc3RcbiAgICAgICAgICBmb3IgKHZhciBqID0gbnVtYmVyT2ZQYXNzZXMgLSAxOyBqID49IDA7IC0taikge1xuICAgICAgICAgICAgdmFyIGNhc2NhZGVWb2x1bWUgPSBwYXNzZXNbal0uY3VsbGluZ1ZvbHVtZTtcbiAgICAgICAgICAgIGlmIChzY2VuZS5pc1Zpc2libGUoY29tbWFuZCwgY2FzY2FkZVZvbHVtZSkpIHtcbiAgICAgICAgICAgICAgcGFzc2VzW2pdLmNvbW1hbmRMaXN0LnB1c2goY29tbWFuZCk7XG4gICAgICAgICAgICAgIHdhc1Zpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh3YXNWaXNpYmxlKSB7XG4gICAgICAgICAgICAgIC8vIElmIGl0IHdhcyB2aXNpYmxlIGluIHRoZSBwcmV2aW91cyBjYXNjYWRlIGJ1dCBub3cgaXNuJ3RcbiAgICAgICAgICAgICAgLy8gdGhlbiB0aGVyZSBpcyBubyBuZWVkIHRvIGNoZWNrIGFueSBtb3JlIGNhc2NhZGVzXG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBleGVjdXRlU2hhZG93TWFwQ2FzdENvbW1hbmRzKHNjZW5lKSB7XG4gIHZhciBmcmFtZVN0YXRlID0gc2NlbmUuZnJhbWVTdGF0ZTtcbiAgdmFyIHNoYWRvd01hcHMgPSBmcmFtZVN0YXRlLnNoYWRvd1N0YXRlLnNoYWRvd01hcHM7XG4gIHZhciBzaGFkb3dNYXBMZW5ndGggPSBzaGFkb3dNYXBzLmxlbmd0aDtcblxuICBpZiAoIWZyYW1lU3RhdGUuc2hhZG93U3RhdGUuc2hhZG93c0VuYWJsZWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgY29udGV4dCA9IHNjZW5lLmNvbnRleHQ7XG4gIHZhciB1bmlmb3JtU3RhdGUgPSBjb250ZXh0LnVuaWZvcm1TdGF0ZTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHNoYWRvd01hcExlbmd0aDsgKytpKSB7XG4gICAgdmFyIHNoYWRvd01hcCA9IHNoYWRvd01hcHNbaV07XG4gICAgaWYgKHNoYWRvd01hcC5vdXRPZlZpZXcpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIFJlc2V0IHRoZSBjb21tYW5kIGxpc3RzXG4gICAgdmFyIGo7XG4gICAgdmFyIHBhc3NlcyA9IHNoYWRvd01hcC5wYXNzZXM7XG4gICAgdmFyIG51bWJlck9mUGFzc2VzID0gcGFzc2VzLmxlbmd0aDtcbiAgICBmb3IgKGogPSAwOyBqIDwgbnVtYmVyT2ZQYXNzZXM7ICsraikge1xuICAgICAgcGFzc2VzW2pdLmNvbW1hbmRMaXN0Lmxlbmd0aCA9IDA7XG4gICAgfVxuXG4gICAgLy8gSW5zZXJ0IHRoZSBwcmltaXRpdmUvbW9kZWwgY29tbWFuZHMgaW50byB0aGUgY29tbWFuZCBsaXN0c1xuICAgIHZhciBzY2VuZUNvbW1hbmRzID0gc2NlbmUuZnJhbWVTdGF0ZS5jb21tYW5kTGlzdDtcbiAgICBpbnNlcnRTaGFkb3dDYXN0Q29tbWFuZHMoc2NlbmUsIHNjZW5lQ29tbWFuZHMsIHNoYWRvd01hcCk7XG5cbiAgICBmb3IgKGogPSAwOyBqIDwgbnVtYmVyT2ZQYXNzZXM7ICsraikge1xuICAgICAgdmFyIHBhc3MgPSBzaGFkb3dNYXAucGFzc2VzW2pdO1xuICAgICAgdW5pZm9ybVN0YXRlLnVwZGF0ZUNhbWVyYShwYXNzLmNhbWVyYSk7XG4gICAgICBzaGFkb3dNYXAudXBkYXRlUGFzcyhjb250ZXh0LCBqKTtcbiAgICAgIHZhciBudW1iZXJPZkNvbW1hbmRzID0gcGFzcy5jb21tYW5kTGlzdC5sZW5ndGg7XG4gICAgICBmb3IgKHZhciBrID0gMDsgayA8IG51bWJlck9mQ29tbWFuZHM7ICsraykge1xuICAgICAgICB2YXIgY29tbWFuZCA9IHBhc3MuY29tbWFuZExpc3Rba107XG4gICAgICAgIC8vIFNldCB0aGUgY29ycmVjdCBwYXNzIGJlZm9yZSByZW5kZXJpbmcgaW50byB0aGUgc2hhZG93IG1hcCBiZWNhdXNlIHNvbWUgc2hhZGVyc1xuICAgICAgICAvLyBjb25kaXRpb25hbGx5IHJlbmRlciBiYXNlZCBvbiB3aGV0aGVyIHRoZSBwYXNzIGlzIHRyYW5zbHVjZW50IG9yIG9wYXF1ZS5cbiAgICAgICAgdW5pZm9ybVN0YXRlLnVwZGF0ZVBhc3MoY29tbWFuZC5wYXNzKTtcbiAgICAgICAgZXhlY3V0ZUNvbW1hbmQoXG4gICAgICAgICAgY29tbWFuZC5kZXJpdmVkQ29tbWFuZHMuc2hhZG93cy5jYXN0Q29tbWFuZHNbaV0sXG4gICAgICAgICAgc2NlbmUsXG4gICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICBwYXNzLnBhc3NTdGF0ZVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG52YXIgc2NyYXRjaEV5ZVRyYW5zbGF0aW9uID0gbmV3IENhcnRlc2lhbjMoKTtcblxuLyoqXG4gKiBAcHJpdmF0ZVxuICovXG5TY2VuZS5wcm90b3R5cGUudXBkYXRlQW5kRXhlY3V0ZUNvbW1hbmRzID0gZnVuY3Rpb24gKFxuICBwYXNzU3RhdGUsXG4gIGJhY2tncm91bmRDb2xvclxuKSB7XG4gIHZhciBmcmFtZVN0YXRlID0gdGhpcy5fZnJhbWVTdGF0ZTtcbiAgdmFyIG1vZGUgPSBmcmFtZVN0YXRlLm1vZGU7XG4gIHZhciB1c2VXZWJWUiA9IHRoaXMuX2Vudmlyb25tZW50U3RhdGUudXNlV2ViVlI7XG5cbiAgaWYgKHVzZVdlYlZSKSB7XG4gICAgZXhlY3V0ZVdlYlZSQ29tbWFuZHModGhpcywgcGFzc1N0YXRlLCBiYWNrZ3JvdW5kQ29sb3IpO1xuICB9IGVsc2UgaWYgKFxuICAgIG1vZGUgIT09IFNjZW5lTW9kZS5TQ0VORTJEIHx8XG4gICAgdGhpcy5fbWFwTW9kZTJEID09PSBNYXBNb2RlMkQuUk9UQVRFXG4gICkge1xuICAgIGV4ZWN1dGVDb21tYW5kc0luVmlld3BvcnQodHJ1ZSwgdGhpcywgcGFzc1N0YXRlLCBiYWNrZ3JvdW5kQ29sb3IpO1xuICB9IGVsc2Uge1xuICAgIHVwZGF0ZUFuZENsZWFyRnJhbWVidWZmZXJzKHRoaXMsIHBhc3NTdGF0ZSwgYmFja2dyb3VuZENvbG9yKTtcbiAgICBleGVjdXRlMkRWaWV3cG9ydENvbW1hbmRzKHRoaXMsIHBhc3NTdGF0ZSk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGV4ZWN1dGVXZWJWUkNvbW1hbmRzKHNjZW5lLCBwYXNzU3RhdGUsIGJhY2tncm91bmRDb2xvcikge1xuICB2YXIgdmlldyA9IHNjZW5lLl92aWV3O1xuICB2YXIgY2FtZXJhID0gdmlldy5jYW1lcmE7XG4gIHZhciBlbnZpcm9ubWVudFN0YXRlID0gc2NlbmUuX2Vudmlyb25tZW50U3RhdGU7XG4gIHZhciByZW5kZXJUcmFuc2x1Y2VudERlcHRoRm9yUGljayA9XG4gICAgZW52aXJvbm1lbnRTdGF0ZS5yZW5kZXJUcmFuc2x1Y2VudERlcHRoRm9yUGljaztcblxuICB1cGRhdGVBbmRDbGVhckZyYW1lYnVmZmVycyhzY2VuZSwgcGFzc1N0YXRlLCBiYWNrZ3JvdW5kQ29sb3IpO1xuXG4gIGlmICghcmVuZGVyVHJhbnNsdWNlbnREZXB0aEZvclBpY2spIHtcbiAgICB1cGRhdGVBbmRSZW5kZXJQcmltaXRpdmVzKHNjZW5lKTtcbiAgfVxuXG4gIHZpZXcuY3JlYXRlUG90ZW50aWFsbHlWaXNpYmxlU2V0KHNjZW5lKTtcblxuICBpZiAoIXJlbmRlclRyYW5zbHVjZW50RGVwdGhGb3JQaWNrKSB7XG4gICAgZXhlY3V0ZUNvbXB1dGVDb21tYW5kcyhzY2VuZSk7XG4gICAgZXhlY3V0ZVNoYWRvd01hcENhc3RDb21tYW5kcyhzY2VuZSk7XG4gIH1cblxuICAvLyBCYXNlZCBvbiBDYWxjdWxhdGluZyBTdGVyZW8gcGFpcnMgYnkgUGF1bCBCb3Vya2VcbiAgLy8gaHR0cDovL3BhdWxib3Vya2UubmV0L3N0ZXJlb2dyYXBoaWNzL3N0ZXJlb3JlbmRlci9cbiAgdmFyIHZpZXdwb3J0ID0gcGFzc1N0YXRlLnZpZXdwb3J0O1xuICB2aWV3cG9ydC54ID0gMDtcbiAgdmlld3BvcnQueSA9IDA7XG4gIHZpZXdwb3J0LndpZHRoID0gdmlld3BvcnQud2lkdGggKiAwLjU7XG5cbiAgdmFyIHNhdmVkQ2FtZXJhID0gQ2FtZXJhLmNsb25lKGNhbWVyYSwgc2NlbmUuX2NhbWVyYVZSKTtcbiAgc2F2ZWRDYW1lcmEuZnJ1c3R1bSA9IGNhbWVyYS5mcnVzdHVtO1xuXG4gIHZhciBuZWFyID0gY2FtZXJhLmZydXN0dW0ubmVhcjtcbiAgdmFyIGZvID0gbmVhciAqIGRlZmF1bHRWYWx1ZShzY2VuZS5mb2NhbExlbmd0aCwgNS4wKTtcbiAgdmFyIGV5ZVNlcGFyYXRpb24gPSBkZWZhdWx0VmFsdWUoc2NlbmUuZXllU2VwYXJhdGlvbiwgZm8gLyAzMC4wKTtcbiAgdmFyIGV5ZVRyYW5zbGF0aW9uID0gQ2FydGVzaWFuMy5tdWx0aXBseUJ5U2NhbGFyKFxuICAgIHNhdmVkQ2FtZXJhLnJpZ2h0LFxuICAgIGV5ZVNlcGFyYXRpb24gKiAwLjUsXG4gICAgc2NyYXRjaEV5ZVRyYW5zbGF0aW9uXG4gICk7XG5cbiAgY2FtZXJhLmZydXN0dW0uYXNwZWN0UmF0aW8gPSB2aWV3cG9ydC53aWR0aCAvIHZpZXdwb3J0LmhlaWdodDtcblxuICB2YXIgb2Zmc2V0ID0gKDAuNSAqIGV5ZVNlcGFyYXRpb24gKiBuZWFyKSAvIGZvO1xuXG4gIENhcnRlc2lhbjMuYWRkKHNhdmVkQ2FtZXJhLnBvc2l0aW9uLCBleWVUcmFuc2xhdGlvbiwgY2FtZXJhLnBvc2l0aW9uKTtcbiAgY2FtZXJhLmZydXN0dW0ueE9mZnNldCA9IG9mZnNldDtcblxuICBleGVjdXRlQ29tbWFuZHMoc2NlbmUsIHBhc3NTdGF0ZSk7XG5cbiAgdmlld3BvcnQueCA9IHZpZXdwb3J0LndpZHRoO1xuXG4gIENhcnRlc2lhbjMuc3VidHJhY3Qoc2F2ZWRDYW1lcmEucG9zaXRpb24sIGV5ZVRyYW5zbGF0aW9uLCBjYW1lcmEucG9zaXRpb24pO1xuICBjYW1lcmEuZnJ1c3R1bS54T2Zmc2V0ID0gLW9mZnNldDtcblxuICBleGVjdXRlQ29tbWFuZHMoc2NlbmUsIHBhc3NTdGF0ZSk7XG5cbiAgQ2FtZXJhLmNsb25lKHNhdmVkQ2FtZXJhLCBjYW1lcmEpO1xufVxuXG52YXIgc2NyYXRjaDJEVmlld3BvcnRDYXJ0b2dyYXBoaWMgPSBuZXcgQ2FydG9ncmFwaGljKFxuICBNYXRoLlBJLFxuICBDZXNpdW1NYXRoLlBJX09WRVJfVFdPXG4pO1xudmFyIHNjcmF0Y2gyRFZpZXdwb3J0TWF4Q29vcmQgPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHNjcmF0Y2gyRFZpZXdwb3J0U2F2ZWRQb3NpdGlvbiA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaDJEVmlld3BvcnRUcmFuc2Zvcm0gPSBuZXcgTWF0cml4NCgpO1xudmFyIHNjcmF0Y2gyRFZpZXdwb3J0Q2FtZXJhVHJhbnNmb3JtID0gbmV3IE1hdHJpeDQoKTtcbnZhciBzY3JhdGNoMkRWaWV3cG9ydEV5ZVBvaW50ID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoMkRWaWV3cG9ydFdpbmRvd0Nvb3JkcyA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaDJEVmlld3BvcnQgPSBuZXcgQm91bmRpbmdSZWN0YW5nbGUoKTtcblxuZnVuY3Rpb24gZXhlY3V0ZTJEVmlld3BvcnRDb21tYW5kcyhzY2VuZSwgcGFzc1N0YXRlKSB7XG4gIHZhciBjb250ZXh0ID0gc2NlbmUuY29udGV4dDtcbiAgdmFyIGZyYW1lU3RhdGUgPSBzY2VuZS5mcmFtZVN0YXRlO1xuICB2YXIgY2FtZXJhID0gc2NlbmUuY2FtZXJhO1xuXG4gIHZhciBvcmlnaW5hbFZpZXdwb3J0ID0gcGFzc1N0YXRlLnZpZXdwb3J0O1xuICB2YXIgdmlld3BvcnQgPSBCb3VuZGluZ1JlY3RhbmdsZS5jbG9uZShvcmlnaW5hbFZpZXdwb3J0LCBzY3JhdGNoMkRWaWV3cG9ydCk7XG4gIHBhc3NTdGF0ZS52aWV3cG9ydCA9IHZpZXdwb3J0O1xuXG4gIHZhciBtYXhDYXJ0b2dyYXBoaWMgPSBzY3JhdGNoMkRWaWV3cG9ydENhcnRvZ3JhcGhpYztcbiAgdmFyIG1heENvb3JkID0gc2NyYXRjaDJEVmlld3BvcnRNYXhDb29yZDtcblxuICB2YXIgcHJvamVjdGlvbiA9IHNjZW5lLm1hcFByb2plY3Rpb247XG4gIHByb2plY3Rpb24ucHJvamVjdChtYXhDYXJ0b2dyYXBoaWMsIG1heENvb3JkKTtcblxuICB2YXIgcG9zaXRpb24gPSBDYXJ0ZXNpYW4zLmNsb25lKFxuICAgIGNhbWVyYS5wb3NpdGlvbixcbiAgICBzY3JhdGNoMkRWaWV3cG9ydFNhdmVkUG9zaXRpb25cbiAgKTtcbiAgdmFyIHRyYW5zZm9ybSA9IE1hdHJpeDQuY2xvbmUoXG4gICAgY2FtZXJhLnRyYW5zZm9ybSxcbiAgICBzY3JhdGNoMkRWaWV3cG9ydENhbWVyYVRyYW5zZm9ybVxuICApO1xuICB2YXIgZnJ1c3R1bSA9IGNhbWVyYS5mcnVzdHVtLmNsb25lKCk7XG5cbiAgY2FtZXJhLl9zZXRUcmFuc2Zvcm0oTWF0cml4NC5JREVOVElUWSk7XG5cbiAgdmFyIHZpZXdwb3J0VHJhbnNmb3JtYXRpb24gPSBNYXRyaXg0LmNvbXB1dGVWaWV3cG9ydFRyYW5zZm9ybWF0aW9uKFxuICAgIHZpZXdwb3J0LFxuICAgIDAuMCxcbiAgICAxLjAsXG4gICAgc2NyYXRjaDJEVmlld3BvcnRUcmFuc2Zvcm1cbiAgKTtcbiAgdmFyIHByb2plY3Rpb25NYXRyaXggPSBjYW1lcmEuZnJ1c3R1bS5wcm9qZWN0aW9uTWF0cml4O1xuXG4gIHZhciB4ID0gY2FtZXJhLnBvc2l0aW9uV0MueTtcbiAgdmFyIGV5ZVBvaW50ID0gQ2FydGVzaWFuMy5mcm9tRWxlbWVudHMoXG4gICAgQ2VzaXVtTWF0aC5zaWduKHgpICogbWF4Q29vcmQueCAtIHgsXG4gICAgMC4wLFxuICAgIC1jYW1lcmEucG9zaXRpb25XQy54LFxuICAgIHNjcmF0Y2gyRFZpZXdwb3J0RXllUG9pbnRcbiAgKTtcbiAgdmFyIHdpbmRvd0Nvb3JkaW5hdGVzID0gVHJhbnNmb3Jtcy5wb2ludFRvR0xXaW5kb3dDb29yZGluYXRlcyhcbiAgICBwcm9qZWN0aW9uTWF0cml4LFxuICAgIHZpZXdwb3J0VHJhbnNmb3JtYXRpb24sXG4gICAgZXllUG9pbnQsXG4gICAgc2NyYXRjaDJEVmlld3BvcnRXaW5kb3dDb29yZHNcbiAgKTtcblxuICB3aW5kb3dDb29yZGluYXRlcy54ID0gTWF0aC5mbG9vcih3aW5kb3dDb29yZGluYXRlcy54KTtcblxuICB2YXIgdmlld3BvcnRYID0gdmlld3BvcnQueDtcbiAgdmFyIHZpZXdwb3J0V2lkdGggPSB2aWV3cG9ydC53aWR0aDtcblxuICBpZiAoXG4gICAgeCA9PT0gMC4wIHx8XG4gICAgd2luZG93Q29vcmRpbmF0ZXMueCA8PSB2aWV3cG9ydFggfHxcbiAgICB3aW5kb3dDb29yZGluYXRlcy54ID49IHZpZXdwb3J0WCArIHZpZXdwb3J0V2lkdGhcbiAgKSB7XG4gICAgZXhlY3V0ZUNvbW1hbmRzSW5WaWV3cG9ydCh0cnVlLCBzY2VuZSwgcGFzc1N0YXRlKTtcbiAgfSBlbHNlIGlmIChcbiAgICBNYXRoLmFicyh2aWV3cG9ydFggKyB2aWV3cG9ydFdpZHRoICogMC41IC0gd2luZG93Q29vcmRpbmF0ZXMueCkgPCAxLjBcbiAgKSB7XG4gICAgdmlld3BvcnQud2lkdGggPSB3aW5kb3dDb29yZGluYXRlcy54IC0gdmlld3BvcnQueDtcblxuICAgIGNhbWVyYS5wb3NpdGlvbi54ICo9IENlc2l1bU1hdGguc2lnbihjYW1lcmEucG9zaXRpb24ueCk7XG5cbiAgICBjYW1lcmEuZnJ1c3R1bS5yaWdodCA9IDAuMDtcblxuICAgIGZyYW1lU3RhdGUuY3VsbGluZ1ZvbHVtZSA9IGNhbWVyYS5mcnVzdHVtLmNvbXB1dGVDdWxsaW5nVm9sdW1lKFxuICAgICAgY2FtZXJhLnBvc2l0aW9uV0MsXG4gICAgICBjYW1lcmEuZGlyZWN0aW9uV0MsXG4gICAgICBjYW1lcmEudXBXQ1xuICAgICk7XG4gICAgY29udGV4dC51bmlmb3JtU3RhdGUudXBkYXRlKGZyYW1lU3RhdGUpO1xuXG4gICAgZXhlY3V0ZUNvbW1hbmRzSW5WaWV3cG9ydCh0cnVlLCBzY2VuZSwgcGFzc1N0YXRlKTtcblxuICAgIHZpZXdwb3J0LnggPSB3aW5kb3dDb29yZGluYXRlcy54O1xuXG4gICAgY2FtZXJhLnBvc2l0aW9uLnggPSAtY2FtZXJhLnBvc2l0aW9uLng7XG5cbiAgICBjYW1lcmEuZnJ1c3R1bS5yaWdodCA9IC1jYW1lcmEuZnJ1c3R1bS5sZWZ0O1xuICAgIGNhbWVyYS5mcnVzdHVtLmxlZnQgPSAwLjA7XG5cbiAgICBmcmFtZVN0YXRlLmN1bGxpbmdWb2x1bWUgPSBjYW1lcmEuZnJ1c3R1bS5jb21wdXRlQ3VsbGluZ1ZvbHVtZShcbiAgICAgIGNhbWVyYS5wb3NpdGlvbldDLFxuICAgICAgY2FtZXJhLmRpcmVjdGlvbldDLFxuICAgICAgY2FtZXJhLnVwV0NcbiAgICApO1xuICAgIGNvbnRleHQudW5pZm9ybVN0YXRlLnVwZGF0ZShmcmFtZVN0YXRlKTtcblxuICAgIGV4ZWN1dGVDb21tYW5kc0luVmlld3BvcnQoZmFsc2UsIHNjZW5lLCBwYXNzU3RhdGUpO1xuICB9IGVsc2UgaWYgKHdpbmRvd0Nvb3JkaW5hdGVzLnggPiB2aWV3cG9ydFggKyB2aWV3cG9ydFdpZHRoICogMC41KSB7XG4gICAgdmlld3BvcnQud2lkdGggPSB3aW5kb3dDb29yZGluYXRlcy54IC0gdmlld3BvcnRYO1xuXG4gICAgdmFyIHJpZ2h0ID0gY2FtZXJhLmZydXN0dW0ucmlnaHQ7XG4gICAgY2FtZXJhLmZydXN0dW0ucmlnaHQgPSBtYXhDb29yZC54IC0geDtcblxuICAgIGZyYW1lU3RhdGUuY3VsbGluZ1ZvbHVtZSA9IGNhbWVyYS5mcnVzdHVtLmNvbXB1dGVDdWxsaW5nVm9sdW1lKFxuICAgICAgY2FtZXJhLnBvc2l0aW9uV0MsXG4gICAgICBjYW1lcmEuZGlyZWN0aW9uV0MsXG4gICAgICBjYW1lcmEudXBXQ1xuICAgICk7XG4gICAgY29udGV4dC51bmlmb3JtU3RhdGUudXBkYXRlKGZyYW1lU3RhdGUpO1xuXG4gICAgZXhlY3V0ZUNvbW1hbmRzSW5WaWV3cG9ydCh0cnVlLCBzY2VuZSwgcGFzc1N0YXRlKTtcblxuICAgIHZpZXdwb3J0LnggPSB3aW5kb3dDb29yZGluYXRlcy54O1xuICAgIHZpZXdwb3J0LndpZHRoID0gdmlld3BvcnRYICsgdmlld3BvcnRXaWR0aCAtIHdpbmRvd0Nvb3JkaW5hdGVzLng7XG5cbiAgICBjYW1lcmEucG9zaXRpb24ueCA9IC1jYW1lcmEucG9zaXRpb24ueDtcblxuICAgIGNhbWVyYS5mcnVzdHVtLmxlZnQgPSAtY2FtZXJhLmZydXN0dW0ucmlnaHQ7XG4gICAgY2FtZXJhLmZydXN0dW0ucmlnaHQgPSByaWdodCAtIGNhbWVyYS5mcnVzdHVtLnJpZ2h0ICogMi4wO1xuXG4gICAgZnJhbWVTdGF0ZS5jdWxsaW5nVm9sdW1lID0gY2FtZXJhLmZydXN0dW0uY29tcHV0ZUN1bGxpbmdWb2x1bWUoXG4gICAgICBjYW1lcmEucG9zaXRpb25XQyxcbiAgICAgIGNhbWVyYS5kaXJlY3Rpb25XQyxcbiAgICAgIGNhbWVyYS51cFdDXG4gICAgKTtcbiAgICBjb250ZXh0LnVuaWZvcm1TdGF0ZS51cGRhdGUoZnJhbWVTdGF0ZSk7XG5cbiAgICBleGVjdXRlQ29tbWFuZHNJblZpZXdwb3J0KGZhbHNlLCBzY2VuZSwgcGFzc1N0YXRlKTtcbiAgfSBlbHNlIHtcbiAgICB2aWV3cG9ydC54ID0gd2luZG93Q29vcmRpbmF0ZXMueDtcbiAgICB2aWV3cG9ydC53aWR0aCA9IHZpZXdwb3J0WCArIHZpZXdwb3J0V2lkdGggLSB3aW5kb3dDb29yZGluYXRlcy54O1xuXG4gICAgdmFyIGxlZnQgPSBjYW1lcmEuZnJ1c3R1bS5sZWZ0O1xuICAgIGNhbWVyYS5mcnVzdHVtLmxlZnQgPSAtbWF4Q29vcmQueCAtIHg7XG5cbiAgICBmcmFtZVN0YXRlLmN1bGxpbmdWb2x1bWUgPSBjYW1lcmEuZnJ1c3R1bS5jb21wdXRlQ3VsbGluZ1ZvbHVtZShcbiAgICAgIGNhbWVyYS5wb3NpdGlvbldDLFxuICAgICAgY2FtZXJhLmRpcmVjdGlvbldDLFxuICAgICAgY2FtZXJhLnVwV0NcbiAgICApO1xuICAgIGNvbnRleHQudW5pZm9ybVN0YXRlLnVwZGF0ZShmcmFtZVN0YXRlKTtcblxuICAgIGV4ZWN1dGVDb21tYW5kc0luVmlld3BvcnQodHJ1ZSwgc2NlbmUsIHBhc3NTdGF0ZSk7XG5cbiAgICB2aWV3cG9ydC54ID0gdmlld3BvcnRYO1xuICAgIHZpZXdwb3J0LndpZHRoID0gd2luZG93Q29vcmRpbmF0ZXMueCAtIHZpZXdwb3J0WDtcblxuICAgIGNhbWVyYS5wb3NpdGlvbi54ID0gLWNhbWVyYS5wb3NpdGlvbi54O1xuXG4gICAgY2FtZXJhLmZydXN0dW0ucmlnaHQgPSAtY2FtZXJhLmZydXN0dW0ubGVmdDtcbiAgICBjYW1lcmEuZnJ1c3R1bS5sZWZ0ID0gbGVmdCAtIGNhbWVyYS5mcnVzdHVtLmxlZnQgKiAyLjA7XG5cbiAgICBmcmFtZVN0YXRlLmN1bGxpbmdWb2x1bWUgPSBjYW1lcmEuZnJ1c3R1bS5jb21wdXRlQ3VsbGluZ1ZvbHVtZShcbiAgICAgIGNhbWVyYS5wb3NpdGlvbldDLFxuICAgICAgY2FtZXJhLmRpcmVjdGlvbldDLFxuICAgICAgY2FtZXJhLnVwV0NcbiAgICApO1xuICAgIGNvbnRleHQudW5pZm9ybVN0YXRlLnVwZGF0ZShmcmFtZVN0YXRlKTtcblxuICAgIGV4ZWN1dGVDb21tYW5kc0luVmlld3BvcnQoZmFsc2UsIHNjZW5lLCBwYXNzU3RhdGUpO1xuICB9XG5cbiAgY2FtZXJhLl9zZXRUcmFuc2Zvcm0odHJhbnNmb3JtKTtcbiAgQ2FydGVzaWFuMy5jbG9uZShwb3NpdGlvbiwgY2FtZXJhLnBvc2l0aW9uKTtcbiAgY2FtZXJhLmZydXN0dW0gPSBmcnVzdHVtLmNsb25lKCk7XG4gIHBhc3NTdGF0ZS52aWV3cG9ydCA9IG9yaWdpbmFsVmlld3BvcnQ7XG59XG5cbmZ1bmN0aW9uIGV4ZWN1dGVDb21tYW5kc0luVmlld3BvcnQoXG4gIGZpcnN0Vmlld3BvcnQsXG4gIHNjZW5lLFxuICBwYXNzU3RhdGUsXG4gIGJhY2tncm91bmRDb2xvclxuKSB7XG4gIHZhciBlbnZpcm9ubWVudFN0YXRlID0gc2NlbmUuX2Vudmlyb25tZW50U3RhdGU7XG4gIHZhciB2aWV3ID0gc2NlbmUuX3ZpZXc7XG4gIHZhciByZW5kZXJUcmFuc2x1Y2VudERlcHRoRm9yUGljayA9XG4gICAgZW52aXJvbm1lbnRTdGF0ZS5yZW5kZXJUcmFuc2x1Y2VudERlcHRoRm9yUGljaztcblxuICBpZiAoIWZpcnN0Vmlld3BvcnQgJiYgIXJlbmRlclRyYW5zbHVjZW50RGVwdGhGb3JQaWNrKSB7XG4gICAgc2NlbmUuZnJhbWVTdGF0ZS5jb21tYW5kTGlzdC5sZW5ndGggPSAwO1xuICB9XG5cbiAgaWYgKCFyZW5kZXJUcmFuc2x1Y2VudERlcHRoRm9yUGljaykge1xuICAgIHVwZGF0ZUFuZFJlbmRlclByaW1pdGl2ZXMoc2NlbmUpO1xuICB9XG5cbiAgdmlldy5jcmVhdGVQb3RlbnRpYWxseVZpc2libGVTZXQoc2NlbmUpO1xuXG4gIGlmIChmaXJzdFZpZXdwb3J0KSB7XG4gICAgaWYgKGRlZmluZWQoYmFja2dyb3VuZENvbG9yKSkge1xuICAgICAgdXBkYXRlQW5kQ2xlYXJGcmFtZWJ1ZmZlcnMoc2NlbmUsIHBhc3NTdGF0ZSwgYmFja2dyb3VuZENvbG9yKTtcbiAgICB9XG4gICAgaWYgKCFyZW5kZXJUcmFuc2x1Y2VudERlcHRoRm9yUGljaykge1xuICAgICAgZXhlY3V0ZUNvbXB1dGVDb21tYW5kcyhzY2VuZSk7XG4gICAgICBleGVjdXRlU2hhZG93TWFwQ2FzdENvbW1hbmRzKHNjZW5lKTtcbiAgICB9XG4gIH1cblxuICBleGVjdXRlQ29tbWFuZHMoc2NlbmUsIHBhc3NTdGF0ZSk7XG59XG5cbnZhciBzY3JhdGNoQ3VsbGluZ1ZvbHVtZSA9IG5ldyBDdWxsaW5nVm9sdW1lKCk7XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuU2NlbmUucHJvdG90eXBlLnVwZGF0ZUVudmlyb25tZW50ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgZnJhbWVTdGF0ZSA9IHRoaXMuX2ZyYW1lU3RhdGU7XG4gIHZhciB2aWV3ID0gdGhpcy5fdmlldztcblxuICAvLyBVcGRhdGUgY2VsZXN0aWFsIGFuZCB0ZXJyZXN0cmlhbCBlbnZpcm9ubWVudCBlZmZlY3RzLlxuICB2YXIgZW52aXJvbm1lbnRTdGF0ZSA9IHRoaXMuX2Vudmlyb25tZW50U3RhdGU7XG4gIHZhciByZW5kZXJQYXNzID0gZnJhbWVTdGF0ZS5wYXNzZXMucmVuZGVyO1xuICB2YXIgb2Zmc2NyZWVuUGFzcyA9IGZyYW1lU3RhdGUucGFzc2VzLm9mZnNjcmVlbjtcbiAgdmFyIHNreUF0bW9zcGhlcmUgPSB0aGlzLnNreUF0bW9zcGhlcmU7XG4gIHZhciBnbG9iZSA9IHRoaXMuZ2xvYmU7XG4gIHZhciBnbG9iZVRyYW5zbHVjZW5jeVN0YXRlID0gdGhpcy5fZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZTtcblxuICBpZiAoXG4gICAgIXJlbmRlclBhc3MgfHxcbiAgICAodGhpcy5fbW9kZSAhPT0gU2NlbmVNb2RlLlNDRU5FMkQgJiZcbiAgICAgIHZpZXcuY2FtZXJhLmZydXN0dW0gaW5zdGFuY2VvZiBPcnRob2dyYXBoaWNGcnVzdHVtKSB8fFxuICAgICFnbG9iZVRyYW5zbHVjZW5jeVN0YXRlLmVudmlyb25tZW50VmlzaWJsZVxuICApIHtcbiAgICBlbnZpcm9ubWVudFN0YXRlLnNreUF0bW9zcGhlcmVDb21tYW5kID0gdW5kZWZpbmVkO1xuICAgIGVudmlyb25tZW50U3RhdGUuc2t5Qm94Q29tbWFuZCA9IHVuZGVmaW5lZDtcbiAgICBlbnZpcm9ubWVudFN0YXRlLnN1bkRyYXdDb21tYW5kID0gdW5kZWZpbmVkO1xuICAgIGVudmlyb25tZW50U3RhdGUuc3VuQ29tcHV0ZUNvbW1hbmQgPSB1bmRlZmluZWQ7XG4gICAgZW52aXJvbm1lbnRTdGF0ZS5tb29uQ29tbWFuZCA9IHVuZGVmaW5lZDtcbiAgfSBlbHNlIHtcbiAgICBpZiAoZGVmaW5lZChza3lBdG1vc3BoZXJlKSkge1xuICAgICAgaWYgKGRlZmluZWQoZ2xvYmUpKSB7XG4gICAgICAgIHNreUF0bW9zcGhlcmUuc2V0RHluYW1pY0F0bW9zcGhlcmVDb2xvcihcbiAgICAgICAgICBnbG9iZS5lbmFibGVMaWdodGluZyAmJiBnbG9iZS5keW5hbWljQXRtb3NwaGVyZUxpZ2h0aW5nLFxuICAgICAgICAgIGdsb2JlLmR5bmFtaWNBdG1vc3BoZXJlTGlnaHRpbmdGcm9tU3VuXG4gICAgICAgICk7XG4gICAgICAgIGVudmlyb25tZW50U3RhdGUuaXNSZWFkeUZvckF0bW9zcGhlcmUgPVxuICAgICAgICAgIGVudmlyb25tZW50U3RhdGUuaXNSZWFkeUZvckF0bW9zcGhlcmUgfHxcbiAgICAgICAgICBnbG9iZS5fc3VyZmFjZS5fdGlsZXNUb1JlbmRlci5sZW5ndGggPiAwO1xuICAgICAgfVxuICAgICAgZW52aXJvbm1lbnRTdGF0ZS5za3lBdG1vc3BoZXJlQ29tbWFuZCA9IHNreUF0bW9zcGhlcmUudXBkYXRlKFxuICAgICAgICBmcmFtZVN0YXRlLFxuICAgICAgICBnbG9iZVxuICAgICAgKTtcbiAgICAgIGlmIChkZWZpbmVkKGVudmlyb25tZW50U3RhdGUuc2t5QXRtb3NwaGVyZUNvbW1hbmQpKSB7XG4gICAgICAgIHRoaXMudXBkYXRlRGVyaXZlZENvbW1hbmRzKGVudmlyb25tZW50U3RhdGUuc2t5QXRtb3NwaGVyZUNvbW1hbmQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBlbnZpcm9ubWVudFN0YXRlLnNreUF0bW9zcGhlcmVDb21tYW5kID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGVudmlyb25tZW50U3RhdGUuc2t5Qm94Q29tbWFuZCA9IGRlZmluZWQodGhpcy5za3lCb3gpXG4gICAgICA/IHRoaXMuc2t5Qm94LnVwZGF0ZShmcmFtZVN0YXRlLCB0aGlzLl9oZHIpXG4gICAgICA6IHVuZGVmaW5lZDtcbiAgICB2YXIgc3VuQ29tbWFuZHMgPSBkZWZpbmVkKHRoaXMuc3VuKVxuICAgICAgPyB0aGlzLnN1bi51cGRhdGUoZnJhbWVTdGF0ZSwgdmlldy5wYXNzU3RhdGUsIHRoaXMuX2hkcilcbiAgICAgIDogdW5kZWZpbmVkO1xuICAgIGVudmlyb25tZW50U3RhdGUuc3VuRHJhd0NvbW1hbmQgPSBkZWZpbmVkKHN1bkNvbW1hbmRzKVxuICAgICAgPyBzdW5Db21tYW5kcy5kcmF3Q29tbWFuZFxuICAgICAgOiB1bmRlZmluZWQ7XG4gICAgZW52aXJvbm1lbnRTdGF0ZS5zdW5Db21wdXRlQ29tbWFuZCA9IGRlZmluZWQoc3VuQ29tbWFuZHMpXG4gICAgICA/IHN1bkNvbW1hbmRzLmNvbXB1dGVDb21tYW5kXG4gICAgICA6IHVuZGVmaW5lZDtcbiAgICBlbnZpcm9ubWVudFN0YXRlLm1vb25Db21tYW5kID0gZGVmaW5lZCh0aGlzLm1vb24pXG4gICAgICA/IHRoaXMubW9vbi51cGRhdGUoZnJhbWVTdGF0ZSlcbiAgICAgIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgdmFyIGNsZWFyR2xvYmVEZXB0aCA9IChlbnZpcm9ubWVudFN0YXRlLmNsZWFyR2xvYmVEZXB0aCA9XG4gICAgZGVmaW5lZChnbG9iZSkgJiZcbiAgICBnbG9iZS5zaG93ICYmXG4gICAgKCFnbG9iZS5kZXB0aFRlc3RBZ2FpbnN0VGVycmFpbiB8fCB0aGlzLm1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTJEKSk7XG4gIHZhciB1c2VEZXB0aFBsYW5lID0gKGVudmlyb25tZW50U3RhdGUudXNlRGVwdGhQbGFuZSA9XG4gICAgY2xlYXJHbG9iZURlcHRoICYmXG4gICAgdGhpcy5tb2RlID09PSBTY2VuZU1vZGUuU0NFTkUzRCAmJlxuICAgIGdsb2JlVHJhbnNsdWNlbmN5U3RhdGUudXNlRGVwdGhQbGFuZSk7XG4gIGlmICh1c2VEZXB0aFBsYW5lKSB7XG4gICAgLy8gVXBkYXRlIHRoZSBkZXB0aCBwbGFuZSB0aGF0IGlzIHJlbmRlcmVkIGluIDNEIHdoZW4gdGhlIHByaW1pdGl2ZXMgYXJlXG4gICAgLy8gbm90IGRlcHRoIHRlc3RlZCBhZ2FpbnN0IHRlcnJhaW4gc28gcHJpbWl0aXZlcyBvbiB0aGUgYmFja2ZhY2VcbiAgICAvLyBvZiB0aGUgZ2xvYmUgYXJlIG5vdCBwaWNrZWQuXG4gICAgdGhpcy5fZGVwdGhQbGFuZS51cGRhdGUoZnJhbWVTdGF0ZSk7XG4gIH1cblxuICBlbnZpcm9ubWVudFN0YXRlLnJlbmRlclRyYW5zbHVjZW50RGVwdGhGb3JQaWNrID0gZmFsc2U7XG4gIGVudmlyb25tZW50U3RhdGUudXNlV2ViVlIgPVxuICAgIHRoaXMuX3VzZVdlYlZSICYmIHRoaXMubW9kZSAhPT0gU2NlbmVNb2RlLlNDRU5FMkQgJiYgIW9mZnNjcmVlblBhc3M7XG5cbiAgdmFyIG9jY2x1ZGVyID1cbiAgICBmcmFtZVN0YXRlLm1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTNEICYmXG4gICAgIWdsb2JlVHJhbnNsdWNlbmN5U3RhdGUuc3VuVmlzaWJsZVRocm91Z2hHbG9iZVxuICAgICAgPyBmcmFtZVN0YXRlLm9jY2x1ZGVyXG4gICAgICA6IHVuZGVmaW5lZDtcbiAgdmFyIGN1bGxpbmdWb2x1bWUgPSBmcmFtZVN0YXRlLmN1bGxpbmdWb2x1bWU7XG5cbiAgLy8gZ2V0IHVzZXIgY3VsbGluZyB2b2x1bWUgbWludXMgdGhlIGZhciBwbGFuZS5cbiAgdmFyIHBsYW5lcyA9IHNjcmF0Y2hDdWxsaW5nVm9sdW1lLnBsYW5lcztcbiAgZm9yICh2YXIgayA9IDA7IGsgPCA1OyArK2spIHtcbiAgICBwbGFuZXNba10gPSBjdWxsaW5nVm9sdW1lLnBsYW5lc1trXTtcbiAgfVxuICBjdWxsaW5nVm9sdW1lID0gc2NyYXRjaEN1bGxpbmdWb2x1bWU7XG5cbiAgLy8gRGV0ZXJtaW5lIHZpc2liaWxpdHkgb2YgY2VsZXN0aWFsIGFuZCB0ZXJyZXN0cmlhbCBlbnZpcm9ubWVudCBlZmZlY3RzLlxuICBlbnZpcm9ubWVudFN0YXRlLmlzU2t5QXRtb3NwaGVyZVZpc2libGUgPVxuICAgIGRlZmluZWQoZW52aXJvbm1lbnRTdGF0ZS5za3lBdG1vc3BoZXJlQ29tbWFuZCkgJiZcbiAgICBlbnZpcm9ubWVudFN0YXRlLmlzUmVhZHlGb3JBdG1vc3BoZXJlO1xuICBlbnZpcm9ubWVudFN0YXRlLmlzU3VuVmlzaWJsZSA9IHRoaXMuaXNWaXNpYmxlKFxuICAgIGVudmlyb25tZW50U3RhdGUuc3VuRHJhd0NvbW1hbmQsXG4gICAgY3VsbGluZ1ZvbHVtZSxcbiAgICBvY2NsdWRlclxuICApO1xuICBlbnZpcm9ubWVudFN0YXRlLmlzTW9vblZpc2libGUgPSB0aGlzLmlzVmlzaWJsZShcbiAgICBlbnZpcm9ubWVudFN0YXRlLm1vb25Db21tYW5kLFxuICAgIGN1bGxpbmdWb2x1bWUsXG4gICAgb2NjbHVkZXJcbiAgKTtcblxuICB2YXIgZW52TWFwcyA9IHRoaXMuc3BlY3VsYXJFbnZpcm9ubWVudE1hcHM7XG4gIHZhciBlbnZNYXBBdGxhcyA9IHRoaXMuX3NwZWN1bGFyRW52aXJvbm1lbnRNYXBBdGxhcztcbiAgaWYgKFxuICAgIGRlZmluZWQoZW52TWFwcykgJiZcbiAgICAoIWRlZmluZWQoZW52TWFwQXRsYXMpIHx8IGVudk1hcEF0bGFzLnVybCAhPT0gZW52TWFwcylcbiAgKSB7XG4gICAgZW52TWFwQXRsYXMgPSBlbnZNYXBBdGxhcyAmJiBlbnZNYXBBdGxhcy5kZXN0cm95KCk7XG4gICAgdGhpcy5fc3BlY3VsYXJFbnZpcm9ubWVudE1hcEF0bGFzID0gbmV3IE9jdGFoZWRyYWxQcm9qZWN0ZWRDdWJlTWFwKGVudk1hcHMpO1xuICB9IGVsc2UgaWYgKCFkZWZpbmVkKGVudk1hcHMpICYmIGRlZmluZWQoZW52TWFwQXRsYXMpKSB7XG4gICAgZW52TWFwQXRsYXMuZGVzdHJveSgpO1xuICAgIHRoaXMuX3NwZWN1bGFyRW52aXJvbm1lbnRNYXBBdGxhcyA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGlmIChkZWZpbmVkKHRoaXMuX3NwZWN1bGFyRW52aXJvbm1lbnRNYXBBdGxhcykpIHtcbiAgICB0aGlzLl9zcGVjdWxhckVudmlyb25tZW50TWFwQXRsYXMudXBkYXRlKGZyYW1lU3RhdGUpO1xuICB9XG59O1xuXG5mdW5jdGlvbiB1cGRhdGVEZWJ1Z0ZydXN0dW1QbGFuZXMoc2NlbmUpIHtcbiAgdmFyIGZyYW1lU3RhdGUgPSBzY2VuZS5fZnJhbWVTdGF0ZTtcbiAgaWYgKHNjZW5lLmRlYnVnU2hvd0ZydXN0dW1QbGFuZXMgIT09IHNjZW5lLl9kZWJ1Z1Nob3dGcnVzdHVtUGxhbmVzKSB7XG4gICAgaWYgKHNjZW5lLmRlYnVnU2hvd0ZydXN0dW1QbGFuZXMpIHtcbiAgICAgIHNjZW5lLl9kZWJ1Z0ZydXN0dW1QbGFuZXMgPSBuZXcgRGVidWdDYW1lcmFQcmltaXRpdmUoe1xuICAgICAgICBjYW1lcmE6IHNjZW5lLmNhbWVyYSxcbiAgICAgICAgdXBkYXRlT25DaGFuZ2U6IGZhbHNlLFxuICAgICAgICBmcnVzdHVtU3BsaXRzOiBmcmFtZVN0YXRlLmZydXN0dW1TcGxpdHMsXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2NlbmUuX2RlYnVnRnJ1c3R1bVBsYW5lcyA9XG4gICAgICAgIHNjZW5lLl9kZWJ1Z0ZydXN0dW1QbGFuZXMgJiYgc2NlbmUuX2RlYnVnRnJ1c3R1bVBsYW5lcy5kZXN0cm95KCk7XG4gICAgfVxuICAgIHNjZW5lLl9kZWJ1Z1Nob3dGcnVzdHVtUGxhbmVzID0gc2NlbmUuZGVidWdTaG93RnJ1c3R1bVBsYW5lcztcbiAgfVxuXG4gIGlmIChkZWZpbmVkKHNjZW5lLl9kZWJ1Z0ZydXN0dW1QbGFuZXMpKSB7XG4gICAgc2NlbmUuX2RlYnVnRnJ1c3R1bVBsYW5lcy51cGRhdGUoZnJhbWVTdGF0ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gdXBkYXRlU2hhZG93TWFwcyhzY2VuZSkge1xuICB2YXIgZnJhbWVTdGF0ZSA9IHNjZW5lLl9mcmFtZVN0YXRlO1xuICB2YXIgc2hhZG93TWFwcyA9IGZyYW1lU3RhdGUuc2hhZG93TWFwcztcbiAgdmFyIGxlbmd0aCA9IHNoYWRvd01hcHMubGVuZ3RoO1xuXG4gIHZhciBzaGFkb3dzRW5hYmxlZCA9XG4gICAgbGVuZ3RoID4gMCAmJiAhZnJhbWVTdGF0ZS5wYXNzZXMucGljayAmJiBzY2VuZS5tb2RlID09PSBTY2VuZU1vZGUuU0NFTkUzRDtcbiAgaWYgKHNoYWRvd3NFbmFibGVkICE9PSBmcmFtZVN0YXRlLnNoYWRvd1N0YXRlLnNoYWRvd3NFbmFibGVkKSB7XG4gICAgLy8gVXBkYXRlIGRlcml2ZWQgY29tbWFuZHMgd2hlbiBzaGFkb3dzRW5hYmxlZCBjaGFuZ2VzXG4gICAgKytmcmFtZVN0YXRlLnNoYWRvd1N0YXRlLmxhc3REaXJ0eVRpbWU7XG4gICAgZnJhbWVTdGF0ZS5zaGFkb3dTdGF0ZS5zaGFkb3dzRW5hYmxlZCA9IHNoYWRvd3NFbmFibGVkO1xuICB9XG5cbiAgZnJhbWVTdGF0ZS5zaGFkb3dTdGF0ZS5saWdodFNoYWRvd3NFbmFibGVkID0gZmFsc2U7XG5cbiAgaWYgKCFzaGFkb3dzRW5hYmxlZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIENoZWNrIGlmIHRoZSBzaGFkb3cgbWFwcyBhcmUgZGlmZmVyZW50IHRoYW4gdGhlIHNoYWRvdyBtYXBzIGxhc3QgZnJhbWUuXG4gIC8vIElmIHNvLCB0aGUgZGVyaXZlZCBjb21tYW5kcyBuZWVkIHRvIGJlIHVwZGF0ZWQuXG4gIGZvciAodmFyIGogPSAwOyBqIDwgbGVuZ3RoOyArK2opIHtcbiAgICBpZiAoc2hhZG93TWFwc1tqXSAhPT0gZnJhbWVTdGF0ZS5zaGFkb3dTdGF0ZS5zaGFkb3dNYXBzW2pdKSB7XG4gICAgICArK2ZyYW1lU3RhdGUuc2hhZG93U3RhdGUubGFzdERpcnR5VGltZTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGZyYW1lU3RhdGUuc2hhZG93U3RhdGUuc2hhZG93TWFwcy5sZW5ndGggPSAwO1xuICBmcmFtZVN0YXRlLnNoYWRvd1N0YXRlLmxpZ2h0U2hhZG93TWFwcy5sZW5ndGggPSAwO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgc2hhZG93TWFwID0gc2hhZG93TWFwc1tpXTtcbiAgICBzaGFkb3dNYXAudXBkYXRlKGZyYW1lU3RhdGUpO1xuXG4gICAgZnJhbWVTdGF0ZS5zaGFkb3dTdGF0ZS5zaGFkb3dNYXBzLnB1c2goc2hhZG93TWFwKTtcblxuICAgIGlmIChzaGFkb3dNYXAuZnJvbUxpZ2h0U291cmNlKSB7XG4gICAgICBmcmFtZVN0YXRlLnNoYWRvd1N0YXRlLmxpZ2h0U2hhZG93TWFwcy5wdXNoKHNoYWRvd01hcCk7XG4gICAgICBmcmFtZVN0YXRlLnNoYWRvd1N0YXRlLmxpZ2h0U2hhZG93c0VuYWJsZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChzaGFkb3dNYXAuZGlydHkpIHtcbiAgICAgICsrZnJhbWVTdGF0ZS5zaGFkb3dTdGF0ZS5sYXN0RGlydHlUaW1lO1xuICAgICAgc2hhZG93TWFwLmRpcnR5ID0gZmFsc2U7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUFuZFJlbmRlclByaW1pdGl2ZXMoc2NlbmUpIHtcbiAgdmFyIGZyYW1lU3RhdGUgPSBzY2VuZS5fZnJhbWVTdGF0ZTtcblxuICBzY2VuZS5fZ3JvdW5kUHJpbWl0aXZlcy51cGRhdGUoZnJhbWVTdGF0ZSk7XG4gIHNjZW5lLl9wcmltaXRpdmVzLnVwZGF0ZShmcmFtZVN0YXRlKTtcblxuICB1cGRhdGVEZWJ1Z0ZydXN0dW1QbGFuZXMoc2NlbmUpO1xuICB1cGRhdGVTaGFkb3dNYXBzKHNjZW5lKTtcblxuICBpZiAoc2NlbmUuX2dsb2JlKSB7XG4gICAgc2NlbmUuX2dsb2JlLnJlbmRlcihmcmFtZVN0YXRlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB1cGRhdGVBbmRDbGVhckZyYW1lYnVmZmVycyhzY2VuZSwgcGFzc1N0YXRlLCBjbGVhckNvbG9yKSB7XG4gIHZhciBjb250ZXh0ID0gc2NlbmUuX2NvbnRleHQ7XG4gIHZhciBmcmFtZVN0YXRlID0gc2NlbmUuX2ZyYW1lU3RhdGU7XG4gIHZhciBlbnZpcm9ubWVudFN0YXRlID0gc2NlbmUuX2Vudmlyb25tZW50U3RhdGU7XG4gIHZhciB2aWV3ID0gc2NlbmUuX3ZpZXc7XG5cbiAgdmFyIHBhc3NlcyA9IHNjZW5lLl9mcmFtZVN0YXRlLnBhc3NlcztcbiAgdmFyIHBpY2tpbmcgPSBwYXNzZXMucGljaztcbiAgdmFyIHVzZVdlYlZSID0gZW52aXJvbm1lbnRTdGF0ZS51c2VXZWJWUjtcblxuICAvLyBQcmVzZXJ2ZSB0aGUgcmVmZXJlbmNlIHRvIHRoZSBvcmlnaW5hbCBmcmFtZWJ1ZmZlci5cbiAgZW52aXJvbm1lbnRTdGF0ZS5vcmlnaW5hbEZyYW1lYnVmZmVyID0gcGFzc1N0YXRlLmZyYW1lYnVmZmVyO1xuXG4gIC8vIE1hbmFnZSBzdW4gYmxvb20gcG9zdC1wcm9jZXNzaW5nIGVmZmVjdC5cbiAgaWYgKGRlZmluZWQoc2NlbmUuc3VuKSAmJiBzY2VuZS5zdW5CbG9vbSAhPT0gc2NlbmUuX3N1bkJsb29tKSB7XG4gICAgaWYgKHNjZW5lLnN1bkJsb29tICYmICF1c2VXZWJWUikge1xuICAgICAgc2NlbmUuX3N1blBvc3RQcm9jZXNzID0gbmV3IFN1blBvc3RQcm9jZXNzKCk7XG4gICAgfSBlbHNlIGlmIChkZWZpbmVkKHNjZW5lLl9zdW5Qb3N0UHJvY2VzcykpIHtcbiAgICAgIHNjZW5lLl9zdW5Qb3N0UHJvY2VzcyA9IHNjZW5lLl9zdW5Qb3N0UHJvY2Vzcy5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgc2NlbmUuX3N1bkJsb29tID0gc2NlbmUuc3VuQmxvb207XG4gIH0gZWxzZSBpZiAoIWRlZmluZWQoc2NlbmUuc3VuKSAmJiBkZWZpbmVkKHNjZW5lLl9zdW5Qb3N0UHJvY2VzcykpIHtcbiAgICBzY2VuZS5fc3VuUG9zdFByb2Nlc3MgPSBzY2VuZS5fc3VuUG9zdFByb2Nlc3MuZGVzdHJveSgpO1xuICAgIHNjZW5lLl9zdW5CbG9vbSA9IGZhbHNlO1xuICB9XG5cbiAgLy8gQ2xlYXIgdGhlIHBhc3Mgc3RhdGUgZnJhbWVidWZmZXIuXG4gIHZhciBjbGVhciA9IHNjZW5lLl9jbGVhckNvbG9yQ29tbWFuZDtcbiAgQ29sb3IuY2xvbmUoY2xlYXJDb2xvciwgY2xlYXIuY29sb3IpO1xuICBjbGVhci5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG5cbiAgLy8gVXBkYXRlIGdsb2JlIGRlcHRoIHJlbmRlcmluZyBiYXNlZCBvbiB0aGUgY3VycmVudCBjb250ZXh0IGFuZCBjbGVhciB0aGUgZ2xvYmUgZGVwdGggZnJhbWVidWZmZXIuXG4gIC8vIEdsb2JlIGRlcHRoIGlzIGNvcGllZCBmb3IgdGhlIHBpY2sgcGFzcyB0byBzdXBwb3J0IHBpY2tpbmcgYmF0Y2hlZCBnZW9tZXRyaWVzIGluIEdyb3VuZFByaW1pdGl2ZXMuXG4gIHZhciB1c2VHbG9iZURlcHRoRnJhbWVidWZmZXIgPSAoZW52aXJvbm1lbnRTdGF0ZS51c2VHbG9iZURlcHRoRnJhbWVidWZmZXIgPSBkZWZpbmVkKFxuICAgIHZpZXcuZ2xvYmVEZXB0aFxuICApKTtcbiAgaWYgKHVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlcikge1xuICAgIHZpZXcuZ2xvYmVEZXB0aC51cGRhdGUoXG4gICAgICBjb250ZXh0LFxuICAgICAgcGFzc1N0YXRlLFxuICAgICAgdmlldy52aWV3cG9ydCxcbiAgICAgIHNjZW5lLl9oZHIsXG4gICAgICBlbnZpcm9ubWVudFN0YXRlLmNsZWFyR2xvYmVEZXB0aFxuICAgICk7XG4gICAgdmlldy5nbG9iZURlcHRoLmNsZWFyKGNvbnRleHQsIHBhc3NTdGF0ZSwgY2xlYXJDb2xvcik7XG4gIH1cblxuICAvLyBJZiBzdXBwb3J0ZWQsIGNvbmZpZ3VyZSBPSVQgdG8gdXNlIHRoZSBnbG9iZSBkZXB0aCBmcmFtZWJ1ZmZlciBhbmQgY2xlYXIgdGhlIE9JVCBmcmFtZWJ1ZmZlci5cbiAgdmFyIG9pdCA9IHZpZXcub2l0O1xuICB2YXIgdXNlT0lUID0gKGVudmlyb25tZW50U3RhdGUudXNlT0lUID1cbiAgICAhcGlja2luZyAmJiBkZWZpbmVkKG9pdCkgJiYgb2l0LmlzU3VwcG9ydGVkKCkpO1xuICBpZiAodXNlT0lUKSB7XG4gICAgb2l0LnVwZGF0ZShjb250ZXh0LCBwYXNzU3RhdGUsIHZpZXcuZ2xvYmVEZXB0aC5mcmFtZWJ1ZmZlciwgc2NlbmUuX2hkcik7XG4gICAgb2l0LmNsZWFyKGNvbnRleHQsIHBhc3NTdGF0ZSwgY2xlYXJDb2xvcik7XG4gICAgZW52aXJvbm1lbnRTdGF0ZS51c2VPSVQgPSBvaXQuaXNTdXBwb3J0ZWQoKTtcbiAgfVxuXG4gIHZhciBwb3N0UHJvY2VzcyA9IHNjZW5lLnBvc3RQcm9jZXNzU3RhZ2VzO1xuICB2YXIgdXNlUG9zdFByb2Nlc3MgPSAoZW52aXJvbm1lbnRTdGF0ZS51c2VQb3N0UHJvY2VzcyA9XG4gICAgIXBpY2tpbmcgJiZcbiAgICAoc2NlbmUuX2hkciB8fFxuICAgICAgcG9zdFByb2Nlc3MubGVuZ3RoID4gMCB8fFxuICAgICAgcG9zdFByb2Nlc3MuYW1iaWVudE9jY2x1c2lvbi5lbmFibGVkIHx8XG4gICAgICBwb3N0UHJvY2Vzcy5meGFhLmVuYWJsZWQgfHxcbiAgICAgIHBvc3RQcm9jZXNzLmJsb29tLmVuYWJsZWQpKTtcbiAgZW52aXJvbm1lbnRTdGF0ZS51c2VQb3N0UHJvY2Vzc1NlbGVjdGVkID0gZmFsc2U7XG4gIGlmICh1c2VQb3N0UHJvY2Vzcykge1xuICAgIHZpZXcuc2NlbmVGcmFtZWJ1ZmZlci51cGRhdGUoY29udGV4dCwgdmlldy52aWV3cG9ydCwgc2NlbmUuX2hkcik7XG4gICAgdmlldy5zY2VuZUZyYW1lYnVmZmVyLmNsZWFyKGNvbnRleHQsIHBhc3NTdGF0ZSwgY2xlYXJDb2xvcik7XG5cbiAgICBwb3N0UHJvY2Vzcy51cGRhdGUoY29udGV4dCwgZnJhbWVTdGF0ZS51c2VMb2dEZXB0aCwgc2NlbmUuX2hkcik7XG4gICAgcG9zdFByb2Nlc3MuY2xlYXIoY29udGV4dCk7XG5cbiAgICB1c2VQb3N0UHJvY2VzcyA9IGVudmlyb25tZW50U3RhdGUudXNlUG9zdFByb2Nlc3MgPSBwb3N0UHJvY2Vzcy5yZWFkeTtcbiAgICBlbnZpcm9ubWVudFN0YXRlLnVzZVBvc3RQcm9jZXNzU2VsZWN0ZWQgPVxuICAgICAgdXNlUG9zdFByb2Nlc3MgJiYgcG9zdFByb2Nlc3MuaGFzU2VsZWN0ZWQ7XG4gIH1cblxuICBpZiAoZW52aXJvbm1lbnRTdGF0ZS5pc1N1blZpc2libGUgJiYgc2NlbmUuc3VuQmxvb20gJiYgIXVzZVdlYlZSKSB7XG4gICAgcGFzc1N0YXRlLmZyYW1lYnVmZmVyID0gc2NlbmUuX3N1blBvc3RQcm9jZXNzLnVwZGF0ZShwYXNzU3RhdGUpO1xuICAgIHNjZW5lLl9zdW5Qb3N0UHJvY2Vzcy5jbGVhcihjb250ZXh0LCBwYXNzU3RhdGUsIGNsZWFyQ29sb3IpO1xuICB9IGVsc2UgaWYgKHVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlcikge1xuICAgIHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlciA9IHZpZXcuZ2xvYmVEZXB0aC5mcmFtZWJ1ZmZlcjtcbiAgfSBlbHNlIGlmICh1c2VQb3N0UHJvY2Vzcykge1xuICAgIHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlciA9IHZpZXcuc2NlbmVGcmFtZWJ1ZmZlci5nZXRGcmFtZWJ1ZmZlcigpO1xuICB9XG5cbiAgaWYgKGRlZmluZWQocGFzc1N0YXRlLmZyYW1lYnVmZmVyKSkge1xuICAgIGNsZWFyLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgfVxuXG4gIHZhciB1c2VJbnZlcnRDbGFzc2lmaWNhdGlvbiA9IChlbnZpcm9ubWVudFN0YXRlLnVzZUludmVydENsYXNzaWZpY2F0aW9uID1cbiAgICAhcGlja2luZyAmJiBkZWZpbmVkKHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlcikgJiYgc2NlbmUuaW52ZXJ0Q2xhc3NpZmljYXRpb24pO1xuICBpZiAodXNlSW52ZXJ0Q2xhc3NpZmljYXRpb24pIHtcbiAgICB2YXIgZGVwdGhGcmFtZWJ1ZmZlcjtcbiAgICBpZiAoc2NlbmUuZnJhbWVTdGF0ZS5pbnZlcnRDbGFzc2lmaWNhdGlvbkNvbG9yLmFscGhhID09PSAxLjApIHtcbiAgICAgIGlmIChlbnZpcm9ubWVudFN0YXRlLnVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlcikge1xuICAgICAgICBkZXB0aEZyYW1lYnVmZmVyID0gdmlldy5nbG9iZURlcHRoLmZyYW1lYnVmZmVyO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkZWZpbmVkKGRlcHRoRnJhbWVidWZmZXIpIHx8IGNvbnRleHQuZGVwdGhUZXh0dXJlKSB7XG4gICAgICBzY2VuZS5faW52ZXJ0Q2xhc3NpZmljYXRpb24ucHJldmlvdXNGcmFtZWJ1ZmZlciA9IGRlcHRoRnJhbWVidWZmZXI7XG4gICAgICBzY2VuZS5faW52ZXJ0Q2xhc3NpZmljYXRpb24udXBkYXRlKGNvbnRleHQpO1xuICAgICAgc2NlbmUuX2ludmVydENsYXNzaWZpY2F0aW9uLmNsZWFyKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG5cbiAgICAgIGlmIChzY2VuZS5mcmFtZVN0YXRlLmludmVydENsYXNzaWZpY2F0aW9uQ29sb3IuYWxwaGEgPCAxLjAgJiYgdXNlT0lUKSB7XG4gICAgICAgIHZhciBjb21tYW5kID0gc2NlbmUuX2ludmVydENsYXNzaWZpY2F0aW9uLnVuY2xhc3NpZmllZENvbW1hbmQ7XG4gICAgICAgIHZhciBkZXJpdmVkQ29tbWFuZHMgPSBjb21tYW5kLmRlcml2ZWRDb21tYW5kcztcbiAgICAgICAgZGVyaXZlZENvbW1hbmRzLm9pdCA9IG9pdC5jcmVhdGVEZXJpdmVkQ29tbWFuZHMoXG4gICAgICAgICAgY29tbWFuZCxcbiAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgIGRlcml2ZWRDb21tYW5kcy5vaXRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZW52aXJvbm1lbnRTdGF0ZS51c2VJbnZlcnRDbGFzc2lmaWNhdGlvbiA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChzY2VuZS5fZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZS50cmFuc2x1Y2VudCkge1xuICAgIHZpZXcuZ2xvYmVUcmFuc2x1Y2VuY3lGcmFtZWJ1ZmZlci51cGRhdGVBbmRDbGVhcihcbiAgICAgIHNjZW5lLl9oZHIsXG4gICAgICB2aWV3LnZpZXdwb3J0LFxuICAgICAgY29udGV4dCxcbiAgICAgIHBhc3NTdGF0ZVxuICAgICk7XG4gIH1cbn1cblxuLyoqXG4gKiBAcHJpdmF0ZVxuICovXG5TY2VuZS5wcm90b3R5cGUucmVzb2x2ZUZyYW1lYnVmZmVycyA9IGZ1bmN0aW9uIChwYXNzU3RhdGUpIHtcbiAgdmFyIGNvbnRleHQgPSB0aGlzLl9jb250ZXh0O1xuICB2YXIgZnJhbWVTdGF0ZSA9IHRoaXMuX2ZyYW1lU3RhdGU7XG4gIHZhciBlbnZpcm9ubWVudFN0YXRlID0gdGhpcy5fZW52aXJvbm1lbnRTdGF0ZTtcbiAgdmFyIHZpZXcgPSB0aGlzLl92aWV3O1xuICB2YXIgZ2xvYmVEZXB0aCA9IHZpZXcuZ2xvYmVEZXB0aDtcblxuICB2YXIgdXNlT0lUID0gZW52aXJvbm1lbnRTdGF0ZS51c2VPSVQ7XG4gIHZhciB1c2VHbG9iZURlcHRoRnJhbWVidWZmZXIgPSBlbnZpcm9ubWVudFN0YXRlLnVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlcjtcbiAgdmFyIHVzZVBvc3RQcm9jZXNzID0gZW52aXJvbm1lbnRTdGF0ZS51c2VQb3N0UHJvY2VzcztcblxuICB2YXIgZGVmYXVsdEZyYW1lYnVmZmVyID0gZW52aXJvbm1lbnRTdGF0ZS5vcmlnaW5hbEZyYW1lYnVmZmVyO1xuICB2YXIgZ2xvYmVGcmFtZWJ1ZmZlciA9IHVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlclxuICAgID8gZ2xvYmVEZXB0aC5mcmFtZWJ1ZmZlclxuICAgIDogdW5kZWZpbmVkO1xuICB2YXIgc2NlbmVGcmFtZWJ1ZmZlciA9IHZpZXcuc2NlbmVGcmFtZWJ1ZmZlci5nZXRGcmFtZWJ1ZmZlcigpO1xuICB2YXIgaWRGcmFtZWJ1ZmZlciA9IHZpZXcuc2NlbmVGcmFtZWJ1ZmZlci5nZXRJZEZyYW1lYnVmZmVyKCk7XG5cbiAgaWYgKGVudmlyb25tZW50U3RhdGUuc2VwYXJhdGVQcmltaXRpdmVGcmFtZWJ1ZmZlcikge1xuICAgIC8vIE1lcmdlIHByaW1pdGl2ZSBmcmFtZWJ1ZmZlciBpbnRvIGdsb2JlIGZyYW1lYnVmZmVyXG4gICAgZ2xvYmVEZXB0aC5leGVjdXRlTWVyZ2VDb2xvcihjb250ZXh0LCBwYXNzU3RhdGUpO1xuICB9XG5cbiAgaWYgKHVzZU9JVCkge1xuICAgIHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlciA9IHVzZVBvc3RQcm9jZXNzXG4gICAgICA/IHNjZW5lRnJhbWVidWZmZXJcbiAgICAgIDogZGVmYXVsdEZyYW1lYnVmZmVyO1xuICAgIHZpZXcub2l0LmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgfVxuXG4gIHZhciB0cmFuc2x1Y2VudFRpbGVDbGFzc2lmaWNhdGlvbiA9IHZpZXcudHJhbnNsdWNlbnRUaWxlQ2xhc3NpZmljYXRpb247XG4gIGlmIChcbiAgICB0cmFuc2x1Y2VudFRpbGVDbGFzc2lmaWNhdGlvbi5oYXNUcmFuc2x1Y2VudERlcHRoICYmXG4gICAgdHJhbnNsdWNlbnRUaWxlQ2xhc3NpZmljYXRpb24uaXNTdXBwb3J0ZWQoKVxuICApIHtcbiAgICB0cmFuc2x1Y2VudFRpbGVDbGFzc2lmaWNhdGlvbi5leGVjdXRlKHRoaXMsIHBhc3NTdGF0ZSk7XG4gIH1cblxuICBpZiAodXNlUG9zdFByb2Nlc3MpIHtcbiAgICB2YXIgaW5wdXRGcmFtZWJ1ZmZlciA9IHNjZW5lRnJhbWVidWZmZXI7XG4gICAgaWYgKHVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlciAmJiAhdXNlT0lUKSB7XG4gICAgICBpbnB1dEZyYW1lYnVmZmVyID0gZ2xvYmVGcmFtZWJ1ZmZlcjtcbiAgICB9XG5cbiAgICB2YXIgcG9zdFByb2Nlc3MgPSB0aGlzLnBvc3RQcm9jZXNzU3RhZ2VzO1xuICAgIHZhciBjb2xvclRleHR1cmUgPSBpbnB1dEZyYW1lYnVmZmVyLmdldENvbG9yVGV4dHVyZSgwKTtcbiAgICB2YXIgaWRUZXh0dXJlID0gaWRGcmFtZWJ1ZmZlci5nZXRDb2xvclRleHR1cmUoMCk7XG4gICAgdmFyIGRlcHRoVGV4dHVyZSA9IGRlZmF1bHRWYWx1ZShnbG9iZUZyYW1lYnVmZmVyLCBzY2VuZUZyYW1lYnVmZmVyKVxuICAgICAgLmRlcHRoU3RlbmNpbFRleHR1cmU7XG4gICAgcG9zdFByb2Nlc3MuZXhlY3V0ZShjb250ZXh0LCBjb2xvclRleHR1cmUsIGRlcHRoVGV4dHVyZSwgaWRUZXh0dXJlKTtcbiAgICBwb3N0UHJvY2Vzcy5jb3B5KGNvbnRleHQsIGRlZmF1bHRGcmFtZWJ1ZmZlcik7XG4gIH1cblxuICBpZiAoIXVzZU9JVCAmJiAhdXNlUG9zdFByb2Nlc3MgJiYgdXNlR2xvYmVEZXB0aEZyYW1lYnVmZmVyKSB7XG4gICAgcGFzc1N0YXRlLmZyYW1lYnVmZmVyID0gZGVmYXVsdEZyYW1lYnVmZmVyO1xuICAgIGdsb2JlRGVwdGguZXhlY3V0ZUNvcHlDb2xvcihjb250ZXh0LCBwYXNzU3RhdGUpO1xuICB9XG5cbiAgdmFyIHVzZUxvZ0RlcHRoID0gZnJhbWVTdGF0ZS51c2VMb2dEZXB0aDtcblxuICBpZiAodGhpcy5kZWJ1Z1Nob3dHbG9iZURlcHRoICYmIHVzZUdsb2JlRGVwdGhGcmFtZWJ1ZmZlcikge1xuICAgIHZhciBnZCA9IGdldERlYnVnR2xvYmVEZXB0aCh0aGlzLCB0aGlzLmRlYnVnU2hvd0RlcHRoRnJ1c3R1bSAtIDEpO1xuICAgIGdkLmV4ZWN1dGVEZWJ1Z0dsb2JlRGVwdGgoY29udGV4dCwgcGFzc1N0YXRlLCB1c2VMb2dEZXB0aCk7XG4gIH1cblxuICBpZiAodGhpcy5kZWJ1Z1Nob3dQaWNrRGVwdGggJiYgdXNlR2xvYmVEZXB0aEZyYW1lYnVmZmVyKSB7XG4gICAgdmFyIHBkID0gdGhpcy5fcGlja2luZy5nZXRQaWNrRGVwdGgodGhpcywgdGhpcy5kZWJ1Z1Nob3dEZXB0aEZydXN0dW0gLSAxKTtcbiAgICBwZC5leGVjdXRlRGVidWdQaWNrRGVwdGgoY29udGV4dCwgcGFzc1N0YXRlLCB1c2VMb2dEZXB0aCk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGNhbGxBZnRlclJlbmRlckZ1bmN0aW9ucyhzY2VuZSkge1xuICAvLyBGdW5jdGlvbnMgYXJlIHF1ZXVlZCB1cCBkdXJpbmcgcHJpbWl0aXZlIHVwZGF0ZSBhbmQgZXhlY3V0ZWQgaGVyZSBpbiBjYXNlXG4gIC8vIHRoZSBmdW5jdGlvbiBtb2RpZmllcyBzY2VuZSBzdGF0ZSB0aGF0IHNob3VsZCByZW1haW4gY29uc3RhbnQgb3ZlciB0aGUgZnJhbWUuXG4gIHZhciBmdW5jdGlvbnMgPSBzY2VuZS5fZnJhbWVTdGF0ZS5hZnRlclJlbmRlcjtcbiAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGZ1bmN0aW9ucy5sZW5ndGg7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgIGZ1bmN0aW9uc1tpXSgpO1xuICAgIHNjZW5lLnJlcXVlc3RSZW5kZXIoKTtcbiAgfVxuXG4gIGZ1bmN0aW9ucy5sZW5ndGggPSAwO1xufVxuXG5mdW5jdGlvbiBnZXRHbG9iZUhlaWdodChzY2VuZSkge1xuICB2YXIgZ2xvYmUgPSBzY2VuZS5fZ2xvYmU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG4gIHZhciBjYXJ0b2dyYXBoaWMgPSBjYW1lcmEucG9zaXRpb25DYXJ0b2dyYXBoaWM7XG4gIGlmIChkZWZpbmVkKGdsb2JlKSAmJiBnbG9iZS5zaG93ICYmIGRlZmluZWQoY2FydG9ncmFwaGljKSkge1xuICAgIHJldHVybiBnbG9iZS5nZXRIZWlnaHQoY2FydG9ncmFwaGljKTtcbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5mdW5jdGlvbiBpc0NhbWVyYVVuZGVyZ3JvdW5kKHNjZW5lKSB7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG4gIHZhciBtb2RlID0gc2NlbmUuX21vZGU7XG4gIHZhciBnbG9iZSA9IHNjZW5lLmdsb2JlO1xuICB2YXIgY2FtZXJhQ29udHJvbGxlciA9IHNjZW5lLl9zY3JlZW5TcGFjZUNhbWVyYUNvbnRyb2xsZXI7XG4gIHZhciBjYXJ0b2dyYXBoaWMgPSBjYW1lcmEucG9zaXRpb25DYXJ0b2dyYXBoaWM7XG5cbiAgaWYgKCFkZWZpbmVkKGNhcnRvZ3JhcGhpYykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoIWNhbWVyYUNvbnRyb2xsZXIub25NYXAoKSAmJiBjYXJ0b2dyYXBoaWMuaGVpZ2h0IDwgMC4wKSB7XG4gICAgLy8gVGhlIGNhbWVyYSBjYW4gZ28gb2ZmIHRoZSBtYXAgd2hpbGUgaW4gQ29sdW1idXMgVmlldy5cbiAgICAvLyBNYWtlIGEgYmVzdCBndWVzcyBhcyB0byB3aGV0aGVyIGl0J3MgdW5kZXJncm91bmQgYnkgY2hlY2tpbmcgaWYgaXRzIGhlaWdodCBpcyBsZXNzIHRoYW4gemVyby5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlmIChcbiAgICAhZGVmaW5lZChnbG9iZSkgfHxcbiAgICAhZ2xvYmUuc2hvdyB8fFxuICAgIG1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTJEIHx8XG4gICAgbW9kZSA9PT0gU2NlbmVNb2RlLk1PUlBISU5HXG4gICkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBnbG9iZUhlaWdodCA9IHNjZW5lLl9nbG9iZUhlaWdodDtcbiAgcmV0dXJuIGRlZmluZWQoZ2xvYmVIZWlnaHQpICYmIGNhcnRvZ3JhcGhpYy5oZWlnaHQgPCBnbG9iZUhlaWdodDtcbn1cblxuLyoqXG4gKiBAcHJpdmF0ZVxuICovXG5TY2VuZS5wcm90b3R5cGUuaW5pdGlhbGl6ZUZyYW1lID0gZnVuY3Rpb24gKCkge1xuICAvLyBEZXN0cm95IHJlbGVhc2VkIHNoYWRlcnMgYW5kIHRleHR1cmVzIG9uY2UgZXZlcnkgMTIwIGZyYW1lcyB0byBhdm9pZCB0aHJhc2hpbmcgdGhlIGNhY2hlXG4gIGlmICh0aGlzLl9zaGFkZXJGcmFtZUNvdW50KysgPT09IDEyMCkge1xuICAgIHRoaXMuX3NoYWRlckZyYW1lQ291bnQgPSAwO1xuICAgIHRoaXMuX2NvbnRleHQuc2hhZGVyQ2FjaGUuZGVzdHJveVJlbGVhc2VkU2hhZGVyUHJvZ3JhbXMoKTtcbiAgICB0aGlzLl9jb250ZXh0LnRleHR1cmVDYWNoZS5kZXN0cm95UmVsZWFzZWRUZXh0dXJlcygpO1xuICB9XG5cbiAgdGhpcy5fdHdlZW5zLnVwZGF0ZSgpO1xuXG4gIHRoaXMuX2dsb2JlSGVpZ2h0ID0gZ2V0R2xvYmVIZWlnaHQodGhpcyk7XG4gIHRoaXMuX2NhbWVyYVVuZGVyZ3JvdW5kID0gaXNDYW1lcmFVbmRlcmdyb3VuZCh0aGlzKTtcbiAgdGhpcy5fZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZS51cGRhdGUodGhpcyk7XG5cbiAgdGhpcy5fc2NyZWVuU3BhY2VDYW1lcmFDb250cm9sbGVyLnVwZGF0ZSgpO1xuICBpZiAoZGVmaW5lZCh0aGlzLl9kZXZpY2VPcmllbnRhdGlvbkNhbWVyYUNvbnRyb2xsZXIpKSB7XG4gICAgdGhpcy5fZGV2aWNlT3JpZW50YXRpb25DYW1lcmFDb250cm9sbGVyLnVwZGF0ZSgpO1xuICB9XG5cbiAgdGhpcy5jYW1lcmEudXBkYXRlKHRoaXMuX21vZGUpO1xuICB0aGlzLmNhbWVyYS5fdXBkYXRlQ2FtZXJhQ2hhbmdlZCgpO1xufTtcblxuZnVuY3Rpb24gdXBkYXRlRGVidWdTaG93RnJhbWVzUGVyU2Vjb25kKHNjZW5lLCByZW5kZXJlZFRoaXNGcmFtZSkge1xuICBpZiAoc2NlbmUuZGVidWdTaG93RnJhbWVzUGVyU2Vjb25kKSB7XG4gICAgaWYgKCFkZWZpbmVkKHNjZW5lLl9wZXJmb3JtYW5jZURpc3BsYXkpKSB7XG4gICAgICB2YXIgcGVyZm9ybWFuY2VDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgcGVyZm9ybWFuY2VDb250YWluZXIuY2xhc3NOYW1lID1cbiAgICAgICAgXCJjZXNpdW0tcGVyZm9ybWFuY2VEaXNwbGF5LWRlZmF1bHRDb250YWluZXJcIjtcbiAgICAgIHZhciBjb250YWluZXIgPSBzY2VuZS5fY2FudmFzLnBhcmVudE5vZGU7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocGVyZm9ybWFuY2VDb250YWluZXIpO1xuICAgICAgdmFyIHBlcmZvcm1hbmNlRGlzcGxheSA9IG5ldyBQZXJmb3JtYW5jZURpc3BsYXkoe1xuICAgICAgICBjb250YWluZXI6IHBlcmZvcm1hbmNlQ29udGFpbmVyLFxuICAgICAgfSk7XG4gICAgICBzY2VuZS5fcGVyZm9ybWFuY2VEaXNwbGF5ID0gcGVyZm9ybWFuY2VEaXNwbGF5O1xuICAgICAgc2NlbmUuX3BlcmZvcm1hbmNlQ29udGFpbmVyID0gcGVyZm9ybWFuY2VDb250YWluZXI7XG4gICAgfVxuXG4gICAgc2NlbmUuX3BlcmZvcm1hbmNlRGlzcGxheS50aHJvdHRsZWQgPSBzY2VuZS5yZXF1ZXN0UmVuZGVyTW9kZTtcbiAgICBzY2VuZS5fcGVyZm9ybWFuY2VEaXNwbGF5LnVwZGF0ZShyZW5kZXJlZFRoaXNGcmFtZSk7XG4gIH0gZWxzZSBpZiAoZGVmaW5lZChzY2VuZS5fcGVyZm9ybWFuY2VEaXNwbGF5KSkge1xuICAgIHNjZW5lLl9wZXJmb3JtYW5jZURpc3BsYXkgPVxuICAgICAgc2NlbmUuX3BlcmZvcm1hbmNlRGlzcGxheSAmJiBzY2VuZS5fcGVyZm9ybWFuY2VEaXNwbGF5LmRlc3Ryb3koKTtcbiAgICBzY2VuZS5fcGVyZm9ybWFuY2VDb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChcbiAgICAgIHNjZW5lLl9wZXJmb3JtYW5jZUNvbnRhaW5lclxuICAgICk7XG4gIH1cbn1cblxuZnVuY3Rpb24gcHJlUGFzc2VzVXBkYXRlKHNjZW5lKSB7XG4gIHNjZW5lLl9qb2JTY2hlZHVsZXIucmVzZXRCdWRnZXRzKCk7XG5cbiAgdmFyIGZyYW1lU3RhdGUgPSBzY2VuZS5fZnJhbWVTdGF0ZTtcbiAgdmFyIHByaW1pdGl2ZXMgPSBzY2VuZS5wcmltaXRpdmVzO1xuICBwcmltaXRpdmVzLnByZVBhc3Nlc1VwZGF0ZShmcmFtZVN0YXRlKTtcblxuICBpZiAoZGVmaW5lZChzY2VuZS5nbG9iZSkpIHtcbiAgICBzY2VuZS5nbG9iZS51cGRhdGUoZnJhbWVTdGF0ZSk7XG4gIH1cblxuICBzY2VuZS5fcGlja2luZy51cGRhdGUoKTtcbiAgZnJhbWVTdGF0ZS5jcmVkaXREaXNwbGF5LnVwZGF0ZSgpO1xufVxuXG5mdW5jdGlvbiBwb3N0UGFzc2VzVXBkYXRlKHNjZW5lKSB7XG4gIHZhciBmcmFtZVN0YXRlID0gc2NlbmUuX2ZyYW1lU3RhdGU7XG4gIHZhciBwcmltaXRpdmVzID0gc2NlbmUucHJpbWl0aXZlcztcbiAgcHJpbWl0aXZlcy5wb3N0UGFzc2VzVXBkYXRlKGZyYW1lU3RhdGUpO1xuXG4gIFJlcXVlc3RTY2hlZHVsZXIudXBkYXRlKCk7XG59XG5cbnZhciBzY3JhdGNoQmFja2dyb3VuZENvbG9yID0gbmV3IENvbG9yKCk7XG5cbmZ1bmN0aW9uIHJlbmRlcihzY2VuZSkge1xuICB2YXIgZnJhbWVTdGF0ZSA9IHNjZW5lLl9mcmFtZVN0YXRlO1xuXG4gIHZhciBjb250ZXh0ID0gc2NlbmUuY29udGV4dDtcbiAgdmFyIHVzID0gY29udGV4dC51bmlmb3JtU3RhdGU7XG5cbiAgdmFyIHZpZXcgPSBzY2VuZS5fZGVmYXVsdFZpZXc7XG4gIHNjZW5lLl92aWV3ID0gdmlldztcblxuICBzY2VuZS51cGRhdGVGcmFtZVN0YXRlKCk7XG4gIGZyYW1lU3RhdGUucGFzc2VzLnJlbmRlciA9IHRydWU7XG4gIGZyYW1lU3RhdGUucGFzc2VzLnBvc3RQcm9jZXNzID0gc2NlbmUucG9zdFByb2Nlc3NTdGFnZXMuaGFzU2VsZWN0ZWQ7XG4gIGZyYW1lU3RhdGUudGlsZXNldFBhc3NTdGF0ZSA9IHJlbmRlclRpbGVzZXRQYXNzU3RhdGU7XG5cbiAgdmFyIGJhY2tncm91bmRDb2xvciA9IGRlZmF1bHRWYWx1ZShzY2VuZS5iYWNrZ3JvdW5kQ29sb3IsIENvbG9yLkJMQUNLKTtcbiAgaWYgKHNjZW5lLl9oZHIpIHtcbiAgICBiYWNrZ3JvdW5kQ29sb3IgPSBDb2xvci5jbG9uZShiYWNrZ3JvdW5kQ29sb3IsIHNjcmF0Y2hCYWNrZ3JvdW5kQ29sb3IpO1xuICAgIGJhY2tncm91bmRDb2xvci5yZWQgPSBNYXRoLnBvdyhiYWNrZ3JvdW5kQ29sb3IucmVkLCBzY2VuZS5nYW1tYSk7XG4gICAgYmFja2dyb3VuZENvbG9yLmdyZWVuID0gTWF0aC5wb3coYmFja2dyb3VuZENvbG9yLmdyZWVuLCBzY2VuZS5nYW1tYSk7XG4gICAgYmFja2dyb3VuZENvbG9yLmJsdWUgPSBNYXRoLnBvdyhiYWNrZ3JvdW5kQ29sb3IuYmx1ZSwgc2NlbmUuZ2FtbWEpO1xuICB9XG4gIGZyYW1lU3RhdGUuYmFja2dyb3VuZENvbG9yID0gYmFja2dyb3VuZENvbG9yO1xuXG4gIHNjZW5lLmZvZy51cGRhdGUoZnJhbWVTdGF0ZSk7XG5cbiAgdXMudXBkYXRlKGZyYW1lU3RhdGUpO1xuXG4gIHZhciBzaGFkb3dNYXAgPSBzY2VuZS5zaGFkb3dNYXA7XG4gIGlmIChkZWZpbmVkKHNoYWRvd01hcCkgJiYgc2hhZG93TWFwLmVuYWJsZWQpIHtcbiAgICBpZiAoIWRlZmluZWQoc2NlbmUubGlnaHQpIHx8IHNjZW5lLmxpZ2h0IGluc3RhbmNlb2YgU3VuTGlnaHQpIHtcbiAgICAgIC8vIE5lZ2F0ZSB0aGUgc3VuIGRpcmVjdGlvbiBzbyB0aGF0IGl0IGlzIGZyb20gdGhlIFN1biwgbm90IHRvIHRoZSBTdW5cbiAgICAgIENhcnRlc2lhbjMubmVnYXRlKHVzLnN1bkRpcmVjdGlvbldDLCBzY2VuZS5fc2hhZG93TWFwQ2FtZXJhLmRpcmVjdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIENhcnRlc2lhbjMuY2xvbmUoc2NlbmUubGlnaHQuZGlyZWN0aW9uLCBzY2VuZS5fc2hhZG93TWFwQ2FtZXJhLmRpcmVjdGlvbik7XG4gICAgfVxuICAgIGZyYW1lU3RhdGUuc2hhZG93TWFwcy5wdXNoKHNoYWRvd01hcCk7XG4gIH1cblxuICBzY2VuZS5fY29tcHV0ZUNvbW1hbmRMaXN0Lmxlbmd0aCA9IDA7XG4gIHNjZW5lLl9vdmVybGF5Q29tbWFuZExpc3QubGVuZ3RoID0gMDtcblxuICB2YXIgdmlld3BvcnQgPSB2aWV3LnZpZXdwb3J0O1xuICB2aWV3cG9ydC54ID0gMDtcbiAgdmlld3BvcnQueSA9IDA7XG4gIHZpZXdwb3J0LndpZHRoID0gY29udGV4dC5kcmF3aW5nQnVmZmVyV2lkdGg7XG4gIHZpZXdwb3J0LmhlaWdodCA9IGNvbnRleHQuZHJhd2luZ0J1ZmZlckhlaWdodDtcblxuICB2YXIgcGFzc1N0YXRlID0gdmlldy5wYXNzU3RhdGU7XG4gIHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlciA9IHVuZGVmaW5lZDtcbiAgcGFzc1N0YXRlLmJsZW5kaW5nRW5hYmxlZCA9IHVuZGVmaW5lZDtcbiAgcGFzc1N0YXRlLnNjaXNzb3JUZXN0ID0gdW5kZWZpbmVkO1xuICBwYXNzU3RhdGUudmlld3BvcnQgPSBCb3VuZGluZ1JlY3RhbmdsZS5jbG9uZSh2aWV3cG9ydCwgcGFzc1N0YXRlLnZpZXdwb3J0KTtcblxuICBpZiAoZGVmaW5lZChzY2VuZS5nbG9iZSkpIHtcbiAgICBzY2VuZS5nbG9iZS5iZWdpbkZyYW1lKGZyYW1lU3RhdGUpO1xuICB9XG5cbiAgc2NlbmUudXBkYXRlRW52aXJvbm1lbnQoKTtcbiAgc2NlbmUudXBkYXRlQW5kRXhlY3V0ZUNvbW1hbmRzKHBhc3NTdGF0ZSwgYmFja2dyb3VuZENvbG9yKTtcbiAgc2NlbmUucmVzb2x2ZUZyYW1lYnVmZmVycyhwYXNzU3RhdGUpO1xuXG4gIHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlciA9IHVuZGVmaW5lZDtcbiAgZXhlY3V0ZU92ZXJsYXlDb21tYW5kcyhzY2VuZSwgcGFzc1N0YXRlKTtcblxuICBpZiAoZGVmaW5lZChzY2VuZS5nbG9iZSkpIHtcbiAgICBzY2VuZS5nbG9iZS5lbmRGcmFtZShmcmFtZVN0YXRlKTtcblxuICAgIGlmICghc2NlbmUuZ2xvYmUudGlsZXNMb2FkZWQpIHtcbiAgICAgIHNjZW5lLl9yZW5kZXJSZXF1ZXN0ZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGNvbnRleHQuZW5kRnJhbWUoKTtcbn1cblxuZnVuY3Rpb24gdHJ5QW5kQ2F0Y2hFcnJvcihzY2VuZSwgZnVuY3Rpb25Ub0V4ZWN1dGUpIHtcbiAgdHJ5IHtcbiAgICBmdW5jdGlvblRvRXhlY3V0ZShzY2VuZSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgc2NlbmUuX3JlbmRlckVycm9yLnJhaXNlRXZlbnQoc2NlbmUsIGVycm9yKTtcblxuICAgIGlmIChzY2VuZS5yZXRocm93UmVuZGVyRXJyb3JzKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gdXBkYXRlTW9zdERldGFpbGVkUmF5UGlja3Moc2NlbmUpIHtcbiAgcmV0dXJuIHNjZW5lLl9waWNraW5nLnVwZGF0ZU1vc3REZXRhaWxlZFJheVBpY2tzKHNjZW5lKTtcbn1cblxuLyoqXG4gKiBVcGRhdGUgYW5kIHJlbmRlciB0aGUgc2NlbmUuIEl0IGlzIHVzdWFsbHkgbm90IG5lY2Vzc2FyeSB0byBjYWxsIHRoaXMgZnVuY3Rpb25cbiAqIGRpcmVjdGx5IGJlY2F1c2Uge0BsaW5rIENlc2l1bVdpZGdldH0gb3Ige0BsaW5rIFZpZXdlcn0gZG8gaXQgYXV0b21hdGljYWxseS5cbiAqIEBwYXJhbSB7SnVsaWFuRGF0ZX0gW3RpbWVdIFRoZSBzaW11bGF0aW9uIHRpbWUgYXQgd2hpY2ggdG8gcmVuZGVyLlxuICovXG5TY2VuZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKHRpbWUpIHtcbiAgLyoqXG4gICAqXG4gICAqIFByZSBwYXNzZXMgdXBkYXRlLiBFeGVjdXRlIGFueSBwYXNzIGludmFyaWFudCBjb2RlIHRoYXQgc2hvdWxkIHJ1biBiZWZvcmUgdGhlIHBhc3NlcyBoZXJlLlxuICAgKlxuICAgKi9cbiAgdGhpcy5fcHJlVXBkYXRlLnJhaXNlRXZlbnQodGhpcywgdGltZSk7XG5cbiAgdmFyIGZyYW1lU3RhdGUgPSB0aGlzLl9mcmFtZVN0YXRlO1xuICBmcmFtZVN0YXRlLm5ld0ZyYW1lID0gZmFsc2U7XG5cbiAgaWYgKCFkZWZpbmVkKHRpbWUpKSB7XG4gICAgdGltZSA9IEp1bGlhbkRhdGUubm93KCk7XG4gIH1cblxuICAvLyBEZXRlcm1pbmUgaWYgc2hvdWxkUmVuZGVyXG4gIHZhciBjYW1lcmFDaGFuZ2VkID0gdGhpcy5fdmlldy5jaGVja0ZvckNhbWVyYVVwZGF0ZXModGhpcyk7XG4gIHZhciBzaG91bGRSZW5kZXIgPVxuICAgICF0aGlzLnJlcXVlc3RSZW5kZXJNb2RlIHx8XG4gICAgdGhpcy5fcmVuZGVyUmVxdWVzdGVkIHx8XG4gICAgY2FtZXJhQ2hhbmdlZCB8fFxuICAgIHRoaXMuX2xvZ0RlcHRoQnVmZmVyRGlydHkgfHxcbiAgICB0aGlzLl9oZHJEaXJ0eSB8fFxuICAgIHRoaXMubW9kZSA9PT0gU2NlbmVNb2RlLk1PUlBISU5HO1xuICBpZiAoXG4gICAgIXNob3VsZFJlbmRlciAmJlxuICAgIGRlZmluZWQodGhpcy5tYXhpbXVtUmVuZGVyVGltZUNoYW5nZSkgJiZcbiAgICBkZWZpbmVkKHRoaXMuX2xhc3RSZW5kZXJUaW1lKVxuICApIHtcbiAgICB2YXIgZGlmZmVyZW5jZSA9IE1hdGguYWJzKFxuICAgICAgSnVsaWFuRGF0ZS5zZWNvbmRzRGlmZmVyZW5jZSh0aGlzLl9sYXN0UmVuZGVyVGltZSwgdGltZSlcbiAgICApO1xuICAgIHNob3VsZFJlbmRlciA9IHNob3VsZFJlbmRlciB8fCBkaWZmZXJlbmNlID4gdGhpcy5tYXhpbXVtUmVuZGVyVGltZUNoYW5nZTtcbiAgfVxuXG4gIGlmIChzaG91bGRSZW5kZXIpIHtcbiAgICB0aGlzLl9sYXN0UmVuZGVyVGltZSA9IEp1bGlhbkRhdGUuY2xvbmUodGltZSwgdGhpcy5fbGFzdFJlbmRlclRpbWUpO1xuICAgIHRoaXMuX3JlbmRlclJlcXVlc3RlZCA9IGZhbHNlO1xuICAgIHRoaXMuX2xvZ0RlcHRoQnVmZmVyRGlydHkgPSBmYWxzZTtcbiAgICB0aGlzLl9oZHJEaXJ0eSA9IGZhbHNlO1xuXG4gICAgdmFyIGZyYW1lTnVtYmVyID0gQ2VzaXVtTWF0aC5pbmNyZW1lbnRXcmFwKFxuICAgICAgZnJhbWVTdGF0ZS5mcmFtZU51bWJlcixcbiAgICAgIDE1MDAwMDAwLjAsXG4gICAgICAxLjBcbiAgICApO1xuICAgIHVwZGF0ZUZyYW1lTnVtYmVyKHRoaXMsIGZyYW1lTnVtYmVyLCB0aW1lKTtcbiAgICBmcmFtZVN0YXRlLm5ld0ZyYW1lID0gdHJ1ZTtcbiAgfVxuXG4gIHRyeUFuZENhdGNoRXJyb3IodGhpcywgcHJlUGFzc2VzVXBkYXRlKTtcblxuICAvKipcbiAgICpcbiAgICogUGFzc2VzIHVwZGF0ZS4gQWRkIGFueSBwYXNzZXMgaGVyZVxuICAgKlxuICAgKi9cbiAgaWYgKHRoaXMucHJpbWl0aXZlcy5zaG93KSB7XG4gICAgdHJ5QW5kQ2F0Y2hFcnJvcih0aGlzLCB1cGRhdGVNb3N0RGV0YWlsZWRSYXlQaWNrcyk7XG4gICAgdHJ5QW5kQ2F0Y2hFcnJvcih0aGlzLCB1cGRhdGVQcmVsb2FkUGFzcyk7XG4gICAgdHJ5QW5kQ2F0Y2hFcnJvcih0aGlzLCB1cGRhdGVQcmVsb2FkRmxpZ2h0UGFzcyk7XG4gICAgaWYgKCFzaG91bGRSZW5kZXIpIHtcbiAgICAgIHRyeUFuZENhdGNoRXJyb3IodGhpcywgdXBkYXRlUmVxdWVzdFJlbmRlck1vZGVEZWZlckNoZWNrUGFzcyk7XG4gICAgfVxuICB9XG5cbiAgdGhpcy5fcG9zdFVwZGF0ZS5yYWlzZUV2ZW50KHRoaXMsIHRpbWUpO1xuXG4gIGlmIChzaG91bGRSZW5kZXIpIHtcbiAgICB0aGlzLl9wcmVSZW5kZXIucmFpc2VFdmVudCh0aGlzLCB0aW1lKTtcbiAgICBmcmFtZVN0YXRlLmNyZWRpdERpc3BsYXkuYmVnaW5GcmFtZSgpO1xuICAgIHRyeUFuZENhdGNoRXJyb3IodGhpcywgcmVuZGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBQb3N0IHBhc3NlcyB1cGRhdGUuIEV4ZWN1dGUgYW55IHBhc3MgaW52YXJpYW50IGNvZGUgdGhhdCBzaG91bGQgcnVuIGFmdGVyIHRoZSBwYXNzZXMgaGVyZS5cbiAgICpcbiAgICovXG4gIHVwZGF0ZURlYnVnU2hvd0ZyYW1lc1BlclNlY29uZCh0aGlzLCBzaG91bGRSZW5kZXIpO1xuICB0cnlBbmRDYXRjaEVycm9yKHRoaXMsIHBvc3RQYXNzZXNVcGRhdGUpO1xuXG4gIC8vIE9mdGVuIHVzZWQgdG8gdHJpZ2dlciBldmVudHMgKHNvIGRvbid0IHdhbnQgaW4gdHJ5Y2F0Y2gpIHRoYXQgdGhlIHVzZXIgbWlnaHQgYmUgc3Vic2NyaWJlZCB0by4gVGhpbmdzIGxpa2UgdGhlIHRpbGUgbG9hZCBldmVudHMsIHJlYWR5IHByb21pc2VzLCBldGMuXG4gIC8vIFdlIGRvbid0IHdhbnQgdGhvc2UgZXZlbnRzIHRvIHJlc29sdmUgZHVyaW5nIHRoZSByZW5kZXIgbG9vcCBiZWNhdXNlIHRoZSBldmVudHMgbWlnaHQgYWRkIG5ldyBwcmltaXRpdmVzXG4gIGNhbGxBZnRlclJlbmRlckZ1bmN0aW9ucyh0aGlzKTtcblxuICBpZiAoc2hvdWxkUmVuZGVyKSB7XG4gICAgdGhpcy5fcG9zdFJlbmRlci5yYWlzZUV2ZW50KHRoaXMsIHRpbWUpO1xuICAgIGZyYW1lU3RhdGUuY3JlZGl0RGlzcGxheS5lbmRGcmFtZSgpO1xuICB9XG59O1xuXG4vKipcbiAqIFVwZGF0ZSBhbmQgcmVuZGVyIHRoZSBzY2VuZS4gQWx3YXlzIGZvcmNlcyBhIG5ldyByZW5kZXIgZnJhbWUgcmVnYXJkbGVzcyBvZiB3aGV0aGVyIGEgcmVuZGVyIHdhc1xuICogcHJldmlvdXNseSByZXF1ZXN0ZWQuXG4gKiBAcGFyYW0ge0p1bGlhbkRhdGV9IFt0aW1lXSBUaGUgc2ltdWxhdGlvbiB0aW1lIGF0IHdoaWNoIHRvIHJlbmRlci5cbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5TY2VuZS5wcm90b3R5cGUuZm9yY2VSZW5kZXIgPSBmdW5jdGlvbiAodGltZSkge1xuICB0aGlzLl9yZW5kZXJSZXF1ZXN0ZWQgPSB0cnVlO1xuICB0aGlzLnJlbmRlcih0aW1lKTtcbn07XG5cbi8qKlxuICogUmVxdWVzdHMgYSBuZXcgcmVuZGVyZWQgZnJhbWUgd2hlbiB7QGxpbmsgU2NlbmUjcmVxdWVzdFJlbmRlck1vZGV9IGlzIHNldCB0byA8Y29kZT50cnVlPC9jb2RlPi5cbiAqIFRoZSByZW5kZXIgcmF0ZSB3aWxsIG5vdCBleGNlZWQgdGhlIHtAbGluayBDZXNpdW1XaWRnZXQjdGFyZ2V0RnJhbWVSYXRlfS5cbiAqXG4gKiBAc2VlIFNjZW5lI3JlcXVlc3RSZW5kZXJNb2RlXG4gKi9cblNjZW5lLnByb3RvdHlwZS5yZXF1ZXN0UmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLl9yZW5kZXJSZXF1ZXN0ZWQgPSB0cnVlO1xufTtcblxuLyoqXG4gKiBAcHJpdmF0ZVxuICovXG5TY2VuZS5wcm90b3R5cGUuY2xhbXBMaW5lV2lkdGggPSBmdW5jdGlvbiAod2lkdGgpIHtcbiAgcmV0dXJuIE1hdGgubWF4KFxuICAgIENvbnRleHRMaW1pdHMubWluaW11bUFsaWFzZWRMaW5lV2lkdGgsXG4gICAgTWF0aC5taW4od2lkdGgsIENvbnRleHRMaW1pdHMubWF4aW11bUFsaWFzZWRMaW5lV2lkdGgpXG4gICk7XG59O1xuXG4vKipcbiAqIFJldHVybnMgYW4gb2JqZWN0IHdpdGggYSBgcHJpbWl0aXZlYCBwcm9wZXJ0eSB0aGF0IGNvbnRhaW5zIHRoZSBmaXJzdCAodG9wKSBwcmltaXRpdmUgaW4gdGhlIHNjZW5lXG4gKiBhdCBhIHBhcnRpY3VsYXIgd2luZG93IGNvb3JkaW5hdGUgb3IgdW5kZWZpbmVkIGlmIG5vdGhpbmcgaXMgYXQgdGhlIGxvY2F0aW9uLiBPdGhlciBwcm9wZXJ0aWVzIG1heVxuICogcG90ZW50aWFsbHkgYmUgc2V0IGRlcGVuZGluZyBvbiB0aGUgdHlwZSBvZiBwcmltaXRpdmUgYW5kIG1heSBiZSB1c2VkIHRvIGZ1cnRoZXIgaWRlbnRpZnkgdGhlIHBpY2tlZCBvYmplY3QuXG4gKiA8cD5cbiAqIFdoZW4gYSBmZWF0dXJlIG9mIGEgM0QgVGlsZXMgdGlsZXNldCBpcyBwaWNrZWQsIDxjb2RlPnBpY2s8L2NvZGU+IHJldHVybnMgYSB7QGxpbmsgQ2VzaXVtM0RUaWxlRmVhdHVyZX0gb2JqZWN0LlxuICogPC9wPlxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBPbiBtb3VzZSBvdmVyLCBjb2xvciB0aGUgZmVhdHVyZSB5ZWxsb3cuXG4gKiBoYW5kbGVyLnNldElucHV0QWN0aW9uKGZ1bmN0aW9uKG1vdmVtZW50KSB7XG4gKiAgICAgdmFyIGZlYXR1cmUgPSBzY2VuZS5waWNrKG1vdmVtZW50LmVuZFBvc2l0aW9uKTtcbiAqICAgICBpZiAoZmVhdHVyZSBpbnN0YW5jZW9mIENlc2l1bS5DZXNpdW0zRFRpbGVGZWF0dXJlKSB7XG4gKiAgICAgICAgIGZlYXR1cmUuY29sb3IgPSBDZXNpdW0uQ29sb3IuWUVMTE9XO1xuICogICAgIH1cbiAqIH0sIENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5NT1VTRV9NT1ZFKTtcbiAqXG4gKiBAcGFyYW0ge0NhcnRlc2lhbjJ9IHdpbmRvd1Bvc2l0aW9uIFdpbmRvdyBjb29yZGluYXRlcyB0byBwZXJmb3JtIHBpY2tpbmcgb24uXG4gKiBAcGFyYW0ge051bWJlcn0gW3dpZHRoPTNdIFdpZHRoIG9mIHRoZSBwaWNrIHJlY3RhbmdsZS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBbaGVpZ2h0PTNdIEhlaWdodCBvZiB0aGUgcGljayByZWN0YW5nbGUuXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBPYmplY3QgY29udGFpbmluZyB0aGUgcGlja2VkIHByaW1pdGl2ZS5cbiAqL1xuU2NlbmUucHJvdG90eXBlLnBpY2sgPSBmdW5jdGlvbiAod2luZG93UG9zaXRpb24sIHdpZHRoLCBoZWlnaHQpIHtcbiAgcmV0dXJuIHRoaXMuX3BpY2tpbmcucGljayh0aGlzLCB3aW5kb3dQb3NpdGlvbiwgd2lkdGgsIGhlaWdodCk7XG59O1xuXG4vKipcbiAqIFJldHVybnMgdGhlIGNhcnRlc2lhbiBwb3NpdGlvbiByZWNvbnN0cnVjdGVkIGZyb20gdGhlIGRlcHRoIGJ1ZmZlciBhbmQgd2luZG93IHBvc2l0aW9uLlxuICogVGhlIHJldHVybmVkIHBvc2l0aW9uIGlzIGluIHdvcmxkIGNvb3JkaW5hdGVzLiBVc2VkIGludGVybmFsbHkgYnkgY2FtZXJhIGZ1bmN0aW9ucyB0b1xuICogcHJldmVudCBjb252ZXJzaW9uIHRvIHByb2plY3RlZCAyRCBjb29yZGluYXRlcyBhbmQgdGhlbiBiYWNrLlxuICogPHA+XG4gKiBTZXQge0BsaW5rIFNjZW5lI3BpY2tUcmFuc2x1Y2VudERlcHRofSB0byA8Y29kZT50cnVlPC9jb2RlPiB0byBpbmNsdWRlIHRoZSBkZXB0aCBvZlxuICogdHJhbnNsdWNlbnQgcHJpbWl0aXZlczsgb3RoZXJ3aXNlLCB0aGlzIGVzc2VudGlhbGx5IHBpY2tzIHRocm91Z2ggdHJhbnNsdWNlbnQgcHJpbWl0aXZlcy5cbiAqIDwvcD5cbiAqXG4gKiBAcHJpdmF0ZVxuICpcbiAqIEBwYXJhbSB7Q2FydGVzaWFuMn0gd2luZG93UG9zaXRpb24gV2luZG93IGNvb3JkaW5hdGVzIHRvIHBlcmZvcm0gcGlja2luZyBvbi5cbiAqIEBwYXJhbSB7Q2FydGVzaWFuM30gW3Jlc3VsdF0gVGhlIG9iamVjdCBvbiB3aGljaCB0byByZXN0b3JlIHRoZSByZXN1bHQuXG4gKiBAcmV0dXJucyB7Q2FydGVzaWFuM30gVGhlIGNhcnRlc2lhbiBwb3NpdGlvbiBpbiB3b3JsZCBjb29yZGluYXRlcy5cbiAqXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gUGlja2luZyBmcm9tIHRoZSBkZXB0aCBidWZmZXIgaXMgbm90IHN1cHBvcnRlZC4gQ2hlY2sgcGlja1Bvc2l0aW9uU3VwcG9ydGVkLlxuICovXG5TY2VuZS5wcm90b3R5cGUucGlja1Bvc2l0aW9uV29ybGRDb29yZGluYXRlcyA9IGZ1bmN0aW9uIChcbiAgd2luZG93UG9zaXRpb24sXG4gIHJlc3VsdFxuKSB7XG4gIHJldHVybiB0aGlzLl9waWNraW5nLnBpY2tQb3NpdGlvbldvcmxkQ29vcmRpbmF0ZXMoXG4gICAgdGhpcyxcbiAgICB3aW5kb3dQb3NpdGlvbixcbiAgICByZXN1bHRcbiAgKTtcbn07XG5cbi8qKlxuICogUmV0dXJucyB0aGUgY2FydGVzaWFuIHBvc2l0aW9uIHJlY29uc3RydWN0ZWQgZnJvbSB0aGUgZGVwdGggYnVmZmVyIGFuZCB3aW5kb3cgcG9zaXRpb24uXG4gKiA8cD5cbiAqIFRoZSBwb3NpdGlvbiByZWNvbnN0cnVjdGVkIGZyb20gdGhlIGRlcHRoIGJ1ZmZlciBpbiAyRCBtYXkgYmUgc2xpZ2h0bHkgZGlmZmVyZW50IGZyb20gdGhvc2VcbiAqIHJlY29uc3RydWN0ZWQgaW4gM0QgYW5kIENvbHVtYnVzIHZpZXcuIFRoaXMgaXMgY2F1c2VkIGJ5IHRoZSBkaWZmZXJlbmNlIGluIHRoZSBkaXN0cmlidXRpb25cbiAqIG9mIGRlcHRoIHZhbHVlcyBvZiBwZXJzcGVjdGl2ZSBhbmQgb3J0aG9ncmFwaGljIHByb2plY3Rpb24uXG4gKiA8L3A+XG4gKiA8cD5cbiAqIFNldCB7QGxpbmsgU2NlbmUjcGlja1RyYW5zbHVjZW50RGVwdGh9IHRvIDxjb2RlPnRydWU8L2NvZGU+IHRvIGluY2x1ZGUgdGhlIGRlcHRoIG9mXG4gKiB0cmFuc2x1Y2VudCBwcmltaXRpdmVzOyBvdGhlcndpc2UsIHRoaXMgZXNzZW50aWFsbHkgcGlja3MgdGhyb3VnaCB0cmFuc2x1Y2VudCBwcmltaXRpdmVzLlxuICogPC9wPlxuICpcbiAqIEBwYXJhbSB7Q2FydGVzaWFuMn0gd2luZG93UG9zaXRpb24gV2luZG93IGNvb3JkaW5hdGVzIHRvIHBlcmZvcm0gcGlja2luZyBvbi5cbiAqIEBwYXJhbSB7Q2FydGVzaWFuM30gW3Jlc3VsdF0gVGhlIG9iamVjdCBvbiB3aGljaCB0byByZXN0b3JlIHRoZSByZXN1bHQuXG4gKiBAcmV0dXJucyB7Q2FydGVzaWFuM30gVGhlIGNhcnRlc2lhbiBwb3NpdGlvbi5cbiAqXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gUGlja2luZyBmcm9tIHRoZSBkZXB0aCBidWZmZXIgaXMgbm90IHN1cHBvcnRlZC4gQ2hlY2sgcGlja1Bvc2l0aW9uU3VwcG9ydGVkLlxuICovXG5TY2VuZS5wcm90b3R5cGUucGlja1Bvc2l0aW9uID0gZnVuY3Rpb24gKHdpbmRvd1Bvc2l0aW9uLCByZXN1bHQpIHtcbiAgcmV0dXJuIHRoaXMuX3BpY2tpbmcucGlja1Bvc2l0aW9uKHRoaXMsIHdpbmRvd1Bvc2l0aW9uLCByZXN1bHQpO1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgbGlzdCBvZiBvYmplY3RzLCBlYWNoIGNvbnRhaW5pbmcgYSBgcHJpbWl0aXZlYCBwcm9wZXJ0eSwgZm9yIGFsbCBwcmltaXRpdmVzIGF0XG4gKiBhIHBhcnRpY3VsYXIgd2luZG93IGNvb3JkaW5hdGUgcG9zaXRpb24uIE90aGVyIHByb3BlcnRpZXMgbWF5IGFsc28gYmUgc2V0IGRlcGVuZGluZyBvbiB0aGVcbiAqIHR5cGUgb2YgcHJpbWl0aXZlIGFuZCBtYXkgYmUgdXNlZCB0byBmdXJ0aGVyIGlkZW50aWZ5IHRoZSBwaWNrZWQgb2JqZWN0LiBUaGUgcHJpbWl0aXZlcyBpblxuICogdGhlIGxpc3QgYXJlIG9yZGVyZWQgYnkgdGhlaXIgdmlzdWFsIG9yZGVyIGluIHRoZSBzY2VuZSAoZnJvbnQgdG8gYmFjaykuXG4gKlxuICogQHBhcmFtIHtDYXJ0ZXNpYW4yfSB3aW5kb3dQb3NpdGlvbiBXaW5kb3cgY29vcmRpbmF0ZXMgdG8gcGVyZm9ybSBwaWNraW5nIG9uLlxuICogQHBhcmFtIHtOdW1iZXJ9IFtsaW1pdF0gSWYgc3VwcGxpZWQsIHN0b3AgZHJpbGxpbmcgYWZ0ZXIgY29sbGVjdGluZyB0aGlzIG1hbnkgcGlja3MuXG4gKiBAcGFyYW0ge051bWJlcn0gW3dpZHRoPTNdIFdpZHRoIG9mIHRoZSBwaWNrIHJlY3RhbmdsZS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBbaGVpZ2h0PTNdIEhlaWdodCBvZiB0aGUgcGljayByZWN0YW5nbGUuXG4gKiBAcmV0dXJucyB7QXJyYXkuPCo+fSBBcnJheSBvZiBvYmplY3RzLCBlYWNoIGNvbnRhaW5pbmcgMSBwaWNrZWQgcHJpbWl0aXZlcy5cbiAqXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gd2luZG93UG9zaXRpb24gaXMgdW5kZWZpbmVkLlxuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgcGlja2VkT2JqZWN0cyA9IHNjZW5lLmRyaWxsUGljayhuZXcgQ2VzaXVtLkNhcnRlc2lhbjIoMTAwLjAsIDIwMC4wKSk7XG4gKlxuICogQHNlZSBTY2VuZSNwaWNrXG4gKi9cblNjZW5lLnByb3RvdHlwZS5kcmlsbFBpY2sgPSBmdW5jdGlvbiAod2luZG93UG9zaXRpb24sIGxpbWl0LCB3aWR0aCwgaGVpZ2h0KSB7XG4gIHJldHVybiB0aGlzLl9waWNraW5nLmRyaWxsUGljayh0aGlzLCB3aW5kb3dQb3NpdGlvbiwgbGltaXQsIHdpZHRoLCBoZWlnaHQpO1xufTtcblxuZnVuY3Rpb24gdXBkYXRlUHJlbG9hZFBhc3Moc2NlbmUpIHtcbiAgdmFyIGZyYW1lU3RhdGUgPSBzY2VuZS5fZnJhbWVTdGF0ZTtcbiAgcHJlbG9hZFRpbGVzZXRQYXNzU3RhdGUuY2FtZXJhID0gZnJhbWVTdGF0ZS5jYW1lcmE7XG4gIHByZWxvYWRUaWxlc2V0UGFzc1N0YXRlLmN1bGxpbmdWb2x1bWUgPSBmcmFtZVN0YXRlLmN1bGxpbmdWb2x1bWU7XG5cbiAgdmFyIHByaW1pdGl2ZXMgPSBzY2VuZS5wcmltaXRpdmVzO1xuICBwcmltaXRpdmVzLnVwZGF0ZUZvclBhc3MoZnJhbWVTdGF0ZSwgcHJlbG9hZFRpbGVzZXRQYXNzU3RhdGUpO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVQcmVsb2FkRmxpZ2h0UGFzcyhzY2VuZSkge1xuICB2YXIgZnJhbWVTdGF0ZSA9IHNjZW5lLl9mcmFtZVN0YXRlO1xuICB2YXIgY2FtZXJhID0gZnJhbWVTdGF0ZS5jYW1lcmE7XG4gIGlmICghY2FtZXJhLmNhblByZWxvYWRGbGlnaHQoKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHByZWxvYWRGbGlnaHRUaWxlc2V0UGFzc1N0YXRlLmNhbWVyYSA9IHNjZW5lLnByZWxvYWRGbGlnaHRDYW1lcmE7XG4gIHByZWxvYWRGbGlnaHRUaWxlc2V0UGFzc1N0YXRlLmN1bGxpbmdWb2x1bWUgPVxuICAgIHNjZW5lLnByZWxvYWRGbGlnaHRDdWxsaW5nVm9sdW1lO1xuXG4gIHZhciBwcmltaXRpdmVzID0gc2NlbmUucHJpbWl0aXZlcztcbiAgcHJpbWl0aXZlcy51cGRhdGVGb3JQYXNzKGZyYW1lU3RhdGUsIHByZWxvYWRGbGlnaHRUaWxlc2V0UGFzc1N0YXRlKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlUmVxdWVzdFJlbmRlck1vZGVEZWZlckNoZWNrUGFzcyhzY2VuZSkge1xuICAvLyBDaGVjayBpZiBhbnkgaWdub3JlZCByZXF1ZXN0cyBhcmUgcmVhZHkgdG8gZ28gKHRvIHdha2UgcmVuZGVyaW5nIHVwIGFnYWluKVxuICBzY2VuZS5wcmltaXRpdmVzLnVwZGF0ZUZvclBhc3MoXG4gICAgc2NlbmUuX2ZyYW1lU3RhdGUsXG4gICAgcmVxdWVzdFJlbmRlck1vZGVEZWZlckNoZWNrUGFzc1N0YXRlXG4gICk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgZmlyc3Qgb2JqZWN0IGludGVyc2VjdGVkIGJ5IHRoZSByYXkgYW5kIHRoZSBwb3NpdGlvbiBvZiBpbnRlcnNlY3Rpb24sXG4gKiBvciA8Y29kZT51bmRlZmluZWQ8L2NvZGU+IGlmIHRoZXJlIHdlcmUgbm8gaW50ZXJzZWN0aW9ucy4gVGhlIGludGVyc2VjdGVkIG9iamVjdCBoYXMgYSA8Y29kZT5wcmltaXRpdmU8L2NvZGU+XG4gKiBwcm9wZXJ0eSB0aGF0IGNvbnRhaW5zIHRoZSBpbnRlcnNlY3RlZCBwcmltaXRpdmUuIE90aGVyIHByb3BlcnRpZXMgbWF5IGJlIHNldCBkZXBlbmRpbmcgb24gdGhlIHR5cGUgb2YgcHJpbWl0aXZlXG4gKiBhbmQgbWF5IGJlIHVzZWQgdG8gZnVydGhlciBpZGVudGlmeSB0aGUgcGlja2VkIG9iamVjdC4gVGhlIHJheSBtdXN0IGJlIGdpdmVuIGluIHdvcmxkIGNvb3JkaW5hdGVzLlxuICogPHA+XG4gKiBUaGlzIGZ1bmN0aW9uIG9ubHkgcGlja3MgZ2xvYmUgdGlsZXMgYW5kIDNEIFRpbGVzIHRoYXQgYXJlIHJlbmRlcmVkIGluIHRoZSBjdXJyZW50IHZpZXcuIFBpY2tzIGFsbCBvdGhlclxuICogcHJpbWl0aXZlcyByZWdhcmRsZXNzIG9mIHRoZWlyIHZpc2liaWxpdHkuXG4gKiA8L3A+XG4gKlxuICogQHByaXZhdGVcbiAqXG4gKiBAcGFyYW0ge1JheX0gcmF5IFRoZSByYXkuXG4gKiBAcGFyYW0ge09iamVjdFtdfSBbb2JqZWN0c1RvRXhjbHVkZV0gQSBsaXN0IG9mIHByaW1pdGl2ZXMsIGVudGl0aWVzLCBvciAzRCBUaWxlcyBmZWF0dXJlcyB0byBleGNsdWRlIGZyb20gdGhlIHJheSBpbnRlcnNlY3Rpb24uXG4gKiBAcGFyYW0ge051bWJlcn0gW3dpZHRoPTAuMV0gV2lkdGggb2YgdGhlIGludGVyc2VjdGlvbiB2b2x1bWUgaW4gbWV0ZXJzLlxuICogQHJldHVybnMge09iamVjdH0gQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIG9iamVjdCBhbmQgcG9zaXRpb24gb2YgdGhlIGZpcnN0IGludGVyc2VjdGlvbi5cbiAqXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gUmF5IGludGVyc2VjdGlvbnMgYXJlIG9ubHkgc3VwcG9ydGVkIGluIDNEIG1vZGUuXG4gKi9cblNjZW5lLnByb3RvdHlwZS5waWNrRnJvbVJheSA9IGZ1bmN0aW9uIChyYXksIG9iamVjdHNUb0V4Y2x1ZGUsIHdpZHRoKSB7XG4gIHJldHVybiB0aGlzLl9waWNraW5nLnBpY2tGcm9tUmF5KHRoaXMsIHJheSwgb2JqZWN0c1RvRXhjbHVkZSwgd2lkdGgpO1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgbGlzdCBvZiBvYmplY3RzLCBlYWNoIGNvbnRhaW5pbmcgdGhlIG9iamVjdCBpbnRlcnNlY3RlZCBieSB0aGUgcmF5IGFuZCB0aGUgcG9zaXRpb24gb2YgaW50ZXJzZWN0aW9uLlxuICogVGhlIGludGVyc2VjdGVkIG9iamVjdCBoYXMgYSA8Y29kZT5wcmltaXRpdmU8L2NvZGU+IHByb3BlcnR5IHRoYXQgY29udGFpbnMgdGhlIGludGVyc2VjdGVkIHByaW1pdGl2ZS4gT3RoZXJcbiAqIHByb3BlcnRpZXMgbWF5IGFsc28gYmUgc2V0IGRlcGVuZGluZyBvbiB0aGUgdHlwZSBvZiBwcmltaXRpdmUgYW5kIG1heSBiZSB1c2VkIHRvIGZ1cnRoZXIgaWRlbnRpZnkgdGhlIHBpY2tlZCBvYmplY3QuXG4gKiBUaGUgcHJpbWl0aXZlcyBpbiB0aGUgbGlzdCBhcmUgb3JkZXJlZCBieSBmaXJzdCBpbnRlcnNlY3Rpb24gdG8gbGFzdCBpbnRlcnNlY3Rpb24uIFRoZSByYXkgbXVzdCBiZSBnaXZlbiBpblxuICogd29ybGQgY29vcmRpbmF0ZXMuXG4gKiA8cD5cbiAqIFRoaXMgZnVuY3Rpb24gb25seSBwaWNrcyBnbG9iZSB0aWxlcyBhbmQgM0QgVGlsZXMgdGhhdCBhcmUgcmVuZGVyZWQgaW4gdGhlIGN1cnJlbnQgdmlldy4gUGlja3MgYWxsIG90aGVyXG4gKiBwcmltaXRpdmVzIHJlZ2FyZGxlc3Mgb2YgdGhlaXIgdmlzaWJpbGl0eS5cbiAqIDwvcD5cbiAqXG4gKiBAcHJpdmF0ZVxuICpcbiAqIEBwYXJhbSB7UmF5fSByYXkgVGhlIHJheS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBbbGltaXQ9TnVtYmVyLk1BWF9WQUxVRV0gSWYgc3VwcGxpZWQsIHN0b3AgZmluZGluZyBpbnRlcnNlY3Rpb25zIGFmdGVyIHRoaXMgbWFueSBpbnRlcnNlY3Rpb25zLlxuICogQHBhcmFtIHtPYmplY3RbXX0gW29iamVjdHNUb0V4Y2x1ZGVdIEEgbGlzdCBvZiBwcmltaXRpdmVzLCBlbnRpdGllcywgb3IgM0QgVGlsZXMgZmVhdHVyZXMgdG8gZXhjbHVkZSBmcm9tIHRoZSByYXkgaW50ZXJzZWN0aW9uLlxuICogQHBhcmFtIHtOdW1iZXJ9IFt3aWR0aD0wLjFdIFdpZHRoIG9mIHRoZSBpbnRlcnNlY3Rpb24gdm9sdW1lIGluIG1ldGVycy5cbiAqIEByZXR1cm5zIHtPYmplY3RbXX0gTGlzdCBvZiBvYmplY3RzIGNvbnRhaW5pbmcgdGhlIG9iamVjdCBhbmQgcG9zaXRpb24gb2YgZWFjaCBpbnRlcnNlY3Rpb24uXG4gKlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IFJheSBpbnRlcnNlY3Rpb25zIGFyZSBvbmx5IHN1cHBvcnRlZCBpbiAzRCBtb2RlLlxuICovXG5TY2VuZS5wcm90b3R5cGUuZHJpbGxQaWNrRnJvbVJheSA9IGZ1bmN0aW9uIChcbiAgcmF5LFxuICBsaW1pdCxcbiAgb2JqZWN0c1RvRXhjbHVkZSxcbiAgd2lkdGhcbikge1xuICByZXR1cm4gdGhpcy5fcGlja2luZy5kcmlsbFBpY2tGcm9tUmF5KFxuICAgIHRoaXMsXG4gICAgcmF5LFxuICAgIGxpbWl0LFxuICAgIG9iamVjdHNUb0V4Y2x1ZGUsXG4gICAgd2lkdGhcbiAgKTtcbn07XG5cbi8qKlxuICogSW5pdGlhdGVzIGFuIGFzeW5jaHJvbm91cyB7QGxpbmsgU2NlbmUjcGlja0Zyb21SYXl9IHJlcXVlc3QgdXNpbmcgdGhlIG1heGltdW0gbGV2ZWwgb2YgZGV0YWlsIGZvciAzRCBUaWxlc2V0c1xuICogcmVnYXJkbGVzcyBvZiB2aXNpYmlsaXR5LlxuICpcbiAqIEBwcml2YXRlXG4gKlxuICogQHBhcmFtIHtSYXl9IHJheSBUaGUgcmF5LlxuICogQHBhcmFtIHtPYmplY3RbXX0gW29iamVjdHNUb0V4Y2x1ZGVdIEEgbGlzdCBvZiBwcmltaXRpdmVzLCBlbnRpdGllcywgb3IgM0QgVGlsZXMgZmVhdHVyZXMgdG8gZXhjbHVkZSBmcm9tIHRoZSByYXkgaW50ZXJzZWN0aW9uLlxuICogQHBhcmFtIHtOdW1iZXJ9IFt3aWR0aD0wLjFdIFdpZHRoIG9mIHRoZSBpbnRlcnNlY3Rpb24gdm9sdW1lIGluIG1ldGVycy5cbiAqIEByZXR1cm5zIHtQcm9taXNlLjxPYmplY3Q+fSBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgb2JqZWN0IGFuZCBwb3NpdGlvbiBvZiB0aGUgZmlyc3QgaW50ZXJzZWN0aW9uLlxuICpcbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBSYXkgaW50ZXJzZWN0aW9ucyBhcmUgb25seSBzdXBwb3J0ZWQgaW4gM0QgbW9kZS5cbiAqL1xuU2NlbmUucHJvdG90eXBlLnBpY2tGcm9tUmF5TW9zdERldGFpbGVkID0gZnVuY3Rpb24gKFxuICByYXksXG4gIG9iamVjdHNUb0V4Y2x1ZGUsXG4gIHdpZHRoXG4pIHtcbiAgcmV0dXJuIHRoaXMuX3BpY2tpbmcucGlja0Zyb21SYXlNb3N0RGV0YWlsZWQoXG4gICAgdGhpcyxcbiAgICByYXksXG4gICAgb2JqZWN0c1RvRXhjbHVkZSxcbiAgICB3aWR0aFxuICApO1xufTtcblxuLyoqXG4gKiBJbml0aWF0ZXMgYW4gYXN5bmNocm9ub3VzIHtAbGluayBTY2VuZSNkcmlsbFBpY2tGcm9tUmF5fSByZXF1ZXN0IHVzaW5nIHRoZSBtYXhpbXVtIGxldmVsIG9mIGRldGFpbCBmb3IgM0QgVGlsZXNldHNcbiAqIHJlZ2FyZGxlc3Mgb2YgdmlzaWJpbGl0eS5cbiAqXG4gKiBAcHJpdmF0ZVxuICpcbiAqIEBwYXJhbSB7UmF5fSByYXkgVGhlIHJheS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBbbGltaXQ9TnVtYmVyLk1BWF9WQUxVRV0gSWYgc3VwcGxpZWQsIHN0b3AgZmluZGluZyBpbnRlcnNlY3Rpb25zIGFmdGVyIHRoaXMgbWFueSBpbnRlcnNlY3Rpb25zLlxuICogQHBhcmFtIHtPYmplY3RbXX0gW29iamVjdHNUb0V4Y2x1ZGVdIEEgbGlzdCBvZiBwcmltaXRpdmVzLCBlbnRpdGllcywgb3IgM0QgVGlsZXMgZmVhdHVyZXMgdG8gZXhjbHVkZSBmcm9tIHRoZSByYXkgaW50ZXJzZWN0aW9uLlxuICogQHBhcmFtIHtOdW1iZXJ9IFt3aWR0aD0wLjFdIFdpZHRoIG9mIHRoZSBpbnRlcnNlY3Rpb24gdm9sdW1lIGluIG1ldGVycy5cbiAqIEByZXR1cm5zIHtQcm9taXNlLjxPYmplY3RbXT59IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGEgbGlzdCBvZiBvYmplY3RzIGNvbnRhaW5pbmcgdGhlIG9iamVjdCBhbmQgcG9zaXRpb24gb2YgZWFjaCBpbnRlcnNlY3Rpb24uXG4gKlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IFJheSBpbnRlcnNlY3Rpb25zIGFyZSBvbmx5IHN1cHBvcnRlZCBpbiAzRCBtb2RlLlxuICovXG5TY2VuZS5wcm90b3R5cGUuZHJpbGxQaWNrRnJvbVJheU1vc3REZXRhaWxlZCA9IGZ1bmN0aW9uIChcbiAgcmF5LFxuICBsaW1pdCxcbiAgb2JqZWN0c1RvRXhjbHVkZSxcbiAgd2lkdGhcbikge1xuICByZXR1cm4gdGhpcy5fcGlja2luZy5kcmlsbFBpY2tGcm9tUmF5TW9zdERldGFpbGVkKFxuICAgIHRoaXMsXG4gICAgcmF5LFxuICAgIGxpbWl0LFxuICAgIG9iamVjdHNUb0V4Y2x1ZGUsXG4gICAgd2lkdGhcbiAgKTtcbn07XG5cbi8qKlxuICogUmV0dXJucyB0aGUgaGVpZ2h0IG9mIHNjZW5lIGdlb21ldHJ5IGF0IHRoZSBnaXZlbiBjYXJ0b2dyYXBoaWMgcG9zaXRpb24gb3IgPGNvZGU+dW5kZWZpbmVkPC9jb2RlPiBpZiB0aGVyZSB3YXMgbm9cbiAqIHNjZW5lIGdlb21ldHJ5IHRvIHNhbXBsZSBoZWlnaHQgZnJvbS4gVGhlIGhlaWdodCBvZiB0aGUgaW5wdXQgcG9zaXRpb24gaXMgaWdub3JlZC4gTWF5IGJlIHVzZWQgdG8gY2xhbXAgb2JqZWN0cyB0b1xuICogdGhlIGdsb2JlLCAzRCBUaWxlcywgb3IgcHJpbWl0aXZlcyBpbiB0aGUgc2NlbmUuXG4gKiA8cD5cbiAqIFRoaXMgZnVuY3Rpb24gb25seSBzYW1wbGVzIGhlaWdodCBmcm9tIGdsb2JlIHRpbGVzIGFuZCAzRCBUaWxlcyB0aGF0IGFyZSByZW5kZXJlZCBpbiB0aGUgY3VycmVudCB2aWV3LiBTYW1wbGVzIGhlaWdodFxuICogZnJvbSBhbGwgb3RoZXIgcHJpbWl0aXZlcyByZWdhcmRsZXNzIG9mIHRoZWlyIHZpc2liaWxpdHkuXG4gKiA8L3A+XG4gKlxuICogQHBhcmFtIHtDYXJ0b2dyYXBoaWN9IHBvc2l0aW9uIFRoZSBjYXJ0b2dyYXBoaWMgcG9zaXRpb24gdG8gc2FtcGxlIGhlaWdodCBmcm9tLlxuICogQHBhcmFtIHtPYmplY3RbXX0gW29iamVjdHNUb0V4Y2x1ZGVdIEEgbGlzdCBvZiBwcmltaXRpdmVzLCBlbnRpdGllcywgb3IgM0QgVGlsZXMgZmVhdHVyZXMgdG8gbm90IHNhbXBsZSBoZWlnaHQgZnJvbS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBbd2lkdGg9MC4xXSBXaWR0aCBvZiB0aGUgaW50ZXJzZWN0aW9uIHZvbHVtZSBpbiBtZXRlcnMuXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgaGVpZ2h0LiBUaGlzIG1heSBiZSA8Y29kZT51bmRlZmluZWQ8L2NvZGU+IGlmIHRoZXJlIHdhcyBubyBzY2VuZSBnZW9tZXRyeSB0byBzYW1wbGUgaGVpZ2h0IGZyb20uXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBwb3NpdGlvbiA9IG5ldyBDZXNpdW0uQ2FydG9ncmFwaGljKC0xLjMxOTY4LCAwLjY5ODg3NCk7XG4gKiB2YXIgaGVpZ2h0ID0gdmlld2VyLnNjZW5lLnNhbXBsZUhlaWdodChwb3NpdGlvbik7XG4gKiBjb25zb2xlLmxvZyhoZWlnaHQpO1xuICpcbiAqIEBzZWUgU2NlbmUjY2xhbXBUb0hlaWdodFxuICogQHNlZSBTY2VuZSNjbGFtcFRvSGVpZ2h0TW9zdERldGFpbGVkXG4gKiBAc2VlIFNjZW5lI3NhbXBsZUhlaWdodE1vc3REZXRhaWxlZFxuICpcbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBzYW1wbGVIZWlnaHQgaXMgb25seSBzdXBwb3J0ZWQgaW4gM0QgbW9kZS5cbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBzYW1wbGVIZWlnaHQgcmVxdWlyZXMgZGVwdGggdGV4dHVyZSBzdXBwb3J0LiBDaGVjayBzYW1wbGVIZWlnaHRTdXBwb3J0ZWQuXG4gKi9cblNjZW5lLnByb3RvdHlwZS5zYW1wbGVIZWlnaHQgPSBmdW5jdGlvbiAocG9zaXRpb24sIG9iamVjdHNUb0V4Y2x1ZGUsIHdpZHRoKSB7XG4gIHJldHVybiB0aGlzLl9waWNraW5nLnNhbXBsZUhlaWdodCh0aGlzLCBwb3NpdGlvbiwgb2JqZWN0c1RvRXhjbHVkZSwgd2lkdGgpO1xufTtcblxuLyoqXG4gKiBDbGFtcHMgdGhlIGdpdmVuIGNhcnRlc2lhbiBwb3NpdGlvbiB0byB0aGUgc2NlbmUgZ2VvbWV0cnkgYWxvbmcgdGhlIGdlb2RldGljIHN1cmZhY2Ugbm9ybWFsLiBSZXR1cm5zIHRoZVxuICogY2xhbXBlZCBwb3NpdGlvbiBvciA8Y29kZT51bmRlZmluZWQ8L2NvZGU+IGlmIHRoZXJlIHdhcyBubyBzY2VuZSBnZW9tZXRyeSB0byBjbGFtcCB0by4gTWF5IGJlIHVzZWQgdG8gY2xhbXBcbiAqIG9iamVjdHMgdG8gdGhlIGdsb2JlLCAzRCBUaWxlcywgb3IgcHJpbWl0aXZlcyBpbiB0aGUgc2NlbmUuXG4gKiA8cD5cbiAqIFRoaXMgZnVuY3Rpb24gb25seSBjbGFtcHMgdG8gZ2xvYmUgdGlsZXMgYW5kIDNEIFRpbGVzIHRoYXQgYXJlIHJlbmRlcmVkIGluIHRoZSBjdXJyZW50IHZpZXcuIENsYW1wcyB0b1xuICogYWxsIG90aGVyIHByaW1pdGl2ZXMgcmVnYXJkbGVzcyBvZiB0aGVpciB2aXNpYmlsaXR5LlxuICogPC9wPlxuICpcbiAqIEBwYXJhbSB7Q2FydGVzaWFuM30gY2FydGVzaWFuIFRoZSBjYXJ0ZXNpYW4gcG9zaXRpb24uXG4gKiBAcGFyYW0ge09iamVjdFtdfSBbb2JqZWN0c1RvRXhjbHVkZV0gQSBsaXN0IG9mIHByaW1pdGl2ZXMsIGVudGl0aWVzLCBvciAzRCBUaWxlcyBmZWF0dXJlcyB0byBub3QgY2xhbXAgdG8uXG4gKiBAcGFyYW0ge051bWJlcn0gW3dpZHRoPTAuMV0gV2lkdGggb2YgdGhlIGludGVyc2VjdGlvbiB2b2x1bWUgaW4gbWV0ZXJzLlxuICogQHBhcmFtIHtDYXJ0ZXNpYW4zfSBbcmVzdWx0XSBBbiBvcHRpb25hbCBvYmplY3QgdG8gcmV0dXJuIHRoZSBjbGFtcGVkIHBvc2l0aW9uLlxuICogQHJldHVybnMge0NhcnRlc2lhbjN9IFRoZSBtb2RpZmllZCByZXN1bHQgcGFyYW1ldGVyIG9yIGEgbmV3IENhcnRlc2lhbjMgaW5zdGFuY2UgaWYgb25lIHdhcyBub3QgcHJvdmlkZWQuIFRoaXMgbWF5IGJlIDxjb2RlPnVuZGVmaW5lZDwvY29kZT4gaWYgdGhlcmUgd2FzIG5vIHNjZW5lIGdlb21ldHJ5IHRvIGNsYW1wIHRvLlxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDbGFtcCBhbiBlbnRpdHkgdG8gdGhlIHVuZGVybHlpbmcgc2NlbmUgZ2VvbWV0cnlcbiAqIHZhciBwb3NpdGlvbiA9IGVudGl0eS5wb3NpdGlvbi5nZXRWYWx1ZShDZXNpdW0uSnVsaWFuRGF0ZS5ub3coKSk7XG4gKiBlbnRpdHkucG9zaXRpb24gPSB2aWV3ZXIuc2NlbmUuY2xhbXBUb0hlaWdodChwb3NpdGlvbik7XG4gKlxuICogQHNlZSBTY2VuZSNzYW1wbGVIZWlnaHRcbiAqIEBzZWUgU2NlbmUjc2FtcGxlSGVpZ2h0TW9zdERldGFpbGVkXG4gKiBAc2VlIFNjZW5lI2NsYW1wVG9IZWlnaHRNb3N0RGV0YWlsZWRcbiAqXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gY2xhbXBUb0hlaWdodCBpcyBvbmx5IHN1cHBvcnRlZCBpbiAzRCBtb2RlLlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IGNsYW1wVG9IZWlnaHQgcmVxdWlyZXMgZGVwdGggdGV4dHVyZSBzdXBwb3J0LiBDaGVjayBjbGFtcFRvSGVpZ2h0U3VwcG9ydGVkLlxuICovXG5TY2VuZS5wcm90b3R5cGUuY2xhbXBUb0hlaWdodCA9IGZ1bmN0aW9uIChcbiAgY2FydGVzaWFuLFxuICBvYmplY3RzVG9FeGNsdWRlLFxuICB3aWR0aCxcbiAgcmVzdWx0XG4pIHtcbiAgcmV0dXJuIHRoaXMuX3BpY2tpbmcuY2xhbXBUb0hlaWdodChcbiAgICB0aGlzLFxuICAgIGNhcnRlc2lhbixcbiAgICBvYmplY3RzVG9FeGNsdWRlLFxuICAgIHdpZHRoLFxuICAgIHJlc3VsdFxuICApO1xufTtcblxuLyoqXG4gKiBJbml0aWF0ZXMgYW4gYXN5bmNocm9ub3VzIHtAbGluayBTY2VuZSNzYW1wbGVIZWlnaHR9IHF1ZXJ5IGZvciBhbiBhcnJheSBvZiB7QGxpbmsgQ2FydG9ncmFwaGljfSBwb3NpdGlvbnNcbiAqIHVzaW5nIHRoZSBtYXhpbXVtIGxldmVsIG9mIGRldGFpbCBmb3IgM0QgVGlsZXNldHMgaW4gdGhlIHNjZW5lLiBUaGUgaGVpZ2h0IG9mIHRoZSBpbnB1dCBwb3NpdGlvbnMgaXMgaWdub3JlZC5cbiAqIFJldHVybnMgYSBwcm9taXNlIHRoYXQgaXMgcmVzb2x2ZWQgd2hlbiB0aGUgcXVlcnkgY29tcGxldGVzLiBFYWNoIHBvaW50IGhlaWdodCBpcyBtb2RpZmllZCBpbiBwbGFjZS5cbiAqIElmIGEgaGVpZ2h0IGNhbm5vdCBiZSBkZXRlcm1pbmVkIGJlY2F1c2Ugbm8gZ2VvbWV0cnkgY2FuIGJlIHNhbXBsZWQgYXQgdGhhdCBsb2NhdGlvbiwgb3IgYW5vdGhlciBlcnJvciBvY2N1cnMsXG4gKiB0aGUgaGVpZ2h0IGlzIHNldCB0byB1bmRlZmluZWQuXG4gKlxuICogQHBhcmFtIHtDYXJ0b2dyYXBoaWNbXX0gcG9zaXRpb25zIFRoZSBjYXJ0b2dyYXBoaWMgcG9zaXRpb25zIHRvIHVwZGF0ZSB3aXRoIHNhbXBsZWQgaGVpZ2h0cy5cbiAqIEBwYXJhbSB7T2JqZWN0W119IFtvYmplY3RzVG9FeGNsdWRlXSBBIGxpc3Qgb2YgcHJpbWl0aXZlcywgZW50aXRpZXMsIG9yIDNEIFRpbGVzIGZlYXR1cmVzIHRvIG5vdCBzYW1wbGUgaGVpZ2h0IGZyb20uXG4gKiBAcGFyYW0ge051bWJlcn0gW3dpZHRoPTAuMV0gV2lkdGggb2YgdGhlIGludGVyc2VjdGlvbiB2b2x1bWUgaW4gbWV0ZXJzLlxuICogQHJldHVybnMge1Byb21pc2UuPENhcnRvZ3JhcGhpY1tdPn0gQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gdGhlIHByb3ZpZGVkIGxpc3Qgb2YgcG9zaXRpb25zIHdoZW4gdGhlIHF1ZXJ5IGhhcyBjb21wbGV0ZWQuXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBwb3NpdGlvbnMgPSBbXG4gKiAgICAgbmV3IENlc2l1bS5DYXJ0b2dyYXBoaWMoLTEuMzE5NjgsIDAuNjk4ODcpLFxuICogICAgIG5ldyBDZXNpdW0uQ2FydG9ncmFwaGljKC0xLjEwNDg5LCAwLjgzOTIzKVxuICogXTtcbiAqIHZhciBwcm9taXNlID0gdmlld2VyLnNjZW5lLnNhbXBsZUhlaWdodE1vc3REZXRhaWxlZChwb3NpdGlvbnMpO1xuICogcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHVwZGF0ZWRQb3NpdGlvbikge1xuICogICAgIC8vIHBvc2l0aW9uc1swXS5oZWlnaHQgYW5kIHBvc2l0aW9uc1sxXS5oZWlnaHQgaGF2ZSBiZWVuIHVwZGF0ZWQuXG4gKiAgICAgLy8gdXBkYXRlZFBvc2l0aW9ucyBpcyBqdXN0IGEgcmVmZXJlbmNlIHRvIHBvc2l0aW9ucy5cbiAqIH1cbiAqXG4gKiBAc2VlIFNjZW5lI3NhbXBsZUhlaWdodFxuICpcbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBzYW1wbGVIZWlnaHRNb3N0RGV0YWlsZWQgaXMgb25seSBzdXBwb3J0ZWQgaW4gM0QgbW9kZS5cbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBzYW1wbGVIZWlnaHRNb3N0RGV0YWlsZWQgcmVxdWlyZXMgZGVwdGggdGV4dHVyZSBzdXBwb3J0LiBDaGVjayBzYW1wbGVIZWlnaHRTdXBwb3J0ZWQuXG4gKi9cblNjZW5lLnByb3RvdHlwZS5zYW1wbGVIZWlnaHRNb3N0RGV0YWlsZWQgPSBmdW5jdGlvbiAoXG4gIHBvc2l0aW9ucyxcbiAgb2JqZWN0c1RvRXhjbHVkZSxcbiAgd2lkdGhcbikge1xuICByZXR1cm4gdGhpcy5fcGlja2luZy5zYW1wbGVIZWlnaHRNb3N0RGV0YWlsZWQoXG4gICAgdGhpcyxcbiAgICBwb3NpdGlvbnMsXG4gICAgb2JqZWN0c1RvRXhjbHVkZSxcbiAgICB3aWR0aFxuICApO1xufTtcblxuLyoqXG4gKiBJbml0aWF0ZXMgYW4gYXN5bmNocm9ub3VzIHtAbGluayBTY2VuZSNjbGFtcFRvSGVpZ2h0fSBxdWVyeSBmb3IgYW4gYXJyYXkgb2Yge0BsaW5rIENhcnRlc2lhbjN9IHBvc2l0aW9uc1xuICogdXNpbmcgdGhlIG1heGltdW0gbGV2ZWwgb2YgZGV0YWlsIGZvciAzRCBUaWxlc2V0cyBpbiB0aGUgc2NlbmUuIFJldHVybnMgYSBwcm9taXNlIHRoYXQgaXMgcmVzb2x2ZWQgd2hlblxuICogdGhlIHF1ZXJ5IGNvbXBsZXRlcy4gRWFjaCBwb3NpdGlvbiBpcyBtb2RpZmllZCBpbiBwbGFjZS4gSWYgYSBwb3NpdGlvbiBjYW5ub3QgYmUgY2xhbXBlZCBiZWNhdXNlIG5vIGdlb21ldHJ5XG4gKiBjYW4gYmUgc2FtcGxlZCBhdCB0aGF0IGxvY2F0aW9uLCBvciBhbm90aGVyIGVycm9yIG9jY3VycywgdGhlIGVsZW1lbnQgaW4gdGhlIGFycmF5IGlzIHNldCB0byB1bmRlZmluZWQuXG4gKlxuICogQHBhcmFtIHtDYXJ0ZXNpYW4zW119IGNhcnRlc2lhbnMgVGhlIGNhcnRlc2lhbiBwb3NpdGlvbnMgdG8gdXBkYXRlIHdpdGggY2xhbXBlZCBwb3NpdGlvbnMuXG4gKiBAcGFyYW0ge09iamVjdFtdfSBbb2JqZWN0c1RvRXhjbHVkZV0gQSBsaXN0IG9mIHByaW1pdGl2ZXMsIGVudGl0aWVzLCBvciAzRCBUaWxlcyBmZWF0dXJlcyB0byBub3QgY2xhbXAgdG8uXG4gKiBAcGFyYW0ge051bWJlcn0gW3dpZHRoPTAuMV0gV2lkdGggb2YgdGhlIGludGVyc2VjdGlvbiB2b2x1bWUgaW4gbWV0ZXJzLlxuICogQHJldHVybnMge1Byb21pc2UuPENhcnRlc2lhbjNbXT59IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHRoZSBwcm92aWRlZCBsaXN0IG9mIHBvc2l0aW9ucyB3aGVuIHRoZSBxdWVyeSBoYXMgY29tcGxldGVkLlxuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgY2FydGVzaWFucyA9IFtcbiAqICAgICBlbnRpdGllc1swXS5wb3NpdGlvbi5nZXRWYWx1ZShDZXNpdW0uSnVsaWFuRGF0ZS5ub3coKSksXG4gKiAgICAgZW50aXRpZXNbMV0ucG9zaXRpb24uZ2V0VmFsdWUoQ2VzaXVtLkp1bGlhbkRhdGUubm93KCkpXG4gKiBdO1xuICogdmFyIHByb21pc2UgPSB2aWV3ZXIuc2NlbmUuY2xhbXBUb0hlaWdodE1vc3REZXRhaWxlZChjYXJ0ZXNpYW5zKTtcbiAqIHByb21pc2UudGhlbihmdW5jdGlvbih1cGRhdGVkQ2FydGVzaWFucykge1xuICogICAgIGVudGl0aWVzWzBdLnBvc2l0aW9uID0gdXBkYXRlZENhcnRlc2lhbnNbMF07XG4gKiAgICAgZW50aXRpZXNbMV0ucG9zaXRpb24gPSB1cGRhdGVkQ2FydGVzaWFuc1sxXTtcbiAqIH1cbiAqXG4gKiBAc2VlIFNjZW5lI2NsYW1wVG9IZWlnaHRcbiAqXG4gKiBAZXhjZXB0aW9uIHtEZXZlbG9wZXJFcnJvcn0gY2xhbXBUb0hlaWdodE1vc3REZXRhaWxlZCBpcyBvbmx5IHN1cHBvcnRlZCBpbiAzRCBtb2RlLlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IGNsYW1wVG9IZWlnaHRNb3N0RGV0YWlsZWQgcmVxdWlyZXMgZGVwdGggdGV4dHVyZSBzdXBwb3J0LiBDaGVjayBjbGFtcFRvSGVpZ2h0U3VwcG9ydGVkLlxuICovXG5TY2VuZS5wcm90b3R5cGUuY2xhbXBUb0hlaWdodE1vc3REZXRhaWxlZCA9IGZ1bmN0aW9uIChcbiAgY2FydGVzaWFucyxcbiAgb2JqZWN0c1RvRXhjbHVkZSxcbiAgd2lkdGhcbikge1xuICByZXR1cm4gdGhpcy5fcGlja2luZy5jbGFtcFRvSGVpZ2h0TW9zdERldGFpbGVkKFxuICAgIHRoaXMsXG4gICAgY2FydGVzaWFucyxcbiAgICBvYmplY3RzVG9FeGNsdWRlLFxuICAgIHdpZHRoXG4gICk7XG59O1xuXG4vKipcbiAqIFRyYW5zZm9ybXMgYSBwb3NpdGlvbiBpbiBjYXJ0ZXNpYW4gY29vcmRpbmF0ZXMgdG8gY2FudmFzIGNvb3JkaW5hdGVzLiAgVGhpcyBpcyBjb21tb25seSB1c2VkIHRvIHBsYWNlIGFuXG4gKiBIVE1MIGVsZW1lbnQgYXQgdGhlIHNhbWUgc2NyZWVuIHBvc2l0aW9uIGFzIGFuIG9iamVjdCBpbiB0aGUgc2NlbmUuXG4gKlxuICogQHBhcmFtIHtDYXJ0ZXNpYW4zfSBwb3NpdGlvbiBUaGUgcG9zaXRpb24gaW4gY2FydGVzaWFuIGNvb3JkaW5hdGVzLlxuICogQHBhcmFtIHtDYXJ0ZXNpYW4yfSBbcmVzdWx0XSBBbiBvcHRpb25hbCBvYmplY3QgdG8gcmV0dXJuIHRoZSBpbnB1dCBwb3NpdGlvbiB0cmFuc2Zvcm1lZCB0byBjYW52YXMgY29vcmRpbmF0ZXMuXG4gKiBAcmV0dXJucyB7Q2FydGVzaWFuMn0gVGhlIG1vZGlmaWVkIHJlc3VsdCBwYXJhbWV0ZXIgb3IgYSBuZXcgQ2FydGVzaWFuMiBpbnN0YW5jZSBpZiBvbmUgd2FzIG5vdCBwcm92aWRlZC4gIFRoaXMgbWF5IGJlIDxjb2RlPnVuZGVmaW5lZDwvY29kZT4gaWYgdGhlIGlucHV0IHBvc2l0aW9uIGlzIG5lYXIgdGhlIGNlbnRlciBvZiB0aGUgZWxsaXBzb2lkLlxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBPdXRwdXQgdGhlIGNhbnZhcyBwb3NpdGlvbiBvZiBsb25naXR1ZGUvbGF0aXR1ZGUgKDAsIDApIGV2ZXJ5IHRpbWUgdGhlIG1vdXNlIG1vdmVzLlxuICogdmFyIHNjZW5lID0gd2lkZ2V0LnNjZW5lO1xuICogdmFyIGVsbGlwc29pZCA9IHNjZW5lLmdsb2JlLmVsbGlwc29pZDtcbiAqIHZhciBwb3NpdGlvbiA9IENlc2l1bS5DYXJ0ZXNpYW4zLmZyb21EZWdyZWVzKDAuMCwgMC4wKTtcbiAqIHZhciBoYW5kbGVyID0gbmV3IENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50SGFuZGxlcihzY2VuZS5jYW52YXMpO1xuICogaGFuZGxlci5zZXRJbnB1dEFjdGlvbihmdW5jdGlvbihtb3ZlbWVudCkge1xuICogICAgIGNvbnNvbGUubG9nKHNjZW5lLmNhcnRlc2lhblRvQ2FudmFzQ29vcmRpbmF0ZXMocG9zaXRpb24pKTtcbiAqIH0sIENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5NT1VTRV9NT1ZFKTtcbiAqL1xuU2NlbmUucHJvdG90eXBlLmNhcnRlc2lhblRvQ2FudmFzQ29vcmRpbmF0ZXMgPSBmdW5jdGlvbiAocG9zaXRpb24sIHJlc3VsdCkge1xuICByZXR1cm4gU2NlbmVUcmFuc2Zvcm1zLndnczg0VG9XaW5kb3dDb29yZGluYXRlcyh0aGlzLCBwb3NpdGlvbiwgcmVzdWx0KTtcbn07XG5cbi8qKlxuICogSW5zdGFudGx5IGNvbXBsZXRlcyBhbiBhY3RpdmUgdHJhbnNpdGlvbi5cbiAqL1xuU2NlbmUucHJvdG90eXBlLmNvbXBsZXRlTW9ycGggPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuX3RyYW5zaXRpb25lci5jb21wbGV0ZU1vcnBoKCk7XG59O1xuXG4vKipcbiAqIEFzeW5jaHJvbm91c2x5IHRyYW5zaXRpb25zIHRoZSBzY2VuZSB0byAyRC5cbiAqIEBwYXJhbSB7TnVtYmVyfSBbZHVyYXRpb249Mi4wXSBUaGUgYW1vdW50IG9mIHRpbWUsIGluIHNlY29uZHMsIGZvciB0cmFuc2l0aW9uIGFuaW1hdGlvbnMgdG8gY29tcGxldGUuXG4gKi9cblNjZW5lLnByb3RvdHlwZS5tb3JwaFRvMkQgPSBmdW5jdGlvbiAoZHVyYXRpb24pIHtcbiAgdmFyIGVsbGlwc29pZDtcbiAgdmFyIGdsb2JlID0gdGhpcy5nbG9iZTtcbiAgaWYgKGRlZmluZWQoZ2xvYmUpKSB7XG4gICAgZWxsaXBzb2lkID0gZ2xvYmUuZWxsaXBzb2lkO1xuICB9IGVsc2Uge1xuICAgIGVsbGlwc29pZCA9IHRoaXMubWFwUHJvamVjdGlvbi5lbGxpcHNvaWQ7XG4gIH1cbiAgZHVyYXRpb24gPSBkZWZhdWx0VmFsdWUoZHVyYXRpb24sIDIuMCk7XG4gIHRoaXMuX3RyYW5zaXRpb25lci5tb3JwaFRvMkQoZHVyYXRpb24sIGVsbGlwc29pZCk7XG59O1xuXG4vKipcbiAqIEFzeW5jaHJvbm91c2x5IHRyYW5zaXRpb25zIHRoZSBzY2VuZSB0byBDb2x1bWJ1cyBWaWV3LlxuICogQHBhcmFtIHtOdW1iZXJ9IFtkdXJhdGlvbj0yLjBdIFRoZSBhbW91bnQgb2YgdGltZSwgaW4gc2Vjb25kcywgZm9yIHRyYW5zaXRpb24gYW5pbWF0aW9ucyB0byBjb21wbGV0ZS5cbiAqL1xuU2NlbmUucHJvdG90eXBlLm1vcnBoVG9Db2x1bWJ1c1ZpZXcgPSBmdW5jdGlvbiAoZHVyYXRpb24pIHtcbiAgdmFyIGVsbGlwc29pZDtcbiAgdmFyIGdsb2JlID0gdGhpcy5nbG9iZTtcbiAgaWYgKGRlZmluZWQoZ2xvYmUpKSB7XG4gICAgZWxsaXBzb2lkID0gZ2xvYmUuZWxsaXBzb2lkO1xuICB9IGVsc2Uge1xuICAgIGVsbGlwc29pZCA9IHRoaXMubWFwUHJvamVjdGlvbi5lbGxpcHNvaWQ7XG4gIH1cbiAgZHVyYXRpb24gPSBkZWZhdWx0VmFsdWUoZHVyYXRpb24sIDIuMCk7XG4gIHRoaXMuX3RyYW5zaXRpb25lci5tb3JwaFRvQ29sdW1idXNWaWV3KGR1cmF0aW9uLCBlbGxpcHNvaWQpO1xufTtcblxuLyoqXG4gKiBBc3luY2hyb25vdXNseSB0cmFuc2l0aW9ucyB0aGUgc2NlbmUgdG8gM0QuXG4gKiBAcGFyYW0ge051bWJlcn0gW2R1cmF0aW9uPTIuMF0gVGhlIGFtb3VudCBvZiB0aW1lLCBpbiBzZWNvbmRzLCBmb3IgdHJhbnNpdGlvbiBhbmltYXRpb25zIHRvIGNvbXBsZXRlLlxuICovXG5TY2VuZS5wcm90b3R5cGUubW9ycGhUbzNEID0gZnVuY3Rpb24gKGR1cmF0aW9uKSB7XG4gIHZhciBlbGxpcHNvaWQ7XG4gIHZhciBnbG9iZSA9IHRoaXMuZ2xvYmU7XG4gIGlmIChkZWZpbmVkKGdsb2JlKSkge1xuICAgIGVsbGlwc29pZCA9IGdsb2JlLmVsbGlwc29pZDtcbiAgfSBlbHNlIHtcbiAgICBlbGxpcHNvaWQgPSB0aGlzLm1hcFByb2plY3Rpb24uZWxsaXBzb2lkO1xuICB9XG4gIGR1cmF0aW9uID0gZGVmYXVsdFZhbHVlKGR1cmF0aW9uLCAyLjApO1xuICB0aGlzLl90cmFuc2l0aW9uZXIubW9ycGhUbzNEKGR1cmF0aW9uLCBlbGxpcHNvaWQpO1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZDsgb3RoZXJ3aXNlLCBmYWxzZS5cbiAqIDxiciAvPjxiciAvPlxuICogSWYgdGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZCwgaXQgc2hvdWxkIG5vdCBiZSB1c2VkOyBjYWxsaW5nIGFueSBmdW5jdGlvbiBvdGhlciB0aGFuXG4gKiA8Y29kZT5pc0Rlc3Ryb3llZDwvY29kZT4gd2lsbCByZXN1bHQgaW4gYSB7QGxpbmsgRGV2ZWxvcGVyRXJyb3J9IGV4Y2VwdGlvbi5cbiAqXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gPGNvZGU+dHJ1ZTwvY29kZT4gaWYgdGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZDsgb3RoZXJ3aXNlLCA8Y29kZT5mYWxzZTwvY29kZT4uXG4gKlxuICogQHNlZSBTY2VuZSNkZXN0cm95XG4gKi9cblNjZW5lLnByb3RvdHlwZS5pc0Rlc3Ryb3llZCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyoqXG4gKiBEZXN0cm95cyB0aGUgV2ViR0wgcmVzb3VyY2VzIGhlbGQgYnkgdGhpcyBvYmplY3QuICBEZXN0cm95aW5nIGFuIG9iamVjdCBhbGxvd3MgZm9yIGRldGVybWluaXN0aWNcbiAqIHJlbGVhc2Ugb2YgV2ViR0wgcmVzb3VyY2VzLCBpbnN0ZWFkIG9mIHJlbHlpbmcgb24gdGhlIGdhcmJhZ2UgY29sbGVjdG9yIHRvIGRlc3Ryb3kgdGhpcyBvYmplY3QuXG4gKiA8YnIgLz48YnIgLz5cbiAqIE9uY2UgYW4gb2JqZWN0IGlzIGRlc3Ryb3llZCwgaXQgc2hvdWxkIG5vdCBiZSB1c2VkOyBjYWxsaW5nIGFueSBmdW5jdGlvbiBvdGhlciB0aGFuXG4gKiA8Y29kZT5pc0Rlc3Ryb3llZDwvY29kZT4gd2lsbCByZXN1bHQgaW4gYSB7QGxpbmsgRGV2ZWxvcGVyRXJyb3J9IGV4Y2VwdGlvbi4gIFRoZXJlZm9yZSxcbiAqIGFzc2lnbiB0aGUgcmV0dXJuIHZhbHVlICg8Y29kZT51bmRlZmluZWQ8L2NvZGU+KSB0byB0aGUgb2JqZWN0IGFzIGRvbmUgaW4gdGhlIGV4YW1wbGUuXG4gKlxuICogQGV4Y2VwdGlvbiB7RGV2ZWxvcGVyRXJyb3J9IFRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQsIGkuZS4sIGRlc3Ryb3koKSB3YXMgY2FsbGVkLlxuICpcbiAqXG4gKiBAZXhhbXBsZVxuICogc2NlbmUgPSBzY2VuZSAmJiBzY2VuZS5kZXN0cm95KCk7XG4gKlxuICogQHNlZSBTY2VuZSNpc0Rlc3Ryb3llZFxuICovXG5TY2VuZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5fdHdlZW5zLnJlbW92ZUFsbCgpO1xuICB0aGlzLl9jb21wdXRlRW5naW5lID0gdGhpcy5fY29tcHV0ZUVuZ2luZSAmJiB0aGlzLl9jb21wdXRlRW5naW5lLmRlc3Ryb3koKTtcbiAgdGhpcy5fc2NyZWVuU3BhY2VDYW1lcmFDb250cm9sbGVyID1cbiAgICB0aGlzLl9zY3JlZW5TcGFjZUNhbWVyYUNvbnRyb2xsZXIgJiZcbiAgICB0aGlzLl9zY3JlZW5TcGFjZUNhbWVyYUNvbnRyb2xsZXIuZGVzdHJveSgpO1xuICB0aGlzLl9kZXZpY2VPcmllbnRhdGlvbkNhbWVyYUNvbnRyb2xsZXIgPVxuICAgIHRoaXMuX2RldmljZU9yaWVudGF0aW9uQ2FtZXJhQ29udHJvbGxlciAmJlxuICAgICF0aGlzLl9kZXZpY2VPcmllbnRhdGlvbkNhbWVyYUNvbnRyb2xsZXIuaXNEZXN0cm95ZWQoKSAmJlxuICAgIHRoaXMuX2RldmljZU9yaWVudGF0aW9uQ2FtZXJhQ29udHJvbGxlci5kZXN0cm95KCk7XG4gIHRoaXMuX3ByaW1pdGl2ZXMgPSB0aGlzLl9wcmltaXRpdmVzICYmIHRoaXMuX3ByaW1pdGl2ZXMuZGVzdHJveSgpO1xuICB0aGlzLl9ncm91bmRQcmltaXRpdmVzID1cbiAgICB0aGlzLl9ncm91bmRQcmltaXRpdmVzICYmIHRoaXMuX2dyb3VuZFByaW1pdGl2ZXMuZGVzdHJveSgpO1xuICB0aGlzLl9nbG9iZSA9IHRoaXMuX2dsb2JlICYmIHRoaXMuX2dsb2JlLmRlc3Ryb3koKTtcbiAgdGhpcy5za3lCb3ggPSB0aGlzLnNreUJveCAmJiB0aGlzLnNreUJveC5kZXN0cm95KCk7XG4gIHRoaXMuc2t5QXRtb3NwaGVyZSA9IHRoaXMuc2t5QXRtb3NwaGVyZSAmJiB0aGlzLnNreUF0bW9zcGhlcmUuZGVzdHJveSgpO1xuICB0aGlzLl9kZWJ1Z1NwaGVyZSA9IHRoaXMuX2RlYnVnU3BoZXJlICYmIHRoaXMuX2RlYnVnU3BoZXJlLmRlc3Ryb3koKTtcbiAgdGhpcy5zdW4gPSB0aGlzLnN1biAmJiB0aGlzLnN1bi5kZXN0cm95KCk7XG4gIHRoaXMuX3N1blBvc3RQcm9jZXNzID0gdGhpcy5fc3VuUG9zdFByb2Nlc3MgJiYgdGhpcy5fc3VuUG9zdFByb2Nlc3MuZGVzdHJveSgpO1xuICB0aGlzLl9kZXB0aFBsYW5lID0gdGhpcy5fZGVwdGhQbGFuZSAmJiB0aGlzLl9kZXB0aFBsYW5lLmRlc3Ryb3koKTtcbiAgdGhpcy5fdHJhbnNpdGlvbmVyID0gdGhpcy5fdHJhbnNpdGlvbmVyICYmIHRoaXMuX3RyYW5zaXRpb25lci5kZXN0cm95KCk7XG4gIHRoaXMuX2RlYnVnRnJ1c3R1bVBsYW5lcyA9XG4gICAgdGhpcy5fZGVidWdGcnVzdHVtUGxhbmVzICYmIHRoaXMuX2RlYnVnRnJ1c3R1bVBsYW5lcy5kZXN0cm95KCk7XG4gIHRoaXMuX2JyZGZMdXRHZW5lcmF0b3IgPVxuICAgIHRoaXMuX2JyZGZMdXRHZW5lcmF0b3IgJiYgdGhpcy5fYnJkZkx1dEdlbmVyYXRvci5kZXN0cm95KCk7XG4gIHRoaXMuX3BpY2tpbmcgPSB0aGlzLl9waWNraW5nICYmIHRoaXMuX3BpY2tpbmcuZGVzdHJveSgpO1xuXG4gIHRoaXMuX2RlZmF1bHRWaWV3ID0gdGhpcy5fZGVmYXVsdFZpZXcgJiYgdGhpcy5fZGVmYXVsdFZpZXcuZGVzdHJveSgpO1xuICB0aGlzLl92aWV3ID0gdW5kZWZpbmVkO1xuXG4gIGlmICh0aGlzLl9yZW1vdmVDcmVkaXRDb250YWluZXIpIHtcbiAgICB0aGlzLl9jYW52YXMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLl9jcmVkaXRDb250YWluZXIpO1xuICB9XG5cbiAgdGhpcy5wb3N0UHJvY2Vzc1N0YWdlcyA9XG4gICAgdGhpcy5wb3N0UHJvY2Vzc1N0YWdlcyAmJiB0aGlzLnBvc3RQcm9jZXNzU3RhZ2VzLmRlc3Ryb3koKTtcblxuICB0aGlzLl9jb250ZXh0ID0gdGhpcy5fY29udGV4dCAmJiB0aGlzLl9jb250ZXh0LmRlc3Ryb3koKTtcbiAgdGhpcy5fZnJhbWVTdGF0ZS5jcmVkaXREaXNwbGF5ID1cbiAgICB0aGlzLl9mcmFtZVN0YXRlLmNyZWRpdERpc3BsYXkgJiYgdGhpcy5fZnJhbWVTdGF0ZS5jcmVkaXREaXNwbGF5LmRlc3Ryb3koKTtcblxuICBpZiAoZGVmaW5lZCh0aGlzLl9wZXJmb3JtYW5jZURpc3BsYXkpKSB7XG4gICAgdGhpcy5fcGVyZm9ybWFuY2VEaXNwbGF5ID1cbiAgICAgIHRoaXMuX3BlcmZvcm1hbmNlRGlzcGxheSAmJiB0aGlzLl9wZXJmb3JtYW5jZURpc3BsYXkuZGVzdHJveSgpO1xuICAgIHRoaXMuX3BlcmZvcm1hbmNlQ29udGFpbmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoXG4gICAgICB0aGlzLl9wZXJmb3JtYW5jZUNvbnRhaW5lclxuICAgICk7XG4gIH1cblxuICB0aGlzLl9yZW1vdmVSZXF1ZXN0TGlzdGVuZXJDYWxsYmFjaygpO1xuICB0aGlzLl9yZW1vdmVUYXNrUHJvY2Vzc29yTGlzdGVuZXJDYWxsYmFjaygpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3JlbW92ZUdsb2JlQ2FsbGJhY2tzLmxlbmd0aDsgKytpKSB7XG4gICAgdGhpcy5fcmVtb3ZlR2xvYmVDYWxsYmFja3NbaV0oKTtcbiAgfVxuICB0aGlzLl9yZW1vdmVHbG9iZUNhbGxiYWNrcy5sZW5ndGggPSAwO1xuXG4gIHJldHVybiBkZXN0cm95T2JqZWN0KHRoaXMpO1xufTtcbmV4cG9ydCBkZWZhdWx0IFNjZW5lO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///36033\n')},60442:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(60838);\n/* harmony import */ var _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(60216);\n/* harmony import */ var _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(63367);\n/* harmony import */ var _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(51688);\n/* harmony import */ var _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(62200);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(82982);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(86511);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(12572);\n/* harmony import */ var _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(50491);\n/* harmony import */ var _Core_HeadingPitchRoll_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(57674);\n/* harmony import */ var _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(67627);\n/* harmony import */ var _Core_KeyboardEventModifier_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(89232);\n/* harmony import */ var _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(99417);\n/* harmony import */ var _Core_Matrix3_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(68201);\n/* harmony import */ var _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(72248);\n/* harmony import */ var _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(91473);\n/* harmony import */ var _Core_Plane_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(7749);\n/* harmony import */ var _Core_Quaternion_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(87811);\n/* harmony import */ var _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(68457);\n/* harmony import */ var _Core_TerrainExaggeration_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(78257);\n/* harmony import */ var _Core_Transforms_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(95555);\n/* harmony import */ var _CameraEventAggregator_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(90070);\n/* harmony import */ var _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(84321);\n/* harmony import */ var _MapMode2D_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(95757);\n/* harmony import */ var _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(89917);\n/* harmony import */ var _SceneTransforms_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(48244);\n/* harmony import */ var _TweenCollection_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(74476);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Modifies the camera position and orientation based on mouse input to a canvas.\n * @alias ScreenSpaceCameraController\n * @constructor\n *\n * @param {Scene} scene The scene.\n */\nfunction ScreenSpaceCameraController(scene) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(scene)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z("scene is required.");\n  }\n  //>>includeEnd(\'debug\');\n\n  /**\n   * If true, inputs are allowed conditionally with the flags enableTranslate, enableZoom,\n   * enableRotate, enableTilt, and enableLook.  If false, all inputs are disabled.\n   *\n   * NOTE: This setting is for temporary use cases, such as camera flights and\n   * drag-selection of regions (see Picking demo).  It is typically set to false at the\n   * start of such events, and set true on completion.  To keep inputs disabled\n   * past the end of camera flights, you must use the other booleans (enableTranslate,\n   * enableZoom, enableRotate, enableTilt, and enableLook).\n   * @type {Boolean}\n   * @default true\n   */\n  this.enableInputs = true;\n  /**\n   * If true, allows the user to pan around the map.  If false, the camera stays locked at the current position.\n   * This flag only applies in 2D and Columbus view modes.\n   * @type {Boolean}\n   * @default true\n   */\n  this.enableTranslate = true;\n  /**\n   * If true, allows the user to zoom in and out.  If false, the camera is locked to the current distance from the ellipsoid.\n   * @type {Boolean}\n   * @default true\n   */\n  this.enableZoom = true;\n  /**\n   * If true, allows the user to rotate the world which translates the user\'s position.\n   * This flag only applies in 2D and 3D.\n   * @type {Boolean}\n   * @default true\n   */\n  this.enableRotate = true;\n  /**\n   * If true, allows the user to tilt the camera.  If false, the camera is locked to the current heading.\n   * This flag only applies in 3D and Columbus view.\n   * @type {Boolean}\n   * @default true\n   */\n  this.enableTilt = true;\n  /**\n   * If true, allows the user to use free-look. If false, the camera view direction can only be changed through translating\n   * or rotating. This flag only applies in 3D and Columbus view modes.\n   * @type {Boolean}\n   * @default true\n   */\n  this.enableLook = true;\n  /**\n   * A parameter in the range <code>[0, 1)</code> used to determine how long\n   * the camera will continue to spin because of inertia.\n   * With value of zero, the camera will have no inertia.\n   * @type {Number}\n   * @default 0.9\n   */\n  this.inertiaSpin = 0.9;\n  /**\n   * A parameter in the range <code>[0, 1)</code> used to determine how long\n   * the camera will continue to translate because of inertia.\n   * With value of zero, the camera will have no inertia.\n   * @type {Number}\n   * @default 0.9\n   */\n  this.inertiaTranslate = 0.9;\n  /**\n   * A parameter in the range <code>[0, 1)</code> used to determine how long\n   * the camera will continue to zoom because of inertia.\n   * With value of zero, the camera will have no inertia.\n   * @type {Number}\n   * @default 0.8\n   */\n  this.inertiaZoom = 0.8;\n  /**\n   * A parameter in the range <code>[0, 1)</code> used to limit the range\n   * of various user inputs to a percentage of the window width/height per animation frame.\n   * This helps keep the camera under control in low-frame-rate situations.\n   * @type {Number}\n   * @default 0.1\n   */\n  this.maximumMovementRatio = 0.1;\n  /**\n   * Sets the duration, in seconds, of the bounce back animations in 2D and Columbus view.\n   * @type {Number}\n   * @default 3.0\n   */\n  this.bounceAnimationTime = 3.0;\n  /**\n   * The minimum magnitude, in meters, of the camera position when zooming. Defaults to 1.0.\n   * @type {Number}\n   * @default 1.0\n   */\n  this.minimumZoomDistance = 1.0;\n  /**\n   * The maximum magnitude, in meters, of the camera position when zooming. Defaults to positive infinity.\n   * @type {Number}\n   * @default {@link Number.POSITIVE_INFINITY}\n   */\n  this.maximumZoomDistance = Number.POSITIVE_INFINITY;\n  /**\n   * The input that allows the user to pan around the map. This only applies in 2D and Columbus view modes.\n   * <p>\n   * The type came be a {@link CameraEventType}, <code>undefined</code>, an object with <code>eventType</code>\n   * and <code>modifier</code> properties with types <code>CameraEventType</code> and {@link KeyboardEventModifier},\n   * or an array of any of the preceding.\n   * </p>\n   * @type {CameraEventType|Array|undefined}\n   * @default {@link CameraEventType.LEFT_DRAG}\n   */\n  this.translateEventTypes = _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].LEFT_DRAG */ .Z.LEFT_DRAG;\n  /**\n   * The input that allows the user to zoom in/out.\n   * <p>\n   * The type came be a {@link CameraEventType}, <code>undefined</code>, an object with <code>eventType</code>\n   * and <code>modifier</code> properties with types <code>CameraEventType</code> and {@link KeyboardEventModifier},\n   * or an array of any of the preceding.\n   * </p>\n   * @type {CameraEventType|Array|undefined}\n   * @default [{@link CameraEventType.RIGHT_DRAG}, {@link CameraEventType.WHEEL}, {@link CameraEventType.PINCH}]\n   */\n  this.zoomEventTypes = [\n    _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].RIGHT_DRAG */ .Z.RIGHT_DRAG,\n    _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].WHEEL */ .Z.WHEEL,\n    _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].PINCH */ .Z.PINCH,\n  ];\n  /**\n   * The input that allows the user to rotate around the globe or another object. This only applies in 3D and Columbus view modes.\n   * <p>\n   * The type came be a {@link CameraEventType}, <code>undefined</code>, an object with <code>eventType</code>\n   * and <code>modifier</code> properties with types <code>CameraEventType</code> and {@link KeyboardEventModifier},\n   * or an array of any of the preceding.\n   * </p>\n   * @type {CameraEventType|Array|undefined}\n   * @default {@link CameraEventType.LEFT_DRAG}\n   */\n  this.rotateEventTypes = _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].LEFT_DRAG */ .Z.LEFT_DRAG;\n  /**\n   * The input that allows the user to tilt in 3D and Columbus view or twist in 2D.\n   * <p>\n   * The type came be a {@link CameraEventType}, <code>undefined</code>, an object with <code>eventType</code>\n   * and <code>modifier</code> properties with types <code>CameraEventType</code> and {@link KeyboardEventModifier},\n   * or an array of any of the preceding.\n   * </p>\n   * @type {CameraEventType|Array|undefined}\n   * @default [{@link CameraEventType.MIDDLE_DRAG}, {@link CameraEventType.PINCH}, {\n   *     eventType : {@link CameraEventType.LEFT_DRAG},\n   *     modifier : {@link KeyboardEventModifier.CTRL}\n   * }, {\n   *     eventType : {@link CameraEventType.RIGHT_DRAG},\n   *     modifier : {@link KeyboardEventModifier.CTRL}\n   * }]\n   */\n  this.tiltEventTypes = [\n    _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].MIDDLE_DRAG */ .Z.MIDDLE_DRAG,\n    _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].PINCH */ .Z.PINCH,\n    {\n      eventType: _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].LEFT_DRAG */ .Z.LEFT_DRAG,\n      modifier: _Core_KeyboardEventModifier_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].CTRL */ .Z.CTRL,\n    },\n    {\n      eventType: _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].RIGHT_DRAG */ .Z.RIGHT_DRAG,\n      modifier: _Core_KeyboardEventModifier_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].CTRL */ .Z.CTRL,\n    },\n  ];\n  /**\n   * The input that allows the user to change the direction the camera is viewing. This only applies in 3D and Columbus view modes.\n   * <p>\n   * The type came be a {@link CameraEventType}, <code>undefined</code>, an object with <code>eventType</code>\n   * and <code>modifier</code> properties with types <code>CameraEventType</code> and {@link KeyboardEventModifier},\n   * or an array of any of the preceding.\n   * </p>\n   * @type {CameraEventType|Array|undefined}\n   * @default { eventType : {@link CameraEventType.LEFT_DRAG}, modifier : {@link KeyboardEventModifier.SHIFT} }\n   */\n  this.lookEventTypes = {\n    eventType: _CameraEventType_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].LEFT_DRAG */ .Z.LEFT_DRAG,\n    modifier: _Core_KeyboardEventModifier_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].SHIFT */ .Z.SHIFT,\n  };\n  /**\n   * The minimum height the camera must be before picking the terrain instead of the ellipsoid.\n   * @type {Number}\n   * @default 150000.0\n   */\n  this.minimumPickingTerrainHeight = 150000.0;\n  this._minimumPickingTerrainHeight = this.minimumPickingTerrainHeight;\n  /**\n   * The minimum height the camera must be before testing for collision with terrain.\n   * @type {Number}\n   * @default 15000.0\n   */\n  this.minimumCollisionTerrainHeight = 15000.0;\n  this._minimumCollisionTerrainHeight = this.minimumCollisionTerrainHeight;\n  /**\n   * The minimum height the camera must be before switching from rotating a track ball to\n   * free look when clicks originate on the sky or in space.\n   * @type {Number}\n   * @default 7500000.0\n   */\n  this.minimumTrackBallHeight = 7500000.0;\n  this._minimumTrackBallHeight = this.minimumTrackBallHeight;\n  /**\n   * Enables or disables camera collision detection with terrain.\n   * @type {Boolean}\n   * @default true\n   */\n  this.enableCollisionDetection = true;\n\n  this._scene = scene;\n  this._globe = undefined;\n  this._ellipsoid = undefined;\n\n  this._aggregator = new _CameraEventAggregator_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"] */ .Z(scene.canvas);\n\n  this._lastInertiaSpinMovement = undefined;\n  this._lastInertiaZoomMovement = undefined;\n  this._lastInertiaTranslateMovement = undefined;\n  this._lastInertiaTiltMovement = undefined;\n\n  // Zoom disables tilt, spin, and translate inertia\n  // Tilt disables spin and translate inertia\n  this._inertiaDisablers = {\n    _lastInertiaZoomMovement: [\n      "_lastInertiaSpinMovement",\n      "_lastInertiaTranslateMovement",\n      "_lastInertiaTiltMovement",\n    ],\n    _lastInertiaTiltMovement: [\n      "_lastInertiaSpinMovement",\n      "_lastInertiaTranslateMovement",\n    ],\n  };\n\n  this._tweens = new _TweenCollection_js__WEBPACK_IMPORTED_MODULE_25__/* ["default"] */ .Z();\n  this._tween = undefined;\n\n  this._horizontalRotationAxis = undefined;\n\n  this._tiltCenterMousePosition = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z(-1.0, -1.0);\n  this._tiltCenter = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n  this._rotateMousePosition = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z(-1.0, -1.0);\n  this._rotateStartPosition = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n  this._strafeStartPosition = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n  this._strafeMousePosition = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n  this._strafeEndMousePosition = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n  this._zoomMouseStart = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z(-1.0, -1.0);\n  this._zoomWorldPosition = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n  this._useZoomWorldPosition = false;\n  this._tiltCVOffMap = false;\n  this._looking = false;\n  this._rotating = false;\n  this._strafing = false;\n  this._zoomingOnVector = false;\n  this._zoomingUnderground = false;\n  this._rotatingZoom = false;\n  this._adjustedHeightForTerrain = false;\n  this._cameraUnderground = false;\n\n  var projection = scene.mapProjection;\n  this._maxCoord = projection.project(\n    new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z(Math.PI, _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].PI_OVER_TWO */ .Z.PI_OVER_TWO)\n  );\n\n  // Constants, Make any of these public?\n  this._zoomFactor = 5.0;\n  this._rotateFactor = undefined;\n  this._rotateRateRangeAdjustment = undefined;\n  this._maximumRotateRate = 1.77;\n  this._minimumRotateRate = 1.0 / 5000.0;\n  this._minimumZoomRate = 20.0;\n  this._maximumZoomRate = 5906376272000.0; // distance from the Sun to Pluto in meters.\n  this._minimumUndergroundPickDistance = 2000.0;\n  this._maximumUndergroundPickDistance = 10000.0;\n}\n\nfunction decay(time, coefficient) {\n  if (time < 0) {\n    return 0.0;\n  }\n\n  var tau = (1.0 - coefficient) * 25.0;\n  return Math.exp(-tau * time);\n}\n\nfunction sameMousePosition(movement) {\n  return _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equalsEpsilon */ .Z.equalsEpsilon(\n    movement.startPosition,\n    movement.endPosition,\n    _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON14 */ .Z.EPSILON14\n  );\n}\n\n// If the time between mouse down and mouse up is not between\n// these thresholds, the camera will not move with inertia.\n// This value is probably dependent on the browser and/or the\n// hardware. Should be investigated further.\nvar inertiaMaxClickTimeThreshold = 0.4;\n\nfunction maintainInertia(\n  aggregator,\n  type,\n  modifier,\n  decayCoef,\n  action,\n  object,\n  lastMovementName\n) {\n  var movementState = object[lastMovementName];\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(movementState)) {\n    movementState = object[lastMovementName] = {\n      startPosition: new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z(),\n      endPosition: new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z(),\n      motion: new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z(),\n      inertiaEnabled: true,\n    };\n  }\n\n  var ts = aggregator.getButtonPressTime(type, modifier);\n  var tr = aggregator.getButtonReleaseTime(type, modifier);\n\n  var threshold = ts && tr && (tr.getTime() - ts.getTime()) / 1000.0;\n  var now = new Date();\n  var fromNow = tr && (now.getTime() - tr.getTime()) / 1000.0;\n\n  if (ts && tr && threshold < inertiaMaxClickTimeThreshold) {\n    var d = decay(fromNow, decayCoef);\n\n    var lastMovement = aggregator.getLastMovement(type, modifier);\n    if (\n      !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(lastMovement) ||\n      sameMousePosition(lastMovement) ||\n      !movementState.inertiaEnabled\n    ) {\n      return;\n    }\n\n    movementState.motion.x =\n      (lastMovement.endPosition.x - lastMovement.startPosition.x) * 0.5;\n    movementState.motion.y =\n      (lastMovement.endPosition.y - lastMovement.startPosition.y) * 0.5;\n\n    movementState.startPosition = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(\n      lastMovement.startPosition,\n      movementState.startPosition\n    );\n\n    movementState.endPosition = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n      movementState.motion,\n      d,\n      movementState.endPosition\n    );\n    movementState.endPosition = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].add */ .Z.add(\n      movementState.startPosition,\n      movementState.endPosition,\n      movementState.endPosition\n    );\n\n    // If value from the decreasing exponential function is close to zero,\n    // the end coordinates may be NaN.\n    if (\n      isNaN(movementState.endPosition.x) ||\n      isNaN(movementState.endPosition.y) ||\n      _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].distance */ .Z.distance(\n        movementState.startPosition,\n        movementState.endPosition\n      ) < 0.5\n    ) {\n      return;\n    }\n\n    if (!aggregator.isButtonDown(type, modifier)) {\n      var startPosition = aggregator.getStartMousePosition(type, modifier);\n      action(object, startPosition, movementState);\n    }\n  }\n}\n\nfunction activateInertia(controller, inertiaStateName) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(inertiaStateName)) {\n    // Re-enable inertia if it was disabled\n    var movementState = controller[inertiaStateName];\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(movementState)) {\n      movementState.inertiaEnabled = true;\n    }\n    // Disable inertia on other movements\n    var inertiasToDisable = controller._inertiaDisablers[inertiaStateName];\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(inertiasToDisable)) {\n      var length = inertiasToDisable.length;\n      for (var i = 0; i < length; ++i) {\n        movementState = controller[inertiasToDisable[i]];\n        if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(movementState)) {\n          movementState.inertiaEnabled = false;\n        }\n      }\n    }\n  }\n}\n\nvar scratchEventTypeArray = [];\n\nfunction reactToInput(\n  controller,\n  enabled,\n  eventTypes,\n  action,\n  inertiaConstant,\n  inertiaStateName\n) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(eventTypes)) {\n    return;\n  }\n\n  var aggregator = controller._aggregator;\n\n  if (!Array.isArray(eventTypes)) {\n    scratchEventTypeArray[0] = eventTypes;\n    eventTypes = scratchEventTypeArray;\n  }\n\n  var length = eventTypes.length;\n  for (var i = 0; i < length; ++i) {\n    var eventType = eventTypes[i];\n    var type = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(eventType.eventType) ? eventType.eventType : eventType;\n    var modifier = eventType.modifier;\n\n    var movement =\n      aggregator.isMoving(type, modifier) &&\n      aggregator.getMovement(type, modifier);\n    var startPosition = aggregator.getStartMousePosition(type, modifier);\n\n    if (controller.enableInputs && enabled) {\n      if (movement) {\n        action(controller, startPosition, movement);\n        activateInertia(controller, inertiaStateName);\n      } else if (inertiaConstant < 1.0) {\n        maintainInertia(\n          aggregator,\n          type,\n          modifier,\n          inertiaConstant,\n          action,\n          controller,\n          inertiaStateName\n        );\n      }\n    }\n  }\n}\n\nvar scratchZoomPickRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar scratchPickCartesian = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchZoomOffset = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar scratchZoomDirection = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCenterPixel = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar scratchCenterPosition = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchPositionNormal = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchPickNormal = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchZoomAxis = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCameraPositionNormal = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\n// Scratch variables used in zooming algorithm\nvar scratchTargetNormal = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCameraPosition = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCameraUpNormal = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCameraRightNormal = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchForwardNormal = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchPositionToTarget = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchPositionToTargetNormal = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchPan = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCenterMovement = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCenter = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCartesian = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCartesianTwo = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCartesianThree = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchZoomViewOptions = {\n  orientation: new _Core_HeadingPitchRoll_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z(),\n};\n\nfunction handleZoom(\n  object,\n  startPosition,\n  movement,\n  zoomFactor,\n  distanceMeasure,\n  unitPositionDotDirection\n) {\n  var percentage = 1.0;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(unitPositionDotDirection)) {\n    percentage = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clamp */ .Z.clamp(\n      Math.abs(unitPositionDotDirection),\n      0.25,\n      1.0\n    );\n  }\n\n  // distanceMeasure should be the height above the ellipsoid.\n  // The zoomRate slows as it approaches the surface and stops minimumZoomDistance above it.\n  var minHeight = object.minimumZoomDistance * percentage;\n  var maxHeight = object.maximumZoomDistance;\n\n  var minDistance = distanceMeasure - minHeight;\n  var zoomRate = zoomFactor * minDistance;\n  zoomRate = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clamp */ .Z.clamp(\n    zoomRate,\n    object._minimumZoomRate,\n    object._maximumZoomRate\n  );\n\n  var diff = movement.endPosition.y - movement.startPosition.y;\n  var rangeWindowRatio = diff / object._scene.canvas.clientHeight;\n  rangeWindowRatio = Math.min(rangeWindowRatio, object.maximumMovementRatio);\n  var distance = zoomRate * rangeWindowRatio;\n\n  if (\n    object.enableCollisionDetection ||\n    object.minimumZoomDistance === 0.0 ||\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(object._globe) // look-at mode\n  ) {\n    if (distance > 0.0 && Math.abs(distanceMeasure - minHeight) < 1.0) {\n      return;\n    }\n\n    if (distance < 0.0 && Math.abs(distanceMeasure - maxHeight) < 1.0) {\n      return;\n    }\n\n    if (distanceMeasure - distance < minHeight) {\n      distance = distanceMeasure - minHeight - 1.0;\n    } else if (distanceMeasure - distance > maxHeight) {\n      distance = distanceMeasure - maxHeight;\n    }\n  }\n\n  var scene = object._scene;\n  var camera = scene.camera;\n  var mode = scene.mode;\n\n  var orientation = scratchZoomViewOptions.orientation;\n  orientation.heading = camera.heading;\n  orientation.pitch = camera.pitch;\n  orientation.roll = camera.roll;\n\n  if (camera.frustum instanceof _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"] */ .Z) {\n    if (Math.abs(distance) > 0.0) {\n      camera.zoomIn(distance);\n      camera._adjustOrthographicFrustum();\n    }\n    return;\n  }\n\n  var sameStartPosition = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(\n    startPosition,\n    object._zoomMouseStart\n  );\n  var zoomingOnVector = object._zoomingOnVector;\n  var rotatingZoom = object._rotatingZoom;\n  var pickedPosition;\n\n  if (!sameStartPosition) {\n    object._zoomMouseStart = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(\n      startPosition,\n      object._zoomMouseStart\n    );\n\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(object._globe)) {\n      if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].SCENE2D */ .Z.SCENE2D) {\n        pickedPosition = camera.getPickRay(startPosition, scratchZoomPickRay)\n          .origin;\n        pickedPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(\n          pickedPosition.y,\n          pickedPosition.z,\n          pickedPosition.x\n        );\n      } else {\n        pickedPosition = pickGlobe(object, startPosition, scratchPickCartesian);\n      }\n    }\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(pickedPosition)) {\n      object._useZoomWorldPosition = true;\n      object._zoomWorldPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(\n        pickedPosition,\n        object._zoomWorldPosition\n      );\n    } else {\n      object._useZoomWorldPosition = false;\n    }\n\n    zoomingOnVector = object._zoomingOnVector = false;\n    rotatingZoom = object._rotatingZoom = false;\n    object._zoomingUnderground = object._cameraUnderground;\n  }\n\n  if (!object._useZoomWorldPosition) {\n    camera.zoomIn(distance);\n    return;\n  }\n\n  var zoomOnVector = mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW;\n\n  if (camera.positionCartographic.height < 2000000) {\n    rotatingZoom = true;\n  }\n\n  if (!sameStartPosition || rotatingZoom) {\n    if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].SCENE2D */ .Z.SCENE2D) {\n      var worldPosition = object._zoomWorldPosition;\n      var endPosition = camera.position;\n\n      if (\n        !_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(worldPosition, endPosition) &&\n        camera.positionCartographic.height < object._maxCoord.x * 2.0\n      ) {\n        var savedX = camera.position.x;\n\n        var direction = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(\n          worldPosition,\n          endPosition,\n          scratchZoomDirection\n        );\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(direction, direction);\n\n        var d =\n          (_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].distance */ .Z.distance(worldPosition, endPosition) * distance) /\n          (camera.getMagnitude() * 0.5);\n        camera.move(direction, d * 0.5);\n\n        if (\n          (camera.position.x < 0.0 && savedX > 0.0) ||\n          (camera.position.x > 0.0 && savedX < 0.0)\n        ) {\n          pickedPosition = camera.getPickRay(startPosition, scratchZoomPickRay)\n            .origin;\n          pickedPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(\n            pickedPosition.y,\n            pickedPosition.z,\n            pickedPosition.x\n          );\n          object._zoomWorldPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(\n            pickedPosition,\n            object._zoomWorldPosition\n          );\n        }\n      }\n    } else if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n      var cameraPositionNormal = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(\n        camera.position,\n        scratchCameraPositionNormal\n      );\n      if (\n        object._cameraUnderground ||\n        object._zoomingUnderground ||\n        (camera.positionCartographic.height < 3000.0 &&\n          Math.abs(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(camera.direction, cameraPositionNormal)) <\n            0.6)\n      ) {\n        zoomOnVector = true;\n      } else {\n        var canvas = scene.canvas;\n\n        var centerPixel = scratchCenterPixel;\n        centerPixel.x = canvas.clientWidth / 2;\n        centerPixel.y = canvas.clientHeight / 2;\n        var centerPosition = pickGlobe(\n          object,\n          centerPixel,\n          scratchCenterPosition\n        );\n        // If centerPosition is not defined, it means the globe does not cover the center position of screen\n\n        if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(centerPosition)) {\n          zoomOnVector = true;\n        } else if (camera.positionCartographic.height < 1000000) {\n          // The math in the else block assumes the camera\n          // points toward the earth surface, so we check it here.\n          // Theoretically, we should check for 90 degree, but it doesn\'t behave well when parallel\n          // to the earth surface\n          if (_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(camera.direction, cameraPositionNormal) >= -0.5) {\n            zoomOnVector = true;\n          } else {\n            var cameraPosition = scratchCameraPosition;\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(camera.position, cameraPosition);\n            var target = object._zoomWorldPosition;\n\n            var targetNormal = scratchTargetNormal;\n\n            targetNormal = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(target, targetNormal);\n\n            if (_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(targetNormal, cameraPositionNormal) < 0.0) {\n              return;\n            }\n\n            var center = scratchCenter;\n            var forward = scratchForwardNormal;\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(camera.direction, forward);\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(\n              cameraPosition,\n              _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(forward, 1000, scratchCartesian),\n              center\n            );\n\n            var positionToTarget = scratchPositionToTarget;\n            var positionToTargetNormal = scratchPositionToTargetNormal;\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(target, cameraPosition, positionToTarget);\n\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(positionToTarget, positionToTargetNormal);\n\n            var alphaDot = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(\n              cameraPositionNormal,\n              positionToTargetNormal\n            );\n            if (alphaDot >= 0.0) {\n              // We zoomed past the target, and this zoom is not valid anymore.\n              // This line causes the next zoom movement to pick a new starting point.\n              object._zoomMouseStart.x = -1;\n              return;\n            }\n            var alpha = Math.acos(-alphaDot);\n            var cameraDistance = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(cameraPosition);\n            var targetDistance = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(target);\n            var remainingDistance = cameraDistance - distance;\n            var positionToTargetDistance = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(\n              positionToTarget\n            );\n\n            var gamma = Math.asin(\n              _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clamp */ .Z.clamp(\n                (positionToTargetDistance / targetDistance) * Math.sin(alpha),\n                -1.0,\n                1.0\n              )\n            );\n            var delta = Math.asin(\n              _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clamp */ .Z.clamp(\n                (remainingDistance / targetDistance) * Math.sin(alpha),\n                -1.0,\n                1.0\n              )\n            );\n            var beta = gamma - delta + alpha;\n\n            var up = scratchCameraUpNormal;\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(cameraPosition, up);\n            var right = scratchCameraRightNormal;\n            right = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(positionToTargetNormal, up, right);\n            right = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(right, right);\n\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(\n              _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(up, right, scratchCartesian),\n              forward\n            );\n\n            // Calculate new position to move to\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n              _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(center, scratchCartesian),\n              _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(center) - distance,\n              center\n            );\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(cameraPosition, cameraPosition);\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n              cameraPosition,\n              remainingDistance,\n              cameraPosition\n            );\n\n            // Pan\n            var pMid = scratchPan;\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n              _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(\n                _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n                  up,\n                  Math.cos(beta) - 1,\n                  scratchCartesianTwo\n                ),\n                _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n                  forward,\n                  Math.sin(beta),\n                  scratchCartesianThree\n                ),\n                scratchCartesian\n              ),\n              remainingDistance,\n              pMid\n            );\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(cameraPosition, pMid, cameraPosition);\n\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(center, up);\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(\n              _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(up, right, scratchCartesian),\n              forward\n            );\n\n            var cMid = scratchCenterMovement;\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n              _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(\n                _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n                  up,\n                  Math.cos(beta) - 1,\n                  scratchCartesianTwo\n                ),\n                _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n                  forward,\n                  Math.sin(beta),\n                  scratchCartesianThree\n                ),\n                scratchCartesian\n              ),\n              _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(center),\n              cMid\n            );\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(center, cMid, center);\n\n            // Update camera\n\n            // Set new position\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(cameraPosition, camera.position);\n\n            // Set new direction\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(\n              _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(center, cameraPosition, scratchCartesian),\n              camera.direction\n            );\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(camera.direction, camera.direction);\n\n            // Set new right & up vectors\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(camera.direction, camera.up, camera.right);\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(camera.right, camera.direction, camera.up);\n\n            camera.setView(scratchZoomViewOptions);\n            return;\n          }\n        } else {\n          var positionNormal = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(\n            centerPosition,\n            scratchPositionNormal\n          );\n          var pickedNormal = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(\n            object._zoomWorldPosition,\n            scratchPickNormal\n          );\n          var dotProduct = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(pickedNormal, positionNormal);\n\n          if (dotProduct > 0.0 && dotProduct < 1.0) {\n            var angle = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].acosClamped */ .Z.acosClamped(dotProduct);\n            var axis = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(\n              pickedNormal,\n              positionNormal,\n              scratchZoomAxis\n            );\n\n            var denom =\n              Math.abs(angle) > _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].toRadians */ .Z.toRadians(20.0)\n                ? camera.positionCartographic.height * 0.75\n                : camera.positionCartographic.height - distance;\n            var scalar = distance / denom;\n            camera.rotate(axis, angle * scalar);\n          }\n        }\n      }\n    }\n\n    object._rotatingZoom = !zoomOnVector;\n  }\n\n  if ((!sameStartPosition && zoomOnVector) || zoomingOnVector) {\n    var ray;\n    var zoomMouseStart = _SceneTransforms_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].wgs84ToWindowCoordinates */ .Z.wgs84ToWindowCoordinates(\n      scene,\n      object._zoomWorldPosition,\n      scratchZoomOffset\n    );\n    if (\n      mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW &&\n      _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(startPosition, object._zoomMouseStart) &&\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(zoomMouseStart)\n    ) {\n      ray = camera.getPickRay(zoomMouseStart, scratchZoomPickRay);\n    } else {\n      ray = camera.getPickRay(startPosition, scratchZoomPickRay);\n    }\n\n    var rayDirection = ray.direction;\n    if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW || mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].SCENE2D */ .Z.SCENE2D) {\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(\n        rayDirection.y,\n        rayDirection.z,\n        rayDirection.x,\n        rayDirection\n      );\n    }\n\n    camera.move(rayDirection, distance);\n\n    object._zoomingOnVector = true;\n  } else {\n    camera.zoomIn(distance);\n  }\n\n  if (!object._cameraUnderground) {\n    camera.setView(scratchZoomViewOptions);\n  }\n}\n\nvar translate2DStart = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar translate2DEnd = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar scratchTranslateP0 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\nfunction translate2D(controller, startPosition, movement) {\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var start = camera.getPickRay(movement.startPosition, translate2DStart)\n    .origin;\n  var end = camera.getPickRay(movement.endPosition, translate2DEnd).origin;\n\n  start = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(start.y, start.z, start.x, start);\n  end = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(end.y, end.z, end.x, end);\n\n  var direction = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(start, end, scratchTranslateP0);\n  var distance = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(direction);\n\n  if (distance > 0.0) {\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(direction, direction);\n    camera.move(direction, distance);\n  }\n}\n\nfunction zoom2D(controller, startPosition, movement) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(movement.distance)) {\n    movement = movement.distance;\n  }\n\n  var scene = controller._scene;\n  var camera = scene.camera;\n\n  handleZoom(\n    controller,\n    startPosition,\n    movement,\n    controller._zoomFactor,\n    camera.getMagnitude()\n  );\n}\n\nvar twist2DStart = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar twist2DEnd = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n\nfunction twist2D(controller, startPosition, movement) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(movement.angleAndHeight)) {\n    singleAxisTwist2D(controller, startPosition, movement.angleAndHeight);\n    return;\n  }\n\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var canvas = scene.canvas;\n  var width = canvas.clientWidth;\n  var height = canvas.clientHeight;\n\n  var start = twist2DStart;\n  start.x = (2.0 / width) * movement.startPosition.x - 1.0;\n  start.y = (2.0 / height) * (height - movement.startPosition.y) - 1.0;\n  start = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].normalize */ .Z.normalize(start, start);\n\n  var end = twist2DEnd;\n  end.x = (2.0 / width) * movement.endPosition.x - 1.0;\n  end.y = (2.0 / height) * (height - movement.endPosition.y) - 1.0;\n  end = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].normalize */ .Z.normalize(end, end);\n\n  var startTheta = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].acosClamped */ .Z.acosClamped(start.x);\n  if (start.y < 0) {\n    startTheta = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].TWO_PI */ .Z.TWO_PI - startTheta;\n  }\n  var endTheta = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].acosClamped */ .Z.acosClamped(end.x);\n  if (end.y < 0) {\n    endTheta = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].TWO_PI */ .Z.TWO_PI - endTheta;\n  }\n  var theta = endTheta - startTheta;\n\n  camera.twistRight(theta);\n}\n\nfunction singleAxisTwist2D(controller, startPosition, movement) {\n  var rotateRate =\n    controller._rotateFactor * controller._rotateRateRangeAdjustment;\n\n  if (rotateRate > controller._maximumRotateRate) {\n    rotateRate = controller._maximumRotateRate;\n  }\n\n  if (rotateRate < controller._minimumRotateRate) {\n    rotateRate = controller._minimumRotateRate;\n  }\n\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var canvas = scene.canvas;\n\n  var phiWindowRatio =\n    (movement.endPosition.x - movement.startPosition.x) / canvas.clientWidth;\n  phiWindowRatio = Math.min(phiWindowRatio, controller.maximumMovementRatio);\n\n  var deltaPhi = rotateRate * phiWindowRatio * Math.PI * 4.0;\n\n  camera.twistRight(deltaPhi);\n}\n\nfunction update2D(controller) {\n  var rotatable2D = controller._scene.mapMode2D === _MapMode2D_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"].ROTATE */ .Z.ROTATE;\n  if (!_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].equals */ .Z.equals(_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].IDENTITY */ .Z.IDENTITY, controller._scene.camera.transform)) {\n    reactToInput(\n      controller,\n      controller.enableZoom,\n      controller.zoomEventTypes,\n      zoom2D,\n      controller.inertiaZoom,\n      "_lastInertiaZoomMovement"\n    );\n    if (rotatable2D) {\n      reactToInput(\n        controller,\n        controller.enableRotate,\n        controller.translateEventTypes,\n        twist2D,\n        controller.inertiaSpin,\n        "_lastInertiaSpinMovement"\n      );\n    }\n  } else {\n    reactToInput(\n      controller,\n      controller.enableTranslate,\n      controller.translateEventTypes,\n      translate2D,\n      controller.inertiaTranslate,\n      "_lastInertiaTranslateMovement"\n    );\n    reactToInput(\n      controller,\n      controller.enableZoom,\n      controller.zoomEventTypes,\n      zoom2D,\n      controller.inertiaZoom,\n      "_lastInertiaZoomMovement"\n    );\n    if (rotatable2D) {\n      reactToInput(\n        controller,\n        controller.enableRotate,\n        controller.tiltEventTypes,\n        twist2D,\n        controller.inertiaSpin,\n        "_lastInertiaTiltMovement"\n      );\n    }\n  }\n}\n\nvar pickGlobeScratchRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar scratchDepthIntersection = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchRayIntersection = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\nfunction pickGlobe(controller, mousePosition, result) {\n  var scene = controller._scene;\n  var globe = controller._globe;\n  var camera = scene.camera;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(globe)) {\n    return undefined;\n  }\n\n  var cullBackFaces = !controller._cameraUnderground;\n\n  var depthIntersection;\n  if (scene.pickPositionSupported) {\n    depthIntersection = scene.pickPositionWorldCoordinates(\n      mousePosition,\n      scratchDepthIntersection\n    );\n  }\n\n  var ray = camera.getPickRay(mousePosition, pickGlobeScratchRay);\n  var rayIntersection = globe.pickWorldCoordinates(\n    ray,\n    scene,\n    cullBackFaces,\n    scratchRayIntersection\n  );\n\n  var pickDistance = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(depthIntersection)\n    ? _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].distance */ .Z.distance(depthIntersection, camera.positionWC)\n    : Number.POSITIVE_INFINITY;\n  var rayDistance = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(rayIntersection)\n    ? _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].distance */ .Z.distance(rayIntersection, camera.positionWC)\n    : Number.POSITIVE_INFINITY;\n\n  if (pickDistance < rayDistance) {\n    return _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(depthIntersection, result);\n  }\n\n  return _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(rayIntersection, result);\n}\n\nvar scratchDistanceCartographic = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\n\nfunction getDistanceFromSurface(controller) {\n  var ellipsoid = controller._ellipsoid;\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var mode = scene.mode;\n\n  var height = 0.0;\n  if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    var cartographic = ellipsoid.cartesianToCartographic(\n      camera.position,\n      scratchDistanceCartographic\n    );\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(cartographic)) {\n      height = cartographic.height;\n    }\n  } else {\n    height = camera.position.z;\n  }\n  var globeHeight = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z)(controller._scene.globeHeight, 0.0);\n  var distanceFromSurface = Math.abs(globeHeight - height);\n  return distanceFromSurface;\n}\n\nvar scratchSurfaceNormal = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\nfunction getZoomDistanceUnderground(controller, ray) {\n  var origin = ray.origin;\n  var direction = ray.direction;\n  var distanceFromSurface = getDistanceFromSurface(controller);\n\n  // Weight zoom distance based on how strongly the pick ray is pointing inward.\n  // Geocentric normal is accurate enough for these purposes\n  var surfaceNormal = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(origin, scratchSurfaceNormal);\n  var strength = Math.abs(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(surfaceNormal, direction));\n  strength = Math.max(strength, 0.5) * 2.0;\n  return distanceFromSurface * strength;\n}\n\nfunction getTiltCenterUnderground(controller, ray, pickedPosition, result) {\n  var distance = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].distance */ .Z.distance(ray.origin, pickedPosition);\n  var distanceFromSurface = getDistanceFromSurface(controller);\n\n  var maximumDistance = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clamp */ .Z.clamp(\n    distanceFromSurface * 5.0,\n    controller._minimumUndergroundPickDistance,\n    controller._maximumUndergroundPickDistance\n  );\n\n  if (distance > maximumDistance) {\n    // Simulate look-at behavior by tilting around a small invisible sphere\n    distance = Math.min(distance, distanceFromSurface / 5.0);\n    distance = Math.max(distance, 100.0);\n  }\n\n  return _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].getPoint */ .Z.getPoint(ray, distance, result);\n}\n\nfunction getStrafeStartPositionUnderground(\n  controller,\n  ray,\n  pickedPosition,\n  result\n) {\n  var distance;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(pickedPosition)) {\n    distance = getDistanceFromSurface(controller);\n  } else {\n    distance = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].distance */ .Z.distance(ray.origin, pickedPosition);\n    if (distance > controller._maximumUndergroundPickDistance) {\n      // If the picked position is too far away set the strafe speed based on the\n      // camera\'s height from the globe surface\n      distance = getDistanceFromSurface(controller);\n    }\n  }\n\n  return _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].getPoint */ .Z.getPoint(ray, distance, result);\n}\n\nvar scratchInertialDelta = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n\nfunction continueStrafing(controller, movement) {\n  // Update the end position continually based on the inertial delta\n  var originalEndPosition = movement.endPosition;\n  var inertialDelta = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].subtract */ .Z.subtract(\n    movement.endPosition,\n    movement.startPosition,\n    scratchInertialDelta\n  );\n  var endPosition = controller._strafeEndMousePosition;\n  _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].add */ .Z.add(endPosition, inertialDelta, endPosition);\n  movement.endPosition = endPosition;\n  strafe(controller, movement, controller._strafeStartPosition);\n  movement.endPosition = originalEndPosition;\n}\n\nvar translateCVStartRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar translateCVEndRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar translateCVStartPos = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar translateCVEndPos = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar translateCVDifference = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar translateCVOrigin = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar translateCVPlane = new _Core_Plane_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_X */ .Z.UNIT_X, 0.0);\nvar translateCVStartMouse = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar translateCVEndMouse = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n\nfunction translateCV(controller, startPosition, movement) {\n  if (!_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(startPosition, controller._translateMousePosition)) {\n    controller._looking = false;\n  }\n\n  if (!_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(startPosition, controller._strafeMousePosition)) {\n    controller._strafing = false;\n  }\n\n  if (controller._looking) {\n    look3D(controller, startPosition, movement);\n    return;\n  }\n\n  if (controller._strafing) {\n    continueStrafing(controller, movement);\n    return;\n  }\n\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var cameraUnderground = controller._cameraUnderground;\n  var startMouse = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(\n    movement.startPosition,\n    translateCVStartMouse\n  );\n  var endMouse = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(movement.endPosition, translateCVEndMouse);\n  var startRay = camera.getPickRay(startMouse, translateCVStartRay);\n\n  var origin = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].ZERO */ .Z.ZERO, translateCVOrigin);\n  var normal = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_X */ .Z.UNIT_X;\n\n  var globePos;\n  if (camera.position.z < controller._minimumPickingTerrainHeight) {\n    globePos = pickGlobe(controller, startMouse, translateCVStartPos);\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(globePos)) {\n      origin.x = globePos.x;\n    }\n  }\n\n  if (\n    cameraUnderground ||\n    (origin.x > camera.position.z && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(globePos))\n  ) {\n    var pickPosition = globePos;\n    if (cameraUnderground) {\n      pickPosition = getStrafeStartPositionUnderground(\n        controller,\n        startRay,\n        globePos,\n        translateCVStartPos\n      );\n    }\n    _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._strafeMousePosition);\n    _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._strafeEndMousePosition);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(pickPosition, controller._strafeStartPosition);\n    controller._strafing = true;\n    strafe(controller, movement, controller._strafeStartPosition);\n    return;\n  }\n\n  var plane = _Core_Plane_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].fromPointNormal */ .Z.fromPointNormal(origin, normal, translateCVPlane);\n\n  startRay = camera.getPickRay(startMouse, translateCVStartRay);\n  var startPlanePos = _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].rayPlane */ .Z.rayPlane(\n    startRay,\n    plane,\n    translateCVStartPos\n  );\n\n  var endRay = camera.getPickRay(endMouse, translateCVEndRay);\n  var endPlanePos = _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].rayPlane */ .Z.rayPlane(\n    endRay,\n    plane,\n    translateCVEndPos\n  );\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(startPlanePos) || !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(endPlanePos)) {\n    controller._looking = true;\n    look3D(controller, startPosition, movement);\n    _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._translateMousePosition);\n    return;\n  }\n\n  var diff = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(\n    startPlanePos,\n    endPlanePos,\n    translateCVDifference\n  );\n  var temp = diff.x;\n  diff.x = diff.y;\n  diff.y = diff.z;\n  diff.z = temp;\n  var mag = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(diff);\n  if (mag > _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON6 */ .Z.EPSILON6) {\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(diff, diff);\n    camera.move(diff, mag);\n  }\n}\n\nvar rotateCVWindowPos = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar rotateCVWindowRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar rotateCVCenter = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar rotateCVVerticalCenter = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar rotateCVTransform = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\nvar rotateCVVerticalTransform = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\nvar rotateCVOrigin = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar rotateCVPlane = new _Core_Plane_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_X */ .Z.UNIT_X, 0.0);\nvar rotateCVCartesian3 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar rotateCVCart = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar rotateCVOldTransform = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\nvar rotateCVQuaternion = new _Core_Quaternion_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"] */ .Z();\nvar rotateCVMatrix = new _Core_Matrix3_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z();\nvar tilt3DCartesian3 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\nfunction rotateCV(controller, startPosition, movement) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(movement.angleAndHeight)) {\n    movement = movement.angleAndHeight;\n  }\n\n  if (!_Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(startPosition, controller._tiltCenterMousePosition)) {\n    controller._tiltCVOffMap = false;\n    controller._looking = false;\n  }\n\n  if (controller._looking) {\n    look3D(controller, startPosition, movement);\n    return;\n  }\n\n  var scene = controller._scene;\n  var camera = scene.camera;\n\n  if (\n    controller._tiltCVOffMap ||\n    !controller.onMap() ||\n    Math.abs(camera.position.z) > controller._minimumPickingTerrainHeight\n  ) {\n    controller._tiltCVOffMap = true;\n    rotateCVOnPlane(controller, startPosition, movement);\n  } else {\n    rotateCVOnTerrain(controller, startPosition, movement);\n  }\n}\n\nfunction rotateCVOnPlane(controller, startPosition, movement) {\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var canvas = scene.canvas;\n\n  var windowPosition = rotateCVWindowPos;\n  windowPosition.x = canvas.clientWidth / 2;\n  windowPosition.y = canvas.clientHeight / 2;\n  var ray = camera.getPickRay(windowPosition, rotateCVWindowRay);\n  var normal = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_X */ .Z.UNIT_X;\n\n  var position = ray.origin;\n  var direction = ray.direction;\n  var scalar;\n  var normalDotDirection = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(normal, direction);\n  if (Math.abs(normalDotDirection) > _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON6 */ .Z.EPSILON6) {\n    scalar = -_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(normal, position) / normalDotDirection;\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(scalar) || scalar <= 0.0) {\n    controller._looking = true;\n    look3D(controller, startPosition, movement);\n    _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._tiltCenterMousePosition);\n    return;\n  }\n\n  var center = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(direction, scalar, rotateCVCenter);\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(position, center, center);\n\n  var projection = scene.mapProjection;\n  var ellipsoid = projection.ellipsoid;\n\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(center.y, center.z, center.x, center);\n  var cart = projection.unproject(center, rotateCVCart);\n  ellipsoid.cartographicToCartesian(cart, center);\n\n  var transform = _Core_Transforms_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].eastNorthUpToFixedFrame */ .Z.eastNorthUpToFixedFrame(\n    center,\n    ellipsoid,\n    rotateCVTransform\n  );\n\n  var oldGlobe = controller._globe;\n  var oldEllipsoid = controller._ellipsoid;\n  controller._globe = undefined;\n  controller._ellipsoid = _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].UNIT_SPHERE */ .Z.UNIT_SPHERE;\n  controller._rotateFactor = 1.0;\n  controller._rotateRateRangeAdjustment = 1.0;\n\n  var oldTransform = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].clone */ .Z.clone(camera.transform, rotateCVOldTransform);\n  camera._setTransform(transform);\n\n  rotate3D(controller, startPosition, movement, _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_Z */ .Z.UNIT_Z);\n\n  camera._setTransform(oldTransform);\n  controller._globe = oldGlobe;\n  controller._ellipsoid = oldEllipsoid;\n\n  var radius = oldEllipsoid.maximumRadius;\n  controller._rotateFactor = 1.0 / radius;\n  controller._rotateRateRangeAdjustment = radius;\n}\n\nfunction rotateCVOnTerrain(controller, startPosition, movement) {\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var cameraUnderground = controller._cameraUnderground;\n\n  var center;\n  var ray;\n  var normal = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_X */ .Z.UNIT_X;\n\n  if (_Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(startPosition, controller._tiltCenterMousePosition)) {\n    center = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(controller._tiltCenter, rotateCVCenter);\n  } else {\n    if (camera.position.z < controller._minimumPickingTerrainHeight) {\n      center = pickGlobe(controller, startPosition, rotateCVCenter);\n    }\n\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(center)) {\n      ray = camera.getPickRay(startPosition, rotateCVWindowRay);\n      var position = ray.origin;\n      var direction = ray.direction;\n\n      var scalar;\n      var normalDotDirection = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(normal, direction);\n      if (Math.abs(normalDotDirection) > _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON6 */ .Z.EPSILON6) {\n        scalar = -_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(normal, position) / normalDotDirection;\n      }\n\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(scalar) || scalar <= 0.0) {\n        controller._looking = true;\n        look3D(controller, startPosition, movement);\n        _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._tiltCenterMousePosition);\n        return;\n      }\n\n      center = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(direction, scalar, rotateCVCenter);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(position, center, center);\n    }\n\n    if (cameraUnderground) {\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(ray)) {\n        ray = camera.getPickRay(startPosition, rotateCVWindowRay);\n      }\n      getTiltCenterUnderground(controller, ray, center, center);\n    }\n\n    _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._tiltCenterMousePosition);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(center, controller._tiltCenter);\n  }\n\n  var canvas = scene.canvas;\n\n  var windowPosition = rotateCVWindowPos;\n  windowPosition.x = canvas.clientWidth / 2;\n  windowPosition.y = controller._tiltCenterMousePosition.y;\n  ray = camera.getPickRay(windowPosition, rotateCVWindowRay);\n\n  var origin = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].ZERO */ .Z.ZERO, rotateCVOrigin);\n  origin.x = center.x;\n\n  var plane = _Core_Plane_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].fromPointNormal */ .Z.fromPointNormal(origin, normal, rotateCVPlane);\n  var verticalCenter = _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].rayPlane */ .Z.rayPlane(\n    ray,\n    plane,\n    rotateCVVerticalCenter\n  );\n\n  var projection = camera._projection;\n  var ellipsoid = projection.ellipsoid;\n\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(center.y, center.z, center.x, center);\n  var cart = projection.unproject(center, rotateCVCart);\n  ellipsoid.cartographicToCartesian(cart, center);\n\n  var transform = _Core_Transforms_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].eastNorthUpToFixedFrame */ .Z.eastNorthUpToFixedFrame(\n    center,\n    ellipsoid,\n    rotateCVTransform\n  );\n\n  var verticalTransform;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(verticalCenter)) {\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(\n      verticalCenter.y,\n      verticalCenter.z,\n      verticalCenter.x,\n      verticalCenter\n    );\n    cart = projection.unproject(verticalCenter, rotateCVCart);\n    ellipsoid.cartographicToCartesian(cart, verticalCenter);\n\n    verticalTransform = _Core_Transforms_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].eastNorthUpToFixedFrame */ .Z.eastNorthUpToFixedFrame(\n      verticalCenter,\n      ellipsoid,\n      rotateCVVerticalTransform\n    );\n  } else {\n    verticalTransform = transform;\n  }\n\n  var oldGlobe = controller._globe;\n  var oldEllipsoid = controller._ellipsoid;\n  controller._globe = undefined;\n  controller._ellipsoid = _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].UNIT_SPHERE */ .Z.UNIT_SPHERE;\n  controller._rotateFactor = 1.0;\n  controller._rotateRateRangeAdjustment = 1.0;\n\n  var constrainedAxis = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_Z */ .Z.UNIT_Z;\n\n  var oldTransform = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].clone */ .Z.clone(camera.transform, rotateCVOldTransform);\n  camera._setTransform(transform);\n\n  var tangent = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_Z */ .Z.UNIT_Z,\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(camera.position, rotateCVCartesian3),\n    rotateCVCartesian3\n  );\n  var dot = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(camera.right, tangent);\n\n  rotate3D(controller, startPosition, movement, constrainedAxis, false, true);\n\n  camera._setTransform(verticalTransform);\n  if (dot < 0.0) {\n    var movementDelta = movement.startPosition.y - movement.endPosition.y;\n    if (\n      (cameraUnderground && movementDelta < 0.0) ||\n      (!cameraUnderground && movementDelta > 0.0)\n    ) {\n      // Prevent camera from flipping past the up axis\n      constrainedAxis = undefined;\n    }\n\n    var oldConstrainedAxis = camera.constrainedAxis;\n    camera.constrainedAxis = undefined;\n\n    rotate3D(controller, startPosition, movement, constrainedAxis, true, false);\n\n    camera.constrainedAxis = oldConstrainedAxis;\n  } else {\n    rotate3D(controller, startPosition, movement, constrainedAxis, true, false);\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(camera.constrainedAxis)) {\n    var right = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(\n      camera.direction,\n      camera.constrainedAxis,\n      tilt3DCartesian3\n    );\n    if (\n      !_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equalsEpsilon */ .Z.equalsEpsilon(right, _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].ZERO */ .Z.ZERO, _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON6 */ .Z.EPSILON6)\n    ) {\n      if (_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(right, camera.right) < 0.0) {\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].negate */ .Z.negate(right, right);\n      }\n\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(right, camera.direction, camera.up);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(camera.direction, camera.up, camera.right);\n\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(camera.up, camera.up);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(camera.right, camera.right);\n    }\n  }\n\n  camera._setTransform(oldTransform);\n  controller._globe = oldGlobe;\n  controller._ellipsoid = oldEllipsoid;\n\n  var radius = oldEllipsoid.maximumRadius;\n  controller._rotateFactor = 1.0 / radius;\n  controller._rotateRateRangeAdjustment = radius;\n\n  var originalPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(\n    camera.positionWC,\n    rotateCVCartesian3\n  );\n\n  if (controller.enableCollisionDetection) {\n    adjustHeightForTerrain(controller);\n  }\n\n  if (!_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(camera.positionWC, originalPosition)) {\n    camera._setTransform(verticalTransform);\n    camera.worldToCameraCoordinatesPoint(originalPosition, originalPosition);\n\n    var magSqrd = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitudeSquared */ .Z.magnitudeSquared(originalPosition);\n    if (_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitudeSquared */ .Z.magnitudeSquared(camera.position) > magSqrd) {\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(camera.position, camera.position);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n        camera.position,\n        Math.sqrt(magSqrd),\n        camera.position\n      );\n    }\n\n    var angle = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].angleBetween */ .Z.angleBetween(originalPosition, camera.position);\n    var axis = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(\n      originalPosition,\n      camera.position,\n      originalPosition\n    );\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(axis, axis);\n\n    var quaternion = _Core_Quaternion_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].fromAxisAngle */ .Z.fromAxisAngle(axis, angle, rotateCVQuaternion);\n    var rotation = _Core_Matrix3_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].fromQuaternion */ .Z.fromQuaternion(quaternion, rotateCVMatrix);\n    _Core_Matrix3_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].multiplyByVector */ .Z.multiplyByVector(rotation, camera.direction, camera.direction);\n    _Core_Matrix3_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].multiplyByVector */ .Z.multiplyByVector(rotation, camera.up, camera.up);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(camera.direction, camera.up, camera.right);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(camera.right, camera.direction, camera.up);\n\n    camera._setTransform(oldTransform);\n  }\n}\n\nvar zoomCVWindowPos = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar zoomCVWindowRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar zoomCVIntersection = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\nfunction zoomCV(controller, startPosition, movement) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(movement.distance)) {\n    movement = movement.distance;\n  }\n\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var canvas = scene.canvas;\n\n  var cameraUnderground = controller._cameraUnderground;\n\n  var windowPosition;\n\n  if (cameraUnderground) {\n    windowPosition = startPosition;\n  } else {\n    windowPosition = zoomCVWindowPos;\n    windowPosition.x = canvas.clientWidth / 2;\n    windowPosition.y = canvas.clientHeight / 2;\n  }\n\n  var ray = camera.getPickRay(windowPosition, zoomCVWindowRay);\n  var position = ray.origin;\n  var direction = ray.direction;\n  var height = camera.position.z;\n\n  var intersection;\n  if (height < controller._minimumPickingTerrainHeight) {\n    intersection = pickGlobe(controller, windowPosition, zoomCVIntersection);\n  }\n\n  var distance;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(intersection)) {\n    distance = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].distance */ .Z.distance(position, intersection);\n  }\n\n  if (cameraUnderground) {\n    var distanceUnderground = getZoomDistanceUnderground(\n      controller,\n      ray,\n      height\n    );\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(distance)) {\n      distance = Math.min(distance, distanceUnderground);\n    } else {\n      distance = distanceUnderground;\n    }\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(distance)) {\n    var normal = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_X */ .Z.UNIT_X;\n    distance =\n      -_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(normal, position) / _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(normal, direction);\n  }\n\n  handleZoom(\n    controller,\n    startPosition,\n    movement,\n    controller._zoomFactor,\n    distance\n  );\n}\n\nfunction updateCV(controller) {\n  var scene = controller._scene;\n  var camera = scene.camera;\n\n  if (!_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].equals */ .Z.equals(_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].IDENTITY */ .Z.IDENTITY, camera.transform)) {\n    reactToInput(\n      controller,\n      controller.enableRotate,\n      controller.rotateEventTypes,\n      rotate3D,\n      controller.inertiaSpin,\n      "_lastInertiaSpinMovement"\n    );\n    reactToInput(\n      controller,\n      controller.enableZoom,\n      controller.zoomEventTypes,\n      zoom3D,\n      controller.inertiaZoom,\n      "_lastInertiaZoomMovement"\n    );\n  } else {\n    var tweens = controller._tweens;\n\n    if (controller._aggregator.anyButtonDown) {\n      tweens.removeAll();\n    }\n\n    reactToInput(\n      controller,\n      controller.enableTilt,\n      controller.tiltEventTypes,\n      rotateCV,\n      controller.inertiaSpin,\n      "_lastInertiaTiltMovement"\n    );\n    reactToInput(\n      controller,\n      controller.enableTranslate,\n      controller.translateEventTypes,\n      translateCV,\n      controller.inertiaTranslate,\n      "_lastInertiaTranslateMovement"\n    );\n    reactToInput(\n      controller,\n      controller.enableZoom,\n      controller.zoomEventTypes,\n      zoomCV,\n      controller.inertiaZoom,\n      "_lastInertiaZoomMovement"\n    );\n    reactToInput(\n      controller,\n      controller.enableLook,\n      controller.lookEventTypes,\n      look3D\n    );\n\n    if (\n      !controller._aggregator.anyButtonDown &&\n      !tweens.contains(controller._tween)\n    ) {\n      var tween = camera.createCorrectPositionTween(\n        controller.bounceAnimationTime\n      );\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(tween)) {\n        controller._tween = tweens.add(tween);\n      }\n    }\n\n    tweens.update();\n  }\n}\n\nvar scratchStrafeRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar scratchStrafePlane = new _Core_Plane_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_X */ .Z.UNIT_X, 0.0);\nvar scratchStrafeIntersection = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchStrafeDirection = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchMousePos = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\nfunction strafe(controller, movement, strafeStartPosition) {\n  var scene = controller._scene;\n  var camera = scene.camera;\n\n  var ray = camera.getPickRay(movement.endPosition, scratchStrafeRay);\n\n  var direction = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(camera.direction, scratchStrafeDirection);\n  if (scene.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW) {\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(direction.z, direction.x, direction.y, direction);\n  }\n\n  var plane = _Core_Plane_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].fromPointNormal */ .Z.fromPointNormal(\n    strafeStartPosition,\n    direction,\n    scratchStrafePlane\n  );\n  var intersection = _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].rayPlane */ .Z.rayPlane(\n    ray,\n    plane,\n    scratchStrafeIntersection\n  );\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(intersection)) {\n    return;\n  }\n\n  direction = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(strafeStartPosition, intersection, direction);\n  if (scene.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW) {\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(direction.y, direction.z, direction.x, direction);\n  }\n\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(camera.position, direction, camera.position);\n}\n\nvar spin3DPick = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchCartographic = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar scratchRadii = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchEllipsoid = new _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z();\nvar scratchLookUp = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchNormal = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\nfunction spin3D(controller, startPosition, movement) {\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var cameraUnderground = controller._cameraUnderground;\n  var ellipsoid = controller._ellipsoid;\n\n  if (!_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].equals */ .Z.equals(camera.transform, _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].IDENTITY */ .Z.IDENTITY)) {\n    rotate3D(controller, startPosition, movement);\n    return;\n  }\n\n  var magnitude;\n  var radii;\n\n  var up = ellipsoid.geodeticSurfaceNormal(camera.position, scratchLookUp);\n\n  if (_Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(startPosition, controller._rotateMousePosition)) {\n    if (controller._looking) {\n      look3D(controller, startPosition, movement, up);\n    } else if (controller._rotating) {\n      rotate3D(controller, startPosition, movement);\n    } else if (controller._strafing) {\n      continueStrafing(controller, movement);\n    } else {\n      if (\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(camera.position) <\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(controller._rotateStartPosition)\n      ) {\n        // Pan action is no longer valid if camera moves below the pan ellipsoid\n        return;\n      }\n      magnitude = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(controller._rotateStartPosition);\n      radii = scratchRadii;\n      radii.x = radii.y = radii.z = magnitude;\n      ellipsoid = _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].fromCartesian3 */ .Z.fromCartesian3(radii, scratchEllipsoid);\n      pan3D(controller, startPosition, movement, ellipsoid);\n    }\n    return;\n  }\n  controller._looking = false;\n  controller._rotating = false;\n  controller._strafing = false;\n\n  var height = ellipsoid.cartesianToCartographic(\n    camera.positionWC,\n    scratchCartographic\n  ).height;\n  var globe = controller._globe;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(globe) && height < controller._minimumPickingTerrainHeight) {\n    var mousePos = pickGlobe(\n      controller,\n      movement.startPosition,\n      scratchMousePos\n    );\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(mousePos)) {\n      var strafing = false;\n      var ray = camera.getPickRay(movement.startPosition, pickGlobeScratchRay);\n\n      if (cameraUnderground) {\n        strafing = true;\n        getStrafeStartPositionUnderground(controller, ray, mousePos, mousePos);\n      } else {\n        var normal = ellipsoid.geodeticSurfaceNormal(mousePos, scratchNormal);\n        var tangentPick =\n          Math.abs(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(ray.direction, normal)) < 0.05;\n\n        if (tangentPick) {\n          strafing = true;\n        } else {\n          strafing =\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(camera.position) <\n            _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(mousePos);\n        }\n      }\n\n      if (strafing) {\n        _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._strafeEndMousePosition);\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(mousePos, controller._strafeStartPosition);\n        controller._strafing = true;\n        strafe(controller, movement, controller._strafeStartPosition);\n      } else {\n        magnitude = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(mousePos);\n        radii = scratchRadii;\n        radii.x = radii.y = radii.z = magnitude;\n        ellipsoid = _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].fromCartesian3 */ .Z.fromCartesian3(radii, scratchEllipsoid);\n        pan3D(controller, startPosition, movement, ellipsoid);\n\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(mousePos, controller._rotateStartPosition);\n      }\n    } else {\n      controller._looking = true;\n      look3D(controller, startPosition, movement, up);\n    }\n  } else if (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(\n      camera.pickEllipsoid(\n        movement.startPosition,\n        controller._ellipsoid,\n        spin3DPick\n      )\n    )\n  ) {\n    pan3D(controller, startPosition, movement, controller._ellipsoid);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(spin3DPick, controller._rotateStartPosition);\n  } else if (height > controller._minimumTrackBallHeight) {\n    controller._rotating = true;\n    rotate3D(controller, startPosition, movement);\n  } else {\n    controller._looking = true;\n    look3D(controller, startPosition, movement, up);\n  }\n\n  _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._rotateMousePosition);\n}\n\nfunction rotate3D(\n  controller,\n  startPosition,\n  movement,\n  constrainedAxis,\n  rotateOnlyVertical,\n  rotateOnlyHorizontal\n) {\n  rotateOnlyVertical = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z)(rotateOnlyVertical, false);\n  rotateOnlyHorizontal = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z)(rotateOnlyHorizontal, false);\n\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var canvas = scene.canvas;\n\n  var oldAxis = camera.constrainedAxis;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(constrainedAxis)) {\n    camera.constrainedAxis = constrainedAxis;\n  }\n\n  var rho = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(camera.position);\n  var rotateRate =\n    controller._rotateFactor * (rho - controller._rotateRateRangeAdjustment);\n\n  if (rotateRate > controller._maximumRotateRate) {\n    rotateRate = controller._maximumRotateRate;\n  }\n\n  if (rotateRate < controller._minimumRotateRate) {\n    rotateRate = controller._minimumRotateRate;\n  }\n\n  var phiWindowRatio =\n    (movement.startPosition.x - movement.endPosition.x) / canvas.clientWidth;\n  var thetaWindowRatio =\n    (movement.startPosition.y - movement.endPosition.y) / canvas.clientHeight;\n  phiWindowRatio = Math.min(phiWindowRatio, controller.maximumMovementRatio);\n  thetaWindowRatio = Math.min(\n    thetaWindowRatio,\n    controller.maximumMovementRatio\n  );\n\n  var deltaPhi = rotateRate * phiWindowRatio * Math.PI * 2.0;\n  var deltaTheta = rotateRate * thetaWindowRatio * Math.PI;\n\n  if (!rotateOnlyVertical) {\n    camera.rotateRight(deltaPhi);\n  }\n\n  if (!rotateOnlyHorizontal) {\n    camera.rotateUp(deltaTheta);\n  }\n\n  camera.constrainedAxis = oldAxis;\n}\n\nvar pan3DP0 = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(_Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].UNIT_W */ .Z.UNIT_W);\nvar pan3DP1 = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(_Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].UNIT_W */ .Z.UNIT_W);\nvar pan3DTemp0 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar pan3DTemp1 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar pan3DTemp2 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar pan3DTemp3 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar pan3DStartMousePosition = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar pan3DEndMousePosition = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n\nfunction pan3D(controller, startPosition, movement, ellipsoid) {\n  var scene = controller._scene;\n  var camera = scene.camera;\n\n  var startMousePosition = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(\n    movement.startPosition,\n    pan3DStartMousePosition\n  );\n  var endMousePosition = _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(\n    movement.endPosition,\n    pan3DEndMousePosition\n  );\n\n  var p0 = camera.pickEllipsoid(startMousePosition, ellipsoid, pan3DP0);\n  var p1 = camera.pickEllipsoid(endMousePosition, ellipsoid, pan3DP1);\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(p0) || !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(p1)) {\n    controller._rotating = true;\n    rotate3D(controller, startPosition, movement);\n    return;\n  }\n\n  p0 = camera.worldToCameraCoordinates(p0, p0);\n  p1 = camera.worldToCameraCoordinates(p1, p1);\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(camera.constrainedAxis)) {\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(p0, p0);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(p1, p1);\n    var dot = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(p0, p1);\n    var axis = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(p0, p1, pan3DTemp0);\n\n    if (\n      dot < 1.0 &&\n      !_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equalsEpsilon */ .Z.equalsEpsilon(axis, _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].ZERO */ .Z.ZERO, _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON14 */ .Z.EPSILON14)\n    ) {\n      // dot is in [0, 1]\n      var angle = Math.acos(dot);\n      camera.rotate(axis, angle);\n    }\n  } else {\n    var basis0 = camera.constrainedAxis;\n    var basis1 = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].mostOrthogonalAxis */ .Z.mostOrthogonalAxis(basis0, pan3DTemp0);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(basis1, basis0, basis1);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(basis1, basis1);\n    var basis2 = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(basis0, basis1, pan3DTemp1);\n\n    var startRho = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(p0);\n    var startDot = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(basis0, p0);\n    var startTheta = Math.acos(startDot / startRho);\n    var startRej = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(basis0, startDot, pan3DTemp2);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(p0, startRej, startRej);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(startRej, startRej);\n\n    var endRho = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(p1);\n    var endDot = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(basis0, p1);\n    var endTheta = Math.acos(endDot / endRho);\n    var endRej = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(basis0, endDot, pan3DTemp3);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(p1, endRej, endRej);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(endRej, endRej);\n\n    var startPhi = Math.acos(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(startRej, basis1));\n    if (_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(startRej, basis2) < 0) {\n      startPhi = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].TWO_PI */ .Z.TWO_PI - startPhi;\n    }\n\n    var endPhi = Math.acos(_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(endRej, basis1));\n    if (_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(endRej, basis2) < 0) {\n      endPhi = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].TWO_PI */ .Z.TWO_PI - endPhi;\n    }\n\n    var deltaPhi = startPhi - endPhi;\n\n    var east;\n    if (\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equalsEpsilon */ .Z.equalsEpsilon(basis0, camera.position, _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON2 */ .Z.EPSILON2)\n    ) {\n      east = camera.right;\n    } else {\n      east = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(basis0, camera.position, pan3DTemp0);\n    }\n\n    var planeNormal = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(basis0, east, pan3DTemp0);\n    var side0 = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(\n      planeNormal,\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(p0, basis0, pan3DTemp1)\n    );\n    var side1 = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(\n      planeNormal,\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(p1, basis0, pan3DTemp1)\n    );\n\n    var deltaTheta;\n    if (side0 > 0 && side1 > 0) {\n      deltaTheta = endTheta - startTheta;\n    } else if (side0 > 0 && side1 <= 0) {\n      if (_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(camera.position, basis0) > 0) {\n        deltaTheta = -startTheta - endTheta;\n      } else {\n        deltaTheta = startTheta + endTheta;\n      }\n    } else {\n      deltaTheta = startTheta - endTheta;\n    }\n\n    camera.rotateRight(deltaPhi);\n    camera.rotateUp(deltaTheta);\n  }\n}\n\nvar zoom3DUnitPosition = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar zoom3DCartographic = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\n\nfunction zoom3D(controller, startPosition, movement) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(movement.distance)) {\n    movement = movement.distance;\n  }\n\n  var ellipsoid = controller._ellipsoid;\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var canvas = scene.canvas;\n\n  var cameraUnderground = controller._cameraUnderground;\n\n  var windowPosition;\n\n  if (cameraUnderground) {\n    windowPosition = startPosition;\n  } else {\n    windowPosition = zoomCVWindowPos;\n    windowPosition.x = canvas.clientWidth / 2;\n    windowPosition.y = canvas.clientHeight / 2;\n  }\n\n  var ray = camera.getPickRay(windowPosition, zoomCVWindowRay);\n\n  var intersection;\n  var height = ellipsoid.cartesianToCartographic(\n    camera.position,\n    zoom3DCartographic\n  ).height;\n  if (height < controller._minimumPickingTerrainHeight) {\n    intersection = pickGlobe(controller, windowPosition, zoomCVIntersection);\n  }\n\n  var distance;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(intersection)) {\n    distance = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].distance */ .Z.distance(ray.origin, intersection);\n  }\n\n  if (cameraUnderground) {\n    var distanceUnderground = getZoomDistanceUnderground(\n      controller,\n      ray,\n      height\n    );\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(distance)) {\n      distance = Math.min(distance, distanceUnderground);\n    } else {\n      distance = distanceUnderground;\n    }\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(distance)) {\n    distance = height;\n  }\n\n  var unitPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(camera.position, zoom3DUnitPosition);\n  handleZoom(\n    controller,\n    startPosition,\n    movement,\n    controller._zoomFactor,\n    distance,\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(unitPosition, camera.direction)\n  );\n}\n\nvar tilt3DWindowPos = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar tilt3DRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar tilt3DCenter = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar tilt3DVerticalCenter = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar tilt3DTransform = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\nvar tilt3DVerticalTransform = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\nvar tilt3DOldTransform = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\nvar tilt3DQuaternion = new _Core_Quaternion_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"] */ .Z();\nvar tilt3DMatrix = new _Core_Matrix3_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z();\nvar tilt3DCart = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar tilt3DLookUp = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\nfunction tilt3D(controller, startPosition, movement) {\n  var scene = controller._scene;\n  var camera = scene.camera;\n\n  if (!_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].equals */ .Z.equals(camera.transform, _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].IDENTITY */ .Z.IDENTITY)) {\n    return;\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(movement.angleAndHeight)) {\n    movement = movement.angleAndHeight;\n  }\n\n  if (!_Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(startPosition, controller._tiltCenterMousePosition)) {\n    controller._tiltOnEllipsoid = false;\n    controller._looking = false;\n  }\n\n  if (controller._looking) {\n    var up = controller._ellipsoid.geodeticSurfaceNormal(\n      camera.position,\n      tilt3DLookUp\n    );\n    look3D(controller, startPosition, movement, up);\n    return;\n  }\n\n  var ellipsoid = controller._ellipsoid;\n  var cartographic = ellipsoid.cartesianToCartographic(\n    camera.position,\n    tilt3DCart\n  );\n\n  if (\n    controller._tiltOnEllipsoid ||\n    cartographic.height > controller._minimumCollisionTerrainHeight\n  ) {\n    controller._tiltOnEllipsoid = true;\n    tilt3DOnEllipsoid(controller, startPosition, movement);\n  } else {\n    tilt3DOnTerrain(controller, startPosition, movement);\n  }\n}\n\nvar tilt3DOnEllipsoidCartographic = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\n\nfunction tilt3DOnEllipsoid(controller, startPosition, movement) {\n  var ellipsoid = controller._ellipsoid;\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var minHeight = controller.minimumZoomDistance * 0.25;\n  var height = ellipsoid.cartesianToCartographic(\n    camera.positionWC,\n    tilt3DOnEllipsoidCartographic\n  ).height;\n  if (\n    height - minHeight - 1.0 < _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON3 */ .Z.EPSILON3 &&\n    movement.endPosition.y - movement.startPosition.y < 0\n  ) {\n    return;\n  }\n\n  var canvas = scene.canvas;\n\n  var windowPosition = tilt3DWindowPos;\n  windowPosition.x = canvas.clientWidth / 2;\n  windowPosition.y = canvas.clientHeight / 2;\n  var ray = camera.getPickRay(windowPosition, tilt3DRay);\n\n  var center;\n  var intersection = _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].rayEllipsoid */ .Z.rayEllipsoid(ray, ellipsoid);\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(intersection)) {\n    center = _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].getPoint */ .Z.getPoint(ray, intersection.start, tilt3DCenter);\n  } else if (height > controller._minimumTrackBallHeight) {\n    var grazingAltitudeLocation = _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].grazingAltitudeLocation */ .Z.grazingAltitudeLocation(\n      ray,\n      ellipsoid\n    );\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(grazingAltitudeLocation)) {\n      return;\n    }\n    var grazingAltitudeCart = ellipsoid.cartesianToCartographic(\n      grazingAltitudeLocation,\n      tilt3DCart\n    );\n    grazingAltitudeCart.height = 0.0;\n    center = ellipsoid.cartographicToCartesian(\n      grazingAltitudeCart,\n      tilt3DCenter\n    );\n  } else {\n    controller._looking = true;\n    var up = controller._ellipsoid.geodeticSurfaceNormal(\n      camera.position,\n      tilt3DLookUp\n    );\n    look3D(controller, startPosition, movement, up);\n    _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._tiltCenterMousePosition);\n    return;\n  }\n\n  var transform = _Core_Transforms_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].eastNorthUpToFixedFrame */ .Z.eastNorthUpToFixedFrame(\n    center,\n    ellipsoid,\n    tilt3DTransform\n  );\n\n  var oldGlobe = controller._globe;\n  var oldEllipsoid = controller._ellipsoid;\n  controller._globe = undefined;\n  controller._ellipsoid = _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].UNIT_SPHERE */ .Z.UNIT_SPHERE;\n  controller._rotateFactor = 1.0;\n  controller._rotateRateRangeAdjustment = 1.0;\n\n  var oldTransform = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].clone */ .Z.clone(camera.transform, tilt3DOldTransform);\n  camera._setTransform(transform);\n\n  rotate3D(controller, startPosition, movement, _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_Z */ .Z.UNIT_Z);\n\n  camera._setTransform(oldTransform);\n  controller._globe = oldGlobe;\n  controller._ellipsoid = oldEllipsoid;\n\n  var radius = oldEllipsoid.maximumRadius;\n  controller._rotateFactor = 1.0 / radius;\n  controller._rotateRateRangeAdjustment = radius;\n}\n\nfunction tilt3DOnTerrain(controller, startPosition, movement) {\n  var ellipsoid = controller._ellipsoid;\n  var scene = controller._scene;\n  var camera = scene.camera;\n  var cameraUnderground = controller._cameraUnderground;\n\n  var center;\n  var ray;\n  var intersection;\n\n  if (_Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(startPosition, controller._tiltCenterMousePosition)) {\n    center = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(controller._tiltCenter, tilt3DCenter);\n  } else {\n    center = pickGlobe(controller, startPosition, tilt3DCenter);\n\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(center)) {\n      ray = camera.getPickRay(startPosition, tilt3DRay);\n      intersection = _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].rayEllipsoid */ .Z.rayEllipsoid(ray, ellipsoid);\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(intersection)) {\n        var cartographic = ellipsoid.cartesianToCartographic(\n          camera.position,\n          tilt3DCart\n        );\n        if (cartographic.height <= controller._minimumTrackBallHeight) {\n          controller._looking = true;\n          var up = controller._ellipsoid.geodeticSurfaceNormal(\n            camera.position,\n            tilt3DLookUp\n          );\n          look3D(controller, startPosition, movement, up);\n          _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._tiltCenterMousePosition);\n        }\n        return;\n      }\n      center = _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].getPoint */ .Z.getPoint(ray, intersection.start, tilt3DCenter);\n    }\n\n    if (cameraUnderground) {\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(ray)) {\n        ray = camera.getPickRay(startPosition, tilt3DRay);\n      }\n      getTiltCenterUnderground(controller, ray, center, center);\n    }\n\n    _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(startPosition, controller._tiltCenterMousePosition);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(center, controller._tiltCenter);\n  }\n\n  var canvas = scene.canvas;\n\n  var windowPosition = tilt3DWindowPos;\n  windowPosition.x = canvas.clientWidth / 2;\n  windowPosition.y = controller._tiltCenterMousePosition.y;\n  ray = camera.getPickRay(windowPosition, tilt3DRay);\n\n  var mag = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(center);\n  var radii = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(mag, mag, mag, scratchRadii);\n  var newEllipsoid = _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].fromCartesian3 */ .Z.fromCartesian3(radii, scratchEllipsoid);\n\n  intersection = _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].rayEllipsoid */ .Z.rayEllipsoid(ray, newEllipsoid);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(intersection)) {\n    return;\n  }\n\n  var t =\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(ray.origin) > mag\n      ? intersection.start\n      : intersection.stop;\n  var verticalCenter = _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].getPoint */ .Z.getPoint(ray, t, tilt3DVerticalCenter);\n\n  var transform = _Core_Transforms_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].eastNorthUpToFixedFrame */ .Z.eastNorthUpToFixedFrame(\n    center,\n    ellipsoid,\n    tilt3DTransform\n  );\n  var verticalTransform = _Core_Transforms_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].eastNorthUpToFixedFrame */ .Z.eastNorthUpToFixedFrame(\n    verticalCenter,\n    newEllipsoid,\n    tilt3DVerticalTransform\n  );\n\n  var oldGlobe = controller._globe;\n  var oldEllipsoid = controller._ellipsoid;\n  controller._globe = undefined;\n  controller._ellipsoid = _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].UNIT_SPHERE */ .Z.UNIT_SPHERE;\n  controller._rotateFactor = 1.0;\n  controller._rotateRateRangeAdjustment = 1.0;\n\n  var constrainedAxis = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_Z */ .Z.UNIT_Z;\n\n  var oldTransform = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].clone */ .Z.clone(camera.transform, tilt3DOldTransform);\n  camera._setTransform(verticalTransform);\n\n  var tangent = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(\n    verticalCenter,\n    camera.positionWC,\n    tilt3DCartesian3\n  );\n  var dot = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(camera.rightWC, tangent);\n\n  if (dot < 0.0) {\n    var movementDelta = movement.startPosition.y - movement.endPosition.y;\n    if (\n      (cameraUnderground && movementDelta < 0.0) ||\n      (!cameraUnderground && movementDelta > 0.0)\n    ) {\n      // Prevent camera from flipping past the up axis\n      constrainedAxis = undefined;\n    }\n\n    var oldConstrainedAxis = camera.constrainedAxis;\n    camera.constrainedAxis = undefined;\n\n    rotate3D(controller, startPosition, movement, constrainedAxis, true, false);\n\n    camera.constrainedAxis = oldConstrainedAxis;\n  } else {\n    rotate3D(controller, startPosition, movement, constrainedAxis, true, false);\n  }\n\n  camera._setTransform(transform);\n  rotate3D(controller, startPosition, movement, constrainedAxis, false, true);\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(camera.constrainedAxis)) {\n    var right = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(\n      camera.direction,\n      camera.constrainedAxis,\n      tilt3DCartesian3\n    );\n    if (\n      !_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equalsEpsilon */ .Z.equalsEpsilon(right, _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].ZERO */ .Z.ZERO, _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON6 */ .Z.EPSILON6)\n    ) {\n      if (_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(right, camera.right) < 0.0) {\n        _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].negate */ .Z.negate(right, right);\n      }\n\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(right, camera.direction, camera.up);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(camera.direction, camera.up, camera.right);\n\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(camera.up, camera.up);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(camera.right, camera.right);\n    }\n  }\n\n  camera._setTransform(oldTransform);\n  controller._globe = oldGlobe;\n  controller._ellipsoid = oldEllipsoid;\n\n  var radius = oldEllipsoid.maximumRadius;\n  controller._rotateFactor = 1.0 / radius;\n  controller._rotateRateRangeAdjustment = radius;\n\n  var originalPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(camera.positionWC, tilt3DCartesian3);\n\n  if (controller.enableCollisionDetection) {\n    adjustHeightForTerrain(controller);\n  }\n\n  if (!_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(camera.positionWC, originalPosition)) {\n    camera._setTransform(verticalTransform);\n    camera.worldToCameraCoordinatesPoint(originalPosition, originalPosition);\n\n    var magSqrd = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitudeSquared */ .Z.magnitudeSquared(originalPosition);\n    if (_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitudeSquared */ .Z.magnitudeSquared(camera.position) > magSqrd) {\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(camera.position, camera.position);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n        camera.position,\n        Math.sqrt(magSqrd),\n        camera.position\n      );\n    }\n\n    var angle = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].angleBetween */ .Z.angleBetween(originalPosition, camera.position);\n    var axis = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(\n      originalPosition,\n      camera.position,\n      originalPosition\n    );\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(axis, axis);\n\n    var quaternion = _Core_Quaternion_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].fromAxisAngle */ .Z.fromAxisAngle(axis, angle, tilt3DQuaternion);\n    var rotation = _Core_Matrix3_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].fromQuaternion */ .Z.fromQuaternion(quaternion, tilt3DMatrix);\n    _Core_Matrix3_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].multiplyByVector */ .Z.multiplyByVector(rotation, camera.direction, camera.direction);\n    _Core_Matrix3_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].multiplyByVector */ .Z.multiplyByVector(rotation, camera.up, camera.up);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(camera.direction, camera.up, camera.right);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(camera.right, camera.direction, camera.up);\n\n    camera._setTransform(oldTransform);\n  }\n}\n\nvar look3DStartPos = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar look3DEndPos = new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar look3DStartRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar look3DEndRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z();\nvar look3DNegativeRot = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar look3DTan = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\nfunction look3D(controller, startPosition, movement, rotationAxis) {\n  var scene = controller._scene;\n  var camera = scene.camera;\n\n  var startPos = look3DStartPos;\n  startPos.x = movement.startPosition.x;\n  startPos.y = 0.0;\n  var endPos = look3DEndPos;\n  endPos.x = movement.endPosition.x;\n  endPos.y = 0.0;\n\n  var startRay = camera.getPickRay(startPos, look3DStartRay);\n  var endRay = camera.getPickRay(endPos, look3DEndRay);\n  var angle = 0.0;\n  var start;\n  var end;\n\n  if (camera.frustum instanceof _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"] */ .Z) {\n    start = startRay.origin;\n    end = endRay.origin;\n\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(camera.direction, start, start);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(camera.direction, end, end);\n\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(start, camera.position, start);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(end, camera.position, end);\n\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(start, start);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(end, end);\n  } else {\n    start = startRay.direction;\n    end = endRay.direction;\n  }\n\n  var dot = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(start, end);\n  if (dot < 1.0) {\n    // dot is in [0, 1]\n    angle = Math.acos(dot);\n  }\n\n  angle = movement.startPosition.x > movement.endPosition.x ? -angle : angle;\n\n  var horizontalRotationAxis = controller._horizontalRotationAxis;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(rotationAxis)) {\n    camera.look(rotationAxis, -angle);\n  } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(horizontalRotationAxis)) {\n    camera.look(horizontalRotationAxis, -angle);\n  } else {\n    camera.lookLeft(angle);\n  }\n\n  startPos.x = 0.0;\n  startPos.y = movement.startPosition.y;\n  endPos.x = 0.0;\n  endPos.y = movement.endPosition.y;\n\n  startRay = camera.getPickRay(startPos, look3DStartRay);\n  endRay = camera.getPickRay(endPos, look3DEndRay);\n  angle = 0.0;\n\n  if (camera.frustum instanceof _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"] */ .Z) {\n    start = startRay.origin;\n    end = endRay.origin;\n\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(camera.direction, start, start);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].add */ .Z.add(camera.direction, end, end);\n\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(start, camera.position, start);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].subtract */ .Z.subtract(end, camera.position, end);\n\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(start, start);\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(end, end);\n  } else {\n    start = startRay.direction;\n    end = endRay.direction;\n  }\n\n  dot = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(start, end);\n  if (dot < 1.0) {\n    // dot is in [0, 1]\n    angle = Math.acos(dot);\n  }\n  angle = movement.startPosition.y > movement.endPosition.y ? -angle : angle;\n\n  rotationAxis = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z)(rotationAxis, horizontalRotationAxis);\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(rotationAxis)) {\n    var direction = camera.direction;\n    var negativeRotationAxis = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].negate */ .Z.negate(\n      rotationAxis,\n      look3DNegativeRot\n    );\n    var northParallel = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equalsEpsilon */ .Z.equalsEpsilon(\n      direction,\n      rotationAxis,\n      _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON2 */ .Z.EPSILON2\n    );\n    var southParallel = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equalsEpsilon */ .Z.equalsEpsilon(\n      direction,\n      negativeRotationAxis,\n      _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON2 */ .Z.EPSILON2\n    );\n    if (!northParallel && !southParallel) {\n      dot = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(direction, rotationAxis);\n      var angleToAxis = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].acosClamped */ .Z.acosClamped(dot);\n      if (angle > 0 && angle > angleToAxis) {\n        angle = angleToAxis - _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON4 */ .Z.EPSILON4;\n      }\n\n      dot = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].dot */ .Z.dot(direction, negativeRotationAxis);\n      angleToAxis = _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].acosClamped */ .Z.acosClamped(dot);\n      if (angle < 0 && -angle > angleToAxis) {\n        angle = -angleToAxis + _Core_Math_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].EPSILON4 */ .Z.EPSILON4;\n      }\n\n      var tangent = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(rotationAxis, direction, look3DTan);\n      camera.look(tangent, angle);\n    } else if ((northParallel && angle < 0) || (southParallel && angle > 0)) {\n      camera.look(camera.right, -angle);\n    }\n  } else {\n    camera.lookUp(angle);\n  }\n}\n\nfunction update3D(controller) {\n  reactToInput(\n    controller,\n    controller.enableRotate,\n    controller.rotateEventTypes,\n    spin3D,\n    controller.inertiaSpin,\n    "_lastInertiaSpinMovement"\n  );\n  reactToInput(\n    controller,\n    controller.enableZoom,\n    controller.zoomEventTypes,\n    zoom3D,\n    controller.inertiaZoom,\n    "_lastInertiaZoomMovement"\n  );\n  reactToInput(\n    controller,\n    controller.enableTilt,\n    controller.tiltEventTypes,\n    tilt3D,\n    controller.inertiaSpin,\n    "_lastInertiaTiltMovement"\n  );\n  reactToInput(\n    controller,\n    controller.enableLook,\n    controller.lookEventTypes,\n    look3D\n  );\n}\n\nvar scratchAdjustHeightTransform = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\nvar scratchAdjustHeightCartographic = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\n\nfunction adjustHeightForTerrain(controller) {\n  controller._adjustedHeightForTerrain = true;\n\n  var scene = controller._scene;\n  var mode = scene.mode;\n  var globe = scene.globe;\n\n  if (\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(globe) ||\n    mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].SCENE2D */ .Z.SCENE2D ||\n    mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].MORPHING */ .Z.MORPHING\n  ) {\n    return;\n  }\n\n  var camera = scene.camera;\n  var ellipsoid = globe.ellipsoid;\n  var projection = scene.mapProjection;\n\n  var transform;\n  var mag;\n  if (!_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].equals */ .Z.equals(camera.transform, _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].IDENTITY */ .Z.IDENTITY)) {\n    transform = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].clone */ .Z.clone(camera.transform, scratchAdjustHeightTransform);\n    mag = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].magnitude */ .Z.magnitude(camera.position);\n    camera._setTransform(_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].IDENTITY */ .Z.IDENTITY);\n  }\n\n  var cartographic = scratchAdjustHeightCartographic;\n  if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    ellipsoid.cartesianToCartographic(camera.position, cartographic);\n  } else {\n    projection.unproject(camera.position, cartographic);\n  }\n\n  var heightUpdated = false;\n  if (cartographic.height < controller._minimumCollisionTerrainHeight) {\n    var globeHeight = controller._scene.globeHeight;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(globeHeight)) {\n      var height = globeHeight + controller.minimumZoomDistance;\n      if (cartographic.height < height) {\n        cartographic.height = height;\n        if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n          ellipsoid.cartographicToCartesian(cartographic, camera.position);\n        } else {\n          projection.project(cartographic, camera.position);\n        }\n        heightUpdated = true;\n      }\n    }\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(transform)) {\n    camera._setTransform(transform);\n    if (heightUpdated) {\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(camera.position, camera.position);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].negate */ .Z.negate(camera.position, camera.direction);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n        camera.position,\n        Math.max(mag, controller.minimumZoomDistance),\n        camera.position\n      );\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].normalize */ .Z.normalize(camera.direction, camera.direction);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(camera.direction, camera.up, camera.right);\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].cross */ .Z.cross(camera.right, camera.direction, camera.up);\n    }\n  }\n}\n\n/**\n * @private\n */\nScreenSpaceCameraController.prototype.onMap = function () {\n  var scene = this._scene;\n  var mode = scene.mode;\n  var camera = scene.camera;\n\n  if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW) {\n    return (\n      Math.abs(camera.position.x) - this._maxCoord.x < 0 &&\n      Math.abs(camera.position.y) - this._maxCoord.y < 0\n    );\n  }\n\n  return true;\n};\n\nvar scratchPreviousPosition = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchPreviousDirection = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\n/**\n * @private\n */\nScreenSpaceCameraController.prototype.update = function () {\n  var scene = this._scene;\n  var camera = scene.camera;\n  var globe = scene.globe;\n  var mode = scene.mode;\n\n  if (!_Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].equals */ .Z.equals(camera.transform, _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].IDENTITY */ .Z.IDENTITY)) {\n    this._globe = undefined;\n    this._ellipsoid = _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].UNIT_SPHERE */ .Z.UNIT_SPHERE;\n  } else {\n    this._globe = globe;\n    this._ellipsoid = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(this._globe)\n      ? this._globe.ellipsoid\n      : scene.mapProjection.ellipsoid;\n  }\n\n  var exaggeration = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(this._globe)\n    ? this._globe.terrainExaggeration\n    : 1.0;\n  var exaggerationRelativeHeight = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(this._globe)\n    ? this._globe.terrainExaggerationRelativeHeight\n    : 0.0;\n  this._minimumCollisionTerrainHeight = _Core_TerrainExaggeration_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].getHeight */ .Z.getHeight(\n    this.minimumCollisionTerrainHeight,\n    exaggeration,\n    exaggerationRelativeHeight\n  );\n  this._minimumPickingTerrainHeight = _Core_TerrainExaggeration_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].getHeight */ .Z.getHeight(\n    this.minimumPickingTerrainHeight,\n    exaggeration,\n    exaggerationRelativeHeight\n  );\n  this._minimumTrackBallHeight = _Core_TerrainExaggeration_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].getHeight */ .Z.getHeight(\n    this.minimumTrackBallHeight,\n    exaggeration,\n    exaggerationRelativeHeight\n  );\n\n  this._cameraUnderground = scene.cameraUnderground && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(this._globe);\n\n  var radius = this._ellipsoid.maximumRadius;\n  this._rotateFactor = 1.0 / radius;\n  this._rotateRateRangeAdjustment = radius;\n\n  this._adjustedHeightForTerrain = false;\n  var previousPosition = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(\n    camera.positionWC,\n    scratchPreviousPosition\n  );\n  var previousDirection = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(\n    camera.directionWC,\n    scratchPreviousDirection\n  );\n\n  if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].SCENE2D */ .Z.SCENE2D) {\n    update2D(this);\n  } else if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW) {\n    this._horizontalRotationAxis = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].UNIT_Z */ .Z.UNIT_Z;\n    updateCV(this);\n  } else if (mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    this._horizontalRotationAxis = undefined;\n    update3D(this);\n  }\n\n  if (this.enableCollisionDetection && !this._adjustedHeightForTerrain) {\n    // Adjust the camera height if the camera moved at all (user input or inertia) and an action didn\'t already adjust the camera height\n    var cameraChanged =\n      !_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(previousPosition, camera.positionWC) ||\n      !_Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].equals */ .Z.equals(previousDirection, camera.directionWC);\n    if (cameraChanged) {\n      adjustHeightForTerrain(this);\n    }\n  }\n\n  this._aggregator.reset();\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <br /><br />\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n *\n * @returns {Boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n *\n * @see ScreenSpaceCameraController#destroy\n */\nScreenSpaceCameraController.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Removes mouse listeners held by this object.\n * <br /><br />\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * controller = controller && controller.destroy();\n *\n * @see ScreenSpaceCameraController#isDestroyed\n */\nScreenSpaceCameraController.prototype.destroy = function () {\n  this._tweens.removeAll();\n  this._aggregator = this._aggregator && this._aggregator.destroy();\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(this);\n};\n/* harmony default export */ __webpack_exports__["Z"] = (ScreenSpaceCameraController);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGtGQUFpQjtBQUN4QixPQUFPLGtGQUFpQjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsOENBQThDO0FBQzlDO0FBQ0Esd0RBQXdEO0FBQ3hELDhDQUE4QyxzQkFBc0I7QUFDcEU7QUFDQSxhQUFhLFNBQVMsZ0RBQWdEO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQ7QUFDdkQsOENBQThDLHNCQUFzQjtBQUNwRTtBQUNBO0FBQ0EsZUFBZSxnQkFBZ0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLDJFQUFhO0FBQ3RCO0FBQ0EseURBQWUsMkJBQTJCLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92dWUzLXdlYnBhY2s1Ly4vbm9kZV9tb2R1bGVzL2Nlc2l1bS9Tb3VyY2UvU2NlbmUvU2NyZWVuU3BhY2VDYW1lcmFDb250cm9sbGVyLmpzPzQ5N2YiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcnRlc2lhbjIgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuMi5qc1wiO1xuaW1wb3J0IENhcnRlc2lhbjMgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuMy5qc1wiO1xuaW1wb3J0IENhcnRlc2lhbjQgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuNC5qc1wiO1xuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwiLi4vQ29yZS9DYXJ0b2dyYXBoaWMuanNcIjtcbmltcG9ydCBkZWZhdWx0VmFsdWUgZnJvbSBcIi4uL0NvcmUvZGVmYXVsdFZhbHVlLmpzXCI7XG5pbXBvcnQgZGVmaW5lZCBmcm9tIFwiLi4vQ29yZS9kZWZpbmVkLmpzXCI7XG5pbXBvcnQgZGVzdHJveU9iamVjdCBmcm9tIFwiLi4vQ29yZS9kZXN0cm95T2JqZWN0LmpzXCI7XG5pbXBvcnQgRGV2ZWxvcGVyRXJyb3IgZnJvbSBcIi4uL0NvcmUvRGV2ZWxvcGVyRXJyb3IuanNcIjtcbmltcG9ydCBFbGxpcHNvaWQgZnJvbSBcIi4uL0NvcmUvRWxsaXBzb2lkLmpzXCI7XG5pbXBvcnQgSGVhZGluZ1BpdGNoUm9sbCBmcm9tIFwiLi4vQ29yZS9IZWFkaW5nUGl0Y2hSb2xsLmpzXCI7XG5pbXBvcnQgSW50ZXJzZWN0aW9uVGVzdHMgZnJvbSBcIi4uL0NvcmUvSW50ZXJzZWN0aW9uVGVzdHMuanNcIjtcbmltcG9ydCBLZXlib2FyZEV2ZW50TW9kaWZpZXIgZnJvbSBcIi4uL0NvcmUvS2V5Ym9hcmRFdmVudE1vZGlmaWVyLmpzXCI7XG5pbXBvcnQgQ2VzaXVtTWF0aCBmcm9tIFwiLi4vQ29yZS9NYXRoLmpzXCI7XG5pbXBvcnQgTWF0cml4MyBmcm9tIFwiLi4vQ29yZS9NYXRyaXgzLmpzXCI7XG5pbXBvcnQgTWF0cml4NCBmcm9tIFwiLi4vQ29yZS9NYXRyaXg0LmpzXCI7XG5pbXBvcnQgT3J0aG9ncmFwaGljRnJ1c3R1bSBmcm9tIFwiLi4vQ29yZS9PcnRob2dyYXBoaWNGcnVzdHVtLmpzXCI7XG5pbXBvcnQgUGxhbmUgZnJvbSBcIi4uL0NvcmUvUGxhbmUuanNcIjtcbmltcG9ydCBRdWF0ZXJuaW9uIGZyb20gXCIuLi9Db3JlL1F1YXRlcm5pb24uanNcIjtcbmltcG9ydCBSYXkgZnJvbSBcIi4uL0NvcmUvUmF5LmpzXCI7XG5pbXBvcnQgVGVycmFpbkV4YWdnZXJhdGlvbiBmcm9tIFwiLi4vQ29yZS9UZXJyYWluRXhhZ2dlcmF0aW9uLmpzXCI7XG5pbXBvcnQgVHJhbnNmb3JtcyBmcm9tIFwiLi4vQ29yZS9UcmFuc2Zvcm1zLmpzXCI7XG5pbXBvcnQgQ2FtZXJhRXZlbnRBZ2dyZWdhdG9yIGZyb20gXCIuL0NhbWVyYUV2ZW50QWdncmVnYXRvci5qc1wiO1xuaW1wb3J0IENhbWVyYUV2ZW50VHlwZSBmcm9tIFwiLi9DYW1lcmFFdmVudFR5cGUuanNcIjtcbmltcG9ydCBNYXBNb2RlMkQgZnJvbSBcIi4vTWFwTW9kZTJELmpzXCI7XG5pbXBvcnQgU2NlbmVNb2RlIGZyb20gXCIuL1NjZW5lTW9kZS5qc1wiO1xuaW1wb3J0IFNjZW5lVHJhbnNmb3JtcyBmcm9tIFwiLi9TY2VuZVRyYW5zZm9ybXMuanNcIjtcbmltcG9ydCBUd2VlbkNvbGxlY3Rpb24gZnJvbSBcIi4vVHdlZW5Db2xsZWN0aW9uLmpzXCI7XG5cbi8qKlxuICogTW9kaWZpZXMgdGhlIGNhbWVyYSBwb3NpdGlvbiBhbmQgb3JpZW50YXRpb24gYmFzZWQgb24gbW91c2UgaW5wdXQgdG8gYSBjYW52YXMuXG4gKiBAYWxpYXMgU2NyZWVuU3BhY2VDYW1lcmFDb250cm9sbGVyXG4gKiBAY29uc3RydWN0b3JcbiAqXG4gKiBAcGFyYW0ge1NjZW5lfSBzY2VuZSBUaGUgc2NlbmUuXG4gKi9cbmZ1bmN0aW9uIFNjcmVlblNwYWNlQ2FtZXJhQ29udHJvbGxlcihzY2VuZSkge1xuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBpZiAoIWRlZmluZWQoc2NlbmUpKSB7XG4gICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwic2NlbmUgaXMgcmVxdWlyZWQuXCIpO1xuICB9XG4gIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gIC8qKlxuICAgKiBJZiB0cnVlLCBpbnB1dHMgYXJlIGFsbG93ZWQgY29uZGl0aW9uYWxseSB3aXRoIHRoZSBmbGFncyBlbmFibGVUcmFuc2xhdGUsIGVuYWJsZVpvb20sXG4gICAqIGVuYWJsZVJvdGF0ZSwgZW5hYmxlVGlsdCwgYW5kIGVuYWJsZUxvb2suICBJZiBmYWxzZSwgYWxsIGlucHV0cyBhcmUgZGlzYWJsZWQuXG4gICAqXG4gICAqIE5PVEU6IFRoaXMgc2V0dGluZyBpcyBmb3IgdGVtcG9yYXJ5IHVzZSBjYXNlcywgc3VjaCBhcyBjYW1lcmEgZmxpZ2h0cyBhbmRcbiAgICogZHJhZy1zZWxlY3Rpb24gb2YgcmVnaW9ucyAoc2VlIFBpY2tpbmcgZGVtbykuICBJdCBpcyB0eXBpY2FsbHkgc2V0IHRvIGZhbHNlIGF0IHRoZVxuICAgKiBzdGFydCBvZiBzdWNoIGV2ZW50cywgYW5kIHNldCB0cnVlIG9uIGNvbXBsZXRpb24uICBUbyBrZWVwIGlucHV0cyBkaXNhYmxlZFxuICAgKiBwYXN0IHRoZSBlbmQgb2YgY2FtZXJhIGZsaWdodHMsIHlvdSBtdXN0IHVzZSB0aGUgb3RoZXIgYm9vbGVhbnMgKGVuYWJsZVRyYW5zbGF0ZSxcbiAgICogZW5hYmxlWm9vbSwgZW5hYmxlUm90YXRlLCBlbmFibGVUaWx0LCBhbmQgZW5hYmxlTG9vaykuXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICB0aGlzLmVuYWJsZUlucHV0cyA9IHRydWU7XG4gIC8qKlxuICAgKiBJZiB0cnVlLCBhbGxvd3MgdGhlIHVzZXIgdG8gcGFuIGFyb3VuZCB0aGUgbWFwLiAgSWYgZmFsc2UsIHRoZSBjYW1lcmEgc3RheXMgbG9ja2VkIGF0IHRoZSBjdXJyZW50IHBvc2l0aW9uLlxuICAgKiBUaGlzIGZsYWcgb25seSBhcHBsaWVzIGluIDJEIGFuZCBDb2x1bWJ1cyB2aWV3IG1vZGVzLlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgdGhpcy5lbmFibGVUcmFuc2xhdGUgPSB0cnVlO1xuICAvKipcbiAgICogSWYgdHJ1ZSwgYWxsb3dzIHRoZSB1c2VyIHRvIHpvb20gaW4gYW5kIG91dC4gIElmIGZhbHNlLCB0aGUgY2FtZXJhIGlzIGxvY2tlZCB0byB0aGUgY3VycmVudCBkaXN0YW5jZSBmcm9tIHRoZSBlbGxpcHNvaWQuXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICB0aGlzLmVuYWJsZVpvb20gPSB0cnVlO1xuICAvKipcbiAgICogSWYgdHJ1ZSwgYWxsb3dzIHRoZSB1c2VyIHRvIHJvdGF0ZSB0aGUgd29ybGQgd2hpY2ggdHJhbnNsYXRlcyB0aGUgdXNlcidzIHBvc2l0aW9uLlxuICAgKiBUaGlzIGZsYWcgb25seSBhcHBsaWVzIGluIDJEIGFuZCAzRC5cbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHRoaXMuZW5hYmxlUm90YXRlID0gdHJ1ZTtcbiAgLyoqXG4gICAqIElmIHRydWUsIGFsbG93cyB0aGUgdXNlciB0byB0aWx0IHRoZSBjYW1lcmEuICBJZiBmYWxzZSwgdGhlIGNhbWVyYSBpcyBsb2NrZWQgdG8gdGhlIGN1cnJlbnQgaGVhZGluZy5cbiAgICogVGhpcyBmbGFnIG9ubHkgYXBwbGllcyBpbiAzRCBhbmQgQ29sdW1idXMgdmlldy5cbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHRoaXMuZW5hYmxlVGlsdCA9IHRydWU7XG4gIC8qKlxuICAgKiBJZiB0cnVlLCBhbGxvd3MgdGhlIHVzZXIgdG8gdXNlIGZyZWUtbG9vay4gSWYgZmFsc2UsIHRoZSBjYW1lcmEgdmlldyBkaXJlY3Rpb24gY2FuIG9ubHkgYmUgY2hhbmdlZCB0aHJvdWdoIHRyYW5zbGF0aW5nXG4gICAqIG9yIHJvdGF0aW5nLiBUaGlzIGZsYWcgb25seSBhcHBsaWVzIGluIDNEIGFuZCBDb2x1bWJ1cyB2aWV3IG1vZGVzLlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgdGhpcy5lbmFibGVMb29rID0gdHJ1ZTtcbiAgLyoqXG4gICAqIEEgcGFyYW1ldGVyIGluIHRoZSByYW5nZSA8Y29kZT5bMCwgMSk8L2NvZGU+IHVzZWQgdG8gZGV0ZXJtaW5lIGhvdyBsb25nXG4gICAqIHRoZSBjYW1lcmEgd2lsbCBjb250aW51ZSB0byBzcGluIGJlY2F1c2Ugb2YgaW5lcnRpYS5cbiAgICogV2l0aCB2YWx1ZSBvZiB6ZXJvLCB0aGUgY2FtZXJhIHdpbGwgaGF2ZSBubyBpbmVydGlhLlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAwLjlcbiAgICovXG4gIHRoaXMuaW5lcnRpYVNwaW4gPSAwLjk7XG4gIC8qKlxuICAgKiBBIHBhcmFtZXRlciBpbiB0aGUgcmFuZ2UgPGNvZGU+WzAsIDEpPC9jb2RlPiB1c2VkIHRvIGRldGVybWluZSBob3cgbG9uZ1xuICAgKiB0aGUgY2FtZXJhIHdpbGwgY29udGludWUgdG8gdHJhbnNsYXRlIGJlY2F1c2Ugb2YgaW5lcnRpYS5cbiAgICogV2l0aCB2YWx1ZSBvZiB6ZXJvLCB0aGUgY2FtZXJhIHdpbGwgaGF2ZSBubyBpbmVydGlhLlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAwLjlcbiAgICovXG4gIHRoaXMuaW5lcnRpYVRyYW5zbGF0ZSA9IDAuOTtcbiAgLyoqXG4gICAqIEEgcGFyYW1ldGVyIGluIHRoZSByYW5nZSA8Y29kZT5bMCwgMSk8L2NvZGU+IHVzZWQgdG8gZGV0ZXJtaW5lIGhvdyBsb25nXG4gICAqIHRoZSBjYW1lcmEgd2lsbCBjb250aW51ZSB0byB6b29tIGJlY2F1c2Ugb2YgaW5lcnRpYS5cbiAgICogV2l0aCB2YWx1ZSBvZiB6ZXJvLCB0aGUgY2FtZXJhIHdpbGwgaGF2ZSBubyBpbmVydGlhLlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAwLjhcbiAgICovXG4gIHRoaXMuaW5lcnRpYVpvb20gPSAwLjg7XG4gIC8qKlxuICAgKiBBIHBhcmFtZXRlciBpbiB0aGUgcmFuZ2UgPGNvZGU+WzAsIDEpPC9jb2RlPiB1c2VkIHRvIGxpbWl0IHRoZSByYW5nZVxuICAgKiBvZiB2YXJpb3VzIHVzZXIgaW5wdXRzIHRvIGEgcGVyY2VudGFnZSBvZiB0aGUgd2luZG93IHdpZHRoL2hlaWdodCBwZXIgYW5pbWF0aW9uIGZyYW1lLlxuICAgKiBUaGlzIGhlbHBzIGtlZXAgdGhlIGNhbWVyYSB1bmRlciBjb250cm9sIGluIGxvdy1mcmFtZS1yYXRlIHNpdHVhdGlvbnMuXG4gICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAqIEBkZWZhdWx0IDAuMVxuICAgKi9cbiAgdGhpcy5tYXhpbXVtTW92ZW1lbnRSYXRpbyA9IDAuMTtcbiAgLyoqXG4gICAqIFNldHMgdGhlIGR1cmF0aW9uLCBpbiBzZWNvbmRzLCBvZiB0aGUgYm91bmNlIGJhY2sgYW5pbWF0aW9ucyBpbiAyRCBhbmQgQ29sdW1idXMgdmlldy5cbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMy4wXG4gICAqL1xuICB0aGlzLmJvdW5jZUFuaW1hdGlvblRpbWUgPSAzLjA7XG4gIC8qKlxuICAgKiBUaGUgbWluaW11bSBtYWduaXR1ZGUsIGluIG1ldGVycywgb2YgdGhlIGNhbWVyYSBwb3NpdGlvbiB3aGVuIHpvb21pbmcuIERlZmF1bHRzIHRvIDEuMC5cbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMS4wXG4gICAqL1xuICB0aGlzLm1pbmltdW1ab29tRGlzdGFuY2UgPSAxLjA7XG4gIC8qKlxuICAgKiBUaGUgbWF4aW11bSBtYWduaXR1ZGUsIGluIG1ldGVycywgb2YgdGhlIGNhbWVyYSBwb3NpdGlvbiB3aGVuIHpvb21pbmcuIERlZmF1bHRzIHRvIHBvc2l0aXZlIGluZmluaXR5LlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCB7QGxpbmsgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfVxuICAgKi9cbiAgdGhpcy5tYXhpbXVtWm9vbURpc3RhbmNlID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZO1xuICAvKipcbiAgICogVGhlIGlucHV0IHRoYXQgYWxsb3dzIHRoZSB1c2VyIHRvIHBhbiBhcm91bmQgdGhlIG1hcC4gVGhpcyBvbmx5IGFwcGxpZXMgaW4gMkQgYW5kIENvbHVtYnVzIHZpZXcgbW9kZXMuXG4gICAqIDxwPlxuICAgKiBUaGUgdHlwZSBjYW1lIGJlIGEge0BsaW5rIENhbWVyYUV2ZW50VHlwZX0sIDxjb2RlPnVuZGVmaW5lZDwvY29kZT4sIGFuIG9iamVjdCB3aXRoIDxjb2RlPmV2ZW50VHlwZTwvY29kZT5cbiAgICogYW5kIDxjb2RlPm1vZGlmaWVyPC9jb2RlPiBwcm9wZXJ0aWVzIHdpdGggdHlwZXMgPGNvZGU+Q2FtZXJhRXZlbnRUeXBlPC9jb2RlPiBhbmQge0BsaW5rIEtleWJvYXJkRXZlbnRNb2RpZmllcn0sXG4gICAqIG9yIGFuIGFycmF5IG9mIGFueSBvZiB0aGUgcHJlY2VkaW5nLlxuICAgKiA8L3A+XG4gICAqIEB0eXBlIHtDYW1lcmFFdmVudFR5cGV8QXJyYXl8dW5kZWZpbmVkfVxuICAgKiBAZGVmYXVsdCB7QGxpbmsgQ2FtZXJhRXZlbnRUeXBlLkxFRlRfRFJBR31cbiAgICovXG4gIHRoaXMudHJhbnNsYXRlRXZlbnRUeXBlcyA9IENhbWVyYUV2ZW50VHlwZS5MRUZUX0RSQUc7XG4gIC8qKlxuICAgKiBUaGUgaW5wdXQgdGhhdCBhbGxvd3MgdGhlIHVzZXIgdG8gem9vbSBpbi9vdXQuXG4gICAqIDxwPlxuICAgKiBUaGUgdHlwZSBjYW1lIGJlIGEge0BsaW5rIENhbWVyYUV2ZW50VHlwZX0sIDxjb2RlPnVuZGVmaW5lZDwvY29kZT4sIGFuIG9iamVjdCB3aXRoIDxjb2RlPmV2ZW50VHlwZTwvY29kZT5cbiAgICogYW5kIDxjb2RlPm1vZGlmaWVyPC9jb2RlPiBwcm9wZXJ0aWVzIHdpdGggdHlwZXMgPGNvZGU+Q2FtZXJhRXZlbnRUeXBlPC9jb2RlPiBhbmQge0BsaW5rIEtleWJvYXJkRXZlbnRNb2RpZmllcn0sXG4gICAqIG9yIGFuIGFycmF5IG9mIGFueSBvZiB0aGUgcHJlY2VkaW5nLlxuICAgKiA8L3A+XG4gICAqIEB0eXBlIHtDYW1lcmFFdmVudFR5cGV8QXJyYXl8dW5kZWZpbmVkfVxuICAgKiBAZGVmYXVsdCBbe0BsaW5rIENhbWVyYUV2ZW50VHlwZS5SSUdIVF9EUkFHfSwge0BsaW5rIENhbWVyYUV2ZW50VHlwZS5XSEVFTH0sIHtAbGluayBDYW1lcmFFdmVudFR5cGUuUElOQ0h9XVxuICAgKi9cbiAgdGhpcy56b29tRXZlbnRUeXBlcyA9IFtcbiAgICBDYW1lcmFFdmVudFR5cGUuUklHSFRfRFJBRyxcbiAgICBDYW1lcmFFdmVudFR5cGUuV0hFRUwsXG4gICAgQ2FtZXJhRXZlbnRUeXBlLlBJTkNILFxuICBdO1xuICAvKipcbiAgICogVGhlIGlucHV0IHRoYXQgYWxsb3dzIHRoZSB1c2VyIHRvIHJvdGF0ZSBhcm91bmQgdGhlIGdsb2JlIG9yIGFub3RoZXIgb2JqZWN0LiBUaGlzIG9ubHkgYXBwbGllcyBpbiAzRCBhbmQgQ29sdW1idXMgdmlldyBtb2Rlcy5cbiAgICogPHA+XG4gICAqIFRoZSB0eXBlIGNhbWUgYmUgYSB7QGxpbmsgQ2FtZXJhRXZlbnRUeXBlfSwgPGNvZGU+dW5kZWZpbmVkPC9jb2RlPiwgYW4gb2JqZWN0IHdpdGggPGNvZGU+ZXZlbnRUeXBlPC9jb2RlPlxuICAgKiBhbmQgPGNvZGU+bW9kaWZpZXI8L2NvZGU+IHByb3BlcnRpZXMgd2l0aCB0eXBlcyA8Y29kZT5DYW1lcmFFdmVudFR5cGU8L2NvZGU+IGFuZCB7QGxpbmsgS2V5Ym9hcmRFdmVudE1vZGlmaWVyfSxcbiAgICogb3IgYW4gYXJyYXkgb2YgYW55IG9mIHRoZSBwcmVjZWRpbmcuXG4gICAqIDwvcD5cbiAgICogQHR5cGUge0NhbWVyYUV2ZW50VHlwZXxBcnJheXx1bmRlZmluZWR9XG4gICAqIEBkZWZhdWx0IHtAbGluayBDYW1lcmFFdmVudFR5cGUuTEVGVF9EUkFHfVxuICAgKi9cbiAgdGhpcy5yb3RhdGVFdmVudFR5cGVzID0gQ2FtZXJhRXZlbnRUeXBlLkxFRlRfRFJBRztcbiAgLyoqXG4gICAqIFRoZSBpbnB1dCB0aGF0IGFsbG93cyB0aGUgdXNlciB0byB0aWx0IGluIDNEIGFuZCBDb2x1bWJ1cyB2aWV3IG9yIHR3aXN0IGluIDJELlxuICAgKiA8cD5cbiAgICogVGhlIHR5cGUgY2FtZSBiZSBhIHtAbGluayBDYW1lcmFFdmVudFR5cGV9LCA8Y29kZT51bmRlZmluZWQ8L2NvZGU+LCBhbiBvYmplY3Qgd2l0aCA8Y29kZT5ldmVudFR5cGU8L2NvZGU+XG4gICAqIGFuZCA8Y29kZT5tb2RpZmllcjwvY29kZT4gcHJvcGVydGllcyB3aXRoIHR5cGVzIDxjb2RlPkNhbWVyYUV2ZW50VHlwZTwvY29kZT4gYW5kIHtAbGluayBLZXlib2FyZEV2ZW50TW9kaWZpZXJ9LFxuICAgKiBvciBhbiBhcnJheSBvZiBhbnkgb2YgdGhlIHByZWNlZGluZy5cbiAgICogPC9wPlxuICAgKiBAdHlwZSB7Q2FtZXJhRXZlbnRUeXBlfEFycmF5fHVuZGVmaW5lZH1cbiAgICogQGRlZmF1bHQgW3tAbGluayBDYW1lcmFFdmVudFR5cGUuTUlERExFX0RSQUd9LCB7QGxpbmsgQ2FtZXJhRXZlbnRUeXBlLlBJTkNIfSwge1xuICAgKiAgICAgZXZlbnRUeXBlIDoge0BsaW5rIENhbWVyYUV2ZW50VHlwZS5MRUZUX0RSQUd9LFxuICAgKiAgICAgbW9kaWZpZXIgOiB7QGxpbmsgS2V5Ym9hcmRFdmVudE1vZGlmaWVyLkNUUkx9XG4gICAqIH0sIHtcbiAgICogICAgIGV2ZW50VHlwZSA6IHtAbGluayBDYW1lcmFFdmVudFR5cGUuUklHSFRfRFJBR30sXG4gICAqICAgICBtb2RpZmllciA6IHtAbGluayBLZXlib2FyZEV2ZW50TW9kaWZpZXIuQ1RSTH1cbiAgICogfV1cbiAgICovXG4gIHRoaXMudGlsdEV2ZW50VHlwZXMgPSBbXG4gICAgQ2FtZXJhRXZlbnRUeXBlLk1JRERMRV9EUkFHLFxuICAgIENhbWVyYUV2ZW50VHlwZS5QSU5DSCxcbiAgICB7XG4gICAgICBldmVudFR5cGU6IENhbWVyYUV2ZW50VHlwZS5MRUZUX0RSQUcsXG4gICAgICBtb2RpZmllcjogS2V5Ym9hcmRFdmVudE1vZGlmaWVyLkNUUkwsXG4gICAgfSxcbiAgICB7XG4gICAgICBldmVudFR5cGU6IENhbWVyYUV2ZW50VHlwZS5SSUdIVF9EUkFHLFxuICAgICAgbW9kaWZpZXI6IEtleWJvYXJkRXZlbnRNb2RpZmllci5DVFJMLFxuICAgIH0sXG4gIF07XG4gIC8qKlxuICAgKiBUaGUgaW5wdXQgdGhhdCBhbGxvd3MgdGhlIHVzZXIgdG8gY2hhbmdlIHRoZSBkaXJlY3Rpb24gdGhlIGNhbWVyYSBpcyB2aWV3aW5nLiBUaGlzIG9ubHkgYXBwbGllcyBpbiAzRCBhbmQgQ29sdW1idXMgdmlldyBtb2Rlcy5cbiAgICogPHA+XG4gICAqIFRoZSB0eXBlIGNhbWUgYmUgYSB7QGxpbmsgQ2FtZXJhRXZlbnRUeXBlfSwgPGNvZGU+dW5kZWZpbmVkPC9jb2RlPiwgYW4gb2JqZWN0IHdpdGggPGNvZGU+ZXZlbnRUeXBlPC9jb2RlPlxuICAgKiBhbmQgPGNvZGU+bW9kaWZpZXI8L2NvZGU+IHByb3BlcnRpZXMgd2l0aCB0eXBlcyA8Y29kZT5DYW1lcmFFdmVudFR5cGU8L2NvZGU+IGFuZCB7QGxpbmsgS2V5Ym9hcmRFdmVudE1vZGlmaWVyfSxcbiAgICogb3IgYW4gYXJyYXkgb2YgYW55IG9mIHRoZSBwcmVjZWRpbmcuXG4gICAqIDwvcD5cbiAgICogQHR5cGUge0NhbWVyYUV2ZW50VHlwZXxBcnJheXx1bmRlZmluZWR9XG4gICAqIEBkZWZhdWx0IHsgZXZlbnRUeXBlIDoge0BsaW5rIENhbWVyYUV2ZW50VHlwZS5MRUZUX0RSQUd9LCBtb2RpZmllciA6IHtAbGluayBLZXlib2FyZEV2ZW50TW9kaWZpZXIuU0hJRlR9IH1cbiAgICovXG4gIHRoaXMubG9va0V2ZW50VHlwZXMgPSB7XG4gICAgZXZlbnRUeXBlOiBDYW1lcmFFdmVudFR5cGUuTEVGVF9EUkFHLFxuICAgIG1vZGlmaWVyOiBLZXlib2FyZEV2ZW50TW9kaWZpZXIuU0hJRlQsXG4gIH07XG4gIC8qKlxuICAgKiBUaGUgbWluaW11bSBoZWlnaHQgdGhlIGNhbWVyYSBtdXN0IGJlIGJlZm9yZSBwaWNraW5nIHRoZSB0ZXJyYWluIGluc3RlYWQgb2YgdGhlIGVsbGlwc29pZC5cbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMTUwMDAwLjBcbiAgICovXG4gIHRoaXMubWluaW11bVBpY2tpbmdUZXJyYWluSGVpZ2h0ID0gMTUwMDAwLjA7XG4gIHRoaXMuX21pbmltdW1QaWNraW5nVGVycmFpbkhlaWdodCA9IHRoaXMubWluaW11bVBpY2tpbmdUZXJyYWluSGVpZ2h0O1xuICAvKipcbiAgICogVGhlIG1pbmltdW0gaGVpZ2h0IHRoZSBjYW1lcmEgbXVzdCBiZSBiZWZvcmUgdGVzdGluZyBmb3IgY29sbGlzaW9uIHdpdGggdGVycmFpbi5cbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMTUwMDAuMFxuICAgKi9cbiAgdGhpcy5taW5pbXVtQ29sbGlzaW9uVGVycmFpbkhlaWdodCA9IDE1MDAwLjA7XG4gIHRoaXMuX21pbmltdW1Db2xsaXNpb25UZXJyYWluSGVpZ2h0ID0gdGhpcy5taW5pbXVtQ29sbGlzaW9uVGVycmFpbkhlaWdodDtcbiAgLyoqXG4gICAqIFRoZSBtaW5pbXVtIGhlaWdodCB0aGUgY2FtZXJhIG11c3QgYmUgYmVmb3JlIHN3aXRjaGluZyBmcm9tIHJvdGF0aW5nIGEgdHJhY2sgYmFsbCB0b1xuICAgKiBmcmVlIGxvb2sgd2hlbiBjbGlja3Mgb3JpZ2luYXRlIG9uIHRoZSBza3kgb3IgaW4gc3BhY2UuXG4gICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAqIEBkZWZhdWx0IDc1MDAwMDAuMFxuICAgKi9cbiAgdGhpcy5taW5pbXVtVHJhY2tCYWxsSGVpZ2h0ID0gNzUwMDAwMC4wO1xuICB0aGlzLl9taW5pbXVtVHJhY2tCYWxsSGVpZ2h0ID0gdGhpcy5taW5pbXVtVHJhY2tCYWxsSGVpZ2h0O1xuICAvKipcbiAgICogRW5hYmxlcyBvciBkaXNhYmxlcyBjYW1lcmEgY29sbGlzaW9uIGRldGVjdGlvbiB3aXRoIHRlcnJhaW4uXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICB0aGlzLmVuYWJsZUNvbGxpc2lvbkRldGVjdGlvbiA9IHRydWU7XG5cbiAgdGhpcy5fc2NlbmUgPSBzY2VuZTtcbiAgdGhpcy5fZ2xvYmUgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2VsbGlwc29pZCA9IHVuZGVmaW5lZDtcblxuICB0aGlzLl9hZ2dyZWdhdG9yID0gbmV3IENhbWVyYUV2ZW50QWdncmVnYXRvcihzY2VuZS5jYW52YXMpO1xuXG4gIHRoaXMuX2xhc3RJbmVydGlhU3Bpbk1vdmVtZW50ID0gdW5kZWZpbmVkO1xuICB0aGlzLl9sYXN0SW5lcnRpYVpvb21Nb3ZlbWVudCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fbGFzdEluZXJ0aWFUcmFuc2xhdGVNb3ZlbWVudCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fbGFzdEluZXJ0aWFUaWx0TW92ZW1lbnQgPSB1bmRlZmluZWQ7XG5cbiAgLy8gWm9vbSBkaXNhYmxlcyB0aWx0LCBzcGluLCBhbmQgdHJhbnNsYXRlIGluZXJ0aWFcbiAgLy8gVGlsdCBkaXNhYmxlcyBzcGluIGFuZCB0cmFuc2xhdGUgaW5lcnRpYVxuICB0aGlzLl9pbmVydGlhRGlzYWJsZXJzID0ge1xuICAgIF9sYXN0SW5lcnRpYVpvb21Nb3ZlbWVudDogW1xuICAgICAgXCJfbGFzdEluZXJ0aWFTcGluTW92ZW1lbnRcIixcbiAgICAgIFwiX2xhc3RJbmVydGlhVHJhbnNsYXRlTW92ZW1lbnRcIixcbiAgICAgIFwiX2xhc3RJbmVydGlhVGlsdE1vdmVtZW50XCIsXG4gICAgXSxcbiAgICBfbGFzdEluZXJ0aWFUaWx0TW92ZW1lbnQ6IFtcbiAgICAgIFwiX2xhc3RJbmVydGlhU3Bpbk1vdmVtZW50XCIsXG4gICAgICBcIl9sYXN0SW5lcnRpYVRyYW5zbGF0ZU1vdmVtZW50XCIsXG4gICAgXSxcbiAgfTtcblxuICB0aGlzLl90d2VlbnMgPSBuZXcgVHdlZW5Db2xsZWN0aW9uKCk7XG4gIHRoaXMuX3R3ZWVuID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMuX2hvcml6b250YWxSb3RhdGlvbkF4aXMgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fdGlsdENlbnRlck1vdXNlUG9zaXRpb24gPSBuZXcgQ2FydGVzaWFuMigtMS4wLCAtMS4wKTtcbiAgdGhpcy5fdGlsdENlbnRlciA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG4gIHRoaXMuX3JvdGF0ZU1vdXNlUG9zaXRpb24gPSBuZXcgQ2FydGVzaWFuMigtMS4wLCAtMS4wKTtcbiAgdGhpcy5fcm90YXRlU3RhcnRQb3NpdGlvbiA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG4gIHRoaXMuX3N0cmFmZVN0YXJ0UG9zaXRpb24gPSBuZXcgQ2FydGVzaWFuMygpO1xuICB0aGlzLl9zdHJhZmVNb3VzZVBvc2l0aW9uID0gbmV3IENhcnRlc2lhbjIoKTtcbiAgdGhpcy5fc3RyYWZlRW5kTW91c2VQb3NpdGlvbiA9IG5ldyBDYXJ0ZXNpYW4yKCk7XG4gIHRoaXMuX3pvb21Nb3VzZVN0YXJ0ID0gbmV3IENhcnRlc2lhbjIoLTEuMCwgLTEuMCk7XG4gIHRoaXMuX3pvb21Xb3JsZFBvc2l0aW9uID0gbmV3IENhcnRlc2lhbjMoKTtcbiAgdGhpcy5fdXNlWm9vbVdvcmxkUG9zaXRpb24gPSBmYWxzZTtcbiAgdGhpcy5fdGlsdENWT2ZmTWFwID0gZmFsc2U7XG4gIHRoaXMuX2xvb2tpbmcgPSBmYWxzZTtcbiAgdGhpcy5fcm90YXRpbmcgPSBmYWxzZTtcbiAgdGhpcy5fc3RyYWZpbmcgPSBmYWxzZTtcbiAgdGhpcy5fem9vbWluZ09uVmVjdG9yID0gZmFsc2U7XG4gIHRoaXMuX3pvb21pbmdVbmRlcmdyb3VuZCA9IGZhbHNlO1xuICB0aGlzLl9yb3RhdGluZ1pvb20gPSBmYWxzZTtcbiAgdGhpcy5fYWRqdXN0ZWRIZWlnaHRGb3JUZXJyYWluID0gZmFsc2U7XG4gIHRoaXMuX2NhbWVyYVVuZGVyZ3JvdW5kID0gZmFsc2U7XG5cbiAgdmFyIHByb2plY3Rpb24gPSBzY2VuZS5tYXBQcm9qZWN0aW9uO1xuICB0aGlzLl9tYXhDb29yZCA9IHByb2plY3Rpb24ucHJvamVjdChcbiAgICBuZXcgQ2FydG9ncmFwaGljKE1hdGguUEksIENlc2l1bU1hdGguUElfT1ZFUl9UV08pXG4gICk7XG5cbiAgLy8gQ29uc3RhbnRzLCBNYWtlIGFueSBvZiB0aGVzZSBwdWJsaWM/XG4gIHRoaXMuX3pvb21GYWN0b3IgPSA1LjA7XG4gIHRoaXMuX3JvdGF0ZUZhY3RvciA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fcm90YXRlUmF0ZVJhbmdlQWRqdXN0bWVudCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fbWF4aW11bVJvdGF0ZVJhdGUgPSAxLjc3O1xuICB0aGlzLl9taW5pbXVtUm90YXRlUmF0ZSA9IDEuMCAvIDUwMDAuMDtcbiAgdGhpcy5fbWluaW11bVpvb21SYXRlID0gMjAuMDtcbiAgdGhpcy5fbWF4aW11bVpvb21SYXRlID0gNTkwNjM3NjI3MjAwMC4wOyAvLyBkaXN0YW5jZSBmcm9tIHRoZSBTdW4gdG8gUGx1dG8gaW4gbWV0ZXJzLlxuICB0aGlzLl9taW5pbXVtVW5kZXJncm91bmRQaWNrRGlzdGFuY2UgPSAyMDAwLjA7XG4gIHRoaXMuX21heGltdW1VbmRlcmdyb3VuZFBpY2tEaXN0YW5jZSA9IDEwMDAwLjA7XG59XG5cbmZ1bmN0aW9uIGRlY2F5KHRpbWUsIGNvZWZmaWNpZW50KSB7XG4gIGlmICh0aW1lIDwgMCkge1xuICAgIHJldHVybiAwLjA7XG4gIH1cblxuICB2YXIgdGF1ID0gKDEuMCAtIGNvZWZmaWNpZW50KSAqIDI1LjA7XG4gIHJldHVybiBNYXRoLmV4cCgtdGF1ICogdGltZSk7XG59XG5cbmZ1bmN0aW9uIHNhbWVNb3VzZVBvc2l0aW9uKG1vdmVtZW50KSB7XG4gIHJldHVybiBDYXJ0ZXNpYW4yLmVxdWFsc0Vwc2lsb24oXG4gICAgbW92ZW1lbnQuc3RhcnRQb3NpdGlvbixcbiAgICBtb3ZlbWVudC5lbmRQb3NpdGlvbixcbiAgICBDZXNpdW1NYXRoLkVQU0lMT04xNFxuICApO1xufVxuXG4vLyBJZiB0aGUgdGltZSBiZXR3ZWVuIG1vdXNlIGRvd24gYW5kIG1vdXNlIHVwIGlzIG5vdCBiZXR3ZWVuXG4vLyB0aGVzZSB0aHJlc2hvbGRzLCB0aGUgY2FtZXJhIHdpbGwgbm90IG1vdmUgd2l0aCBpbmVydGlhLlxuLy8gVGhpcyB2YWx1ZSBpcyBwcm9iYWJseSBkZXBlbmRlbnQgb24gdGhlIGJyb3dzZXIgYW5kL29yIHRoZVxuLy8gaGFyZHdhcmUuIFNob3VsZCBiZSBpbnZlc3RpZ2F0ZWQgZnVydGhlci5cbnZhciBpbmVydGlhTWF4Q2xpY2tUaW1lVGhyZXNob2xkID0gMC40O1xuXG5mdW5jdGlvbiBtYWludGFpbkluZXJ0aWEoXG4gIGFnZ3JlZ2F0b3IsXG4gIHR5cGUsXG4gIG1vZGlmaWVyLFxuICBkZWNheUNvZWYsXG4gIGFjdGlvbixcbiAgb2JqZWN0LFxuICBsYXN0TW92ZW1lbnROYW1lXG4pIHtcbiAgdmFyIG1vdmVtZW50U3RhdGUgPSBvYmplY3RbbGFzdE1vdmVtZW50TmFtZV07XG4gIGlmICghZGVmaW5lZChtb3ZlbWVudFN0YXRlKSkge1xuICAgIG1vdmVtZW50U3RhdGUgPSBvYmplY3RbbGFzdE1vdmVtZW50TmFtZV0gPSB7XG4gICAgICBzdGFydFBvc2l0aW9uOiBuZXcgQ2FydGVzaWFuMigpLFxuICAgICAgZW5kUG9zaXRpb246IG5ldyBDYXJ0ZXNpYW4yKCksXG4gICAgICBtb3Rpb246IG5ldyBDYXJ0ZXNpYW4yKCksXG4gICAgICBpbmVydGlhRW5hYmxlZDogdHJ1ZSxcbiAgICB9O1xuICB9XG5cbiAgdmFyIHRzID0gYWdncmVnYXRvci5nZXRCdXR0b25QcmVzc1RpbWUodHlwZSwgbW9kaWZpZXIpO1xuICB2YXIgdHIgPSBhZ2dyZWdhdG9yLmdldEJ1dHRvblJlbGVhc2VUaW1lKHR5cGUsIG1vZGlmaWVyKTtcblxuICB2YXIgdGhyZXNob2xkID0gdHMgJiYgdHIgJiYgKHRyLmdldFRpbWUoKSAtIHRzLmdldFRpbWUoKSkgLyAxMDAwLjA7XG4gIHZhciBub3cgPSBuZXcgRGF0ZSgpO1xuICB2YXIgZnJvbU5vdyA9IHRyICYmIChub3cuZ2V0VGltZSgpIC0gdHIuZ2V0VGltZSgpKSAvIDEwMDAuMDtcblxuICBpZiAodHMgJiYgdHIgJiYgdGhyZXNob2xkIDwgaW5lcnRpYU1heENsaWNrVGltZVRocmVzaG9sZCkge1xuICAgIHZhciBkID0gZGVjYXkoZnJvbU5vdywgZGVjYXlDb2VmKTtcblxuICAgIHZhciBsYXN0TW92ZW1lbnQgPSBhZ2dyZWdhdG9yLmdldExhc3RNb3ZlbWVudCh0eXBlLCBtb2RpZmllcik7XG4gICAgaWYgKFxuICAgICAgIWRlZmluZWQobGFzdE1vdmVtZW50KSB8fFxuICAgICAgc2FtZU1vdXNlUG9zaXRpb24obGFzdE1vdmVtZW50KSB8fFxuICAgICAgIW1vdmVtZW50U3RhdGUuaW5lcnRpYUVuYWJsZWRcbiAgICApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBtb3ZlbWVudFN0YXRlLm1vdGlvbi54ID1cbiAgICAgIChsYXN0TW92ZW1lbnQuZW5kUG9zaXRpb24ueCAtIGxhc3RNb3ZlbWVudC5zdGFydFBvc2l0aW9uLngpICogMC41O1xuICAgIG1vdmVtZW50U3RhdGUubW90aW9uLnkgPVxuICAgICAgKGxhc3RNb3ZlbWVudC5lbmRQb3NpdGlvbi55IC0gbGFzdE1vdmVtZW50LnN0YXJ0UG9zaXRpb24ueSkgKiAwLjU7XG5cbiAgICBtb3ZlbWVudFN0YXRlLnN0YXJ0UG9zaXRpb24gPSBDYXJ0ZXNpYW4yLmNsb25lKFxuICAgICAgbGFzdE1vdmVtZW50LnN0YXJ0UG9zaXRpb24sXG4gICAgICBtb3ZlbWVudFN0YXRlLnN0YXJ0UG9zaXRpb25cbiAgICApO1xuXG4gICAgbW92ZW1lbnRTdGF0ZS5lbmRQb3NpdGlvbiA9IENhcnRlc2lhbjIubXVsdGlwbHlCeVNjYWxhcihcbiAgICAgIG1vdmVtZW50U3RhdGUubW90aW9uLFxuICAgICAgZCxcbiAgICAgIG1vdmVtZW50U3RhdGUuZW5kUG9zaXRpb25cbiAgICApO1xuICAgIG1vdmVtZW50U3RhdGUuZW5kUG9zaXRpb24gPSBDYXJ0ZXNpYW4yLmFkZChcbiAgICAgIG1vdmVtZW50U3RhdGUuc3RhcnRQb3NpdGlvbixcbiAgICAgIG1vdmVtZW50U3RhdGUuZW5kUG9zaXRpb24sXG4gICAgICBtb3ZlbWVudFN0YXRlLmVuZFBvc2l0aW9uXG4gICAgKTtcblxuICAgIC8vIElmIHZhbHVlIGZyb20gdGhlIGRlY3JlYXNpbmcgZXhwb25lbnRpYWwgZnVuY3Rpb24gaXMgY2xvc2UgdG8gemVybyxcbiAgICAvLyB0aGUgZW5kIGNvb3JkaW5hdGVzIG1heSBiZSBOYU4uXG4gICAgaWYgKFxuICAgICAgaXNOYU4obW92ZW1lbnRTdGF0ZS5lbmRQb3NpdGlvbi54KSB8fFxuICAgICAgaXNOYU4obW92ZW1lbnRTdGF0ZS5lbmRQb3NpdGlvbi55KSB8fFxuICAgICAgQ2FydGVzaWFuMi5kaXN0YW5jZShcbiAgICAgICAgbW92ZW1lbnRTdGF0ZS5zdGFydFBvc2l0aW9uLFxuICAgICAgICBtb3ZlbWVudFN0YXRlLmVuZFBvc2l0aW9uXG4gICAgICApIDwgMC41XG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFhZ2dyZWdhdG9yLmlzQnV0dG9uRG93bih0eXBlLCBtb2RpZmllcikpIHtcbiAgICAgIHZhciBzdGFydFBvc2l0aW9uID0gYWdncmVnYXRvci5nZXRTdGFydE1vdXNlUG9zaXRpb24odHlwZSwgbW9kaWZpZXIpO1xuICAgICAgYWN0aW9uKG9iamVjdCwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnRTdGF0ZSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGFjdGl2YXRlSW5lcnRpYShjb250cm9sbGVyLCBpbmVydGlhU3RhdGVOYW1lKSB7XG4gIGlmIChkZWZpbmVkKGluZXJ0aWFTdGF0ZU5hbWUpKSB7XG4gICAgLy8gUmUtZW5hYmxlIGluZXJ0aWEgaWYgaXQgd2FzIGRpc2FibGVkXG4gICAgdmFyIG1vdmVtZW50U3RhdGUgPSBjb250cm9sbGVyW2luZXJ0aWFTdGF0ZU5hbWVdO1xuICAgIGlmIChkZWZpbmVkKG1vdmVtZW50U3RhdGUpKSB7XG4gICAgICBtb3ZlbWVudFN0YXRlLmluZXJ0aWFFbmFibGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgLy8gRGlzYWJsZSBpbmVydGlhIG9uIG90aGVyIG1vdmVtZW50c1xuICAgIHZhciBpbmVydGlhc1RvRGlzYWJsZSA9IGNvbnRyb2xsZXIuX2luZXJ0aWFEaXNhYmxlcnNbaW5lcnRpYVN0YXRlTmFtZV07XG4gICAgaWYgKGRlZmluZWQoaW5lcnRpYXNUb0Rpc2FibGUpKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gaW5lcnRpYXNUb0Rpc2FibGUubGVuZ3RoO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgICBtb3ZlbWVudFN0YXRlID0gY29udHJvbGxlcltpbmVydGlhc1RvRGlzYWJsZVtpXV07XG4gICAgICAgIGlmIChkZWZpbmVkKG1vdmVtZW50U3RhdGUpKSB7XG4gICAgICAgICAgbW92ZW1lbnRTdGF0ZS5pbmVydGlhRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbnZhciBzY3JhdGNoRXZlbnRUeXBlQXJyYXkgPSBbXTtcblxuZnVuY3Rpb24gcmVhY3RUb0lucHV0KFxuICBjb250cm9sbGVyLFxuICBlbmFibGVkLFxuICBldmVudFR5cGVzLFxuICBhY3Rpb24sXG4gIGluZXJ0aWFDb25zdGFudCxcbiAgaW5lcnRpYVN0YXRlTmFtZVxuKSB7XG4gIGlmICghZGVmaW5lZChldmVudFR5cGVzKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBhZ2dyZWdhdG9yID0gY29udHJvbGxlci5fYWdncmVnYXRvcjtcblxuICBpZiAoIUFycmF5LmlzQXJyYXkoZXZlbnRUeXBlcykpIHtcbiAgICBzY3JhdGNoRXZlbnRUeXBlQXJyYXlbMF0gPSBldmVudFR5cGVzO1xuICAgIGV2ZW50VHlwZXMgPSBzY3JhdGNoRXZlbnRUeXBlQXJyYXk7XG4gIH1cblxuICB2YXIgbGVuZ3RoID0gZXZlbnRUeXBlcy5sZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgZXZlbnRUeXBlID0gZXZlbnRUeXBlc1tpXTtcbiAgICB2YXIgdHlwZSA9IGRlZmluZWQoZXZlbnRUeXBlLmV2ZW50VHlwZSkgPyBldmVudFR5cGUuZXZlbnRUeXBlIDogZXZlbnRUeXBlO1xuICAgIHZhciBtb2RpZmllciA9IGV2ZW50VHlwZS5tb2RpZmllcjtcblxuICAgIHZhciBtb3ZlbWVudCA9XG4gICAgICBhZ2dyZWdhdG9yLmlzTW92aW5nKHR5cGUsIG1vZGlmaWVyKSAmJlxuICAgICAgYWdncmVnYXRvci5nZXRNb3ZlbWVudCh0eXBlLCBtb2RpZmllcik7XG4gICAgdmFyIHN0YXJ0UG9zaXRpb24gPSBhZ2dyZWdhdG9yLmdldFN0YXJ0TW91c2VQb3NpdGlvbih0eXBlLCBtb2RpZmllcik7XG5cbiAgICBpZiAoY29udHJvbGxlci5lbmFibGVJbnB1dHMgJiYgZW5hYmxlZCkge1xuICAgICAgaWYgKG1vdmVtZW50KSB7XG4gICAgICAgIGFjdGlvbihjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCk7XG4gICAgICAgIGFjdGl2YXRlSW5lcnRpYShjb250cm9sbGVyLCBpbmVydGlhU3RhdGVOYW1lKTtcbiAgICAgIH0gZWxzZSBpZiAoaW5lcnRpYUNvbnN0YW50IDwgMS4wKSB7XG4gICAgICAgIG1haW50YWluSW5lcnRpYShcbiAgICAgICAgICBhZ2dyZWdhdG9yLFxuICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgbW9kaWZpZXIsXG4gICAgICAgICAgaW5lcnRpYUNvbnN0YW50LFxuICAgICAgICAgIGFjdGlvbixcbiAgICAgICAgICBjb250cm9sbGVyLFxuICAgICAgICAgIGluZXJ0aWFTdGF0ZU5hbWVcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxudmFyIHNjcmF0Y2hab29tUGlja1JheSA9IG5ldyBSYXkoKTtcbnZhciBzY3JhdGNoUGlja0NhcnRlc2lhbiA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaFpvb21PZmZzZXQgPSBuZXcgQ2FydGVzaWFuMigpO1xudmFyIHNjcmF0Y2hab29tRGlyZWN0aW9uID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoQ2VudGVyUGl4ZWwgPSBuZXcgQ2FydGVzaWFuMigpO1xudmFyIHNjcmF0Y2hDZW50ZXJQb3NpdGlvbiA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaFBvc2l0aW9uTm9ybWFsID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoUGlja05vcm1hbCA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaFpvb21BeGlzID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoQ2FtZXJhUG9zaXRpb25Ob3JtYWwgPSBuZXcgQ2FydGVzaWFuMygpO1xuXG4vLyBTY3JhdGNoIHZhcmlhYmxlcyB1c2VkIGluIHpvb21pbmcgYWxnb3JpdGhtXG52YXIgc2NyYXRjaFRhcmdldE5vcm1hbCA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaENhbWVyYVBvc2l0aW9uID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoQ2FtZXJhVXBOb3JtYWwgPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHNjcmF0Y2hDYW1lcmFSaWdodE5vcm1hbCA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaEZvcndhcmROb3JtYWwgPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHNjcmF0Y2hQb3NpdGlvblRvVGFyZ2V0ID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoUG9zaXRpb25Ub1RhcmdldE5vcm1hbCA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaFBhbiA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaENlbnRlck1vdmVtZW50ID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoQ2VudGVyID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoQ2FydGVzaWFuID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoQ2FydGVzaWFuVHdvID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoQ2FydGVzaWFuVGhyZWUgPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHNjcmF0Y2hab29tVmlld09wdGlvbnMgPSB7XG4gIG9yaWVudGF0aW9uOiBuZXcgSGVhZGluZ1BpdGNoUm9sbCgpLFxufTtcblxuZnVuY3Rpb24gaGFuZGxlWm9vbShcbiAgb2JqZWN0LFxuICBzdGFydFBvc2l0aW9uLFxuICBtb3ZlbWVudCxcbiAgem9vbUZhY3RvcixcbiAgZGlzdGFuY2VNZWFzdXJlLFxuICB1bml0UG9zaXRpb25Eb3REaXJlY3Rpb25cbikge1xuICB2YXIgcGVyY2VudGFnZSA9IDEuMDtcbiAgaWYgKGRlZmluZWQodW5pdFBvc2l0aW9uRG90RGlyZWN0aW9uKSkge1xuICAgIHBlcmNlbnRhZ2UgPSBDZXNpdW1NYXRoLmNsYW1wKFxuICAgICAgTWF0aC5hYnModW5pdFBvc2l0aW9uRG90RGlyZWN0aW9uKSxcbiAgICAgIDAuMjUsXG4gICAgICAxLjBcbiAgICApO1xuICB9XG5cbiAgLy8gZGlzdGFuY2VNZWFzdXJlIHNob3VsZCBiZSB0aGUgaGVpZ2h0IGFib3ZlIHRoZSBlbGxpcHNvaWQuXG4gIC8vIFRoZSB6b29tUmF0ZSBzbG93cyBhcyBpdCBhcHByb2FjaGVzIHRoZSBzdXJmYWNlIGFuZCBzdG9wcyBtaW5pbXVtWm9vbURpc3RhbmNlIGFib3ZlIGl0LlxuICB2YXIgbWluSGVpZ2h0ID0gb2JqZWN0Lm1pbmltdW1ab29tRGlzdGFuY2UgKiBwZXJjZW50YWdlO1xuICB2YXIgbWF4SGVpZ2h0ID0gb2JqZWN0Lm1heGltdW1ab29tRGlzdGFuY2U7XG5cbiAgdmFyIG1pbkRpc3RhbmNlID0gZGlzdGFuY2VNZWFzdXJlIC0gbWluSGVpZ2h0O1xuICB2YXIgem9vbVJhdGUgPSB6b29tRmFjdG9yICogbWluRGlzdGFuY2U7XG4gIHpvb21SYXRlID0gQ2VzaXVtTWF0aC5jbGFtcChcbiAgICB6b29tUmF0ZSxcbiAgICBvYmplY3QuX21pbmltdW1ab29tUmF0ZSxcbiAgICBvYmplY3QuX21heGltdW1ab29tUmF0ZVxuICApO1xuXG4gIHZhciBkaWZmID0gbW92ZW1lbnQuZW5kUG9zaXRpb24ueSAtIG1vdmVtZW50LnN0YXJ0UG9zaXRpb24ueTtcbiAgdmFyIHJhbmdlV2luZG93UmF0aW8gPSBkaWZmIC8gb2JqZWN0Ll9zY2VuZS5jYW52YXMuY2xpZW50SGVpZ2h0O1xuICByYW5nZVdpbmRvd1JhdGlvID0gTWF0aC5taW4ocmFuZ2VXaW5kb3dSYXRpbywgb2JqZWN0Lm1heGltdW1Nb3ZlbWVudFJhdGlvKTtcbiAgdmFyIGRpc3RhbmNlID0gem9vbVJhdGUgKiByYW5nZVdpbmRvd1JhdGlvO1xuXG4gIGlmIChcbiAgICBvYmplY3QuZW5hYmxlQ29sbGlzaW9uRGV0ZWN0aW9uIHx8XG4gICAgb2JqZWN0Lm1pbmltdW1ab29tRGlzdGFuY2UgPT09IDAuMCB8fFxuICAgICFkZWZpbmVkKG9iamVjdC5fZ2xvYmUpIC8vIGxvb2stYXQgbW9kZVxuICApIHtcbiAgICBpZiAoZGlzdGFuY2UgPiAwLjAgJiYgTWF0aC5hYnMoZGlzdGFuY2VNZWFzdXJlIC0gbWluSGVpZ2h0KSA8IDEuMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChkaXN0YW5jZSA8IDAuMCAmJiBNYXRoLmFicyhkaXN0YW5jZU1lYXN1cmUgLSBtYXhIZWlnaHQpIDwgMS4wKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGRpc3RhbmNlTWVhc3VyZSAtIGRpc3RhbmNlIDwgbWluSGVpZ2h0KSB7XG4gICAgICBkaXN0YW5jZSA9IGRpc3RhbmNlTWVhc3VyZSAtIG1pbkhlaWdodCAtIDEuMDtcbiAgICB9IGVsc2UgaWYgKGRpc3RhbmNlTWVhc3VyZSAtIGRpc3RhbmNlID4gbWF4SGVpZ2h0KSB7XG4gICAgICBkaXN0YW5jZSA9IGRpc3RhbmNlTWVhc3VyZSAtIG1heEhlaWdodDtcbiAgICB9XG4gIH1cblxuICB2YXIgc2NlbmUgPSBvYmplY3QuX3NjZW5lO1xuICB2YXIgY2FtZXJhID0gc2NlbmUuY2FtZXJhO1xuICB2YXIgbW9kZSA9IHNjZW5lLm1vZGU7XG5cbiAgdmFyIG9yaWVudGF0aW9uID0gc2NyYXRjaFpvb21WaWV3T3B0aW9ucy5vcmllbnRhdGlvbjtcbiAgb3JpZW50YXRpb24uaGVhZGluZyA9IGNhbWVyYS5oZWFkaW5nO1xuICBvcmllbnRhdGlvbi5waXRjaCA9IGNhbWVyYS5waXRjaDtcbiAgb3JpZW50YXRpb24ucm9sbCA9IGNhbWVyYS5yb2xsO1xuXG4gIGlmIChjYW1lcmEuZnJ1c3R1bSBpbnN0YW5jZW9mIE9ydGhvZ3JhcGhpY0ZydXN0dW0pIHtcbiAgICBpZiAoTWF0aC5hYnMoZGlzdGFuY2UpID4gMC4wKSB7XG4gICAgICBjYW1lcmEuem9vbUluKGRpc3RhbmNlKTtcbiAgICAgIGNhbWVyYS5fYWRqdXN0T3J0aG9ncmFwaGljRnJ1c3R1bSgpO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc2FtZVN0YXJ0UG9zaXRpb24gPSBDYXJ0ZXNpYW4yLmVxdWFscyhcbiAgICBzdGFydFBvc2l0aW9uLFxuICAgIG9iamVjdC5fem9vbU1vdXNlU3RhcnRcbiAgKTtcbiAgdmFyIHpvb21pbmdPblZlY3RvciA9IG9iamVjdC5fem9vbWluZ09uVmVjdG9yO1xuICB2YXIgcm90YXRpbmdab29tID0gb2JqZWN0Ll9yb3RhdGluZ1pvb207XG4gIHZhciBwaWNrZWRQb3NpdGlvbjtcblxuICBpZiAoIXNhbWVTdGFydFBvc2l0aW9uKSB7XG4gICAgb2JqZWN0Ll96b29tTW91c2VTdGFydCA9IENhcnRlc2lhbjIuY2xvbmUoXG4gICAgICBzdGFydFBvc2l0aW9uLFxuICAgICAgb2JqZWN0Ll96b29tTW91c2VTdGFydFxuICAgICk7XG5cbiAgICBpZiAoZGVmaW5lZChvYmplY3QuX2dsb2JlKSkge1xuICAgICAgaWYgKG1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTJEKSB7XG4gICAgICAgIHBpY2tlZFBvc2l0aW9uID0gY2FtZXJhLmdldFBpY2tSYXkoc3RhcnRQb3NpdGlvbiwgc2NyYXRjaFpvb21QaWNrUmF5KVxuICAgICAgICAgIC5vcmlnaW47XG4gICAgICAgIHBpY2tlZFBvc2l0aW9uID0gQ2FydGVzaWFuMy5mcm9tRWxlbWVudHMoXG4gICAgICAgICAgcGlja2VkUG9zaXRpb24ueSxcbiAgICAgICAgICBwaWNrZWRQb3NpdGlvbi56LFxuICAgICAgICAgIHBpY2tlZFBvc2l0aW9uLnhcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBpY2tlZFBvc2l0aW9uID0gcGlja0dsb2JlKG9iamVjdCwgc3RhcnRQb3NpdGlvbiwgc2NyYXRjaFBpY2tDYXJ0ZXNpYW4pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZGVmaW5lZChwaWNrZWRQb3NpdGlvbikpIHtcbiAgICAgIG9iamVjdC5fdXNlWm9vbVdvcmxkUG9zaXRpb24gPSB0cnVlO1xuICAgICAgb2JqZWN0Ll96b29tV29ybGRQb3NpdGlvbiA9IENhcnRlc2lhbjMuY2xvbmUoXG4gICAgICAgIHBpY2tlZFBvc2l0aW9uLFxuICAgICAgICBvYmplY3QuX3pvb21Xb3JsZFBvc2l0aW9uXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBvYmplY3QuX3VzZVpvb21Xb3JsZFBvc2l0aW9uID0gZmFsc2U7XG4gICAgfVxuXG4gICAgem9vbWluZ09uVmVjdG9yID0gb2JqZWN0Ll96b29taW5nT25WZWN0b3IgPSBmYWxzZTtcbiAgICByb3RhdGluZ1pvb20gPSBvYmplY3QuX3JvdGF0aW5nWm9vbSA9IGZhbHNlO1xuICAgIG9iamVjdC5fem9vbWluZ1VuZGVyZ3JvdW5kID0gb2JqZWN0Ll9jYW1lcmFVbmRlcmdyb3VuZDtcbiAgfVxuXG4gIGlmICghb2JqZWN0Ll91c2Vab29tV29ybGRQb3NpdGlvbikge1xuICAgIGNhbWVyYS56b29tSW4oZGlzdGFuY2UpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciB6b29tT25WZWN0b3IgPSBtb2RlID09PSBTY2VuZU1vZGUuQ09MVU1CVVNfVklFVztcblxuICBpZiAoY2FtZXJhLnBvc2l0aW9uQ2FydG9ncmFwaGljLmhlaWdodCA8IDIwMDAwMDApIHtcbiAgICByb3RhdGluZ1pvb20gPSB0cnVlO1xuICB9XG5cbiAgaWYgKCFzYW1lU3RhcnRQb3NpdGlvbiB8fCByb3RhdGluZ1pvb20pIHtcbiAgICBpZiAobW9kZSA9PT0gU2NlbmVNb2RlLlNDRU5FMkQpIHtcbiAgICAgIHZhciB3b3JsZFBvc2l0aW9uID0gb2JqZWN0Ll96b29tV29ybGRQb3NpdGlvbjtcbiAgICAgIHZhciBlbmRQb3NpdGlvbiA9IGNhbWVyYS5wb3NpdGlvbjtcblxuICAgICAgaWYgKFxuICAgICAgICAhQ2FydGVzaWFuMy5lcXVhbHMod29ybGRQb3NpdGlvbiwgZW5kUG9zaXRpb24pICYmXG4gICAgICAgIGNhbWVyYS5wb3NpdGlvbkNhcnRvZ3JhcGhpYy5oZWlnaHQgPCBvYmplY3QuX21heENvb3JkLnggKiAyLjBcbiAgICAgICkge1xuICAgICAgICB2YXIgc2F2ZWRYID0gY2FtZXJhLnBvc2l0aW9uLng7XG5cbiAgICAgICAgdmFyIGRpcmVjdGlvbiA9IENhcnRlc2lhbjMuc3VidHJhY3QoXG4gICAgICAgICAgd29ybGRQb3NpdGlvbixcbiAgICAgICAgICBlbmRQb3NpdGlvbixcbiAgICAgICAgICBzY3JhdGNoWm9vbURpcmVjdGlvblxuICAgICAgICApO1xuICAgICAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShkaXJlY3Rpb24sIGRpcmVjdGlvbik7XG5cbiAgICAgICAgdmFyIGQgPVxuICAgICAgICAgIChDYXJ0ZXNpYW4zLmRpc3RhbmNlKHdvcmxkUG9zaXRpb24sIGVuZFBvc2l0aW9uKSAqIGRpc3RhbmNlKSAvXG4gICAgICAgICAgKGNhbWVyYS5nZXRNYWduaXR1ZGUoKSAqIDAuNSk7XG4gICAgICAgIGNhbWVyYS5tb3ZlKGRpcmVjdGlvbiwgZCAqIDAuNSk7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIChjYW1lcmEucG9zaXRpb24ueCA8IDAuMCAmJiBzYXZlZFggPiAwLjApIHx8XG4gICAgICAgICAgKGNhbWVyYS5wb3NpdGlvbi54ID4gMC4wICYmIHNhdmVkWCA8IDAuMClcbiAgICAgICAgKSB7XG4gICAgICAgICAgcGlja2VkUG9zaXRpb24gPSBjYW1lcmEuZ2V0UGlja1JheShzdGFydFBvc2l0aW9uLCBzY3JhdGNoWm9vbVBpY2tSYXkpXG4gICAgICAgICAgICAub3JpZ2luO1xuICAgICAgICAgIHBpY2tlZFBvc2l0aW9uID0gQ2FydGVzaWFuMy5mcm9tRWxlbWVudHMoXG4gICAgICAgICAgICBwaWNrZWRQb3NpdGlvbi55LFxuICAgICAgICAgICAgcGlja2VkUG9zaXRpb24ueixcbiAgICAgICAgICAgIHBpY2tlZFBvc2l0aW9uLnhcbiAgICAgICAgICApO1xuICAgICAgICAgIG9iamVjdC5fem9vbVdvcmxkUG9zaXRpb24gPSBDYXJ0ZXNpYW4zLmNsb25lKFxuICAgICAgICAgICAgcGlja2VkUG9zaXRpb24sXG4gICAgICAgICAgICBvYmplY3QuX3pvb21Xb3JsZFBvc2l0aW9uXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gU2NlbmVNb2RlLlNDRU5FM0QpIHtcbiAgICAgIHZhciBjYW1lcmFQb3NpdGlvbk5vcm1hbCA9IENhcnRlc2lhbjMubm9ybWFsaXplKFxuICAgICAgICBjYW1lcmEucG9zaXRpb24sXG4gICAgICAgIHNjcmF0Y2hDYW1lcmFQb3NpdGlvbk5vcm1hbFxuICAgICAgKTtcbiAgICAgIGlmIChcbiAgICAgICAgb2JqZWN0Ll9jYW1lcmFVbmRlcmdyb3VuZCB8fFxuICAgICAgICBvYmplY3QuX3pvb21pbmdVbmRlcmdyb3VuZCB8fFxuICAgICAgICAoY2FtZXJhLnBvc2l0aW9uQ2FydG9ncmFwaGljLmhlaWdodCA8IDMwMDAuMCAmJlxuICAgICAgICAgIE1hdGguYWJzKENhcnRlc2lhbjMuZG90KGNhbWVyYS5kaXJlY3Rpb24sIGNhbWVyYVBvc2l0aW9uTm9ybWFsKSkgPFxuICAgICAgICAgICAgMC42KVxuICAgICAgKSB7XG4gICAgICAgIHpvb21PblZlY3RvciA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY2FudmFzID0gc2NlbmUuY2FudmFzO1xuXG4gICAgICAgIHZhciBjZW50ZXJQaXhlbCA9IHNjcmF0Y2hDZW50ZXJQaXhlbDtcbiAgICAgICAgY2VudGVyUGl4ZWwueCA9IGNhbnZhcy5jbGllbnRXaWR0aCAvIDI7XG4gICAgICAgIGNlbnRlclBpeGVsLnkgPSBjYW52YXMuY2xpZW50SGVpZ2h0IC8gMjtcbiAgICAgICAgdmFyIGNlbnRlclBvc2l0aW9uID0gcGlja0dsb2JlKFxuICAgICAgICAgIG9iamVjdCxcbiAgICAgICAgICBjZW50ZXJQaXhlbCxcbiAgICAgICAgICBzY3JhdGNoQ2VudGVyUG9zaXRpb25cbiAgICAgICAgKTtcbiAgICAgICAgLy8gSWYgY2VudGVyUG9zaXRpb24gaXMgbm90IGRlZmluZWQsIGl0IG1lYW5zIHRoZSBnbG9iZSBkb2VzIG5vdCBjb3ZlciB0aGUgY2VudGVyIHBvc2l0aW9uIG9mIHNjcmVlblxuXG4gICAgICAgIGlmICghZGVmaW5lZChjZW50ZXJQb3NpdGlvbikpIHtcbiAgICAgICAgICB6b29tT25WZWN0b3IgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKGNhbWVyYS5wb3NpdGlvbkNhcnRvZ3JhcGhpYy5oZWlnaHQgPCAxMDAwMDAwKSB7XG4gICAgICAgICAgLy8gVGhlIG1hdGggaW4gdGhlIGVsc2UgYmxvY2sgYXNzdW1lcyB0aGUgY2FtZXJhXG4gICAgICAgICAgLy8gcG9pbnRzIHRvd2FyZCB0aGUgZWFydGggc3VyZmFjZSwgc28gd2UgY2hlY2sgaXQgaGVyZS5cbiAgICAgICAgICAvLyBUaGVvcmV0aWNhbGx5LCB3ZSBzaG91bGQgY2hlY2sgZm9yIDkwIGRlZ3JlZSwgYnV0IGl0IGRvZXNuJ3QgYmVoYXZlIHdlbGwgd2hlbiBwYXJhbGxlbFxuICAgICAgICAgIC8vIHRvIHRoZSBlYXJ0aCBzdXJmYWNlXG4gICAgICAgICAgaWYgKENhcnRlc2lhbjMuZG90KGNhbWVyYS5kaXJlY3Rpb24sIGNhbWVyYVBvc2l0aW9uTm9ybWFsKSA+PSAtMC41KSB7XG4gICAgICAgICAgICB6b29tT25WZWN0b3IgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgY2FtZXJhUG9zaXRpb24gPSBzY3JhdGNoQ2FtZXJhUG9zaXRpb247XG4gICAgICAgICAgICBDYXJ0ZXNpYW4zLmNsb25lKGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhUG9zaXRpb24pO1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IG9iamVjdC5fem9vbVdvcmxkUG9zaXRpb247XG5cbiAgICAgICAgICAgIHZhciB0YXJnZXROb3JtYWwgPSBzY3JhdGNoVGFyZ2V0Tm9ybWFsO1xuXG4gICAgICAgICAgICB0YXJnZXROb3JtYWwgPSBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZSh0YXJnZXQsIHRhcmdldE5vcm1hbCk7XG5cbiAgICAgICAgICAgIGlmIChDYXJ0ZXNpYW4zLmRvdCh0YXJnZXROb3JtYWwsIGNhbWVyYVBvc2l0aW9uTm9ybWFsKSA8IDAuMCkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBjZW50ZXIgPSBzY3JhdGNoQ2VudGVyO1xuICAgICAgICAgICAgdmFyIGZvcndhcmQgPSBzY3JhdGNoRm9yd2FyZE5vcm1hbDtcbiAgICAgICAgICAgIENhcnRlc2lhbjMuY2xvbmUoY2FtZXJhLmRpcmVjdGlvbiwgZm9yd2FyZCk7XG4gICAgICAgICAgICBDYXJ0ZXNpYW4zLmFkZChcbiAgICAgICAgICAgICAgY2FtZXJhUG9zaXRpb24sXG4gICAgICAgICAgICAgIENhcnRlc2lhbjMubXVsdGlwbHlCeVNjYWxhcihmb3J3YXJkLCAxMDAwLCBzY3JhdGNoQ2FydGVzaWFuKSxcbiAgICAgICAgICAgICAgY2VudGVyXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICB2YXIgcG9zaXRpb25Ub1RhcmdldCA9IHNjcmF0Y2hQb3NpdGlvblRvVGFyZ2V0O1xuICAgICAgICAgICAgdmFyIHBvc2l0aW9uVG9UYXJnZXROb3JtYWwgPSBzY3JhdGNoUG9zaXRpb25Ub1RhcmdldE5vcm1hbDtcbiAgICAgICAgICAgIENhcnRlc2lhbjMuc3VidHJhY3QodGFyZ2V0LCBjYW1lcmFQb3NpdGlvbiwgcG9zaXRpb25Ub1RhcmdldCk7XG5cbiAgICAgICAgICAgIENhcnRlc2lhbjMubm9ybWFsaXplKHBvc2l0aW9uVG9UYXJnZXQsIHBvc2l0aW9uVG9UYXJnZXROb3JtYWwpO1xuXG4gICAgICAgICAgICB2YXIgYWxwaGFEb3QgPSBDYXJ0ZXNpYW4zLmRvdChcbiAgICAgICAgICAgICAgY2FtZXJhUG9zaXRpb25Ob3JtYWwsXG4gICAgICAgICAgICAgIHBvc2l0aW9uVG9UYXJnZXROb3JtYWxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAoYWxwaGFEb3QgPj0gMC4wKSB7XG4gICAgICAgICAgICAgIC8vIFdlIHpvb21lZCBwYXN0IHRoZSB0YXJnZXQsIGFuZCB0aGlzIHpvb20gaXMgbm90IHZhbGlkIGFueW1vcmUuXG4gICAgICAgICAgICAgIC8vIFRoaXMgbGluZSBjYXVzZXMgdGhlIG5leHQgem9vbSBtb3ZlbWVudCB0byBwaWNrIGEgbmV3IHN0YXJ0aW5nIHBvaW50LlxuICAgICAgICAgICAgICBvYmplY3QuX3pvb21Nb3VzZVN0YXJ0LnggPSAtMTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGFscGhhID0gTWF0aC5hY29zKC1hbHBoYURvdCk7XG4gICAgICAgICAgICB2YXIgY2FtZXJhRGlzdGFuY2UgPSBDYXJ0ZXNpYW4zLm1hZ25pdHVkZShjYW1lcmFQb3NpdGlvbik7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0RGlzdGFuY2UgPSBDYXJ0ZXNpYW4zLm1hZ25pdHVkZSh0YXJnZXQpO1xuICAgICAgICAgICAgdmFyIHJlbWFpbmluZ0Rpc3RhbmNlID0gY2FtZXJhRGlzdGFuY2UgLSBkaXN0YW5jZTtcbiAgICAgICAgICAgIHZhciBwb3NpdGlvblRvVGFyZ2V0RGlzdGFuY2UgPSBDYXJ0ZXNpYW4zLm1hZ25pdHVkZShcbiAgICAgICAgICAgICAgcG9zaXRpb25Ub1RhcmdldFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgdmFyIGdhbW1hID0gTWF0aC5hc2luKFxuICAgICAgICAgICAgICBDZXNpdW1NYXRoLmNsYW1wKFxuICAgICAgICAgICAgICAgIChwb3NpdGlvblRvVGFyZ2V0RGlzdGFuY2UgLyB0YXJnZXREaXN0YW5jZSkgKiBNYXRoLnNpbihhbHBoYSksXG4gICAgICAgICAgICAgICAgLTEuMCxcbiAgICAgICAgICAgICAgICAxLjBcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHZhciBkZWx0YSA9IE1hdGguYXNpbihcbiAgICAgICAgICAgICAgQ2VzaXVtTWF0aC5jbGFtcChcbiAgICAgICAgICAgICAgICAocmVtYWluaW5nRGlzdGFuY2UgLyB0YXJnZXREaXN0YW5jZSkgKiBNYXRoLnNpbihhbHBoYSksXG4gICAgICAgICAgICAgICAgLTEuMCxcbiAgICAgICAgICAgICAgICAxLjBcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHZhciBiZXRhID0gZ2FtbWEgLSBkZWx0YSArIGFscGhhO1xuXG4gICAgICAgICAgICB2YXIgdXAgPSBzY3JhdGNoQ2FtZXJhVXBOb3JtYWw7XG4gICAgICAgICAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShjYW1lcmFQb3NpdGlvbiwgdXApO1xuICAgICAgICAgICAgdmFyIHJpZ2h0ID0gc2NyYXRjaENhbWVyYVJpZ2h0Tm9ybWFsO1xuICAgICAgICAgICAgcmlnaHQgPSBDYXJ0ZXNpYW4zLmNyb3NzKHBvc2l0aW9uVG9UYXJnZXROb3JtYWwsIHVwLCByaWdodCk7XG4gICAgICAgICAgICByaWdodCA9IENhcnRlc2lhbjMubm9ybWFsaXplKHJpZ2h0LCByaWdodCk7XG5cbiAgICAgICAgICAgIENhcnRlc2lhbjMubm9ybWFsaXplKFxuICAgICAgICAgICAgICBDYXJ0ZXNpYW4zLmNyb3NzKHVwLCByaWdodCwgc2NyYXRjaENhcnRlc2lhbiksXG4gICAgICAgICAgICAgIGZvcndhcmRcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBuZXcgcG9zaXRpb24gdG8gbW92ZSB0b1xuICAgICAgICAgICAgQ2FydGVzaWFuMy5tdWx0aXBseUJ5U2NhbGFyKFxuICAgICAgICAgICAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShjZW50ZXIsIHNjcmF0Y2hDYXJ0ZXNpYW4pLFxuICAgICAgICAgICAgICBDYXJ0ZXNpYW4zLm1hZ25pdHVkZShjZW50ZXIpIC0gZGlzdGFuY2UsXG4gICAgICAgICAgICAgIGNlbnRlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIENhcnRlc2lhbjMubm9ybWFsaXplKGNhbWVyYVBvc2l0aW9uLCBjYW1lcmFQb3NpdGlvbik7XG4gICAgICAgICAgICBDYXJ0ZXNpYW4zLm11bHRpcGx5QnlTY2FsYXIoXG4gICAgICAgICAgICAgIGNhbWVyYVBvc2l0aW9uLFxuICAgICAgICAgICAgICByZW1haW5pbmdEaXN0YW5jZSxcbiAgICAgICAgICAgICAgY2FtZXJhUG9zaXRpb25cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIFBhblxuICAgICAgICAgICAgdmFyIHBNaWQgPSBzY3JhdGNoUGFuO1xuICAgICAgICAgICAgQ2FydGVzaWFuMy5tdWx0aXBseUJ5U2NhbGFyKFxuICAgICAgICAgICAgICBDYXJ0ZXNpYW4zLmFkZChcbiAgICAgICAgICAgICAgICBDYXJ0ZXNpYW4zLm11bHRpcGx5QnlTY2FsYXIoXG4gICAgICAgICAgICAgICAgICB1cCxcbiAgICAgICAgICAgICAgICAgIE1hdGguY29zKGJldGEpIC0gMSxcbiAgICAgICAgICAgICAgICAgIHNjcmF0Y2hDYXJ0ZXNpYW5Ud29cbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIENhcnRlc2lhbjMubXVsdGlwbHlCeVNjYWxhcihcbiAgICAgICAgICAgICAgICAgIGZvcndhcmQsXG4gICAgICAgICAgICAgICAgICBNYXRoLnNpbihiZXRhKSxcbiAgICAgICAgICAgICAgICAgIHNjcmF0Y2hDYXJ0ZXNpYW5UaHJlZVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgc2NyYXRjaENhcnRlc2lhblxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICByZW1haW5pbmdEaXN0YW5jZSxcbiAgICAgICAgICAgICAgcE1pZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIENhcnRlc2lhbjMuYWRkKGNhbWVyYVBvc2l0aW9uLCBwTWlkLCBjYW1lcmFQb3NpdGlvbik7XG5cbiAgICAgICAgICAgIENhcnRlc2lhbjMubm9ybWFsaXplKGNlbnRlciwgdXApO1xuICAgICAgICAgICAgQ2FydGVzaWFuMy5ub3JtYWxpemUoXG4gICAgICAgICAgICAgIENhcnRlc2lhbjMuY3Jvc3ModXAsIHJpZ2h0LCBzY3JhdGNoQ2FydGVzaWFuKSxcbiAgICAgICAgICAgICAgZm9yd2FyZFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgdmFyIGNNaWQgPSBzY3JhdGNoQ2VudGVyTW92ZW1lbnQ7XG4gICAgICAgICAgICBDYXJ0ZXNpYW4zLm11bHRpcGx5QnlTY2FsYXIoXG4gICAgICAgICAgICAgIENhcnRlc2lhbjMuYWRkKFxuICAgICAgICAgICAgICAgIENhcnRlc2lhbjMubXVsdGlwbHlCeVNjYWxhcihcbiAgICAgICAgICAgICAgICAgIHVwLFxuICAgICAgICAgICAgICAgICAgTWF0aC5jb3MoYmV0YSkgLSAxLFxuICAgICAgICAgICAgICAgICAgc2NyYXRjaENhcnRlc2lhblR3b1xuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgQ2FydGVzaWFuMy5tdWx0aXBseUJ5U2NhbGFyKFxuICAgICAgICAgICAgICAgICAgZm9yd2FyZCxcbiAgICAgICAgICAgICAgICAgIE1hdGguc2luKGJldGEpLFxuICAgICAgICAgICAgICAgICAgc2NyYXRjaENhcnRlc2lhblRocmVlXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBzY3JhdGNoQ2FydGVzaWFuXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIENhcnRlc2lhbjMubWFnbml0dWRlKGNlbnRlciksXG4gICAgICAgICAgICAgIGNNaWRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBDYXJ0ZXNpYW4zLmFkZChjZW50ZXIsIGNNaWQsIGNlbnRlcik7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSBjYW1lcmFcblxuICAgICAgICAgICAgLy8gU2V0IG5ldyBwb3NpdGlvblxuICAgICAgICAgICAgQ2FydGVzaWFuMy5jbG9uZShjYW1lcmFQb3NpdGlvbiwgY2FtZXJhLnBvc2l0aW9uKTtcblxuICAgICAgICAgICAgLy8gU2V0IG5ldyBkaXJlY3Rpb25cbiAgICAgICAgICAgIENhcnRlc2lhbjMubm9ybWFsaXplKFxuICAgICAgICAgICAgICBDYXJ0ZXNpYW4zLnN1YnRyYWN0KGNlbnRlciwgY2FtZXJhUG9zaXRpb24sIHNjcmF0Y2hDYXJ0ZXNpYW4pLFxuICAgICAgICAgICAgICBjYW1lcmEuZGlyZWN0aW9uXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgQ2FydGVzaWFuMy5jbG9uZShjYW1lcmEuZGlyZWN0aW9uLCBjYW1lcmEuZGlyZWN0aW9uKTtcblxuICAgICAgICAgICAgLy8gU2V0IG5ldyByaWdodCAmIHVwIHZlY3RvcnNcbiAgICAgICAgICAgIENhcnRlc2lhbjMuY3Jvc3MoY2FtZXJhLmRpcmVjdGlvbiwgY2FtZXJhLnVwLCBjYW1lcmEucmlnaHQpO1xuICAgICAgICAgICAgQ2FydGVzaWFuMy5jcm9zcyhjYW1lcmEucmlnaHQsIGNhbWVyYS5kaXJlY3Rpb24sIGNhbWVyYS51cCk7XG5cbiAgICAgICAgICAgIGNhbWVyYS5zZXRWaWV3KHNjcmF0Y2hab29tVmlld09wdGlvbnMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgcG9zaXRpb25Ob3JtYWwgPSBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShcbiAgICAgICAgICAgIGNlbnRlclBvc2l0aW9uLFxuICAgICAgICAgICAgc2NyYXRjaFBvc2l0aW9uTm9ybWFsXG4gICAgICAgICAgKTtcbiAgICAgICAgICB2YXIgcGlja2VkTm9ybWFsID0gQ2FydGVzaWFuMy5ub3JtYWxpemUoXG4gICAgICAgICAgICBvYmplY3QuX3pvb21Xb3JsZFBvc2l0aW9uLFxuICAgICAgICAgICAgc2NyYXRjaFBpY2tOb3JtYWxcbiAgICAgICAgICApO1xuICAgICAgICAgIHZhciBkb3RQcm9kdWN0ID0gQ2FydGVzaWFuMy5kb3QocGlja2VkTm9ybWFsLCBwb3NpdGlvbk5vcm1hbCk7XG5cbiAgICAgICAgICBpZiAoZG90UHJvZHVjdCA+IDAuMCAmJiBkb3RQcm9kdWN0IDwgMS4wKSB7XG4gICAgICAgICAgICB2YXIgYW5nbGUgPSBDZXNpdW1NYXRoLmFjb3NDbGFtcGVkKGRvdFByb2R1Y3QpO1xuICAgICAgICAgICAgdmFyIGF4aXMgPSBDYXJ0ZXNpYW4zLmNyb3NzKFxuICAgICAgICAgICAgICBwaWNrZWROb3JtYWwsXG4gICAgICAgICAgICAgIHBvc2l0aW9uTm9ybWFsLFxuICAgICAgICAgICAgICBzY3JhdGNoWm9vbUF4aXNcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHZhciBkZW5vbSA9XG4gICAgICAgICAgICAgIE1hdGguYWJzKGFuZ2xlKSA+IENlc2l1bU1hdGgudG9SYWRpYW5zKDIwLjApXG4gICAgICAgICAgICAgICAgPyBjYW1lcmEucG9zaXRpb25DYXJ0b2dyYXBoaWMuaGVpZ2h0ICogMC43NVxuICAgICAgICAgICAgICAgIDogY2FtZXJhLnBvc2l0aW9uQ2FydG9ncmFwaGljLmhlaWdodCAtIGRpc3RhbmNlO1xuICAgICAgICAgICAgdmFyIHNjYWxhciA9IGRpc3RhbmNlIC8gZGVub207XG4gICAgICAgICAgICBjYW1lcmEucm90YXRlKGF4aXMsIGFuZ2xlICogc2NhbGFyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBvYmplY3QuX3JvdGF0aW5nWm9vbSA9ICF6b29tT25WZWN0b3I7XG4gIH1cblxuICBpZiAoKCFzYW1lU3RhcnRQb3NpdGlvbiAmJiB6b29tT25WZWN0b3IpIHx8IHpvb21pbmdPblZlY3Rvcikge1xuICAgIHZhciByYXk7XG4gICAgdmFyIHpvb21Nb3VzZVN0YXJ0ID0gU2NlbmVUcmFuc2Zvcm1zLndnczg0VG9XaW5kb3dDb29yZGluYXRlcyhcbiAgICAgIHNjZW5lLFxuICAgICAgb2JqZWN0Ll96b29tV29ybGRQb3NpdGlvbixcbiAgICAgIHNjcmF0Y2hab29tT2Zmc2V0XG4gICAgKTtcbiAgICBpZiAoXG4gICAgICBtb2RlICE9PSBTY2VuZU1vZGUuQ09MVU1CVVNfVklFVyAmJlxuICAgICAgQ2FydGVzaWFuMi5lcXVhbHMoc3RhcnRQb3NpdGlvbiwgb2JqZWN0Ll96b29tTW91c2VTdGFydCkgJiZcbiAgICAgIGRlZmluZWQoem9vbU1vdXNlU3RhcnQpXG4gICAgKSB7XG4gICAgICByYXkgPSBjYW1lcmEuZ2V0UGlja1JheSh6b29tTW91c2VTdGFydCwgc2NyYXRjaFpvb21QaWNrUmF5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmF5ID0gY2FtZXJhLmdldFBpY2tSYXkoc3RhcnRQb3NpdGlvbiwgc2NyYXRjaFpvb21QaWNrUmF5KTtcbiAgICB9XG5cbiAgICB2YXIgcmF5RGlyZWN0aW9uID0gcmF5LmRpcmVjdGlvbjtcbiAgICBpZiAobW9kZSA9PT0gU2NlbmVNb2RlLkNPTFVNQlVTX1ZJRVcgfHwgbW9kZSA9PT0gU2NlbmVNb2RlLlNDRU5FMkQpIHtcbiAgICAgIENhcnRlc2lhbjMuZnJvbUVsZW1lbnRzKFxuICAgICAgICByYXlEaXJlY3Rpb24ueSxcbiAgICAgICAgcmF5RGlyZWN0aW9uLnosXG4gICAgICAgIHJheURpcmVjdGlvbi54LFxuICAgICAgICByYXlEaXJlY3Rpb25cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY2FtZXJhLm1vdmUocmF5RGlyZWN0aW9uLCBkaXN0YW5jZSk7XG5cbiAgICBvYmplY3QuX3pvb21pbmdPblZlY3RvciA9IHRydWU7XG4gIH0gZWxzZSB7XG4gICAgY2FtZXJhLnpvb21JbihkaXN0YW5jZSk7XG4gIH1cblxuICBpZiAoIW9iamVjdC5fY2FtZXJhVW5kZXJncm91bmQpIHtcbiAgICBjYW1lcmEuc2V0VmlldyhzY3JhdGNoWm9vbVZpZXdPcHRpb25zKTtcbiAgfVxufVxuXG52YXIgdHJhbnNsYXRlMkRTdGFydCA9IG5ldyBSYXkoKTtcbnZhciB0cmFuc2xhdGUyREVuZCA9IG5ldyBSYXkoKTtcbnZhciBzY3JhdGNoVHJhbnNsYXRlUDAgPSBuZXcgQ2FydGVzaWFuMygpO1xuXG5mdW5jdGlvbiB0cmFuc2xhdGUyRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCkge1xuICB2YXIgc2NlbmUgPSBjb250cm9sbGVyLl9zY2VuZTtcbiAgdmFyIGNhbWVyYSA9IHNjZW5lLmNhbWVyYTtcbiAgdmFyIHN0YXJ0ID0gY2FtZXJhLmdldFBpY2tSYXkobW92ZW1lbnQuc3RhcnRQb3NpdGlvbiwgdHJhbnNsYXRlMkRTdGFydClcbiAgICAub3JpZ2luO1xuICB2YXIgZW5kID0gY2FtZXJhLmdldFBpY2tSYXkobW92ZW1lbnQuZW5kUG9zaXRpb24sIHRyYW5zbGF0ZTJERW5kKS5vcmlnaW47XG5cbiAgc3RhcnQgPSBDYXJ0ZXNpYW4zLmZyb21FbGVtZW50cyhzdGFydC55LCBzdGFydC56LCBzdGFydC54LCBzdGFydCk7XG4gIGVuZCA9IENhcnRlc2lhbjMuZnJvbUVsZW1lbnRzKGVuZC55LCBlbmQueiwgZW5kLngsIGVuZCk7XG5cbiAgdmFyIGRpcmVjdGlvbiA9IENhcnRlc2lhbjMuc3VidHJhY3Qoc3RhcnQsIGVuZCwgc2NyYXRjaFRyYW5zbGF0ZVAwKTtcbiAgdmFyIGRpc3RhbmNlID0gQ2FydGVzaWFuMy5tYWduaXR1ZGUoZGlyZWN0aW9uKTtcblxuICBpZiAoZGlzdGFuY2UgPiAwLjApIHtcbiAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShkaXJlY3Rpb24sIGRpcmVjdGlvbik7XG4gICAgY2FtZXJhLm1vdmUoZGlyZWN0aW9uLCBkaXN0YW5jZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gem9vbTJEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50KSB7XG4gIGlmIChkZWZpbmVkKG1vdmVtZW50LmRpc3RhbmNlKSkge1xuICAgIG1vdmVtZW50ID0gbW92ZW1lbnQuZGlzdGFuY2U7XG4gIH1cblxuICB2YXIgc2NlbmUgPSBjb250cm9sbGVyLl9zY2VuZTtcbiAgdmFyIGNhbWVyYSA9IHNjZW5lLmNhbWVyYTtcblxuICBoYW5kbGVab29tKFxuICAgIGNvbnRyb2xsZXIsXG4gICAgc3RhcnRQb3NpdGlvbixcbiAgICBtb3ZlbWVudCxcbiAgICBjb250cm9sbGVyLl96b29tRmFjdG9yLFxuICAgIGNhbWVyYS5nZXRNYWduaXR1ZGUoKVxuICApO1xufVxuXG52YXIgdHdpc3QyRFN0YXJ0ID0gbmV3IENhcnRlc2lhbjIoKTtcbnZhciB0d2lzdDJERW5kID0gbmV3IENhcnRlc2lhbjIoKTtcblxuZnVuY3Rpb24gdHdpc3QyRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCkge1xuICBpZiAoZGVmaW5lZChtb3ZlbWVudC5hbmdsZUFuZEhlaWdodCkpIHtcbiAgICBzaW5nbGVBeGlzVHdpc3QyRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudC5hbmdsZUFuZEhlaWdodCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNjZW5lID0gY29udHJvbGxlci5fc2NlbmU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG4gIHZhciBjYW52YXMgPSBzY2VuZS5jYW52YXM7XG4gIHZhciB3aWR0aCA9IGNhbnZhcy5jbGllbnRXaWR0aDtcbiAgdmFyIGhlaWdodCA9IGNhbnZhcy5jbGllbnRIZWlnaHQ7XG5cbiAgdmFyIHN0YXJ0ID0gdHdpc3QyRFN0YXJ0O1xuICBzdGFydC54ID0gKDIuMCAvIHdpZHRoKSAqIG1vdmVtZW50LnN0YXJ0UG9zaXRpb24ueCAtIDEuMDtcbiAgc3RhcnQueSA9ICgyLjAgLyBoZWlnaHQpICogKGhlaWdodCAtIG1vdmVtZW50LnN0YXJ0UG9zaXRpb24ueSkgLSAxLjA7XG4gIHN0YXJ0ID0gQ2FydGVzaWFuMi5ub3JtYWxpemUoc3RhcnQsIHN0YXJ0KTtcblxuICB2YXIgZW5kID0gdHdpc3QyREVuZDtcbiAgZW5kLnggPSAoMi4wIC8gd2lkdGgpICogbW92ZW1lbnQuZW5kUG9zaXRpb24ueCAtIDEuMDtcbiAgZW5kLnkgPSAoMi4wIC8gaGVpZ2h0KSAqIChoZWlnaHQgLSBtb3ZlbWVudC5lbmRQb3NpdGlvbi55KSAtIDEuMDtcbiAgZW5kID0gQ2FydGVzaWFuMi5ub3JtYWxpemUoZW5kLCBlbmQpO1xuXG4gIHZhciBzdGFydFRoZXRhID0gQ2VzaXVtTWF0aC5hY29zQ2xhbXBlZChzdGFydC54KTtcbiAgaWYgKHN0YXJ0LnkgPCAwKSB7XG4gICAgc3RhcnRUaGV0YSA9IENlc2l1bU1hdGguVFdPX1BJIC0gc3RhcnRUaGV0YTtcbiAgfVxuICB2YXIgZW5kVGhldGEgPSBDZXNpdW1NYXRoLmFjb3NDbGFtcGVkKGVuZC54KTtcbiAgaWYgKGVuZC55IDwgMCkge1xuICAgIGVuZFRoZXRhID0gQ2VzaXVtTWF0aC5UV09fUEkgLSBlbmRUaGV0YTtcbiAgfVxuICB2YXIgdGhldGEgPSBlbmRUaGV0YSAtIHN0YXJ0VGhldGE7XG5cbiAgY2FtZXJhLnR3aXN0UmlnaHQodGhldGEpO1xufVxuXG5mdW5jdGlvbiBzaW5nbGVBeGlzVHdpc3QyRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCkge1xuICB2YXIgcm90YXRlUmF0ZSA9XG4gICAgY29udHJvbGxlci5fcm90YXRlRmFjdG9yICogY29udHJvbGxlci5fcm90YXRlUmF0ZVJhbmdlQWRqdXN0bWVudDtcblxuICBpZiAocm90YXRlUmF0ZSA+IGNvbnRyb2xsZXIuX21heGltdW1Sb3RhdGVSYXRlKSB7XG4gICAgcm90YXRlUmF0ZSA9IGNvbnRyb2xsZXIuX21heGltdW1Sb3RhdGVSYXRlO1xuICB9XG5cbiAgaWYgKHJvdGF0ZVJhdGUgPCBjb250cm9sbGVyLl9taW5pbXVtUm90YXRlUmF0ZSkge1xuICAgIHJvdGF0ZVJhdGUgPSBjb250cm9sbGVyLl9taW5pbXVtUm90YXRlUmF0ZTtcbiAgfVxuXG4gIHZhciBzY2VuZSA9IGNvbnRyb2xsZXIuX3NjZW5lO1xuICB2YXIgY2FtZXJhID0gc2NlbmUuY2FtZXJhO1xuICB2YXIgY2FudmFzID0gc2NlbmUuY2FudmFzO1xuXG4gIHZhciBwaGlXaW5kb3dSYXRpbyA9XG4gICAgKG1vdmVtZW50LmVuZFBvc2l0aW9uLnggLSBtb3ZlbWVudC5zdGFydFBvc2l0aW9uLngpIC8gY2FudmFzLmNsaWVudFdpZHRoO1xuICBwaGlXaW5kb3dSYXRpbyA9IE1hdGgubWluKHBoaVdpbmRvd1JhdGlvLCBjb250cm9sbGVyLm1heGltdW1Nb3ZlbWVudFJhdGlvKTtcblxuICB2YXIgZGVsdGFQaGkgPSByb3RhdGVSYXRlICogcGhpV2luZG93UmF0aW8gKiBNYXRoLlBJICogNC4wO1xuXG4gIGNhbWVyYS50d2lzdFJpZ2h0KGRlbHRhUGhpKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlMkQoY29udHJvbGxlcikge1xuICB2YXIgcm90YXRhYmxlMkQgPSBjb250cm9sbGVyLl9zY2VuZS5tYXBNb2RlMkQgPT09IE1hcE1vZGUyRC5ST1RBVEU7XG4gIGlmICghTWF0cml4NC5lcXVhbHMoTWF0cml4NC5JREVOVElUWSwgY29udHJvbGxlci5fc2NlbmUuY2FtZXJhLnRyYW5zZm9ybSkpIHtcbiAgICByZWFjdFRvSW5wdXQoXG4gICAgICBjb250cm9sbGVyLFxuICAgICAgY29udHJvbGxlci5lbmFibGVab29tLFxuICAgICAgY29udHJvbGxlci56b29tRXZlbnRUeXBlcyxcbiAgICAgIHpvb20yRCxcbiAgICAgIGNvbnRyb2xsZXIuaW5lcnRpYVpvb20sXG4gICAgICBcIl9sYXN0SW5lcnRpYVpvb21Nb3ZlbWVudFwiXG4gICAgKTtcbiAgICBpZiAocm90YXRhYmxlMkQpIHtcbiAgICAgIHJlYWN0VG9JbnB1dChcbiAgICAgICAgY29udHJvbGxlcixcbiAgICAgICAgY29udHJvbGxlci5lbmFibGVSb3RhdGUsXG4gICAgICAgIGNvbnRyb2xsZXIudHJhbnNsYXRlRXZlbnRUeXBlcyxcbiAgICAgICAgdHdpc3QyRCxcbiAgICAgICAgY29udHJvbGxlci5pbmVydGlhU3BpbixcbiAgICAgICAgXCJfbGFzdEluZXJ0aWFTcGluTW92ZW1lbnRcIlxuICAgICAgKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmVhY3RUb0lucHV0KFxuICAgICAgY29udHJvbGxlcixcbiAgICAgIGNvbnRyb2xsZXIuZW5hYmxlVHJhbnNsYXRlLFxuICAgICAgY29udHJvbGxlci50cmFuc2xhdGVFdmVudFR5cGVzLFxuICAgICAgdHJhbnNsYXRlMkQsXG4gICAgICBjb250cm9sbGVyLmluZXJ0aWFUcmFuc2xhdGUsXG4gICAgICBcIl9sYXN0SW5lcnRpYVRyYW5zbGF0ZU1vdmVtZW50XCJcbiAgICApO1xuICAgIHJlYWN0VG9JbnB1dChcbiAgICAgIGNvbnRyb2xsZXIsXG4gICAgICBjb250cm9sbGVyLmVuYWJsZVpvb20sXG4gICAgICBjb250cm9sbGVyLnpvb21FdmVudFR5cGVzLFxuICAgICAgem9vbTJELFxuICAgICAgY29udHJvbGxlci5pbmVydGlhWm9vbSxcbiAgICAgIFwiX2xhc3RJbmVydGlhWm9vbU1vdmVtZW50XCJcbiAgICApO1xuICAgIGlmIChyb3RhdGFibGUyRCkge1xuICAgICAgcmVhY3RUb0lucHV0KFxuICAgICAgICBjb250cm9sbGVyLFxuICAgICAgICBjb250cm9sbGVyLmVuYWJsZVJvdGF0ZSxcbiAgICAgICAgY29udHJvbGxlci50aWx0RXZlbnRUeXBlcyxcbiAgICAgICAgdHdpc3QyRCxcbiAgICAgICAgY29udHJvbGxlci5pbmVydGlhU3BpbixcbiAgICAgICAgXCJfbGFzdEluZXJ0aWFUaWx0TW92ZW1lbnRcIlxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxudmFyIHBpY2tHbG9iZVNjcmF0Y2hSYXkgPSBuZXcgUmF5KCk7XG52YXIgc2NyYXRjaERlcHRoSW50ZXJzZWN0aW9uID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzY3JhdGNoUmF5SW50ZXJzZWN0aW9uID0gbmV3IENhcnRlc2lhbjMoKTtcblxuZnVuY3Rpb24gcGlja0dsb2JlKGNvbnRyb2xsZXIsIG1vdXNlUG9zaXRpb24sIHJlc3VsdCkge1xuICB2YXIgc2NlbmUgPSBjb250cm9sbGVyLl9zY2VuZTtcbiAgdmFyIGdsb2JlID0gY29udHJvbGxlci5fZ2xvYmU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG5cbiAgaWYgKCFkZWZpbmVkKGdsb2JlKSkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICB2YXIgY3VsbEJhY2tGYWNlcyA9ICFjb250cm9sbGVyLl9jYW1lcmFVbmRlcmdyb3VuZDtcblxuICB2YXIgZGVwdGhJbnRlcnNlY3Rpb247XG4gIGlmIChzY2VuZS5waWNrUG9zaXRpb25TdXBwb3J0ZWQpIHtcbiAgICBkZXB0aEludGVyc2VjdGlvbiA9IHNjZW5lLnBpY2tQb3NpdGlvbldvcmxkQ29vcmRpbmF0ZXMoXG4gICAgICBtb3VzZVBvc2l0aW9uLFxuICAgICAgc2NyYXRjaERlcHRoSW50ZXJzZWN0aW9uXG4gICAgKTtcbiAgfVxuXG4gIHZhciByYXkgPSBjYW1lcmEuZ2V0UGlja1JheShtb3VzZVBvc2l0aW9uLCBwaWNrR2xvYmVTY3JhdGNoUmF5KTtcbiAgdmFyIHJheUludGVyc2VjdGlvbiA9IGdsb2JlLnBpY2tXb3JsZENvb3JkaW5hdGVzKFxuICAgIHJheSxcbiAgICBzY2VuZSxcbiAgICBjdWxsQmFja0ZhY2VzLFxuICAgIHNjcmF0Y2hSYXlJbnRlcnNlY3Rpb25cbiAgKTtcblxuICB2YXIgcGlja0Rpc3RhbmNlID0gZGVmaW5lZChkZXB0aEludGVyc2VjdGlvbilcbiAgICA/IENhcnRlc2lhbjMuZGlzdGFuY2UoZGVwdGhJbnRlcnNlY3Rpb24sIGNhbWVyYS5wb3NpdGlvbldDKVxuICAgIDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZO1xuICB2YXIgcmF5RGlzdGFuY2UgPSBkZWZpbmVkKHJheUludGVyc2VjdGlvbilcbiAgICA/IENhcnRlc2lhbjMuZGlzdGFuY2UocmF5SW50ZXJzZWN0aW9uLCBjYW1lcmEucG9zaXRpb25XQylcbiAgICA6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTtcblxuICBpZiAocGlja0Rpc3RhbmNlIDwgcmF5RGlzdGFuY2UpIHtcbiAgICByZXR1cm4gQ2FydGVzaWFuMy5jbG9uZShkZXB0aEludGVyc2VjdGlvbiwgcmVzdWx0KTtcbiAgfVxuXG4gIHJldHVybiBDYXJ0ZXNpYW4zLmNsb25lKHJheUludGVyc2VjdGlvbiwgcmVzdWx0KTtcbn1cblxudmFyIHNjcmF0Y2hEaXN0YW5jZUNhcnRvZ3JhcGhpYyA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcblxuZnVuY3Rpb24gZ2V0RGlzdGFuY2VGcm9tU3VyZmFjZShjb250cm9sbGVyKSB7XG4gIHZhciBlbGxpcHNvaWQgPSBjb250cm9sbGVyLl9lbGxpcHNvaWQ7XG4gIHZhciBzY2VuZSA9IGNvbnRyb2xsZXIuX3NjZW5lO1xuICB2YXIgY2FtZXJhID0gc2NlbmUuY2FtZXJhO1xuICB2YXIgbW9kZSA9IHNjZW5lLm1vZGU7XG5cbiAgdmFyIGhlaWdodCA9IDAuMDtcbiAgaWYgKG1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTNEKSB7XG4gICAgdmFyIGNhcnRvZ3JhcGhpYyA9IGVsbGlwc29pZC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhcbiAgICAgIGNhbWVyYS5wb3NpdGlvbixcbiAgICAgIHNjcmF0Y2hEaXN0YW5jZUNhcnRvZ3JhcGhpY1xuICAgICk7XG4gICAgaWYgKGRlZmluZWQoY2FydG9ncmFwaGljKSkge1xuICAgICAgaGVpZ2h0ID0gY2FydG9ncmFwaGljLmhlaWdodDtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaGVpZ2h0ID0gY2FtZXJhLnBvc2l0aW9uLno7XG4gIH1cbiAgdmFyIGdsb2JlSGVpZ2h0ID0gZGVmYXVsdFZhbHVlKGNvbnRyb2xsZXIuX3NjZW5lLmdsb2JlSGVpZ2h0LCAwLjApO1xuICB2YXIgZGlzdGFuY2VGcm9tU3VyZmFjZSA9IE1hdGguYWJzKGdsb2JlSGVpZ2h0IC0gaGVpZ2h0KTtcbiAgcmV0dXJuIGRpc3RhbmNlRnJvbVN1cmZhY2U7XG59XG5cbnZhciBzY3JhdGNoU3VyZmFjZU5vcm1hbCA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG5cbmZ1bmN0aW9uIGdldFpvb21EaXN0YW5jZVVuZGVyZ3JvdW5kKGNvbnRyb2xsZXIsIHJheSkge1xuICB2YXIgb3JpZ2luID0gcmF5Lm9yaWdpbjtcbiAgdmFyIGRpcmVjdGlvbiA9IHJheS5kaXJlY3Rpb247XG4gIHZhciBkaXN0YW5jZUZyb21TdXJmYWNlID0gZ2V0RGlzdGFuY2VGcm9tU3VyZmFjZShjb250cm9sbGVyKTtcblxuICAvLyBXZWlnaHQgem9vbSBkaXN0YW5jZSBiYXNlZCBvbiBob3cgc3Ryb25nbHkgdGhlIHBpY2sgcmF5IGlzIHBvaW50aW5nIGlud2FyZC5cbiAgLy8gR2VvY2VudHJpYyBub3JtYWwgaXMgYWNjdXJhdGUgZW5vdWdoIGZvciB0aGVzZSBwdXJwb3Nlc1xuICB2YXIgc3VyZmFjZU5vcm1hbCA9IENhcnRlc2lhbjMubm9ybWFsaXplKG9yaWdpbiwgc2NyYXRjaFN1cmZhY2VOb3JtYWwpO1xuICB2YXIgc3RyZW5ndGggPSBNYXRoLmFicyhDYXJ0ZXNpYW4zLmRvdChzdXJmYWNlTm9ybWFsLCBkaXJlY3Rpb24pKTtcbiAgc3RyZW5ndGggPSBNYXRoLm1heChzdHJlbmd0aCwgMC41KSAqIDIuMDtcbiAgcmV0dXJuIGRpc3RhbmNlRnJvbVN1cmZhY2UgKiBzdHJlbmd0aDtcbn1cblxuZnVuY3Rpb24gZ2V0VGlsdENlbnRlclVuZGVyZ3JvdW5kKGNvbnRyb2xsZXIsIHJheSwgcGlja2VkUG9zaXRpb24sIHJlc3VsdCkge1xuICB2YXIgZGlzdGFuY2UgPSBDYXJ0ZXNpYW4zLmRpc3RhbmNlKHJheS5vcmlnaW4sIHBpY2tlZFBvc2l0aW9uKTtcbiAgdmFyIGRpc3RhbmNlRnJvbVN1cmZhY2UgPSBnZXREaXN0YW5jZUZyb21TdXJmYWNlKGNvbnRyb2xsZXIpO1xuXG4gIHZhciBtYXhpbXVtRGlzdGFuY2UgPSBDZXNpdW1NYXRoLmNsYW1wKFxuICAgIGRpc3RhbmNlRnJvbVN1cmZhY2UgKiA1LjAsXG4gICAgY29udHJvbGxlci5fbWluaW11bVVuZGVyZ3JvdW5kUGlja0Rpc3RhbmNlLFxuICAgIGNvbnRyb2xsZXIuX21heGltdW1VbmRlcmdyb3VuZFBpY2tEaXN0YW5jZVxuICApO1xuXG4gIGlmIChkaXN0YW5jZSA+IG1heGltdW1EaXN0YW5jZSkge1xuICAgIC8vIFNpbXVsYXRlIGxvb2stYXQgYmVoYXZpb3IgYnkgdGlsdGluZyBhcm91bmQgYSBzbWFsbCBpbnZpc2libGUgc3BoZXJlXG4gICAgZGlzdGFuY2UgPSBNYXRoLm1pbihkaXN0YW5jZSwgZGlzdGFuY2VGcm9tU3VyZmFjZSAvIDUuMCk7XG4gICAgZGlzdGFuY2UgPSBNYXRoLm1heChkaXN0YW5jZSwgMTAwLjApO1xuICB9XG5cbiAgcmV0dXJuIFJheS5nZXRQb2ludChyYXksIGRpc3RhbmNlLCByZXN1bHQpO1xufVxuXG5mdW5jdGlvbiBnZXRTdHJhZmVTdGFydFBvc2l0aW9uVW5kZXJncm91bmQoXG4gIGNvbnRyb2xsZXIsXG4gIHJheSxcbiAgcGlja2VkUG9zaXRpb24sXG4gIHJlc3VsdFxuKSB7XG4gIHZhciBkaXN0YW5jZTtcbiAgaWYgKCFkZWZpbmVkKHBpY2tlZFBvc2l0aW9uKSkge1xuICAgIGRpc3RhbmNlID0gZ2V0RGlzdGFuY2VGcm9tU3VyZmFjZShjb250cm9sbGVyKTtcbiAgfSBlbHNlIHtcbiAgICBkaXN0YW5jZSA9IENhcnRlc2lhbjMuZGlzdGFuY2UocmF5Lm9yaWdpbiwgcGlja2VkUG9zaXRpb24pO1xuICAgIGlmIChkaXN0YW5jZSA+IGNvbnRyb2xsZXIuX21heGltdW1VbmRlcmdyb3VuZFBpY2tEaXN0YW5jZSkge1xuICAgICAgLy8gSWYgdGhlIHBpY2tlZCBwb3NpdGlvbiBpcyB0b28gZmFyIGF3YXkgc2V0IHRoZSBzdHJhZmUgc3BlZWQgYmFzZWQgb24gdGhlXG4gICAgICAvLyBjYW1lcmEncyBoZWlnaHQgZnJvbSB0aGUgZ2xvYmUgc3VyZmFjZVxuICAgICAgZGlzdGFuY2UgPSBnZXREaXN0YW5jZUZyb21TdXJmYWNlKGNvbnRyb2xsZXIpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBSYXkuZ2V0UG9pbnQocmF5LCBkaXN0YW5jZSwgcmVzdWx0KTtcbn1cblxudmFyIHNjcmF0Y2hJbmVydGlhbERlbHRhID0gbmV3IENhcnRlc2lhbjIoKTtcblxuZnVuY3Rpb24gY29udGludWVTdHJhZmluZyhjb250cm9sbGVyLCBtb3ZlbWVudCkge1xuICAvLyBVcGRhdGUgdGhlIGVuZCBwb3NpdGlvbiBjb250aW51YWxseSBiYXNlZCBvbiB0aGUgaW5lcnRpYWwgZGVsdGFcbiAgdmFyIG9yaWdpbmFsRW5kUG9zaXRpb24gPSBtb3ZlbWVudC5lbmRQb3NpdGlvbjtcbiAgdmFyIGluZXJ0aWFsRGVsdGEgPSBDYXJ0ZXNpYW4yLnN1YnRyYWN0KFxuICAgIG1vdmVtZW50LmVuZFBvc2l0aW9uLFxuICAgIG1vdmVtZW50LnN0YXJ0UG9zaXRpb24sXG4gICAgc2NyYXRjaEluZXJ0aWFsRGVsdGFcbiAgKTtcbiAgdmFyIGVuZFBvc2l0aW9uID0gY29udHJvbGxlci5fc3RyYWZlRW5kTW91c2VQb3NpdGlvbjtcbiAgQ2FydGVzaWFuMi5hZGQoZW5kUG9zaXRpb24sIGluZXJ0aWFsRGVsdGEsIGVuZFBvc2l0aW9uKTtcbiAgbW92ZW1lbnQuZW5kUG9zaXRpb24gPSBlbmRQb3NpdGlvbjtcbiAgc3RyYWZlKGNvbnRyb2xsZXIsIG1vdmVtZW50LCBjb250cm9sbGVyLl9zdHJhZmVTdGFydFBvc2l0aW9uKTtcbiAgbW92ZW1lbnQuZW5kUG9zaXRpb24gPSBvcmlnaW5hbEVuZFBvc2l0aW9uO1xufVxuXG52YXIgdHJhbnNsYXRlQ1ZTdGFydFJheSA9IG5ldyBSYXkoKTtcbnZhciB0cmFuc2xhdGVDVkVuZFJheSA9IG5ldyBSYXkoKTtcbnZhciB0cmFuc2xhdGVDVlN0YXJ0UG9zID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciB0cmFuc2xhdGVDVkVuZFBvcyA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgdHJhbnNsYXRlQ1ZEaWZmZXJlbmNlID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciB0cmFuc2xhdGVDVk9yaWdpbiA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgdHJhbnNsYXRlQ1ZQbGFuZSA9IG5ldyBQbGFuZShDYXJ0ZXNpYW4zLlVOSVRfWCwgMC4wKTtcbnZhciB0cmFuc2xhdGVDVlN0YXJ0TW91c2UgPSBuZXcgQ2FydGVzaWFuMigpO1xudmFyIHRyYW5zbGF0ZUNWRW5kTW91c2UgPSBuZXcgQ2FydGVzaWFuMigpO1xuXG5mdW5jdGlvbiB0cmFuc2xhdGVDVihjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCkge1xuICBpZiAoIUNhcnRlc2lhbjMuZXF1YWxzKHN0YXJ0UG9zaXRpb24sIGNvbnRyb2xsZXIuX3RyYW5zbGF0ZU1vdXNlUG9zaXRpb24pKSB7XG4gICAgY29udHJvbGxlci5fbG9va2luZyA9IGZhbHNlO1xuICB9XG5cbiAgaWYgKCFDYXJ0ZXNpYW4zLmVxdWFscyhzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl9zdHJhZmVNb3VzZVBvc2l0aW9uKSkge1xuICAgIGNvbnRyb2xsZXIuX3N0cmFmaW5nID0gZmFsc2U7XG4gIH1cblxuICBpZiAoY29udHJvbGxlci5fbG9va2luZykge1xuICAgIGxvb2szRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGNvbnRyb2xsZXIuX3N0cmFmaW5nKSB7XG4gICAgY29udGludWVTdHJhZmluZyhjb250cm9sbGVyLCBtb3ZlbWVudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNjZW5lID0gY29udHJvbGxlci5fc2NlbmU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG4gIHZhciBjYW1lcmFVbmRlcmdyb3VuZCA9IGNvbnRyb2xsZXIuX2NhbWVyYVVuZGVyZ3JvdW5kO1xuICB2YXIgc3RhcnRNb3VzZSA9IENhcnRlc2lhbjIuY2xvbmUoXG4gICAgbW92ZW1lbnQuc3RhcnRQb3NpdGlvbixcbiAgICB0cmFuc2xhdGVDVlN0YXJ0TW91c2VcbiAgKTtcbiAgdmFyIGVuZE1vdXNlID0gQ2FydGVzaWFuMi5jbG9uZShtb3ZlbWVudC5lbmRQb3NpdGlvbiwgdHJhbnNsYXRlQ1ZFbmRNb3VzZSk7XG4gIHZhciBzdGFydFJheSA9IGNhbWVyYS5nZXRQaWNrUmF5KHN0YXJ0TW91c2UsIHRyYW5zbGF0ZUNWU3RhcnRSYXkpO1xuXG4gIHZhciBvcmlnaW4gPSBDYXJ0ZXNpYW4zLmNsb25lKENhcnRlc2lhbjMuWkVSTywgdHJhbnNsYXRlQ1ZPcmlnaW4pO1xuICB2YXIgbm9ybWFsID0gQ2FydGVzaWFuMy5VTklUX1g7XG5cbiAgdmFyIGdsb2JlUG9zO1xuICBpZiAoY2FtZXJhLnBvc2l0aW9uLnogPCBjb250cm9sbGVyLl9taW5pbXVtUGlja2luZ1RlcnJhaW5IZWlnaHQpIHtcbiAgICBnbG9iZVBvcyA9IHBpY2tHbG9iZShjb250cm9sbGVyLCBzdGFydE1vdXNlLCB0cmFuc2xhdGVDVlN0YXJ0UG9zKTtcbiAgICBpZiAoZGVmaW5lZChnbG9iZVBvcykpIHtcbiAgICAgIG9yaWdpbi54ID0gZ2xvYmVQb3MueDtcbiAgICB9XG4gIH1cblxuICBpZiAoXG4gICAgY2FtZXJhVW5kZXJncm91bmQgfHxcbiAgICAob3JpZ2luLnggPiBjYW1lcmEucG9zaXRpb24ueiAmJiBkZWZpbmVkKGdsb2JlUG9zKSlcbiAgKSB7XG4gICAgdmFyIHBpY2tQb3NpdGlvbiA9IGdsb2JlUG9zO1xuICAgIGlmIChjYW1lcmFVbmRlcmdyb3VuZCkge1xuICAgICAgcGlja1Bvc2l0aW9uID0gZ2V0U3RyYWZlU3RhcnRQb3NpdGlvblVuZGVyZ3JvdW5kKFxuICAgICAgICBjb250cm9sbGVyLFxuICAgICAgICBzdGFydFJheSxcbiAgICAgICAgZ2xvYmVQb3MsXG4gICAgICAgIHRyYW5zbGF0ZUNWU3RhcnRQb3NcbiAgICAgICk7XG4gICAgfVxuICAgIENhcnRlc2lhbjIuY2xvbmUoc3RhcnRQb3NpdGlvbiwgY29udHJvbGxlci5fc3RyYWZlTW91c2VQb3NpdGlvbik7XG4gICAgQ2FydGVzaWFuMi5jbG9uZShzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl9zdHJhZmVFbmRNb3VzZVBvc2l0aW9uKTtcbiAgICBDYXJ0ZXNpYW4zLmNsb25lKHBpY2tQb3NpdGlvbiwgY29udHJvbGxlci5fc3RyYWZlU3RhcnRQb3NpdGlvbik7XG4gICAgY29udHJvbGxlci5fc3RyYWZpbmcgPSB0cnVlO1xuICAgIHN0cmFmZShjb250cm9sbGVyLCBtb3ZlbWVudCwgY29udHJvbGxlci5fc3RyYWZlU3RhcnRQb3NpdGlvbik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHBsYW5lID0gUGxhbmUuZnJvbVBvaW50Tm9ybWFsKG9yaWdpbiwgbm9ybWFsLCB0cmFuc2xhdGVDVlBsYW5lKTtcblxuICBzdGFydFJheSA9IGNhbWVyYS5nZXRQaWNrUmF5KHN0YXJ0TW91c2UsIHRyYW5zbGF0ZUNWU3RhcnRSYXkpO1xuICB2YXIgc3RhcnRQbGFuZVBvcyA9IEludGVyc2VjdGlvblRlc3RzLnJheVBsYW5lKFxuICAgIHN0YXJ0UmF5LFxuICAgIHBsYW5lLFxuICAgIHRyYW5zbGF0ZUNWU3RhcnRQb3NcbiAgKTtcblxuICB2YXIgZW5kUmF5ID0gY2FtZXJhLmdldFBpY2tSYXkoZW5kTW91c2UsIHRyYW5zbGF0ZUNWRW5kUmF5KTtcbiAgdmFyIGVuZFBsYW5lUG9zID0gSW50ZXJzZWN0aW9uVGVzdHMucmF5UGxhbmUoXG4gICAgZW5kUmF5LFxuICAgIHBsYW5lLFxuICAgIHRyYW5zbGF0ZUNWRW5kUG9zXG4gICk7XG5cbiAgaWYgKCFkZWZpbmVkKHN0YXJ0UGxhbmVQb3MpIHx8ICFkZWZpbmVkKGVuZFBsYW5lUG9zKSkge1xuICAgIGNvbnRyb2xsZXIuX2xvb2tpbmcgPSB0cnVlO1xuICAgIGxvb2szRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCk7XG4gICAgQ2FydGVzaWFuMi5jbG9uZShzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl90cmFuc2xhdGVNb3VzZVBvc2l0aW9uKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgZGlmZiA9IENhcnRlc2lhbjMuc3VidHJhY3QoXG4gICAgc3RhcnRQbGFuZVBvcyxcbiAgICBlbmRQbGFuZVBvcyxcbiAgICB0cmFuc2xhdGVDVkRpZmZlcmVuY2VcbiAgKTtcbiAgdmFyIHRlbXAgPSBkaWZmLng7XG4gIGRpZmYueCA9IGRpZmYueTtcbiAgZGlmZi55ID0gZGlmZi56O1xuICBkaWZmLnogPSB0ZW1wO1xuICB2YXIgbWFnID0gQ2FydGVzaWFuMy5tYWduaXR1ZGUoZGlmZik7XG4gIGlmIChtYWcgPiBDZXNpdW1NYXRoLkVQU0lMT042KSB7XG4gICAgQ2FydGVzaWFuMy5ub3JtYWxpemUoZGlmZiwgZGlmZik7XG4gICAgY2FtZXJhLm1vdmUoZGlmZiwgbWFnKTtcbiAgfVxufVxuXG52YXIgcm90YXRlQ1ZXaW5kb3dQb3MgPSBuZXcgQ2FydGVzaWFuMigpO1xudmFyIHJvdGF0ZUNWV2luZG93UmF5ID0gbmV3IFJheSgpO1xudmFyIHJvdGF0ZUNWQ2VudGVyID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciByb3RhdGVDVlZlcnRpY2FsQ2VudGVyID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciByb3RhdGVDVlRyYW5zZm9ybSA9IG5ldyBNYXRyaXg0KCk7XG52YXIgcm90YXRlQ1ZWZXJ0aWNhbFRyYW5zZm9ybSA9IG5ldyBNYXRyaXg0KCk7XG52YXIgcm90YXRlQ1ZPcmlnaW4gPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHJvdGF0ZUNWUGxhbmUgPSBuZXcgUGxhbmUoQ2FydGVzaWFuMy5VTklUX1gsIDAuMCk7XG52YXIgcm90YXRlQ1ZDYXJ0ZXNpYW4zID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciByb3RhdGVDVkNhcnQgPSBuZXcgQ2FydG9ncmFwaGljKCk7XG52YXIgcm90YXRlQ1ZPbGRUcmFuc2Zvcm0gPSBuZXcgTWF0cml4NCgpO1xudmFyIHJvdGF0ZUNWUXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7XG52YXIgcm90YXRlQ1ZNYXRyaXggPSBuZXcgTWF0cml4MygpO1xudmFyIHRpbHQzRENhcnRlc2lhbjMgPSBuZXcgQ2FydGVzaWFuMygpO1xuXG5mdW5jdGlvbiByb3RhdGVDVihjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCkge1xuICBpZiAoZGVmaW5lZChtb3ZlbWVudC5hbmdsZUFuZEhlaWdodCkpIHtcbiAgICBtb3ZlbWVudCA9IG1vdmVtZW50LmFuZ2xlQW5kSGVpZ2h0O1xuICB9XG5cbiAgaWYgKCFDYXJ0ZXNpYW4yLmVxdWFscyhzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl90aWx0Q2VudGVyTW91c2VQb3NpdGlvbikpIHtcbiAgICBjb250cm9sbGVyLl90aWx0Q1ZPZmZNYXAgPSBmYWxzZTtcbiAgICBjb250cm9sbGVyLl9sb29raW5nID0gZmFsc2U7XG4gIH1cblxuICBpZiAoY29udHJvbGxlci5fbG9va2luZykge1xuICAgIGxvb2szRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNjZW5lID0gY29udHJvbGxlci5fc2NlbmU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG5cbiAgaWYgKFxuICAgIGNvbnRyb2xsZXIuX3RpbHRDVk9mZk1hcCB8fFxuICAgICFjb250cm9sbGVyLm9uTWFwKCkgfHxcbiAgICBNYXRoLmFicyhjYW1lcmEucG9zaXRpb24ueikgPiBjb250cm9sbGVyLl9taW5pbXVtUGlja2luZ1RlcnJhaW5IZWlnaHRcbiAgKSB7XG4gICAgY29udHJvbGxlci5fdGlsdENWT2ZmTWFwID0gdHJ1ZTtcbiAgICByb3RhdGVDVk9uUGxhbmUoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQpO1xuICB9IGVsc2Uge1xuICAgIHJvdGF0ZUNWT25UZXJyYWluKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50KTtcbiAgfVxufVxuXG5mdW5jdGlvbiByb3RhdGVDVk9uUGxhbmUoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQpIHtcbiAgdmFyIHNjZW5lID0gY29udHJvbGxlci5fc2NlbmU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG4gIHZhciBjYW52YXMgPSBzY2VuZS5jYW52YXM7XG5cbiAgdmFyIHdpbmRvd1Bvc2l0aW9uID0gcm90YXRlQ1ZXaW5kb3dQb3M7XG4gIHdpbmRvd1Bvc2l0aW9uLnggPSBjYW52YXMuY2xpZW50V2lkdGggLyAyO1xuICB3aW5kb3dQb3NpdGlvbi55ID0gY2FudmFzLmNsaWVudEhlaWdodCAvIDI7XG4gIHZhciByYXkgPSBjYW1lcmEuZ2V0UGlja1JheSh3aW5kb3dQb3NpdGlvbiwgcm90YXRlQ1ZXaW5kb3dSYXkpO1xuICB2YXIgbm9ybWFsID0gQ2FydGVzaWFuMy5VTklUX1g7XG5cbiAgdmFyIHBvc2l0aW9uID0gcmF5Lm9yaWdpbjtcbiAgdmFyIGRpcmVjdGlvbiA9IHJheS5kaXJlY3Rpb247XG4gIHZhciBzY2FsYXI7XG4gIHZhciBub3JtYWxEb3REaXJlY3Rpb24gPSBDYXJ0ZXNpYW4zLmRvdChub3JtYWwsIGRpcmVjdGlvbik7XG4gIGlmIChNYXRoLmFicyhub3JtYWxEb3REaXJlY3Rpb24pID4gQ2VzaXVtTWF0aC5FUFNJTE9ONikge1xuICAgIHNjYWxhciA9IC1DYXJ0ZXNpYW4zLmRvdChub3JtYWwsIHBvc2l0aW9uKSAvIG5vcm1hbERvdERpcmVjdGlvbjtcbiAgfVxuXG4gIGlmICghZGVmaW5lZChzY2FsYXIpIHx8IHNjYWxhciA8PSAwLjApIHtcbiAgICBjb250cm9sbGVyLl9sb29raW5nID0gdHJ1ZTtcbiAgICBsb29rM0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQpO1xuICAgIENhcnRlc2lhbjIuY2xvbmUoc3RhcnRQb3NpdGlvbiwgY29udHJvbGxlci5fdGlsdENlbnRlck1vdXNlUG9zaXRpb24pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBjZW50ZXIgPSBDYXJ0ZXNpYW4zLm11bHRpcGx5QnlTY2FsYXIoZGlyZWN0aW9uLCBzY2FsYXIsIHJvdGF0ZUNWQ2VudGVyKTtcbiAgQ2FydGVzaWFuMy5hZGQocG9zaXRpb24sIGNlbnRlciwgY2VudGVyKTtcblxuICB2YXIgcHJvamVjdGlvbiA9IHNjZW5lLm1hcFByb2plY3Rpb247XG4gIHZhciBlbGxpcHNvaWQgPSBwcm9qZWN0aW9uLmVsbGlwc29pZDtcblxuICBDYXJ0ZXNpYW4zLmZyb21FbGVtZW50cyhjZW50ZXIueSwgY2VudGVyLnosIGNlbnRlci54LCBjZW50ZXIpO1xuICB2YXIgY2FydCA9IHByb2plY3Rpb24udW5wcm9qZWN0KGNlbnRlciwgcm90YXRlQ1ZDYXJ0KTtcbiAgZWxsaXBzb2lkLmNhcnRvZ3JhcGhpY1RvQ2FydGVzaWFuKGNhcnQsIGNlbnRlcik7XG5cbiAgdmFyIHRyYW5zZm9ybSA9IFRyYW5zZm9ybXMuZWFzdE5vcnRoVXBUb0ZpeGVkRnJhbWUoXG4gICAgY2VudGVyLFxuICAgIGVsbGlwc29pZCxcbiAgICByb3RhdGVDVlRyYW5zZm9ybVxuICApO1xuXG4gIHZhciBvbGRHbG9iZSA9IGNvbnRyb2xsZXIuX2dsb2JlO1xuICB2YXIgb2xkRWxsaXBzb2lkID0gY29udHJvbGxlci5fZWxsaXBzb2lkO1xuICBjb250cm9sbGVyLl9nbG9iZSA9IHVuZGVmaW5lZDtcbiAgY29udHJvbGxlci5fZWxsaXBzb2lkID0gRWxsaXBzb2lkLlVOSVRfU1BIRVJFO1xuICBjb250cm9sbGVyLl9yb3RhdGVGYWN0b3IgPSAxLjA7XG4gIGNvbnRyb2xsZXIuX3JvdGF0ZVJhdGVSYW5nZUFkanVzdG1lbnQgPSAxLjA7XG5cbiAgdmFyIG9sZFRyYW5zZm9ybSA9IE1hdHJpeDQuY2xvbmUoY2FtZXJhLnRyYW5zZm9ybSwgcm90YXRlQ1ZPbGRUcmFuc2Zvcm0pO1xuICBjYW1lcmEuX3NldFRyYW5zZm9ybSh0cmFuc2Zvcm0pO1xuXG4gIHJvdGF0ZTNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50LCBDYXJ0ZXNpYW4zLlVOSVRfWik7XG5cbiAgY2FtZXJhLl9zZXRUcmFuc2Zvcm0ob2xkVHJhbnNmb3JtKTtcbiAgY29udHJvbGxlci5fZ2xvYmUgPSBvbGRHbG9iZTtcbiAgY29udHJvbGxlci5fZWxsaXBzb2lkID0gb2xkRWxsaXBzb2lkO1xuXG4gIHZhciByYWRpdXMgPSBvbGRFbGxpcHNvaWQubWF4aW11bVJhZGl1cztcbiAgY29udHJvbGxlci5fcm90YXRlRmFjdG9yID0gMS4wIC8gcmFkaXVzO1xuICBjb250cm9sbGVyLl9yb3RhdGVSYXRlUmFuZ2VBZGp1c3RtZW50ID0gcmFkaXVzO1xufVxuXG5mdW5jdGlvbiByb3RhdGVDVk9uVGVycmFpbihjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCkge1xuICB2YXIgc2NlbmUgPSBjb250cm9sbGVyLl9zY2VuZTtcbiAgdmFyIGNhbWVyYSA9IHNjZW5lLmNhbWVyYTtcbiAgdmFyIGNhbWVyYVVuZGVyZ3JvdW5kID0gY29udHJvbGxlci5fY2FtZXJhVW5kZXJncm91bmQ7XG5cbiAgdmFyIGNlbnRlcjtcbiAgdmFyIHJheTtcbiAgdmFyIG5vcm1hbCA9IENhcnRlc2lhbjMuVU5JVF9YO1xuXG4gIGlmIChDYXJ0ZXNpYW4yLmVxdWFscyhzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl90aWx0Q2VudGVyTW91c2VQb3NpdGlvbikpIHtcbiAgICBjZW50ZXIgPSBDYXJ0ZXNpYW4zLmNsb25lKGNvbnRyb2xsZXIuX3RpbHRDZW50ZXIsIHJvdGF0ZUNWQ2VudGVyKTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoY2FtZXJhLnBvc2l0aW9uLnogPCBjb250cm9sbGVyLl9taW5pbXVtUGlja2luZ1RlcnJhaW5IZWlnaHQpIHtcbiAgICAgIGNlbnRlciA9IHBpY2tHbG9iZShjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCByb3RhdGVDVkNlbnRlcik7XG4gICAgfVxuXG4gICAgaWYgKCFkZWZpbmVkKGNlbnRlcikpIHtcbiAgICAgIHJheSA9IGNhbWVyYS5nZXRQaWNrUmF5KHN0YXJ0UG9zaXRpb24sIHJvdGF0ZUNWV2luZG93UmF5KTtcbiAgICAgIHZhciBwb3NpdGlvbiA9IHJheS5vcmlnaW47XG4gICAgICB2YXIgZGlyZWN0aW9uID0gcmF5LmRpcmVjdGlvbjtcblxuICAgICAgdmFyIHNjYWxhcjtcbiAgICAgIHZhciBub3JtYWxEb3REaXJlY3Rpb24gPSBDYXJ0ZXNpYW4zLmRvdChub3JtYWwsIGRpcmVjdGlvbik7XG4gICAgICBpZiAoTWF0aC5hYnMobm9ybWFsRG90RGlyZWN0aW9uKSA+IENlc2l1bU1hdGguRVBTSUxPTjYpIHtcbiAgICAgICAgc2NhbGFyID0gLUNhcnRlc2lhbjMuZG90KG5vcm1hbCwgcG9zaXRpb24pIC8gbm9ybWFsRG90RGlyZWN0aW9uO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWRlZmluZWQoc2NhbGFyKSB8fCBzY2FsYXIgPD0gMC4wKSB7XG4gICAgICAgIGNvbnRyb2xsZXIuX2xvb2tpbmcgPSB0cnVlO1xuICAgICAgICBsb29rM0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQpO1xuICAgICAgICBDYXJ0ZXNpYW4yLmNsb25lKHN0YXJ0UG9zaXRpb24sIGNvbnRyb2xsZXIuX3RpbHRDZW50ZXJNb3VzZVBvc2l0aW9uKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjZW50ZXIgPSBDYXJ0ZXNpYW4zLm11bHRpcGx5QnlTY2FsYXIoZGlyZWN0aW9uLCBzY2FsYXIsIHJvdGF0ZUNWQ2VudGVyKTtcbiAgICAgIENhcnRlc2lhbjMuYWRkKHBvc2l0aW9uLCBjZW50ZXIsIGNlbnRlcik7XG4gICAgfVxuXG4gICAgaWYgKGNhbWVyYVVuZGVyZ3JvdW5kKSB7XG4gICAgICBpZiAoIWRlZmluZWQocmF5KSkge1xuICAgICAgICByYXkgPSBjYW1lcmEuZ2V0UGlja1JheShzdGFydFBvc2l0aW9uLCByb3RhdGVDVldpbmRvd1JheSk7XG4gICAgICB9XG4gICAgICBnZXRUaWx0Q2VudGVyVW5kZXJncm91bmQoY29udHJvbGxlciwgcmF5LCBjZW50ZXIsIGNlbnRlcik7XG4gICAgfVxuXG4gICAgQ2FydGVzaWFuMi5jbG9uZShzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl90aWx0Q2VudGVyTW91c2VQb3NpdGlvbik7XG4gICAgQ2FydGVzaWFuMy5jbG9uZShjZW50ZXIsIGNvbnRyb2xsZXIuX3RpbHRDZW50ZXIpO1xuICB9XG5cbiAgdmFyIGNhbnZhcyA9IHNjZW5lLmNhbnZhcztcblxuICB2YXIgd2luZG93UG9zaXRpb24gPSByb3RhdGVDVldpbmRvd1BvcztcbiAgd2luZG93UG9zaXRpb24ueCA9IGNhbnZhcy5jbGllbnRXaWR0aCAvIDI7XG4gIHdpbmRvd1Bvc2l0aW9uLnkgPSBjb250cm9sbGVyLl90aWx0Q2VudGVyTW91c2VQb3NpdGlvbi55O1xuICByYXkgPSBjYW1lcmEuZ2V0UGlja1JheSh3aW5kb3dQb3NpdGlvbiwgcm90YXRlQ1ZXaW5kb3dSYXkpO1xuXG4gIHZhciBvcmlnaW4gPSBDYXJ0ZXNpYW4zLmNsb25lKENhcnRlc2lhbjMuWkVSTywgcm90YXRlQ1ZPcmlnaW4pO1xuICBvcmlnaW4ueCA9IGNlbnRlci54O1xuXG4gIHZhciBwbGFuZSA9IFBsYW5lLmZyb21Qb2ludE5vcm1hbChvcmlnaW4sIG5vcm1hbCwgcm90YXRlQ1ZQbGFuZSk7XG4gIHZhciB2ZXJ0aWNhbENlbnRlciA9IEludGVyc2VjdGlvblRlc3RzLnJheVBsYW5lKFxuICAgIHJheSxcbiAgICBwbGFuZSxcbiAgICByb3RhdGVDVlZlcnRpY2FsQ2VudGVyXG4gICk7XG5cbiAgdmFyIHByb2plY3Rpb24gPSBjYW1lcmEuX3Byb2plY3Rpb247XG4gIHZhciBlbGxpcHNvaWQgPSBwcm9qZWN0aW9uLmVsbGlwc29pZDtcblxuICBDYXJ0ZXNpYW4zLmZyb21FbGVtZW50cyhjZW50ZXIueSwgY2VudGVyLnosIGNlbnRlci54LCBjZW50ZXIpO1xuICB2YXIgY2FydCA9IHByb2plY3Rpb24udW5wcm9qZWN0KGNlbnRlciwgcm90YXRlQ1ZDYXJ0KTtcbiAgZWxsaXBzb2lkLmNhcnRvZ3JhcGhpY1RvQ2FydGVzaWFuKGNhcnQsIGNlbnRlcik7XG5cbiAgdmFyIHRyYW5zZm9ybSA9IFRyYW5zZm9ybXMuZWFzdE5vcnRoVXBUb0ZpeGVkRnJhbWUoXG4gICAgY2VudGVyLFxuICAgIGVsbGlwc29pZCxcbiAgICByb3RhdGVDVlRyYW5zZm9ybVxuICApO1xuXG4gIHZhciB2ZXJ0aWNhbFRyYW5zZm9ybTtcbiAgaWYgKGRlZmluZWQodmVydGljYWxDZW50ZXIpKSB7XG4gICAgQ2FydGVzaWFuMy5mcm9tRWxlbWVudHMoXG4gICAgICB2ZXJ0aWNhbENlbnRlci55LFxuICAgICAgdmVydGljYWxDZW50ZXIueixcbiAgICAgIHZlcnRpY2FsQ2VudGVyLngsXG4gICAgICB2ZXJ0aWNhbENlbnRlclxuICAgICk7XG4gICAgY2FydCA9IHByb2plY3Rpb24udW5wcm9qZWN0KHZlcnRpY2FsQ2VudGVyLCByb3RhdGVDVkNhcnQpO1xuICAgIGVsbGlwc29pZC5jYXJ0b2dyYXBoaWNUb0NhcnRlc2lhbihjYXJ0LCB2ZXJ0aWNhbENlbnRlcik7XG5cbiAgICB2ZXJ0aWNhbFRyYW5zZm9ybSA9IFRyYW5zZm9ybXMuZWFzdE5vcnRoVXBUb0ZpeGVkRnJhbWUoXG4gICAgICB2ZXJ0aWNhbENlbnRlcixcbiAgICAgIGVsbGlwc29pZCxcbiAgICAgIHJvdGF0ZUNWVmVydGljYWxUcmFuc2Zvcm1cbiAgICApO1xuICB9IGVsc2Uge1xuICAgIHZlcnRpY2FsVHJhbnNmb3JtID0gdHJhbnNmb3JtO1xuICB9XG5cbiAgdmFyIG9sZEdsb2JlID0gY29udHJvbGxlci5fZ2xvYmU7XG4gIHZhciBvbGRFbGxpcHNvaWQgPSBjb250cm9sbGVyLl9lbGxpcHNvaWQ7XG4gIGNvbnRyb2xsZXIuX2dsb2JlID0gdW5kZWZpbmVkO1xuICBjb250cm9sbGVyLl9lbGxpcHNvaWQgPSBFbGxpcHNvaWQuVU5JVF9TUEhFUkU7XG4gIGNvbnRyb2xsZXIuX3JvdGF0ZUZhY3RvciA9IDEuMDtcbiAgY29udHJvbGxlci5fcm90YXRlUmF0ZVJhbmdlQWRqdXN0bWVudCA9IDEuMDtcblxuICB2YXIgY29uc3RyYWluZWRBeGlzID0gQ2FydGVzaWFuMy5VTklUX1o7XG5cbiAgdmFyIG9sZFRyYW5zZm9ybSA9IE1hdHJpeDQuY2xvbmUoY2FtZXJhLnRyYW5zZm9ybSwgcm90YXRlQ1ZPbGRUcmFuc2Zvcm0pO1xuICBjYW1lcmEuX3NldFRyYW5zZm9ybSh0cmFuc2Zvcm0pO1xuXG4gIHZhciB0YW5nZW50ID0gQ2FydGVzaWFuMy5jcm9zcyhcbiAgICBDYXJ0ZXNpYW4zLlVOSVRfWixcbiAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShjYW1lcmEucG9zaXRpb24sIHJvdGF0ZUNWQ2FydGVzaWFuMyksXG4gICAgcm90YXRlQ1ZDYXJ0ZXNpYW4zXG4gICk7XG4gIHZhciBkb3QgPSBDYXJ0ZXNpYW4zLmRvdChjYW1lcmEucmlnaHQsIHRhbmdlbnQpO1xuXG4gIHJvdGF0ZTNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50LCBjb25zdHJhaW5lZEF4aXMsIGZhbHNlLCB0cnVlKTtcblxuICBjYW1lcmEuX3NldFRyYW5zZm9ybSh2ZXJ0aWNhbFRyYW5zZm9ybSk7XG4gIGlmIChkb3QgPCAwLjApIHtcbiAgICB2YXIgbW92ZW1lbnREZWx0YSA9IG1vdmVtZW50LnN0YXJ0UG9zaXRpb24ueSAtIG1vdmVtZW50LmVuZFBvc2l0aW9uLnk7XG4gICAgaWYgKFxuICAgICAgKGNhbWVyYVVuZGVyZ3JvdW5kICYmIG1vdmVtZW50RGVsdGEgPCAwLjApIHx8XG4gICAgICAoIWNhbWVyYVVuZGVyZ3JvdW5kICYmIG1vdmVtZW50RGVsdGEgPiAwLjApXG4gICAgKSB7XG4gICAgICAvLyBQcmV2ZW50IGNhbWVyYSBmcm9tIGZsaXBwaW5nIHBhc3QgdGhlIHVwIGF4aXNcbiAgICAgIGNvbnN0cmFpbmVkQXhpcyA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICB2YXIgb2xkQ29uc3RyYWluZWRBeGlzID0gY2FtZXJhLmNvbnN0cmFpbmVkQXhpcztcbiAgICBjYW1lcmEuY29uc3RyYWluZWRBeGlzID0gdW5kZWZpbmVkO1xuXG4gICAgcm90YXRlM0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQsIGNvbnN0cmFpbmVkQXhpcywgdHJ1ZSwgZmFsc2UpO1xuXG4gICAgY2FtZXJhLmNvbnN0cmFpbmVkQXhpcyA9IG9sZENvbnN0cmFpbmVkQXhpcztcbiAgfSBlbHNlIHtcbiAgICByb3RhdGUzRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCwgY29uc3RyYWluZWRBeGlzLCB0cnVlLCBmYWxzZSk7XG4gIH1cblxuICBpZiAoZGVmaW5lZChjYW1lcmEuY29uc3RyYWluZWRBeGlzKSkge1xuICAgIHZhciByaWdodCA9IENhcnRlc2lhbjMuY3Jvc3MoXG4gICAgICBjYW1lcmEuZGlyZWN0aW9uLFxuICAgICAgY2FtZXJhLmNvbnN0cmFpbmVkQXhpcyxcbiAgICAgIHRpbHQzRENhcnRlc2lhbjNcbiAgICApO1xuICAgIGlmIChcbiAgICAgICFDYXJ0ZXNpYW4zLmVxdWFsc0Vwc2lsb24ocmlnaHQsIENhcnRlc2lhbjMuWkVSTywgQ2VzaXVtTWF0aC5FUFNJTE9ONilcbiAgICApIHtcbiAgICAgIGlmIChDYXJ0ZXNpYW4zLmRvdChyaWdodCwgY2FtZXJhLnJpZ2h0KSA8IDAuMCkge1xuICAgICAgICBDYXJ0ZXNpYW4zLm5lZ2F0ZShyaWdodCwgcmlnaHQpO1xuICAgICAgfVxuXG4gICAgICBDYXJ0ZXNpYW4zLmNyb3NzKHJpZ2h0LCBjYW1lcmEuZGlyZWN0aW9uLCBjYW1lcmEudXApO1xuICAgICAgQ2FydGVzaWFuMy5jcm9zcyhjYW1lcmEuZGlyZWN0aW9uLCBjYW1lcmEudXAsIGNhbWVyYS5yaWdodCk7XG5cbiAgICAgIENhcnRlc2lhbjMubm9ybWFsaXplKGNhbWVyYS51cCwgY2FtZXJhLnVwKTtcbiAgICAgIENhcnRlc2lhbjMubm9ybWFsaXplKGNhbWVyYS5yaWdodCwgY2FtZXJhLnJpZ2h0KTtcbiAgICB9XG4gIH1cblxuICBjYW1lcmEuX3NldFRyYW5zZm9ybShvbGRUcmFuc2Zvcm0pO1xuICBjb250cm9sbGVyLl9nbG9iZSA9IG9sZEdsb2JlO1xuICBjb250cm9sbGVyLl9lbGxpcHNvaWQgPSBvbGRFbGxpcHNvaWQ7XG5cbiAgdmFyIHJhZGl1cyA9IG9sZEVsbGlwc29pZC5tYXhpbXVtUmFkaXVzO1xuICBjb250cm9sbGVyLl9yb3RhdGVGYWN0b3IgPSAxLjAgLyByYWRpdXM7XG4gIGNvbnRyb2xsZXIuX3JvdGF0ZVJhdGVSYW5nZUFkanVzdG1lbnQgPSByYWRpdXM7XG5cbiAgdmFyIG9yaWdpbmFsUG9zaXRpb24gPSBDYXJ0ZXNpYW4zLmNsb25lKFxuICAgIGNhbWVyYS5wb3NpdGlvbldDLFxuICAgIHJvdGF0ZUNWQ2FydGVzaWFuM1xuICApO1xuXG4gIGlmIChjb250cm9sbGVyLmVuYWJsZUNvbGxpc2lvbkRldGVjdGlvbikge1xuICAgIGFkanVzdEhlaWdodEZvclRlcnJhaW4oY29udHJvbGxlcik7XG4gIH1cblxuICBpZiAoIUNhcnRlc2lhbjMuZXF1YWxzKGNhbWVyYS5wb3NpdGlvbldDLCBvcmlnaW5hbFBvc2l0aW9uKSkge1xuICAgIGNhbWVyYS5fc2V0VHJhbnNmb3JtKHZlcnRpY2FsVHJhbnNmb3JtKTtcbiAgICBjYW1lcmEud29ybGRUb0NhbWVyYUNvb3JkaW5hdGVzUG9pbnQob3JpZ2luYWxQb3NpdGlvbiwgb3JpZ2luYWxQb3NpdGlvbik7XG5cbiAgICB2YXIgbWFnU3FyZCA9IENhcnRlc2lhbjMubWFnbml0dWRlU3F1YXJlZChvcmlnaW5hbFBvc2l0aW9uKTtcbiAgICBpZiAoQ2FydGVzaWFuMy5tYWduaXR1ZGVTcXVhcmVkKGNhbWVyYS5wb3NpdGlvbikgPiBtYWdTcXJkKSB7XG4gICAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5wb3NpdGlvbik7XG4gICAgICBDYXJ0ZXNpYW4zLm11bHRpcGx5QnlTY2FsYXIoXG4gICAgICAgIGNhbWVyYS5wb3NpdGlvbixcbiAgICAgICAgTWF0aC5zcXJ0KG1hZ1NxcmQpLFxuICAgICAgICBjYW1lcmEucG9zaXRpb25cbiAgICAgICk7XG4gICAgfVxuXG4gICAgdmFyIGFuZ2xlID0gQ2FydGVzaWFuMy5hbmdsZUJldHdlZW4ob3JpZ2luYWxQb3NpdGlvbiwgY2FtZXJhLnBvc2l0aW9uKTtcbiAgICB2YXIgYXhpcyA9IENhcnRlc2lhbjMuY3Jvc3MoXG4gICAgICBvcmlnaW5hbFBvc2l0aW9uLFxuICAgICAgY2FtZXJhLnBvc2l0aW9uLFxuICAgICAgb3JpZ2luYWxQb3NpdGlvblxuICAgICk7XG4gICAgQ2FydGVzaWFuMy5ub3JtYWxpemUoYXhpcywgYXhpcyk7XG5cbiAgICB2YXIgcXVhdGVybmlvbiA9IFF1YXRlcm5pb24uZnJvbUF4aXNBbmdsZShheGlzLCBhbmdsZSwgcm90YXRlQ1ZRdWF0ZXJuaW9uKTtcbiAgICB2YXIgcm90YXRpb24gPSBNYXRyaXgzLmZyb21RdWF0ZXJuaW9uKHF1YXRlcm5pb24sIHJvdGF0ZUNWTWF0cml4KTtcbiAgICBNYXRyaXgzLm11bHRpcGx5QnlWZWN0b3Iocm90YXRpb24sIGNhbWVyYS5kaXJlY3Rpb24sIGNhbWVyYS5kaXJlY3Rpb24pO1xuICAgIE1hdHJpeDMubXVsdGlwbHlCeVZlY3Rvcihyb3RhdGlvbiwgY2FtZXJhLnVwLCBjYW1lcmEudXApO1xuICAgIENhcnRlc2lhbjMuY3Jvc3MoY2FtZXJhLmRpcmVjdGlvbiwgY2FtZXJhLnVwLCBjYW1lcmEucmlnaHQpO1xuICAgIENhcnRlc2lhbjMuY3Jvc3MoY2FtZXJhLnJpZ2h0LCBjYW1lcmEuZGlyZWN0aW9uLCBjYW1lcmEudXApO1xuXG4gICAgY2FtZXJhLl9zZXRUcmFuc2Zvcm0ob2xkVHJhbnNmb3JtKTtcbiAgfVxufVxuXG52YXIgem9vbUNWV2luZG93UG9zID0gbmV3IENhcnRlc2lhbjIoKTtcbnZhciB6b29tQ1ZXaW5kb3dSYXkgPSBuZXcgUmF5KCk7XG52YXIgem9vbUNWSW50ZXJzZWN0aW9uID0gbmV3IENhcnRlc2lhbjMoKTtcblxuZnVuY3Rpb24gem9vbUNWKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50KSB7XG4gIGlmIChkZWZpbmVkKG1vdmVtZW50LmRpc3RhbmNlKSkge1xuICAgIG1vdmVtZW50ID0gbW92ZW1lbnQuZGlzdGFuY2U7XG4gIH1cblxuICB2YXIgc2NlbmUgPSBjb250cm9sbGVyLl9zY2VuZTtcbiAgdmFyIGNhbWVyYSA9IHNjZW5lLmNhbWVyYTtcbiAgdmFyIGNhbnZhcyA9IHNjZW5lLmNhbnZhcztcblxuICB2YXIgY2FtZXJhVW5kZXJncm91bmQgPSBjb250cm9sbGVyLl9jYW1lcmFVbmRlcmdyb3VuZDtcblxuICB2YXIgd2luZG93UG9zaXRpb247XG5cbiAgaWYgKGNhbWVyYVVuZGVyZ3JvdW5kKSB7XG4gICAgd2luZG93UG9zaXRpb24gPSBzdGFydFBvc2l0aW9uO1xuICB9IGVsc2Uge1xuICAgIHdpbmRvd1Bvc2l0aW9uID0gem9vbUNWV2luZG93UG9zO1xuICAgIHdpbmRvd1Bvc2l0aW9uLnggPSBjYW52YXMuY2xpZW50V2lkdGggLyAyO1xuICAgIHdpbmRvd1Bvc2l0aW9uLnkgPSBjYW52YXMuY2xpZW50SGVpZ2h0IC8gMjtcbiAgfVxuXG4gIHZhciByYXkgPSBjYW1lcmEuZ2V0UGlja1JheSh3aW5kb3dQb3NpdGlvbiwgem9vbUNWV2luZG93UmF5KTtcbiAgdmFyIHBvc2l0aW9uID0gcmF5Lm9yaWdpbjtcbiAgdmFyIGRpcmVjdGlvbiA9IHJheS5kaXJlY3Rpb247XG4gIHZhciBoZWlnaHQgPSBjYW1lcmEucG9zaXRpb24uejtcblxuICB2YXIgaW50ZXJzZWN0aW9uO1xuICBpZiAoaGVpZ2h0IDwgY29udHJvbGxlci5fbWluaW11bVBpY2tpbmdUZXJyYWluSGVpZ2h0KSB7XG4gICAgaW50ZXJzZWN0aW9uID0gcGlja0dsb2JlKGNvbnRyb2xsZXIsIHdpbmRvd1Bvc2l0aW9uLCB6b29tQ1ZJbnRlcnNlY3Rpb24pO1xuICB9XG5cbiAgdmFyIGRpc3RhbmNlO1xuICBpZiAoZGVmaW5lZChpbnRlcnNlY3Rpb24pKSB7XG4gICAgZGlzdGFuY2UgPSBDYXJ0ZXNpYW4zLmRpc3RhbmNlKHBvc2l0aW9uLCBpbnRlcnNlY3Rpb24pO1xuICB9XG5cbiAgaWYgKGNhbWVyYVVuZGVyZ3JvdW5kKSB7XG4gICAgdmFyIGRpc3RhbmNlVW5kZXJncm91bmQgPSBnZXRab29tRGlzdGFuY2VVbmRlcmdyb3VuZChcbiAgICAgIGNvbnRyb2xsZXIsXG4gICAgICByYXksXG4gICAgICBoZWlnaHRcbiAgICApO1xuICAgIGlmIChkZWZpbmVkKGRpc3RhbmNlKSkge1xuICAgICAgZGlzdGFuY2UgPSBNYXRoLm1pbihkaXN0YW5jZSwgZGlzdGFuY2VVbmRlcmdyb3VuZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRpc3RhbmNlID0gZGlzdGFuY2VVbmRlcmdyb3VuZDtcbiAgICB9XG4gIH1cblxuICBpZiAoIWRlZmluZWQoZGlzdGFuY2UpKSB7XG4gICAgdmFyIG5vcm1hbCA9IENhcnRlc2lhbjMuVU5JVF9YO1xuICAgIGRpc3RhbmNlID1cbiAgICAgIC1DYXJ0ZXNpYW4zLmRvdChub3JtYWwsIHBvc2l0aW9uKSAvIENhcnRlc2lhbjMuZG90KG5vcm1hbCwgZGlyZWN0aW9uKTtcbiAgfVxuXG4gIGhhbmRsZVpvb20oXG4gICAgY29udHJvbGxlcixcbiAgICBzdGFydFBvc2l0aW9uLFxuICAgIG1vdmVtZW50LFxuICAgIGNvbnRyb2xsZXIuX3pvb21GYWN0b3IsXG4gICAgZGlzdGFuY2VcbiAgKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlQ1YoY29udHJvbGxlcikge1xuICB2YXIgc2NlbmUgPSBjb250cm9sbGVyLl9zY2VuZTtcbiAgdmFyIGNhbWVyYSA9IHNjZW5lLmNhbWVyYTtcblxuICBpZiAoIU1hdHJpeDQuZXF1YWxzKE1hdHJpeDQuSURFTlRJVFksIGNhbWVyYS50cmFuc2Zvcm0pKSB7XG4gICAgcmVhY3RUb0lucHV0KFxuICAgICAgY29udHJvbGxlcixcbiAgICAgIGNvbnRyb2xsZXIuZW5hYmxlUm90YXRlLFxuICAgICAgY29udHJvbGxlci5yb3RhdGVFdmVudFR5cGVzLFxuICAgICAgcm90YXRlM0QsXG4gICAgICBjb250cm9sbGVyLmluZXJ0aWFTcGluLFxuICAgICAgXCJfbGFzdEluZXJ0aWFTcGluTW92ZW1lbnRcIlxuICAgICk7XG4gICAgcmVhY3RUb0lucHV0KFxuICAgICAgY29udHJvbGxlcixcbiAgICAgIGNvbnRyb2xsZXIuZW5hYmxlWm9vbSxcbiAgICAgIGNvbnRyb2xsZXIuem9vbUV2ZW50VHlwZXMsXG4gICAgICB6b29tM0QsXG4gICAgICBjb250cm9sbGVyLmluZXJ0aWFab29tLFxuICAgICAgXCJfbGFzdEluZXJ0aWFab29tTW92ZW1lbnRcIlxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgdmFyIHR3ZWVucyA9IGNvbnRyb2xsZXIuX3R3ZWVucztcblxuICAgIGlmIChjb250cm9sbGVyLl9hZ2dyZWdhdG9yLmFueUJ1dHRvbkRvd24pIHtcbiAgICAgIHR3ZWVucy5yZW1vdmVBbGwoKTtcbiAgICB9XG5cbiAgICByZWFjdFRvSW5wdXQoXG4gICAgICBjb250cm9sbGVyLFxuICAgICAgY29udHJvbGxlci5lbmFibGVUaWx0LFxuICAgICAgY29udHJvbGxlci50aWx0RXZlbnRUeXBlcyxcbiAgICAgIHJvdGF0ZUNWLFxuICAgICAgY29udHJvbGxlci5pbmVydGlhU3BpbixcbiAgICAgIFwiX2xhc3RJbmVydGlhVGlsdE1vdmVtZW50XCJcbiAgICApO1xuICAgIHJlYWN0VG9JbnB1dChcbiAgICAgIGNvbnRyb2xsZXIsXG4gICAgICBjb250cm9sbGVyLmVuYWJsZVRyYW5zbGF0ZSxcbiAgICAgIGNvbnRyb2xsZXIudHJhbnNsYXRlRXZlbnRUeXBlcyxcbiAgICAgIHRyYW5zbGF0ZUNWLFxuICAgICAgY29udHJvbGxlci5pbmVydGlhVHJhbnNsYXRlLFxuICAgICAgXCJfbGFzdEluZXJ0aWFUcmFuc2xhdGVNb3ZlbWVudFwiXG4gICAgKTtcbiAgICByZWFjdFRvSW5wdXQoXG4gICAgICBjb250cm9sbGVyLFxuICAgICAgY29udHJvbGxlci5lbmFibGVab29tLFxuICAgICAgY29udHJvbGxlci56b29tRXZlbnRUeXBlcyxcbiAgICAgIHpvb21DVixcbiAgICAgIGNvbnRyb2xsZXIuaW5lcnRpYVpvb20sXG4gICAgICBcIl9sYXN0SW5lcnRpYVpvb21Nb3ZlbWVudFwiXG4gICAgKTtcbiAgICByZWFjdFRvSW5wdXQoXG4gICAgICBjb250cm9sbGVyLFxuICAgICAgY29udHJvbGxlci5lbmFibGVMb29rLFxuICAgICAgY29udHJvbGxlci5sb29rRXZlbnRUeXBlcyxcbiAgICAgIGxvb2szRFxuICAgICk7XG5cbiAgICBpZiAoXG4gICAgICAhY29udHJvbGxlci5fYWdncmVnYXRvci5hbnlCdXR0b25Eb3duICYmXG4gICAgICAhdHdlZW5zLmNvbnRhaW5zKGNvbnRyb2xsZXIuX3R3ZWVuKVxuICAgICkge1xuICAgICAgdmFyIHR3ZWVuID0gY2FtZXJhLmNyZWF0ZUNvcnJlY3RQb3NpdGlvblR3ZWVuKFxuICAgICAgICBjb250cm9sbGVyLmJvdW5jZUFuaW1hdGlvblRpbWVcbiAgICAgICk7XG4gICAgICBpZiAoZGVmaW5lZCh0d2VlbikpIHtcbiAgICAgICAgY29udHJvbGxlci5fdHdlZW4gPSB0d2VlbnMuYWRkKHR3ZWVuKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0d2VlbnMudXBkYXRlKCk7XG4gIH1cbn1cblxudmFyIHNjcmF0Y2hTdHJhZmVSYXkgPSBuZXcgUmF5KCk7XG52YXIgc2NyYXRjaFN0cmFmZVBsYW5lID0gbmV3IFBsYW5lKENhcnRlc2lhbjMuVU5JVF9YLCAwLjApO1xudmFyIHNjcmF0Y2hTdHJhZmVJbnRlcnNlY3Rpb24gPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHNjcmF0Y2hTdHJhZmVEaXJlY3Rpb24gPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHNjcmF0Y2hNb3VzZVBvcyA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG5cbmZ1bmN0aW9uIHN0cmFmZShjb250cm9sbGVyLCBtb3ZlbWVudCwgc3RyYWZlU3RhcnRQb3NpdGlvbikge1xuICB2YXIgc2NlbmUgPSBjb250cm9sbGVyLl9zY2VuZTtcbiAgdmFyIGNhbWVyYSA9IHNjZW5lLmNhbWVyYTtcblxuICB2YXIgcmF5ID0gY2FtZXJhLmdldFBpY2tSYXkobW92ZW1lbnQuZW5kUG9zaXRpb24sIHNjcmF0Y2hTdHJhZmVSYXkpO1xuXG4gIHZhciBkaXJlY3Rpb24gPSBDYXJ0ZXNpYW4zLmNsb25lKGNhbWVyYS5kaXJlY3Rpb24sIHNjcmF0Y2hTdHJhZmVEaXJlY3Rpb24pO1xuICBpZiAoc2NlbmUubW9kZSA9PT0gU2NlbmVNb2RlLkNPTFVNQlVTX1ZJRVcpIHtcbiAgICBDYXJ0ZXNpYW4zLmZyb21FbGVtZW50cyhkaXJlY3Rpb24ueiwgZGlyZWN0aW9uLngsIGRpcmVjdGlvbi55LCBkaXJlY3Rpb24pO1xuICB9XG5cbiAgdmFyIHBsYW5lID0gUGxhbmUuZnJvbVBvaW50Tm9ybWFsKFxuICAgIHN0cmFmZVN0YXJ0UG9zaXRpb24sXG4gICAgZGlyZWN0aW9uLFxuICAgIHNjcmF0Y2hTdHJhZmVQbGFuZVxuICApO1xuICB2YXIgaW50ZXJzZWN0aW9uID0gSW50ZXJzZWN0aW9uVGVzdHMucmF5UGxhbmUoXG4gICAgcmF5LFxuICAgIHBsYW5lLFxuICAgIHNjcmF0Y2hTdHJhZmVJbnRlcnNlY3Rpb25cbiAgKTtcbiAgaWYgKCFkZWZpbmVkKGludGVyc2VjdGlvbikpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBkaXJlY3Rpb24gPSBDYXJ0ZXNpYW4zLnN1YnRyYWN0KHN0cmFmZVN0YXJ0UG9zaXRpb24sIGludGVyc2VjdGlvbiwgZGlyZWN0aW9uKTtcbiAgaWYgKHNjZW5lLm1vZGUgPT09IFNjZW5lTW9kZS5DT0xVTUJVU19WSUVXKSB7XG4gICAgQ2FydGVzaWFuMy5mcm9tRWxlbWVudHMoZGlyZWN0aW9uLnksIGRpcmVjdGlvbi56LCBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uKTtcbiAgfVxuXG4gIENhcnRlc2lhbjMuYWRkKGNhbWVyYS5wb3NpdGlvbiwgZGlyZWN0aW9uLCBjYW1lcmEucG9zaXRpb24pO1xufVxuXG52YXIgc3BpbjNEUGljayA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaENhcnRvZ3JhcGhpYyA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcbnZhciBzY3JhdGNoUmFkaWkgPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHNjcmF0Y2hFbGxpcHNvaWQgPSBuZXcgRWxsaXBzb2lkKCk7XG52YXIgc2NyYXRjaExvb2tVcCA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaE5vcm1hbCA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG5cbmZ1bmN0aW9uIHNwaW4zRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCkge1xuICB2YXIgc2NlbmUgPSBjb250cm9sbGVyLl9zY2VuZTtcbiAgdmFyIGNhbWVyYSA9IHNjZW5lLmNhbWVyYTtcbiAgdmFyIGNhbWVyYVVuZGVyZ3JvdW5kID0gY29udHJvbGxlci5fY2FtZXJhVW5kZXJncm91bmQ7XG4gIHZhciBlbGxpcHNvaWQgPSBjb250cm9sbGVyLl9lbGxpcHNvaWQ7XG5cbiAgaWYgKCFNYXRyaXg0LmVxdWFscyhjYW1lcmEudHJhbnNmb3JtLCBNYXRyaXg0LklERU5USVRZKSkge1xuICAgIHJvdGF0ZTNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50KTtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbWFnbml0dWRlO1xuICB2YXIgcmFkaWk7XG5cbiAgdmFyIHVwID0gZWxsaXBzb2lkLmdlb2RldGljU3VyZmFjZU5vcm1hbChjYW1lcmEucG9zaXRpb24sIHNjcmF0Y2hMb29rVXApO1xuXG4gIGlmIChDYXJ0ZXNpYW4yLmVxdWFscyhzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl9yb3RhdGVNb3VzZVBvc2l0aW9uKSkge1xuICAgIGlmIChjb250cm9sbGVyLl9sb29raW5nKSB7XG4gICAgICBsb29rM0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQsIHVwKTtcbiAgICB9IGVsc2UgaWYgKGNvbnRyb2xsZXIuX3JvdGF0aW5nKSB7XG4gICAgICByb3RhdGUzRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCk7XG4gICAgfSBlbHNlIGlmIChjb250cm9sbGVyLl9zdHJhZmluZykge1xuICAgICAgY29udGludWVTdHJhZmluZyhjb250cm9sbGVyLCBtb3ZlbWVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChcbiAgICAgICAgQ2FydGVzaWFuMy5tYWduaXR1ZGUoY2FtZXJhLnBvc2l0aW9uKSA8XG4gICAgICAgIENhcnRlc2lhbjMubWFnbml0dWRlKGNvbnRyb2xsZXIuX3JvdGF0ZVN0YXJ0UG9zaXRpb24pXG4gICAgICApIHtcbiAgICAgICAgLy8gUGFuIGFjdGlvbiBpcyBubyBsb25nZXIgdmFsaWQgaWYgY2FtZXJhIG1vdmVzIGJlbG93IHRoZSBwYW4gZWxsaXBzb2lkXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIG1hZ25pdHVkZSA9IENhcnRlc2lhbjMubWFnbml0dWRlKGNvbnRyb2xsZXIuX3JvdGF0ZVN0YXJ0UG9zaXRpb24pO1xuICAgICAgcmFkaWkgPSBzY3JhdGNoUmFkaWk7XG4gICAgICByYWRpaS54ID0gcmFkaWkueSA9IHJhZGlpLnogPSBtYWduaXR1ZGU7XG4gICAgICBlbGxpcHNvaWQgPSBFbGxpcHNvaWQuZnJvbUNhcnRlc2lhbjMocmFkaWksIHNjcmF0Y2hFbGxpcHNvaWQpO1xuICAgICAgcGFuM0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQsIGVsbGlwc29pZCk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuICBjb250cm9sbGVyLl9sb29raW5nID0gZmFsc2U7XG4gIGNvbnRyb2xsZXIuX3JvdGF0aW5nID0gZmFsc2U7XG4gIGNvbnRyb2xsZXIuX3N0cmFmaW5nID0gZmFsc2U7XG5cbiAgdmFyIGhlaWdodCA9IGVsbGlwc29pZC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhcbiAgICBjYW1lcmEucG9zaXRpb25XQyxcbiAgICBzY3JhdGNoQ2FydG9ncmFwaGljXG4gICkuaGVpZ2h0O1xuICB2YXIgZ2xvYmUgPSBjb250cm9sbGVyLl9nbG9iZTtcblxuICBpZiAoZGVmaW5lZChnbG9iZSkgJiYgaGVpZ2h0IDwgY29udHJvbGxlci5fbWluaW11bVBpY2tpbmdUZXJyYWluSGVpZ2h0KSB7XG4gICAgdmFyIG1vdXNlUG9zID0gcGlja0dsb2JlKFxuICAgICAgY29udHJvbGxlcixcbiAgICAgIG1vdmVtZW50LnN0YXJ0UG9zaXRpb24sXG4gICAgICBzY3JhdGNoTW91c2VQb3NcbiAgICApO1xuICAgIGlmIChkZWZpbmVkKG1vdXNlUG9zKSkge1xuICAgICAgdmFyIHN0cmFmaW5nID0gZmFsc2U7XG4gICAgICB2YXIgcmF5ID0gY2FtZXJhLmdldFBpY2tSYXkobW92ZW1lbnQuc3RhcnRQb3NpdGlvbiwgcGlja0dsb2JlU2NyYXRjaFJheSk7XG5cbiAgICAgIGlmIChjYW1lcmFVbmRlcmdyb3VuZCkge1xuICAgICAgICBzdHJhZmluZyA9IHRydWU7XG4gICAgICAgIGdldFN0cmFmZVN0YXJ0UG9zaXRpb25VbmRlcmdyb3VuZChjb250cm9sbGVyLCByYXksIG1vdXNlUG9zLCBtb3VzZVBvcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbm9ybWFsID0gZWxsaXBzb2lkLmdlb2RldGljU3VyZmFjZU5vcm1hbChtb3VzZVBvcywgc2NyYXRjaE5vcm1hbCk7XG4gICAgICAgIHZhciB0YW5nZW50UGljayA9XG4gICAgICAgICAgTWF0aC5hYnMoQ2FydGVzaWFuMy5kb3QocmF5LmRpcmVjdGlvbiwgbm9ybWFsKSkgPCAwLjA1O1xuXG4gICAgICAgIGlmICh0YW5nZW50UGljaykge1xuICAgICAgICAgIHN0cmFmaW5nID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdHJhZmluZyA9XG4gICAgICAgICAgICBDYXJ0ZXNpYW4zLm1hZ25pdHVkZShjYW1lcmEucG9zaXRpb24pIDxcbiAgICAgICAgICAgIENhcnRlc2lhbjMubWFnbml0dWRlKG1vdXNlUG9zKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoc3RyYWZpbmcpIHtcbiAgICAgICAgQ2FydGVzaWFuMi5jbG9uZShzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl9zdHJhZmVFbmRNb3VzZVBvc2l0aW9uKTtcbiAgICAgICAgQ2FydGVzaWFuMy5jbG9uZShtb3VzZVBvcywgY29udHJvbGxlci5fc3RyYWZlU3RhcnRQb3NpdGlvbik7XG4gICAgICAgIGNvbnRyb2xsZXIuX3N0cmFmaW5nID0gdHJ1ZTtcbiAgICAgICAgc3RyYWZlKGNvbnRyb2xsZXIsIG1vdmVtZW50LCBjb250cm9sbGVyLl9zdHJhZmVTdGFydFBvc2l0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1hZ25pdHVkZSA9IENhcnRlc2lhbjMubWFnbml0dWRlKG1vdXNlUG9zKTtcbiAgICAgICAgcmFkaWkgPSBzY3JhdGNoUmFkaWk7XG4gICAgICAgIHJhZGlpLnggPSByYWRpaS55ID0gcmFkaWkueiA9IG1hZ25pdHVkZTtcbiAgICAgICAgZWxsaXBzb2lkID0gRWxsaXBzb2lkLmZyb21DYXJ0ZXNpYW4zKHJhZGlpLCBzY3JhdGNoRWxsaXBzb2lkKTtcbiAgICAgICAgcGFuM0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQsIGVsbGlwc29pZCk7XG5cbiAgICAgICAgQ2FydGVzaWFuMy5jbG9uZShtb3VzZVBvcywgY29udHJvbGxlci5fcm90YXRlU3RhcnRQb3NpdGlvbik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRyb2xsZXIuX2xvb2tpbmcgPSB0cnVlO1xuICAgICAgbG9vazNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50LCB1cCk7XG4gICAgfVxuICB9IGVsc2UgaWYgKFxuICAgIGRlZmluZWQoXG4gICAgICBjYW1lcmEucGlja0VsbGlwc29pZChcbiAgICAgICAgbW92ZW1lbnQuc3RhcnRQb3NpdGlvbixcbiAgICAgICAgY29udHJvbGxlci5fZWxsaXBzb2lkLFxuICAgICAgICBzcGluM0RQaWNrXG4gICAgICApXG4gICAgKVxuICApIHtcbiAgICBwYW4zRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCwgY29udHJvbGxlci5fZWxsaXBzb2lkKTtcbiAgICBDYXJ0ZXNpYW4zLmNsb25lKHNwaW4zRFBpY2ssIGNvbnRyb2xsZXIuX3JvdGF0ZVN0YXJ0UG9zaXRpb24pO1xuICB9IGVsc2UgaWYgKGhlaWdodCA+IGNvbnRyb2xsZXIuX21pbmltdW1UcmFja0JhbGxIZWlnaHQpIHtcbiAgICBjb250cm9sbGVyLl9yb3RhdGluZyA9IHRydWU7XG4gICAgcm90YXRlM0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQpO1xuICB9IGVsc2Uge1xuICAgIGNvbnRyb2xsZXIuX2xvb2tpbmcgPSB0cnVlO1xuICAgIGxvb2szRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCwgdXApO1xuICB9XG5cbiAgQ2FydGVzaWFuMi5jbG9uZShzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl9yb3RhdGVNb3VzZVBvc2l0aW9uKTtcbn1cblxuZnVuY3Rpb24gcm90YXRlM0QoXG4gIGNvbnRyb2xsZXIsXG4gIHN0YXJ0UG9zaXRpb24sXG4gIG1vdmVtZW50LFxuICBjb25zdHJhaW5lZEF4aXMsXG4gIHJvdGF0ZU9ubHlWZXJ0aWNhbCxcbiAgcm90YXRlT25seUhvcml6b250YWxcbikge1xuICByb3RhdGVPbmx5VmVydGljYWwgPSBkZWZhdWx0VmFsdWUocm90YXRlT25seVZlcnRpY2FsLCBmYWxzZSk7XG4gIHJvdGF0ZU9ubHlIb3Jpem9udGFsID0gZGVmYXVsdFZhbHVlKHJvdGF0ZU9ubHlIb3Jpem9udGFsLCBmYWxzZSk7XG5cbiAgdmFyIHNjZW5lID0gY29udHJvbGxlci5fc2NlbmU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG4gIHZhciBjYW52YXMgPSBzY2VuZS5jYW52YXM7XG5cbiAgdmFyIG9sZEF4aXMgPSBjYW1lcmEuY29uc3RyYWluZWRBeGlzO1xuICBpZiAoZGVmaW5lZChjb25zdHJhaW5lZEF4aXMpKSB7XG4gICAgY2FtZXJhLmNvbnN0cmFpbmVkQXhpcyA9IGNvbnN0cmFpbmVkQXhpcztcbiAgfVxuXG4gIHZhciByaG8gPSBDYXJ0ZXNpYW4zLm1hZ25pdHVkZShjYW1lcmEucG9zaXRpb24pO1xuICB2YXIgcm90YXRlUmF0ZSA9XG4gICAgY29udHJvbGxlci5fcm90YXRlRmFjdG9yICogKHJobyAtIGNvbnRyb2xsZXIuX3JvdGF0ZVJhdGVSYW5nZUFkanVzdG1lbnQpO1xuXG4gIGlmIChyb3RhdGVSYXRlID4gY29udHJvbGxlci5fbWF4aW11bVJvdGF0ZVJhdGUpIHtcbiAgICByb3RhdGVSYXRlID0gY29udHJvbGxlci5fbWF4aW11bVJvdGF0ZVJhdGU7XG4gIH1cblxuICBpZiAocm90YXRlUmF0ZSA8IGNvbnRyb2xsZXIuX21pbmltdW1Sb3RhdGVSYXRlKSB7XG4gICAgcm90YXRlUmF0ZSA9IGNvbnRyb2xsZXIuX21pbmltdW1Sb3RhdGVSYXRlO1xuICB9XG5cbiAgdmFyIHBoaVdpbmRvd1JhdGlvID1cbiAgICAobW92ZW1lbnQuc3RhcnRQb3NpdGlvbi54IC0gbW92ZW1lbnQuZW5kUG9zaXRpb24ueCkgLyBjYW52YXMuY2xpZW50V2lkdGg7XG4gIHZhciB0aGV0YVdpbmRvd1JhdGlvID1cbiAgICAobW92ZW1lbnQuc3RhcnRQb3NpdGlvbi55IC0gbW92ZW1lbnQuZW5kUG9zaXRpb24ueSkgLyBjYW52YXMuY2xpZW50SGVpZ2h0O1xuICBwaGlXaW5kb3dSYXRpbyA9IE1hdGgubWluKHBoaVdpbmRvd1JhdGlvLCBjb250cm9sbGVyLm1heGltdW1Nb3ZlbWVudFJhdGlvKTtcbiAgdGhldGFXaW5kb3dSYXRpbyA9IE1hdGgubWluKFxuICAgIHRoZXRhV2luZG93UmF0aW8sXG4gICAgY29udHJvbGxlci5tYXhpbXVtTW92ZW1lbnRSYXRpb1xuICApO1xuXG4gIHZhciBkZWx0YVBoaSA9IHJvdGF0ZVJhdGUgKiBwaGlXaW5kb3dSYXRpbyAqIE1hdGguUEkgKiAyLjA7XG4gIHZhciBkZWx0YVRoZXRhID0gcm90YXRlUmF0ZSAqIHRoZXRhV2luZG93UmF0aW8gKiBNYXRoLlBJO1xuXG4gIGlmICghcm90YXRlT25seVZlcnRpY2FsKSB7XG4gICAgY2FtZXJhLnJvdGF0ZVJpZ2h0KGRlbHRhUGhpKTtcbiAgfVxuXG4gIGlmICghcm90YXRlT25seUhvcml6b250YWwpIHtcbiAgICBjYW1lcmEucm90YXRlVXAoZGVsdGFUaGV0YSk7XG4gIH1cblxuICBjYW1lcmEuY29uc3RyYWluZWRBeGlzID0gb2xkQXhpcztcbn1cblxudmFyIHBhbjNEUDAgPSBDYXJ0ZXNpYW40LmNsb25lKENhcnRlc2lhbjQuVU5JVF9XKTtcbnZhciBwYW4zRFAxID0gQ2FydGVzaWFuNC5jbG9uZShDYXJ0ZXNpYW40LlVOSVRfVyk7XG52YXIgcGFuM0RUZW1wMCA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgcGFuM0RUZW1wMSA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgcGFuM0RUZW1wMiA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgcGFuM0RUZW1wMyA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgcGFuM0RTdGFydE1vdXNlUG9zaXRpb24gPSBuZXcgQ2FydGVzaWFuMigpO1xudmFyIHBhbjNERW5kTW91c2VQb3NpdGlvbiA9IG5ldyBDYXJ0ZXNpYW4yKCk7XG5cbmZ1bmN0aW9uIHBhbjNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50LCBlbGxpcHNvaWQpIHtcbiAgdmFyIHNjZW5lID0gY29udHJvbGxlci5fc2NlbmU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG5cbiAgdmFyIHN0YXJ0TW91c2VQb3NpdGlvbiA9IENhcnRlc2lhbjIuY2xvbmUoXG4gICAgbW92ZW1lbnQuc3RhcnRQb3NpdGlvbixcbiAgICBwYW4zRFN0YXJ0TW91c2VQb3NpdGlvblxuICApO1xuICB2YXIgZW5kTW91c2VQb3NpdGlvbiA9IENhcnRlc2lhbjIuY2xvbmUoXG4gICAgbW92ZW1lbnQuZW5kUG9zaXRpb24sXG4gICAgcGFuM0RFbmRNb3VzZVBvc2l0aW9uXG4gICk7XG5cbiAgdmFyIHAwID0gY2FtZXJhLnBpY2tFbGxpcHNvaWQoc3RhcnRNb3VzZVBvc2l0aW9uLCBlbGxpcHNvaWQsIHBhbjNEUDApO1xuICB2YXIgcDEgPSBjYW1lcmEucGlja0VsbGlwc29pZChlbmRNb3VzZVBvc2l0aW9uLCBlbGxpcHNvaWQsIHBhbjNEUDEpO1xuXG4gIGlmICghZGVmaW5lZChwMCkgfHwgIWRlZmluZWQocDEpKSB7XG4gICAgY29udHJvbGxlci5fcm90YXRpbmcgPSB0cnVlO1xuICAgIHJvdGF0ZTNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50KTtcbiAgICByZXR1cm47XG4gIH1cblxuICBwMCA9IGNhbWVyYS53b3JsZFRvQ2FtZXJhQ29vcmRpbmF0ZXMocDAsIHAwKTtcbiAgcDEgPSBjYW1lcmEud29ybGRUb0NhbWVyYUNvb3JkaW5hdGVzKHAxLCBwMSk7XG5cbiAgaWYgKCFkZWZpbmVkKGNhbWVyYS5jb25zdHJhaW5lZEF4aXMpKSB7XG4gICAgQ2FydGVzaWFuMy5ub3JtYWxpemUocDAsIHAwKTtcbiAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShwMSwgcDEpO1xuICAgIHZhciBkb3QgPSBDYXJ0ZXNpYW4zLmRvdChwMCwgcDEpO1xuICAgIHZhciBheGlzID0gQ2FydGVzaWFuMy5jcm9zcyhwMCwgcDEsIHBhbjNEVGVtcDApO1xuXG4gICAgaWYgKFxuICAgICAgZG90IDwgMS4wICYmXG4gICAgICAhQ2FydGVzaWFuMy5lcXVhbHNFcHNpbG9uKGF4aXMsIENhcnRlc2lhbjMuWkVSTywgQ2VzaXVtTWF0aC5FUFNJTE9OMTQpXG4gICAgKSB7XG4gICAgICAvLyBkb3QgaXMgaW4gWzAsIDFdXG4gICAgICB2YXIgYW5nbGUgPSBNYXRoLmFjb3MoZG90KTtcbiAgICAgIGNhbWVyYS5yb3RhdGUoYXhpcywgYW5nbGUpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB2YXIgYmFzaXMwID0gY2FtZXJhLmNvbnN0cmFpbmVkQXhpcztcbiAgICB2YXIgYmFzaXMxID0gQ2FydGVzaWFuMy5tb3N0T3J0aG9nb25hbEF4aXMoYmFzaXMwLCBwYW4zRFRlbXAwKTtcbiAgICBDYXJ0ZXNpYW4zLmNyb3NzKGJhc2lzMSwgYmFzaXMwLCBiYXNpczEpO1xuICAgIENhcnRlc2lhbjMubm9ybWFsaXplKGJhc2lzMSwgYmFzaXMxKTtcbiAgICB2YXIgYmFzaXMyID0gQ2FydGVzaWFuMy5jcm9zcyhiYXNpczAsIGJhc2lzMSwgcGFuM0RUZW1wMSk7XG5cbiAgICB2YXIgc3RhcnRSaG8gPSBDYXJ0ZXNpYW4zLm1hZ25pdHVkZShwMCk7XG4gICAgdmFyIHN0YXJ0RG90ID0gQ2FydGVzaWFuMy5kb3QoYmFzaXMwLCBwMCk7XG4gICAgdmFyIHN0YXJ0VGhldGEgPSBNYXRoLmFjb3Moc3RhcnREb3QgLyBzdGFydFJobyk7XG4gICAgdmFyIHN0YXJ0UmVqID0gQ2FydGVzaWFuMy5tdWx0aXBseUJ5U2NhbGFyKGJhc2lzMCwgc3RhcnREb3QsIHBhbjNEVGVtcDIpO1xuICAgIENhcnRlc2lhbjMuc3VidHJhY3QocDAsIHN0YXJ0UmVqLCBzdGFydFJlaik7XG4gICAgQ2FydGVzaWFuMy5ub3JtYWxpemUoc3RhcnRSZWosIHN0YXJ0UmVqKTtcblxuICAgIHZhciBlbmRSaG8gPSBDYXJ0ZXNpYW4zLm1hZ25pdHVkZShwMSk7XG4gICAgdmFyIGVuZERvdCA9IENhcnRlc2lhbjMuZG90KGJhc2lzMCwgcDEpO1xuICAgIHZhciBlbmRUaGV0YSA9IE1hdGguYWNvcyhlbmREb3QgLyBlbmRSaG8pO1xuICAgIHZhciBlbmRSZWogPSBDYXJ0ZXNpYW4zLm11bHRpcGx5QnlTY2FsYXIoYmFzaXMwLCBlbmREb3QsIHBhbjNEVGVtcDMpO1xuICAgIENhcnRlc2lhbjMuc3VidHJhY3QocDEsIGVuZFJlaiwgZW5kUmVqKTtcbiAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShlbmRSZWosIGVuZFJlaik7XG5cbiAgICB2YXIgc3RhcnRQaGkgPSBNYXRoLmFjb3MoQ2FydGVzaWFuMy5kb3Qoc3RhcnRSZWosIGJhc2lzMSkpO1xuICAgIGlmIChDYXJ0ZXNpYW4zLmRvdChzdGFydFJlaiwgYmFzaXMyKSA8IDApIHtcbiAgICAgIHN0YXJ0UGhpID0gQ2VzaXVtTWF0aC5UV09fUEkgLSBzdGFydFBoaTtcbiAgICB9XG5cbiAgICB2YXIgZW5kUGhpID0gTWF0aC5hY29zKENhcnRlc2lhbjMuZG90KGVuZFJlaiwgYmFzaXMxKSk7XG4gICAgaWYgKENhcnRlc2lhbjMuZG90KGVuZFJlaiwgYmFzaXMyKSA8IDApIHtcbiAgICAgIGVuZFBoaSA9IENlc2l1bU1hdGguVFdPX1BJIC0gZW5kUGhpO1xuICAgIH1cblxuICAgIHZhciBkZWx0YVBoaSA9IHN0YXJ0UGhpIC0gZW5kUGhpO1xuXG4gICAgdmFyIGVhc3Q7XG4gICAgaWYgKFxuICAgICAgQ2FydGVzaWFuMy5lcXVhbHNFcHNpbG9uKGJhc2lzMCwgY2FtZXJhLnBvc2l0aW9uLCBDZXNpdW1NYXRoLkVQU0lMT04yKVxuICAgICkge1xuICAgICAgZWFzdCA9IGNhbWVyYS5yaWdodDtcbiAgICB9IGVsc2Uge1xuICAgICAgZWFzdCA9IENhcnRlc2lhbjMuY3Jvc3MoYmFzaXMwLCBjYW1lcmEucG9zaXRpb24sIHBhbjNEVGVtcDApO1xuICAgIH1cblxuICAgIHZhciBwbGFuZU5vcm1hbCA9IENhcnRlc2lhbjMuY3Jvc3MoYmFzaXMwLCBlYXN0LCBwYW4zRFRlbXAwKTtcbiAgICB2YXIgc2lkZTAgPSBDYXJ0ZXNpYW4zLmRvdChcbiAgICAgIHBsYW5lTm9ybWFsLFxuICAgICAgQ2FydGVzaWFuMy5zdWJ0cmFjdChwMCwgYmFzaXMwLCBwYW4zRFRlbXAxKVxuICAgICk7XG4gICAgdmFyIHNpZGUxID0gQ2FydGVzaWFuMy5kb3QoXG4gICAgICBwbGFuZU5vcm1hbCxcbiAgICAgIENhcnRlc2lhbjMuc3VidHJhY3QocDEsIGJhc2lzMCwgcGFuM0RUZW1wMSlcbiAgICApO1xuXG4gICAgdmFyIGRlbHRhVGhldGE7XG4gICAgaWYgKHNpZGUwID4gMCAmJiBzaWRlMSA+IDApIHtcbiAgICAgIGRlbHRhVGhldGEgPSBlbmRUaGV0YSAtIHN0YXJ0VGhldGE7XG4gICAgfSBlbHNlIGlmIChzaWRlMCA+IDAgJiYgc2lkZTEgPD0gMCkge1xuICAgICAgaWYgKENhcnRlc2lhbjMuZG90KGNhbWVyYS5wb3NpdGlvbiwgYmFzaXMwKSA+IDApIHtcbiAgICAgICAgZGVsdGFUaGV0YSA9IC1zdGFydFRoZXRhIC0gZW5kVGhldGE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZWx0YVRoZXRhID0gc3RhcnRUaGV0YSArIGVuZFRoZXRhO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBkZWx0YVRoZXRhID0gc3RhcnRUaGV0YSAtIGVuZFRoZXRhO1xuICAgIH1cblxuICAgIGNhbWVyYS5yb3RhdGVSaWdodChkZWx0YVBoaSk7XG4gICAgY2FtZXJhLnJvdGF0ZVVwKGRlbHRhVGhldGEpO1xuICB9XG59XG5cbnZhciB6b29tM0RVbml0UG9zaXRpb24gPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHpvb20zRENhcnRvZ3JhcGhpYyA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcblxuZnVuY3Rpb24gem9vbTNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50KSB7XG4gIGlmIChkZWZpbmVkKG1vdmVtZW50LmRpc3RhbmNlKSkge1xuICAgIG1vdmVtZW50ID0gbW92ZW1lbnQuZGlzdGFuY2U7XG4gIH1cblxuICB2YXIgZWxsaXBzb2lkID0gY29udHJvbGxlci5fZWxsaXBzb2lkO1xuICB2YXIgc2NlbmUgPSBjb250cm9sbGVyLl9zY2VuZTtcbiAgdmFyIGNhbWVyYSA9IHNjZW5lLmNhbWVyYTtcbiAgdmFyIGNhbnZhcyA9IHNjZW5lLmNhbnZhcztcblxuICB2YXIgY2FtZXJhVW5kZXJncm91bmQgPSBjb250cm9sbGVyLl9jYW1lcmFVbmRlcmdyb3VuZDtcblxuICB2YXIgd2luZG93UG9zaXRpb247XG5cbiAgaWYgKGNhbWVyYVVuZGVyZ3JvdW5kKSB7XG4gICAgd2luZG93UG9zaXRpb24gPSBzdGFydFBvc2l0aW9uO1xuICB9IGVsc2Uge1xuICAgIHdpbmRvd1Bvc2l0aW9uID0gem9vbUNWV2luZG93UG9zO1xuICAgIHdpbmRvd1Bvc2l0aW9uLnggPSBjYW52YXMuY2xpZW50V2lkdGggLyAyO1xuICAgIHdpbmRvd1Bvc2l0aW9uLnkgPSBjYW52YXMuY2xpZW50SGVpZ2h0IC8gMjtcbiAgfVxuXG4gIHZhciByYXkgPSBjYW1lcmEuZ2V0UGlja1JheSh3aW5kb3dQb3NpdGlvbiwgem9vbUNWV2luZG93UmF5KTtcblxuICB2YXIgaW50ZXJzZWN0aW9uO1xuICB2YXIgaGVpZ2h0ID0gZWxsaXBzb2lkLmNhcnRlc2lhblRvQ2FydG9ncmFwaGljKFxuICAgIGNhbWVyYS5wb3NpdGlvbixcbiAgICB6b29tM0RDYXJ0b2dyYXBoaWNcbiAgKS5oZWlnaHQ7XG4gIGlmIChoZWlnaHQgPCBjb250cm9sbGVyLl9taW5pbXVtUGlja2luZ1RlcnJhaW5IZWlnaHQpIHtcbiAgICBpbnRlcnNlY3Rpb24gPSBwaWNrR2xvYmUoY29udHJvbGxlciwgd2luZG93UG9zaXRpb24sIHpvb21DVkludGVyc2VjdGlvbik7XG4gIH1cblxuICB2YXIgZGlzdGFuY2U7XG4gIGlmIChkZWZpbmVkKGludGVyc2VjdGlvbikpIHtcbiAgICBkaXN0YW5jZSA9IENhcnRlc2lhbjMuZGlzdGFuY2UocmF5Lm9yaWdpbiwgaW50ZXJzZWN0aW9uKTtcbiAgfVxuXG4gIGlmIChjYW1lcmFVbmRlcmdyb3VuZCkge1xuICAgIHZhciBkaXN0YW5jZVVuZGVyZ3JvdW5kID0gZ2V0Wm9vbURpc3RhbmNlVW5kZXJncm91bmQoXG4gICAgICBjb250cm9sbGVyLFxuICAgICAgcmF5LFxuICAgICAgaGVpZ2h0XG4gICAgKTtcbiAgICBpZiAoZGVmaW5lZChkaXN0YW5jZSkpIHtcbiAgICAgIGRpc3RhbmNlID0gTWF0aC5taW4oZGlzdGFuY2UsIGRpc3RhbmNlVW5kZXJncm91bmQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaXN0YW5jZSA9IGRpc3RhbmNlVW5kZXJncm91bmQ7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFkZWZpbmVkKGRpc3RhbmNlKSkge1xuICAgIGRpc3RhbmNlID0gaGVpZ2h0O1xuICB9XG5cbiAgdmFyIHVuaXRQb3NpdGlvbiA9IENhcnRlc2lhbjMubm9ybWFsaXplKGNhbWVyYS5wb3NpdGlvbiwgem9vbTNEVW5pdFBvc2l0aW9uKTtcbiAgaGFuZGxlWm9vbShcbiAgICBjb250cm9sbGVyLFxuICAgIHN0YXJ0UG9zaXRpb24sXG4gICAgbW92ZW1lbnQsXG4gICAgY29udHJvbGxlci5fem9vbUZhY3RvcixcbiAgICBkaXN0YW5jZSxcbiAgICBDYXJ0ZXNpYW4zLmRvdCh1bml0UG9zaXRpb24sIGNhbWVyYS5kaXJlY3Rpb24pXG4gICk7XG59XG5cbnZhciB0aWx0M0RXaW5kb3dQb3MgPSBuZXcgQ2FydGVzaWFuMigpO1xudmFyIHRpbHQzRFJheSA9IG5ldyBSYXkoKTtcbnZhciB0aWx0M0RDZW50ZXIgPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHRpbHQzRFZlcnRpY2FsQ2VudGVyID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciB0aWx0M0RUcmFuc2Zvcm0gPSBuZXcgTWF0cml4NCgpO1xudmFyIHRpbHQzRFZlcnRpY2FsVHJhbnNmb3JtID0gbmV3IE1hdHJpeDQoKTtcbnZhciB0aWx0M0RPbGRUcmFuc2Zvcm0gPSBuZXcgTWF0cml4NCgpO1xudmFyIHRpbHQzRFF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpO1xudmFyIHRpbHQzRE1hdHJpeCA9IG5ldyBNYXRyaXgzKCk7XG52YXIgdGlsdDNEQ2FydCA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcbnZhciB0aWx0M0RMb29rVXAgPSBuZXcgQ2FydGVzaWFuMygpO1xuXG5mdW5jdGlvbiB0aWx0M0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQpIHtcbiAgdmFyIHNjZW5lID0gY29udHJvbGxlci5fc2NlbmU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG5cbiAgaWYgKCFNYXRyaXg0LmVxdWFscyhjYW1lcmEudHJhbnNmb3JtLCBNYXRyaXg0LklERU5USVRZKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChkZWZpbmVkKG1vdmVtZW50LmFuZ2xlQW5kSGVpZ2h0KSkge1xuICAgIG1vdmVtZW50ID0gbW92ZW1lbnQuYW5nbGVBbmRIZWlnaHQ7XG4gIH1cblxuICBpZiAoIUNhcnRlc2lhbjIuZXF1YWxzKHN0YXJ0UG9zaXRpb24sIGNvbnRyb2xsZXIuX3RpbHRDZW50ZXJNb3VzZVBvc2l0aW9uKSkge1xuICAgIGNvbnRyb2xsZXIuX3RpbHRPbkVsbGlwc29pZCA9IGZhbHNlO1xuICAgIGNvbnRyb2xsZXIuX2xvb2tpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIGlmIChjb250cm9sbGVyLl9sb29raW5nKSB7XG4gICAgdmFyIHVwID0gY29udHJvbGxlci5fZWxsaXBzb2lkLmdlb2RldGljU3VyZmFjZU5vcm1hbChcbiAgICAgIGNhbWVyYS5wb3NpdGlvbixcbiAgICAgIHRpbHQzRExvb2tVcFxuICAgICk7XG4gICAgbG9vazNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50LCB1cCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGVsbGlwc29pZCA9IGNvbnRyb2xsZXIuX2VsbGlwc29pZDtcbiAgdmFyIGNhcnRvZ3JhcGhpYyA9IGVsbGlwc29pZC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhcbiAgICBjYW1lcmEucG9zaXRpb24sXG4gICAgdGlsdDNEQ2FydFxuICApO1xuXG4gIGlmIChcbiAgICBjb250cm9sbGVyLl90aWx0T25FbGxpcHNvaWQgfHxcbiAgICBjYXJ0b2dyYXBoaWMuaGVpZ2h0ID4gY29udHJvbGxlci5fbWluaW11bUNvbGxpc2lvblRlcnJhaW5IZWlnaHRcbiAgKSB7XG4gICAgY29udHJvbGxlci5fdGlsdE9uRWxsaXBzb2lkID0gdHJ1ZTtcbiAgICB0aWx0M0RPbkVsbGlwc29pZChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCk7XG4gIH0gZWxzZSB7XG4gICAgdGlsdDNET25UZXJyYWluKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50KTtcbiAgfVxufVxuXG52YXIgdGlsdDNET25FbGxpcHNvaWRDYXJ0b2dyYXBoaWMgPSBuZXcgQ2FydG9ncmFwaGljKCk7XG5cbmZ1bmN0aW9uIHRpbHQzRE9uRWxsaXBzb2lkKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50KSB7XG4gIHZhciBlbGxpcHNvaWQgPSBjb250cm9sbGVyLl9lbGxpcHNvaWQ7XG4gIHZhciBzY2VuZSA9IGNvbnRyb2xsZXIuX3NjZW5lO1xuICB2YXIgY2FtZXJhID0gc2NlbmUuY2FtZXJhO1xuICB2YXIgbWluSGVpZ2h0ID0gY29udHJvbGxlci5taW5pbXVtWm9vbURpc3RhbmNlICogMC4yNTtcbiAgdmFyIGhlaWdodCA9IGVsbGlwc29pZC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhcbiAgICBjYW1lcmEucG9zaXRpb25XQyxcbiAgICB0aWx0M0RPbkVsbGlwc29pZENhcnRvZ3JhcGhpY1xuICApLmhlaWdodDtcbiAgaWYgKFxuICAgIGhlaWdodCAtIG1pbkhlaWdodCAtIDEuMCA8IENlc2l1bU1hdGguRVBTSUxPTjMgJiZcbiAgICBtb3ZlbWVudC5lbmRQb3NpdGlvbi55IC0gbW92ZW1lbnQuc3RhcnRQb3NpdGlvbi55IDwgMFxuICApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgY2FudmFzID0gc2NlbmUuY2FudmFzO1xuXG4gIHZhciB3aW5kb3dQb3NpdGlvbiA9IHRpbHQzRFdpbmRvd1BvcztcbiAgd2luZG93UG9zaXRpb24ueCA9IGNhbnZhcy5jbGllbnRXaWR0aCAvIDI7XG4gIHdpbmRvd1Bvc2l0aW9uLnkgPSBjYW52YXMuY2xpZW50SGVpZ2h0IC8gMjtcbiAgdmFyIHJheSA9IGNhbWVyYS5nZXRQaWNrUmF5KHdpbmRvd1Bvc2l0aW9uLCB0aWx0M0RSYXkpO1xuXG4gIHZhciBjZW50ZXI7XG4gIHZhciBpbnRlcnNlY3Rpb24gPSBJbnRlcnNlY3Rpb25UZXN0cy5yYXlFbGxpcHNvaWQocmF5LCBlbGxpcHNvaWQpO1xuICBpZiAoZGVmaW5lZChpbnRlcnNlY3Rpb24pKSB7XG4gICAgY2VudGVyID0gUmF5LmdldFBvaW50KHJheSwgaW50ZXJzZWN0aW9uLnN0YXJ0LCB0aWx0M0RDZW50ZXIpO1xuICB9IGVsc2UgaWYgKGhlaWdodCA+IGNvbnRyb2xsZXIuX21pbmltdW1UcmFja0JhbGxIZWlnaHQpIHtcbiAgICB2YXIgZ3JhemluZ0FsdGl0dWRlTG9jYXRpb24gPSBJbnRlcnNlY3Rpb25UZXN0cy5ncmF6aW5nQWx0aXR1ZGVMb2NhdGlvbihcbiAgICAgIHJheSxcbiAgICAgIGVsbGlwc29pZFxuICAgICk7XG4gICAgaWYgKCFkZWZpbmVkKGdyYXppbmdBbHRpdHVkZUxvY2F0aW9uKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgZ3JhemluZ0FsdGl0dWRlQ2FydCA9IGVsbGlwc29pZC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhcbiAgICAgIGdyYXppbmdBbHRpdHVkZUxvY2F0aW9uLFxuICAgICAgdGlsdDNEQ2FydFxuICAgICk7XG4gICAgZ3JhemluZ0FsdGl0dWRlQ2FydC5oZWlnaHQgPSAwLjA7XG4gICAgY2VudGVyID0gZWxsaXBzb2lkLmNhcnRvZ3JhcGhpY1RvQ2FydGVzaWFuKFxuICAgICAgZ3JhemluZ0FsdGl0dWRlQ2FydCxcbiAgICAgIHRpbHQzRENlbnRlclxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgY29udHJvbGxlci5fbG9va2luZyA9IHRydWU7XG4gICAgdmFyIHVwID0gY29udHJvbGxlci5fZWxsaXBzb2lkLmdlb2RldGljU3VyZmFjZU5vcm1hbChcbiAgICAgIGNhbWVyYS5wb3NpdGlvbixcbiAgICAgIHRpbHQzRExvb2tVcFxuICAgICk7XG4gICAgbG9vazNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50LCB1cCk7XG4gICAgQ2FydGVzaWFuMi5jbG9uZShzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl90aWx0Q2VudGVyTW91c2VQb3NpdGlvbik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHRyYW5zZm9ybSA9IFRyYW5zZm9ybXMuZWFzdE5vcnRoVXBUb0ZpeGVkRnJhbWUoXG4gICAgY2VudGVyLFxuICAgIGVsbGlwc29pZCxcbiAgICB0aWx0M0RUcmFuc2Zvcm1cbiAgKTtcblxuICB2YXIgb2xkR2xvYmUgPSBjb250cm9sbGVyLl9nbG9iZTtcbiAgdmFyIG9sZEVsbGlwc29pZCA9IGNvbnRyb2xsZXIuX2VsbGlwc29pZDtcbiAgY29udHJvbGxlci5fZ2xvYmUgPSB1bmRlZmluZWQ7XG4gIGNvbnRyb2xsZXIuX2VsbGlwc29pZCA9IEVsbGlwc29pZC5VTklUX1NQSEVSRTtcbiAgY29udHJvbGxlci5fcm90YXRlRmFjdG9yID0gMS4wO1xuICBjb250cm9sbGVyLl9yb3RhdGVSYXRlUmFuZ2VBZGp1c3RtZW50ID0gMS4wO1xuXG4gIHZhciBvbGRUcmFuc2Zvcm0gPSBNYXRyaXg0LmNsb25lKGNhbWVyYS50cmFuc2Zvcm0sIHRpbHQzRE9sZFRyYW5zZm9ybSk7XG4gIGNhbWVyYS5fc2V0VHJhbnNmb3JtKHRyYW5zZm9ybSk7XG5cbiAgcm90YXRlM0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQsIENhcnRlc2lhbjMuVU5JVF9aKTtcblxuICBjYW1lcmEuX3NldFRyYW5zZm9ybShvbGRUcmFuc2Zvcm0pO1xuICBjb250cm9sbGVyLl9nbG9iZSA9IG9sZEdsb2JlO1xuICBjb250cm9sbGVyLl9lbGxpcHNvaWQgPSBvbGRFbGxpcHNvaWQ7XG5cbiAgdmFyIHJhZGl1cyA9IG9sZEVsbGlwc29pZC5tYXhpbXVtUmFkaXVzO1xuICBjb250cm9sbGVyLl9yb3RhdGVGYWN0b3IgPSAxLjAgLyByYWRpdXM7XG4gIGNvbnRyb2xsZXIuX3JvdGF0ZVJhdGVSYW5nZUFkanVzdG1lbnQgPSByYWRpdXM7XG59XG5cbmZ1bmN0aW9uIHRpbHQzRE9uVGVycmFpbihjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCkge1xuICB2YXIgZWxsaXBzb2lkID0gY29udHJvbGxlci5fZWxsaXBzb2lkO1xuICB2YXIgc2NlbmUgPSBjb250cm9sbGVyLl9zY2VuZTtcbiAgdmFyIGNhbWVyYSA9IHNjZW5lLmNhbWVyYTtcbiAgdmFyIGNhbWVyYVVuZGVyZ3JvdW5kID0gY29udHJvbGxlci5fY2FtZXJhVW5kZXJncm91bmQ7XG5cbiAgdmFyIGNlbnRlcjtcbiAgdmFyIHJheTtcbiAgdmFyIGludGVyc2VjdGlvbjtcblxuICBpZiAoQ2FydGVzaWFuMi5lcXVhbHMoc3RhcnRQb3NpdGlvbiwgY29udHJvbGxlci5fdGlsdENlbnRlck1vdXNlUG9zaXRpb24pKSB7XG4gICAgY2VudGVyID0gQ2FydGVzaWFuMy5jbG9uZShjb250cm9sbGVyLl90aWx0Q2VudGVyLCB0aWx0M0RDZW50ZXIpO1xuICB9IGVsc2Uge1xuICAgIGNlbnRlciA9IHBpY2tHbG9iZShjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCB0aWx0M0RDZW50ZXIpO1xuXG4gICAgaWYgKCFkZWZpbmVkKGNlbnRlcikpIHtcbiAgICAgIHJheSA9IGNhbWVyYS5nZXRQaWNrUmF5KHN0YXJ0UG9zaXRpb24sIHRpbHQzRFJheSk7XG4gICAgICBpbnRlcnNlY3Rpb24gPSBJbnRlcnNlY3Rpb25UZXN0cy5yYXlFbGxpcHNvaWQocmF5LCBlbGxpcHNvaWQpO1xuICAgICAgaWYgKCFkZWZpbmVkKGludGVyc2VjdGlvbikpIHtcbiAgICAgICAgdmFyIGNhcnRvZ3JhcGhpYyA9IGVsbGlwc29pZC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhcbiAgICAgICAgICBjYW1lcmEucG9zaXRpb24sXG4gICAgICAgICAgdGlsdDNEQ2FydFxuICAgICAgICApO1xuICAgICAgICBpZiAoY2FydG9ncmFwaGljLmhlaWdodCA8PSBjb250cm9sbGVyLl9taW5pbXVtVHJhY2tCYWxsSGVpZ2h0KSB7XG4gICAgICAgICAgY29udHJvbGxlci5fbG9va2luZyA9IHRydWU7XG4gICAgICAgICAgdmFyIHVwID0gY29udHJvbGxlci5fZWxsaXBzb2lkLmdlb2RldGljU3VyZmFjZU5vcm1hbChcbiAgICAgICAgICAgIGNhbWVyYS5wb3NpdGlvbixcbiAgICAgICAgICAgIHRpbHQzRExvb2tVcFxuICAgICAgICAgICk7XG4gICAgICAgICAgbG9vazNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50LCB1cCk7XG4gICAgICAgICAgQ2FydGVzaWFuMi5jbG9uZShzdGFydFBvc2l0aW9uLCBjb250cm9sbGVyLl90aWx0Q2VudGVyTW91c2VQb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2VudGVyID0gUmF5LmdldFBvaW50KHJheSwgaW50ZXJzZWN0aW9uLnN0YXJ0LCB0aWx0M0RDZW50ZXIpO1xuICAgIH1cblxuICAgIGlmIChjYW1lcmFVbmRlcmdyb3VuZCkge1xuICAgICAgaWYgKCFkZWZpbmVkKHJheSkpIHtcbiAgICAgICAgcmF5ID0gY2FtZXJhLmdldFBpY2tSYXkoc3RhcnRQb3NpdGlvbiwgdGlsdDNEUmF5KTtcbiAgICAgIH1cbiAgICAgIGdldFRpbHRDZW50ZXJVbmRlcmdyb3VuZChjb250cm9sbGVyLCByYXksIGNlbnRlciwgY2VudGVyKTtcbiAgICB9XG5cbiAgICBDYXJ0ZXNpYW4yLmNsb25lKHN0YXJ0UG9zaXRpb24sIGNvbnRyb2xsZXIuX3RpbHRDZW50ZXJNb3VzZVBvc2l0aW9uKTtcbiAgICBDYXJ0ZXNpYW4zLmNsb25lKGNlbnRlciwgY29udHJvbGxlci5fdGlsdENlbnRlcik7XG4gIH1cblxuICB2YXIgY2FudmFzID0gc2NlbmUuY2FudmFzO1xuXG4gIHZhciB3aW5kb3dQb3NpdGlvbiA9IHRpbHQzRFdpbmRvd1BvcztcbiAgd2luZG93UG9zaXRpb24ueCA9IGNhbnZhcy5jbGllbnRXaWR0aCAvIDI7XG4gIHdpbmRvd1Bvc2l0aW9uLnkgPSBjb250cm9sbGVyLl90aWx0Q2VudGVyTW91c2VQb3NpdGlvbi55O1xuICByYXkgPSBjYW1lcmEuZ2V0UGlja1JheSh3aW5kb3dQb3NpdGlvbiwgdGlsdDNEUmF5KTtcblxuICB2YXIgbWFnID0gQ2FydGVzaWFuMy5tYWduaXR1ZGUoY2VudGVyKTtcbiAgdmFyIHJhZGlpID0gQ2FydGVzaWFuMy5mcm9tRWxlbWVudHMobWFnLCBtYWcsIG1hZywgc2NyYXRjaFJhZGlpKTtcbiAgdmFyIG5ld0VsbGlwc29pZCA9IEVsbGlwc29pZC5mcm9tQ2FydGVzaWFuMyhyYWRpaSwgc2NyYXRjaEVsbGlwc29pZCk7XG5cbiAgaW50ZXJzZWN0aW9uID0gSW50ZXJzZWN0aW9uVGVzdHMucmF5RWxsaXBzb2lkKHJheSwgbmV3RWxsaXBzb2lkKTtcbiAgaWYgKCFkZWZpbmVkKGludGVyc2VjdGlvbikpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgdCA9XG4gICAgQ2FydGVzaWFuMy5tYWduaXR1ZGUocmF5Lm9yaWdpbikgPiBtYWdcbiAgICAgID8gaW50ZXJzZWN0aW9uLnN0YXJ0XG4gICAgICA6IGludGVyc2VjdGlvbi5zdG9wO1xuICB2YXIgdmVydGljYWxDZW50ZXIgPSBSYXkuZ2V0UG9pbnQocmF5LCB0LCB0aWx0M0RWZXJ0aWNhbENlbnRlcik7XG5cbiAgdmFyIHRyYW5zZm9ybSA9IFRyYW5zZm9ybXMuZWFzdE5vcnRoVXBUb0ZpeGVkRnJhbWUoXG4gICAgY2VudGVyLFxuICAgIGVsbGlwc29pZCxcbiAgICB0aWx0M0RUcmFuc2Zvcm1cbiAgKTtcbiAgdmFyIHZlcnRpY2FsVHJhbnNmb3JtID0gVHJhbnNmb3Jtcy5lYXN0Tm9ydGhVcFRvRml4ZWRGcmFtZShcbiAgICB2ZXJ0aWNhbENlbnRlcixcbiAgICBuZXdFbGxpcHNvaWQsXG4gICAgdGlsdDNEVmVydGljYWxUcmFuc2Zvcm1cbiAgKTtcblxuICB2YXIgb2xkR2xvYmUgPSBjb250cm9sbGVyLl9nbG9iZTtcbiAgdmFyIG9sZEVsbGlwc29pZCA9IGNvbnRyb2xsZXIuX2VsbGlwc29pZDtcbiAgY29udHJvbGxlci5fZ2xvYmUgPSB1bmRlZmluZWQ7XG4gIGNvbnRyb2xsZXIuX2VsbGlwc29pZCA9IEVsbGlwc29pZC5VTklUX1NQSEVSRTtcbiAgY29udHJvbGxlci5fcm90YXRlRmFjdG9yID0gMS4wO1xuICBjb250cm9sbGVyLl9yb3RhdGVSYXRlUmFuZ2VBZGp1c3RtZW50ID0gMS4wO1xuXG4gIHZhciBjb25zdHJhaW5lZEF4aXMgPSBDYXJ0ZXNpYW4zLlVOSVRfWjtcblxuICB2YXIgb2xkVHJhbnNmb3JtID0gTWF0cml4NC5jbG9uZShjYW1lcmEudHJhbnNmb3JtLCB0aWx0M0RPbGRUcmFuc2Zvcm0pO1xuICBjYW1lcmEuX3NldFRyYW5zZm9ybSh2ZXJ0aWNhbFRyYW5zZm9ybSk7XG5cbiAgdmFyIHRhbmdlbnQgPSBDYXJ0ZXNpYW4zLmNyb3NzKFxuICAgIHZlcnRpY2FsQ2VudGVyLFxuICAgIGNhbWVyYS5wb3NpdGlvbldDLFxuICAgIHRpbHQzRENhcnRlc2lhbjNcbiAgKTtcbiAgdmFyIGRvdCA9IENhcnRlc2lhbjMuZG90KGNhbWVyYS5yaWdodFdDLCB0YW5nZW50KTtcblxuICBpZiAoZG90IDwgMC4wKSB7XG4gICAgdmFyIG1vdmVtZW50RGVsdGEgPSBtb3ZlbWVudC5zdGFydFBvc2l0aW9uLnkgLSBtb3ZlbWVudC5lbmRQb3NpdGlvbi55O1xuICAgIGlmIChcbiAgICAgIChjYW1lcmFVbmRlcmdyb3VuZCAmJiBtb3ZlbWVudERlbHRhIDwgMC4wKSB8fFxuICAgICAgKCFjYW1lcmFVbmRlcmdyb3VuZCAmJiBtb3ZlbWVudERlbHRhID4gMC4wKVxuICAgICkge1xuICAgICAgLy8gUHJldmVudCBjYW1lcmEgZnJvbSBmbGlwcGluZyBwYXN0IHRoZSB1cCBheGlzXG4gICAgICBjb25zdHJhaW5lZEF4aXMgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgdmFyIG9sZENvbnN0cmFpbmVkQXhpcyA9IGNhbWVyYS5jb25zdHJhaW5lZEF4aXM7XG4gICAgY2FtZXJhLmNvbnN0cmFpbmVkQXhpcyA9IHVuZGVmaW5lZDtcblxuICAgIHJvdGF0ZTNEKGNvbnRyb2xsZXIsIHN0YXJ0UG9zaXRpb24sIG1vdmVtZW50LCBjb25zdHJhaW5lZEF4aXMsIHRydWUsIGZhbHNlKTtcblxuICAgIGNhbWVyYS5jb25zdHJhaW5lZEF4aXMgPSBvbGRDb25zdHJhaW5lZEF4aXM7XG4gIH0gZWxzZSB7XG4gICAgcm90YXRlM0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQsIGNvbnN0cmFpbmVkQXhpcywgdHJ1ZSwgZmFsc2UpO1xuICB9XG5cbiAgY2FtZXJhLl9zZXRUcmFuc2Zvcm0odHJhbnNmb3JtKTtcbiAgcm90YXRlM0QoY29udHJvbGxlciwgc3RhcnRQb3NpdGlvbiwgbW92ZW1lbnQsIGNvbnN0cmFpbmVkQXhpcywgZmFsc2UsIHRydWUpO1xuXG4gIGlmIChkZWZpbmVkKGNhbWVyYS5jb25zdHJhaW5lZEF4aXMpKSB7XG4gICAgdmFyIHJpZ2h0ID0gQ2FydGVzaWFuMy5jcm9zcyhcbiAgICAgIGNhbWVyYS5kaXJlY3Rpb24sXG4gICAgICBjYW1lcmEuY29uc3RyYWluZWRBeGlzLFxuICAgICAgdGlsdDNEQ2FydGVzaWFuM1xuICAgICk7XG4gICAgaWYgKFxuICAgICAgIUNhcnRlc2lhbjMuZXF1YWxzRXBzaWxvbihyaWdodCwgQ2FydGVzaWFuMy5aRVJPLCBDZXNpdW1NYXRoLkVQU0lMT042KVxuICAgICkge1xuICAgICAgaWYgKENhcnRlc2lhbjMuZG90KHJpZ2h0LCBjYW1lcmEucmlnaHQpIDwgMC4wKSB7XG4gICAgICAgIENhcnRlc2lhbjMubmVnYXRlKHJpZ2h0LCByaWdodCk7XG4gICAgICB9XG5cbiAgICAgIENhcnRlc2lhbjMuY3Jvc3MocmlnaHQsIGNhbWVyYS5kaXJlY3Rpb24sIGNhbWVyYS51cCk7XG4gICAgICBDYXJ0ZXNpYW4zLmNyb3NzKGNhbWVyYS5kaXJlY3Rpb24sIGNhbWVyYS51cCwgY2FtZXJhLnJpZ2h0KTtcblxuICAgICAgQ2FydGVzaWFuMy5ub3JtYWxpemUoY2FtZXJhLnVwLCBjYW1lcmEudXApO1xuICAgICAgQ2FydGVzaWFuMy5ub3JtYWxpemUoY2FtZXJhLnJpZ2h0LCBjYW1lcmEucmlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIGNhbWVyYS5fc2V0VHJhbnNmb3JtKG9sZFRyYW5zZm9ybSk7XG4gIGNvbnRyb2xsZXIuX2dsb2JlID0gb2xkR2xvYmU7XG4gIGNvbnRyb2xsZXIuX2VsbGlwc29pZCA9IG9sZEVsbGlwc29pZDtcblxuICB2YXIgcmFkaXVzID0gb2xkRWxsaXBzb2lkLm1heGltdW1SYWRpdXM7XG4gIGNvbnRyb2xsZXIuX3JvdGF0ZUZhY3RvciA9IDEuMCAvIHJhZGl1cztcbiAgY29udHJvbGxlci5fcm90YXRlUmF0ZVJhbmdlQWRqdXN0bWVudCA9IHJhZGl1cztcblxuICB2YXIgb3JpZ2luYWxQb3NpdGlvbiA9IENhcnRlc2lhbjMuY2xvbmUoY2FtZXJhLnBvc2l0aW9uV0MsIHRpbHQzRENhcnRlc2lhbjMpO1xuXG4gIGlmIChjb250cm9sbGVyLmVuYWJsZUNvbGxpc2lvbkRldGVjdGlvbikge1xuICAgIGFkanVzdEhlaWdodEZvclRlcnJhaW4oY29udHJvbGxlcik7XG4gIH1cblxuICBpZiAoIUNhcnRlc2lhbjMuZXF1YWxzKGNhbWVyYS5wb3NpdGlvbldDLCBvcmlnaW5hbFBvc2l0aW9uKSkge1xuICAgIGNhbWVyYS5fc2V0VHJhbnNmb3JtKHZlcnRpY2FsVHJhbnNmb3JtKTtcbiAgICBjYW1lcmEud29ybGRUb0NhbWVyYUNvb3JkaW5hdGVzUG9pbnQob3JpZ2luYWxQb3NpdGlvbiwgb3JpZ2luYWxQb3NpdGlvbik7XG5cbiAgICB2YXIgbWFnU3FyZCA9IENhcnRlc2lhbjMubWFnbml0dWRlU3F1YXJlZChvcmlnaW5hbFBvc2l0aW9uKTtcbiAgICBpZiAoQ2FydGVzaWFuMy5tYWduaXR1ZGVTcXVhcmVkKGNhbWVyYS5wb3NpdGlvbikgPiBtYWdTcXJkKSB7XG4gICAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5wb3NpdGlvbik7XG4gICAgICBDYXJ0ZXNpYW4zLm11bHRpcGx5QnlTY2FsYXIoXG4gICAgICAgIGNhbWVyYS5wb3NpdGlvbixcbiAgICAgICAgTWF0aC5zcXJ0KG1hZ1NxcmQpLFxuICAgICAgICBjYW1lcmEucG9zaXRpb25cbiAgICAgICk7XG4gICAgfVxuXG4gICAgdmFyIGFuZ2xlID0gQ2FydGVzaWFuMy5hbmdsZUJldHdlZW4ob3JpZ2luYWxQb3NpdGlvbiwgY2FtZXJhLnBvc2l0aW9uKTtcbiAgICB2YXIgYXhpcyA9IENhcnRlc2lhbjMuY3Jvc3MoXG4gICAgICBvcmlnaW5hbFBvc2l0aW9uLFxuICAgICAgY2FtZXJhLnBvc2l0aW9uLFxuICAgICAgb3JpZ2luYWxQb3NpdGlvblxuICAgICk7XG4gICAgQ2FydGVzaWFuMy5ub3JtYWxpemUoYXhpcywgYXhpcyk7XG5cbiAgICB2YXIgcXVhdGVybmlvbiA9IFF1YXRlcm5pb24uZnJvbUF4aXNBbmdsZShheGlzLCBhbmdsZSwgdGlsdDNEUXVhdGVybmlvbik7XG4gICAgdmFyIHJvdGF0aW9uID0gTWF0cml4My5mcm9tUXVhdGVybmlvbihxdWF0ZXJuaW9uLCB0aWx0M0RNYXRyaXgpO1xuICAgIE1hdHJpeDMubXVsdGlwbHlCeVZlY3Rvcihyb3RhdGlvbiwgY2FtZXJhLmRpcmVjdGlvbiwgY2FtZXJhLmRpcmVjdGlvbik7XG4gICAgTWF0cml4My5tdWx0aXBseUJ5VmVjdG9yKHJvdGF0aW9uLCBjYW1lcmEudXAsIGNhbWVyYS51cCk7XG4gICAgQ2FydGVzaWFuMy5jcm9zcyhjYW1lcmEuZGlyZWN0aW9uLCBjYW1lcmEudXAsIGNhbWVyYS5yaWdodCk7XG4gICAgQ2FydGVzaWFuMy5jcm9zcyhjYW1lcmEucmlnaHQsIGNhbWVyYS5kaXJlY3Rpb24sIGNhbWVyYS51cCk7XG5cbiAgICBjYW1lcmEuX3NldFRyYW5zZm9ybShvbGRUcmFuc2Zvcm0pO1xuICB9XG59XG5cbnZhciBsb29rM0RTdGFydFBvcyA9IG5ldyBDYXJ0ZXNpYW4yKCk7XG52YXIgbG9vazNERW5kUG9zID0gbmV3IENhcnRlc2lhbjIoKTtcbnZhciBsb29rM0RTdGFydFJheSA9IG5ldyBSYXkoKTtcbnZhciBsb29rM0RFbmRSYXkgPSBuZXcgUmF5KCk7XG52YXIgbG9vazNETmVnYXRpdmVSb3QgPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIGxvb2szRFRhbiA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG5cbmZ1bmN0aW9uIGxvb2szRChjb250cm9sbGVyLCBzdGFydFBvc2l0aW9uLCBtb3ZlbWVudCwgcm90YXRpb25BeGlzKSB7XG4gIHZhciBzY2VuZSA9IGNvbnRyb2xsZXIuX3NjZW5lO1xuICB2YXIgY2FtZXJhID0gc2NlbmUuY2FtZXJhO1xuXG4gIHZhciBzdGFydFBvcyA9IGxvb2szRFN0YXJ0UG9zO1xuICBzdGFydFBvcy54ID0gbW92ZW1lbnQuc3RhcnRQb3NpdGlvbi54O1xuICBzdGFydFBvcy55ID0gMC4wO1xuICB2YXIgZW5kUG9zID0gbG9vazNERW5kUG9zO1xuICBlbmRQb3MueCA9IG1vdmVtZW50LmVuZFBvc2l0aW9uLng7XG4gIGVuZFBvcy55ID0gMC4wO1xuXG4gIHZhciBzdGFydFJheSA9IGNhbWVyYS5nZXRQaWNrUmF5KHN0YXJ0UG9zLCBsb29rM0RTdGFydFJheSk7XG4gIHZhciBlbmRSYXkgPSBjYW1lcmEuZ2V0UGlja1JheShlbmRQb3MsIGxvb2szREVuZFJheSk7XG4gIHZhciBhbmdsZSA9IDAuMDtcbiAgdmFyIHN0YXJ0O1xuICB2YXIgZW5kO1xuXG4gIGlmIChjYW1lcmEuZnJ1c3R1bSBpbnN0YW5jZW9mIE9ydGhvZ3JhcGhpY0ZydXN0dW0pIHtcbiAgICBzdGFydCA9IHN0YXJ0UmF5Lm9yaWdpbjtcbiAgICBlbmQgPSBlbmRSYXkub3JpZ2luO1xuXG4gICAgQ2FydGVzaWFuMy5hZGQoY2FtZXJhLmRpcmVjdGlvbiwgc3RhcnQsIHN0YXJ0KTtcbiAgICBDYXJ0ZXNpYW4zLmFkZChjYW1lcmEuZGlyZWN0aW9uLCBlbmQsIGVuZCk7XG5cbiAgICBDYXJ0ZXNpYW4zLnN1YnRyYWN0KHN0YXJ0LCBjYW1lcmEucG9zaXRpb24sIHN0YXJ0KTtcbiAgICBDYXJ0ZXNpYW4zLnN1YnRyYWN0KGVuZCwgY2FtZXJhLnBvc2l0aW9uLCBlbmQpO1xuXG4gICAgQ2FydGVzaWFuMy5ub3JtYWxpemUoc3RhcnQsIHN0YXJ0KTtcbiAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShlbmQsIGVuZCk7XG4gIH0gZWxzZSB7XG4gICAgc3RhcnQgPSBzdGFydFJheS5kaXJlY3Rpb247XG4gICAgZW5kID0gZW5kUmF5LmRpcmVjdGlvbjtcbiAgfVxuXG4gIHZhciBkb3QgPSBDYXJ0ZXNpYW4zLmRvdChzdGFydCwgZW5kKTtcbiAgaWYgKGRvdCA8IDEuMCkge1xuICAgIC8vIGRvdCBpcyBpbiBbMCwgMV1cbiAgICBhbmdsZSA9IE1hdGguYWNvcyhkb3QpO1xuICB9XG5cbiAgYW5nbGUgPSBtb3ZlbWVudC5zdGFydFBvc2l0aW9uLnggPiBtb3ZlbWVudC5lbmRQb3NpdGlvbi54ID8gLWFuZ2xlIDogYW5nbGU7XG5cbiAgdmFyIGhvcml6b250YWxSb3RhdGlvbkF4aXMgPSBjb250cm9sbGVyLl9ob3Jpem9udGFsUm90YXRpb25BeGlzO1xuICBpZiAoZGVmaW5lZChyb3RhdGlvbkF4aXMpKSB7XG4gICAgY2FtZXJhLmxvb2socm90YXRpb25BeGlzLCAtYW5nbGUpO1xuICB9IGVsc2UgaWYgKGRlZmluZWQoaG9yaXpvbnRhbFJvdGF0aW9uQXhpcykpIHtcbiAgICBjYW1lcmEubG9vayhob3Jpem9udGFsUm90YXRpb25BeGlzLCAtYW5nbGUpO1xuICB9IGVsc2Uge1xuICAgIGNhbWVyYS5sb29rTGVmdChhbmdsZSk7XG4gIH1cblxuICBzdGFydFBvcy54ID0gMC4wO1xuICBzdGFydFBvcy55ID0gbW92ZW1lbnQuc3RhcnRQb3NpdGlvbi55O1xuICBlbmRQb3MueCA9IDAuMDtcbiAgZW5kUG9zLnkgPSBtb3ZlbWVudC5lbmRQb3NpdGlvbi55O1xuXG4gIHN0YXJ0UmF5ID0gY2FtZXJhLmdldFBpY2tSYXkoc3RhcnRQb3MsIGxvb2szRFN0YXJ0UmF5KTtcbiAgZW5kUmF5ID0gY2FtZXJhLmdldFBpY2tSYXkoZW5kUG9zLCBsb29rM0RFbmRSYXkpO1xuICBhbmdsZSA9IDAuMDtcblxuICBpZiAoY2FtZXJhLmZydXN0dW0gaW5zdGFuY2VvZiBPcnRob2dyYXBoaWNGcnVzdHVtKSB7XG4gICAgc3RhcnQgPSBzdGFydFJheS5vcmlnaW47XG4gICAgZW5kID0gZW5kUmF5Lm9yaWdpbjtcblxuICAgIENhcnRlc2lhbjMuYWRkKGNhbWVyYS5kaXJlY3Rpb24sIHN0YXJ0LCBzdGFydCk7XG4gICAgQ2FydGVzaWFuMy5hZGQoY2FtZXJhLmRpcmVjdGlvbiwgZW5kLCBlbmQpO1xuXG4gICAgQ2FydGVzaWFuMy5zdWJ0cmFjdChzdGFydCwgY2FtZXJhLnBvc2l0aW9uLCBzdGFydCk7XG4gICAgQ2FydGVzaWFuMy5zdWJ0cmFjdChlbmQsIGNhbWVyYS5wb3NpdGlvbiwgZW5kKTtcblxuICAgIENhcnRlc2lhbjMubm9ybWFsaXplKHN0YXJ0LCBzdGFydCk7XG4gICAgQ2FydGVzaWFuMy5ub3JtYWxpemUoZW5kLCBlbmQpO1xuICB9IGVsc2Uge1xuICAgIHN0YXJ0ID0gc3RhcnRSYXkuZGlyZWN0aW9uO1xuICAgIGVuZCA9IGVuZFJheS5kaXJlY3Rpb247XG4gIH1cblxuICBkb3QgPSBDYXJ0ZXNpYW4zLmRvdChzdGFydCwgZW5kKTtcbiAgaWYgKGRvdCA8IDEuMCkge1xuICAgIC8vIGRvdCBpcyBpbiBbMCwgMV1cbiAgICBhbmdsZSA9IE1hdGguYWNvcyhkb3QpO1xuICB9XG4gIGFuZ2xlID0gbW92ZW1lbnQuc3RhcnRQb3NpdGlvbi55ID4gbW92ZW1lbnQuZW5kUG9zaXRpb24ueSA/IC1hbmdsZSA6IGFuZ2xlO1xuXG4gIHJvdGF0aW9uQXhpcyA9IGRlZmF1bHRWYWx1ZShyb3RhdGlvbkF4aXMsIGhvcml6b250YWxSb3RhdGlvbkF4aXMpO1xuICBpZiAoZGVmaW5lZChyb3RhdGlvbkF4aXMpKSB7XG4gICAgdmFyIGRpcmVjdGlvbiA9IGNhbWVyYS5kaXJlY3Rpb247XG4gICAgdmFyIG5lZ2F0aXZlUm90YXRpb25BeGlzID0gQ2FydGVzaWFuMy5uZWdhdGUoXG4gICAgICByb3RhdGlvbkF4aXMsXG4gICAgICBsb29rM0ROZWdhdGl2ZVJvdFxuICAgICk7XG4gICAgdmFyIG5vcnRoUGFyYWxsZWwgPSBDYXJ0ZXNpYW4zLmVxdWFsc0Vwc2lsb24oXG4gICAgICBkaXJlY3Rpb24sXG4gICAgICByb3RhdGlvbkF4aXMsXG4gICAgICBDZXNpdW1NYXRoLkVQU0lMT04yXG4gICAgKTtcbiAgICB2YXIgc291dGhQYXJhbGxlbCA9IENhcnRlc2lhbjMuZXF1YWxzRXBzaWxvbihcbiAgICAgIGRpcmVjdGlvbixcbiAgICAgIG5lZ2F0aXZlUm90YXRpb25BeGlzLFxuICAgICAgQ2VzaXVtTWF0aC5FUFNJTE9OMlxuICAgICk7XG4gICAgaWYgKCFub3J0aFBhcmFsbGVsICYmICFzb3V0aFBhcmFsbGVsKSB7XG4gICAgICBkb3QgPSBDYXJ0ZXNpYW4zLmRvdChkaXJlY3Rpb24sIHJvdGF0aW9uQXhpcyk7XG4gICAgICB2YXIgYW5nbGVUb0F4aXMgPSBDZXNpdW1NYXRoLmFjb3NDbGFtcGVkKGRvdCk7XG4gICAgICBpZiAoYW5nbGUgPiAwICYmIGFuZ2xlID4gYW5nbGVUb0F4aXMpIHtcbiAgICAgICAgYW5nbGUgPSBhbmdsZVRvQXhpcyAtIENlc2l1bU1hdGguRVBTSUxPTjQ7XG4gICAgICB9XG5cbiAgICAgIGRvdCA9IENhcnRlc2lhbjMuZG90KGRpcmVjdGlvbiwgbmVnYXRpdmVSb3RhdGlvbkF4aXMpO1xuICAgICAgYW5nbGVUb0F4aXMgPSBDZXNpdW1NYXRoLmFjb3NDbGFtcGVkKGRvdCk7XG4gICAgICBpZiAoYW5nbGUgPCAwICYmIC1hbmdsZSA+IGFuZ2xlVG9BeGlzKSB7XG4gICAgICAgIGFuZ2xlID0gLWFuZ2xlVG9BeGlzICsgQ2VzaXVtTWF0aC5FUFNJTE9ONDtcbiAgICAgIH1cblxuICAgICAgdmFyIHRhbmdlbnQgPSBDYXJ0ZXNpYW4zLmNyb3NzKHJvdGF0aW9uQXhpcywgZGlyZWN0aW9uLCBsb29rM0RUYW4pO1xuICAgICAgY2FtZXJhLmxvb2sodGFuZ2VudCwgYW5nbGUpO1xuICAgIH0gZWxzZSBpZiAoKG5vcnRoUGFyYWxsZWwgJiYgYW5nbGUgPCAwKSB8fCAoc291dGhQYXJhbGxlbCAmJiBhbmdsZSA+IDApKSB7XG4gICAgICBjYW1lcmEubG9vayhjYW1lcmEucmlnaHQsIC1hbmdsZSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGNhbWVyYS5sb29rVXAoYW5nbGUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZTNEKGNvbnRyb2xsZXIpIHtcbiAgcmVhY3RUb0lucHV0KFxuICAgIGNvbnRyb2xsZXIsXG4gICAgY29udHJvbGxlci5lbmFibGVSb3RhdGUsXG4gICAgY29udHJvbGxlci5yb3RhdGVFdmVudFR5cGVzLFxuICAgIHNwaW4zRCxcbiAgICBjb250cm9sbGVyLmluZXJ0aWFTcGluLFxuICAgIFwiX2xhc3RJbmVydGlhU3Bpbk1vdmVtZW50XCJcbiAgKTtcbiAgcmVhY3RUb0lucHV0KFxuICAgIGNvbnRyb2xsZXIsXG4gICAgY29udHJvbGxlci5lbmFibGVab29tLFxuICAgIGNvbnRyb2xsZXIuem9vbUV2ZW50VHlwZXMsXG4gICAgem9vbTNELFxuICAgIGNvbnRyb2xsZXIuaW5lcnRpYVpvb20sXG4gICAgXCJfbGFzdEluZXJ0aWFab29tTW92ZW1lbnRcIlxuICApO1xuICByZWFjdFRvSW5wdXQoXG4gICAgY29udHJvbGxlcixcbiAgICBjb250cm9sbGVyLmVuYWJsZVRpbHQsXG4gICAgY29udHJvbGxlci50aWx0RXZlbnRUeXBlcyxcbiAgICB0aWx0M0QsXG4gICAgY29udHJvbGxlci5pbmVydGlhU3BpbixcbiAgICBcIl9sYXN0SW5lcnRpYVRpbHRNb3ZlbWVudFwiXG4gICk7XG4gIHJlYWN0VG9JbnB1dChcbiAgICBjb250cm9sbGVyLFxuICAgIGNvbnRyb2xsZXIuZW5hYmxlTG9vayxcbiAgICBjb250cm9sbGVyLmxvb2tFdmVudFR5cGVzLFxuICAgIGxvb2szRFxuICApO1xufVxuXG52YXIgc2NyYXRjaEFkanVzdEhlaWdodFRyYW5zZm9ybSA9IG5ldyBNYXRyaXg0KCk7XG52YXIgc2NyYXRjaEFkanVzdEhlaWdodENhcnRvZ3JhcGhpYyA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcblxuZnVuY3Rpb24gYWRqdXN0SGVpZ2h0Rm9yVGVycmFpbihjb250cm9sbGVyKSB7XG4gIGNvbnRyb2xsZXIuX2FkanVzdGVkSGVpZ2h0Rm9yVGVycmFpbiA9IHRydWU7XG5cbiAgdmFyIHNjZW5lID0gY29udHJvbGxlci5fc2NlbmU7XG4gIHZhciBtb2RlID0gc2NlbmUubW9kZTtcbiAgdmFyIGdsb2JlID0gc2NlbmUuZ2xvYmU7XG5cbiAgaWYgKFxuICAgICFkZWZpbmVkKGdsb2JlKSB8fFxuICAgIG1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTJEIHx8XG4gICAgbW9kZSA9PT0gU2NlbmVNb2RlLk1PUlBISU5HXG4gICkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG4gIHZhciBlbGxpcHNvaWQgPSBnbG9iZS5lbGxpcHNvaWQ7XG4gIHZhciBwcm9qZWN0aW9uID0gc2NlbmUubWFwUHJvamVjdGlvbjtcblxuICB2YXIgdHJhbnNmb3JtO1xuICB2YXIgbWFnO1xuICBpZiAoIU1hdHJpeDQuZXF1YWxzKGNhbWVyYS50cmFuc2Zvcm0sIE1hdHJpeDQuSURFTlRJVFkpKSB7XG4gICAgdHJhbnNmb3JtID0gTWF0cml4NC5jbG9uZShjYW1lcmEudHJhbnNmb3JtLCBzY3JhdGNoQWRqdXN0SGVpZ2h0VHJhbnNmb3JtKTtcbiAgICBtYWcgPSBDYXJ0ZXNpYW4zLm1hZ25pdHVkZShjYW1lcmEucG9zaXRpb24pO1xuICAgIGNhbWVyYS5fc2V0VHJhbnNmb3JtKE1hdHJpeDQuSURFTlRJVFkpO1xuICB9XG5cbiAgdmFyIGNhcnRvZ3JhcGhpYyA9IHNjcmF0Y2hBZGp1c3RIZWlnaHRDYXJ0b2dyYXBoaWM7XG4gIGlmIChtb2RlID09PSBTY2VuZU1vZGUuU0NFTkUzRCkge1xuICAgIGVsbGlwc29pZC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhjYW1lcmEucG9zaXRpb24sIGNhcnRvZ3JhcGhpYyk7XG4gIH0gZWxzZSB7XG4gICAgcHJvamVjdGlvbi51bnByb2plY3QoY2FtZXJhLnBvc2l0aW9uLCBjYXJ0b2dyYXBoaWMpO1xuICB9XG5cbiAgdmFyIGhlaWdodFVwZGF0ZWQgPSBmYWxzZTtcbiAgaWYgKGNhcnRvZ3JhcGhpYy5oZWlnaHQgPCBjb250cm9sbGVyLl9taW5pbXVtQ29sbGlzaW9uVGVycmFpbkhlaWdodCkge1xuICAgIHZhciBnbG9iZUhlaWdodCA9IGNvbnRyb2xsZXIuX3NjZW5lLmdsb2JlSGVpZ2h0O1xuICAgIGlmIChkZWZpbmVkKGdsb2JlSGVpZ2h0KSkge1xuICAgICAgdmFyIGhlaWdodCA9IGdsb2JlSGVpZ2h0ICsgY29udHJvbGxlci5taW5pbXVtWm9vbURpc3RhbmNlO1xuICAgICAgaWYgKGNhcnRvZ3JhcGhpYy5oZWlnaHQgPCBoZWlnaHQpIHtcbiAgICAgICAgY2FydG9ncmFwaGljLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgaWYgKG1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTNEKSB7XG4gICAgICAgICAgZWxsaXBzb2lkLmNhcnRvZ3JhcGhpY1RvQ2FydGVzaWFuKGNhcnRvZ3JhcGhpYywgY2FtZXJhLnBvc2l0aW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwcm9qZWN0aW9uLnByb2plY3QoY2FydG9ncmFwaGljLCBjYW1lcmEucG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIGhlaWdodFVwZGF0ZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChkZWZpbmVkKHRyYW5zZm9ybSkpIHtcbiAgICBjYW1lcmEuX3NldFRyYW5zZm9ybSh0cmFuc2Zvcm0pO1xuICAgIGlmIChoZWlnaHRVcGRhdGVkKSB7XG4gICAgICBDYXJ0ZXNpYW4zLm5vcm1hbGl6ZShjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5wb3NpdGlvbik7XG4gICAgICBDYXJ0ZXNpYW4zLm5lZ2F0ZShjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5kaXJlY3Rpb24pO1xuICAgICAgQ2FydGVzaWFuMy5tdWx0aXBseUJ5U2NhbGFyKFxuICAgICAgICBjYW1lcmEucG9zaXRpb24sXG4gICAgICAgIE1hdGgubWF4KG1hZywgY29udHJvbGxlci5taW5pbXVtWm9vbURpc3RhbmNlKSxcbiAgICAgICAgY2FtZXJhLnBvc2l0aW9uXG4gICAgICApO1xuICAgICAgQ2FydGVzaWFuMy5ub3JtYWxpemUoY2FtZXJhLmRpcmVjdGlvbiwgY2FtZXJhLmRpcmVjdGlvbik7XG4gICAgICBDYXJ0ZXNpYW4zLmNyb3NzKGNhbWVyYS5kaXJlY3Rpb24sIGNhbWVyYS51cCwgY2FtZXJhLnJpZ2h0KTtcbiAgICAgIENhcnRlc2lhbjMuY3Jvc3MoY2FtZXJhLnJpZ2h0LCBjYW1lcmEuZGlyZWN0aW9uLCBjYW1lcmEudXApO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cblNjcmVlblNwYWNlQ2FtZXJhQ29udHJvbGxlci5wcm90b3R5cGUub25NYXAgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBzY2VuZSA9IHRoaXMuX3NjZW5lO1xuICB2YXIgbW9kZSA9IHNjZW5lLm1vZGU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG5cbiAgaWYgKG1vZGUgPT09IFNjZW5lTW9kZS5DT0xVTUJVU19WSUVXKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIE1hdGguYWJzKGNhbWVyYS5wb3NpdGlvbi54KSAtIHRoaXMuX21heENvb3JkLnggPCAwICYmXG4gICAgICBNYXRoLmFicyhjYW1lcmEucG9zaXRpb24ueSkgLSB0aGlzLl9tYXhDb29yZC55IDwgMFxuICAgICk7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnZhciBzY3JhdGNoUHJldmlvdXNQb3NpdGlvbiA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaFByZXZpb3VzRGlyZWN0aW9uID0gbmV3IENhcnRlc2lhbjMoKTtcblxuLyoqXG4gKiBAcHJpdmF0ZVxuICovXG5TY3JlZW5TcGFjZUNhbWVyYUNvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNjZW5lID0gdGhpcy5fc2NlbmU7XG4gIHZhciBjYW1lcmEgPSBzY2VuZS5jYW1lcmE7XG4gIHZhciBnbG9iZSA9IHNjZW5lLmdsb2JlO1xuICB2YXIgbW9kZSA9IHNjZW5lLm1vZGU7XG5cbiAgaWYgKCFNYXRyaXg0LmVxdWFscyhjYW1lcmEudHJhbnNmb3JtLCBNYXRyaXg0LklERU5USVRZKSkge1xuICAgIHRoaXMuX2dsb2JlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuX2VsbGlwc29pZCA9IEVsbGlwc29pZC5VTklUX1NQSEVSRTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLl9nbG9iZSA9IGdsb2JlO1xuICAgIHRoaXMuX2VsbGlwc29pZCA9IGRlZmluZWQodGhpcy5fZ2xvYmUpXG4gICAgICA/IHRoaXMuX2dsb2JlLmVsbGlwc29pZFxuICAgICAgOiBzY2VuZS5tYXBQcm9qZWN0aW9uLmVsbGlwc29pZDtcbiAgfVxuXG4gIHZhciBleGFnZ2VyYXRpb24gPSBkZWZpbmVkKHRoaXMuX2dsb2JlKVxuICAgID8gdGhpcy5fZ2xvYmUudGVycmFpbkV4YWdnZXJhdGlvblxuICAgIDogMS4wO1xuICB2YXIgZXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHQgPSBkZWZpbmVkKHRoaXMuX2dsb2JlKVxuICAgID8gdGhpcy5fZ2xvYmUudGVycmFpbkV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0XG4gICAgOiAwLjA7XG4gIHRoaXMuX21pbmltdW1Db2xsaXNpb25UZXJyYWluSGVpZ2h0ID0gVGVycmFpbkV4YWdnZXJhdGlvbi5nZXRIZWlnaHQoXG4gICAgdGhpcy5taW5pbXVtQ29sbGlzaW9uVGVycmFpbkhlaWdodCxcbiAgICBleGFnZ2VyYXRpb24sXG4gICAgZXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHRcbiAgKTtcbiAgdGhpcy5fbWluaW11bVBpY2tpbmdUZXJyYWluSGVpZ2h0ID0gVGVycmFpbkV4YWdnZXJhdGlvbi5nZXRIZWlnaHQoXG4gICAgdGhpcy5taW5pbXVtUGlja2luZ1RlcnJhaW5IZWlnaHQsXG4gICAgZXhhZ2dlcmF0aW9uLFxuICAgIGV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0XG4gICk7XG4gIHRoaXMuX21pbmltdW1UcmFja0JhbGxIZWlnaHQgPSBUZXJyYWluRXhhZ2dlcmF0aW9uLmdldEhlaWdodChcbiAgICB0aGlzLm1pbmltdW1UcmFja0JhbGxIZWlnaHQsXG4gICAgZXhhZ2dlcmF0aW9uLFxuICAgIGV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0XG4gICk7XG5cbiAgdGhpcy5fY2FtZXJhVW5kZXJncm91bmQgPSBzY2VuZS5jYW1lcmFVbmRlcmdyb3VuZCAmJiBkZWZpbmVkKHRoaXMuX2dsb2JlKTtcblxuICB2YXIgcmFkaXVzID0gdGhpcy5fZWxsaXBzb2lkLm1heGltdW1SYWRpdXM7XG4gIHRoaXMuX3JvdGF0ZUZhY3RvciA9IDEuMCAvIHJhZGl1cztcbiAgdGhpcy5fcm90YXRlUmF0ZVJhbmdlQWRqdXN0bWVudCA9IHJhZGl1cztcblxuICB0aGlzLl9hZGp1c3RlZEhlaWdodEZvclRlcnJhaW4gPSBmYWxzZTtcbiAgdmFyIHByZXZpb3VzUG9zaXRpb24gPSBDYXJ0ZXNpYW4zLmNsb25lKFxuICAgIGNhbWVyYS5wb3NpdGlvbldDLFxuICAgIHNjcmF0Y2hQcmV2aW91c1Bvc2l0aW9uXG4gICk7XG4gIHZhciBwcmV2aW91c0RpcmVjdGlvbiA9IENhcnRlc2lhbjMuY2xvbmUoXG4gICAgY2FtZXJhLmRpcmVjdGlvbldDLFxuICAgIHNjcmF0Y2hQcmV2aW91c0RpcmVjdGlvblxuICApO1xuXG4gIGlmIChtb2RlID09PSBTY2VuZU1vZGUuU0NFTkUyRCkge1xuICAgIHVwZGF0ZTJEKHRoaXMpO1xuICB9IGVsc2UgaWYgKG1vZGUgPT09IFNjZW5lTW9kZS5DT0xVTUJVU19WSUVXKSB7XG4gICAgdGhpcy5faG9yaXpvbnRhbFJvdGF0aW9uQXhpcyA9IENhcnRlc2lhbjMuVU5JVF9aO1xuICAgIHVwZGF0ZUNWKHRoaXMpO1xuICB9IGVsc2UgaWYgKG1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTNEKSB7XG4gICAgdGhpcy5faG9yaXpvbnRhbFJvdGF0aW9uQXhpcyA9IHVuZGVmaW5lZDtcbiAgICB1cGRhdGUzRCh0aGlzKTtcbiAgfVxuXG4gIGlmICh0aGlzLmVuYWJsZUNvbGxpc2lvbkRldGVjdGlvbiAmJiAhdGhpcy5fYWRqdXN0ZWRIZWlnaHRGb3JUZXJyYWluKSB7XG4gICAgLy8gQWRqdXN0IHRoZSBjYW1lcmEgaGVpZ2h0IGlmIHRoZSBjYW1lcmEgbW92ZWQgYXQgYWxsICh1c2VyIGlucHV0IG9yIGluZXJ0aWEpIGFuZCBhbiBhY3Rpb24gZGlkbid0IGFscmVhZHkgYWRqdXN0IHRoZSBjYW1lcmEgaGVpZ2h0XG4gICAgdmFyIGNhbWVyYUNoYW5nZWQgPVxuICAgICAgIUNhcnRlc2lhbjMuZXF1YWxzKHByZXZpb3VzUG9zaXRpb24sIGNhbWVyYS5wb3NpdGlvbldDKSB8fFxuICAgICAgIUNhcnRlc2lhbjMuZXF1YWxzKHByZXZpb3VzRGlyZWN0aW9uLCBjYW1lcmEuZGlyZWN0aW9uV0MpO1xuICAgIGlmIChjYW1lcmFDaGFuZ2VkKSB7XG4gICAgICBhZGp1c3RIZWlnaHRGb3JUZXJyYWluKHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIHRoaXMuX2FnZ3JlZ2F0b3IucmVzZXQoKTtcbn07XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQ7IG90aGVyd2lzZSwgZmFsc2UuXG4gKiA8YnIgLz48YnIgLz5cbiAqIElmIHRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQsIGl0IHNob3VsZCBub3QgYmUgdXNlZDsgY2FsbGluZyBhbnkgZnVuY3Rpb24gb3RoZXIgdGhhblxuICogPGNvZGU+aXNEZXN0cm95ZWQ8L2NvZGU+IHdpbGwgcmVzdWx0IGluIGEge0BsaW5rIERldmVsb3BlckVycm9yfSBleGNlcHRpb24uXG4gKlxuICogQHJldHVybnMge0Jvb2xlYW59IDxjb2RlPnRydWU8L2NvZGU+IGlmIHRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQ7IG90aGVyd2lzZSwgPGNvZGU+ZmFsc2U8L2NvZGU+LlxuICpcbiAqIEBzZWUgU2NyZWVuU3BhY2VDYW1lcmFDb250cm9sbGVyI2Rlc3Ryb3lcbiAqL1xuU2NyZWVuU3BhY2VDYW1lcmFDb250cm9sbGVyLnByb3RvdHlwZS5pc0Rlc3Ryb3llZCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyoqXG4gKiBSZW1vdmVzIG1vdXNlIGxpc3RlbmVycyBoZWxkIGJ5IHRoaXMgb2JqZWN0LlxuICogPGJyIC8+PGJyIC8+XG4gKiBPbmNlIGFuIG9iamVjdCBpcyBkZXN0cm95ZWQsIGl0IHNob3VsZCBub3QgYmUgdXNlZDsgY2FsbGluZyBhbnkgZnVuY3Rpb24gb3RoZXIgdGhhblxuICogPGNvZGU+aXNEZXN0cm95ZWQ8L2NvZGU+IHdpbGwgcmVzdWx0IGluIGEge0BsaW5rIERldmVsb3BlckVycm9yfSBleGNlcHRpb24uICBUaGVyZWZvcmUsXG4gKiBhc3NpZ24gdGhlIHJldHVybiB2YWx1ZSAoPGNvZGU+dW5kZWZpbmVkPC9jb2RlPikgdG8gdGhlIG9iamVjdCBhcyBkb25lIGluIHRoZSBleGFtcGxlLlxuICpcbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBUaGlzIG9iamVjdCB3YXMgZGVzdHJveWVkLCBpLmUuLCBkZXN0cm95KCkgd2FzIGNhbGxlZC5cbiAqXG4gKlxuICogQGV4YW1wbGVcbiAqIGNvbnRyb2xsZXIgPSBjb250cm9sbGVyICYmIGNvbnRyb2xsZXIuZGVzdHJveSgpO1xuICpcbiAqIEBzZWUgU2NyZWVuU3BhY2VDYW1lcmFDb250cm9sbGVyI2lzRGVzdHJveWVkXG4gKi9cblNjcmVlblNwYWNlQ2FtZXJhQ29udHJvbGxlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5fdHdlZW5zLnJlbW92ZUFsbCgpO1xuICB0aGlzLl9hZ2dyZWdhdG9yID0gdGhpcy5fYWdncmVnYXRvciAmJiB0aGlzLl9hZ2dyZWdhdG9yLmRlc3Ryb3koKTtcbiAgcmV0dXJuIGRlc3Ryb3lPYmplY3QodGhpcyk7XG59O1xuZXhwb3J0IGRlZmF1bHQgU2NyZWVuU3BhY2VDYW1lcmFDb250cm9sbGVyO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///60442\n')}}]);