"use strict";(self["webpackChunkvue3_webpack5"]=self["webpackChunkvue3_webpack5"]||[]).push([[8850],{87717:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(48243);\n/* harmony import */ var _Core_buildModuleUrl_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(72000);\n/* harmony import */ var _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(60216);\n/* harmony import */ var _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(51688);\n/* harmony import */ var _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(59947);\n/* harmony import */ var _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(62200);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(82982);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(86511);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(12572);\n/* harmony import */ var _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(50491);\n/* harmony import */ var _Core_EllipsoidTerrainProvider_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(81176);\n/* harmony import */ var _Core_Event_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(14459);\n/* harmony import */ var _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(67627);\n/* harmony import */ var _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(15720);\n/* harmony import */ var _Core_Ray_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(68457);\n/* harmony import */ var _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(96190);\n/* harmony import */ var _Core_Resource_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(68985);\n/* harmony import */ var _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(53642);\n/* harmony import */ var _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(8743);\n/* harmony import */ var _Shaders_GlobeFS_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(20909);\n/* harmony import */ var _Shaders_GlobeVS_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(15314);\n/* harmony import */ var _Shaders_GroundAtmosphere_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(62868);\n/* harmony import */ var _ThirdParty_when_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(13222);\n/* harmony import */ var _GlobeSurfaceShaderSet_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(55188);\n/* harmony import */ var _GlobeSurfaceTileProvider_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(32110);\n/* harmony import */ var _GlobeTranslucency_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(90538);\n/* harmony import */ var _ImageryLayerCollection_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(59848);\n/* harmony import */ var _QuadtreePrimitive_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(9733);\n/* harmony import */ var _SceneMode_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(89917);\n/* harmony import */ var _ShadowMode_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(34125);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * The globe rendered in the scene, including its terrain ({@link Globe#terrainProvider})\n * and imagery layers ({@link Globe#imageryLayers}).  Access the globe using {@link Scene#globe}.\n *\n * @alias Globe\n * @constructor\n *\n * @param {Ellipsoid} [ellipsoid=Ellipsoid.WGS84] Determines the size and shape of the\n * globe.\n */\nfunction Globe(ellipsoid) {\n  ellipsoid = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(ellipsoid, _Core_Ellipsoid_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].WGS84 */ .Z.WGS84);\n  var terrainProvider = new _Core_EllipsoidTerrainProvider_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z({\n    ellipsoid: ellipsoid,\n  });\n  var imageryLayerCollection = new _ImageryLayerCollection_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */ .Z();\n\n  this._ellipsoid = ellipsoid;\n  this._imageryLayerCollection = imageryLayerCollection;\n\n  this._surfaceShaderSet = new _GlobeSurfaceShaderSet_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z();\n  this._material = undefined;\n\n  this._surface = new _QuadtreePrimitive_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"] */ .Z({\n    tileProvider: new _GlobeSurfaceTileProvider_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"] */ .Z({\n      terrainProvider: terrainProvider,\n      imageryLayers: imageryLayerCollection,\n      surfaceShaderSet: this._surfaceShaderSet,\n    }),\n  });\n\n  this._terrainProvider = terrainProvider;\n  this._terrainProviderChanged = new _Core_Event_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z();\n\n  this._undergroundColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].clone */ .Z.clone(_Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].BLACK */ .Z.BLACK);\n  this._undergroundColorAlphaByDistance = new _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z(\n    ellipsoid.maximumRadius / 1000.0,\n    0.0,\n    ellipsoid.maximumRadius / 5.0,\n    1.0\n  );\n\n  this._translucency = new _GlobeTranslucency_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"] */ .Z();\n\n  makeShadersDirty(this);\n\n  /**\n   * Determines if the globe will be shown.\n   *\n   * @type {Boolean}\n   * @default true\n   */\n  this.show = true;\n\n  this._oceanNormalMapResourceDirty = true;\n  this._oceanNormalMapResource = new _Core_Resource_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z({\n    url: (0,_Core_buildModuleUrl_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z)("Assets/Textures/waterNormalsSmall.jpg"),\n  });\n\n  /**\n   * The maximum screen-space error used to drive level-of-detail refinement.  Higher\n   * values will provide better performance but lower visual quality.\n   *\n   * @type {Number}\n   * @default 2\n   */\n  this.maximumScreenSpaceError = 2;\n\n  /**\n   * The size of the terrain tile cache, expressed as a number of tiles.  Any additional\n   * tiles beyond this number will be freed, as long as they aren\'t needed for rendering\n   * this frame.  A larger number will consume more memory but will show detail faster\n   * when, for example, zooming out and then back in.\n   *\n   * @type {Number}\n   * @default 100\n   */\n  this.tileCacheSize = 100;\n\n  /**\n   * Gets or sets the number of loading descendant tiles that is considered "too many".\n   * If a tile has too many loading descendants, that tile will be loaded and rendered before any of\n   * its descendants are loaded and rendered. This means more feedback for the user that something\n   * is happening at the cost of a longer overall load time. Setting this to 0 will cause each\n   * tile level to be loaded successively, significantly increasing load time. Setting it to a large\n   * number (e.g. 1000) will minimize the number of tiles that are loaded but tend to make\n   * detail appear all at once after a long wait.\n   * @type {Number}\n   * @default 20\n   */\n  this.loadingDescendantLimit = 20;\n\n  /**\n   * Gets or sets a value indicating whether the ancestors of rendered tiles should be preloaded.\n   * Setting this to true optimizes the zoom-out experience and provides more detail in\n   * newly-exposed areas when panning. The down side is that it requires loading more tiles.\n   * @type {Boolean}\n   * @default true\n   */\n  this.preloadAncestors = true;\n\n  /**\n   * Gets or sets a value indicating whether the siblings of rendered tiles should be preloaded.\n   * Setting this to true causes tiles with the same parent as a rendered tile to be loaded, even\n   * if they are culled. Setting this to true may provide a better panning experience at the\n   * cost of loading more tiles.\n   * @type {Boolean}\n   * @default false\n   */\n  this.preloadSiblings = false;\n\n  /**\n   * The color to use to highlight terrain fill tiles. If undefined, fill tiles are not\n   * highlighted at all. The alpha value is used to alpha blend with the tile\'s\n   * actual color. Because terrain fill tiles do not represent the actual terrain surface,\n   * it may be useful in some applications to indicate visually that they are not to be trusted.\n   * @type {Color}\n   * @default undefined\n   */\n  this.fillHighlightColor = undefined;\n\n  /**\n   * Enable lighting the globe with the scene\'s light source.\n   *\n   * @type {Boolean}\n   * @default false\n   */\n  this.enableLighting = false;\n\n  /**\n   * Enable dynamic lighting effects on atmosphere and fog. This only takes effect\n   * when <code>enableLighting</code> is <code>true</code>.\n   *\n   * @type {Boolean}\n   * @default true\n   */\n  this.dynamicAtmosphereLighting = true;\n\n  /**\n   * Whether dynamic atmosphere lighting uses the sun direction instead of the scene\'s\n   * light direction. This only takes effect when <code>enableLighting</code> and\n   * <code>dynamicAtmosphereLighting</code> are <code>true</code>.\n   *\n   * @type {Boolean}\n   * @default false\n   */\n  this.dynamicAtmosphereLightingFromSun = false;\n\n  /**\n   * Enable the ground atmosphere, which is drawn over the globe when viewed from a distance between <code>lightingFadeInDistance</code> and <code>lightingFadeOutDistance</code>.\n   *\n   * @demo {@link https://sandcastle.cesium.com/index.html?src=Ground%20Atmosphere.html|Ground atmosphere demo in Sandcastle}\n   *\n   * @type {Boolean}\n   * @default true\n   */\n  this.showGroundAtmosphere = true;\n\n  /**\n   * The distance where everything becomes lit. This only takes effect\n   * when <code>enableLighting</code> or <code>showGroundAtmosphere</code> is <code>true</code>.\n   *\n   * @type {Number}\n   * @default 10000000.0\n   */\n  this.lightingFadeOutDistance = 1.0e7;\n\n  /**\n   * The distance where lighting resumes. This only takes effect\n   * when <code>enableLighting</code> or <code>showGroundAtmosphere</code> is <code>true</code>.\n   *\n   * @type {Number}\n   * @default 20000000.0\n   */\n  this.lightingFadeInDistance = 2.0e7;\n\n  /**\n   * The distance where the darkness of night from the ground atmosphere fades out to a lit ground atmosphere.\n   * This only takes effect when <code>showGroundAtmosphere</code>, <code>enableLighting</code>, and\n   * <code>dynamicAtmosphereLighting</code> are <code>true</code>.\n   *\n   * @type {Number}\n   * @default 10000000.0\n   */\n  this.nightFadeOutDistance = 1.0e7;\n\n  /**\n   * The distance where the darkness of night from the ground atmosphere fades in to an unlit ground atmosphere.\n   * This only takes effect when <code>showGroundAtmosphere</code>, <code>enableLighting</code>, and\n   * <code>dynamicAtmosphereLighting</code> are <code>true</code>.\n   *\n   * @type {Number}\n   * @default 50000000.0\n   */\n  this.nightFadeInDistance = 5.0e7;\n\n  /**\n   * True if an animated wave effect should be shown in areas of the globe\n   * covered by water; otherwise, false.  This property is ignored if the\n   * <code>terrainProvider</code> does not provide a water mask.\n   *\n   * @type {Boolean}\n   * @default true\n   */\n  this.showWaterEffect = true;\n\n  /**\n   * True if primitives such as billboards, polylines, labels, etc. should be depth-tested\n   * against the terrain surface, or false if such primitives should always be drawn on top\n   * of terrain unless they\'re on the opposite side of the globe.  The disadvantage of depth\n   * testing primitives against terrain is that slight numerical noise or terrain level-of-detail\n   * switched can sometimes make a primitive that should be on the surface disappear underneath it.\n   *\n   * @type {Boolean}\n   * @default false\n   *\n   */\n  this.depthTestAgainstTerrain = false;\n\n  /**\n   * Determines whether the globe casts or receives shadows from light sources. Setting the globe\n   * to cast shadows may impact performance since the terrain is rendered again from the light\'s perspective.\n   * Currently only terrain that is in view casts shadows. By default the globe does not cast shadows.\n   *\n   * @type {ShadowMode}\n   * @default ShadowMode.RECEIVE_ONLY\n   */\n  this.shadows = _ShadowMode_js__WEBPACK_IMPORTED_MODULE_25__/* ["default"].RECEIVE_ONLY */ .Z.RECEIVE_ONLY;\n\n  /**\n   * The hue shift to apply to the atmosphere. Defaults to 0.0 (no shift).\n   * A hue shift of 1.0 indicates a complete rotation of the hues available.\n   * @type {Number}\n   * @default 0.0\n   */\n  this.atmosphereHueShift = 0.0;\n\n  /**\n   * The saturation shift to apply to the atmosphere. Defaults to 0.0 (no shift).\n   * A saturation shift of -1.0 is monochrome.\n   * @type {Number}\n   * @default 0.0\n   */\n  this.atmosphereSaturationShift = 0.0;\n\n  /**\n   * The brightness shift to apply to the atmosphere. Defaults to 0.0 (no shift).\n   * A brightness shift of -1.0 is complete darkness, which will let space show through.\n   * @type {Number}\n   * @default 0.0\n   */\n  this.atmosphereBrightnessShift = 0.0;\n\n  /**\n   * A scalar used to exaggerate the terrain. Defaults to <code>1.0</code> (no exaggeration).\n   * A value of <code>2.0</code> scales the terrain by 2x.\n   * A value of <code>0.0</code> makes the terrain completely flat.\n   * Note that terrain exaggeration will not modify any other primitive as they are positioned relative to the ellipsoid.\n   * @type {Number}\n   * @default 1.0\n   */\n  this.terrainExaggeration = 1.0;\n\n  /**\n   * The height from which terrain is exaggerated. Defaults to <code>0.0</code> (scaled relative to ellipsoid surface).\n   * Terrain that is above this height will scale upwards and terrain that is below this height will scale downwards.\n   * Note that terrain exaggeration will not modify any other primitive as they are positioned relative to the ellipsoid.\n   * If {@link Globe#terrainExaggeration} is <code>1.0</code> this value will have no effect.\n   * @type {Number}\n   * @default 0.0\n   */\n  this.terrainExaggerationRelativeHeight = 0.0;\n\n  /**\n   * Whether to show terrain skirts. Terrain skirts are geometry extending downwards from a tile\'s edges used to hide seams between neighboring tiles.\n   * Skirts are always hidden when the camera is underground or translucency is enabled.\n   *\n   * @type {Boolean}\n   * @default true\n   */\n  this.showSkirts = true;\n\n  /**\n   * Whether to cull back-facing terrain. Back faces are not culled when the camera is underground or translucency is enabled.\n   *\n   * @type {Boolean}\n   * @default true\n   */\n  this.backFaceCulling = true;\n\n  this._oceanNormalMap = undefined;\n  this._zoomedOutOceanSpecularIntensity = undefined;\n}\n\nObject.defineProperties(Globe.prototype, {\n  /**\n   * Gets an ellipsoid describing the shape of this globe.\n   * @memberof Globe.prototype\n   * @type {Ellipsoid}\n   */\n  ellipsoid: {\n    get: function () {\n      return this._ellipsoid;\n    },\n  },\n  /**\n   * Gets the collection of image layers that will be rendered on this globe.\n   * @memberof Globe.prototype\n   * @type {ImageryLayerCollection}\n   */\n  imageryLayers: {\n    get: function () {\n      return this._imageryLayerCollection;\n    },\n  },\n  /**\n   * Gets an event that\'s raised when an imagery layer is added, shown, hidden, moved, or removed.\n   *\n   * @memberof Globe.prototype\n   * @type {Event}\n   * @readonly\n   */\n  imageryLayersUpdatedEvent: {\n    get: function () {\n      return this._surface.tileProvider.imageryLayersUpdatedEvent;\n    },\n  },\n  /**\n   * Returns <code>true</code> when the tile load queue is empty, <code>false</code> otherwise.  When the load queue is empty,\n   * all terrain and imagery for the current view have been loaded.\n   * @memberof Globe.prototype\n   * @type {Boolean}\n   * @readonly\n   */\n  tilesLoaded: {\n    get: function () {\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(this._surface)) {\n        return true;\n      }\n      return (\n        this._surface.tileProvider.ready &&\n        this._surface._tileLoadQueueHigh.length === 0 &&\n        this._surface._tileLoadQueueMedium.length === 0 &&\n        this._surface._tileLoadQueueLow.length === 0\n      );\n    },\n  },\n  /**\n   * Gets or sets the color of the globe when no imagery is available.\n   * @memberof Globe.prototype\n   * @type {Color}\n   */\n  baseColor: {\n    get: function () {\n      return this._surface.tileProvider.baseColor;\n    },\n    set: function (value) {\n      this._surface.tileProvider.baseColor = value;\n    },\n  },\n  /**\n   * A property specifying a {@link ClippingPlaneCollection} used to selectively disable rendering on the outside of each plane.\n   *\n   * @memberof Globe.prototype\n   * @type {ClippingPlaneCollection}\n   */\n  clippingPlanes: {\n    get: function () {\n      return this._surface.tileProvider.clippingPlanes;\n    },\n    set: function (value) {\n      this._surface.tileProvider.clippingPlanes = value;\n    },\n  },\n  /**\n   * A property specifying a {@link Rectangle} used to limit globe rendering to a cartographic area.\n   * Defaults to the maximum extent of cartographic coordinates.\n   *\n   * @memberof Globe.prototype\n   * @type {Rectangle}\n   * @default {@link Rectangle.MAX_VALUE}\n   */\n  cartographicLimitRectangle: {\n    get: function () {\n      return this._surface.tileProvider.cartographicLimitRectangle;\n    },\n    set: function (value) {\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(value)) {\n        value = _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].clone */ .Z.clone(_Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].MAX_VALUE */ .Z.MAX_VALUE);\n      }\n      this._surface.tileProvider.cartographicLimitRectangle = value;\n    },\n  },\n  /**\n   * The normal map to use for rendering waves in the ocean.  Setting this property will\n   * only have an effect if the configured terrain provider includes a water mask.\n   * @memberof Globe.prototype\n   * @type {String}\n   * @default buildModuleUrl(\'Assets/Textures/waterNormalsSmall.jpg\')\n   */\n  oceanNormalMapUrl: {\n    get: function () {\n      return this._oceanNormalMapResource.url;\n    },\n    set: function (value) {\n      this._oceanNormalMapResource.url = value;\n      this._oceanNormalMapResourceDirty = true;\n    },\n  },\n  /**\n   * The terrain provider providing surface geometry for this globe.\n   * @type {TerrainProvider}\n   *\n   * @memberof Globe.prototype\n   * @type {TerrainProvider}\n   *\n   */\n  terrainProvider: {\n    get: function () {\n      return this._terrainProvider;\n    },\n    set: function (value) {\n      if (value !== this._terrainProvider) {\n        this._terrainProvider = value;\n        this._terrainProviderChanged.raiseEvent(value);\n        if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(this._material)) {\n          makeShadersDirty(this);\n        }\n      }\n    },\n  },\n  /**\n   * Gets an event that\'s raised when the terrain provider is changed\n   *\n   * @memberof Globe.prototype\n   * @type {Event}\n   * @readonly\n   */\n  terrainProviderChanged: {\n    get: function () {\n      return this._terrainProviderChanged;\n    },\n  },\n  /**\n   * Gets an event that\'s raised when the length of the tile load queue has changed since the last render frame.  When the load queue is empty,\n   * all terrain and imagery for the current view have been loaded.  The event passes the new length of the tile load queue.\n   *\n   * @memberof Globe.prototype\n   * @type {Event}\n   */\n  tileLoadProgressEvent: {\n    get: function () {\n      return this._surface.tileLoadProgressEvent;\n    },\n  },\n\n  /**\n   * Gets or sets the material appearance of the Globe.  This can be one of several built-in {@link Material} objects or a custom material, scripted with\n   * {@link https://github.com/CesiumGS/cesium/wiki/Fabric|Fabric}.\n   * @memberof Globe.prototype\n   * @type {Material}\n   */\n  material: {\n    get: function () {\n      return this._material;\n    },\n    set: function (material) {\n      if (this._material !== material) {\n        this._material = material;\n        makeShadersDirty(this);\n      }\n    },\n  },\n\n  /**\n   * The color to render the back side of the globe when the camera is underground or the globe is translucent,\n   * blended with the globe color based on the camera\'s distance.\n   * <br /><br />\n   * To disable underground coloring, set <code>undergroundColor</code> to <code>undefined</code>.\n   *\n   * @memberof Globe.prototype\n   * @type {Color}\n   * @default {@link Color.BLACK}\n   *\n   * @see Globe#undergroundColorAlphaByDistance\n   */\n  undergroundColor: {\n    get: function () {\n      return this._undergroundColor;\n    },\n    set: function (value) {\n      this._undergroundColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].clone */ .Z.clone(value, this._undergroundColor);\n    },\n  },\n\n  /**\n   * Gets or sets the near and far distance for blending {@link Globe#undergroundColor} with the globe color.\n   * The alpha will interpolate between the {@link NearFarScalar#nearValue} and\n   * {@link NearFarScalar#farValue} while the camera distance falls within the lower and upper bounds\n   * of the specified {@link NearFarScalar#near} and {@link NearFarScalar#far}.\n   * Outside of these ranges the alpha remains clamped to the nearest bound. If undefined,\n   * the underground color will not be blended with the globe color.\n   * <br /> <br />\n   * When the camera is above the ellipsoid the distance is computed from the nearest\n   * point on the ellipsoid instead of the camera\'s position.\n   *\n   * @memberof Globe.prototype\n   * @type {NearFarScalar}\n   *\n   * @see Globe#undergroundColor\n   *\n   */\n  undergroundColorAlphaByDistance: {\n    get: function () {\n      return this._undergroundColorAlphaByDistance;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(value) && value.far < value.near) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z(\n          "far distance must be greater than near distance."\n        );\n      }\n      //>>includeEnd(\'debug\');\n      this._undergroundColorAlphaByDistance = _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].clone */ .Z.clone(\n        value,\n        this._undergroundColorAlphaByDistance\n      );\n    },\n  },\n\n  /**\n   * Properties for controlling globe translucency.\n   *\n   * @memberof Globe.prototype\n   * @type {GlobeTranslucency}\n   */\n  translucency: {\n    get: function () {\n      return this._translucency;\n    },\n  },\n});\n\nfunction makeShadersDirty(globe) {\n  var defines = [];\n\n  var requireNormals =\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(globe._material) &&\n    (globe._material.shaderSource.match(/slope/) ||\n      globe._material.shaderSource.match("normalEC"));\n\n  var fragmentSources = [_Shaders_GroundAtmosphere_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z];\n  if (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(globe._material) &&\n    (!requireNormals || globe._terrainProvider.requestVertexNormals)\n  ) {\n    fragmentSources.push(globe._material.shaderSource);\n    defines.push("APPLY_MATERIAL");\n    globe._surface._tileProvider.materialUniformMap = globe._material._uniforms;\n  } else {\n    globe._surface._tileProvider.materialUniformMap = undefined;\n  }\n  fragmentSources.push(_Shaders_GlobeFS_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"] */ .Z);\n\n  globe._surfaceShaderSet.baseVertexShaderSource = new _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"] */ .Z({\n    sources: [_Shaders_GroundAtmosphere_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z, _Shaders_GlobeVS_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"] */ .Z],\n    defines: defines,\n  });\n\n  globe._surfaceShaderSet.baseFragmentShaderSource = new _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"] */ .Z({\n    sources: fragmentSources,\n    defines: defines,\n  });\n  globe._surfaceShaderSet.material = globe._material;\n}\n\nfunction createComparePickTileFunction(rayOrigin) {\n  return function (a, b) {\n    var aDist = _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].distanceSquaredTo */ .Z.distanceSquaredTo(\n      a.pickBoundingSphere,\n      rayOrigin\n    );\n    var bDist = _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].distanceSquaredTo */ .Z.distanceSquaredTo(\n      b.pickBoundingSphere,\n      rayOrigin\n    );\n\n    return aDist - bDist;\n  };\n}\n\nvar scratchArray = [];\nvar scratchSphereIntersectionResult = {\n  start: 0.0,\n  stop: 0.0,\n};\n\n/**\n * Find an intersection between a ray and the globe surface that was rendered. The ray must be given in world coordinates.\n *\n * @param {Ray} ray The ray to test for intersection.\n * @param {Scene} scene The scene.\n * @param {Boolean} [cullBackFaces=true] Set to true to not pick back faces.\n * @param {Cartesian3} [result] The object onto which to store the result.\n * @returns {Cartesian3|undefined} The intersection or <code>undefined</code> if none was found.  The returned position is in projected coordinates for 2D and Columbus View.\n *\n * @private\n */\nGlobe.prototype.pickWorldCoordinates = function (\n  ray,\n  scene,\n  cullBackFaces,\n  result\n) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(ray)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z("ray is required");\n  }\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(scene)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z("scene is required");\n  }\n  //>>includeEnd(\'debug\');\n\n  cullBackFaces = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(cullBackFaces, true);\n\n  var mode = scene.mode;\n  var projection = scene.mapProjection;\n\n  var sphereIntersections = scratchArray;\n  sphereIntersections.length = 0;\n\n  var tilesToRender = this._surface._tilesToRender;\n  var length = tilesToRender.length;\n\n  var tile;\n  var i;\n\n  for (i = 0; i < length; ++i) {\n    tile = tilesToRender[i];\n    var surfaceTile = tile.data;\n\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(surfaceTile)) {\n      continue;\n    }\n\n    var boundingVolume = surfaceTile.pickBoundingSphere;\n    if (mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n      surfaceTile.pickBoundingSphere = boundingVolume = _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].fromRectangleWithHeights2D */ .Z.fromRectangleWithHeights2D(\n        tile.rectangle,\n        projection,\n        surfaceTile.tileBoundingRegion.minimumHeight,\n        surfaceTile.tileBoundingRegion.maximumHeight,\n        boundingVolume\n      );\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].fromElements */ .Z.fromElements(\n        boundingVolume.center.z,\n        boundingVolume.center.x,\n        boundingVolume.center.y,\n        boundingVolume.center\n      );\n    } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(surfaceTile.renderedMesh)) {\n      _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(\n        surfaceTile.tileBoundingRegion.boundingSphere,\n        boundingVolume\n      );\n    } else {\n      // So wait how did we render this thing then? It shouldn\'t be possible to get here.\n      continue;\n    }\n\n    var boundingSphereIntersection = _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].raySphere */ .Z.raySphere(\n      ray,\n      boundingVolume,\n      scratchSphereIntersectionResult\n    );\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(boundingSphereIntersection)) {\n      sphereIntersections.push(surfaceTile);\n    }\n  }\n\n  sphereIntersections.sort(createComparePickTileFunction(ray.origin));\n\n  var intersection;\n  length = sphereIntersections.length;\n  for (i = 0; i < length; ++i) {\n    intersection = sphereIntersections[i].pick(\n      ray,\n      scene.mode,\n      scene.mapProjection,\n      cullBackFaces,\n      result\n    );\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(intersection)) {\n      break;\n    }\n  }\n\n  return intersection;\n};\n\nvar cartoScratch = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\n/**\n * Find an intersection between a ray and the globe surface that was rendered. The ray must be given in world coordinates.\n *\n * @param {Ray} ray The ray to test for intersection.\n * @param {Scene} scene The scene.\n * @param {Cartesian3} [result] The object onto which to store the result.\n * @returns {Cartesian3|undefined} The intersection or <code>undefined</code> if none was found.\n *\n * @example\n * // find intersection of ray through a pixel and the globe\n * var ray = viewer.camera.getPickRay(windowCoordinates);\n * var intersection = globe.pick(ray, scene);\n */\nGlobe.prototype.pick = function (ray, scene, result) {\n  result = this.pickWorldCoordinates(ray, scene, true, result);\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(result) && scene.mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    result = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].fromElements */ .Z.fromElements(result.y, result.z, result.x, result);\n    var carto = scene.mapProjection.unproject(result, cartoScratch);\n    result = scene.globe.ellipsoid.cartographicToCartesian(carto, result);\n  }\n\n  return result;\n};\n\nvar scratchGetHeightCartesian = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z();\nvar scratchGetHeightIntersection = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z();\nvar scratchGetHeightCartographic = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar scratchGetHeightRay = new _Core_Ray_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\n\nfunction tileIfContainsCartographic(tile, cartographic) {\n  return (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(tile) && _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].contains */ .Z.contains(tile.rectangle, cartographic)\n    ? tile\n    : undefined;\n}\n\n/**\n * Get the height of the surface at a given cartographic.\n *\n * @param {Cartographic} cartographic The cartographic for which to find the height.\n * @returns {Number|undefined} The height of the cartographic or undefined if it could not be found.\n */\nGlobe.prototype.getHeight = function (cartographic) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(cartographic)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z("cartographic is required");\n  }\n  //>>includeEnd(\'debug\');\n\n  var levelZeroTiles = this._surface._levelZeroTiles;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(levelZeroTiles)) {\n    return;\n  }\n\n  var tile;\n  var i;\n\n  var length = levelZeroTiles.length;\n  for (i = 0; i < length; ++i) {\n    tile = levelZeroTiles[i];\n    if (_Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].contains */ .Z.contains(tile.rectangle, cartographic)) {\n      break;\n    }\n  }\n\n  if (i >= length) {\n    return undefined;\n  }\n\n  var tileWithMesh = tile;\n\n  while ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(tile)) {\n    tile =\n      tileIfContainsCartographic(tile._southwestChild, cartographic) ||\n      tileIfContainsCartographic(tile._southeastChild, cartographic) ||\n      tileIfContainsCartographic(tile._northwestChild, cartographic) ||\n      tile._northeastChild;\n\n    if (\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(tile) &&\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(tile.data) &&\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(tile.data.renderedMesh)\n    ) {\n      tileWithMesh = tile;\n    }\n  }\n\n  tile = tileWithMesh;\n\n  // This tile was either rendered or culled.\n  // It is sometimes useful to get a height from a culled tile,\n  // e.g. when we\'re getting a height in order to place a billboard\n  // on terrain, and the camera is looking at that same billboard.\n  // The culled tile must have a valid mesh, though.\n  if (\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(tile) ||\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(tile.data) ||\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(tile.data.renderedMesh)\n  ) {\n    // Tile was not rendered (culled).\n    return undefined;\n  }\n\n  var projection = this._surface._tileProvider.tilingScheme.projection;\n  var ellipsoid = this._surface._tileProvider.tilingScheme.ellipsoid;\n\n  //cartesian has to be on the ellipsoid surface for `ellipsoid.geodeticSurfaceNormal`\n  var cartesian = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].fromRadians */ .Z.fromRadians(\n    cartographic.longitude,\n    cartographic.latitude,\n    0.0,\n    ellipsoid,\n    scratchGetHeightCartesian\n  );\n\n  var ray = scratchGetHeightRay;\n  var surfaceNormal = ellipsoid.geodeticSurfaceNormal(cartesian, ray.direction);\n\n  // Try to find the intersection point between the surface normal and z-axis.\n  // minimum height (-11500.0) for the terrain set, need to get this information from the terrain provider\n  var rayOrigin = ellipsoid.getSurfaceNormalIntersectionWithZAxis(\n    cartesian,\n    11500.0,\n    ray.origin\n  );\n\n  // Theoretically, not with Earth datums, the intersection point can be outside the ellipsoid\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(rayOrigin)) {\n    // intersection point is outside the ellipsoid, try other value\n    // minimum height (-11500.0) for the terrain set, need to get this information from the terrain provider\n    var minimumHeight;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(tile.data.tileBoundingRegion)) {\n      minimumHeight = tile.data.tileBoundingRegion.minimumHeight;\n    }\n    var magnitude = Math.min((0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(minimumHeight, 0.0), -11500.0);\n\n    // multiply by the *positive* value of the magnitude\n    var vectorToMinimumPoint = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].multiplyByScalar */ .Z.multiplyByScalar(\n      surfaceNormal,\n      Math.abs(magnitude) + 1,\n      scratchGetHeightIntersection\n    );\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].subtract */ .Z.subtract(cartesian, vectorToMinimumPoint, ray.origin);\n  }\n\n  var intersection = tile.data.pick(\n    ray,\n    undefined,\n    projection,\n    false,\n    scratchGetHeightIntersection\n  );\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(intersection)) {\n    return undefined;\n  }\n\n  return ellipsoid.cartesianToCartographic(\n    intersection,\n    scratchGetHeightCartographic\n  ).height;\n};\n\n/**\n * @private\n */\nGlobe.prototype.update = function (frameState) {\n  if (!this.show) {\n    return;\n  }\n\n  if (frameState.passes.render) {\n    this._surface.update(frameState);\n  }\n};\n\n/**\n * @private\n */\nGlobe.prototype.beginFrame = function (frameState) {\n  var surface = this._surface;\n  var tileProvider = surface.tileProvider;\n  var terrainProvider = this.terrainProvider;\n  var hasWaterMask =\n    this.showWaterEffect &&\n    terrainProvider.ready &&\n    terrainProvider.hasWaterMask;\n\n  if (hasWaterMask && this._oceanNormalMapResourceDirty) {\n    // url changed, load new normal map asynchronously\n    this._oceanNormalMapResourceDirty = false;\n    var oceanNormalMapResource = this._oceanNormalMapResource;\n    var oceanNormalMapUrl = oceanNormalMapResource.url;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(oceanNormalMapUrl)) {\n      var that = this;\n      (0,_ThirdParty_when_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"] */ .Z)(oceanNormalMapResource.fetchImage(), function (image) {\n        if (oceanNormalMapUrl !== that._oceanNormalMapResource.url) {\n          // url changed while we were loading\n          return;\n        }\n\n        that._oceanNormalMap =\n          that._oceanNormalMap && that._oceanNormalMap.destroy();\n        that._oceanNormalMap = new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z({\n          context: frameState.context,\n          source: image,\n        });\n      });\n    } else {\n      this._oceanNormalMap =\n        this._oceanNormalMap && this._oceanNormalMap.destroy();\n    }\n  }\n\n  var pass = frameState.passes;\n  var mode = frameState.mode;\n\n  if (pass.render) {\n    if (this.showGroundAtmosphere) {\n      this._zoomedOutOceanSpecularIntensity = 0.4;\n    } else {\n      this._zoomedOutOceanSpecularIntensity = 0.5;\n    }\n\n    surface.maximumScreenSpaceError = this.maximumScreenSpaceError;\n    surface.tileCacheSize = this.tileCacheSize;\n    surface.loadingDescendantLimit = this.loadingDescendantLimit;\n    surface.preloadAncestors = this.preloadAncestors;\n    surface.preloadSiblings = this.preloadSiblings;\n\n    tileProvider.terrainProvider = this.terrainProvider;\n    tileProvider.lightingFadeOutDistance = this.lightingFadeOutDistance;\n    tileProvider.lightingFadeInDistance = this.lightingFadeInDistance;\n    tileProvider.nightFadeOutDistance = this.nightFadeOutDistance;\n    tileProvider.nightFadeInDistance = this.nightFadeInDistance;\n    tileProvider.zoomedOutOceanSpecularIntensity =\n      mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].SCENE3D */ .Z.SCENE3D ? this._zoomedOutOceanSpecularIntensity : 0.0;\n    tileProvider.hasWaterMask = hasWaterMask;\n    tileProvider.oceanNormalMap = this._oceanNormalMap;\n    tileProvider.enableLighting = this.enableLighting;\n    tileProvider.dynamicAtmosphereLighting = this.dynamicAtmosphereLighting;\n    tileProvider.dynamicAtmosphereLightingFromSun = this.dynamicAtmosphereLightingFromSun;\n    tileProvider.showGroundAtmosphere = this.showGroundAtmosphere;\n    tileProvider.shadows = this.shadows;\n    tileProvider.hueShift = this.atmosphereHueShift;\n    tileProvider.saturationShift = this.atmosphereSaturationShift;\n    tileProvider.brightnessShift = this.atmosphereBrightnessShift;\n    tileProvider.fillHighlightColor = this.fillHighlightColor;\n    tileProvider.showSkirts = this.showSkirts;\n    tileProvider.backFaceCulling = this.backFaceCulling;\n    tileProvider.undergroundColor = this._undergroundColor;\n    tileProvider.undergroundColorAlphaByDistance = this._undergroundColorAlphaByDistance;\n    surface.beginFrame(frameState);\n  }\n};\n\n/**\n * @private\n */\nGlobe.prototype.render = function (frameState) {\n  if (!this.show) {\n    return;\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"] */ .Z)(this._material)) {\n    this._material.update(frameState.context);\n  }\n\n  this._surface.render(frameState);\n};\n\n/**\n * @private\n */\nGlobe.prototype.endFrame = function (frameState) {\n  if (!this.show) {\n    return;\n  }\n\n  if (frameState.passes.render) {\n    this._surface.endFrame(frameState);\n  }\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <br /><br />\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n *\n * @returns {Boolean} True if this object was destroyed; otherwise, false.\n *\n * @see Globe#destroy\n */\nGlobe.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n * <br /><br />\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * globe = globe && globe.destroy();\n *\n * @see Globe#isDestroyed\n */\nGlobe.prototype.destroy = function () {\n  this._surfaceShaderSet =\n    this._surfaceShaderSet && this._surfaceShaderSet.destroy();\n  this._surface = this._surface && this._surface.destroy();\n  this._oceanNormalMap = this._oceanNormalMap && this._oceanNormalMap.destroy();\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z)(this);\n};\n/* harmony default export */ __webpack_exports__["Z"] = (Globe);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODc3MTcuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXVEO0FBQ0E7QUFDUjtBQUNJO0FBQ2Q7QUFDYztBQUNWO0FBQ1k7QUFDRTtBQUNWO0FBQzhCO0FBQ3RDO0FBQ3dCO0FBQ1I7QUFDcEI7QUFDWTtBQUNGO0FBQ1k7QUFDVjtBQUNEO0FBQ0E7QUFDa0I7QUFDckI7QUFDc0I7QUFDTTtBQUNkO0FBQ1U7QUFDVjtBQUNoQjtBQUNFOztBQUV6QztBQUNBLDREQUE0RCw0QkFBNEI7QUFDeEYsd0JBQXdCLDBCQUEwQiw0QkFBNEIsa0JBQWtCO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxXQUFXO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLGNBQWMsMEVBQVksWUFBWSwrRUFBZTtBQUNyRCw0QkFBNEIsa0ZBQXdCO0FBQ3BEO0FBQ0EsR0FBRztBQUNILG1DQUFtQyw0RUFBc0I7O0FBRXpEO0FBQ0E7O0FBRUEsK0JBQStCLDJFQUFxQjtBQUNwRDs7QUFFQSxzQkFBc0IsdUVBQWlCO0FBQ3ZDLHNCQUFzQiw4RUFBd0I7QUFDOUM7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7O0FBRUg7QUFDQSxxQ0FBcUMsZ0VBQUs7O0FBRTFDLDJCQUEyQiwyRUFBVyxDQUFDLDJFQUFXO0FBQ2xELDhDQUE4Qyx3RUFBYTtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDJCQUEyQix1RUFBaUI7O0FBRTVDOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxxQ0FBcUMsbUVBQVE7QUFDN0MsU0FBUyw0RUFBYztBQUN2QixHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQSxpQkFBaUIsMEZBQXVCOztBQUV4QztBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtB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Q0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSwrRUFBaUI7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU0sc0VBQU87QUFDYjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw4Q0FBOEM7QUFDOUM7QUFDQSx3REFBd0Q7QUFDeEQsOENBQThDLHNCQUFzQjtBQUNwRTtBQUNBLGFBQWEsU0FBUyxtQ0FBbUM7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVEO0FBQ3ZELDhDQUE4QyxzQkFBc0I7QUFDcEU7QUFDQTtBQUNBLGVBQWUsZ0JBQWdCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMsMkVBQWE7QUFDdEI7QUFDQSx5REFBZSxLQUFLLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92dWUzLXdlYnBhY2s1Ly4vbm9kZV9tb2R1bGVzL2Nlc2l1bS9Tb3VyY2UvU2NlbmUvR2xvYmUuanM/NDhiNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQm91bmRpbmdTcGhlcmUgZnJvbSBcIi4uL0NvcmUvQm91bmRpbmdTcGhlcmUuanNcIjtcbmltcG9ydCBidWlsZE1vZHVsZVVybCBmcm9tIFwiLi4vQ29yZS9idWlsZE1vZHVsZVVybC5qc1wiO1xuaW1wb3J0IENhcnRlc2lhbjMgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuMy5qc1wiO1xuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwiLi4vQ29yZS9DYXJ0b2dyYXBoaWMuanNcIjtcbmltcG9ydCBDb2xvciBmcm9tIFwiLi4vQ29yZS9Db2xvci5qc1wiO1xuaW1wb3J0IGRlZmF1bHRWYWx1ZSBmcm9tIFwiLi4vQ29yZS9kZWZhdWx0VmFsdWUuanNcIjtcbmltcG9ydCBkZWZpbmVkIGZyb20gXCIuLi9Db3JlL2RlZmluZWQuanNcIjtcbmltcG9ydCBkZXN0cm95T2JqZWN0IGZyb20gXCIuLi9Db3JlL2Rlc3Ryb3lPYmplY3QuanNcIjtcbmltcG9ydCBEZXZlbG9wZXJFcnJvciBmcm9tIFwiLi4vQ29yZS9EZXZlbG9wZXJFcnJvci5qc1wiO1xuaW1wb3J0IEVsbGlwc29pZCBmcm9tIFwiLi4vQ29yZS9FbGxpcHNvaWQuanNcIjtcbmltcG9ydCBFbGxpcHNvaWRUZXJyYWluUHJvdmlkZXIgZnJvbSBcIi4uL0NvcmUvRWxsaXBzb2lkVGVycmFpblByb3ZpZGVyLmpzXCI7XG5pbXBvcnQgRXZlbnQgZnJvbSBcIi4uL0NvcmUvRXZlbnQuanNcIjtcbmltcG9ydCBJbnRlcnNlY3Rpb25UZXN0cyBmcm9tIFwiLi4vQ29yZS9JbnRlcnNlY3Rpb25UZXN0cy5qc1wiO1xuaW1wb3J0IE5lYXJGYXJTY2FsYXIgZnJvbSBcIi4uL0NvcmUvTmVhckZhclNjYWxhci5qc1wiO1xuaW1wb3J0IFJheSBmcm9tIFwiLi4vQ29yZS9SYXkuanNcIjtcbmltcG9ydCBSZWN0YW5nbGUgZnJvbSBcIi4uL0NvcmUvUmVjdGFuZ2xlLmpzXCI7XG5pbXBvcnQgUmVzb3VyY2UgZnJvbSBcIi4uL0NvcmUvUmVzb3VyY2UuanNcIjtcbmltcG9ydCBTaGFkZXJTb3VyY2UgZnJvbSBcIi4uL1JlbmRlcmVyL1NoYWRlclNvdXJjZS5qc1wiO1xuaW1wb3J0IFRleHR1cmUgZnJvbSBcIi4uL1JlbmRlcmVyL1RleHR1cmUuanNcIjtcbmltcG9ydCBHbG9iZUZTIGZyb20gXCIuLi9TaGFkZXJzL0dsb2JlRlMuanNcIjtcbmltcG9ydCBHbG9iZVZTIGZyb20gXCIuLi9TaGFkZXJzL0dsb2JlVlMuanNcIjtcbmltcG9ydCBHcm91bmRBdG1vc3BoZXJlIGZyb20gXCIuLi9TaGFkZXJzL0dyb3VuZEF0bW9zcGhlcmUuanNcIjtcbmltcG9ydCB3aGVuIGZyb20gXCIuLi9UaGlyZFBhcnR5L3doZW4uanNcIjtcbmltcG9ydCBHbG9iZVN1cmZhY2VTaGFkZXJTZXQgZnJvbSBcIi4vR2xvYmVTdXJmYWNlU2hhZGVyU2V0LmpzXCI7XG5pbXBvcnQgR2xvYmVTdXJmYWNlVGlsZVByb3ZpZGVyIGZyb20gXCIuL0dsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5qc1wiO1xuaW1wb3J0IEdsb2JlVHJhbnNsdWNlbmN5IGZyb20gXCIuL0dsb2JlVHJhbnNsdWNlbmN5LmpzXCI7XG5pbXBvcnQgSW1hZ2VyeUxheWVyQ29sbGVjdGlvbiBmcm9tIFwiLi9JbWFnZXJ5TGF5ZXJDb2xsZWN0aW9uLmpzXCI7XG5pbXBvcnQgUXVhZHRyZWVQcmltaXRpdmUgZnJvbSBcIi4vUXVhZHRyZWVQcmltaXRpdmUuanNcIjtcbmltcG9ydCBTY2VuZU1vZGUgZnJvbSBcIi4vU2NlbmVNb2RlLmpzXCI7XG5pbXBvcnQgU2hhZG93TW9kZSBmcm9tIFwiLi9TaGFkb3dNb2RlLmpzXCI7XG5cbi8qKlxuICogVGhlIGdsb2JlIHJlbmRlcmVkIGluIHRoZSBzY2VuZSwgaW5jbHVkaW5nIGl0cyB0ZXJyYWluICh7QGxpbmsgR2xvYmUjdGVycmFpblByb3ZpZGVyfSlcbiAqIGFuZCBpbWFnZXJ5IGxheWVycyAoe0BsaW5rIEdsb2JlI2ltYWdlcnlMYXllcnN9KS4gIEFjY2VzcyB0aGUgZ2xvYmUgdXNpbmcge0BsaW5rIFNjZW5lI2dsb2JlfS5cbiAqXG4gKiBAYWxpYXMgR2xvYmVcbiAqIEBjb25zdHJ1Y3RvclxuICpcbiAqIEBwYXJhbSB7RWxsaXBzb2lkfSBbZWxsaXBzb2lkPUVsbGlwc29pZC5XR1M4NF0gRGV0ZXJtaW5lcyB0aGUgc2l6ZSBhbmQgc2hhcGUgb2YgdGhlXG4gKiBnbG9iZS5cbiAqL1xuZnVuY3Rpb24gR2xvYmUoZWxsaXBzb2lkKSB7XG4gIGVsbGlwc29pZCA9IGRlZmF1bHRWYWx1ZShlbGxpcHNvaWQsIEVsbGlwc29pZC5XR1M4NCk7XG4gIHZhciB0ZXJyYWluUHJvdmlkZXIgPSBuZXcgRWxsaXBzb2lkVGVycmFpblByb3ZpZGVyKHtcbiAgICBlbGxpcHNvaWQ6IGVsbGlwc29pZCxcbiAgfSk7XG4gIHZhciBpbWFnZXJ5TGF5ZXJDb2xsZWN0aW9uID0gbmV3IEltYWdlcnlMYXllckNvbGxlY3Rpb24oKTtcblxuICB0aGlzLl9lbGxpcHNvaWQgPSBlbGxpcHNvaWQ7XG4gIHRoaXMuX2ltYWdlcnlMYXllckNvbGxlY3Rpb24gPSBpbWFnZXJ5TGF5ZXJDb2xsZWN0aW9uO1xuXG4gIHRoaXMuX3N1cmZhY2VTaGFkZXJTZXQgPSBuZXcgR2xvYmVTdXJmYWNlU2hhZGVyU2V0KCk7XG4gIHRoaXMuX21hdGVyaWFsID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMuX3N1cmZhY2UgPSBuZXcgUXVhZHRyZWVQcmltaXRpdmUoe1xuICAgIHRpbGVQcm92aWRlcjogbmV3IEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlcih7XG4gICAgICB0ZXJyYWluUHJvdmlkZXI6IHRlcnJhaW5Qcm92aWRlcixcbiAgICAgIGltYWdlcnlMYXllcnM6IGltYWdlcnlMYXllckNvbGxlY3Rpb24sXG4gICAgICBzdXJmYWNlU2hhZGVyU2V0OiB0aGlzLl9zdXJmYWNlU2hhZGVyU2V0LFxuICAgIH0pLFxuICB9KTtcblxuICB0aGlzLl90ZXJyYWluUHJvdmlkZXIgPSB0ZXJyYWluUHJvdmlkZXI7XG4gIHRoaXMuX3RlcnJhaW5Qcm92aWRlckNoYW5nZWQgPSBuZXcgRXZlbnQoKTtcblxuICB0aGlzLl91bmRlcmdyb3VuZENvbG9yID0gQ29sb3IuY2xvbmUoQ29sb3IuQkxBQ0spO1xuICB0aGlzLl91bmRlcmdyb3VuZENvbG9yQWxwaGFCeURpc3RhbmNlID0gbmV3IE5lYXJGYXJTY2FsYXIoXG4gICAgZWxsaXBzb2lkLm1heGltdW1SYWRpdXMgLyAxMDAwLjAsXG4gICAgMC4wLFxuICAgIGVsbGlwc29pZC5tYXhpbXVtUmFkaXVzIC8gNS4wLFxuICAgIDEuMFxuICApO1xuXG4gIHRoaXMuX3RyYW5zbHVjZW5jeSA9IG5ldyBHbG9iZVRyYW5zbHVjZW5jeSgpO1xuXG4gIG1ha2VTaGFkZXJzRGlydHkodGhpcyk7XG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgaWYgdGhlIGdsb2JlIHdpbGwgYmUgc2hvd24uXG4gICAqXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICB0aGlzLnNob3cgPSB0cnVlO1xuXG4gIHRoaXMuX29jZWFuTm9ybWFsTWFwUmVzb3VyY2VEaXJ0eSA9IHRydWU7XG4gIHRoaXMuX29jZWFuTm9ybWFsTWFwUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2Uoe1xuICAgIHVybDogYnVpbGRNb2R1bGVVcmwoXCJBc3NldHMvVGV4dHVyZXMvd2F0ZXJOb3JtYWxzU21hbGwuanBnXCIpLFxuICB9KTtcblxuICAvKipcbiAgICogVGhlIG1heGltdW0gc2NyZWVuLXNwYWNlIGVycm9yIHVzZWQgdG8gZHJpdmUgbGV2ZWwtb2YtZGV0YWlsIHJlZmluZW1lbnQuICBIaWdoZXJcbiAgICogdmFsdWVzIHdpbGwgcHJvdmlkZSBiZXR0ZXIgcGVyZm9ybWFuY2UgYnV0IGxvd2VyIHZpc3VhbCBxdWFsaXR5LlxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAyXG4gICAqL1xuICB0aGlzLm1heGltdW1TY3JlZW5TcGFjZUVycm9yID0gMjtcblxuICAvKipcbiAgICogVGhlIHNpemUgb2YgdGhlIHRlcnJhaW4gdGlsZSBjYWNoZSwgZXhwcmVzc2VkIGFzIGEgbnVtYmVyIG9mIHRpbGVzLiAgQW55IGFkZGl0aW9uYWxcbiAgICogdGlsZXMgYmV5b25kIHRoaXMgbnVtYmVyIHdpbGwgYmUgZnJlZWQsIGFzIGxvbmcgYXMgdGhleSBhcmVuJ3QgbmVlZGVkIGZvciByZW5kZXJpbmdcbiAgICogdGhpcyBmcmFtZS4gIEEgbGFyZ2VyIG51bWJlciB3aWxsIGNvbnN1bWUgbW9yZSBtZW1vcnkgYnV0IHdpbGwgc2hvdyBkZXRhaWwgZmFzdGVyXG4gICAqIHdoZW4sIGZvciBleGFtcGxlLCB6b29taW5nIG91dCBhbmQgdGhlbiBiYWNrIGluLlxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAxMDBcbiAgICovXG4gIHRoaXMudGlsZUNhY2hlU2l6ZSA9IDEwMDtcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBudW1iZXIgb2YgbG9hZGluZyBkZXNjZW5kYW50IHRpbGVzIHRoYXQgaXMgY29uc2lkZXJlZCBcInRvbyBtYW55XCIuXG4gICAqIElmIGEgdGlsZSBoYXMgdG9vIG1hbnkgbG9hZGluZyBkZXNjZW5kYW50cywgdGhhdCB0aWxlIHdpbGwgYmUgbG9hZGVkIGFuZCByZW5kZXJlZCBiZWZvcmUgYW55IG9mXG4gICAqIGl0cyBkZXNjZW5kYW50cyBhcmUgbG9hZGVkIGFuZCByZW5kZXJlZC4gVGhpcyBtZWFucyBtb3JlIGZlZWRiYWNrIGZvciB0aGUgdXNlciB0aGF0IHNvbWV0aGluZ1xuICAgKiBpcyBoYXBwZW5pbmcgYXQgdGhlIGNvc3Qgb2YgYSBsb25nZXIgb3ZlcmFsbCBsb2FkIHRpbWUuIFNldHRpbmcgdGhpcyB0byAwIHdpbGwgY2F1c2UgZWFjaFxuICAgKiB0aWxlIGxldmVsIHRvIGJlIGxvYWRlZCBzdWNjZXNzaXZlbHksIHNpZ25pZmljYW50bHkgaW5jcmVhc2luZyBsb2FkIHRpbWUuIFNldHRpbmcgaXQgdG8gYSBsYXJnZVxuICAgKiBudW1iZXIgKGUuZy4gMTAwMCkgd2lsbCBtaW5pbWl6ZSB0aGUgbnVtYmVyIG9mIHRpbGVzIHRoYXQgYXJlIGxvYWRlZCBidXQgdGVuZCB0byBtYWtlXG4gICAqIGRldGFpbCBhcHBlYXIgYWxsIGF0IG9uY2UgYWZ0ZXIgYSBsb25nIHdhaXQuXG4gICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAqIEBkZWZhdWx0IDIwXG4gICAqL1xuICB0aGlzLmxvYWRpbmdEZXNjZW5kYW50TGltaXQgPSAyMDtcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIGEgdmFsdWUgaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBhbmNlc3RvcnMgb2YgcmVuZGVyZWQgdGlsZXMgc2hvdWxkIGJlIHByZWxvYWRlZC5cbiAgICogU2V0dGluZyB0aGlzIHRvIHRydWUgb3B0aW1pemVzIHRoZSB6b29tLW91dCBleHBlcmllbmNlIGFuZCBwcm92aWRlcyBtb3JlIGRldGFpbCBpblxuICAgKiBuZXdseS1leHBvc2VkIGFyZWFzIHdoZW4gcGFubmluZy4gVGhlIGRvd24gc2lkZSBpcyB0aGF0IGl0IHJlcXVpcmVzIGxvYWRpbmcgbW9yZSB0aWxlcy5cbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHRoaXMucHJlbG9hZEFuY2VzdG9ycyA9IHRydWU7XG5cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyBhIHZhbHVlIGluZGljYXRpbmcgd2hldGhlciB0aGUgc2libGluZ3Mgb2YgcmVuZGVyZWQgdGlsZXMgc2hvdWxkIGJlIHByZWxvYWRlZC5cbiAgICogU2V0dGluZyB0aGlzIHRvIHRydWUgY2F1c2VzIHRpbGVzIHdpdGggdGhlIHNhbWUgcGFyZW50IGFzIGEgcmVuZGVyZWQgdGlsZSB0byBiZSBsb2FkZWQsIGV2ZW5cbiAgICogaWYgdGhleSBhcmUgY3VsbGVkLiBTZXR0aW5nIHRoaXMgdG8gdHJ1ZSBtYXkgcHJvdmlkZSBhIGJldHRlciBwYW5uaW5nIGV4cGVyaWVuY2UgYXQgdGhlXG4gICAqIGNvc3Qgb2YgbG9hZGluZyBtb3JlIHRpbGVzLlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHRoaXMucHJlbG9hZFNpYmxpbmdzID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFRoZSBjb2xvciB0byB1c2UgdG8gaGlnaGxpZ2h0IHRlcnJhaW4gZmlsbCB0aWxlcy4gSWYgdW5kZWZpbmVkLCBmaWxsIHRpbGVzIGFyZSBub3RcbiAgICogaGlnaGxpZ2h0ZWQgYXQgYWxsLiBUaGUgYWxwaGEgdmFsdWUgaXMgdXNlZCB0byBhbHBoYSBibGVuZCB3aXRoIHRoZSB0aWxlJ3NcbiAgICogYWN0dWFsIGNvbG9yLiBCZWNhdXNlIHRlcnJhaW4gZmlsbCB0aWxlcyBkbyBub3QgcmVwcmVzZW50IHRoZSBhY3R1YWwgdGVycmFpbiBzdXJmYWNlLFxuICAgKiBpdCBtYXkgYmUgdXNlZnVsIGluIHNvbWUgYXBwbGljYXRpb25zIHRvIGluZGljYXRlIHZpc3VhbGx5IHRoYXQgdGhleSBhcmUgbm90IHRvIGJlIHRydXN0ZWQuXG4gICAqIEB0eXBlIHtDb2xvcn1cbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkXG4gICAqL1xuICB0aGlzLmZpbGxIaWdobGlnaHRDb2xvciA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogRW5hYmxlIGxpZ2h0aW5nIHRoZSBnbG9iZSB3aXRoIHRoZSBzY2VuZSdzIGxpZ2h0IHNvdXJjZS5cbiAgICpcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICB0aGlzLmVuYWJsZUxpZ2h0aW5nID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEVuYWJsZSBkeW5hbWljIGxpZ2h0aW5nIGVmZmVjdHMgb24gYXRtb3NwaGVyZSBhbmQgZm9nLiBUaGlzIG9ubHkgdGFrZXMgZWZmZWN0XG4gICAqIHdoZW4gPGNvZGU+ZW5hYmxlTGlnaHRpbmc8L2NvZGU+IGlzIDxjb2RlPnRydWU8L2NvZGU+LlxuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgdGhpcy5keW5hbWljQXRtb3NwaGVyZUxpZ2h0aW5nID0gdHJ1ZTtcblxuICAvKipcbiAgICogV2hldGhlciBkeW5hbWljIGF0bW9zcGhlcmUgbGlnaHRpbmcgdXNlcyB0aGUgc3VuIGRpcmVjdGlvbiBpbnN0ZWFkIG9mIHRoZSBzY2VuZSdzXG4gICAqIGxpZ2h0IGRpcmVjdGlvbi4gVGhpcyBvbmx5IHRha2VzIGVmZmVjdCB3aGVuIDxjb2RlPmVuYWJsZUxpZ2h0aW5nPC9jb2RlPiBhbmRcbiAgICogPGNvZGU+ZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZzwvY29kZT4gYXJlIDxjb2RlPnRydWU8L2NvZGU+LlxuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHRoaXMuZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZ0Zyb21TdW4gPSBmYWxzZTtcblxuICAvKipcbiAgICogRW5hYmxlIHRoZSBncm91bmQgYXRtb3NwaGVyZSwgd2hpY2ggaXMgZHJhd24gb3ZlciB0aGUgZ2xvYmUgd2hlbiB2aWV3ZWQgZnJvbSBhIGRpc3RhbmNlIGJldHdlZW4gPGNvZGU+bGlnaHRpbmdGYWRlSW5EaXN0YW5jZTwvY29kZT4gYW5kIDxjb2RlPmxpZ2h0aW5nRmFkZU91dERpc3RhbmNlPC9jb2RlPi5cbiAgICpcbiAgICogQGRlbW8ge0BsaW5rIGh0dHBzOi8vc2FuZGNhc3RsZS5jZXNpdW0uY29tL2luZGV4Lmh0bWw/c3JjPUdyb3VuZCUyMEF0bW9zcGhlcmUuaHRtbHxHcm91bmQgYXRtb3NwaGVyZSBkZW1vIGluIFNhbmRjYXN0bGV9XG4gICAqXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICB0aGlzLnNob3dHcm91bmRBdG1vc3BoZXJlID0gdHJ1ZTtcblxuICAvKipcbiAgICogVGhlIGRpc3RhbmNlIHdoZXJlIGV2ZXJ5dGhpbmcgYmVjb21lcyBsaXQuIFRoaXMgb25seSB0YWtlcyBlZmZlY3RcbiAgICogd2hlbiA8Y29kZT5lbmFibGVMaWdodGluZzwvY29kZT4gb3IgPGNvZGU+c2hvd0dyb3VuZEF0bW9zcGhlcmU8L2NvZGU+IGlzIDxjb2RlPnRydWU8L2NvZGU+LlxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAxMDAwMDAwMC4wXG4gICAqL1xuICB0aGlzLmxpZ2h0aW5nRmFkZU91dERpc3RhbmNlID0gMS4wZTc7XG5cbiAgLyoqXG4gICAqIFRoZSBkaXN0YW5jZSB3aGVyZSBsaWdodGluZyByZXN1bWVzLiBUaGlzIG9ubHkgdGFrZXMgZWZmZWN0XG4gICAqIHdoZW4gPGNvZGU+ZW5hYmxlTGlnaHRpbmc8L2NvZGU+IG9yIDxjb2RlPnNob3dHcm91bmRBdG1vc3BoZXJlPC9jb2RlPiBpcyA8Y29kZT50cnVlPC9jb2RlPi5cbiAgICpcbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMjAwMDAwMDAuMFxuICAgKi9cbiAgdGhpcy5saWdodGluZ0ZhZGVJbkRpc3RhbmNlID0gMi4wZTc7XG5cbiAgLyoqXG4gICAqIFRoZSBkaXN0YW5jZSB3aGVyZSB0aGUgZGFya25lc3Mgb2YgbmlnaHQgZnJvbSB0aGUgZ3JvdW5kIGF0bW9zcGhlcmUgZmFkZXMgb3V0IHRvIGEgbGl0IGdyb3VuZCBhdG1vc3BoZXJlLlxuICAgKiBUaGlzIG9ubHkgdGFrZXMgZWZmZWN0IHdoZW4gPGNvZGU+c2hvd0dyb3VuZEF0bW9zcGhlcmU8L2NvZGU+LCA8Y29kZT5lbmFibGVMaWdodGluZzwvY29kZT4sIGFuZFxuICAgKiA8Y29kZT5keW5hbWljQXRtb3NwaGVyZUxpZ2h0aW5nPC9jb2RlPiBhcmUgPGNvZGU+dHJ1ZTwvY29kZT4uXG4gICAqXG4gICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAqIEBkZWZhdWx0IDEwMDAwMDAwLjBcbiAgICovXG4gIHRoaXMubmlnaHRGYWRlT3V0RGlzdGFuY2UgPSAxLjBlNztcblxuICAvKipcbiAgICogVGhlIGRpc3RhbmNlIHdoZXJlIHRoZSBkYXJrbmVzcyBvZiBuaWdodCBmcm9tIHRoZSBncm91bmQgYXRtb3NwaGVyZSBmYWRlcyBpbiB0byBhbiB1bmxpdCBncm91bmQgYXRtb3NwaGVyZS5cbiAgICogVGhpcyBvbmx5IHRha2VzIGVmZmVjdCB3aGVuIDxjb2RlPnNob3dHcm91bmRBdG1vc3BoZXJlPC9jb2RlPiwgPGNvZGU+ZW5hYmxlTGlnaHRpbmc8L2NvZGU+LCBhbmRcbiAgICogPGNvZGU+ZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZzwvY29kZT4gYXJlIDxjb2RlPnRydWU8L2NvZGU+LlxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCA1MDAwMDAwMC4wXG4gICAqL1xuICB0aGlzLm5pZ2h0RmFkZUluRGlzdGFuY2UgPSA1LjBlNztcblxuICAvKipcbiAgICogVHJ1ZSBpZiBhbiBhbmltYXRlZCB3YXZlIGVmZmVjdCBzaG91bGQgYmUgc2hvd24gaW4gYXJlYXMgb2YgdGhlIGdsb2JlXG4gICAqIGNvdmVyZWQgYnkgd2F0ZXI7IG90aGVyd2lzZSwgZmFsc2UuICBUaGlzIHByb3BlcnR5IGlzIGlnbm9yZWQgaWYgdGhlXG4gICAqIDxjb2RlPnRlcnJhaW5Qcm92aWRlcjwvY29kZT4gZG9lcyBub3QgcHJvdmlkZSBhIHdhdGVyIG1hc2suXG4gICAqXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICB0aGlzLnNob3dXYXRlckVmZmVjdCA9IHRydWU7XG5cbiAgLyoqXG4gICAqIFRydWUgaWYgcHJpbWl0aXZlcyBzdWNoIGFzIGJpbGxib2FyZHMsIHBvbHlsaW5lcywgbGFiZWxzLCBldGMuIHNob3VsZCBiZSBkZXB0aC10ZXN0ZWRcbiAgICogYWdhaW5zdCB0aGUgdGVycmFpbiBzdXJmYWNlLCBvciBmYWxzZSBpZiBzdWNoIHByaW1pdGl2ZXMgc2hvdWxkIGFsd2F5cyBiZSBkcmF3biBvbiB0b3BcbiAgICogb2YgdGVycmFpbiB1bmxlc3MgdGhleSdyZSBvbiB0aGUgb3Bwb3NpdGUgc2lkZSBvZiB0aGUgZ2xvYmUuICBUaGUgZGlzYWR2YW50YWdlIG9mIGRlcHRoXG4gICAqIHRlc3RpbmcgcHJpbWl0aXZlcyBhZ2FpbnN0IHRlcnJhaW4gaXMgdGhhdCBzbGlnaHQgbnVtZXJpY2FsIG5vaXNlIG9yIHRlcnJhaW4gbGV2ZWwtb2YtZGV0YWlsXG4gICAqIHN3aXRjaGVkIGNhbiBzb21ldGltZXMgbWFrZSBhIHByaW1pdGl2ZSB0aGF0IHNob3VsZCBiZSBvbiB0aGUgc3VyZmFjZSBkaXNhcHBlYXIgdW5kZXJuZWF0aCBpdC5cbiAgICpcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqXG4gICAqL1xuICB0aGlzLmRlcHRoVGVzdEFnYWluc3RUZXJyYWluID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgd2hldGhlciB0aGUgZ2xvYmUgY2FzdHMgb3IgcmVjZWl2ZXMgc2hhZG93cyBmcm9tIGxpZ2h0IHNvdXJjZXMuIFNldHRpbmcgdGhlIGdsb2JlXG4gICAqIHRvIGNhc3Qgc2hhZG93cyBtYXkgaW1wYWN0IHBlcmZvcm1hbmNlIHNpbmNlIHRoZSB0ZXJyYWluIGlzIHJlbmRlcmVkIGFnYWluIGZyb20gdGhlIGxpZ2h0J3MgcGVyc3BlY3RpdmUuXG4gICAqIEN1cnJlbnRseSBvbmx5IHRlcnJhaW4gdGhhdCBpcyBpbiB2aWV3IGNhc3RzIHNoYWRvd3MuIEJ5IGRlZmF1bHQgdGhlIGdsb2JlIGRvZXMgbm90IGNhc3Qgc2hhZG93cy5cbiAgICpcbiAgICogQHR5cGUge1NoYWRvd01vZGV9XG4gICAqIEBkZWZhdWx0IFNoYWRvd01vZGUuUkVDRUlWRV9PTkxZXG4gICAqL1xuICB0aGlzLnNoYWRvd3MgPSBTaGFkb3dNb2RlLlJFQ0VJVkVfT05MWTtcblxuICAvKipcbiAgICogVGhlIGh1ZSBzaGlmdCB0byBhcHBseSB0byB0aGUgYXRtb3NwaGVyZS4gRGVmYXVsdHMgdG8gMC4wIChubyBzaGlmdCkuXG4gICAqIEEgaHVlIHNoaWZ0IG9mIDEuMCBpbmRpY2F0ZXMgYSBjb21wbGV0ZSByb3RhdGlvbiBvZiB0aGUgaHVlcyBhdmFpbGFibGUuXG4gICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAqIEBkZWZhdWx0IDAuMFxuICAgKi9cbiAgdGhpcy5hdG1vc3BoZXJlSHVlU2hpZnQgPSAwLjA7XG5cbiAgLyoqXG4gICAqIFRoZSBzYXR1cmF0aW9uIHNoaWZ0IHRvIGFwcGx5IHRvIHRoZSBhdG1vc3BoZXJlLiBEZWZhdWx0cyB0byAwLjAgKG5vIHNoaWZ0KS5cbiAgICogQSBzYXR1cmF0aW9uIHNoaWZ0IG9mIC0xLjAgaXMgbW9ub2Nocm9tZS5cbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMC4wXG4gICAqL1xuICB0aGlzLmF0bW9zcGhlcmVTYXR1cmF0aW9uU2hpZnQgPSAwLjA7XG5cbiAgLyoqXG4gICAqIFRoZSBicmlnaHRuZXNzIHNoaWZ0IHRvIGFwcGx5IHRvIHRoZSBhdG1vc3BoZXJlLiBEZWZhdWx0cyB0byAwLjAgKG5vIHNoaWZ0KS5cbiAgICogQSBicmlnaHRuZXNzIHNoaWZ0IG9mIC0xLjAgaXMgY29tcGxldGUgZGFya25lc3MsIHdoaWNoIHdpbGwgbGV0IHNwYWNlIHNob3cgdGhyb3VnaC5cbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMC4wXG4gICAqL1xuICB0aGlzLmF0bW9zcGhlcmVCcmlnaHRuZXNzU2hpZnQgPSAwLjA7XG5cbiAgLyoqXG4gICAqIEEgc2NhbGFyIHVzZWQgdG8gZXhhZ2dlcmF0ZSB0aGUgdGVycmFpbi4gRGVmYXVsdHMgdG8gPGNvZGU+MS4wPC9jb2RlPiAobm8gZXhhZ2dlcmF0aW9uKS5cbiAgICogQSB2YWx1ZSBvZiA8Y29kZT4yLjA8L2NvZGU+IHNjYWxlcyB0aGUgdGVycmFpbiBieSAyeC5cbiAgICogQSB2YWx1ZSBvZiA8Y29kZT4wLjA8L2NvZGU+IG1ha2VzIHRoZSB0ZXJyYWluIGNvbXBsZXRlbHkgZmxhdC5cbiAgICogTm90ZSB0aGF0IHRlcnJhaW4gZXhhZ2dlcmF0aW9uIHdpbGwgbm90IG1vZGlmeSBhbnkgb3RoZXIgcHJpbWl0aXZlIGFzIHRoZXkgYXJlIHBvc2l0aW9uZWQgcmVsYXRpdmUgdG8gdGhlIGVsbGlwc29pZC5cbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMS4wXG4gICAqL1xuICB0aGlzLnRlcnJhaW5FeGFnZ2VyYXRpb24gPSAxLjA7XG5cbiAgLyoqXG4gICAqIFRoZSBoZWlnaHQgZnJvbSB3aGljaCB0ZXJyYWluIGlzIGV4YWdnZXJhdGVkLiBEZWZhdWx0cyB0byA8Y29kZT4wLjA8L2NvZGU+IChzY2FsZWQgcmVsYXRpdmUgdG8gZWxsaXBzb2lkIHN1cmZhY2UpLlxuICAgKiBUZXJyYWluIHRoYXQgaXMgYWJvdmUgdGhpcyBoZWlnaHQgd2lsbCBzY2FsZSB1cHdhcmRzIGFuZCB0ZXJyYWluIHRoYXQgaXMgYmVsb3cgdGhpcyBoZWlnaHQgd2lsbCBzY2FsZSBkb3dud2FyZHMuXG4gICAqIE5vdGUgdGhhdCB0ZXJyYWluIGV4YWdnZXJhdGlvbiB3aWxsIG5vdCBtb2RpZnkgYW55IG90aGVyIHByaW1pdGl2ZSBhcyB0aGV5IGFyZSBwb3NpdGlvbmVkIHJlbGF0aXZlIHRvIHRoZSBlbGxpcHNvaWQuXG4gICAqIElmIHtAbGluayBHbG9iZSN0ZXJyYWluRXhhZ2dlcmF0aW9ufSBpcyA8Y29kZT4xLjA8L2NvZGU+IHRoaXMgdmFsdWUgd2lsbCBoYXZlIG5vIGVmZmVjdC5cbiAgICogQHR5cGUge051bWJlcn1cbiAgICogQGRlZmF1bHQgMC4wXG4gICAqL1xuICB0aGlzLnRlcnJhaW5FeGFnZ2VyYXRpb25SZWxhdGl2ZUhlaWdodCA9IDAuMDtcblxuICAvKipcbiAgICogV2hldGhlciB0byBzaG93IHRlcnJhaW4gc2tpcnRzLiBUZXJyYWluIHNraXJ0cyBhcmUgZ2VvbWV0cnkgZXh0ZW5kaW5nIGRvd253YXJkcyBmcm9tIGEgdGlsZSdzIGVkZ2VzIHVzZWQgdG8gaGlkZSBzZWFtcyBiZXR3ZWVuIG5laWdoYm9yaW5nIHRpbGVzLlxuICAgKiBTa2lydHMgYXJlIGFsd2F5cyBoaWRkZW4gd2hlbiB0aGUgY2FtZXJhIGlzIHVuZGVyZ3JvdW5kIG9yIHRyYW5zbHVjZW5jeSBpcyBlbmFibGVkLlxuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgdGhpcy5zaG93U2tpcnRzID0gdHJ1ZTtcblxuICAvKipcbiAgICogV2hldGhlciB0byBjdWxsIGJhY2stZmFjaW5nIHRlcnJhaW4uIEJhY2sgZmFjZXMgYXJlIG5vdCBjdWxsZWQgd2hlbiB0aGUgY2FtZXJhIGlzIHVuZGVyZ3JvdW5kIG9yIHRyYW5zbHVjZW5jeSBpcyBlbmFibGVkLlxuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgdGhpcy5iYWNrRmFjZUN1bGxpbmcgPSB0cnVlO1xuXG4gIHRoaXMuX29jZWFuTm9ybWFsTWFwID0gdW5kZWZpbmVkO1xuICB0aGlzLl96b29tZWRPdXRPY2VhblNwZWN1bGFySW50ZW5zaXR5ID0gdW5kZWZpbmVkO1xufVxuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhHbG9iZS5wcm90b3R5cGUsIHtcbiAgLyoqXG4gICAqIEdldHMgYW4gZWxsaXBzb2lkIGRlc2NyaWJpbmcgdGhlIHNoYXBlIG9mIHRoaXMgZ2xvYmUuXG4gICAqIEBtZW1iZXJvZiBHbG9iZS5wcm90b3R5cGVcbiAgICogQHR5cGUge0VsbGlwc29pZH1cbiAgICovXG4gIGVsbGlwc29pZDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2VsbGlwc29pZDtcbiAgICB9LFxuICB9LFxuICAvKipcbiAgICogR2V0cyB0aGUgY29sbGVjdGlvbiBvZiBpbWFnZSBsYXllcnMgdGhhdCB3aWxsIGJlIHJlbmRlcmVkIG9uIHRoaXMgZ2xvYmUuXG4gICAqIEBtZW1iZXJvZiBHbG9iZS5wcm90b3R5cGVcbiAgICogQHR5cGUge0ltYWdlcnlMYXllckNvbGxlY3Rpb259XG4gICAqL1xuICBpbWFnZXJ5TGF5ZXJzOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5faW1hZ2VyeUxheWVyQ29sbGVjdGlvbjtcbiAgICB9LFxuICB9LFxuICAvKipcbiAgICogR2V0cyBhbiBldmVudCB0aGF0J3MgcmFpc2VkIHdoZW4gYW4gaW1hZ2VyeSBsYXllciBpcyBhZGRlZCwgc2hvd24sIGhpZGRlbiwgbW92ZWQsIG9yIHJlbW92ZWQuXG4gICAqXG4gICAqIEBtZW1iZXJvZiBHbG9iZS5wcm90b3R5cGVcbiAgICogQHR5cGUge0V2ZW50fVxuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIGltYWdlcnlMYXllcnNVcGRhdGVkRXZlbnQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zdXJmYWNlLnRpbGVQcm92aWRlci5pbWFnZXJ5TGF5ZXJzVXBkYXRlZEV2ZW50O1xuICAgIH0sXG4gIH0sXG4gIC8qKlxuICAgKiBSZXR1cm5zIDxjb2RlPnRydWU8L2NvZGU+IHdoZW4gdGhlIHRpbGUgbG9hZCBxdWV1ZSBpcyBlbXB0eSwgPGNvZGU+ZmFsc2U8L2NvZGU+IG90aGVyd2lzZS4gIFdoZW4gdGhlIGxvYWQgcXVldWUgaXMgZW1wdHksXG4gICAqIGFsbCB0ZXJyYWluIGFuZCBpbWFnZXJ5IGZvciB0aGUgY3VycmVudCB2aWV3IGhhdmUgYmVlbiBsb2FkZWQuXG4gICAqIEBtZW1iZXJvZiBHbG9iZS5wcm90b3R5cGVcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgdGlsZXNMb2FkZWQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghZGVmaW5lZCh0aGlzLl9zdXJmYWNlKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoXG4gICAgICAgIHRoaXMuX3N1cmZhY2UudGlsZVByb3ZpZGVyLnJlYWR5ICYmXG4gICAgICAgIHRoaXMuX3N1cmZhY2UuX3RpbGVMb2FkUXVldWVIaWdoLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICB0aGlzLl9zdXJmYWNlLl90aWxlTG9hZFF1ZXVlTWVkaXVtLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICB0aGlzLl9zdXJmYWNlLl90aWxlTG9hZFF1ZXVlTG93Lmxlbmd0aCA9PT0gMFxuICAgICAgKTtcbiAgICB9LFxuICB9LFxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBjb2xvciBvZiB0aGUgZ2xvYmUgd2hlbiBubyBpbWFnZXJ5IGlzIGF2YWlsYWJsZS5cbiAgICogQG1lbWJlcm9mIEdsb2JlLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7Q29sb3J9XG4gICAqL1xuICBiYXNlQ29sb3I6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zdXJmYWNlLnRpbGVQcm92aWRlci5iYXNlQ29sb3I7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5fc3VyZmFjZS50aWxlUHJvdmlkZXIuYmFzZUNvbG9yID0gdmFsdWU7XG4gICAgfSxcbiAgfSxcbiAgLyoqXG4gICAqIEEgcHJvcGVydHkgc3BlY2lmeWluZyBhIHtAbGluayBDbGlwcGluZ1BsYW5lQ29sbGVjdGlvbn0gdXNlZCB0byBzZWxlY3RpdmVseSBkaXNhYmxlIHJlbmRlcmluZyBvbiB0aGUgb3V0c2lkZSBvZiBlYWNoIHBsYW5lLlxuICAgKlxuICAgKiBAbWVtYmVyb2YgR2xvYmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtDbGlwcGluZ1BsYW5lQ29sbGVjdGlvbn1cbiAgICovXG4gIGNsaXBwaW5nUGxhbmVzOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc3VyZmFjZS50aWxlUHJvdmlkZXIuY2xpcHBpbmdQbGFuZXM7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5fc3VyZmFjZS50aWxlUHJvdmlkZXIuY2xpcHBpbmdQbGFuZXMgPSB2YWx1ZTtcbiAgICB9LFxuICB9LFxuICAvKipcbiAgICogQSBwcm9wZXJ0eSBzcGVjaWZ5aW5nIGEge0BsaW5rIFJlY3RhbmdsZX0gdXNlZCB0byBsaW1pdCBnbG9iZSByZW5kZXJpbmcgdG8gYSBjYXJ0b2dyYXBoaWMgYXJlYS5cbiAgICogRGVmYXVsdHMgdG8gdGhlIG1heGltdW0gZXh0ZW50IG9mIGNhcnRvZ3JhcGhpYyBjb29yZGluYXRlcy5cbiAgICpcbiAgICogQG1lbWJlcm9mIEdsb2JlLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7UmVjdGFuZ2xlfVxuICAgKiBAZGVmYXVsdCB7QGxpbmsgUmVjdGFuZ2xlLk1BWF9WQUxVRX1cbiAgICovXG4gIGNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc3VyZmFjZS50aWxlUHJvdmlkZXIuY2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGU7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKCFkZWZpbmVkKHZhbHVlKSkge1xuICAgICAgICB2YWx1ZSA9IFJlY3RhbmdsZS5jbG9uZShSZWN0YW5nbGUuTUFYX1ZBTFVFKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3N1cmZhY2UudGlsZVByb3ZpZGVyLmNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlID0gdmFsdWU7XG4gICAgfSxcbiAgfSxcbiAgLyoqXG4gICAqIFRoZSBub3JtYWwgbWFwIHRvIHVzZSBmb3IgcmVuZGVyaW5nIHdhdmVzIGluIHRoZSBvY2Vhbi4gIFNldHRpbmcgdGhpcyBwcm9wZXJ0eSB3aWxsXG4gICAqIG9ubHkgaGF2ZSBhbiBlZmZlY3QgaWYgdGhlIGNvbmZpZ3VyZWQgdGVycmFpbiBwcm92aWRlciBpbmNsdWRlcyBhIHdhdGVyIG1hc2suXG4gICAqIEBtZW1iZXJvZiBHbG9iZS5wcm90b3R5cGVcbiAgICogQHR5cGUge1N0cmluZ31cbiAgICogQGRlZmF1bHQgYnVpbGRNb2R1bGVVcmwoJ0Fzc2V0cy9UZXh0dXJlcy93YXRlck5vcm1hbHNTbWFsbC5qcGcnKVxuICAgKi9cbiAgb2NlYW5Ob3JtYWxNYXBVcmw6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9vY2Vhbk5vcm1hbE1hcFJlc291cmNlLnVybDtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLl9vY2Vhbk5vcm1hbE1hcFJlc291cmNlLnVybCA9IHZhbHVlO1xuICAgICAgdGhpcy5fb2NlYW5Ob3JtYWxNYXBSZXNvdXJjZURpcnR5ID0gdHJ1ZTtcbiAgICB9LFxuICB9LFxuICAvKipcbiAgICogVGhlIHRlcnJhaW4gcHJvdmlkZXIgcHJvdmlkaW5nIHN1cmZhY2UgZ2VvbWV0cnkgZm9yIHRoaXMgZ2xvYmUuXG4gICAqIEB0eXBlIHtUZXJyYWluUHJvdmlkZXJ9XG4gICAqXG4gICAqIEBtZW1iZXJvZiBHbG9iZS5wcm90b3R5cGVcbiAgICogQHR5cGUge1RlcnJhaW5Qcm92aWRlcn1cbiAgICpcbiAgICovXG4gIHRlcnJhaW5Qcm92aWRlcjoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3RlcnJhaW5Qcm92aWRlcjtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICBpZiAodmFsdWUgIT09IHRoaXMuX3RlcnJhaW5Qcm92aWRlcikge1xuICAgICAgICB0aGlzLl90ZXJyYWluUHJvdmlkZXIgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fdGVycmFpblByb3ZpZGVyQ2hhbmdlZC5yYWlzZUV2ZW50KHZhbHVlKTtcbiAgICAgICAgaWYgKGRlZmluZWQodGhpcy5fbWF0ZXJpYWwpKSB7XG4gICAgICAgICAgbWFrZVNoYWRlcnNEaXJ0eSh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gIH0sXG4gIC8qKlxuICAgKiBHZXRzIGFuIGV2ZW50IHRoYXQncyByYWlzZWQgd2hlbiB0aGUgdGVycmFpbiBwcm92aWRlciBpcyBjaGFuZ2VkXG4gICAqXG4gICAqIEBtZW1iZXJvZiBHbG9iZS5wcm90b3R5cGVcbiAgICogQHR5cGUge0V2ZW50fVxuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIHRlcnJhaW5Qcm92aWRlckNoYW5nZWQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl90ZXJyYWluUHJvdmlkZXJDaGFuZ2VkO1xuICAgIH0sXG4gIH0sXG4gIC8qKlxuICAgKiBHZXRzIGFuIGV2ZW50IHRoYXQncyByYWlzZWQgd2hlbiB0aGUgbGVuZ3RoIG9mIHRoZSB0aWxlIGxvYWQgcXVldWUgaGFzIGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgcmVuZGVyIGZyYW1lLiAgV2hlbiB0aGUgbG9hZCBxdWV1ZSBpcyBlbXB0eSxcbiAgICogYWxsIHRlcnJhaW4gYW5kIGltYWdlcnkgZm9yIHRoZSBjdXJyZW50IHZpZXcgaGF2ZSBiZWVuIGxvYWRlZC4gIFRoZSBldmVudCBwYXNzZXMgdGhlIG5ldyBsZW5ndGggb2YgdGhlIHRpbGUgbG9hZCBxdWV1ZS5cbiAgICpcbiAgICogQG1lbWJlcm9mIEdsb2JlLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7RXZlbnR9XG4gICAqL1xuICB0aWxlTG9hZFByb2dyZXNzRXZlbnQ6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zdXJmYWNlLnRpbGVMb2FkUHJvZ3Jlc3NFdmVudDtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgdGhlIG1hdGVyaWFsIGFwcGVhcmFuY2Ugb2YgdGhlIEdsb2JlLiAgVGhpcyBjYW4gYmUgb25lIG9mIHNldmVyYWwgYnVpbHQtaW4ge0BsaW5rIE1hdGVyaWFsfSBvYmplY3RzIG9yIGEgY3VzdG9tIG1hdGVyaWFsLCBzY3JpcHRlZCB3aXRoXG4gICAqIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vQ2VzaXVtR1MvY2VzaXVtL3dpa2kvRmFicmljfEZhYnJpY30uXG4gICAqIEBtZW1iZXJvZiBHbG9iZS5wcm90b3R5cGVcbiAgICogQHR5cGUge01hdGVyaWFsfVxuICAgKi9cbiAgbWF0ZXJpYWw6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9tYXRlcmlhbDtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKG1hdGVyaWFsKSB7XG4gICAgICBpZiAodGhpcy5fbWF0ZXJpYWwgIT09IG1hdGVyaWFsKSB7XG4gICAgICAgIHRoaXMuX21hdGVyaWFsID0gbWF0ZXJpYWw7XG4gICAgICAgIG1ha2VTaGFkZXJzRGlydHkodGhpcyk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogVGhlIGNvbG9yIHRvIHJlbmRlciB0aGUgYmFjayBzaWRlIG9mIHRoZSBnbG9iZSB3aGVuIHRoZSBjYW1lcmEgaXMgdW5kZXJncm91bmQgb3IgdGhlIGdsb2JlIGlzIHRyYW5zbHVjZW50LFxuICAgKiBibGVuZGVkIHdpdGggdGhlIGdsb2JlIGNvbG9yIGJhc2VkIG9uIHRoZSBjYW1lcmEncyBkaXN0YW5jZS5cbiAgICogPGJyIC8+PGJyIC8+XG4gICAqIFRvIGRpc2FibGUgdW5kZXJncm91bmQgY29sb3JpbmcsIHNldCA8Y29kZT51bmRlcmdyb3VuZENvbG9yPC9jb2RlPiB0byA8Y29kZT51bmRlZmluZWQ8L2NvZGU+LlxuICAgKlxuICAgKiBAbWVtYmVyb2YgR2xvYmUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtDb2xvcn1cbiAgICogQGRlZmF1bHQge0BsaW5rIENvbG9yLkJMQUNLfVxuICAgKlxuICAgKiBAc2VlIEdsb2JlI3VuZGVyZ3JvdW5kQ29sb3JBbHBoYUJ5RGlzdGFuY2VcbiAgICovXG4gIHVuZGVyZ3JvdW5kQ29sb3I6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl91bmRlcmdyb3VuZENvbG9yO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHRoaXMuX3VuZGVyZ3JvdW5kQ29sb3IgPSBDb2xvci5jbG9uZSh2YWx1ZSwgdGhpcy5fdW5kZXJncm91bmRDb2xvcik7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBuZWFyIGFuZCBmYXIgZGlzdGFuY2UgZm9yIGJsZW5kaW5nIHtAbGluayBHbG9iZSN1bmRlcmdyb3VuZENvbG9yfSB3aXRoIHRoZSBnbG9iZSBjb2xvci5cbiAgICogVGhlIGFscGhhIHdpbGwgaW50ZXJwb2xhdGUgYmV0d2VlbiB0aGUge0BsaW5rIE5lYXJGYXJTY2FsYXIjbmVhclZhbHVlfSBhbmRcbiAgICoge0BsaW5rIE5lYXJGYXJTY2FsYXIjZmFyVmFsdWV9IHdoaWxlIHRoZSBjYW1lcmEgZGlzdGFuY2UgZmFsbHMgd2l0aGluIHRoZSBsb3dlciBhbmQgdXBwZXIgYm91bmRzXG4gICAqIG9mIHRoZSBzcGVjaWZpZWQge0BsaW5rIE5lYXJGYXJTY2FsYXIjbmVhcn0gYW5kIHtAbGluayBOZWFyRmFyU2NhbGFyI2Zhcn0uXG4gICAqIE91dHNpZGUgb2YgdGhlc2UgcmFuZ2VzIHRoZSBhbHBoYSByZW1haW5zIGNsYW1wZWQgdG8gdGhlIG5lYXJlc3QgYm91bmQuIElmIHVuZGVmaW5lZCxcbiAgICogdGhlIHVuZGVyZ3JvdW5kIGNvbG9yIHdpbGwgbm90IGJlIGJsZW5kZWQgd2l0aCB0aGUgZ2xvYmUgY29sb3IuXG4gICAqIDxiciAvPiA8YnIgLz5cbiAgICogV2hlbiB0aGUgY2FtZXJhIGlzIGFib3ZlIHRoZSBlbGxpcHNvaWQgdGhlIGRpc3RhbmNlIGlzIGNvbXB1dGVkIGZyb20gdGhlIG5lYXJlc3RcbiAgICogcG9pbnQgb24gdGhlIGVsbGlwc29pZCBpbnN0ZWFkIG9mIHRoZSBjYW1lcmEncyBwb3NpdGlvbi5cbiAgICpcbiAgICogQG1lbWJlcm9mIEdsb2JlLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7TmVhckZhclNjYWxhcn1cbiAgICpcbiAgICogQHNlZSBHbG9iZSN1bmRlcmdyb3VuZENvbG9yXG4gICAqXG4gICAqL1xuICB1bmRlcmdyb3VuZENvbG9yQWxwaGFCeURpc3RhbmNlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdW5kZXJncm91bmRDb2xvckFscGhhQnlEaXN0YW5jZTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgaWYgKGRlZmluZWQodmFsdWUpICYmIHZhbHVlLmZhciA8IHZhbHVlLm5lYXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFxuICAgICAgICAgIFwiZmFyIGRpc3RhbmNlIG11c3QgYmUgZ3JlYXRlciB0aGFuIG5lYXIgZGlzdGFuY2UuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuICAgICAgdGhpcy5fdW5kZXJncm91bmRDb2xvckFscGhhQnlEaXN0YW5jZSA9IE5lYXJGYXJTY2FsYXIuY2xvbmUoXG4gICAgICAgIHZhbHVlLFxuICAgICAgICB0aGlzLl91bmRlcmdyb3VuZENvbG9yQWxwaGFCeURpc3RhbmNlXG4gICAgICApO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIFByb3BlcnRpZXMgZm9yIGNvbnRyb2xsaW5nIGdsb2JlIHRyYW5zbHVjZW5jeS5cbiAgICpcbiAgICogQG1lbWJlcm9mIEdsb2JlLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7R2xvYmVUcmFuc2x1Y2VuY3l9XG4gICAqL1xuICB0cmFuc2x1Y2VuY3k6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl90cmFuc2x1Y2VuY3k7XG4gICAgfSxcbiAgfSxcbn0pO1xuXG5mdW5jdGlvbiBtYWtlU2hhZGVyc0RpcnR5KGdsb2JlKSB7XG4gIHZhciBkZWZpbmVzID0gW107XG5cbiAgdmFyIHJlcXVpcmVOb3JtYWxzID1cbiAgICBkZWZpbmVkKGdsb2JlLl9tYXRlcmlhbCkgJiZcbiAgICAoZ2xvYmUuX21hdGVyaWFsLnNoYWRlclNvdXJjZS5tYXRjaCgvc2xvcGUvKSB8fFxuICAgICAgZ2xvYmUuX21hdGVyaWFsLnNoYWRlclNvdXJjZS5tYXRjaChcIm5vcm1hbEVDXCIpKTtcblxuICB2YXIgZnJhZ21lbnRTb3VyY2VzID0gW0dyb3VuZEF0bW9zcGhlcmVdO1xuICBpZiAoXG4gICAgZGVmaW5lZChnbG9iZS5fbWF0ZXJpYWwpICYmXG4gICAgKCFyZXF1aXJlTm9ybWFscyB8fCBnbG9iZS5fdGVycmFpblByb3ZpZGVyLnJlcXVlc3RWZXJ0ZXhOb3JtYWxzKVxuICApIHtcbiAgICBmcmFnbWVudFNvdXJjZXMucHVzaChnbG9iZS5fbWF0ZXJpYWwuc2hhZGVyU291cmNlKTtcbiAgICBkZWZpbmVzLnB1c2goXCJBUFBMWV9NQVRFUklBTFwiKTtcbiAgICBnbG9iZS5fc3VyZmFjZS5fdGlsZVByb3ZpZGVyLm1hdGVyaWFsVW5pZm9ybU1hcCA9IGdsb2JlLl9tYXRlcmlhbC5fdW5pZm9ybXM7XG4gIH0gZWxzZSB7XG4gICAgZ2xvYmUuX3N1cmZhY2UuX3RpbGVQcm92aWRlci5tYXRlcmlhbFVuaWZvcm1NYXAgPSB1bmRlZmluZWQ7XG4gIH1cbiAgZnJhZ21lbnRTb3VyY2VzLnB1c2goR2xvYmVGUyk7XG5cbiAgZ2xvYmUuX3N1cmZhY2VTaGFkZXJTZXQuYmFzZVZlcnRleFNoYWRlclNvdXJjZSA9IG5ldyBTaGFkZXJTb3VyY2Uoe1xuICAgIHNvdXJjZXM6IFtHcm91bmRBdG1vc3BoZXJlLCBHbG9iZVZTXSxcbiAgICBkZWZpbmVzOiBkZWZpbmVzLFxuICB9KTtcblxuICBnbG9iZS5fc3VyZmFjZVNoYWRlclNldC5iYXNlRnJhZ21lbnRTaGFkZXJTb3VyY2UgPSBuZXcgU2hhZGVyU291cmNlKHtcbiAgICBzb3VyY2VzOiBmcmFnbWVudFNvdXJjZXMsXG4gICAgZGVmaW5lczogZGVmaW5lcyxcbiAgfSk7XG4gIGdsb2JlLl9zdXJmYWNlU2hhZGVyU2V0Lm1hdGVyaWFsID0gZ2xvYmUuX21hdGVyaWFsO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVDb21wYXJlUGlja1RpbGVGdW5jdGlvbihyYXlPcmlnaW4pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgdmFyIGFEaXN0ID0gQm91bmRpbmdTcGhlcmUuZGlzdGFuY2VTcXVhcmVkVG8oXG4gICAgICBhLnBpY2tCb3VuZGluZ1NwaGVyZSxcbiAgICAgIHJheU9yaWdpblxuICAgICk7XG4gICAgdmFyIGJEaXN0ID0gQm91bmRpbmdTcGhlcmUuZGlzdGFuY2VTcXVhcmVkVG8oXG4gICAgICBiLnBpY2tCb3VuZGluZ1NwaGVyZSxcbiAgICAgIHJheU9yaWdpblxuICAgICk7XG5cbiAgICByZXR1cm4gYURpc3QgLSBiRGlzdDtcbiAgfTtcbn1cblxudmFyIHNjcmF0Y2hBcnJheSA9IFtdO1xudmFyIHNjcmF0Y2hTcGhlcmVJbnRlcnNlY3Rpb25SZXN1bHQgPSB7XG4gIHN0YXJ0OiAwLjAsXG4gIHN0b3A6IDAuMCxcbn07XG5cbi8qKlxuICogRmluZCBhbiBpbnRlcnNlY3Rpb24gYmV0d2VlbiBhIHJheSBhbmQgdGhlIGdsb2JlIHN1cmZhY2UgdGhhdCB3YXMgcmVuZGVyZWQuIFRoZSByYXkgbXVzdCBiZSBnaXZlbiBpbiB3b3JsZCBjb29yZGluYXRlcy5cbiAqXG4gKiBAcGFyYW0ge1JheX0gcmF5IFRoZSByYXkgdG8gdGVzdCBmb3IgaW50ZXJzZWN0aW9uLlxuICogQHBhcmFtIHtTY2VuZX0gc2NlbmUgVGhlIHNjZW5lLlxuICogQHBhcmFtIHtCb29sZWFufSBbY3VsbEJhY2tGYWNlcz10cnVlXSBTZXQgdG8gdHJ1ZSB0byBub3QgcGljayBiYWNrIGZhY2VzLlxuICogQHBhcmFtIHtDYXJ0ZXNpYW4zfSBbcmVzdWx0XSBUaGUgb2JqZWN0IG9udG8gd2hpY2ggdG8gc3RvcmUgdGhlIHJlc3VsdC5cbiAqIEByZXR1cm5zIHtDYXJ0ZXNpYW4zfHVuZGVmaW5lZH0gVGhlIGludGVyc2VjdGlvbiBvciA8Y29kZT51bmRlZmluZWQ8L2NvZGU+IGlmIG5vbmUgd2FzIGZvdW5kLiAgVGhlIHJldHVybmVkIHBvc2l0aW9uIGlzIGluIHByb2plY3RlZCBjb29yZGluYXRlcyBmb3IgMkQgYW5kIENvbHVtYnVzIFZpZXcuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuR2xvYmUucHJvdG90eXBlLnBpY2tXb3JsZENvb3JkaW5hdGVzID0gZnVuY3Rpb24gKFxuICByYXksXG4gIHNjZW5lLFxuICBjdWxsQmFja0ZhY2VzLFxuICByZXN1bHRcbikge1xuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBpZiAoIWRlZmluZWQocmF5KSkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcInJheSBpcyByZXF1aXJlZFwiKTtcbiAgfVxuICBpZiAoIWRlZmluZWQoc2NlbmUpKSB7XG4gICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwic2NlbmUgaXMgcmVxdWlyZWRcIik7XG4gIH1cbiAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgY3VsbEJhY2tGYWNlcyA9IGRlZmF1bHRWYWx1ZShjdWxsQmFja0ZhY2VzLCB0cnVlKTtcblxuICB2YXIgbW9kZSA9IHNjZW5lLm1vZGU7XG4gIHZhciBwcm9qZWN0aW9uID0gc2NlbmUubWFwUHJvamVjdGlvbjtcblxuICB2YXIgc3BoZXJlSW50ZXJzZWN0aW9ucyA9IHNjcmF0Y2hBcnJheTtcbiAgc3BoZXJlSW50ZXJzZWN0aW9ucy5sZW5ndGggPSAwO1xuXG4gIHZhciB0aWxlc1RvUmVuZGVyID0gdGhpcy5fc3VyZmFjZS5fdGlsZXNUb1JlbmRlcjtcbiAgdmFyIGxlbmd0aCA9IHRpbGVzVG9SZW5kZXIubGVuZ3RoO1xuXG4gIHZhciB0aWxlO1xuICB2YXIgaTtcblxuICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICB0aWxlID0gdGlsZXNUb1JlbmRlcltpXTtcbiAgICB2YXIgc3VyZmFjZVRpbGUgPSB0aWxlLmRhdGE7XG5cbiAgICBpZiAoIWRlZmluZWQoc3VyZmFjZVRpbGUpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICB2YXIgYm91bmRpbmdWb2x1bWUgPSBzdXJmYWNlVGlsZS5waWNrQm91bmRpbmdTcGhlcmU7XG4gICAgaWYgKG1vZGUgIT09IFNjZW5lTW9kZS5TQ0VORTNEKSB7XG4gICAgICBzdXJmYWNlVGlsZS5waWNrQm91bmRpbmdTcGhlcmUgPSBib3VuZGluZ1ZvbHVtZSA9IEJvdW5kaW5nU3BoZXJlLmZyb21SZWN0YW5nbGVXaXRoSGVpZ2h0czJEKFxuICAgICAgICB0aWxlLnJlY3RhbmdsZSxcbiAgICAgICAgcHJvamVjdGlvbixcbiAgICAgICAgc3VyZmFjZVRpbGUudGlsZUJvdW5kaW5nUmVnaW9uLm1pbmltdW1IZWlnaHQsXG4gICAgICAgIHN1cmZhY2VUaWxlLnRpbGVCb3VuZGluZ1JlZ2lvbi5tYXhpbXVtSGVpZ2h0LFxuICAgICAgICBib3VuZGluZ1ZvbHVtZVxuICAgICAgKTtcbiAgICAgIENhcnRlc2lhbjMuZnJvbUVsZW1lbnRzKFxuICAgICAgICBib3VuZGluZ1ZvbHVtZS5jZW50ZXIueixcbiAgICAgICAgYm91bmRpbmdWb2x1bWUuY2VudGVyLngsXG4gICAgICAgIGJvdW5kaW5nVm9sdW1lLmNlbnRlci55LFxuICAgICAgICBib3VuZGluZ1ZvbHVtZS5jZW50ZXJcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmIChkZWZpbmVkKHN1cmZhY2VUaWxlLnJlbmRlcmVkTWVzaCkpIHtcbiAgICAgIEJvdW5kaW5nU3BoZXJlLmNsb25lKFxuICAgICAgICBzdXJmYWNlVGlsZS50aWxlQm91bmRpbmdSZWdpb24uYm91bmRpbmdTcGhlcmUsXG4gICAgICAgIGJvdW5kaW5nVm9sdW1lXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBTbyB3YWl0IGhvdyBkaWQgd2UgcmVuZGVyIHRoaXMgdGhpbmcgdGhlbj8gSXQgc2hvdWxkbid0IGJlIHBvc3NpYmxlIHRvIGdldCBoZXJlLlxuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgdmFyIGJvdW5kaW5nU3BoZXJlSW50ZXJzZWN0aW9uID0gSW50ZXJzZWN0aW9uVGVzdHMucmF5U3BoZXJlKFxuICAgICAgcmF5LFxuICAgICAgYm91bmRpbmdWb2x1bWUsXG4gICAgICBzY3JhdGNoU3BoZXJlSW50ZXJzZWN0aW9uUmVzdWx0XG4gICAgKTtcbiAgICBpZiAoZGVmaW5lZChib3VuZGluZ1NwaGVyZUludGVyc2VjdGlvbikpIHtcbiAgICAgIHNwaGVyZUludGVyc2VjdGlvbnMucHVzaChzdXJmYWNlVGlsZSk7XG4gICAgfVxuICB9XG5cbiAgc3BoZXJlSW50ZXJzZWN0aW9ucy5zb3J0KGNyZWF0ZUNvbXBhcmVQaWNrVGlsZUZ1bmN0aW9uKHJheS5vcmlnaW4pKTtcblxuICB2YXIgaW50ZXJzZWN0aW9uO1xuICBsZW5ndGggPSBzcGhlcmVJbnRlcnNlY3Rpb25zLmxlbmd0aDtcbiAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgaW50ZXJzZWN0aW9uID0gc3BoZXJlSW50ZXJzZWN0aW9uc1tpXS5waWNrKFxuICAgICAgcmF5LFxuICAgICAgc2NlbmUubW9kZSxcbiAgICAgIHNjZW5lLm1hcFByb2plY3Rpb24sXG4gICAgICBjdWxsQmFja0ZhY2VzLFxuICAgICAgcmVzdWx0XG4gICAgKTtcbiAgICBpZiAoZGVmaW5lZChpbnRlcnNlY3Rpb24pKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gaW50ZXJzZWN0aW9uO1xufTtcblxudmFyIGNhcnRvU2NyYXRjaCA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcbi8qKlxuICogRmluZCBhbiBpbnRlcnNlY3Rpb24gYmV0d2VlbiBhIHJheSBhbmQgdGhlIGdsb2JlIHN1cmZhY2UgdGhhdCB3YXMgcmVuZGVyZWQuIFRoZSByYXkgbXVzdCBiZSBnaXZlbiBpbiB3b3JsZCBjb29yZGluYXRlcy5cbiAqXG4gKiBAcGFyYW0ge1JheX0gcmF5IFRoZSByYXkgdG8gdGVzdCBmb3IgaW50ZXJzZWN0aW9uLlxuICogQHBhcmFtIHtTY2VuZX0gc2NlbmUgVGhlIHNjZW5lLlxuICogQHBhcmFtIHtDYXJ0ZXNpYW4zfSBbcmVzdWx0XSBUaGUgb2JqZWN0IG9udG8gd2hpY2ggdG8gc3RvcmUgdGhlIHJlc3VsdC5cbiAqIEByZXR1cm5zIHtDYXJ0ZXNpYW4zfHVuZGVmaW5lZH0gVGhlIGludGVyc2VjdGlvbiBvciA8Y29kZT51bmRlZmluZWQ8L2NvZGU+IGlmIG5vbmUgd2FzIGZvdW5kLlxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBmaW5kIGludGVyc2VjdGlvbiBvZiByYXkgdGhyb3VnaCBhIHBpeGVsIGFuZCB0aGUgZ2xvYmVcbiAqIHZhciByYXkgPSB2aWV3ZXIuY2FtZXJhLmdldFBpY2tSYXkod2luZG93Q29vcmRpbmF0ZXMpO1xuICogdmFyIGludGVyc2VjdGlvbiA9IGdsb2JlLnBpY2socmF5LCBzY2VuZSk7XG4gKi9cbkdsb2JlLnByb3RvdHlwZS5waWNrID0gZnVuY3Rpb24gKHJheSwgc2NlbmUsIHJlc3VsdCkge1xuICByZXN1bHQgPSB0aGlzLnBpY2tXb3JsZENvb3JkaW5hdGVzKHJheSwgc2NlbmUsIHRydWUsIHJlc3VsdCk7XG4gIGlmIChkZWZpbmVkKHJlc3VsdCkgJiYgc2NlbmUubW9kZSAhPT0gU2NlbmVNb2RlLlNDRU5FM0QpIHtcbiAgICByZXN1bHQgPSBDYXJ0ZXNpYW4zLmZyb21FbGVtZW50cyhyZXN1bHQueSwgcmVzdWx0LnosIHJlc3VsdC54LCByZXN1bHQpO1xuICAgIHZhciBjYXJ0byA9IHNjZW5lLm1hcFByb2plY3Rpb24udW5wcm9qZWN0KHJlc3VsdCwgY2FydG9TY3JhdGNoKTtcbiAgICByZXN1bHQgPSBzY2VuZS5nbG9iZS5lbGxpcHNvaWQuY2FydG9ncmFwaGljVG9DYXJ0ZXNpYW4oY2FydG8sIHJlc3VsdCk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufTtcblxudmFyIHNjcmF0Y2hHZXRIZWlnaHRDYXJ0ZXNpYW4gPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHNjcmF0Y2hHZXRIZWlnaHRJbnRlcnNlY3Rpb24gPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHNjcmF0Y2hHZXRIZWlnaHRDYXJ0b2dyYXBoaWMgPSBuZXcgQ2FydG9ncmFwaGljKCk7XG52YXIgc2NyYXRjaEdldEhlaWdodFJheSA9IG5ldyBSYXkoKTtcblxuZnVuY3Rpb24gdGlsZUlmQ29udGFpbnNDYXJ0b2dyYXBoaWModGlsZSwgY2FydG9ncmFwaGljKSB7XG4gIHJldHVybiBkZWZpbmVkKHRpbGUpICYmIFJlY3RhbmdsZS5jb250YWlucyh0aWxlLnJlY3RhbmdsZSwgY2FydG9ncmFwaGljKVxuICAgID8gdGlsZVxuICAgIDogdW5kZWZpbmVkO1xufVxuXG4vKipcbiAqIEdldCB0aGUgaGVpZ2h0IG9mIHRoZSBzdXJmYWNlIGF0IGEgZ2l2ZW4gY2FydG9ncmFwaGljLlxuICpcbiAqIEBwYXJhbSB7Q2FydG9ncmFwaGljfSBjYXJ0b2dyYXBoaWMgVGhlIGNhcnRvZ3JhcGhpYyBmb3Igd2hpY2ggdG8gZmluZCB0aGUgaGVpZ2h0LlxuICogQHJldHVybnMge051bWJlcnx1bmRlZmluZWR9IFRoZSBoZWlnaHQgb2YgdGhlIGNhcnRvZ3JhcGhpYyBvciB1bmRlZmluZWQgaWYgaXQgY291bGQgbm90IGJlIGZvdW5kLlxuICovXG5HbG9iZS5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKGNhcnRvZ3JhcGhpYykge1xuICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICBpZiAoIWRlZmluZWQoY2FydG9ncmFwaGljKSkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcImNhcnRvZ3JhcGhpYyBpcyByZXF1aXJlZFwiKTtcbiAgfVxuICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcblxuICB2YXIgbGV2ZWxaZXJvVGlsZXMgPSB0aGlzLl9zdXJmYWNlLl9sZXZlbFplcm9UaWxlcztcbiAgaWYgKCFkZWZpbmVkKGxldmVsWmVyb1RpbGVzKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciB0aWxlO1xuICB2YXIgaTtcblxuICB2YXIgbGVuZ3RoID0gbGV2ZWxaZXJvVGlsZXMubGVuZ3RoO1xuICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICB0aWxlID0gbGV2ZWxaZXJvVGlsZXNbaV07XG4gICAgaWYgKFJlY3RhbmdsZS5jb250YWlucyh0aWxlLnJlY3RhbmdsZSwgY2FydG9ncmFwaGljKSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgaWYgKGkgPj0gbGVuZ3RoKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHZhciB0aWxlV2l0aE1lc2ggPSB0aWxlO1xuXG4gIHdoaWxlIChkZWZpbmVkKHRpbGUpKSB7XG4gICAgdGlsZSA9XG4gICAgICB0aWxlSWZDb250YWluc0NhcnRvZ3JhcGhpYyh0aWxlLl9zb3V0aHdlc3RDaGlsZCwgY2FydG9ncmFwaGljKSB8fFxuICAgICAgdGlsZUlmQ29udGFpbnNDYXJ0b2dyYXBoaWModGlsZS5fc291dGhlYXN0Q2hpbGQsIGNhcnRvZ3JhcGhpYykgfHxcbiAgICAgIHRpbGVJZkNvbnRhaW5zQ2FydG9ncmFwaGljKHRpbGUuX25vcnRod2VzdENoaWxkLCBjYXJ0b2dyYXBoaWMpIHx8XG4gICAgICB0aWxlLl9ub3J0aGVhc3RDaGlsZDtcblxuICAgIGlmIChcbiAgICAgIGRlZmluZWQodGlsZSkgJiZcbiAgICAgIGRlZmluZWQodGlsZS5kYXRhKSAmJlxuICAgICAgZGVmaW5lZCh0aWxlLmRhdGEucmVuZGVyZWRNZXNoKVxuICAgICkge1xuICAgICAgdGlsZVdpdGhNZXNoID0gdGlsZTtcbiAgICB9XG4gIH1cblxuICB0aWxlID0gdGlsZVdpdGhNZXNoO1xuXG4gIC8vIFRoaXMgdGlsZSB3YXMgZWl0aGVyIHJlbmRlcmVkIG9yIGN1bGxlZC5cbiAgLy8gSXQgaXMgc29tZXRpbWVzIHVzZWZ1bCB0byBnZXQgYSBoZWlnaHQgZnJvbSBhIGN1bGxlZCB0aWxlLFxuICAvLyBlLmcuIHdoZW4gd2UncmUgZ2V0dGluZyBhIGhlaWdodCBpbiBvcmRlciB0byBwbGFjZSBhIGJpbGxib2FyZFxuICAvLyBvbiB0ZXJyYWluLCBhbmQgdGhlIGNhbWVyYSBpcyBsb29raW5nIGF0IHRoYXQgc2FtZSBiaWxsYm9hcmQuXG4gIC8vIFRoZSBjdWxsZWQgdGlsZSBtdXN0IGhhdmUgYSB2YWxpZCBtZXNoLCB0aG91Z2guXG4gIGlmIChcbiAgICAhZGVmaW5lZCh0aWxlKSB8fFxuICAgICFkZWZpbmVkKHRpbGUuZGF0YSkgfHxcbiAgICAhZGVmaW5lZCh0aWxlLmRhdGEucmVuZGVyZWRNZXNoKVxuICApIHtcbiAgICAvLyBUaWxlIHdhcyBub3QgcmVuZGVyZWQgKGN1bGxlZCkuXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHZhciBwcm9qZWN0aW9uID0gdGhpcy5fc3VyZmFjZS5fdGlsZVByb3ZpZGVyLnRpbGluZ1NjaGVtZS5wcm9qZWN0aW9uO1xuICB2YXIgZWxsaXBzb2lkID0gdGhpcy5fc3VyZmFjZS5fdGlsZVByb3ZpZGVyLnRpbGluZ1NjaGVtZS5lbGxpcHNvaWQ7XG5cbiAgLy9jYXJ0ZXNpYW4gaGFzIHRvIGJlIG9uIHRoZSBlbGxpcHNvaWQgc3VyZmFjZSBmb3IgYGVsbGlwc29pZC5nZW9kZXRpY1N1cmZhY2VOb3JtYWxgXG4gIHZhciBjYXJ0ZXNpYW4gPSBDYXJ0ZXNpYW4zLmZyb21SYWRpYW5zKFxuICAgIGNhcnRvZ3JhcGhpYy5sb25naXR1ZGUsXG4gICAgY2FydG9ncmFwaGljLmxhdGl0dWRlLFxuICAgIDAuMCxcbiAgICBlbGxpcHNvaWQsXG4gICAgc2NyYXRjaEdldEhlaWdodENhcnRlc2lhblxuICApO1xuXG4gIHZhciByYXkgPSBzY3JhdGNoR2V0SGVpZ2h0UmF5O1xuICB2YXIgc3VyZmFjZU5vcm1hbCA9IGVsbGlwc29pZC5nZW9kZXRpY1N1cmZhY2VOb3JtYWwoY2FydGVzaWFuLCByYXkuZGlyZWN0aW9uKTtcblxuICAvLyBUcnkgdG8gZmluZCB0aGUgaW50ZXJzZWN0aW9uIHBvaW50IGJldHdlZW4gdGhlIHN1cmZhY2Ugbm9ybWFsIGFuZCB6LWF4aXMuXG4gIC8vIG1pbmltdW0gaGVpZ2h0ICgtMTE1MDAuMCkgZm9yIHRoZSB0ZXJyYWluIHNldCwgbmVlZCB0byBnZXQgdGhpcyBpbmZvcm1hdGlvbiBmcm9tIHRoZSB0ZXJyYWluIHByb3ZpZGVyXG4gIHZhciByYXlPcmlnaW4gPSBlbGxpcHNvaWQuZ2V0U3VyZmFjZU5vcm1hbEludGVyc2VjdGlvbldpdGhaQXhpcyhcbiAgICBjYXJ0ZXNpYW4sXG4gICAgMTE1MDAuMCxcbiAgICByYXkub3JpZ2luXG4gICk7XG5cbiAgLy8gVGhlb3JldGljYWxseSwgbm90IHdpdGggRWFydGggZGF0dW1zLCB0aGUgaW50ZXJzZWN0aW9uIHBvaW50IGNhbiBiZSBvdXRzaWRlIHRoZSBlbGxpcHNvaWRcbiAgaWYgKCFkZWZpbmVkKHJheU9yaWdpbikpIHtcbiAgICAvLyBpbnRlcnNlY3Rpb24gcG9pbnQgaXMgb3V0c2lkZSB0aGUgZWxsaXBzb2lkLCB0cnkgb3RoZXIgdmFsdWVcbiAgICAvLyBtaW5pbXVtIGhlaWdodCAoLTExNTAwLjApIGZvciB0aGUgdGVycmFpbiBzZXQsIG5lZWQgdG8gZ2V0IHRoaXMgaW5mb3JtYXRpb24gZnJvbSB0aGUgdGVycmFpbiBwcm92aWRlclxuICAgIHZhciBtaW5pbXVtSGVpZ2h0O1xuICAgIGlmIChkZWZpbmVkKHRpbGUuZGF0YS50aWxlQm91bmRpbmdSZWdpb24pKSB7XG4gICAgICBtaW5pbXVtSGVpZ2h0ID0gdGlsZS5kYXRhLnRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0O1xuICAgIH1cbiAgICB2YXIgbWFnbml0dWRlID0gTWF0aC5taW4oZGVmYXVsdFZhbHVlKG1pbmltdW1IZWlnaHQsIDAuMCksIC0xMTUwMC4wKTtcblxuICAgIC8vIG11bHRpcGx5IGJ5IHRoZSAqcG9zaXRpdmUqIHZhbHVlIG9mIHRoZSBtYWduaXR1ZGVcbiAgICB2YXIgdmVjdG9yVG9NaW5pbXVtUG9pbnQgPSBDYXJ0ZXNpYW4zLm11bHRpcGx5QnlTY2FsYXIoXG4gICAgICBzdXJmYWNlTm9ybWFsLFxuICAgICAgTWF0aC5hYnMobWFnbml0dWRlKSArIDEsXG4gICAgICBzY3JhdGNoR2V0SGVpZ2h0SW50ZXJzZWN0aW9uXG4gICAgKTtcbiAgICBDYXJ0ZXNpYW4zLnN1YnRyYWN0KGNhcnRlc2lhbiwgdmVjdG9yVG9NaW5pbXVtUG9pbnQsIHJheS5vcmlnaW4pO1xuICB9XG5cbiAgdmFyIGludGVyc2VjdGlvbiA9IHRpbGUuZGF0YS5waWNrKFxuICAgIHJheSxcbiAgICB1bmRlZmluZWQsXG4gICAgcHJvamVjdGlvbixcbiAgICBmYWxzZSxcbiAgICBzY3JhdGNoR2V0SGVpZ2h0SW50ZXJzZWN0aW9uXG4gICk7XG4gIGlmICghZGVmaW5lZChpbnRlcnNlY3Rpb24pKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHJldHVybiBlbGxpcHNvaWQuY2FydGVzaWFuVG9DYXJ0b2dyYXBoaWMoXG4gICAgaW50ZXJzZWN0aW9uLFxuICAgIHNjcmF0Y2hHZXRIZWlnaHRDYXJ0b2dyYXBoaWNcbiAgKS5oZWlnaHQ7XG59O1xuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbkdsb2JlLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZnJhbWVTdGF0ZSkge1xuICBpZiAoIXRoaXMuc2hvdykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChmcmFtZVN0YXRlLnBhc3Nlcy5yZW5kZXIpIHtcbiAgICB0aGlzLl9zdXJmYWNlLnVwZGF0ZShmcmFtZVN0YXRlKTtcbiAgfVxufTtcblxuLyoqXG4gKiBAcHJpdmF0ZVxuICovXG5HbG9iZS5wcm90b3R5cGUuYmVnaW5GcmFtZSA9IGZ1bmN0aW9uIChmcmFtZVN0YXRlKSB7XG4gIHZhciBzdXJmYWNlID0gdGhpcy5fc3VyZmFjZTtcbiAgdmFyIHRpbGVQcm92aWRlciA9IHN1cmZhY2UudGlsZVByb3ZpZGVyO1xuICB2YXIgdGVycmFpblByb3ZpZGVyID0gdGhpcy50ZXJyYWluUHJvdmlkZXI7XG4gIHZhciBoYXNXYXRlck1hc2sgPVxuICAgIHRoaXMuc2hvd1dhdGVyRWZmZWN0ICYmXG4gICAgdGVycmFpblByb3ZpZGVyLnJlYWR5ICYmXG4gICAgdGVycmFpblByb3ZpZGVyLmhhc1dhdGVyTWFzaztcblxuICBpZiAoaGFzV2F0ZXJNYXNrICYmIHRoaXMuX29jZWFuTm9ybWFsTWFwUmVzb3VyY2VEaXJ0eSkge1xuICAgIC8vIHVybCBjaGFuZ2VkLCBsb2FkIG5ldyBub3JtYWwgbWFwIGFzeW5jaHJvbm91c2x5XG4gICAgdGhpcy5fb2NlYW5Ob3JtYWxNYXBSZXNvdXJjZURpcnR5ID0gZmFsc2U7XG4gICAgdmFyIG9jZWFuTm9ybWFsTWFwUmVzb3VyY2UgPSB0aGlzLl9vY2Vhbk5vcm1hbE1hcFJlc291cmNlO1xuICAgIHZhciBvY2Vhbk5vcm1hbE1hcFVybCA9IG9jZWFuTm9ybWFsTWFwUmVzb3VyY2UudXJsO1xuICAgIGlmIChkZWZpbmVkKG9jZWFuTm9ybWFsTWFwVXJsKSkge1xuICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgd2hlbihvY2Vhbk5vcm1hbE1hcFJlc291cmNlLmZldGNoSW1hZ2UoKSwgZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICAgIGlmIChvY2Vhbk5vcm1hbE1hcFVybCAhPT0gdGhhdC5fb2NlYW5Ob3JtYWxNYXBSZXNvdXJjZS51cmwpIHtcbiAgICAgICAgICAvLyB1cmwgY2hhbmdlZCB3aGlsZSB3ZSB3ZXJlIGxvYWRpbmdcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGF0Ll9vY2Vhbk5vcm1hbE1hcCA9XG4gICAgICAgICAgdGhhdC5fb2NlYW5Ob3JtYWxNYXAgJiYgdGhhdC5fb2NlYW5Ob3JtYWxNYXAuZGVzdHJveSgpO1xuICAgICAgICB0aGF0Ll9vY2Vhbk5vcm1hbE1hcCA9IG5ldyBUZXh0dXJlKHtcbiAgICAgICAgICBjb250ZXh0OiBmcmFtZVN0YXRlLmNvbnRleHQsXG4gICAgICAgICAgc291cmNlOiBpbWFnZSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fb2NlYW5Ob3JtYWxNYXAgPVxuICAgICAgICB0aGlzLl9vY2Vhbk5vcm1hbE1hcCAmJiB0aGlzLl9vY2Vhbk5vcm1hbE1hcC5kZXN0cm95KCk7XG4gICAgfVxuICB9XG5cbiAgdmFyIHBhc3MgPSBmcmFtZVN0YXRlLnBhc3NlcztcbiAgdmFyIG1vZGUgPSBmcmFtZVN0YXRlLm1vZGU7XG5cbiAgaWYgKHBhc3MucmVuZGVyKSB7XG4gICAgaWYgKHRoaXMuc2hvd0dyb3VuZEF0bW9zcGhlcmUpIHtcbiAgICAgIHRoaXMuX3pvb21lZE91dE9jZWFuU3BlY3VsYXJJbnRlbnNpdHkgPSAwLjQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3pvb21lZE91dE9jZWFuU3BlY3VsYXJJbnRlbnNpdHkgPSAwLjU7XG4gICAgfVxuXG4gICAgc3VyZmFjZS5tYXhpbXVtU2NyZWVuU3BhY2VFcnJvciA9IHRoaXMubWF4aW11bVNjcmVlblNwYWNlRXJyb3I7XG4gICAgc3VyZmFjZS50aWxlQ2FjaGVTaXplID0gdGhpcy50aWxlQ2FjaGVTaXplO1xuICAgIHN1cmZhY2UubG9hZGluZ0Rlc2NlbmRhbnRMaW1pdCA9IHRoaXMubG9hZGluZ0Rlc2NlbmRhbnRMaW1pdDtcbiAgICBzdXJmYWNlLnByZWxvYWRBbmNlc3RvcnMgPSB0aGlzLnByZWxvYWRBbmNlc3RvcnM7XG4gICAgc3VyZmFjZS5wcmVsb2FkU2libGluZ3MgPSB0aGlzLnByZWxvYWRTaWJsaW5ncztcblxuICAgIHRpbGVQcm92aWRlci50ZXJyYWluUHJvdmlkZXIgPSB0aGlzLnRlcnJhaW5Qcm92aWRlcjtcbiAgICB0aWxlUHJvdmlkZXIubGlnaHRpbmdGYWRlT3V0RGlzdGFuY2UgPSB0aGlzLmxpZ2h0aW5nRmFkZU91dERpc3RhbmNlO1xuICAgIHRpbGVQcm92aWRlci5saWdodGluZ0ZhZGVJbkRpc3RhbmNlID0gdGhpcy5saWdodGluZ0ZhZGVJbkRpc3RhbmNlO1xuICAgIHRpbGVQcm92aWRlci5uaWdodEZhZGVPdXREaXN0YW5jZSA9IHRoaXMubmlnaHRGYWRlT3V0RGlzdGFuY2U7XG4gICAgdGlsZVByb3ZpZGVyLm5pZ2h0RmFkZUluRGlzdGFuY2UgPSB0aGlzLm5pZ2h0RmFkZUluRGlzdGFuY2U7XG4gICAgdGlsZVByb3ZpZGVyLnpvb21lZE91dE9jZWFuU3BlY3VsYXJJbnRlbnNpdHkgPVxuICAgICAgbW9kZSA9PT0gU2NlbmVNb2RlLlNDRU5FM0QgPyB0aGlzLl96b29tZWRPdXRPY2VhblNwZWN1bGFySW50ZW5zaXR5IDogMC4wO1xuICAgIHRpbGVQcm92aWRlci5oYXNXYXRlck1hc2sgPSBoYXNXYXRlck1hc2s7XG4gICAgdGlsZVByb3ZpZGVyLm9jZWFuTm9ybWFsTWFwID0gdGhpcy5fb2NlYW5Ob3JtYWxNYXA7XG4gICAgdGlsZVByb3ZpZGVyLmVuYWJsZUxpZ2h0aW5nID0gdGhpcy5lbmFibGVMaWdodGluZztcbiAgICB0aWxlUHJvdmlkZXIuZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZyA9IHRoaXMuZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZztcbiAgICB0aWxlUHJvdmlkZXIuZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZ0Zyb21TdW4gPSB0aGlzLmR5bmFtaWNBdG1vc3BoZXJlTGlnaHRpbmdGcm9tU3VuO1xuICAgIHRpbGVQcm92aWRlci5zaG93R3JvdW5kQXRtb3NwaGVyZSA9IHRoaXMuc2hvd0dyb3VuZEF0bW9zcGhlcmU7XG4gICAgdGlsZVByb3ZpZGVyLnNoYWRvd3MgPSB0aGlzLnNoYWRvd3M7XG4gICAgdGlsZVByb3ZpZGVyLmh1ZVNoaWZ0ID0gdGhpcy5hdG1vc3BoZXJlSHVlU2hpZnQ7XG4gICAgdGlsZVByb3ZpZGVyLnNhdHVyYXRpb25TaGlmdCA9IHRoaXMuYXRtb3NwaGVyZVNhdHVyYXRpb25TaGlmdDtcbiAgICB0aWxlUHJvdmlkZXIuYnJpZ2h0bmVzc1NoaWZ0ID0gdGhpcy5hdG1vc3BoZXJlQnJpZ2h0bmVzc1NoaWZ0O1xuICAgIHRpbGVQcm92aWRlci5maWxsSGlnaGxpZ2h0Q29sb3IgPSB0aGlzLmZpbGxIaWdobGlnaHRDb2xvcjtcbiAgICB0aWxlUHJvdmlkZXIuc2hvd1NraXJ0cyA9IHRoaXMuc2hvd1NraXJ0cztcbiAgICB0aWxlUHJvdmlkZXIuYmFja0ZhY2VDdWxsaW5nID0gdGhpcy5iYWNrRmFjZUN1bGxpbmc7XG4gICAgdGlsZVByb3ZpZGVyLnVuZGVyZ3JvdW5kQ29sb3IgPSB0aGlzLl91bmRlcmdyb3VuZENvbG9yO1xuICAgIHRpbGVQcm92aWRlci51bmRlcmdyb3VuZENvbG9yQWxwaGFCeURpc3RhbmNlID0gdGhpcy5fdW5kZXJncm91bmRDb2xvckFscGhhQnlEaXN0YW5jZTtcbiAgICBzdXJmYWNlLmJlZ2luRnJhbWUoZnJhbWVTdGF0ZSk7XG4gIH1cbn07XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuR2xvYmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChmcmFtZVN0YXRlKSB7XG4gIGlmICghdGhpcy5zaG93KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGRlZmluZWQodGhpcy5fbWF0ZXJpYWwpKSB7XG4gICAgdGhpcy5fbWF0ZXJpYWwudXBkYXRlKGZyYW1lU3RhdGUuY29udGV4dCk7XG4gIH1cblxuICB0aGlzLl9zdXJmYWNlLnJlbmRlcihmcmFtZVN0YXRlKTtcbn07XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuR2xvYmUucHJvdG90eXBlLmVuZEZyYW1lID0gZnVuY3Rpb24gKGZyYW1lU3RhdGUpIHtcbiAgaWYgKCF0aGlzLnNob3cpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoZnJhbWVTdGF0ZS5wYXNzZXMucmVuZGVyKSB7XG4gICAgdGhpcy5fc3VyZmFjZS5lbmRGcmFtZShmcmFtZVN0YXRlKTtcbiAgfVxufTtcblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZDsgb3RoZXJ3aXNlLCBmYWxzZS5cbiAqIDxiciAvPjxiciAvPlxuICogSWYgdGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZCwgaXQgc2hvdWxkIG5vdCBiZSB1c2VkOyBjYWxsaW5nIGFueSBmdW5jdGlvbiBvdGhlciB0aGFuXG4gKiA8Y29kZT5pc0Rlc3Ryb3llZDwvY29kZT4gd2lsbCByZXN1bHQgaW4gYSB7QGxpbmsgRGV2ZWxvcGVyRXJyb3J9IGV4Y2VwdGlvbi5cbiAqXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGlzIG9iamVjdCB3YXMgZGVzdHJveWVkOyBvdGhlcndpc2UsIGZhbHNlLlxuICpcbiAqIEBzZWUgR2xvYmUjZGVzdHJveVxuICovXG5HbG9iZS5wcm90b3R5cGUuaXNEZXN0cm95ZWQgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8qKlxuICogRGVzdHJveXMgdGhlIFdlYkdMIHJlc291cmNlcyBoZWxkIGJ5IHRoaXMgb2JqZWN0LiAgRGVzdHJveWluZyBhbiBvYmplY3QgYWxsb3dzIGZvciBkZXRlcm1pbmlzdGljXG4gKiByZWxlYXNlIG9mIFdlYkdMIHJlc291cmNlcywgaW5zdGVhZCBvZiByZWx5aW5nIG9uIHRoZSBnYXJiYWdlIGNvbGxlY3RvciB0byBkZXN0cm95IHRoaXMgb2JqZWN0LlxuICogPGJyIC8+PGJyIC8+XG4gKiBPbmNlIGFuIG9iamVjdCBpcyBkZXN0cm95ZWQsIGl0IHNob3VsZCBub3QgYmUgdXNlZDsgY2FsbGluZyBhbnkgZnVuY3Rpb24gb3RoZXIgdGhhblxuICogPGNvZGU+aXNEZXN0cm95ZWQ8L2NvZGU+IHdpbGwgcmVzdWx0IGluIGEge0BsaW5rIERldmVsb3BlckVycm9yfSBleGNlcHRpb24uICBUaGVyZWZvcmUsXG4gKiBhc3NpZ24gdGhlIHJldHVybiB2YWx1ZSAoPGNvZGU+dW5kZWZpbmVkPC9jb2RlPikgdG8gdGhlIG9iamVjdCBhcyBkb25lIGluIHRoZSBleGFtcGxlLlxuICpcbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBUaGlzIG9iamVjdCB3YXMgZGVzdHJveWVkLCBpLmUuLCBkZXN0cm95KCkgd2FzIGNhbGxlZC5cbiAqXG4gKlxuICogQGV4YW1wbGVcbiAqIGdsb2JlID0gZ2xvYmUgJiYgZ2xvYmUuZGVzdHJveSgpO1xuICpcbiAqIEBzZWUgR2xvYmUjaXNEZXN0cm95ZWRcbiAqL1xuR2xvYmUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuX3N1cmZhY2VTaGFkZXJTZXQgPVxuICAgIHRoaXMuX3N1cmZhY2VTaGFkZXJTZXQgJiYgdGhpcy5fc3VyZmFjZVNoYWRlclNldC5kZXN0cm95KCk7XG4gIHRoaXMuX3N1cmZhY2UgPSB0aGlzLl9zdXJmYWNlICYmIHRoaXMuX3N1cmZhY2UuZGVzdHJveSgpO1xuICB0aGlzLl9vY2Vhbk5vcm1hbE1hcCA9IHRoaXMuX29jZWFuTm9ybWFsTWFwICYmIHRoaXMuX29jZWFuTm9ybWFsTWFwLmRlc3Ryb3koKTtcbiAgcmV0dXJuIGRlc3Ryb3lPYmplY3QodGhpcyk7XG59O1xuZXhwb3J0IGRlZmF1bHQgR2xvYmU7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///87717\n')},55977:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(88108);\n/* harmony import */ var _Core_Color_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(59947);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(82982);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(86511);\n/* harmony import */ var _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(38443);\n/* harmony import */ var _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(39899);\n/* harmony import */ var _Renderer_Framebuffer_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(2932);\n/* harmony import */ var _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(21572);\n/* harmony import */ var _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(10667);\n/* harmony import */ var _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(87721);\n/* harmony import */ var _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(53642);\n/* harmony import */ var _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(8743);\n/* harmony import */ var _Shaders_PostProcessStages_PassThrough_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(7571);\n/* harmony import */ var _Shaders_PostProcessStages_PassThroughDepth_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(82239);\n/* harmony import */ var _BlendingState_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(13633);\n/* harmony import */ var _StencilConstants_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(87233);\n/* harmony import */ var _StencilFunction_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(77053);\n/* harmony import */ var _StencilOperation_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(81255);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * @private\n */\nfunction GlobeDepth() {\n  this._globeColorTexture = undefined;\n  this._primitiveColorTexture = undefined;\n  this._depthStencilTexture = undefined;\n  this._globeDepthTexture = undefined;\n  this._tempGlobeDepthTexture = undefined;\n  this._tempCopyDepthTexture = undefined;\n\n  this._globeColorFramebuffer = undefined;\n  this._primitiveColorFramebuffer = undefined;\n  this._copyDepthFramebuffer = undefined;\n  this._tempCopyDepthFramebuffer = undefined;\n  this._updateDepthFramebuffer = undefined;\n\n  this._clearGlobeColorCommand = undefined;\n  this._clearPrimitiveColorCommand = undefined;\n  this._copyColorCommand = undefined;\n  this._copyDepthCommand = undefined;\n  this._tempCopyDepthCommand = undefined;\n  this._updateDepthCommand = undefined;\n  this._mergeColorCommand = undefined;\n\n  this._viewport = new _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n  this._rs = undefined;\n  this._rsBlend = undefined;\n  this._rsUpdate = undefined;\n\n  this._useScissorTest = false;\n  this._scissorRectangle = undefined;\n\n  this._useLogDepth = undefined;\n  this._useHdr = undefined;\n  this._clearGlobeDepth = undefined;\n\n  this._debugGlobeDepthViewportCommand = undefined;\n}\n\nObject.defineProperties(GlobeDepth.prototype, {\n  framebuffer: {\n    get: function () {\n      return this._globeColorFramebuffer;\n    },\n  },\n  primitiveFramebuffer: {\n    get: function () {\n      return this._primitiveColorFramebuffer;\n    },\n  },\n});\n\nfunction executeDebugGlobeDepth(globeDepth, context, passState, useLogDepth) {\n  if (\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(globeDepth._debugGlobeDepthViewportCommand) ||\n    useLogDepth !== globeDepth._useLogDepth\n  ) {\n    var fsSource =\n      "uniform highp sampler2D u_depthTexture;\\n" +\n      "varying vec2 v_textureCoordinates;\\n" +\n      "void main()\\n" +\n      "{\\n" +\n      "    float z_window = czm_unpackDepth(texture2D(u_depthTexture, v_textureCoordinates));\\n" +\n      "    z_window = czm_reverseLogDepth(z_window); \\n" +\n      "    float n_range = czm_depthRange.near;\\n" +\n      "    float f_range = czm_depthRange.far;\\n" +\n      "    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\\n" +\n      "    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\\n" +\n      "    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\\n" +\n      "}\\n";\n    var fs = new _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z({\n      defines: [useLogDepth ? "LOG_DEPTH" : ""],\n      sources: [fsSource],\n    });\n\n    globeDepth._debugGlobeDepthViewportCommand = context.createViewportQuadCommand(\n      fs,\n      {\n        uniformMap: {\n          u_depthTexture: function () {\n            return globeDepth._globeDepthTexture;\n          },\n        },\n        owner: globeDepth,\n      }\n    );\n\n    globeDepth._useLogDepth = useLogDepth;\n  }\n\n  globeDepth._debugGlobeDepthViewportCommand.execute(context, passState);\n}\n\nfunction destroyTextures(globeDepth) {\n  globeDepth._globeColorTexture =\n    globeDepth._globeColorTexture &&\n    !globeDepth._globeColorTexture.isDestroyed() &&\n    globeDepth._globeColorTexture.destroy();\n  globeDepth._depthStencilTexture =\n    globeDepth._depthStencilTexture &&\n    !globeDepth._depthStencilTexture.isDestroyed() &&\n    globeDepth._depthStencilTexture.destroy();\n  globeDepth._globeDepthTexture =\n    globeDepth._globeDepthTexture &&\n    !globeDepth._globeDepthTexture.isDestroyed() &&\n    globeDepth._globeDepthTexture.destroy();\n}\n\nfunction destroyFramebuffers(globeDepth) {\n  globeDepth._globeColorFramebuffer =\n    globeDepth._globeColorFramebuffer &&\n    !globeDepth._globeColorFramebuffer.isDestroyed() &&\n    globeDepth._globeColorFramebuffer.destroy();\n  globeDepth._copyDepthFramebuffer =\n    globeDepth._copyDepthFramebuffer &&\n    !globeDepth._copyDepthFramebuffer.isDestroyed() &&\n    globeDepth._copyDepthFramebuffer.destroy();\n}\n\nfunction destroyUpdateDepthResources(globeDepth) {\n  globeDepth._tempCopyDepthFramebuffer =\n    globeDepth._tempCopyDepthFramebuffer &&\n    !globeDepth._tempCopyDepthFramebuffer.isDestroyed() &&\n    globeDepth._tempCopyDepthFramebuffer.destroy();\n  globeDepth._updateDepthFramebuffer =\n    globeDepth._updateDepthFramebuffer &&\n    !globeDepth._updateDepthFramebuffer.isDestroyed() &&\n    globeDepth._updateDepthFramebuffer.destroy();\n  globeDepth._tempGlobeDepthTexture =\n    globeDepth._tempGlobeDepthTexture &&\n    !globeDepth._tempGlobeDepthTexture.isDestroyed() &&\n    globeDepth._tempGlobeDepthTexture.destroy();\n}\n\nfunction createUpdateDepthResources(\n  globeDepth,\n  context,\n  width,\n  height,\n  passState\n) {\n  globeDepth._tempGlobeDepthTexture = new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].RGBA */ .Z.RGBA,\n    pixelDatatype: _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE,\n    sampler: _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].NEAREST */ .Z.NEAREST,\n  });\n  globeDepth._tempCopyDepthFramebuffer = new _Renderer_Framebuffer_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z({\n    context: context,\n    colorTextures: [globeDepth._tempGlobeDepthTexture],\n    destroyAttachments: false,\n  });\n  globeDepth._updateDepthFramebuffer = new _Renderer_Framebuffer_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z({\n    context: context,\n    colorTextures: [globeDepth._globeDepthTexture],\n    depthStencilTexture: passState.framebuffer.depthStencilTexture,\n    destroyAttachments: false,\n  });\n}\n\nfunction createTextures(globeDepth, context, width, height, hdr) {\n  var pixelDatatype = hdr\n    ? context.halfFloatingPointTexture\n      ? _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].HALF_FLOAT */ .Z.HALF_FLOAT\n      : _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT\n    : _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE;\n  globeDepth._globeColorTexture = new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].RGBA */ .Z.RGBA,\n    pixelDatatype: pixelDatatype,\n    sampler: _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].NEAREST */ .Z.NEAREST,\n  });\n\n  globeDepth._depthStencilTexture = new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].DEPTH_STENCIL */ .Z.DEPTH_STENCIL,\n    pixelDatatype: _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].UNSIGNED_INT_24_8 */ .Z.UNSIGNED_INT_24_8,\n  });\n\n  globeDepth._globeDepthTexture = new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].RGBA */ .Z.RGBA,\n    pixelDatatype: _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE,\n    sampler: _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].NEAREST */ .Z.NEAREST,\n  });\n}\n\nfunction createFramebuffers(globeDepth, context) {\n  globeDepth._globeColorFramebuffer = new _Renderer_Framebuffer_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z({\n    context: context,\n    colorTextures: [globeDepth._globeColorTexture],\n    depthStencilTexture: globeDepth._depthStencilTexture,\n    destroyAttachments: false,\n  });\n\n  globeDepth._copyDepthFramebuffer = new _Renderer_Framebuffer_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z({\n    context: context,\n    colorTextures: [globeDepth._globeDepthTexture],\n    destroyAttachments: false,\n  });\n}\n\nfunction createPrimitiveFramebuffer(globeDepth, context, width, height, hdr) {\n  var pixelDatatype = hdr\n    ? context.halfFloatingPointTexture\n      ? _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].HALF_FLOAT */ .Z.HALF_FLOAT\n      : _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT\n    : _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE;\n  globeDepth._primitiveColorTexture = new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].RGBA */ .Z.RGBA,\n    pixelDatatype: pixelDatatype,\n    sampler: _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].NEAREST */ .Z.NEAREST,\n  });\n\n  globeDepth._primitiveColorFramebuffer = new _Renderer_Framebuffer_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z({\n    context: context,\n    colorTextures: [globeDepth._primitiveColorTexture],\n    depthStencilTexture: globeDepth._depthStencilTexture,\n    destroyAttachments: false,\n  });\n}\n\nfunction destroyPrimitiveFramebuffer(globeDepth) {\n  globeDepth._primitiveColorTexture =\n    globeDepth._primitiveColorTexture &&\n    !globeDepth._primitiveColorTexture.isDestroyed() &&\n    globeDepth._primitiveColorTexture.destroy();\n  globeDepth._primitiveColorFramebuffer =\n    globeDepth._primitiveColorFramebuffer &&\n    !globeDepth._primitiveColorFramebuffer.isDestroyed() &&\n    globeDepth._primitiveColorFramebuffer.destroy();\n}\n\nfunction updateFramebuffers(\n  globeDepth,\n  context,\n  width,\n  height,\n  hdr,\n  clearGlobeDepth\n) {\n  var colorTexture = globeDepth._globeColorTexture;\n  var textureChanged =\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(colorTexture) ||\n    colorTexture.width !== width ||\n    colorTexture.height !== height ||\n    hdr !== globeDepth._useHdr;\n  if (textureChanged) {\n    destroyTextures(globeDepth);\n    destroyFramebuffers(globeDepth);\n    createTextures(globeDepth, context, width, height, hdr, clearGlobeDepth);\n    createFramebuffers(globeDepth, context, clearGlobeDepth);\n  }\n\n  if (textureChanged || clearGlobeDepth !== globeDepth._clearGlobeDepth) {\n    destroyPrimitiveFramebuffer(globeDepth);\n    if (clearGlobeDepth) {\n      createPrimitiveFramebuffer(globeDepth, context, width, height, hdr);\n    }\n  }\n}\n\nfunction updateCopyCommands(globeDepth, context, width, height, passState) {\n  globeDepth._viewport.width = width;\n  globeDepth._viewport.height = height;\n\n  var useScissorTest = !_Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(\n    globeDepth._viewport,\n    passState.viewport\n  );\n  var updateScissor = useScissorTest !== globeDepth._useScissorTest;\n  globeDepth._useScissorTest = useScissorTest;\n\n  if (\n    !_Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(globeDepth._scissorRectangle, passState.viewport)\n  ) {\n    globeDepth._scissorRectangle = _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(\n      passState.viewport,\n      globeDepth._scissorRectangle\n    );\n    updateScissor = true;\n  }\n\n  if (\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(globeDepth._rs) ||\n    !_Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(globeDepth._viewport, globeDepth._rs.viewport) ||\n    updateScissor\n  ) {\n    globeDepth._rs = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].fromCache */ .Z.fromCache({\n      viewport: globeDepth._viewport,\n      scissorTest: {\n        enabled: globeDepth._useScissorTest,\n        rectangle: globeDepth._scissorRectangle,\n      },\n    });\n    globeDepth._rsBlend = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].fromCache */ .Z.fromCache({\n      viewport: globeDepth._viewport,\n      scissorTest: {\n        enabled: globeDepth._useScissorTest,\n        rectangle: globeDepth._scissorRectangle,\n      },\n      blending: _BlendingState_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].ALPHA_BLEND */ .Z.ALPHA_BLEND,\n    });\n\n    // Copy packed depth only if the 3D Tiles bit is set\n    globeDepth._rsUpdate = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].fromCache */ .Z.fromCache({\n      viewport: globeDepth._viewport,\n      scissorTest: {\n        enabled: globeDepth._useScissorTest,\n        rectangle: globeDepth._scissorRectangle,\n      },\n      stencilTest: {\n        enabled: true,\n        frontFunction: _StencilFunction_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].EQUAL */ .Z.EQUAL,\n        frontOperation: {\n          fail: _StencilOperation_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].KEEP */ .Z.KEEP,\n          zFail: _StencilOperation_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].KEEP */ .Z.KEEP,\n          zPass: _StencilOperation_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].KEEP */ .Z.KEEP,\n        },\n        backFunction: _StencilFunction_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].NEVER */ .Z.NEVER,\n        reference: _StencilConstants_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].CESIUM_3D_TILE_MASK */ .Z.CESIUM_3D_TILE_MASK,\n        mask: _StencilConstants_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].CESIUM_3D_TILE_MASK */ .Z.CESIUM_3D_TILE_MASK,\n      },\n    });\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(globeDepth._copyDepthCommand)) {\n    globeDepth._copyDepthCommand = context.createViewportQuadCommand(\n      _Shaders_PostProcessStages_PassThroughDepth_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"] */ .Z,\n      {\n        uniformMap: {\n          u_depthTexture: function () {\n            return globeDepth._depthStencilTexture;\n          },\n        },\n        owner: globeDepth,\n      }\n    );\n  }\n\n  globeDepth._copyDepthCommand.framebuffer = globeDepth._copyDepthFramebuffer;\n  globeDepth._copyDepthCommand.renderState = globeDepth._rs;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(globeDepth._copyColorCommand)) {\n    globeDepth._copyColorCommand = context.createViewportQuadCommand(\n      _Shaders_PostProcessStages_PassThrough_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z,\n      {\n        uniformMap: {\n          colorTexture: function () {\n            return globeDepth._globeColorTexture;\n          },\n        },\n        owner: globeDepth,\n      }\n    );\n  }\n\n  globeDepth._copyColorCommand.renderState = globeDepth._rs;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(globeDepth._tempCopyDepthCommand)) {\n    globeDepth._tempCopyDepthCommand = context.createViewportQuadCommand(\n      _Shaders_PostProcessStages_PassThroughDepth_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"] */ .Z,\n      {\n        uniformMap: {\n          u_depthTexture: function () {\n            return globeDepth._tempCopyDepthTexture;\n          },\n        },\n        owner: globeDepth,\n      }\n    );\n  }\n\n  globeDepth._tempCopyDepthCommand.framebuffer =\n    globeDepth._tempCopyDepthFramebuffer;\n  globeDepth._tempCopyDepthCommand.renderState = globeDepth._rs;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(globeDepth._updateDepthCommand)) {\n    globeDepth._updateDepthCommand = context.createViewportQuadCommand(\n      _Shaders_PostProcessStages_PassThrough_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z,\n      {\n        uniformMap: {\n          colorTexture: function () {\n            return globeDepth._tempGlobeDepthTexture;\n          },\n        },\n        owner: globeDepth,\n      }\n    );\n  }\n\n  globeDepth._updateDepthCommand.framebuffer =\n    globeDepth._updateDepthFramebuffer;\n  globeDepth._updateDepthCommand.renderState = globeDepth._rsUpdate;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(globeDepth._clearGlobeColorCommand)) {\n    globeDepth._clearGlobeColorCommand = new _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z({\n      color: new _Core_Color_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z(0.0, 0.0, 0.0, 0.0),\n      stencil: 0.0,\n      owner: globeDepth,\n    });\n  }\n\n  globeDepth._clearGlobeColorCommand.framebuffer =\n    globeDepth._globeColorFramebuffer;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(globeDepth._clearPrimitiveColorCommand)) {\n    globeDepth._clearPrimitiveColorCommand = new _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z({\n      color: new _Core_Color_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z(0.0, 0.0, 0.0, 0.0),\n      stencil: 0.0,\n      owner: globeDepth,\n    });\n  }\n\n  globeDepth._clearPrimitiveColorCommand.framebuffer =\n    globeDepth._primitiveColorFramebuffer;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(globeDepth._mergeColorCommand)) {\n    globeDepth._mergeColorCommand = context.createViewportQuadCommand(\n      _Shaders_PostProcessStages_PassThrough_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"] */ .Z,\n      {\n        uniformMap: {\n          colorTexture: function () {\n            return globeDepth._primitiveColorTexture;\n          },\n        },\n        owner: globeDepth,\n      }\n    );\n  }\n\n  globeDepth._mergeColorCommand.framebuffer = globeDepth._globeColorFramebuffer;\n  globeDepth._mergeColorCommand.renderState = globeDepth._rsBlend;\n}\n\nGlobeDepth.prototype.executeDebugGlobeDepth = function (\n  context,\n  passState,\n  useLogDepth\n) {\n  executeDebugGlobeDepth(this, context, passState, useLogDepth);\n};\n\nGlobeDepth.prototype.update = function (\n  context,\n  passState,\n  viewport,\n  hdr,\n  clearGlobeDepth\n) {\n  var width = viewport.width;\n  var height = viewport.height;\n\n  updateFramebuffers(this, context, width, height, hdr, clearGlobeDepth);\n  updateCopyCommands(this, context, width, height, passState);\n  context.uniformState.globeDepthTexture = undefined;\n\n  this._useHdr = hdr;\n  this._clearGlobeDepth = clearGlobeDepth;\n};\n\nGlobeDepth.prototype.executeCopyDepth = function (context, passState) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._copyDepthCommand)) {\n    this._copyDepthCommand.execute(context, passState);\n    context.uniformState.globeDepthTexture = this._globeDepthTexture;\n  }\n};\n\nGlobeDepth.prototype.executeUpdateDepth = function (\n  context,\n  passState,\n  clearGlobeDepth\n) {\n  var depthTextureToCopy = passState.framebuffer.depthStencilTexture;\n  if (clearGlobeDepth || depthTextureToCopy !== this._depthStencilTexture) {\n    // First copy the depth to a temporary globe depth texture, then update the\n    // main globe depth texture where the stencil bit for 3D Tiles is set.\n    // This preserves the original globe depth except where 3D Tiles is rendered.\n    // The additional texture and framebuffer resources are created on demand.\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._updateDepthCommand)) {\n      if (\n        !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._updateDepthFramebuffer) ||\n        this._updateDepthFramebuffer.depthStencilTexture !==\n          depthTextureToCopy ||\n        this._updateDepthFramebuffer.getColorTexture(0) !==\n          this._globeDepthTexture\n      ) {\n        var width = this._globeDepthTexture.width;\n        var height = this._globeDepthTexture.height;\n        destroyUpdateDepthResources(this);\n        createUpdateDepthResources(this, context, width, height, passState);\n        updateCopyCommands(this, context, width, height, passState);\n      }\n      this._tempCopyDepthTexture = depthTextureToCopy;\n      this._tempCopyDepthCommand.execute(context, passState);\n      this._updateDepthCommand.execute(context, passState);\n    }\n    return;\n  }\n\n  // Fast path - the depth texture can be copied normally.\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._copyDepthCommand)) {\n    this._copyDepthCommand.execute(context, passState);\n  }\n};\n\nGlobeDepth.prototype.executeCopyColor = function (context, passState) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._copyColorCommand)) {\n    this._copyColorCommand.execute(context, passState);\n  }\n};\n\nGlobeDepth.prototype.executeMergeColor = function (context, passState) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._mergeColorCommand)) {\n    this._mergeColorCommand.execute(context, passState);\n  }\n};\n\nGlobeDepth.prototype.clear = function (context, passState, clearColor) {\n  var clear = this._clearGlobeColorCommand;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(clear)) {\n    _Core_Color_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].clone */ .Z.clone(clearColor, clear.color);\n    clear.execute(context, passState);\n  }\n  clear = this._clearPrimitiveColorCommand;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(clear) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._primitiveColorFramebuffer)) {\n    clear.execute(context, passState);\n  }\n};\n\nGlobeDepth.prototype.isDestroyed = function () {\n  return false;\n};\n\nGlobeDepth.prototype.destroy = function () {\n  destroyTextures(this);\n  destroyFramebuffers(this);\n  destroyPrimitiveFramebuffer(this);\n  destroyUpdateDepthResources(this);\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._copyColorCommand)) {\n    this._copyColorCommand.shaderProgram = this._copyColorCommand.shaderProgram.destroy();\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._copyDepthCommand)) {\n    this._copyDepthCommand.shaderProgram = this._copyDepthCommand.shaderProgram.destroy();\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._tempCopyDepthCommand)) {\n    this._tempCopyDepthCommand.shaderProgram = this._tempCopyDepthCommand.shaderProgram.destroy();\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._updateDepthCommand)) {\n    this._updateDepthCommand.shaderProgram = this._updateDepthCommand.shaderProgram.destroy();\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._mergeColorCommand)) {\n    this._mergeColorCommand.shaderProgram = this._mergeColorCommand.shaderProgram.destroy();\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"] */ .Z)(this._debugGlobeDepthViewportCommand)) {\n    this._debugGlobeDepthViewportCommand.shaderProgram = this._debugGlobeDepthViewportCommand.shaderProgram.destroy();\n  }\n\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z)(this);\n};\n/* harmony default export */ __webpack_exports__["Z"] = (GlobeDepth);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE1BQU0sc0VBQU87QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxNQUFNLHNFQUFPO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0EsTUFBTSxzRUFBTztBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTSxzRUFBTztBQUNiLElBQUksMkVBQVc7QUFDZjtBQUNBO0FBQ0E7QUFDQSxNQUFNLHNFQUFPLFdBQVcsc0VBQU87QUFDL0I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU0sc0VBQU87QUFDYjtBQUNBOztBQUVBLE1BQU0sc0VBQU87QUFDYjtBQUNBOztBQUVBLE1BQU0sc0VBQU87QUFDYjtBQUNBOztBQUVBLE1BQU0sc0VBQU87QUFDYjtBQUNBOztBQUVBLE1BQU0sc0VBQU87QUFDYjtBQUNBOztBQUVBLE1BQU0sc0VBQU87QUFDYjtBQUNBOztBQUVBLFNBQVMsMkVBQWE7QUFDdEI7QUFDQSx5REFBZSxVQUFVLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92dWUzLXdlYnBhY2s1Ly4vbm9kZV9tb2R1bGVzL2Nlc2l1bS9Tb3VyY2UvU2NlbmUvR2xvYmVEZXB0aC5qcz85YTM2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3VuZGluZ1JlY3RhbmdsZSBmcm9tIFwiLi4vQ29yZS9Cb3VuZGluZ1JlY3RhbmdsZS5qc1wiO1xuaW1wb3J0IENvbG9yIGZyb20gXCIuLi9Db3JlL0NvbG9yLmpzXCI7XG5pbXBvcnQgZGVmaW5lZCBmcm9tIFwiLi4vQ29yZS9kZWZpbmVkLmpzXCI7XG5pbXBvcnQgZGVzdHJveU9iamVjdCBmcm9tIFwiLi4vQ29yZS9kZXN0cm95T2JqZWN0LmpzXCI7XG5pbXBvcnQgUGl4ZWxGb3JtYXQgZnJvbSBcIi4uL0NvcmUvUGl4ZWxGb3JtYXQuanNcIjtcbmltcG9ydCBDbGVhckNvbW1hbmQgZnJvbSBcIi4uL1JlbmRlcmVyL0NsZWFyQ29tbWFuZC5qc1wiO1xuaW1wb3J0IEZyYW1lYnVmZmVyIGZyb20gXCIuLi9SZW5kZXJlci9GcmFtZWJ1ZmZlci5qc1wiO1xuaW1wb3J0IFBpeGVsRGF0YXR5cGUgZnJvbSBcIi4uL1JlbmRlcmVyL1BpeGVsRGF0YXR5cGUuanNcIjtcbmltcG9ydCBSZW5kZXJTdGF0ZSBmcm9tIFwiLi4vUmVuZGVyZXIvUmVuZGVyU3RhdGUuanNcIjtcbmltcG9ydCBTYW1wbGVyIGZyb20gXCIuLi9SZW5kZXJlci9TYW1wbGVyLmpzXCI7XG5pbXBvcnQgU2hhZGVyU291cmNlIGZyb20gXCIuLi9SZW5kZXJlci9TaGFkZXJTb3VyY2UuanNcIjtcbmltcG9ydCBUZXh0dXJlIGZyb20gXCIuLi9SZW5kZXJlci9UZXh0dXJlLmpzXCI7XG5pbXBvcnQgUGFzc1Rocm91Z2ggZnJvbSBcIi4uL1NoYWRlcnMvUG9zdFByb2Nlc3NTdGFnZXMvUGFzc1Rocm91Z2guanNcIjtcbmltcG9ydCBQYXNzVGhyb3VnaERlcHRoIGZyb20gXCIuLi9TaGFkZXJzL1Bvc3RQcm9jZXNzU3RhZ2VzL1Bhc3NUaHJvdWdoRGVwdGguanNcIjtcbmltcG9ydCBCbGVuZGluZ1N0YXRlIGZyb20gXCIuL0JsZW5kaW5nU3RhdGUuanNcIjtcbmltcG9ydCBTdGVuY2lsQ29uc3RhbnRzIGZyb20gXCIuL1N0ZW5jaWxDb25zdGFudHMuanNcIjtcbmltcG9ydCBTdGVuY2lsRnVuY3Rpb24gZnJvbSBcIi4vU3RlbmNpbEZ1bmN0aW9uLmpzXCI7XG5pbXBvcnQgU3RlbmNpbE9wZXJhdGlvbiBmcm9tIFwiLi9TdGVuY2lsT3BlcmF0aW9uLmpzXCI7XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gR2xvYmVEZXB0aCgpIHtcbiAgdGhpcy5fZ2xvYmVDb2xvclRleHR1cmUgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX3ByaW1pdGl2ZUNvbG9yVGV4dHVyZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fZGVwdGhTdGVuY2lsVGV4dHVyZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fZ2xvYmVEZXB0aFRleHR1cmUgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX3RlbXBHbG9iZURlcHRoVGV4dHVyZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fdGVtcENvcHlEZXB0aFRleHR1cmUgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fZ2xvYmVDb2xvckZyYW1lYnVmZmVyID0gdW5kZWZpbmVkO1xuICB0aGlzLl9wcmltaXRpdmVDb2xvckZyYW1lYnVmZmVyID0gdW5kZWZpbmVkO1xuICB0aGlzLl9jb3B5RGVwdGhGcmFtZWJ1ZmZlciA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fdGVtcENvcHlEZXB0aEZyYW1lYnVmZmVyID0gdW5kZWZpbmVkO1xuICB0aGlzLl91cGRhdGVEZXB0aEZyYW1lYnVmZmVyID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMuX2NsZWFyR2xvYmVDb2xvckNvbW1hbmQgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2NsZWFyUHJpbWl0aXZlQ29sb3JDb21tYW5kID0gdW5kZWZpbmVkO1xuICB0aGlzLl9jb3B5Q29sb3JDb21tYW5kID0gdW5kZWZpbmVkO1xuICB0aGlzLl9jb3B5RGVwdGhDb21tYW5kID0gdW5kZWZpbmVkO1xuICB0aGlzLl90ZW1wQ29weURlcHRoQ29tbWFuZCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fdXBkYXRlRGVwdGhDb21tYW5kID0gdW5kZWZpbmVkO1xuICB0aGlzLl9tZXJnZUNvbG9yQ29tbWFuZCA9IHVuZGVmaW5lZDtcblxuICB0aGlzLl92aWV3cG9ydCA9IG5ldyBCb3VuZGluZ1JlY3RhbmdsZSgpO1xuICB0aGlzLl9ycyA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fcnNCbGVuZCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fcnNVcGRhdGUgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fdXNlU2Npc3NvclRlc3QgPSBmYWxzZTtcbiAgdGhpcy5fc2Npc3NvclJlY3RhbmdsZSA9IHVuZGVmaW5lZDtcblxuICB0aGlzLl91c2VMb2dEZXB0aCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fdXNlSGRyID0gdW5kZWZpbmVkO1xuICB0aGlzLl9jbGVhckdsb2JlRGVwdGggPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fZGVidWdHbG9iZURlcHRoVmlld3BvcnRDb21tYW5kID0gdW5kZWZpbmVkO1xufVxuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhHbG9iZURlcHRoLnByb3RvdHlwZSwge1xuICBmcmFtZWJ1ZmZlcjoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2dsb2JlQ29sb3JGcmFtZWJ1ZmZlcjtcbiAgICB9LFxuICB9LFxuICBwcmltaXRpdmVGcmFtZWJ1ZmZlcjoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3ByaW1pdGl2ZUNvbG9yRnJhbWVidWZmZXI7XG4gICAgfSxcbiAgfSxcbn0pO1xuXG5mdW5jdGlvbiBleGVjdXRlRGVidWdHbG9iZURlcHRoKGdsb2JlRGVwdGgsIGNvbnRleHQsIHBhc3NTdGF0ZSwgdXNlTG9nRGVwdGgpIHtcbiAgaWYgKFxuICAgICFkZWZpbmVkKGdsb2JlRGVwdGguX2RlYnVnR2xvYmVEZXB0aFZpZXdwb3J0Q29tbWFuZCkgfHxcbiAgICB1c2VMb2dEZXB0aCAhPT0gZ2xvYmVEZXB0aC5fdXNlTG9nRGVwdGhcbiAgKSB7XG4gICAgdmFyIGZzU291cmNlID1cbiAgICAgIFwidW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgdV9kZXB0aFRleHR1cmU7XFxuXCIgK1xuICAgICAgXCJ2YXJ5aW5nIHZlYzIgdl90ZXh0dXJlQ29vcmRpbmF0ZXM7XFxuXCIgK1xuICAgICAgXCJ2b2lkIG1haW4oKVxcblwiICtcbiAgICAgIFwie1xcblwiICtcbiAgICAgIFwiICAgIGZsb2F0IHpfd2luZG93ID0gY3ptX3VucGFja0RlcHRoKHRleHR1cmUyRCh1X2RlcHRoVGV4dHVyZSwgdl90ZXh0dXJlQ29vcmRpbmF0ZXMpKTtcXG5cIiArXG4gICAgICBcIiAgICB6X3dpbmRvdyA9IGN6bV9yZXZlcnNlTG9nRGVwdGgoel93aW5kb3cpOyBcXG5cIiArXG4gICAgICBcIiAgICBmbG9hdCBuX3JhbmdlID0gY3ptX2RlcHRoUmFuZ2UubmVhcjtcXG5cIiArXG4gICAgICBcIiAgICBmbG9hdCBmX3JhbmdlID0gY3ptX2RlcHRoUmFuZ2UuZmFyO1xcblwiICtcbiAgICAgIFwiICAgIGZsb2F0IHpfbmRjID0gKDIuMCAqIHpfd2luZG93IC0gbl9yYW5nZSAtIGZfcmFuZ2UpIC8gKGZfcmFuZ2UgLSBuX3JhbmdlKTtcXG5cIiArXG4gICAgICBcIiAgICBmbG9hdCBzY2FsZSA9IHBvdyh6X25kYyAqIDAuNSArIDAuNSwgOC4wKTtcXG5cIiArXG4gICAgICBcIiAgICBnbF9GcmFnQ29sb3IgPSB2ZWM0KG1peCh2ZWMzKDAuMCksIHZlYzMoMS4wKSwgc2NhbGUpLCAxLjApO1xcblwiICtcbiAgICAgIFwifVxcblwiO1xuICAgIHZhciBmcyA9IG5ldyBTaGFkZXJTb3VyY2Uoe1xuICAgICAgZGVmaW5lczogW3VzZUxvZ0RlcHRoID8gXCJMT0dfREVQVEhcIiA6IFwiXCJdLFxuICAgICAgc291cmNlczogW2ZzU291cmNlXSxcbiAgICB9KTtcblxuICAgIGdsb2JlRGVwdGguX2RlYnVnR2xvYmVEZXB0aFZpZXdwb3J0Q29tbWFuZCA9IGNvbnRleHQuY3JlYXRlVmlld3BvcnRRdWFkQ29tbWFuZChcbiAgICAgIGZzLFxuICAgICAge1xuICAgICAgICB1bmlmb3JtTWFwOiB7XG4gICAgICAgICAgdV9kZXB0aFRleHR1cmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnbG9iZURlcHRoLl9nbG9iZURlcHRoVGV4dHVyZTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBvd25lcjogZ2xvYmVEZXB0aCxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgZ2xvYmVEZXB0aC5fdXNlTG9nRGVwdGggPSB1c2VMb2dEZXB0aDtcbiAgfVxuXG4gIGdsb2JlRGVwdGguX2RlYnVnR2xvYmVEZXB0aFZpZXdwb3J0Q29tbWFuZC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG59XG5cbmZ1bmN0aW9uIGRlc3Ryb3lUZXh0dXJlcyhnbG9iZURlcHRoKSB7XG4gIGdsb2JlRGVwdGguX2dsb2JlQ29sb3JUZXh0dXJlID1cbiAgICBnbG9iZURlcHRoLl9nbG9iZUNvbG9yVGV4dHVyZSAmJlxuICAgICFnbG9iZURlcHRoLl9nbG9iZUNvbG9yVGV4dHVyZS5pc0Rlc3Ryb3llZCgpICYmXG4gICAgZ2xvYmVEZXB0aC5fZ2xvYmVDb2xvclRleHR1cmUuZGVzdHJveSgpO1xuICBnbG9iZURlcHRoLl9kZXB0aFN0ZW5jaWxUZXh0dXJlID1cbiAgICBnbG9iZURlcHRoLl9kZXB0aFN0ZW5jaWxUZXh0dXJlICYmXG4gICAgIWdsb2JlRGVwdGguX2RlcHRoU3RlbmNpbFRleHR1cmUuaXNEZXN0cm95ZWQoKSAmJlxuICAgIGdsb2JlRGVwdGguX2RlcHRoU3RlbmNpbFRleHR1cmUuZGVzdHJveSgpO1xuICBnbG9iZURlcHRoLl9nbG9iZURlcHRoVGV4dHVyZSA9XG4gICAgZ2xvYmVEZXB0aC5fZ2xvYmVEZXB0aFRleHR1cmUgJiZcbiAgICAhZ2xvYmVEZXB0aC5fZ2xvYmVEZXB0aFRleHR1cmUuaXNEZXN0cm95ZWQoKSAmJlxuICAgIGdsb2JlRGVwdGguX2dsb2JlRGVwdGhUZXh0dXJlLmRlc3Ryb3koKTtcbn1cblxuZnVuY3Rpb24gZGVzdHJveUZyYW1lYnVmZmVycyhnbG9iZURlcHRoKSB7XG4gIGdsb2JlRGVwdGguX2dsb2JlQ29sb3JGcmFtZWJ1ZmZlciA9XG4gICAgZ2xvYmVEZXB0aC5fZ2xvYmVDb2xvckZyYW1lYnVmZmVyICYmXG4gICAgIWdsb2JlRGVwdGguX2dsb2JlQ29sb3JGcmFtZWJ1ZmZlci5pc0Rlc3Ryb3llZCgpICYmXG4gICAgZ2xvYmVEZXB0aC5fZ2xvYmVDb2xvckZyYW1lYnVmZmVyLmRlc3Ryb3koKTtcbiAgZ2xvYmVEZXB0aC5fY29weURlcHRoRnJhbWVidWZmZXIgPVxuICAgIGdsb2JlRGVwdGguX2NvcHlEZXB0aEZyYW1lYnVmZmVyICYmXG4gICAgIWdsb2JlRGVwdGguX2NvcHlEZXB0aEZyYW1lYnVmZmVyLmlzRGVzdHJveWVkKCkgJiZcbiAgICBnbG9iZURlcHRoLl9jb3B5RGVwdGhGcmFtZWJ1ZmZlci5kZXN0cm95KCk7XG59XG5cbmZ1bmN0aW9uIGRlc3Ryb3lVcGRhdGVEZXB0aFJlc291cmNlcyhnbG9iZURlcHRoKSB7XG4gIGdsb2JlRGVwdGguX3RlbXBDb3B5RGVwdGhGcmFtZWJ1ZmZlciA9XG4gICAgZ2xvYmVEZXB0aC5fdGVtcENvcHlEZXB0aEZyYW1lYnVmZmVyICYmXG4gICAgIWdsb2JlRGVwdGguX3RlbXBDb3B5RGVwdGhGcmFtZWJ1ZmZlci5pc0Rlc3Ryb3llZCgpICYmXG4gICAgZ2xvYmVEZXB0aC5fdGVtcENvcHlEZXB0aEZyYW1lYnVmZmVyLmRlc3Ryb3koKTtcbiAgZ2xvYmVEZXB0aC5fdXBkYXRlRGVwdGhGcmFtZWJ1ZmZlciA9XG4gICAgZ2xvYmVEZXB0aC5fdXBkYXRlRGVwdGhGcmFtZWJ1ZmZlciAmJlxuICAgICFnbG9iZURlcHRoLl91cGRhdGVEZXB0aEZyYW1lYnVmZmVyLmlzRGVzdHJveWVkKCkgJiZcbiAgICBnbG9iZURlcHRoLl91cGRhdGVEZXB0aEZyYW1lYnVmZmVyLmRlc3Ryb3koKTtcbiAgZ2xvYmVEZXB0aC5fdGVtcEdsb2JlRGVwdGhUZXh0dXJlID1cbiAgICBnbG9iZURlcHRoLl90ZW1wR2xvYmVEZXB0aFRleHR1cmUgJiZcbiAgICAhZ2xvYmVEZXB0aC5fdGVtcEdsb2JlRGVwdGhUZXh0dXJlLmlzRGVzdHJveWVkKCkgJiZcbiAgICBnbG9iZURlcHRoLl90ZW1wR2xvYmVEZXB0aFRleHR1cmUuZGVzdHJveSgpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVVcGRhdGVEZXB0aFJlc291cmNlcyhcbiAgZ2xvYmVEZXB0aCxcbiAgY29udGV4dCxcbiAgd2lkdGgsXG4gIGhlaWdodCxcbiAgcGFzc1N0YXRlXG4pIHtcbiAgZ2xvYmVEZXB0aC5fdGVtcEdsb2JlRGVwdGhUZXh0dXJlID0gbmV3IFRleHR1cmUoe1xuICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgd2lkdGg6IHdpZHRoLFxuICAgIGhlaWdodDogaGVpZ2h0LFxuICAgIHBpeGVsRm9ybWF0OiBQaXhlbEZvcm1hdC5SR0JBLFxuICAgIHBpeGVsRGF0YXR5cGU6IFBpeGVsRGF0YXR5cGUuVU5TSUdORURfQllURSxcbiAgICBzYW1wbGVyOiBTYW1wbGVyLk5FQVJFU1QsXG4gIH0pO1xuICBnbG9iZURlcHRoLl90ZW1wQ29weURlcHRoRnJhbWVidWZmZXIgPSBuZXcgRnJhbWVidWZmZXIoe1xuICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgY29sb3JUZXh0dXJlczogW2dsb2JlRGVwdGguX3RlbXBHbG9iZURlcHRoVGV4dHVyZV0sXG4gICAgZGVzdHJveUF0dGFjaG1lbnRzOiBmYWxzZSxcbiAgfSk7XG4gIGdsb2JlRGVwdGguX3VwZGF0ZURlcHRoRnJhbWVidWZmZXIgPSBuZXcgRnJhbWVidWZmZXIoe1xuICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgY29sb3JUZXh0dXJlczogW2dsb2JlRGVwdGguX2dsb2JlRGVwdGhUZXh0dXJlXSxcbiAgICBkZXB0aFN0ZW5jaWxUZXh0dXJlOiBwYXNzU3RhdGUuZnJhbWVidWZmZXIuZGVwdGhTdGVuY2lsVGV4dHVyZSxcbiAgICBkZXN0cm95QXR0YWNobWVudHM6IGZhbHNlLFxuICB9KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlVGV4dHVyZXMoZ2xvYmVEZXB0aCwgY29udGV4dCwgd2lkdGgsIGhlaWdodCwgaGRyKSB7XG4gIHZhciBwaXhlbERhdGF0eXBlID0gaGRyXG4gICAgPyBjb250ZXh0LmhhbGZGbG9hdGluZ1BvaW50VGV4dHVyZVxuICAgICAgPyBQaXhlbERhdGF0eXBlLkhBTEZfRkxPQVRcbiAgICAgIDogUGl4ZWxEYXRhdHlwZS5GTE9BVFxuICAgIDogUGl4ZWxEYXRhdHlwZS5VTlNJR05FRF9CWVRFO1xuICBnbG9iZURlcHRoLl9nbG9iZUNvbG9yVGV4dHVyZSA9IG5ldyBUZXh0dXJlKHtcbiAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIHdpZHRoOiB3aWR0aCxcbiAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICBwaXhlbEZvcm1hdDogUGl4ZWxGb3JtYXQuUkdCQSxcbiAgICBwaXhlbERhdGF0eXBlOiBwaXhlbERhdGF0eXBlLFxuICAgIHNhbXBsZXI6IFNhbXBsZXIuTkVBUkVTVCxcbiAgfSk7XG5cbiAgZ2xvYmVEZXB0aC5fZGVwdGhTdGVuY2lsVGV4dHVyZSA9IG5ldyBUZXh0dXJlKHtcbiAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIHdpZHRoOiB3aWR0aCxcbiAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICBwaXhlbEZvcm1hdDogUGl4ZWxGb3JtYXQuREVQVEhfU1RFTkNJTCxcbiAgICBwaXhlbERhdGF0eXBlOiBQaXhlbERhdGF0eXBlLlVOU0lHTkVEX0lOVF8yNF84LFxuICB9KTtcblxuICBnbG9iZURlcHRoLl9nbG9iZURlcHRoVGV4dHVyZSA9IG5ldyBUZXh0dXJlKHtcbiAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIHdpZHRoOiB3aWR0aCxcbiAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICBwaXhlbEZvcm1hdDogUGl4ZWxGb3JtYXQuUkdCQSxcbiAgICBwaXhlbERhdGF0eXBlOiBQaXhlbERhdGF0eXBlLlVOU0lHTkVEX0JZVEUsXG4gICAgc2FtcGxlcjogU2FtcGxlci5ORUFSRVNULFxuICB9KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRnJhbWVidWZmZXJzKGdsb2JlRGVwdGgsIGNvbnRleHQpIHtcbiAgZ2xvYmVEZXB0aC5fZ2xvYmVDb2xvckZyYW1lYnVmZmVyID0gbmV3IEZyYW1lYnVmZmVyKHtcbiAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIGNvbG9yVGV4dHVyZXM6IFtnbG9iZURlcHRoLl9nbG9iZUNvbG9yVGV4dHVyZV0sXG4gICAgZGVwdGhTdGVuY2lsVGV4dHVyZTogZ2xvYmVEZXB0aC5fZGVwdGhTdGVuY2lsVGV4dHVyZSxcbiAgICBkZXN0cm95QXR0YWNobWVudHM6IGZhbHNlLFxuICB9KTtcblxuICBnbG9iZURlcHRoLl9jb3B5RGVwdGhGcmFtZWJ1ZmZlciA9IG5ldyBGcmFtZWJ1ZmZlcih7XG4gICAgY29udGV4dDogY29udGV4dCxcbiAgICBjb2xvclRleHR1cmVzOiBbZ2xvYmVEZXB0aC5fZ2xvYmVEZXB0aFRleHR1cmVdLFxuICAgIGRlc3Ryb3lBdHRhY2htZW50czogZmFsc2UsXG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVQcmltaXRpdmVGcmFtZWJ1ZmZlcihnbG9iZURlcHRoLCBjb250ZXh0LCB3aWR0aCwgaGVpZ2h0LCBoZHIpIHtcbiAgdmFyIHBpeGVsRGF0YXR5cGUgPSBoZHJcbiAgICA/IGNvbnRleHQuaGFsZkZsb2F0aW5nUG9pbnRUZXh0dXJlXG4gICAgICA/IFBpeGVsRGF0YXR5cGUuSEFMRl9GTE9BVFxuICAgICAgOiBQaXhlbERhdGF0eXBlLkZMT0FUXG4gICAgOiBQaXhlbERhdGF0eXBlLlVOU0lHTkVEX0JZVEU7XG4gIGdsb2JlRGVwdGguX3ByaW1pdGl2ZUNvbG9yVGV4dHVyZSA9IG5ldyBUZXh0dXJlKHtcbiAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIHdpZHRoOiB3aWR0aCxcbiAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICBwaXhlbEZvcm1hdDogUGl4ZWxGb3JtYXQuUkdCQSxcbiAgICBwaXhlbERhdGF0eXBlOiBwaXhlbERhdGF0eXBlLFxuICAgIHNhbXBsZXI6IFNhbXBsZXIuTkVBUkVTVCxcbiAgfSk7XG5cbiAgZ2xvYmVEZXB0aC5fcHJpbWl0aXZlQ29sb3JGcmFtZWJ1ZmZlciA9IG5ldyBGcmFtZWJ1ZmZlcih7XG4gICAgY29udGV4dDogY29udGV4dCxcbiAgICBjb2xvclRleHR1cmVzOiBbZ2xvYmVEZXB0aC5fcHJpbWl0aXZlQ29sb3JUZXh0dXJlXSxcbiAgICBkZXB0aFN0ZW5jaWxUZXh0dXJlOiBnbG9iZURlcHRoLl9kZXB0aFN0ZW5jaWxUZXh0dXJlLFxuICAgIGRlc3Ryb3lBdHRhY2htZW50czogZmFsc2UsXG4gIH0pO1xufVxuXG5mdW5jdGlvbiBkZXN0cm95UHJpbWl0aXZlRnJhbWVidWZmZXIoZ2xvYmVEZXB0aCkge1xuICBnbG9iZURlcHRoLl9wcmltaXRpdmVDb2xvclRleHR1cmUgPVxuICAgIGdsb2JlRGVwdGguX3ByaW1pdGl2ZUNvbG9yVGV4dHVyZSAmJlxuICAgICFnbG9iZURlcHRoLl9wcmltaXRpdmVDb2xvclRleHR1cmUuaXNEZXN0cm95ZWQoKSAmJlxuICAgIGdsb2JlRGVwdGguX3ByaW1pdGl2ZUNvbG9yVGV4dHVyZS5kZXN0cm95KCk7XG4gIGdsb2JlRGVwdGguX3ByaW1pdGl2ZUNvbG9yRnJhbWVidWZmZXIgPVxuICAgIGdsb2JlRGVwdGguX3ByaW1pdGl2ZUNvbG9yRnJhbWVidWZmZXIgJiZcbiAgICAhZ2xvYmVEZXB0aC5fcHJpbWl0aXZlQ29sb3JGcmFtZWJ1ZmZlci5pc0Rlc3Ryb3llZCgpICYmXG4gICAgZ2xvYmVEZXB0aC5fcHJpbWl0aXZlQ29sb3JGcmFtZWJ1ZmZlci5kZXN0cm95KCk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUZyYW1lYnVmZmVycyhcbiAgZ2xvYmVEZXB0aCxcbiAgY29udGV4dCxcbiAgd2lkdGgsXG4gIGhlaWdodCxcbiAgaGRyLFxuICBjbGVhckdsb2JlRGVwdGhcbikge1xuICB2YXIgY29sb3JUZXh0dXJlID0gZ2xvYmVEZXB0aC5fZ2xvYmVDb2xvclRleHR1cmU7XG4gIHZhciB0ZXh0dXJlQ2hhbmdlZCA9XG4gICAgIWRlZmluZWQoY29sb3JUZXh0dXJlKSB8fFxuICAgIGNvbG9yVGV4dHVyZS53aWR0aCAhPT0gd2lkdGggfHxcbiAgICBjb2xvclRleHR1cmUuaGVpZ2h0ICE9PSBoZWlnaHQgfHxcbiAgICBoZHIgIT09IGdsb2JlRGVwdGguX3VzZUhkcjtcbiAgaWYgKHRleHR1cmVDaGFuZ2VkKSB7XG4gICAgZGVzdHJveVRleHR1cmVzKGdsb2JlRGVwdGgpO1xuICAgIGRlc3Ryb3lGcmFtZWJ1ZmZlcnMoZ2xvYmVEZXB0aCk7XG4gICAgY3JlYXRlVGV4dHVyZXMoZ2xvYmVEZXB0aCwgY29udGV4dCwgd2lkdGgsIGhlaWdodCwgaGRyLCBjbGVhckdsb2JlRGVwdGgpO1xuICAgIGNyZWF0ZUZyYW1lYnVmZmVycyhnbG9iZURlcHRoLCBjb250ZXh0LCBjbGVhckdsb2JlRGVwdGgpO1xuICB9XG5cbiAgaWYgKHRleHR1cmVDaGFuZ2VkIHx8IGNsZWFyR2xvYmVEZXB0aCAhPT0gZ2xvYmVEZXB0aC5fY2xlYXJHbG9iZURlcHRoKSB7XG4gICAgZGVzdHJveVByaW1pdGl2ZUZyYW1lYnVmZmVyKGdsb2JlRGVwdGgpO1xuICAgIGlmIChjbGVhckdsb2JlRGVwdGgpIHtcbiAgICAgIGNyZWF0ZVByaW1pdGl2ZUZyYW1lYnVmZmVyKGdsb2JlRGVwdGgsIGNvbnRleHQsIHdpZHRoLCBoZWlnaHQsIGhkcik7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUNvcHlDb21tYW5kcyhnbG9iZURlcHRoLCBjb250ZXh0LCB3aWR0aCwgaGVpZ2h0LCBwYXNzU3RhdGUpIHtcbiAgZ2xvYmVEZXB0aC5fdmlld3BvcnQud2lkdGggPSB3aWR0aDtcbiAgZ2xvYmVEZXB0aC5fdmlld3BvcnQuaGVpZ2h0ID0gaGVpZ2h0O1xuXG4gIHZhciB1c2VTY2lzc29yVGVzdCA9ICFCb3VuZGluZ1JlY3RhbmdsZS5lcXVhbHMoXG4gICAgZ2xvYmVEZXB0aC5fdmlld3BvcnQsXG4gICAgcGFzc1N0YXRlLnZpZXdwb3J0XG4gICk7XG4gIHZhciB1cGRhdGVTY2lzc29yID0gdXNlU2Npc3NvclRlc3QgIT09IGdsb2JlRGVwdGguX3VzZVNjaXNzb3JUZXN0O1xuICBnbG9iZURlcHRoLl91c2VTY2lzc29yVGVzdCA9IHVzZVNjaXNzb3JUZXN0O1xuXG4gIGlmIChcbiAgICAhQm91bmRpbmdSZWN0YW5nbGUuZXF1YWxzKGdsb2JlRGVwdGguX3NjaXNzb3JSZWN0YW5nbGUsIHBhc3NTdGF0ZS52aWV3cG9ydClcbiAgKSB7XG4gICAgZ2xvYmVEZXB0aC5fc2Npc3NvclJlY3RhbmdsZSA9IEJvdW5kaW5nUmVjdGFuZ2xlLmNsb25lKFxuICAgICAgcGFzc1N0YXRlLnZpZXdwb3J0LFxuICAgICAgZ2xvYmVEZXB0aC5fc2Npc3NvclJlY3RhbmdsZVxuICAgICk7XG4gICAgdXBkYXRlU2Npc3NvciA9IHRydWU7XG4gIH1cblxuICBpZiAoXG4gICAgIWRlZmluZWQoZ2xvYmVEZXB0aC5fcnMpIHx8XG4gICAgIUJvdW5kaW5nUmVjdGFuZ2xlLmVxdWFscyhnbG9iZURlcHRoLl92aWV3cG9ydCwgZ2xvYmVEZXB0aC5fcnMudmlld3BvcnQpIHx8XG4gICAgdXBkYXRlU2Npc3NvclxuICApIHtcbiAgICBnbG9iZURlcHRoLl9ycyA9IFJlbmRlclN0YXRlLmZyb21DYWNoZSh7XG4gICAgICB2aWV3cG9ydDogZ2xvYmVEZXB0aC5fdmlld3BvcnQsXG4gICAgICBzY2lzc29yVGVzdDoge1xuICAgICAgICBlbmFibGVkOiBnbG9iZURlcHRoLl91c2VTY2lzc29yVGVzdCxcbiAgICAgICAgcmVjdGFuZ2xlOiBnbG9iZURlcHRoLl9zY2lzc29yUmVjdGFuZ2xlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBnbG9iZURlcHRoLl9yc0JsZW5kID0gUmVuZGVyU3RhdGUuZnJvbUNhY2hlKHtcbiAgICAgIHZpZXdwb3J0OiBnbG9iZURlcHRoLl92aWV3cG9ydCxcbiAgICAgIHNjaXNzb3JUZXN0OiB7XG4gICAgICAgIGVuYWJsZWQ6IGdsb2JlRGVwdGguX3VzZVNjaXNzb3JUZXN0LFxuICAgICAgICByZWN0YW5nbGU6IGdsb2JlRGVwdGguX3NjaXNzb3JSZWN0YW5nbGUsXG4gICAgICB9LFxuICAgICAgYmxlbmRpbmc6IEJsZW5kaW5nU3RhdGUuQUxQSEFfQkxFTkQsXG4gICAgfSk7XG5cbiAgICAvLyBDb3B5IHBhY2tlZCBkZXB0aCBvbmx5IGlmIHRoZSAzRCBUaWxlcyBiaXQgaXMgc2V0XG4gICAgZ2xvYmVEZXB0aC5fcnNVcGRhdGUgPSBSZW5kZXJTdGF0ZS5mcm9tQ2FjaGUoe1xuICAgICAgdmlld3BvcnQ6IGdsb2JlRGVwdGguX3ZpZXdwb3J0LFxuICAgICAgc2Npc3NvclRlc3Q6IHtcbiAgICAgICAgZW5hYmxlZDogZ2xvYmVEZXB0aC5fdXNlU2Npc3NvclRlc3QsXG4gICAgICAgIHJlY3RhbmdsZTogZ2xvYmVEZXB0aC5fc2Npc3NvclJlY3RhbmdsZSxcbiAgICAgIH0sXG4gICAgICBzdGVuY2lsVGVzdDoge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBmcm9udEZ1bmN0aW9uOiBTdGVuY2lsRnVuY3Rpb24uRVFVQUwsXG4gICAgICAgIGZyb250T3BlcmF0aW9uOiB7XG4gICAgICAgICAgZmFpbDogU3RlbmNpbE9wZXJhdGlvbi5LRUVQLFxuICAgICAgICAgIHpGYWlsOiBTdGVuY2lsT3BlcmF0aW9uLktFRVAsXG4gICAgICAgICAgelBhc3M6IFN0ZW5jaWxPcGVyYXRpb24uS0VFUCxcbiAgICAgICAgfSxcbiAgICAgICAgYmFja0Z1bmN0aW9uOiBTdGVuY2lsRnVuY3Rpb24uTkVWRVIsXG4gICAgICAgIHJlZmVyZW5jZTogU3RlbmNpbENvbnN0YW50cy5DRVNJVU1fM0RfVElMRV9NQVNLLFxuICAgICAgICBtYXNrOiBTdGVuY2lsQ29uc3RhbnRzLkNFU0lVTV8zRF9USUxFX01BU0ssXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgaWYgKCFkZWZpbmVkKGdsb2JlRGVwdGguX2NvcHlEZXB0aENvbW1hbmQpKSB7XG4gICAgZ2xvYmVEZXB0aC5fY29weURlcHRoQ29tbWFuZCA9IGNvbnRleHQuY3JlYXRlVmlld3BvcnRRdWFkQ29tbWFuZChcbiAgICAgIFBhc3NUaHJvdWdoRGVwdGgsXG4gICAgICB7XG4gICAgICAgIHVuaWZvcm1NYXA6IHtcbiAgICAgICAgICB1X2RlcHRoVGV4dHVyZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdsb2JlRGVwdGguX2RlcHRoU3RlbmNpbFRleHR1cmU7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgb3duZXI6IGdsb2JlRGVwdGgsXG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIGdsb2JlRGVwdGguX2NvcHlEZXB0aENvbW1hbmQuZnJhbWVidWZmZXIgPSBnbG9iZURlcHRoLl9jb3B5RGVwdGhGcmFtZWJ1ZmZlcjtcbiAgZ2xvYmVEZXB0aC5fY29weURlcHRoQ29tbWFuZC5yZW5kZXJTdGF0ZSA9IGdsb2JlRGVwdGguX3JzO1xuXG4gIGlmICghZGVmaW5lZChnbG9iZURlcHRoLl9jb3B5Q29sb3JDb21tYW5kKSkge1xuICAgIGdsb2JlRGVwdGguX2NvcHlDb2xvckNvbW1hbmQgPSBjb250ZXh0LmNyZWF0ZVZpZXdwb3J0UXVhZENvbW1hbmQoXG4gICAgICBQYXNzVGhyb3VnaCxcbiAgICAgIHtcbiAgICAgICAgdW5pZm9ybU1hcDoge1xuICAgICAgICAgIGNvbG9yVGV4dHVyZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdsb2JlRGVwdGguX2dsb2JlQ29sb3JUZXh0dXJlO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIG93bmVyOiBnbG9iZURlcHRoLFxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBnbG9iZURlcHRoLl9jb3B5Q29sb3JDb21tYW5kLnJlbmRlclN0YXRlID0gZ2xvYmVEZXB0aC5fcnM7XG5cbiAgaWYgKCFkZWZpbmVkKGdsb2JlRGVwdGguX3RlbXBDb3B5RGVwdGhDb21tYW5kKSkge1xuICAgIGdsb2JlRGVwdGguX3RlbXBDb3B5RGVwdGhDb21tYW5kID0gY29udGV4dC5jcmVhdGVWaWV3cG9ydFF1YWRDb21tYW5kKFxuICAgICAgUGFzc1Rocm91Z2hEZXB0aCxcbiAgICAgIHtcbiAgICAgICAgdW5pZm9ybU1hcDoge1xuICAgICAgICAgIHVfZGVwdGhUZXh0dXJlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2xvYmVEZXB0aC5fdGVtcENvcHlEZXB0aFRleHR1cmU7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgb3duZXI6IGdsb2JlRGVwdGgsXG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIGdsb2JlRGVwdGguX3RlbXBDb3B5RGVwdGhDb21tYW5kLmZyYW1lYnVmZmVyID1cbiAgICBnbG9iZURlcHRoLl90ZW1wQ29weURlcHRoRnJhbWVidWZmZXI7XG4gIGdsb2JlRGVwdGguX3RlbXBDb3B5RGVwdGhDb21tYW5kLnJlbmRlclN0YXRlID0gZ2xvYmVEZXB0aC5fcnM7XG5cbiAgaWYgKCFkZWZpbmVkKGdsb2JlRGVwdGguX3VwZGF0ZURlcHRoQ29tbWFuZCkpIHtcbiAgICBnbG9iZURlcHRoLl91cGRhdGVEZXB0aENvbW1hbmQgPSBjb250ZXh0LmNyZWF0ZVZpZXdwb3J0UXVhZENvbW1hbmQoXG4gICAgICBQYXNzVGhyb3VnaCxcbiAgICAgIHtcbiAgICAgICAgdW5pZm9ybU1hcDoge1xuICAgICAgICAgIGNvbG9yVGV4dHVyZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdsb2JlRGVwdGguX3RlbXBHbG9iZURlcHRoVGV4dHVyZTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBvd25lcjogZ2xvYmVEZXB0aCxcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgZ2xvYmVEZXB0aC5fdXBkYXRlRGVwdGhDb21tYW5kLmZyYW1lYnVmZmVyID1cbiAgICBnbG9iZURlcHRoLl91cGRhdGVEZXB0aEZyYW1lYnVmZmVyO1xuICBnbG9iZURlcHRoLl91cGRhdGVEZXB0aENvbW1hbmQucmVuZGVyU3RhdGUgPSBnbG9iZURlcHRoLl9yc1VwZGF0ZTtcblxuICBpZiAoIWRlZmluZWQoZ2xvYmVEZXB0aC5fY2xlYXJHbG9iZUNvbG9yQ29tbWFuZCkpIHtcbiAgICBnbG9iZURlcHRoLl9jbGVhckdsb2JlQ29sb3JDb21tYW5kID0gbmV3IENsZWFyQ29tbWFuZCh7XG4gICAgICBjb2xvcjogbmV3IENvbG9yKDAuMCwgMC4wLCAwLjAsIDAuMCksXG4gICAgICBzdGVuY2lsOiAwLjAsXG4gICAgICBvd25lcjogZ2xvYmVEZXB0aCxcbiAgICB9KTtcbiAgfVxuXG4gIGdsb2JlRGVwdGguX2NsZWFyR2xvYmVDb2xvckNvbW1hbmQuZnJhbWVidWZmZXIgPVxuICAgIGdsb2JlRGVwdGguX2dsb2JlQ29sb3JGcmFtZWJ1ZmZlcjtcblxuICBpZiAoIWRlZmluZWQoZ2xvYmVEZXB0aC5fY2xlYXJQcmltaXRpdmVDb2xvckNvbW1hbmQpKSB7XG4gICAgZ2xvYmVEZXB0aC5fY2xlYXJQcmltaXRpdmVDb2xvckNvbW1hbmQgPSBuZXcgQ2xlYXJDb21tYW5kKHtcbiAgICAgIGNvbG9yOiBuZXcgQ29sb3IoMC4wLCAwLjAsIDAuMCwgMC4wKSxcbiAgICAgIHN0ZW5jaWw6IDAuMCxcbiAgICAgIG93bmVyOiBnbG9iZURlcHRoLFxuICAgIH0pO1xuICB9XG5cbiAgZ2xvYmVEZXB0aC5fY2xlYXJQcmltaXRpdmVDb2xvckNvbW1hbmQuZnJhbWVidWZmZXIgPVxuICAgIGdsb2JlRGVwdGguX3ByaW1pdGl2ZUNvbG9yRnJhbWVidWZmZXI7XG5cbiAgaWYgKCFkZWZpbmVkKGdsb2JlRGVwdGguX21lcmdlQ29sb3JDb21tYW5kKSkge1xuICAgIGdsb2JlRGVwdGguX21lcmdlQ29sb3JDb21tYW5kID0gY29udGV4dC5jcmVhdGVWaWV3cG9ydFF1YWRDb21tYW5kKFxuICAgICAgUGFzc1Rocm91Z2gsXG4gICAgICB7XG4gICAgICAgIHVuaWZvcm1NYXA6IHtcbiAgICAgICAgICBjb2xvclRleHR1cmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnbG9iZURlcHRoLl9wcmltaXRpdmVDb2xvclRleHR1cmU7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgb3duZXI6IGdsb2JlRGVwdGgsXG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIGdsb2JlRGVwdGguX21lcmdlQ29sb3JDb21tYW5kLmZyYW1lYnVmZmVyID0gZ2xvYmVEZXB0aC5fZ2xvYmVDb2xvckZyYW1lYnVmZmVyO1xuICBnbG9iZURlcHRoLl9tZXJnZUNvbG9yQ29tbWFuZC5yZW5kZXJTdGF0ZSA9IGdsb2JlRGVwdGguX3JzQmxlbmQ7XG59XG5cbkdsb2JlRGVwdGgucHJvdG90eXBlLmV4ZWN1dGVEZWJ1Z0dsb2JlRGVwdGggPSBmdW5jdGlvbiAoXG4gIGNvbnRleHQsXG4gIHBhc3NTdGF0ZSxcbiAgdXNlTG9nRGVwdGhcbikge1xuICBleGVjdXRlRGVidWdHbG9iZURlcHRoKHRoaXMsIGNvbnRleHQsIHBhc3NTdGF0ZSwgdXNlTG9nRGVwdGgpO1xufTtcblxuR2xvYmVEZXB0aC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKFxuICBjb250ZXh0LFxuICBwYXNzU3RhdGUsXG4gIHZpZXdwb3J0LFxuICBoZHIsXG4gIGNsZWFyR2xvYmVEZXB0aFxuKSB7XG4gIHZhciB3aWR0aCA9IHZpZXdwb3J0LndpZHRoO1xuICB2YXIgaGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0O1xuXG4gIHVwZGF0ZUZyYW1lYnVmZmVycyh0aGlzLCBjb250ZXh0LCB3aWR0aCwgaGVpZ2h0LCBoZHIsIGNsZWFyR2xvYmVEZXB0aCk7XG4gIHVwZGF0ZUNvcHlDb21tYW5kcyh0aGlzLCBjb250ZXh0LCB3aWR0aCwgaGVpZ2h0LCBwYXNzU3RhdGUpO1xuICBjb250ZXh0LnVuaWZvcm1TdGF0ZS5nbG9iZURlcHRoVGV4dHVyZSA9IHVuZGVmaW5lZDtcblxuICB0aGlzLl91c2VIZHIgPSBoZHI7XG4gIHRoaXMuX2NsZWFyR2xvYmVEZXB0aCA9IGNsZWFyR2xvYmVEZXB0aDtcbn07XG5cbkdsb2JlRGVwdGgucHJvdG90eXBlLmV4ZWN1dGVDb3B5RGVwdGggPSBmdW5jdGlvbiAoY29udGV4dCwgcGFzc1N0YXRlKSB7XG4gIGlmIChkZWZpbmVkKHRoaXMuX2NvcHlEZXB0aENvbW1hbmQpKSB7XG4gICAgdGhpcy5fY29weURlcHRoQ29tbWFuZC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgY29udGV4dC51bmlmb3JtU3RhdGUuZ2xvYmVEZXB0aFRleHR1cmUgPSB0aGlzLl9nbG9iZURlcHRoVGV4dHVyZTtcbiAgfVxufTtcblxuR2xvYmVEZXB0aC5wcm90b3R5cGUuZXhlY3V0ZVVwZGF0ZURlcHRoID0gZnVuY3Rpb24gKFxuICBjb250ZXh0LFxuICBwYXNzU3RhdGUsXG4gIGNsZWFyR2xvYmVEZXB0aFxuKSB7XG4gIHZhciBkZXB0aFRleHR1cmVUb0NvcHkgPSBwYXNzU3RhdGUuZnJhbWVidWZmZXIuZGVwdGhTdGVuY2lsVGV4dHVyZTtcbiAgaWYgKGNsZWFyR2xvYmVEZXB0aCB8fCBkZXB0aFRleHR1cmVUb0NvcHkgIT09IHRoaXMuX2RlcHRoU3RlbmNpbFRleHR1cmUpIHtcbiAgICAvLyBGaXJzdCBjb3B5IHRoZSBkZXB0aCB0byBhIHRlbXBvcmFyeSBnbG9iZSBkZXB0aCB0ZXh0dXJlLCB0aGVuIHVwZGF0ZSB0aGVcbiAgICAvLyBtYWluIGdsb2JlIGRlcHRoIHRleHR1cmUgd2hlcmUgdGhlIHN0ZW5jaWwgYml0IGZvciAzRCBUaWxlcyBpcyBzZXQuXG4gICAgLy8gVGhpcyBwcmVzZXJ2ZXMgdGhlIG9yaWdpbmFsIGdsb2JlIGRlcHRoIGV4Y2VwdCB3aGVyZSAzRCBUaWxlcyBpcyByZW5kZXJlZC5cbiAgICAvLyBUaGUgYWRkaXRpb25hbCB0ZXh0dXJlIGFuZCBmcmFtZWJ1ZmZlciByZXNvdXJjZXMgYXJlIGNyZWF0ZWQgb24gZGVtYW5kLlxuICAgIGlmIChkZWZpbmVkKHRoaXMuX3VwZGF0ZURlcHRoQ29tbWFuZCkpIHtcbiAgICAgIGlmIChcbiAgICAgICAgIWRlZmluZWQodGhpcy5fdXBkYXRlRGVwdGhGcmFtZWJ1ZmZlcikgfHxcbiAgICAgICAgdGhpcy5fdXBkYXRlRGVwdGhGcmFtZWJ1ZmZlci5kZXB0aFN0ZW5jaWxUZXh0dXJlICE9PVxuICAgICAgICAgIGRlcHRoVGV4dHVyZVRvQ29weSB8fFxuICAgICAgICB0aGlzLl91cGRhdGVEZXB0aEZyYW1lYnVmZmVyLmdldENvbG9yVGV4dHVyZSgwKSAhPT1cbiAgICAgICAgICB0aGlzLl9nbG9iZURlcHRoVGV4dHVyZVxuICAgICAgKSB7XG4gICAgICAgIHZhciB3aWR0aCA9IHRoaXMuX2dsb2JlRGVwdGhUZXh0dXJlLndpZHRoO1xuICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy5fZ2xvYmVEZXB0aFRleHR1cmUuaGVpZ2h0O1xuICAgICAgICBkZXN0cm95VXBkYXRlRGVwdGhSZXNvdXJjZXModGhpcyk7XG4gICAgICAgIGNyZWF0ZVVwZGF0ZURlcHRoUmVzb3VyY2VzKHRoaXMsIGNvbnRleHQsIHdpZHRoLCBoZWlnaHQsIHBhc3NTdGF0ZSk7XG4gICAgICAgIHVwZGF0ZUNvcHlDb21tYW5kcyh0aGlzLCBjb250ZXh0LCB3aWR0aCwgaGVpZ2h0LCBwYXNzU3RhdGUpO1xuICAgICAgfVxuICAgICAgdGhpcy5fdGVtcENvcHlEZXB0aFRleHR1cmUgPSBkZXB0aFRleHR1cmVUb0NvcHk7XG4gICAgICB0aGlzLl90ZW1wQ29weURlcHRoQ29tbWFuZC5leGVjdXRlKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgICB0aGlzLl91cGRhdGVEZXB0aENvbW1hbmQuZXhlY3V0ZShjb250ZXh0LCBwYXNzU3RhdGUpO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBGYXN0IHBhdGggLSB0aGUgZGVwdGggdGV4dHVyZSBjYW4gYmUgY29waWVkIG5vcm1hbGx5LlxuICBpZiAoZGVmaW5lZCh0aGlzLl9jb3B5RGVwdGhDb21tYW5kKSkge1xuICAgIHRoaXMuX2NvcHlEZXB0aENvbW1hbmQuZXhlY3V0ZShjb250ZXh0LCBwYXNzU3RhdGUpO1xuICB9XG59O1xuXG5HbG9iZURlcHRoLnByb3RvdHlwZS5leGVjdXRlQ29weUNvbG9yID0gZnVuY3Rpb24gKGNvbnRleHQsIHBhc3NTdGF0ZSkge1xuICBpZiAoZGVmaW5lZCh0aGlzLl9jb3B5Q29sb3JDb21tYW5kKSkge1xuICAgIHRoaXMuX2NvcHlDb2xvckNvbW1hbmQuZXhlY3V0ZShjb250ZXh0LCBwYXNzU3RhdGUpO1xuICB9XG59O1xuXG5HbG9iZURlcHRoLnByb3RvdHlwZS5leGVjdXRlTWVyZ2VDb2xvciA9IGZ1bmN0aW9uIChjb250ZXh0LCBwYXNzU3RhdGUpIHtcbiAgaWYgKGRlZmluZWQodGhpcy5fbWVyZ2VDb2xvckNvbW1hbmQpKSB7XG4gICAgdGhpcy5fbWVyZ2VDb2xvckNvbW1hbmQuZXhlY3V0ZShjb250ZXh0LCBwYXNzU3RhdGUpO1xuICB9XG59O1xuXG5HbG9iZURlcHRoLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uIChjb250ZXh0LCBwYXNzU3RhdGUsIGNsZWFyQ29sb3IpIHtcbiAgdmFyIGNsZWFyID0gdGhpcy5fY2xlYXJHbG9iZUNvbG9yQ29tbWFuZDtcbiAgaWYgKGRlZmluZWQoY2xlYXIpKSB7XG4gICAgQ29sb3IuY2xvbmUoY2xlYXJDb2xvciwgY2xlYXIuY29sb3IpO1xuICAgIGNsZWFyLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgfVxuICBjbGVhciA9IHRoaXMuX2NsZWFyUHJpbWl0aXZlQ29sb3JDb21tYW5kO1xuICBpZiAoZGVmaW5lZChjbGVhcikgJiYgZGVmaW5lZCh0aGlzLl9wcmltaXRpdmVDb2xvckZyYW1lYnVmZmVyKSkge1xuICAgIGNsZWFyLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgfVxufTtcblxuR2xvYmVEZXB0aC5wcm90b3R5cGUuaXNEZXN0cm95ZWQgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbkdsb2JlRGVwdGgucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gIGRlc3Ryb3lUZXh0dXJlcyh0aGlzKTtcbiAgZGVzdHJveUZyYW1lYnVmZmVycyh0aGlzKTtcbiAgZGVzdHJveVByaW1pdGl2ZUZyYW1lYnVmZmVyKHRoaXMpO1xuICBkZXN0cm95VXBkYXRlRGVwdGhSZXNvdXJjZXModGhpcyk7XG5cbiAgaWYgKGRlZmluZWQodGhpcy5fY29weUNvbG9yQ29tbWFuZCkpIHtcbiAgICB0aGlzLl9jb3B5Q29sb3JDb21tYW5kLnNoYWRlclByb2dyYW0gPSB0aGlzLl9jb3B5Q29sb3JDb21tYW5kLnNoYWRlclByb2dyYW0uZGVzdHJveSgpO1xuICB9XG5cbiAgaWYgKGRlZmluZWQodGhpcy5fY29weURlcHRoQ29tbWFuZCkpIHtcbiAgICB0aGlzLl9jb3B5RGVwdGhDb21tYW5kLnNoYWRlclByb2dyYW0gPSB0aGlzLl9jb3B5RGVwdGhDb21tYW5kLnNoYWRlclByb2dyYW0uZGVzdHJveSgpO1xuICB9XG5cbiAgaWYgKGRlZmluZWQodGhpcy5fdGVtcENvcHlEZXB0aENvbW1hbmQpKSB7XG4gICAgdGhpcy5fdGVtcENvcHlEZXB0aENvbW1hbmQuc2hhZGVyUHJvZ3JhbSA9IHRoaXMuX3RlbXBDb3B5RGVwdGhDb21tYW5kLnNoYWRlclByb2dyYW0uZGVzdHJveSgpO1xuICB9XG5cbiAgaWYgKGRlZmluZWQodGhpcy5fdXBkYXRlRGVwdGhDb21tYW5kKSkge1xuICAgIHRoaXMuX3VwZGF0ZURlcHRoQ29tbWFuZC5zaGFkZXJQcm9ncmFtID0gdGhpcy5fdXBkYXRlRGVwdGhDb21tYW5kLnNoYWRlclByb2dyYW0uZGVzdHJveSgpO1xuICB9XG5cbiAgaWYgKGRlZmluZWQodGhpcy5fbWVyZ2VDb2xvckNvbW1hbmQpKSB7XG4gICAgdGhpcy5fbWVyZ2VDb2xvckNvbW1hbmQuc2hhZGVyUHJvZ3JhbSA9IHRoaXMuX21lcmdlQ29sb3JDb21tYW5kLnNoYWRlclByb2dyYW0uZGVzdHJveSgpO1xuICB9XG5cbiAgaWYgKGRlZmluZWQodGhpcy5fZGVidWdHbG9iZURlcHRoVmlld3BvcnRDb21tYW5kKSkge1xuICAgIHRoaXMuX2RlYnVnR2xvYmVEZXB0aFZpZXdwb3J0Q29tbWFuZC5zaGFkZXJQcm9ncmFtID0gdGhpcy5fZGVidWdHbG9iZURlcHRoVmlld3BvcnRDb21tYW5kLnNoYWRlclByb2dyYW0uZGVzdHJveSgpO1xuICB9XG5cbiAgcmV0dXJuIGRlc3Ryb3lPYmplY3QodGhpcyk7XG59O1xuZXhwb3J0IGRlZmF1bHQgR2xvYmVEZXB0aDtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///55977\n')},55188:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(82982);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(86511);\n/* harmony import */ var _Core_TerrainQuantization_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(735);\n/* harmony import */ var _Renderer_ShaderProgram_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(46588);\n/* harmony import */ var _getClippingFunction_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(84167);\n/* harmony import */ var _SceneMode_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(89917);\n\n\n\n\n\n\n\nfunction GlobeSurfaceShader(\n  numberOfDayTextures,\n  flags,\n  material,\n  shaderProgram,\n  clippingShaderState\n) {\n  this.numberOfDayTextures = numberOfDayTextures;\n  this.flags = flags;\n  this.material = material;\n  this.shaderProgram = shaderProgram;\n  this.clippingShaderState = clippingShaderState;\n}\n\n/**\n * Manages the shaders used to shade the surface of a {@link Globe}.\n *\n * @alias GlobeSurfaceShaderSet\n * @private\n */\nfunction GlobeSurfaceShaderSet() {\n  this.baseVertexShaderSource = undefined;\n  this.baseFragmentShaderSource = undefined;\n\n  this._shadersByTexturesFlags = [];\n\n  this.material = undefined;\n}\n\nfunction getPositionMode(sceneMode) {\n  var getPosition3DMode =\n    "vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }";\n  var getPositionColumbusViewAnd2DMode =\n    "vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }";\n  var getPositionMorphingMode =\n    "vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }";\n\n  var positionMode;\n\n  switch (sceneMode) {\n    case _SceneMode_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].SCENE3D */ .Z.SCENE3D:\n      positionMode = getPosition3DMode;\n      break;\n    case _SceneMode_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].SCENE2D */ .Z.SCENE2D:\n    case _SceneMode_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].COLUMBUS_VIEW */ .Z.COLUMBUS_VIEW:\n      positionMode = getPositionColumbusViewAnd2DMode;\n      break;\n    case _SceneMode_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].MORPHING */ .Z.MORPHING:\n      positionMode = getPositionMorphingMode;\n      break;\n  }\n\n  return positionMode;\n}\n\nfunction get2DYPositionFraction(useWebMercatorProjection) {\n  var get2DYPositionFractionGeographicProjection =\n    "float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }";\n  var get2DYPositionFractionMercatorProjection =\n    "float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }";\n  return useWebMercatorProjection\n    ? get2DYPositionFractionMercatorProjection\n    : get2DYPositionFractionGeographicProjection;\n}\n\nGlobeSurfaceShaderSet.prototype.getShaderProgram = function (options) {\n  var frameState = options.frameState;\n  var surfaceTile = options.surfaceTile;\n  var numberOfDayTextures = options.numberOfDayTextures;\n  var applyBrightness = options.applyBrightness;\n  var applyContrast = options.applyContrast;\n  var applyHue = options.applyHue;\n  var applySaturation = options.applySaturation;\n  var applyGamma = options.applyGamma;\n  var applyAlpha = options.applyAlpha;\n  var applyDayNightAlpha = options.applyDayNightAlpha;\n  var applySplit = options.applySplit;\n  var showReflectiveOcean = options.showReflectiveOcean;\n  var showOceanWaves = options.showOceanWaves;\n  var enableLighting = options.enableLighting;\n  var dynamicAtmosphereLighting = options.dynamicAtmosphereLighting;\n  var dynamicAtmosphereLightingFromSun =\n    options.dynamicAtmosphereLightingFromSun;\n  var showGroundAtmosphere = options.showGroundAtmosphere;\n  var perFragmentGroundAtmosphere = options.perFragmentGroundAtmosphere;\n  var hasVertexNormals = options.hasVertexNormals;\n  var useWebMercatorProjection = options.useWebMercatorProjection;\n  var enableFog = options.enableFog;\n  var enableClippingPlanes = options.enableClippingPlanes;\n  var clippingPlanes = options.clippingPlanes;\n  var clippedByBoundaries = options.clippedByBoundaries;\n  var hasImageryLayerCutout = options.hasImageryLayerCutout;\n  var colorCorrect = options.colorCorrect;\n  var highlightFillTile = options.highlightFillTile;\n  var colorToAlpha = options.colorToAlpha;\n  var hasGeodeticSurfaceNormals = options.hasGeodeticSurfaceNormals;\n  var hasExaggeration = options.hasExaggeration;\n  var showUndergroundColor = options.showUndergroundColor;\n  var translucent = options.translucent;\n\n  var quantization = 0;\n  var quantizationDefine = "";\n\n  var mesh = surfaceTile.renderedMesh;\n  var terrainEncoding = mesh.encoding;\n  var quantizationMode = terrainEncoding.quantization;\n  if (quantizationMode === _Core_TerrainQuantization_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].BITS12 */ .Z.BITS12) {\n    quantization = 1;\n    quantizationDefine = "QUANTIZATION_BITS12";\n  }\n\n  var cartographicLimitRectangleFlag = 0;\n  var cartographicLimitRectangleDefine = "";\n  if (clippedByBoundaries) {\n    cartographicLimitRectangleFlag = 1;\n    cartographicLimitRectangleDefine = "TILE_LIMIT_RECTANGLE";\n  }\n\n  var imageryCutoutFlag = 0;\n  var imageryCutoutDefine = "";\n  if (hasImageryLayerCutout) {\n    imageryCutoutFlag = 1;\n    imageryCutoutDefine = "APPLY_IMAGERY_CUTOUT";\n  }\n\n  var sceneMode = frameState.mode;\n  var flags =\n    sceneMode |\n    (applyBrightness << 2) |\n    (applyContrast << 3) |\n    (applyHue << 4) |\n    (applySaturation << 5) |\n    (applyGamma << 6) |\n    (applyAlpha << 7) |\n    (showReflectiveOcean << 8) |\n    (showOceanWaves << 9) |\n    (enableLighting << 10) |\n    (dynamicAtmosphereLighting << 11) |\n    (dynamicAtmosphereLightingFromSun << 12) |\n    (showGroundAtmosphere << 13) |\n    (perFragmentGroundAtmosphere << 14) |\n    (hasVertexNormals << 15) |\n    (useWebMercatorProjection << 16) |\n    (enableFog << 17) |\n    (quantization << 18) |\n    (applySplit << 19) |\n    (enableClippingPlanes << 20) |\n    (cartographicLimitRectangleFlag << 21) |\n    (imageryCutoutFlag << 22) |\n    (colorCorrect << 23) |\n    (highlightFillTile << 24) |\n    (colorToAlpha << 25) |\n    (hasGeodeticSurfaceNormals << 26) |\n    (hasExaggeration << 27) |\n    (showUndergroundColor << 28) |\n    (translucent << 29) |\n    (applyDayNightAlpha << 30);\n\n  var currentClippingShaderState = 0;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(clippingPlanes) && clippingPlanes.length > 0) {\n    currentClippingShaderState = enableClippingPlanes\n      ? clippingPlanes.clippingPlanesState\n      : 0;\n  }\n  var surfaceShader = surfaceTile.surfaceShader;\n  if (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(surfaceShader) &&\n    surfaceShader.numberOfDayTextures === numberOfDayTextures &&\n    surfaceShader.flags === flags &&\n    surfaceShader.material === this.material &&\n    surfaceShader.clippingShaderState === currentClippingShaderState\n  ) {\n    return surfaceShader.shaderProgram;\n  }\n\n  // New tile, or tile changed number of textures, flags, or clipping planes\n  var shadersByFlags = this._shadersByTexturesFlags[numberOfDayTextures];\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(shadersByFlags)) {\n    shadersByFlags = this._shadersByTexturesFlags[numberOfDayTextures] = [];\n  }\n\n  surfaceShader = shadersByFlags[flags];\n  if (\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(surfaceShader) ||\n    surfaceShader.material !== this.material ||\n    surfaceShader.clippingShaderState !== currentClippingShaderState\n  ) {\n    // Cache miss - we\'ve never seen this combination of numberOfDayTextures and flags before.\n    var vs = this.baseVertexShaderSource.clone();\n    var fs = this.baseFragmentShaderSource.clone();\n\n    if (currentClippingShaderState !== 0) {\n      fs.sources.unshift(\n        (0,_getClippingFunction_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z)(clippingPlanes, frameState.context)\n      ); // Need to go before GlobeFS\n    }\n\n    vs.defines.push(quantizationDefine);\n    fs.defines.push(\n      "TEXTURE_UNITS " + numberOfDayTextures,\n      cartographicLimitRectangleDefine,\n      imageryCutoutDefine\n    );\n\n    if (applyBrightness) {\n      fs.defines.push("APPLY_BRIGHTNESS");\n    }\n    if (applyContrast) {\n      fs.defines.push("APPLY_CONTRAST");\n    }\n    if (applyHue) {\n      fs.defines.push("APPLY_HUE");\n    }\n    if (applySaturation) {\n      fs.defines.push("APPLY_SATURATION");\n    }\n    if (applyGamma) {\n      fs.defines.push("APPLY_GAMMA");\n    }\n    if (applyAlpha) {\n      fs.defines.push("APPLY_ALPHA");\n    }\n    if (applyDayNightAlpha) {\n      fs.defines.push("APPLY_DAY_NIGHT_ALPHA");\n    }\n    if (showReflectiveOcean) {\n      fs.defines.push("SHOW_REFLECTIVE_OCEAN");\n      vs.defines.push("SHOW_REFLECTIVE_OCEAN");\n    }\n    if (showOceanWaves) {\n      fs.defines.push("SHOW_OCEAN_WAVES");\n    }\n    if (colorToAlpha) {\n      fs.defines.push("APPLY_COLOR_TO_ALPHA");\n    }\n    if (showUndergroundColor) {\n      vs.defines.push("UNDERGROUND_COLOR");\n      fs.defines.push("UNDERGROUND_COLOR");\n    }\n    if (translucent) {\n      vs.defines.push("TRANSLUCENT");\n      fs.defines.push("TRANSLUCENT");\n    }\n    if (enableLighting) {\n      if (hasVertexNormals) {\n        vs.defines.push("ENABLE_VERTEX_LIGHTING");\n        fs.defines.push("ENABLE_VERTEX_LIGHTING");\n      } else {\n        vs.defines.push("ENABLE_DAYNIGHT_SHADING");\n        fs.defines.push("ENABLE_DAYNIGHT_SHADING");\n      }\n    }\n\n    if (dynamicAtmosphereLighting) {\n      fs.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING");\n      if (dynamicAtmosphereLightingFromSun) {\n        fs.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN");\n      }\n    }\n\n    if (showGroundAtmosphere) {\n      vs.defines.push("GROUND_ATMOSPHERE");\n      fs.defines.push("GROUND_ATMOSPHERE");\n      if (perFragmentGroundAtmosphere) {\n        fs.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE");\n      }\n    }\n\n    vs.defines.push("INCLUDE_WEB_MERCATOR_Y");\n    fs.defines.push("INCLUDE_WEB_MERCATOR_Y");\n\n    if (enableFog) {\n      vs.defines.push("FOG");\n      fs.defines.push("FOG");\n    }\n\n    if (applySplit) {\n      fs.defines.push("APPLY_SPLIT");\n    }\n\n    if (enableClippingPlanes) {\n      fs.defines.push("ENABLE_CLIPPING_PLANES");\n    }\n\n    if (colorCorrect) {\n      fs.defines.push("COLOR_CORRECT");\n    }\n\n    if (highlightFillTile) {\n      fs.defines.push("HIGHLIGHT_FILL_TILE");\n    }\n\n    if (hasGeodeticSurfaceNormals) {\n      vs.defines.push("GEODETIC_SURFACE_NORMALS");\n    }\n\n    if (hasExaggeration) {\n      vs.defines.push("EXAGGERATION");\n    }\n\n    var computeDayColor =\n      "\\\n    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend)\\n\\\n    {\\n\\\n        vec4 color = initialColor;\\n";\n\n    if (hasImageryLayerCutout) {\n      computeDayColor +=\n        "\\\n        vec4 cutoutAndColorResult;\\n\\\n        bool texelUnclipped;\\n";\n    }\n\n    for (var i = 0; i < numberOfDayTextures; ++i) {\n      if (hasImageryLayerCutout) {\n        computeDayColor +=\n          "\\\n        cutoutAndColorResult = u_dayTextureCutoutRectangles[" +\n          i +\n          "];\\n\\\n        texelUnclipped = v_textureCoordinates.x < cutoutAndColorResult.x || cutoutAndColorResult.z < v_textureCoordinates.x || v_textureCoordinates.y < cutoutAndColorResult.y || cutoutAndColorResult.w < v_textureCoordinates.y;\\n\\\n        cutoutAndColorResult = sampleAndBlend(\\n";\n      } else {\n        computeDayColor += "\\\n        color = sampleAndBlend(\\n";\n      }\n      computeDayColor +=\n        "\\\n            color,\\n\\\n            u_dayTextures[" +\n        i +\n        "],\\n\\\n            u_dayTextureUseWebMercatorT[" +\n        i +\n        "] ? textureCoordinates.xz : textureCoordinates.xy,\\n\\\n            u_dayTextureTexCoordsRectangle[" +\n        i +\n        "],\\n\\\n            u_dayTextureTranslationAndScale[" +\n        i +\n        "],\\n\\\n            " +\n        (applyAlpha ? "u_dayTextureAlpha[" + i + "]" : "1.0") +\n        ",\\n\\\n            " +\n        (applyDayNightAlpha ? "u_dayTextureNightAlpha[" + i + "]" : "1.0") +\n        ",\\n" +\n        (applyDayNightAlpha ? "u_dayTextureDayAlpha[" + i + "]" : "1.0") +\n        ",\\n" +\n        (applyBrightness ? "u_dayTextureBrightness[" + i + "]" : "0.0") +\n        ",\\n\\\n            " +\n        (applyContrast ? "u_dayTextureContrast[" + i + "]" : "0.0") +\n        ",\\n\\\n            " +\n        (applyHue ? "u_dayTextureHue[" + i + "]" : "0.0") +\n        ",\\n\\\n            " +\n        (applySaturation ? "u_dayTextureSaturation[" + i + "]" : "0.0") +\n        ",\\n\\\n            " +\n        (applyGamma ? "u_dayTextureOneOverGamma[" + i + "]" : "0.0") +\n        ",\\n\\\n            " +\n        (applySplit ? "u_dayTextureSplit[" + i + "]" : "0.0") +\n        ",\\n\\\n            " +\n        (colorToAlpha ? "u_colorsToAlpha[" + i + "]" : "vec4(0.0)") +\n        ",\\n\\\n        nightBlend\\\n        );\\n";\n      if (hasImageryLayerCutout) {\n        computeDayColor +=\n          "\\\n        color = czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);\\n";\n      }\n    }\n\n    computeDayColor += "\\\n        return color;\\n\\\n    }";\n\n    fs.sources.push(computeDayColor);\n\n    vs.sources.push(getPositionMode(sceneMode));\n    vs.sources.push(get2DYPositionFraction(useWebMercatorProjection));\n\n    var shader = _Renderer_ShaderProgram_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].fromCache */ .Z.fromCache({\n      context: frameState.context,\n      vertexShaderSource: vs,\n      fragmentShaderSource: fs,\n      attributeLocations: terrainEncoding.getAttributeLocations(),\n    });\n\n    surfaceShader = shadersByFlags[flags] = new GlobeSurfaceShader(\n      numberOfDayTextures,\n      flags,\n      this.material,\n      shader,\n      currentClippingShaderState\n    );\n  }\n\n  surfaceTile.surfaceShader = surfaceShader;\n  return surfaceShader.shaderProgram;\n};\n\nGlobeSurfaceShaderSet.prototype.destroy = function () {\n  var flags;\n  var shader;\n\n  var shadersByTexturesFlags = this._shadersByTexturesFlags;\n  for (var textureCount in shadersByTexturesFlags) {\n    if (shadersByTexturesFlags.hasOwnProperty(textureCount)) {\n      var shadersByFlags = shadersByTexturesFlags[textureCount];\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(shadersByFlags)) {\n        continue;\n      }\n\n      for (flags in shadersByFlags) {\n        if (shadersByFlags.hasOwnProperty(flags)) {\n          shader = shadersByFlags[flags];\n          if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z)(shader)) {\n            shader.shaderProgram.destroy();\n          }\n        }\n      }\n    }\n  }\n\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z)(this);\n};\n/* harmony default export */ __webpack_exports__["Z"] = (GlobeSurfaceShaderSet);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2Isa09BQWtPO0FBQ2xPO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0EsbUZBQW1GO0FBQ25GO0FBQ0E7O0FBRUE7QUFDQSxxQkFBcUI7QUFDckIsS0FBSzs7QUFFTDs7QUFFQTtBQUNBOztBQUVBLGlCQUFpQiwrRkFBdUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcscUVBQU87QUFDbEI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLHFFQUFPO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTLDJFQUFhO0FBQ3RCO0FBQ0EseURBQWUscUJBQXFCLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92dWUzLXdlYnBhY2s1Ly4vbm9kZV9tb2R1bGVzL2Nlc2l1bS9Tb3VyY2UvU2NlbmUvR2xvYmVTdXJmYWNlU2hhZGVyU2V0LmpzPzdjMTQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGRlZmluZWQgZnJvbSBcIi4uL0NvcmUvZGVmaW5lZC5qc1wiO1xuaW1wb3J0IGRlc3Ryb3lPYmplY3QgZnJvbSBcIi4uL0NvcmUvZGVzdHJveU9iamVjdC5qc1wiO1xuaW1wb3J0IFRlcnJhaW5RdWFudGl6YXRpb24gZnJvbSBcIi4uL0NvcmUvVGVycmFpblF1YW50aXphdGlvbi5qc1wiO1xuaW1wb3J0IFNoYWRlclByb2dyYW0gZnJvbSBcIi4uL1JlbmRlcmVyL1NoYWRlclByb2dyYW0uanNcIjtcbmltcG9ydCBnZXRDbGlwcGluZ0Z1bmN0aW9uIGZyb20gXCIuL2dldENsaXBwaW5nRnVuY3Rpb24uanNcIjtcbmltcG9ydCBTY2VuZU1vZGUgZnJvbSBcIi4vU2NlbmVNb2RlLmpzXCI7XG5cbmZ1bmN0aW9uIEdsb2JlU3VyZmFjZVNoYWRlcihcbiAgbnVtYmVyT2ZEYXlUZXh0dXJlcyxcbiAgZmxhZ3MsXG4gIG1hdGVyaWFsLFxuICBzaGFkZXJQcm9ncmFtLFxuICBjbGlwcGluZ1NoYWRlclN0YXRlXG4pIHtcbiAgdGhpcy5udW1iZXJPZkRheVRleHR1cmVzID0gbnVtYmVyT2ZEYXlUZXh0dXJlcztcbiAgdGhpcy5mbGFncyA9IGZsYWdzO1xuICB0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7XG4gIHRoaXMuc2hhZGVyUHJvZ3JhbSA9IHNoYWRlclByb2dyYW07XG4gIHRoaXMuY2xpcHBpbmdTaGFkZXJTdGF0ZSA9IGNsaXBwaW5nU2hhZGVyU3RhdGU7XG59XG5cbi8qKlxuICogTWFuYWdlcyB0aGUgc2hhZGVycyB1c2VkIHRvIHNoYWRlIHRoZSBzdXJmYWNlIG9mIGEge0BsaW5rIEdsb2JlfS5cbiAqXG4gKiBAYWxpYXMgR2xvYmVTdXJmYWNlU2hhZGVyU2V0XG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBHbG9iZVN1cmZhY2VTaGFkZXJTZXQoKSB7XG4gIHRoaXMuYmFzZVZlcnRleFNoYWRlclNvdXJjZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5iYXNlRnJhZ21lbnRTaGFkZXJTb3VyY2UgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fc2hhZGVyc0J5VGV4dHVyZXNGbGFncyA9IFtdO1xuXG4gIHRoaXMubWF0ZXJpYWwgPSB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIGdldFBvc2l0aW9uTW9kZShzY2VuZU1vZGUpIHtcbiAgdmFyIGdldFBvc2l0aW9uM0RNb2RlID1cbiAgICBcInZlYzQgZ2V0UG9zaXRpb24odmVjMyBwb3NpdGlvbiwgZmxvYXQgaGVpZ2h0LCB2ZWMyIHRleHR1cmVDb29yZGluYXRlcykgeyByZXR1cm4gZ2V0UG9zaXRpb24zRE1vZGUocG9zaXRpb24sIGhlaWdodCwgdGV4dHVyZUNvb3JkaW5hdGVzKTsgfVwiO1xuICB2YXIgZ2V0UG9zaXRpb25Db2x1bWJ1c1ZpZXdBbmQyRE1vZGUgPVxuICAgIFwidmVjNCBnZXRQb3NpdGlvbih2ZWMzIHBvc2l0aW9uLCBmbG9hdCBoZWlnaHQsIHZlYzIgdGV4dHVyZUNvb3JkaW5hdGVzKSB7IHJldHVybiBnZXRQb3NpdGlvbkNvbHVtYnVzVmlld01vZGUocG9zaXRpb24sIGhlaWdodCwgdGV4dHVyZUNvb3JkaW5hdGVzKTsgfVwiO1xuICB2YXIgZ2V0UG9zaXRpb25Nb3JwaGluZ01vZGUgPVxuICAgIFwidmVjNCBnZXRQb3NpdGlvbih2ZWMzIHBvc2l0aW9uLCBmbG9hdCBoZWlnaHQsIHZlYzIgdGV4dHVyZUNvb3JkaW5hdGVzKSB7IHJldHVybiBnZXRQb3NpdGlvbk1vcnBoaW5nTW9kZShwb3NpdGlvbiwgaGVpZ2h0LCB0ZXh0dXJlQ29vcmRpbmF0ZXMpOyB9XCI7XG5cbiAgdmFyIHBvc2l0aW9uTW9kZTtcblxuICBzd2l0Y2ggKHNjZW5lTW9kZSkge1xuICAgIGNhc2UgU2NlbmVNb2RlLlNDRU5FM0Q6XG4gICAgICBwb3NpdGlvbk1vZGUgPSBnZXRQb3NpdGlvbjNETW9kZTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgU2NlbmVNb2RlLlNDRU5FMkQ6XG4gICAgY2FzZSBTY2VuZU1vZGUuQ09MVU1CVVNfVklFVzpcbiAgICAgIHBvc2l0aW9uTW9kZSA9IGdldFBvc2l0aW9uQ29sdW1idXNWaWV3QW5kMkRNb2RlO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBTY2VuZU1vZGUuTU9SUEhJTkc6XG4gICAgICBwb3NpdGlvbk1vZGUgPSBnZXRQb3NpdGlvbk1vcnBoaW5nTW9kZTtcbiAgICAgIGJyZWFrO1xuICB9XG5cbiAgcmV0dXJuIHBvc2l0aW9uTW9kZTtcbn1cblxuZnVuY3Rpb24gZ2V0MkRZUG9zaXRpb25GcmFjdGlvbih1c2VXZWJNZXJjYXRvclByb2plY3Rpb24pIHtcbiAgdmFyIGdldDJEWVBvc2l0aW9uRnJhY3Rpb25HZW9ncmFwaGljUHJvamVjdGlvbiA9XG4gICAgXCJmbG9hdCBnZXQyRFlQb3NpdGlvbkZyYWN0aW9uKHZlYzIgdGV4dHVyZUNvb3JkaW5hdGVzKSB7IHJldHVybiBnZXQyREdlb2dyYXBoaWNZUG9zaXRpb25GcmFjdGlvbih0ZXh0dXJlQ29vcmRpbmF0ZXMpOyB9XCI7XG4gIHZhciBnZXQyRFlQb3NpdGlvbkZyYWN0aW9uTWVyY2F0b3JQcm9qZWN0aW9uID1cbiAgICBcImZsb2F0IGdldDJEWVBvc2l0aW9uRnJhY3Rpb24odmVjMiB0ZXh0dXJlQ29vcmRpbmF0ZXMpIHsgcmV0dXJuIGdldDJETWVyY2F0b3JZUG9zaXRpb25GcmFjdGlvbih0ZXh0dXJlQ29vcmRpbmF0ZXMpOyB9XCI7XG4gIHJldHVybiB1c2VXZWJNZXJjYXRvclByb2plY3Rpb25cbiAgICA/IGdldDJEWVBvc2l0aW9uRnJhY3Rpb25NZXJjYXRvclByb2plY3Rpb25cbiAgICA6IGdldDJEWVBvc2l0aW9uRnJhY3Rpb25HZW9ncmFwaGljUHJvamVjdGlvbjtcbn1cblxuR2xvYmVTdXJmYWNlU2hhZGVyU2V0LnByb3RvdHlwZS5nZXRTaGFkZXJQcm9ncmFtID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgdmFyIGZyYW1lU3RhdGUgPSBvcHRpb25zLmZyYW1lU3RhdGU7XG4gIHZhciBzdXJmYWNlVGlsZSA9IG9wdGlvbnMuc3VyZmFjZVRpbGU7XG4gIHZhciBudW1iZXJPZkRheVRleHR1cmVzID0gb3B0aW9ucy5udW1iZXJPZkRheVRleHR1cmVzO1xuICB2YXIgYXBwbHlCcmlnaHRuZXNzID0gb3B0aW9ucy5hcHBseUJyaWdodG5lc3M7XG4gIHZhciBhcHBseUNvbnRyYXN0ID0gb3B0aW9ucy5hcHBseUNvbnRyYXN0O1xuICB2YXIgYXBwbHlIdWUgPSBvcHRpb25zLmFwcGx5SHVlO1xuICB2YXIgYXBwbHlTYXR1cmF0aW9uID0gb3B0aW9ucy5hcHBseVNhdHVyYXRpb247XG4gIHZhciBhcHBseUdhbW1hID0gb3B0aW9ucy5hcHBseUdhbW1hO1xuICB2YXIgYXBwbHlBbHBoYSA9IG9wdGlvbnMuYXBwbHlBbHBoYTtcbiAgdmFyIGFwcGx5RGF5TmlnaHRBbHBoYSA9IG9wdGlvbnMuYXBwbHlEYXlOaWdodEFscGhhO1xuICB2YXIgYXBwbHlTcGxpdCA9IG9wdGlvbnMuYXBwbHlTcGxpdDtcbiAgdmFyIHNob3dSZWZsZWN0aXZlT2NlYW4gPSBvcHRpb25zLnNob3dSZWZsZWN0aXZlT2NlYW47XG4gIHZhciBzaG93T2NlYW5XYXZlcyA9IG9wdGlvbnMuc2hvd09jZWFuV2F2ZXM7XG4gIHZhciBlbmFibGVMaWdodGluZyA9IG9wdGlvbnMuZW5hYmxlTGlnaHRpbmc7XG4gIHZhciBkeW5hbWljQXRtb3NwaGVyZUxpZ2h0aW5nID0gb3B0aW9ucy5keW5hbWljQXRtb3NwaGVyZUxpZ2h0aW5nO1xuICB2YXIgZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZ0Zyb21TdW4gPVxuICAgIG9wdGlvbnMuZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZ0Zyb21TdW47XG4gIHZhciBzaG93R3JvdW5kQXRtb3NwaGVyZSA9IG9wdGlvbnMuc2hvd0dyb3VuZEF0bW9zcGhlcmU7XG4gIHZhciBwZXJGcmFnbWVudEdyb3VuZEF0bW9zcGhlcmUgPSBvcHRpb25zLnBlckZyYWdtZW50R3JvdW5kQXRtb3NwaGVyZTtcbiAgdmFyIGhhc1ZlcnRleE5vcm1hbHMgPSBvcHRpb25zLmhhc1ZlcnRleE5vcm1hbHM7XG4gIHZhciB1c2VXZWJNZXJjYXRvclByb2plY3Rpb24gPSBvcHRpb25zLnVzZVdlYk1lcmNhdG9yUHJvamVjdGlvbjtcbiAgdmFyIGVuYWJsZUZvZyA9IG9wdGlvbnMuZW5hYmxlRm9nO1xuICB2YXIgZW5hYmxlQ2xpcHBpbmdQbGFuZXMgPSBvcHRpb25zLmVuYWJsZUNsaXBwaW5nUGxhbmVzO1xuICB2YXIgY2xpcHBpbmdQbGFuZXMgPSBvcHRpb25zLmNsaXBwaW5nUGxhbmVzO1xuICB2YXIgY2xpcHBlZEJ5Qm91bmRhcmllcyA9IG9wdGlvbnMuY2xpcHBlZEJ5Qm91bmRhcmllcztcbiAgdmFyIGhhc0ltYWdlcnlMYXllckN1dG91dCA9IG9wdGlvbnMuaGFzSW1hZ2VyeUxheWVyQ3V0b3V0O1xuICB2YXIgY29sb3JDb3JyZWN0ID0gb3B0aW9ucy5jb2xvckNvcnJlY3Q7XG4gIHZhciBoaWdobGlnaHRGaWxsVGlsZSA9IG9wdGlvbnMuaGlnaGxpZ2h0RmlsbFRpbGU7XG4gIHZhciBjb2xvclRvQWxwaGEgPSBvcHRpb25zLmNvbG9yVG9BbHBoYTtcbiAgdmFyIGhhc0dlb2RldGljU3VyZmFjZU5vcm1hbHMgPSBvcHRpb25zLmhhc0dlb2RldGljU3VyZmFjZU5vcm1hbHM7XG4gIHZhciBoYXNFeGFnZ2VyYXRpb24gPSBvcHRpb25zLmhhc0V4YWdnZXJhdGlvbjtcbiAgdmFyIHNob3dVbmRlcmdyb3VuZENvbG9yID0gb3B0aW9ucy5zaG93VW5kZXJncm91bmRDb2xvcjtcbiAgdmFyIHRyYW5zbHVjZW50ID0gb3B0aW9ucy50cmFuc2x1Y2VudDtcblxuICB2YXIgcXVhbnRpemF0aW9uID0gMDtcbiAgdmFyIHF1YW50aXphdGlvbkRlZmluZSA9IFwiXCI7XG5cbiAgdmFyIG1lc2ggPSBzdXJmYWNlVGlsZS5yZW5kZXJlZE1lc2g7XG4gIHZhciB0ZXJyYWluRW5jb2RpbmcgPSBtZXNoLmVuY29kaW5nO1xuICB2YXIgcXVhbnRpemF0aW9uTW9kZSA9IHRlcnJhaW5FbmNvZGluZy5xdWFudGl6YXRpb247XG4gIGlmIChxdWFudGl6YXRpb25Nb2RlID09PSBUZXJyYWluUXVhbnRpemF0aW9uLkJJVFMxMikge1xuICAgIHF1YW50aXphdGlvbiA9IDE7XG4gICAgcXVhbnRpemF0aW9uRGVmaW5lID0gXCJRVUFOVElaQVRJT05fQklUUzEyXCI7XG4gIH1cblxuICB2YXIgY2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGVGbGFnID0gMDtcbiAgdmFyIGNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlRGVmaW5lID0gXCJcIjtcbiAgaWYgKGNsaXBwZWRCeUJvdW5kYXJpZXMpIHtcbiAgICBjYXJ0b2dyYXBoaWNMaW1pdFJlY3RhbmdsZUZsYWcgPSAxO1xuICAgIGNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlRGVmaW5lID0gXCJUSUxFX0xJTUlUX1JFQ1RBTkdMRVwiO1xuICB9XG5cbiAgdmFyIGltYWdlcnlDdXRvdXRGbGFnID0gMDtcbiAgdmFyIGltYWdlcnlDdXRvdXREZWZpbmUgPSBcIlwiO1xuICBpZiAoaGFzSW1hZ2VyeUxheWVyQ3V0b3V0KSB7XG4gICAgaW1hZ2VyeUN1dG91dEZsYWcgPSAxO1xuICAgIGltYWdlcnlDdXRvdXREZWZpbmUgPSBcIkFQUExZX0lNQUdFUllfQ1VUT1VUXCI7XG4gIH1cblxuICB2YXIgc2NlbmVNb2RlID0gZnJhbWVTdGF0ZS5tb2RlO1xuICB2YXIgZmxhZ3MgPVxuICAgIHNjZW5lTW9kZSB8XG4gICAgKGFwcGx5QnJpZ2h0bmVzcyA8PCAyKSB8XG4gICAgKGFwcGx5Q29udHJhc3QgPDwgMykgfFxuICAgIChhcHBseUh1ZSA8PCA0KSB8XG4gICAgKGFwcGx5U2F0dXJhdGlvbiA8PCA1KSB8XG4gICAgKGFwcGx5R2FtbWEgPDwgNikgfFxuICAgIChhcHBseUFscGhhIDw8IDcpIHxcbiAgICAoc2hvd1JlZmxlY3RpdmVPY2VhbiA8PCA4KSB8XG4gICAgKHNob3dPY2VhbldhdmVzIDw8IDkpIHxcbiAgICAoZW5hYmxlTGlnaHRpbmcgPDwgMTApIHxcbiAgICAoZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZyA8PCAxMSkgfFxuICAgIChkeW5hbWljQXRtb3NwaGVyZUxpZ2h0aW5nRnJvbVN1biA8PCAxMikgfFxuICAgIChzaG93R3JvdW5kQXRtb3NwaGVyZSA8PCAxMykgfFxuICAgIChwZXJGcmFnbWVudEdyb3VuZEF0bW9zcGhlcmUgPDwgMTQpIHxcbiAgICAoaGFzVmVydGV4Tm9ybWFscyA8PCAxNSkgfFxuICAgICh1c2VXZWJNZXJjYXRvclByb2plY3Rpb24gPDwgMTYpIHxcbiAgICAoZW5hYmxlRm9nIDw8IDE3KSB8XG4gICAgKHF1YW50aXphdGlvbiA8PCAxOCkgfFxuICAgIChhcHBseVNwbGl0IDw8IDE5KSB8XG4gICAgKGVuYWJsZUNsaXBwaW5nUGxhbmVzIDw8IDIwKSB8XG4gICAgKGNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlRmxhZyA8PCAyMSkgfFxuICAgIChpbWFnZXJ5Q3V0b3V0RmxhZyA8PCAyMikgfFxuICAgIChjb2xvckNvcnJlY3QgPDwgMjMpIHxcbiAgICAoaGlnaGxpZ2h0RmlsbFRpbGUgPDwgMjQpIHxcbiAgICAoY29sb3JUb0FscGhhIDw8IDI1KSB8XG4gICAgKGhhc0dlb2RldGljU3VyZmFjZU5vcm1hbHMgPDwgMjYpIHxcbiAgICAoaGFzRXhhZ2dlcmF0aW9uIDw8IDI3KSB8XG4gICAgKHNob3dVbmRlcmdyb3VuZENvbG9yIDw8IDI4KSB8XG4gICAgKHRyYW5zbHVjZW50IDw8IDI5KSB8XG4gICAgKGFwcGx5RGF5TmlnaHRBbHBoYSA8PCAzMCk7XG5cbiAgdmFyIGN1cnJlbnRDbGlwcGluZ1NoYWRlclN0YXRlID0gMDtcbiAgaWYgKGRlZmluZWQoY2xpcHBpbmdQbGFuZXMpICYmIGNsaXBwaW5nUGxhbmVzLmxlbmd0aCA+IDApIHtcbiAgICBjdXJyZW50Q2xpcHBpbmdTaGFkZXJTdGF0ZSA9IGVuYWJsZUNsaXBwaW5nUGxhbmVzXG4gICAgICA/IGNsaXBwaW5nUGxhbmVzLmNsaXBwaW5nUGxhbmVzU3RhdGVcbiAgICAgIDogMDtcbiAgfVxuICB2YXIgc3VyZmFjZVNoYWRlciA9IHN1cmZhY2VUaWxlLnN1cmZhY2VTaGFkZXI7XG4gIGlmIChcbiAgICBkZWZpbmVkKHN1cmZhY2VTaGFkZXIpICYmXG4gICAgc3VyZmFjZVNoYWRlci5udW1iZXJPZkRheVRleHR1cmVzID09PSBudW1iZXJPZkRheVRleHR1cmVzICYmXG4gICAgc3VyZmFjZVNoYWRlci5mbGFncyA9PT0gZmxhZ3MgJiZcbiAgICBzdXJmYWNlU2hhZGVyLm1hdGVyaWFsID09PSB0aGlzLm1hdGVyaWFsICYmXG4gICAgc3VyZmFjZVNoYWRlci5jbGlwcGluZ1NoYWRlclN0YXRlID09PSBjdXJyZW50Q2xpcHBpbmdTaGFkZXJTdGF0ZVxuICApIHtcbiAgICByZXR1cm4gc3VyZmFjZVNoYWRlci5zaGFkZXJQcm9ncmFtO1xuICB9XG5cbiAgLy8gTmV3IHRpbGUsIG9yIHRpbGUgY2hhbmdlZCBudW1iZXIgb2YgdGV4dHVyZXMsIGZsYWdzLCBvciBjbGlwcGluZyBwbGFuZXNcbiAgdmFyIHNoYWRlcnNCeUZsYWdzID0gdGhpcy5fc2hhZGVyc0J5VGV4dHVyZXNGbGFnc1tudW1iZXJPZkRheVRleHR1cmVzXTtcbiAgaWYgKCFkZWZpbmVkKHNoYWRlcnNCeUZsYWdzKSkge1xuICAgIHNoYWRlcnNCeUZsYWdzID0gdGhpcy5fc2hhZGVyc0J5VGV4dHVyZXNGbGFnc1tudW1iZXJPZkRheVRleHR1cmVzXSA9IFtdO1xuICB9XG5cbiAgc3VyZmFjZVNoYWRlciA9IHNoYWRlcnNCeUZsYWdzW2ZsYWdzXTtcbiAgaWYgKFxuICAgICFkZWZpbmVkKHN1cmZhY2VTaGFkZXIpIHx8XG4gICAgc3VyZmFjZVNoYWRlci5tYXRlcmlhbCAhPT0gdGhpcy5tYXRlcmlhbCB8fFxuICAgIHN1cmZhY2VTaGFkZXIuY2xpcHBpbmdTaGFkZXJTdGF0ZSAhPT0gY3VycmVudENsaXBwaW5nU2hhZGVyU3RhdGVcbiAgKSB7XG4gICAgLy8gQ2FjaGUgbWlzcyAtIHdlJ3ZlIG5ldmVyIHNlZW4gdGhpcyBjb21iaW5hdGlvbiBvZiBudW1iZXJPZkRheVRleHR1cmVzIGFuZCBmbGFncyBiZWZvcmUuXG4gICAgdmFyIHZzID0gdGhpcy5iYXNlVmVydGV4U2hhZGVyU291cmNlLmNsb25lKCk7XG4gICAgdmFyIGZzID0gdGhpcy5iYXNlRnJhZ21lbnRTaGFkZXJTb3VyY2UuY2xvbmUoKTtcblxuICAgIGlmIChjdXJyZW50Q2xpcHBpbmdTaGFkZXJTdGF0ZSAhPT0gMCkge1xuICAgICAgZnMuc291cmNlcy51bnNoaWZ0KFxuICAgICAgICBnZXRDbGlwcGluZ0Z1bmN0aW9uKGNsaXBwaW5nUGxhbmVzLCBmcmFtZVN0YXRlLmNvbnRleHQpXG4gICAgICApOyAvLyBOZWVkIHRvIGdvIGJlZm9yZSBHbG9iZUZTXG4gICAgfVxuXG4gICAgdnMuZGVmaW5lcy5wdXNoKHF1YW50aXphdGlvbkRlZmluZSk7XG4gICAgZnMuZGVmaW5lcy5wdXNoKFxuICAgICAgXCJURVhUVVJFX1VOSVRTIFwiICsgbnVtYmVyT2ZEYXlUZXh0dXJlcyxcbiAgICAgIGNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlRGVmaW5lLFxuICAgICAgaW1hZ2VyeUN1dG91dERlZmluZVxuICAgICk7XG5cbiAgICBpZiAoYXBwbHlCcmlnaHRuZXNzKSB7XG4gICAgICBmcy5kZWZpbmVzLnB1c2goXCJBUFBMWV9CUklHSFRORVNTXCIpO1xuICAgIH1cbiAgICBpZiAoYXBwbHlDb250cmFzdCkge1xuICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiQVBQTFlfQ09OVFJBU1RcIik7XG4gICAgfVxuICAgIGlmIChhcHBseUh1ZSkge1xuICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiQVBQTFlfSFVFXCIpO1xuICAgIH1cbiAgICBpZiAoYXBwbHlTYXR1cmF0aW9uKSB7XG4gICAgICBmcy5kZWZpbmVzLnB1c2goXCJBUFBMWV9TQVRVUkFUSU9OXCIpO1xuICAgIH1cbiAgICBpZiAoYXBwbHlHYW1tYSkge1xuICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiQVBQTFlfR0FNTUFcIik7XG4gICAgfVxuICAgIGlmIChhcHBseUFscGhhKSB7XG4gICAgICBmcy5kZWZpbmVzLnB1c2goXCJBUFBMWV9BTFBIQVwiKTtcbiAgICB9XG4gICAgaWYgKGFwcGx5RGF5TmlnaHRBbHBoYSkge1xuICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiQVBQTFlfREFZX05JR0hUX0FMUEhBXCIpO1xuICAgIH1cbiAgICBpZiAoc2hvd1JlZmxlY3RpdmVPY2Vhbikge1xuICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiU0hPV19SRUZMRUNUSVZFX09DRUFOXCIpO1xuICAgICAgdnMuZGVmaW5lcy5wdXNoKFwiU0hPV19SRUZMRUNUSVZFX09DRUFOXCIpO1xuICAgIH1cbiAgICBpZiAoc2hvd09jZWFuV2F2ZXMpIHtcbiAgICAgIGZzLmRlZmluZXMucHVzaChcIlNIT1dfT0NFQU5fV0FWRVNcIik7XG4gICAgfVxuICAgIGlmIChjb2xvclRvQWxwaGEpIHtcbiAgICAgIGZzLmRlZmluZXMucHVzaChcIkFQUExZX0NPTE9SX1RPX0FMUEhBXCIpO1xuICAgIH1cbiAgICBpZiAoc2hvd1VuZGVyZ3JvdW5kQ29sb3IpIHtcbiAgICAgIHZzLmRlZmluZXMucHVzaChcIlVOREVSR1JPVU5EX0NPTE9SXCIpO1xuICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiVU5ERVJHUk9VTkRfQ09MT1JcIik7XG4gICAgfVxuICAgIGlmICh0cmFuc2x1Y2VudCkge1xuICAgICAgdnMuZGVmaW5lcy5wdXNoKFwiVFJBTlNMVUNFTlRcIik7XG4gICAgICBmcy5kZWZpbmVzLnB1c2goXCJUUkFOU0xVQ0VOVFwiKTtcbiAgICB9XG4gICAgaWYgKGVuYWJsZUxpZ2h0aW5nKSB7XG4gICAgICBpZiAoaGFzVmVydGV4Tm9ybWFscykge1xuICAgICAgICB2cy5kZWZpbmVzLnB1c2goXCJFTkFCTEVfVkVSVEVYX0xJR0hUSU5HXCIpO1xuICAgICAgICBmcy5kZWZpbmVzLnB1c2goXCJFTkFCTEVfVkVSVEVYX0xJR0hUSU5HXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdnMuZGVmaW5lcy5wdXNoKFwiRU5BQkxFX0RBWU5JR0hUX1NIQURJTkdcIik7XG4gICAgICAgIGZzLmRlZmluZXMucHVzaChcIkVOQUJMRV9EQVlOSUdIVF9TSEFESU5HXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkeW5hbWljQXRtb3NwaGVyZUxpZ2h0aW5nKSB7XG4gICAgICBmcy5kZWZpbmVzLnB1c2goXCJEWU5BTUlDX0FUTU9TUEhFUkVfTElHSFRJTkdcIik7XG4gICAgICBpZiAoZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZ0Zyb21TdW4pIHtcbiAgICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiRFlOQU1JQ19BVE1PU1BIRVJFX0xJR0hUSU5HX0ZST01fU1VOXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzaG93R3JvdW5kQXRtb3NwaGVyZSkge1xuICAgICAgdnMuZGVmaW5lcy5wdXNoKFwiR1JPVU5EX0FUTU9TUEhFUkVcIik7XG4gICAgICBmcy5kZWZpbmVzLnB1c2goXCJHUk9VTkRfQVRNT1NQSEVSRVwiKTtcbiAgICAgIGlmIChwZXJGcmFnbWVudEdyb3VuZEF0bW9zcGhlcmUpIHtcbiAgICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiUEVSX0ZSQUdNRU5UX0dST1VORF9BVE1PU1BIRVJFXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZzLmRlZmluZXMucHVzaChcIklOQ0xVREVfV0VCX01FUkNBVE9SX1lcIik7XG4gICAgZnMuZGVmaW5lcy5wdXNoKFwiSU5DTFVERV9XRUJfTUVSQ0FUT1JfWVwiKTtcblxuICAgIGlmIChlbmFibGVGb2cpIHtcbiAgICAgIHZzLmRlZmluZXMucHVzaChcIkZPR1wiKTtcbiAgICAgIGZzLmRlZmluZXMucHVzaChcIkZPR1wiKTtcbiAgICB9XG5cbiAgICBpZiAoYXBwbHlTcGxpdCkge1xuICAgICAgZnMuZGVmaW5lcy5wdXNoKFwiQVBQTFlfU1BMSVRcIik7XG4gICAgfVxuXG4gICAgaWYgKGVuYWJsZUNsaXBwaW5nUGxhbmVzKSB7XG4gICAgICBmcy5kZWZpbmVzLnB1c2goXCJFTkFCTEVfQ0xJUFBJTkdfUExBTkVTXCIpO1xuICAgIH1cblxuICAgIGlmIChjb2xvckNvcnJlY3QpIHtcbiAgICAgIGZzLmRlZmluZXMucHVzaChcIkNPTE9SX0NPUlJFQ1RcIik7XG4gICAgfVxuXG4gICAgaWYgKGhpZ2hsaWdodEZpbGxUaWxlKSB7XG4gICAgICBmcy5kZWZpbmVzLnB1c2goXCJISUdITElHSFRfRklMTF9USUxFXCIpO1xuICAgIH1cblxuICAgIGlmIChoYXNHZW9kZXRpY1N1cmZhY2VOb3JtYWxzKSB7XG4gICAgICB2cy5kZWZpbmVzLnB1c2goXCJHRU9ERVRJQ19TVVJGQUNFX05PUk1BTFNcIik7XG4gICAgfVxuXG4gICAgaWYgKGhhc0V4YWdnZXJhdGlvbikge1xuICAgICAgdnMuZGVmaW5lcy5wdXNoKFwiRVhBR0dFUkFUSU9OXCIpO1xuICAgIH1cblxuICAgIHZhciBjb21wdXRlRGF5Q29sb3IgPVxuICAgICAgXCJcXFxuICAgIHZlYzQgY29tcHV0ZURheUNvbG9yKHZlYzQgaW5pdGlhbENvbG9yLCB2ZWMzIHRleHR1cmVDb29yZGluYXRlcywgZmxvYXQgbmlnaHRCbGVuZClcXG5cXFxuICAgIHtcXG5cXFxuICAgICAgICB2ZWM0IGNvbG9yID0gaW5pdGlhbENvbG9yO1xcblwiO1xuXG4gICAgaWYgKGhhc0ltYWdlcnlMYXllckN1dG91dCkge1xuICAgICAgY29tcHV0ZURheUNvbG9yICs9XG4gICAgICAgIFwiXFxcbiAgICAgICAgdmVjNCBjdXRvdXRBbmRDb2xvclJlc3VsdDtcXG5cXFxuICAgICAgICBib29sIHRleGVsVW5jbGlwcGVkO1xcblwiO1xuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtYmVyT2ZEYXlUZXh0dXJlczsgKytpKSB7XG4gICAgICBpZiAoaGFzSW1hZ2VyeUxheWVyQ3V0b3V0KSB7XG4gICAgICAgIGNvbXB1dGVEYXlDb2xvciArPVxuICAgICAgICAgIFwiXFxcbiAgICAgICAgY3V0b3V0QW5kQ29sb3JSZXN1bHQgPSB1X2RheVRleHR1cmVDdXRvdXRSZWN0YW5nbGVzW1wiICtcbiAgICAgICAgICBpICtcbiAgICAgICAgICBcIl07XFxuXFxcbiAgICAgICAgdGV4ZWxVbmNsaXBwZWQgPSB2X3RleHR1cmVDb29yZGluYXRlcy54IDwgY3V0b3V0QW5kQ29sb3JSZXN1bHQueCB8fCBjdXRvdXRBbmRDb2xvclJlc3VsdC56IDwgdl90ZXh0dXJlQ29vcmRpbmF0ZXMueCB8fCB2X3RleHR1cmVDb29yZGluYXRlcy55IDwgY3V0b3V0QW5kQ29sb3JSZXN1bHQueSB8fCBjdXRvdXRBbmRDb2xvclJlc3VsdC53IDwgdl90ZXh0dXJlQ29vcmRpbmF0ZXMueTtcXG5cXFxuICAgICAgICBjdXRvdXRBbmRDb2xvclJlc3VsdCA9IHNhbXBsZUFuZEJsZW5kKFxcblwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29tcHV0ZURheUNvbG9yICs9IFwiXFxcbiAgICAgICAgY29sb3IgPSBzYW1wbGVBbmRCbGVuZChcXG5cIjtcbiAgICAgIH1cbiAgICAgIGNvbXB1dGVEYXlDb2xvciArPVxuICAgICAgICBcIlxcXG4gICAgICAgICAgICBjb2xvcixcXG5cXFxuICAgICAgICAgICAgdV9kYXlUZXh0dXJlc1tcIiArXG4gICAgICAgIGkgK1xuICAgICAgICBcIl0sXFxuXFxcbiAgICAgICAgICAgIHVfZGF5VGV4dHVyZVVzZVdlYk1lcmNhdG9yVFtcIiArXG4gICAgICAgIGkgK1xuICAgICAgICBcIl0gPyB0ZXh0dXJlQ29vcmRpbmF0ZXMueHogOiB0ZXh0dXJlQ29vcmRpbmF0ZXMueHksXFxuXFxcbiAgICAgICAgICAgIHVfZGF5VGV4dHVyZVRleENvb3Jkc1JlY3RhbmdsZVtcIiArXG4gICAgICAgIGkgK1xuICAgICAgICBcIl0sXFxuXFxcbiAgICAgICAgICAgIHVfZGF5VGV4dHVyZVRyYW5zbGF0aW9uQW5kU2NhbGVbXCIgK1xuICAgICAgICBpICtcbiAgICAgICAgXCJdLFxcblxcXG4gICAgICAgICAgICBcIiArXG4gICAgICAgIChhcHBseUFscGhhID8gXCJ1X2RheVRleHR1cmVBbHBoYVtcIiArIGkgKyBcIl1cIiA6IFwiMS4wXCIpICtcbiAgICAgICAgXCIsXFxuXFxcbiAgICAgICAgICAgIFwiICtcbiAgICAgICAgKGFwcGx5RGF5TmlnaHRBbHBoYSA/IFwidV9kYXlUZXh0dXJlTmlnaHRBbHBoYVtcIiArIGkgKyBcIl1cIiA6IFwiMS4wXCIpICtcbiAgICAgICAgXCIsXFxuXCIgK1xuICAgICAgICAoYXBwbHlEYXlOaWdodEFscGhhID8gXCJ1X2RheVRleHR1cmVEYXlBbHBoYVtcIiArIGkgKyBcIl1cIiA6IFwiMS4wXCIpICtcbiAgICAgICAgXCIsXFxuXCIgK1xuICAgICAgICAoYXBwbHlCcmlnaHRuZXNzID8gXCJ1X2RheVRleHR1cmVCcmlnaHRuZXNzW1wiICsgaSArIFwiXVwiIDogXCIwLjBcIikgK1xuICAgICAgICBcIixcXG5cXFxuICAgICAgICAgICAgXCIgK1xuICAgICAgICAoYXBwbHlDb250cmFzdCA/IFwidV9kYXlUZXh0dXJlQ29udHJhc3RbXCIgKyBpICsgXCJdXCIgOiBcIjAuMFwiKSArXG4gICAgICAgIFwiLFxcblxcXG4gICAgICAgICAgICBcIiArXG4gICAgICAgIChhcHBseUh1ZSA/IFwidV9kYXlUZXh0dXJlSHVlW1wiICsgaSArIFwiXVwiIDogXCIwLjBcIikgK1xuICAgICAgICBcIixcXG5cXFxuICAgICAgICAgICAgXCIgK1xuICAgICAgICAoYXBwbHlTYXR1cmF0aW9uID8gXCJ1X2RheVRleHR1cmVTYXR1cmF0aW9uW1wiICsgaSArIFwiXVwiIDogXCIwLjBcIikgK1xuICAgICAgICBcIixcXG5cXFxuICAgICAgICAgICAgXCIgK1xuICAgICAgICAoYXBwbHlHYW1tYSA/IFwidV9kYXlUZXh0dXJlT25lT3ZlckdhbW1hW1wiICsgaSArIFwiXVwiIDogXCIwLjBcIikgK1xuICAgICAgICBcIixcXG5cXFxuICAgICAgICAgICAgXCIgK1xuICAgICAgICAoYXBwbHlTcGxpdCA/IFwidV9kYXlUZXh0dXJlU3BsaXRbXCIgKyBpICsgXCJdXCIgOiBcIjAuMFwiKSArXG4gICAgICAgIFwiLFxcblxcXG4gICAgICAgICAgICBcIiArXG4gICAgICAgIChjb2xvclRvQWxwaGEgPyBcInVfY29sb3JzVG9BbHBoYVtcIiArIGkgKyBcIl1cIiA6IFwidmVjNCgwLjApXCIpICtcbiAgICAgICAgXCIsXFxuXFxcbiAgICAgICAgbmlnaHRCbGVuZFxcXG4gICAgICAgICk7XFxuXCI7XG4gICAgICBpZiAoaGFzSW1hZ2VyeUxheWVyQ3V0b3V0KSB7XG4gICAgICAgIGNvbXB1dGVEYXlDb2xvciArPVxuICAgICAgICAgIFwiXFxcbiAgICAgICAgY29sb3IgPSBjem1fYnJhbmNoRnJlZVRlcm5hcnkodGV4ZWxVbmNsaXBwZWQsIGN1dG91dEFuZENvbG9yUmVzdWx0LCBjb2xvcik7XFxuXCI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29tcHV0ZURheUNvbG9yICs9IFwiXFxcbiAgICAgICAgcmV0dXJuIGNvbG9yO1xcblxcXG4gICAgfVwiO1xuXG4gICAgZnMuc291cmNlcy5wdXNoKGNvbXB1dGVEYXlDb2xvcik7XG5cbiAgICB2cy5zb3VyY2VzLnB1c2goZ2V0UG9zaXRpb25Nb2RlKHNjZW5lTW9kZSkpO1xuICAgIHZzLnNvdXJjZXMucHVzaChnZXQyRFlQb3NpdGlvbkZyYWN0aW9uKHVzZVdlYk1lcmNhdG9yUHJvamVjdGlvbikpO1xuXG4gICAgdmFyIHNoYWRlciA9IFNoYWRlclByb2dyYW0uZnJvbUNhY2hlKHtcbiAgICAgIGNvbnRleHQ6IGZyYW1lU3RhdGUuY29udGV4dCxcbiAgICAgIHZlcnRleFNoYWRlclNvdXJjZTogdnMsXG4gICAgICBmcmFnbWVudFNoYWRlclNvdXJjZTogZnMsXG4gICAgICBhdHRyaWJ1dGVMb2NhdGlvbnM6IHRlcnJhaW5FbmNvZGluZy5nZXRBdHRyaWJ1dGVMb2NhdGlvbnMoKSxcbiAgICB9KTtcblxuICAgIHN1cmZhY2VTaGFkZXIgPSBzaGFkZXJzQnlGbGFnc1tmbGFnc10gPSBuZXcgR2xvYmVTdXJmYWNlU2hhZGVyKFxuICAgICAgbnVtYmVyT2ZEYXlUZXh0dXJlcyxcbiAgICAgIGZsYWdzLFxuICAgICAgdGhpcy5tYXRlcmlhbCxcbiAgICAgIHNoYWRlcixcbiAgICAgIGN1cnJlbnRDbGlwcGluZ1NoYWRlclN0YXRlXG4gICAgKTtcbiAgfVxuXG4gIHN1cmZhY2VUaWxlLnN1cmZhY2VTaGFkZXIgPSBzdXJmYWNlU2hhZGVyO1xuICByZXR1cm4gc3VyZmFjZVNoYWRlci5zaGFkZXJQcm9ncmFtO1xufTtcblxuR2xvYmVTdXJmYWNlU2hhZGVyU2V0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgZmxhZ3M7XG4gIHZhciBzaGFkZXI7XG5cbiAgdmFyIHNoYWRlcnNCeVRleHR1cmVzRmxhZ3MgPSB0aGlzLl9zaGFkZXJzQnlUZXh0dXJlc0ZsYWdzO1xuICBmb3IgKHZhciB0ZXh0dXJlQ291bnQgaW4gc2hhZGVyc0J5VGV4dHVyZXNGbGFncykge1xuICAgIGlmIChzaGFkZXJzQnlUZXh0dXJlc0ZsYWdzLmhhc093blByb3BlcnR5KHRleHR1cmVDb3VudCkpIHtcbiAgICAgIHZhciBzaGFkZXJzQnlGbGFncyA9IHNoYWRlcnNCeVRleHR1cmVzRmxhZ3NbdGV4dHVyZUNvdW50XTtcbiAgICAgIGlmICghZGVmaW5lZChzaGFkZXJzQnlGbGFncykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGZvciAoZmxhZ3MgaW4gc2hhZGVyc0J5RmxhZ3MpIHtcbiAgICAgICAgaWYgKHNoYWRlcnNCeUZsYWdzLmhhc093blByb3BlcnR5KGZsYWdzKSkge1xuICAgICAgICAgIHNoYWRlciA9IHNoYWRlcnNCeUZsYWdzW2ZsYWdzXTtcbiAgICAgICAgICBpZiAoZGVmaW5lZChzaGFkZXIpKSB7XG4gICAgICAgICAgICBzaGFkZXIuc2hhZGVyUHJvZ3JhbS5kZXN0cm95KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGRlc3Ryb3lPYmplY3QodGhpcyk7XG59O1xuZXhwb3J0IGRlZmF1bHQgR2xvYmVTdXJmYWNlU2hhZGVyU2V0O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///55188\n')},14648:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(48243);\n/* harmony import */ var _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(60216);\n/* harmony import */ var _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(63367);\n/* harmony import */ var _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(51688);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(82982);\n/* harmony import */ var _Core_IndexDatatype_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(22832);\n/* harmony import */ var _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(67627);\n/* harmony import */ var _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(38443);\n/* harmony import */ var _Core_Ray_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(68457);\n/* harmony import */ var _Core_Request_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(22426);\n/* harmony import */ var _Core_RequestState_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(6224);\n/* harmony import */ var _Core_RequestType_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(82968);\n/* harmony import */ var _Core_TerrainEncoding_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(41782);\n/* harmony import */ var _Core_TileProviderError_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(9121);\n/* harmony import */ var _Renderer_Buffer_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(99095);\n/* harmony import */ var _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(58597);\n/* harmony import */ var _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(21572);\n/* harmony import */ var _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(87721);\n/* harmony import */ var _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(8743);\n/* harmony import */ var _Renderer_TextureMagnificationFilter_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(42246);\n/* harmony import */ var _Renderer_TextureMinificationFilter_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(80188);\n/* harmony import */ var _Renderer_TextureWrap_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(88453);\n/* harmony import */ var _Renderer_VertexArray_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(18192);\n/* harmony import */ var _ThirdParty_when_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(13222);\n/* harmony import */ var _ImageryState_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(73919);\n/* harmony import */ var _QuadtreeTileLoadState_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(85828);\n/* harmony import */ var _SceneMode_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(89917);\n/* harmony import */ var _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(46547);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Contains additional information about a {@link QuadtreeTile} of the globe\'s surface, and\n * encapsulates state transition logic for loading tiles.\n *\n * @constructor\n * @alias GlobeSurfaceTile\n * @private\n */\nfunction GlobeSurfaceTile() {\n  /**\n   * The {@link TileImagery} attached to this tile.\n   * @type {TileImagery[]}\n   * @default []\n   */\n  this.imagery = [];\n\n  this.waterMaskTexture = undefined;\n  this.waterMaskTranslationAndScale = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(0.0, 0.0, 1.0, 1.0);\n\n  this.terrainData = undefined;\n  this.vertexArray = undefined;\n\n  /**\n   * A bounding region used to estimate distance to the tile. The horizontal bounds are always tight-fitting,\n   * but the `minimumHeight` and `maximumHeight` properties may be derived from the min/max of an ancestor tile\n   * and be quite loose-fitting and thus very poor for estimating distance.\n   * @type {TileBoundingRegion}\n   */\n  this.tileBoundingRegion = undefined;\n  this.occludeePointInScaledSpace = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n  this.boundingVolumeSourceTile = undefined;\n  this.boundingVolumeIsFromMesh = false;\n\n  this.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].UNLOADED */ .Z.UNLOADED;\n  this.mesh = undefined;\n  this.fill = undefined;\n\n  this.pickBoundingSphere = new _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n\n  this.surfaceShader = undefined;\n  this.isClipped = true;\n\n  this.clippedByBoundaries = false;\n}\n\nObject.defineProperties(GlobeSurfaceTile.prototype, {\n  /**\n   * Gets a value indicating whether or not this tile is eligible to be unloaded.\n   * Typically, a tile is ineligible to be unloaded while an asynchronous operation,\n   * such as a request for data, is in progress on it.  A tile will never be\n   * unloaded while it is needed for rendering, regardless of the value of this\n   * property.\n   * @memberof GlobeSurfaceTile.prototype\n   * @type {Boolean}\n   */\n  eligibleForUnloading: {\n    get: function () {\n      // Do not remove tiles that are transitioning or that have\n      // imagery that is transitioning.\n      var terrainState = this.terrainState;\n      var loadingIsTransitioning =\n        terrainState === _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].RECEIVING */ .Z.RECEIVING ||\n        terrainState === _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].TRANSFORMING */ .Z.TRANSFORMING;\n\n      var shouldRemoveTile = !loadingIsTransitioning;\n\n      var imagery = this.imagery;\n      for (var i = 0, len = imagery.length; shouldRemoveTile && i < len; ++i) {\n        var tileImagery = imagery[i];\n        shouldRemoveTile =\n          !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(tileImagery.loadingImagery) ||\n          tileImagery.loadingImagery.state !== _ImageryState_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].TRANSITIONING */ .Z.TRANSITIONING;\n      }\n\n      return shouldRemoveTile;\n    },\n  },\n\n  /**\n   * Gets the {@link TerrainMesh} that is used for rendering this tile, if any.\n   * Returns the value of the {@link GlobeSurfaceTile#mesh} property if\n   * {@link GlobeSurfaceTile#vertexArray} is defined. Otherwise, It returns the\n   * {@link TerrainFillMesh#mesh} property of the {@link GlobeSurfaceTile#fill}.\n   * If there is no fill, it returns undefined.\n   *\n   * @memberof GlobeSurfaceTile.prototype\n   * @type {TerrainMesh}\n   */\n  renderedMesh: {\n    get: function () {\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(this.vertexArray)) {\n        return this.mesh;\n      } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(this.fill)) {\n        return this.fill.mesh;\n      }\n      return undefined;\n    },\n  },\n});\n\nvar scratchCartographic = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\n\nfunction getPosition(encoding, mode, projection, vertices, index, result) {\n  var position = encoding.getExaggeratedPosition(vertices, index, result);\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(mode) && mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_25__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    var ellipsoid = projection.ellipsoid;\n    var positionCartographic = ellipsoid.cartesianToCartographic(\n      position,\n      scratchCartographic\n    );\n    position = projection.project(positionCartographic, result);\n    position = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromElements */ .Z.fromElements(\n      position.z,\n      position.x,\n      position.y,\n      result\n    );\n  }\n\n  return position;\n}\n\nvar scratchV0 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchV1 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\nvar scratchV2 = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z();\n\nGlobeSurfaceTile.prototype.pick = function (\n  ray,\n  mode,\n  projection,\n  cullBackFaces,\n  result\n) {\n  var mesh = this.renderedMesh;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(mesh)) {\n    return undefined;\n  }\n\n  var vertices = mesh.vertices;\n  var indices = mesh.indices;\n  var encoding = mesh.encoding;\n  var indicesLength = indices.length;\n\n  var minT = Number.MAX_VALUE;\n\n  for (var i = 0; i < indicesLength; i += 3) {\n    var i0 = indices[i];\n    var i1 = indices[i + 1];\n    var i2 = indices[i + 2];\n\n    var v0 = getPosition(encoding, mode, projection, vertices, i0, scratchV0);\n    var v1 = getPosition(encoding, mode, projection, vertices, i1, scratchV1);\n    var v2 = getPosition(encoding, mode, projection, vertices, i2, scratchV2);\n\n    var t = _Core_IntersectionTests_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].rayTriangleParametric */ .Z.rayTriangleParametric(\n      ray,\n      v0,\n      v1,\n      v2,\n      cullBackFaces\n    );\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(t) && t < minT && t >= 0.0) {\n      minT = t;\n    }\n  }\n\n  return minT !== Number.MAX_VALUE\n    ? _Core_Ray_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].getPoint */ .Z.getPoint(ray, minT, result)\n    : undefined;\n};\n\nGlobeSurfaceTile.prototype.freeResources = function () {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(this.waterMaskTexture)) {\n    --this.waterMaskTexture.referenceCount;\n    if (this.waterMaskTexture.referenceCount === 0) {\n      this.waterMaskTexture.destroy();\n    }\n    this.waterMaskTexture = undefined;\n  }\n\n  this.terrainData = undefined;\n\n  this.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].UNLOADED */ .Z.UNLOADED;\n  this.mesh = undefined;\n  this.fill = this.fill && this.fill.destroy();\n\n  var imageryList = this.imagery;\n  for (var i = 0, len = imageryList.length; i < len; ++i) {\n    imageryList[i].freeResources();\n  }\n  this.imagery.length = 0;\n\n  this.freeVertexArray();\n};\n\nGlobeSurfaceTile.prototype.freeVertexArray = function () {\n  GlobeSurfaceTile._freeVertexArray(this.vertexArray);\n  this.vertexArray = undefined;\n  GlobeSurfaceTile._freeVertexArray(this.wireframeVertexArray);\n  this.wireframeVertexArray = undefined;\n};\n\nGlobeSurfaceTile.initialize = function (\n  tile,\n  terrainProvider,\n  imageryLayerCollection\n) {\n  var surfaceTile = tile.data;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(surfaceTile)) {\n    surfaceTile = tile.data = new GlobeSurfaceTile();\n  }\n\n  if (tile.state === _QuadtreeTileLoadState_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].START */ .Z.START) {\n    prepareNewTile(tile, terrainProvider, imageryLayerCollection);\n    tile.state = _QuadtreeTileLoadState_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].LOADING */ .Z.LOADING;\n  }\n};\n\nGlobeSurfaceTile.processStateMachine = function (\n  tile,\n  frameState,\n  terrainProvider,\n  imageryLayerCollection,\n  quadtree,\n  vertexArraysToDestroy,\n  terrainOnly\n) {\n  GlobeSurfaceTile.initialize(tile, terrainProvider, imageryLayerCollection);\n\n  var surfaceTile = tile.data;\n\n  if (tile.state === _QuadtreeTileLoadState_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].LOADING */ .Z.LOADING) {\n    processTerrainStateMachine(\n      tile,\n      frameState,\n      terrainProvider,\n      imageryLayerCollection,\n      quadtree,\n      vertexArraysToDestroy\n    );\n  }\n\n  // From here down we\'re loading imagery, not terrain. We don\'t want to load imagery until\n  // we\'re certain that the terrain tiles are actually visible, though. We\'ll load terrainOnly\n  // in these scenarios:\n  //   * our bounding volume isn\'t accurate so we\'re not certain this tile is really visible (see GlobeSurfaceTileProvider#loadTile).\n  //   * we want to upsample from this tile but don\'t plan to render it (see processTerrainStateMachine).\n  if (terrainOnly) {\n    return;\n  }\n\n  var wasAlreadyRenderable = tile.renderable;\n\n  // The terrain is renderable as soon as we have a valid vertex array.\n  tile.renderable = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(surfaceTile.vertexArray);\n\n  // But it\'s not done loading until it\'s in the READY state.\n  var isTerrainDoneLoading = surfaceTile.terrainState === _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].READY */ .Z.READY;\n\n  // If this tile\'s terrain and imagery are just upsampled from its parent, mark the tile as\n  // upsampled only.  We won\'t refine a tile if its four children are upsampled only.\n  tile.upsampledFromParent =\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(surfaceTile.terrainData) &&\n    surfaceTile.terrainData.wasCreatedByUpsampling();\n\n  var isImageryDoneLoading = surfaceTile.processImagery(\n    tile,\n    terrainProvider,\n    frameState\n  );\n\n  if (isTerrainDoneLoading && isImageryDoneLoading) {\n    var callbacks = tile._loadedCallbacks;\n    var newCallbacks = {};\n    for (var layerId in callbacks) {\n      if (callbacks.hasOwnProperty(layerId)) {\n        if (!callbacks[layerId](tile)) {\n          newCallbacks[layerId] = callbacks[layerId];\n        }\n      }\n    }\n    tile._loadedCallbacks = newCallbacks;\n\n    tile.state = _QuadtreeTileLoadState_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].DONE */ .Z.DONE;\n  }\n\n  // Once a tile is renderable, it stays renderable, because doing otherwise would\n  // cause detail (or maybe even the entire globe) to vanish when adding a new\n  // imagery layer. `GlobeSurfaceTileProvider._onLayerAdded` sets renderable to\n  // false for all affected tiles that are not currently being rendered.\n  if (wasAlreadyRenderable) {\n    tile.renderable = true;\n  }\n};\n\nGlobeSurfaceTile.prototype.processImagery = function (\n  tile,\n  terrainProvider,\n  frameState,\n  skipLoading\n) {\n  var surfaceTile = tile.data;\n  var isUpsampledOnly = tile.upsampledFromParent;\n  var isAnyTileLoaded = false;\n  var isDoneLoading = true;\n\n  // Transition imagery states\n  var tileImageryCollection = surfaceTile.imagery;\n  var i, len;\n  for (i = 0, len = tileImageryCollection.length; i < len; ++i) {\n    var tileImagery = tileImageryCollection[i];\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(tileImagery.loadingImagery)) {\n      isUpsampledOnly = false;\n      continue;\n    }\n\n    if (tileImagery.loadingImagery.state === _ImageryState_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].PLACEHOLDER */ .Z.PLACEHOLDER) {\n      var imageryLayer = tileImagery.loadingImagery.imageryLayer;\n      if (imageryLayer.imageryProvider.ready) {\n        // Remove the placeholder and add the actual skeletons (if any)\n        // at the same position.  Then continue the loop at the same index.\n        tileImagery.freeResources();\n        tileImageryCollection.splice(i, 1);\n        imageryLayer._createTileImagerySkeletons(tile, terrainProvider, i);\n        --i;\n        len = tileImageryCollection.length;\n        continue;\n      } else {\n        isUpsampledOnly = false;\n      }\n    }\n\n    var thisTileDoneLoading = tileImagery.processStateMachine(\n      tile,\n      frameState,\n      skipLoading\n    );\n    isDoneLoading = isDoneLoading && thisTileDoneLoading;\n\n    // The imagery is renderable as soon as we have any renderable imagery for this region.\n    isAnyTileLoaded =\n      isAnyTileLoaded ||\n      thisTileDoneLoading ||\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(tileImagery.readyImagery);\n\n    isUpsampledOnly =\n      isUpsampledOnly &&\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(tileImagery.loadingImagery) &&\n      (tileImagery.loadingImagery.state === _ImageryState_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].FAILED */ .Z.FAILED ||\n        tileImagery.loadingImagery.state === _ImageryState_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].INVALID */ .Z.INVALID);\n  }\n\n  tile.upsampledFromParent = isUpsampledOnly;\n\n  // Allow rendering if any available layers are loaded\n  tile.renderable = tile.renderable && (isAnyTileLoaded || isDoneLoading);\n\n  return isDoneLoading;\n};\n\nfunction toggleGeodeticSurfaceNormals(\n  surfaceTile,\n  enabled,\n  ellipsoid,\n  frameState\n) {\n  var renderedMesh = surfaceTile.renderedMesh;\n  var vertexBuffer = renderedMesh.vertices;\n  var encoding = renderedMesh.encoding;\n  var vertexCount = vertexBuffer.length / encoding.stride;\n\n  // Calculate the new stride and generate a new buffer\n  // Clone the other encoding, toggle geodetic surface normals, then clone again to get updated stride\n  var newEncoding = _Core_TerrainEncoding_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clone */ .Z.clone(encoding);\n  newEncoding.hasGeodeticSurfaceNormals = enabled;\n  newEncoding = _Core_TerrainEncoding_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"].clone */ .Z.clone(newEncoding);\n  var newStride = newEncoding.stride;\n  var newVertexBuffer = new Float32Array(vertexCount * newStride);\n\n  if (enabled) {\n    encoding.addGeodeticSurfaceNormals(\n      vertexBuffer,\n      newVertexBuffer,\n      ellipsoid\n    );\n  } else {\n    encoding.removeGeodeticSurfaceNormals(vertexBuffer, newVertexBuffer);\n  }\n\n  renderedMesh.vertices = newVertexBuffer;\n  renderedMesh.stride = newStride;\n\n  // delete the old vertex array (which deletes the vertex buffer attached to it), and create a new vertex array with the new vertex buffer\n  var isFill = renderedMesh !== surfaceTile.mesh;\n  if (isFill) {\n    GlobeSurfaceTile._freeVertexArray(surfaceTile.fill.vertexArray);\n    surfaceTile.fill.vertexArray = GlobeSurfaceTile._createVertexArrayForMesh(\n      frameState.context,\n      renderedMesh\n    );\n  } else {\n    GlobeSurfaceTile._freeVertexArray(surfaceTile.vertexArray);\n    surfaceTile.vertexArray = GlobeSurfaceTile._createVertexArrayForMesh(\n      frameState.context,\n      renderedMesh\n    );\n  }\n  GlobeSurfaceTile._freeVertexArray(surfaceTile.wireframeVertexArray);\n  surfaceTile.wireframeVertexArray = undefined;\n}\n\nGlobeSurfaceTile.prototype.addGeodeticSurfaceNormals = function (\n  ellipsoid,\n  frameState\n) {\n  toggleGeodeticSurfaceNormals(this, true, ellipsoid, frameState);\n};\n\nGlobeSurfaceTile.prototype.removeGeodeticSurfaceNormals = function (\n  frameState\n) {\n  toggleGeodeticSurfaceNormals(this, false, undefined, frameState);\n};\n\nGlobeSurfaceTile.prototype.updateExaggeration = function (\n  tile,\n  frameState,\n  quadtree\n) {\n  var surfaceTile = this;\n  var mesh = surfaceTile.renderedMesh;\n  if (mesh === undefined) {\n    return;\n  }\n\n  // Check the tile\'s terrain encoding to see if it has been exaggerated yet\n  var exaggeration = frameState.terrainExaggeration;\n  var exaggerationRelativeHeight = frameState.terrainExaggerationRelativeHeight;\n  var hasExaggerationScale = exaggeration !== 1.0;\n\n  var encoding = mesh.encoding;\n  var encodingExaggerationScaleChanged = encoding.exaggeration !== exaggeration;\n  var encodingRelativeHeightChanged =\n    encoding.exaggerationRelativeHeight !== exaggerationRelativeHeight;\n\n  if (encodingExaggerationScaleChanged || encodingRelativeHeightChanged) {\n    // Turning exaggeration scale on/off requires adding or removing geodetic surface normals\n    // Relative height only translates, so it has no effect on normals\n    if (encodingExaggerationScaleChanged) {\n      if (hasExaggerationScale && !encoding.hasGeodeticSurfaceNormals) {\n        var ellipsoid = tile.tilingScheme.ellipsoid;\n        surfaceTile.addGeodeticSurfaceNormals(ellipsoid, frameState);\n      } else if (!hasExaggerationScale && encoding.hasGeodeticSurfaceNormals) {\n        surfaceTile.removeGeodeticSurfaceNormals(frameState);\n      }\n    }\n\n    encoding.exaggeration = exaggeration;\n    encoding.exaggerationRelativeHeight = exaggerationRelativeHeight;\n\n    // Notify the quadtree that this tile\'s height has changed\n    if (quadtree !== undefined) {\n      quadtree._tileToUpdateHeights.push(tile);\n      var customData = tile.customData;\n      var customDataLength = customData.length;\n      for (var i = 0; i < customDataLength; i++) {\n        // Restart the level so that a height update is triggered\n        var data = customData[i];\n        data.level = -1;\n      }\n    }\n  }\n};\n\nfunction prepareNewTile(tile, terrainProvider, imageryLayerCollection) {\n  var available = terrainProvider.getTileDataAvailable(\n    tile.x,\n    tile.y,\n    tile.level\n  );\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(available) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(tile.parent)) {\n    // Provider doesn\'t know if this tile is available. Does the parent tile know?\n    var parent = tile.parent;\n    var parentSurfaceTile = parent.data;\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(parentSurfaceTile) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(parentSurfaceTile.terrainData)) {\n      available = parentSurfaceTile.terrainData.isChildAvailable(\n        parent.x,\n        parent.y,\n        tile.x,\n        tile.y\n      );\n    }\n  }\n\n  if (available === false) {\n    // This tile is not available, so mark it failed so we start upsampling right away.\n    tile.data.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].FAILED */ .Z.FAILED;\n  }\n\n  // Map imagery tiles to this terrain tile\n  for (var i = 0, len = imageryLayerCollection.length; i < len; ++i) {\n    var layer = imageryLayerCollection.get(i);\n    if (layer.show) {\n      layer._createTileImagerySkeletons(tile, terrainProvider);\n    }\n  }\n}\n\nfunction processTerrainStateMachine(\n  tile,\n  frameState,\n  terrainProvider,\n  imageryLayerCollection,\n  quadtree,\n  vertexArraysToDestroy\n) {\n  var surfaceTile = tile.data;\n\n  // If this tile is FAILED, we\'ll need to upsample from the parent. If the parent isn\'t\n  // ready for that, let\'s push it along.\n  var parent = tile.parent;\n  if (\n    surfaceTile.terrainState === _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].FAILED */ .Z.FAILED &&\n    parent !== undefined\n  ) {\n    var parentReady =\n      parent.data !== undefined &&\n      parent.data.terrainData !== undefined &&\n      parent.data.terrainData.canUpsample !== false;\n    if (!parentReady) {\n      GlobeSurfaceTile.processStateMachine(\n        parent,\n        frameState,\n        terrainProvider,\n        imageryLayerCollection,\n        quadtree,\n        vertexArraysToDestroy,\n        true\n      );\n    }\n  }\n\n  if (surfaceTile.terrainState === _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].FAILED */ .Z.FAILED) {\n    upsample(\n      surfaceTile,\n      tile,\n      frameState,\n      terrainProvider,\n      tile.x,\n      tile.y,\n      tile.level\n    );\n  }\n\n  if (surfaceTile.terrainState === _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].UNLOADED */ .Z.UNLOADED) {\n    requestTileGeometry(\n      surfaceTile,\n      terrainProvider,\n      tile.x,\n      tile.y,\n      tile.level\n    );\n  }\n\n  if (surfaceTile.terrainState === _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].RECEIVED */ .Z.RECEIVED) {\n    transform(\n      surfaceTile,\n      frameState,\n      terrainProvider,\n      tile.x,\n      tile.y,\n      tile.level\n    );\n  }\n\n  if (surfaceTile.terrainState === _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].TRANSFORMED */ .Z.TRANSFORMED) {\n    createResources(\n      surfaceTile,\n      frameState.context,\n      terrainProvider,\n      tile.x,\n      tile.y,\n      tile.level,\n      vertexArraysToDestroy\n    );\n\n    // Update the tile\'s exaggeration in case the globe\'s exaggeration changed while the tile was being processed\n    surfaceTile.updateExaggeration(tile, frameState, quadtree);\n  }\n\n  if (\n    surfaceTile.terrainState >= _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].RECEIVED */ .Z.RECEIVED &&\n    surfaceTile.waterMaskTexture === undefined &&\n    terrainProvider.hasWaterMask\n  ) {\n    var terrainData = surfaceTile.terrainData;\n    if (terrainData.waterMask !== undefined) {\n      createWaterMaskTextureIfNeeded(frameState.context, surfaceTile);\n    } else {\n      var sourceTile = surfaceTile._findAncestorTileWithTerrainData(tile);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(sourceTile) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(sourceTile.data.waterMaskTexture)) {\n        surfaceTile.waterMaskTexture = sourceTile.data.waterMaskTexture;\n        ++surfaceTile.waterMaskTexture.referenceCount;\n        surfaceTile._computeWaterMaskTranslationAndScale(\n          tile,\n          sourceTile,\n          surfaceTile.waterMaskTranslationAndScale\n        );\n      }\n    }\n  }\n}\n\nfunction upsample(surfaceTile, tile, frameState, terrainProvider, x, y, level) {\n  var parent = tile.parent;\n  if (!parent) {\n    // Trying to upsample from a root tile. No can do. This tile is a failure.\n    tile.state = _QuadtreeTileLoadState_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].FAILED */ .Z.FAILED;\n    return;\n  }\n\n  var sourceData = parent.data.terrainData;\n  var sourceX = parent.x;\n  var sourceY = parent.y;\n  var sourceLevel = parent.level;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(sourceData)) {\n    // Parent is not available, so we can\'t upsample this tile yet.\n    return;\n  }\n\n  var terrainDataPromise = sourceData.upsample(\n    terrainProvider.tilingScheme,\n    sourceX,\n    sourceY,\n    sourceLevel,\n    x,\n    y,\n    level\n  );\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(terrainDataPromise)) {\n    // The upsample request has been deferred - try again later.\n    return;\n  }\n\n  surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].RECEIVING */ .Z.RECEIVING;\n\n  (0,_ThirdParty_when_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */ .Z)(\n    terrainDataPromise,\n    function (terrainData) {\n      surfaceTile.terrainData = terrainData;\n      surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].RECEIVED */ .Z.RECEIVED;\n    },\n    function () {\n      surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].FAILED */ .Z.FAILED;\n    }\n  );\n}\n\nfunction requestTileGeometry(surfaceTile, terrainProvider, x, y, level) {\n  function success(terrainData) {\n    surfaceTile.terrainData = terrainData;\n    surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].RECEIVED */ .Z.RECEIVED;\n    surfaceTile.request = undefined;\n  }\n\n  function failure(error) {\n    if (surfaceTile.request.state === _Core_RequestState_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].CANCELLED */ .Z.CANCELLED) {\n      // Cancelled due to low priority - try again later.\n      surfaceTile.terrainData = undefined;\n      surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].UNLOADED */ .Z.UNLOADED;\n      surfaceTile.request = undefined;\n      return;\n    }\n\n    // Initially assume failure.  handleError may retry, in which case the state will\n    // change to RECEIVING or UNLOADED.\n    surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].FAILED */ .Z.FAILED;\n    surfaceTile.request = undefined;\n\n    var message =\n      "Failed to obtain terrain tile X: " +\n      x +\n      " Y: " +\n      y +\n      " Level: " +\n      level +\n      \'. Error message: "\' +\n      error +\n      \'"\';\n    terrainProvider._requestError = _Core_TileProviderError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"].handleError */ .Z.handleError(\n      terrainProvider._requestError,\n      terrainProvider,\n      terrainProvider.errorEvent,\n      message,\n      x,\n      y,\n      level,\n      doRequest\n    );\n  }\n\n  function doRequest() {\n    // Request the terrain from the terrain provider.\n    var request = new _Core_Request_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z({\n      throttle: false,\n      throttleByServer: true,\n      type: _Core_RequestType_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].TERRAIN */ .Z.TERRAIN,\n    });\n    surfaceTile.request = request;\n\n    var requestPromise = terrainProvider.requestTileGeometry(\n      x,\n      y,\n      level,\n      request\n    );\n\n    // If the request method returns undefined (instead of a promise), the request\n    // has been deferred.\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(requestPromise)) {\n      surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].RECEIVING */ .Z.RECEIVING;\n      (0,_ThirdParty_when_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */ .Z)(requestPromise, success, failure);\n    } else {\n      // Deferred - try again later.\n      surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].UNLOADED */ .Z.UNLOADED;\n      surfaceTile.request = undefined;\n    }\n  }\n\n  doRequest();\n}\n\nvar scratchCreateMeshOptions = {\n  tilingScheme: undefined,\n  x: 0,\n  y: 0,\n  level: 0,\n  exaggeration: 1.0,\n  exaggerationRelativeHeight: 0.0,\n  throttle: true,\n};\n\nfunction transform(surfaceTile, frameState, terrainProvider, x, y, level) {\n  var tilingScheme = terrainProvider.tilingScheme;\n\n  var createMeshOptions = scratchCreateMeshOptions;\n  createMeshOptions.tilingScheme = tilingScheme;\n  createMeshOptions.x = x;\n  createMeshOptions.y = y;\n  createMeshOptions.level = level;\n  createMeshOptions.exaggeration = frameState.terrainExaggeration;\n  createMeshOptions.exaggerationRelativeHeight =\n    frameState.terrainExaggerationRelativeHeight;\n  createMeshOptions.throttle = true;\n\n  var terrainData = surfaceTile.terrainData;\n  var meshPromise = terrainData.createMesh(createMeshOptions);\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(meshPromise)) {\n    // Postponed.\n    return;\n  }\n\n  surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].TRANSFORMING */ .Z.TRANSFORMING;\n\n  (0,_ThirdParty_when_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */ .Z)(\n    meshPromise,\n    function (mesh) {\n      surfaceTile.mesh = mesh;\n      surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].TRANSFORMED */ .Z.TRANSFORMED;\n    },\n    function () {\n      surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].FAILED */ .Z.FAILED;\n    }\n  );\n}\n\nGlobeSurfaceTile._createVertexArrayForMesh = function (context, mesh) {\n  var typedArray = mesh.vertices;\n  var buffer = _Renderer_Buffer_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].createVertexBuffer */ .Z.createVertexBuffer({\n    context: context,\n    typedArray: typedArray,\n    usage: _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW,\n  });\n  var attributes = mesh.encoding.getAttributes(buffer);\n\n  var indexBuffers = mesh.indices.indexBuffers || {};\n  var indexBuffer = indexBuffers[context.id];\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(indexBuffer) || indexBuffer.isDestroyed()) {\n    var indices = mesh.indices;\n    indexBuffer = _Renderer_Buffer_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"].createIndexBuffer */ .Z.createIndexBuffer({\n      context: context,\n      typedArray: indices,\n      usage: _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW,\n      indexDatatype: _Core_IndexDatatype_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].fromSizeInBytes */ .Z.fromSizeInBytes(indices.BYTES_PER_ELEMENT),\n    });\n    indexBuffer.vertexArrayDestroyable = false;\n    indexBuffer.referenceCount = 1;\n    indexBuffers[context.id] = indexBuffer;\n    mesh.indices.indexBuffers = indexBuffers;\n  } else {\n    ++indexBuffer.referenceCount;\n  }\n\n  return new _Renderer_VertexArray_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"] */ .Z({\n    context: context,\n    attributes: attributes,\n    indexBuffer: indexBuffer,\n  });\n};\n\nGlobeSurfaceTile._freeVertexArray = function (vertexArray) {\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(vertexArray)) {\n    var indexBuffer = vertexArray.indexBuffer;\n\n    if (!vertexArray.isDestroyed()) {\n      vertexArray.destroy();\n    }\n\n    if (\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(indexBuffer) &&\n      !indexBuffer.isDestroyed() &&\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(indexBuffer.referenceCount)\n    ) {\n      --indexBuffer.referenceCount;\n      if (indexBuffer.referenceCount === 0) {\n        indexBuffer.destroy();\n      }\n    }\n  }\n};\n\nfunction createResources(\n  surfaceTile,\n  context,\n  terrainProvider,\n  x,\n  y,\n  level,\n  vertexArraysToDestroy\n) {\n  surfaceTile.vertexArray = GlobeSurfaceTile._createVertexArrayForMesh(\n    context,\n    surfaceTile.mesh\n  );\n  surfaceTile.terrainState = _TerrainState_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].READY */ .Z.READY;\n  surfaceTile.fill =\n    surfaceTile.fill && surfaceTile.fill.destroy(vertexArraysToDestroy);\n}\n\nfunction getContextWaterMaskData(context) {\n  var data = context.cache.tile_waterMaskData;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(data)) {\n    var allWaterTexture = _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].create */ .Z.create({\n      context: context,\n      pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].LUMINANCE */ .Z.LUMINANCE,\n      pixelDatatype: _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE,\n      source: {\n        arrayBufferView: new Uint8Array([255]),\n        width: 1,\n        height: 1,\n      },\n    });\n    allWaterTexture.referenceCount = 1;\n\n    var sampler = new _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"] */ .Z({\n      wrapS: _Renderer_TextureWrap_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].CLAMP_TO_EDGE */ .Z.CLAMP_TO_EDGE,\n      wrapT: _Renderer_TextureWrap_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"].CLAMP_TO_EDGE */ .Z.CLAMP_TO_EDGE,\n      minificationFilter: _Renderer_TextureMinificationFilter_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].LINEAR */ .Z.LINEAR,\n      magnificationFilter: _Renderer_TextureMagnificationFilter_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].LINEAR */ .Z.LINEAR,\n    });\n\n    data = {\n      allWaterTexture: allWaterTexture,\n      sampler: sampler,\n      destroy: function () {\n        this.allWaterTexture.destroy();\n      },\n    };\n\n    context.cache.tile_waterMaskData = data;\n  }\n\n  return data;\n}\n\nfunction createWaterMaskTextureIfNeeded(context, surfaceTile) {\n  var waterMask = surfaceTile.terrainData.waterMask;\n  var waterMaskData = getContextWaterMaskData(context);\n  var texture;\n\n  var waterMaskLength = waterMask.length;\n  if (waterMaskLength === 1) {\n    // Length 1 means the tile is entirely land or entirely water.\n    // A value of 0 indicates entirely land, a value of 1 indicates entirely water.\n    if (waterMask[0] !== 0) {\n      texture = waterMaskData.allWaterTexture;\n    } else {\n      // Leave the texture undefined if the tile is entirely land.\n      return;\n    }\n  } else {\n    var textureSize = Math.sqrt(waterMaskLength);\n    texture = _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].create */ .Z.create({\n      context: context,\n      pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].LUMINANCE */ .Z.LUMINANCE,\n      pixelDatatype: _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE,\n      source: {\n        width: textureSize,\n        height: textureSize,\n        arrayBufferView: waterMask,\n      },\n      sampler: waterMaskData.sampler,\n      flipY: false,\n    });\n\n    texture.referenceCount = 0;\n  }\n\n  ++texture.referenceCount;\n  surfaceTile.waterMaskTexture = texture;\n\n  _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].fromElements */ .Z.fromElements(\n    0.0,\n    0.0,\n    1.0,\n    1.0,\n    surfaceTile.waterMaskTranslationAndScale\n  );\n}\n\nGlobeSurfaceTile.prototype._findAncestorTileWithTerrainData = function (tile) {\n  var sourceTile = tile.parent;\n\n  while (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(sourceTile) &&\n    (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(sourceTile.data) ||\n      !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"] */ .Z)(sourceTile.data.terrainData) ||\n      sourceTile.data.terrainData.wasCreatedByUpsampling())\n  ) {\n    sourceTile = sourceTile.parent;\n  }\n\n  return sourceTile;\n};\n\nGlobeSurfaceTile.prototype._computeWaterMaskTranslationAndScale = function (\n  tile,\n  sourceTile,\n  result\n) {\n  var sourceTileRectangle = sourceTile.rectangle;\n  var tileRectangle = tile.rectangle;\n  var tileWidth = tileRectangle.width;\n  var tileHeight = tileRectangle.height;\n\n  var scaleX = tileWidth / sourceTileRectangle.width;\n  var scaleY = tileHeight / sourceTileRectangle.height;\n  result.x =\n    (scaleX * (tileRectangle.west - sourceTileRectangle.west)) / tileWidth;\n  result.y =\n    (scaleY * (tileRectangle.south - sourceTileRectangle.south)) / tileHeight;\n  result.z = scaleX;\n  result.w = scaleY;\n\n  return result;\n};\n/* harmony default export */ __webpack_exports__["Z"] = (GlobeSurfaceTile);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0JBQWdCLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92dWUzLXdlYnBhY2s1Ly4vbm9kZV9tb2R1bGVzL2Nlc2l1bS9Tb3VyY2UvU2NlbmUvR2xvYmVTdXJmYWNlVGlsZS5qcz9iZGFiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3VuZGluZ1NwaGVyZSBmcm9tIFwiLi4vQ29yZS9Cb3VuZGluZ1NwaGVyZS5qc1wiO1xuaW1wb3J0IENhcnRlc2lhbjMgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuMy5qc1wiO1xuaW1wb3J0IENhcnRlc2lhbjQgZnJvbSBcIi4uL0NvcmUvQ2FydGVzaWFuNC5qc1wiO1xuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwiLi4vQ29yZS9DYXJ0b2dyYXBoaWMuanNcIjtcbmltcG9ydCBkZWZpbmVkIGZyb20gXCIuLi9Db3JlL2RlZmluZWQuanNcIjtcbmltcG9ydCBJbmRleERhdGF0eXBlIGZyb20gXCIuLi9Db3JlL0luZGV4RGF0YXR5cGUuanNcIjtcbmltcG9ydCBJbnRlcnNlY3Rpb25UZXN0cyBmcm9tIFwiLi4vQ29yZS9JbnRlcnNlY3Rpb25UZXN0cy5qc1wiO1xuaW1wb3J0IFBpeGVsRm9ybWF0IGZyb20gXCIuLi9Db3JlL1BpeGVsRm9ybWF0LmpzXCI7XG5pbXBvcnQgUmF5IGZyb20gXCIuLi9Db3JlL1JheS5qc1wiO1xuaW1wb3J0IFJlcXVlc3QgZnJvbSBcIi4uL0NvcmUvUmVxdWVzdC5qc1wiO1xuaW1wb3J0IFJlcXVlc3RTdGF0ZSBmcm9tIFwiLi4vQ29yZS9SZXF1ZXN0U3RhdGUuanNcIjtcbmltcG9ydCBSZXF1ZXN0VHlwZSBmcm9tIFwiLi4vQ29yZS9SZXF1ZXN0VHlwZS5qc1wiO1xuaW1wb3J0IFRlcnJhaW5FbmNvZGluZyBmcm9tIFwiLi4vQ29yZS9UZXJyYWluRW5jb2RpbmcuanNcIjtcbmltcG9ydCBUaWxlUHJvdmlkZXJFcnJvciBmcm9tIFwiLi4vQ29yZS9UaWxlUHJvdmlkZXJFcnJvci5qc1wiO1xuaW1wb3J0IEJ1ZmZlciBmcm9tIFwiLi4vUmVuZGVyZXIvQnVmZmVyLmpzXCI7XG5pbXBvcnQgQnVmZmVyVXNhZ2UgZnJvbSBcIi4uL1JlbmRlcmVyL0J1ZmZlclVzYWdlLmpzXCI7XG5pbXBvcnQgUGl4ZWxEYXRhdHlwZSBmcm9tIFwiLi4vUmVuZGVyZXIvUGl4ZWxEYXRhdHlwZS5qc1wiO1xuaW1wb3J0IFNhbXBsZXIgZnJvbSBcIi4uL1JlbmRlcmVyL1NhbXBsZXIuanNcIjtcbmltcG9ydCBUZXh0dXJlIGZyb20gXCIuLi9SZW5kZXJlci9UZXh0dXJlLmpzXCI7XG5pbXBvcnQgVGV4dHVyZU1hZ25pZmljYXRpb25GaWx0ZXIgZnJvbSBcIi4uL1JlbmRlcmVyL1RleHR1cmVNYWduaWZpY2F0aW9uRmlsdGVyLmpzXCI7XG5pbXBvcnQgVGV4dHVyZU1pbmlmaWNhdGlvbkZpbHRlciBmcm9tIFwiLi4vUmVuZGVyZXIvVGV4dHVyZU1pbmlmaWNhdGlvbkZpbHRlci5qc1wiO1xuaW1wb3J0IFRleHR1cmVXcmFwIGZyb20gXCIuLi9SZW5kZXJlci9UZXh0dXJlV3JhcC5qc1wiO1xuaW1wb3J0IFZlcnRleEFycmF5IGZyb20gXCIuLi9SZW5kZXJlci9WZXJ0ZXhBcnJheS5qc1wiO1xuaW1wb3J0IHdoZW4gZnJvbSBcIi4uL1RoaXJkUGFydHkvd2hlbi5qc1wiO1xuaW1wb3J0IEltYWdlcnlTdGF0ZSBmcm9tIFwiLi9JbWFnZXJ5U3RhdGUuanNcIjtcbmltcG9ydCBRdWFkdHJlZVRpbGVMb2FkU3RhdGUgZnJvbSBcIi4vUXVhZHRyZWVUaWxlTG9hZFN0YXRlLmpzXCI7XG5pbXBvcnQgU2NlbmVNb2RlIGZyb20gXCIuL1NjZW5lTW9kZS5qc1wiO1xuaW1wb3J0IFRlcnJhaW5TdGF0ZSBmcm9tIFwiLi9UZXJyYWluU3RhdGUuanNcIjtcblxuLyoqXG4gKiBDb250YWlucyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFib3V0IGEge0BsaW5rIFF1YWR0cmVlVGlsZX0gb2YgdGhlIGdsb2JlJ3Mgc3VyZmFjZSwgYW5kXG4gKiBlbmNhcHN1bGF0ZXMgc3RhdGUgdHJhbnNpdGlvbiBsb2dpYyBmb3IgbG9hZGluZyB0aWxlcy5cbiAqXG4gKiBAY29uc3RydWN0b3JcbiAqIEBhbGlhcyBHbG9iZVN1cmZhY2VUaWxlXG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBHbG9iZVN1cmZhY2VUaWxlKCkge1xuICAvKipcbiAgICogVGhlIHtAbGluayBUaWxlSW1hZ2VyeX0gYXR0YWNoZWQgdG8gdGhpcyB0aWxlLlxuICAgKiBAdHlwZSB7VGlsZUltYWdlcnlbXX1cbiAgICogQGRlZmF1bHQgW11cbiAgICovXG4gIHRoaXMuaW1hZ2VyeSA9IFtdO1xuXG4gIHRoaXMud2F0ZXJNYXNrVGV4dHVyZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy53YXRlck1hc2tUcmFuc2xhdGlvbkFuZFNjYWxlID0gbmV3IENhcnRlc2lhbjQoMC4wLCAwLjAsIDEuMCwgMS4wKTtcblxuICB0aGlzLnRlcnJhaW5EYXRhID0gdW5kZWZpbmVkO1xuICB0aGlzLnZlcnRleEFycmF5ID0gdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBBIGJvdW5kaW5nIHJlZ2lvbiB1c2VkIHRvIGVzdGltYXRlIGRpc3RhbmNlIHRvIHRoZSB0aWxlLiBUaGUgaG9yaXpvbnRhbCBib3VuZHMgYXJlIGFsd2F5cyB0aWdodC1maXR0aW5nLFxuICAgKiBidXQgdGhlIGBtaW5pbXVtSGVpZ2h0YCBhbmQgYG1heGltdW1IZWlnaHRgIHByb3BlcnRpZXMgbWF5IGJlIGRlcml2ZWQgZnJvbSB0aGUgbWluL21heCBvZiBhbiBhbmNlc3RvciB0aWxlXG4gICAqIGFuZCBiZSBxdWl0ZSBsb29zZS1maXR0aW5nIGFuZCB0aHVzIHZlcnkgcG9vciBmb3IgZXN0aW1hdGluZyBkaXN0YW5jZS5cbiAgICogQHR5cGUge1RpbGVCb3VuZGluZ1JlZ2lvbn1cbiAgICovXG4gIHRoaXMudGlsZUJvdW5kaW5nUmVnaW9uID0gdW5kZWZpbmVkO1xuICB0aGlzLm9jY2x1ZGVlUG9pbnRJblNjYWxlZFNwYWNlID0gbmV3IENhcnRlc2lhbjMoKTtcbiAgdGhpcy5ib3VuZGluZ1ZvbHVtZVNvdXJjZVRpbGUgPSB1bmRlZmluZWQ7XG4gIHRoaXMuYm91bmRpbmdWb2x1bWVJc0Zyb21NZXNoID0gZmFsc2U7XG5cbiAgdGhpcy50ZXJyYWluU3RhdGUgPSBUZXJyYWluU3RhdGUuVU5MT0FERUQ7XG4gIHRoaXMubWVzaCA9IHVuZGVmaW5lZDtcbiAgdGhpcy5maWxsID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMucGlja0JvdW5kaW5nU3BoZXJlID0gbmV3IEJvdW5kaW5nU3BoZXJlKCk7XG5cbiAgdGhpcy5zdXJmYWNlU2hhZGVyID0gdW5kZWZpbmVkO1xuICB0aGlzLmlzQ2xpcHBlZCA9IHRydWU7XG5cbiAgdGhpcy5jbGlwcGVkQnlCb3VuZGFyaWVzID0gZmFsc2U7XG59XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEdsb2JlU3VyZmFjZVRpbGUucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBHZXRzIGEgdmFsdWUgaW5kaWNhdGluZyB3aGV0aGVyIG9yIG5vdCB0aGlzIHRpbGUgaXMgZWxpZ2libGUgdG8gYmUgdW5sb2FkZWQuXG4gICAqIFR5cGljYWxseSwgYSB0aWxlIGlzIGluZWxpZ2libGUgdG8gYmUgdW5sb2FkZWQgd2hpbGUgYW4gYXN5bmNocm9ub3VzIG9wZXJhdGlvbixcbiAgICogc3VjaCBhcyBhIHJlcXVlc3QgZm9yIGRhdGEsIGlzIGluIHByb2dyZXNzIG9uIGl0LiAgQSB0aWxlIHdpbGwgbmV2ZXIgYmVcbiAgICogdW5sb2FkZWQgd2hpbGUgaXQgaXMgbmVlZGVkIGZvciByZW5kZXJpbmcsIHJlZ2FyZGxlc3Mgb2YgdGhlIHZhbHVlIG9mIHRoaXNcbiAgICogcHJvcGVydHkuXG4gICAqIEBtZW1iZXJvZiBHbG9iZVN1cmZhY2VUaWxlLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICovXG4gIGVsaWdpYmxlRm9yVW5sb2FkaW5nOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBEbyBub3QgcmVtb3ZlIHRpbGVzIHRoYXQgYXJlIHRyYW5zaXRpb25pbmcgb3IgdGhhdCBoYXZlXG4gICAgICAvLyBpbWFnZXJ5IHRoYXQgaXMgdHJhbnNpdGlvbmluZy5cbiAgICAgIHZhciB0ZXJyYWluU3RhdGUgPSB0aGlzLnRlcnJhaW5TdGF0ZTtcbiAgICAgIHZhciBsb2FkaW5nSXNUcmFuc2l0aW9uaW5nID1cbiAgICAgICAgdGVycmFpblN0YXRlID09PSBUZXJyYWluU3RhdGUuUkVDRUlWSU5HIHx8XG4gICAgICAgIHRlcnJhaW5TdGF0ZSA9PT0gVGVycmFpblN0YXRlLlRSQU5TRk9STUlORztcblxuICAgICAgdmFyIHNob3VsZFJlbW92ZVRpbGUgPSAhbG9hZGluZ0lzVHJhbnNpdGlvbmluZztcblxuICAgICAgdmFyIGltYWdlcnkgPSB0aGlzLmltYWdlcnk7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaW1hZ2VyeS5sZW5ndGg7IHNob3VsZFJlbW92ZVRpbGUgJiYgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIHZhciB0aWxlSW1hZ2VyeSA9IGltYWdlcnlbaV07XG4gICAgICAgIHNob3VsZFJlbW92ZVRpbGUgPVxuICAgICAgICAgICFkZWZpbmVkKHRpbGVJbWFnZXJ5LmxvYWRpbmdJbWFnZXJ5KSB8fFxuICAgICAgICAgIHRpbGVJbWFnZXJ5LmxvYWRpbmdJbWFnZXJ5LnN0YXRlICE9PSBJbWFnZXJ5U3RhdGUuVFJBTlNJVElPTklORztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHNob3VsZFJlbW92ZVRpbGU7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyB0aGUge0BsaW5rIFRlcnJhaW5NZXNofSB0aGF0IGlzIHVzZWQgZm9yIHJlbmRlcmluZyB0aGlzIHRpbGUsIGlmIGFueS5cbiAgICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIHtAbGluayBHbG9iZVN1cmZhY2VUaWxlI21lc2h9IHByb3BlcnR5IGlmXG4gICAqIHtAbGluayBHbG9iZVN1cmZhY2VUaWxlI3ZlcnRleEFycmF5fSBpcyBkZWZpbmVkLiBPdGhlcndpc2UsIEl0IHJldHVybnMgdGhlXG4gICAqIHtAbGluayBUZXJyYWluRmlsbE1lc2gjbWVzaH0gcHJvcGVydHkgb2YgdGhlIHtAbGluayBHbG9iZVN1cmZhY2VUaWxlI2ZpbGx9LlxuICAgKiBJZiB0aGVyZSBpcyBubyBmaWxsLCBpdCByZXR1cm5zIHVuZGVmaW5lZC5cbiAgICpcbiAgICogQG1lbWJlcm9mIEdsb2JlU3VyZmFjZVRpbGUucHJvdG90eXBlXG4gICAqIEB0eXBlIHtUZXJyYWluTWVzaH1cbiAgICovXG4gIHJlbmRlcmVkTWVzaDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGRlZmluZWQodGhpcy52ZXJ0ZXhBcnJheSkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWVzaDtcbiAgICAgIH0gZWxzZSBpZiAoZGVmaW5lZCh0aGlzLmZpbGwpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbGwubWVzaDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfSxcbiAgfSxcbn0pO1xuXG52YXIgc2NyYXRjaENhcnRvZ3JhcGhpYyA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcblxuZnVuY3Rpb24gZ2V0UG9zaXRpb24oZW5jb2RpbmcsIG1vZGUsIHByb2plY3Rpb24sIHZlcnRpY2VzLCBpbmRleCwgcmVzdWx0KSB7XG4gIHZhciBwb3NpdGlvbiA9IGVuY29kaW5nLmdldEV4YWdnZXJhdGVkUG9zaXRpb24odmVydGljZXMsIGluZGV4LCByZXN1bHQpO1xuXG4gIGlmIChkZWZpbmVkKG1vZGUpICYmIG1vZGUgIT09IFNjZW5lTW9kZS5TQ0VORTNEKSB7XG4gICAgdmFyIGVsbGlwc29pZCA9IHByb2plY3Rpb24uZWxsaXBzb2lkO1xuICAgIHZhciBwb3NpdGlvbkNhcnRvZ3JhcGhpYyA9IGVsbGlwc29pZC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhcbiAgICAgIHBvc2l0aW9uLFxuICAgICAgc2NyYXRjaENhcnRvZ3JhcGhpY1xuICAgICk7XG4gICAgcG9zaXRpb24gPSBwcm9qZWN0aW9uLnByb2plY3QocG9zaXRpb25DYXJ0b2dyYXBoaWMsIHJlc3VsdCk7XG4gICAgcG9zaXRpb24gPSBDYXJ0ZXNpYW4zLmZyb21FbGVtZW50cyhcbiAgICAgIHBvc2l0aW9uLnosXG4gICAgICBwb3NpdGlvbi54LFxuICAgICAgcG9zaXRpb24ueSxcbiAgICAgIHJlc3VsdFxuICAgICk7XG4gIH1cblxuICByZXR1cm4gcG9zaXRpb247XG59XG5cbnZhciBzY3JhdGNoVjAgPSBuZXcgQ2FydGVzaWFuMygpO1xudmFyIHNjcmF0Y2hWMSA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG52YXIgc2NyYXRjaFYyID0gbmV3IENhcnRlc2lhbjMoKTtcblxuR2xvYmVTdXJmYWNlVGlsZS5wcm90b3R5cGUucGljayA9IGZ1bmN0aW9uIChcbiAgcmF5LFxuICBtb2RlLFxuICBwcm9qZWN0aW9uLFxuICBjdWxsQmFja0ZhY2VzLFxuICByZXN1bHRcbikge1xuICB2YXIgbWVzaCA9IHRoaXMucmVuZGVyZWRNZXNoO1xuICBpZiAoIWRlZmluZWQobWVzaCkpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgdmFyIHZlcnRpY2VzID0gbWVzaC52ZXJ0aWNlcztcbiAgdmFyIGluZGljZXMgPSBtZXNoLmluZGljZXM7XG4gIHZhciBlbmNvZGluZyA9IG1lc2guZW5jb2Rpbmc7XG4gIHZhciBpbmRpY2VzTGVuZ3RoID0gaW5kaWNlcy5sZW5ndGg7XG5cbiAgdmFyIG1pblQgPSBOdW1iZXIuTUFYX1ZBTFVFO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNlc0xlbmd0aDsgaSArPSAzKSB7XG4gICAgdmFyIGkwID0gaW5kaWNlc1tpXTtcbiAgICB2YXIgaTEgPSBpbmRpY2VzW2kgKyAxXTtcbiAgICB2YXIgaTIgPSBpbmRpY2VzW2kgKyAyXTtcblxuICAgIHZhciB2MCA9IGdldFBvc2l0aW9uKGVuY29kaW5nLCBtb2RlLCBwcm9qZWN0aW9uLCB2ZXJ0aWNlcywgaTAsIHNjcmF0Y2hWMCk7XG4gICAgdmFyIHYxID0gZ2V0UG9zaXRpb24oZW5jb2RpbmcsIG1vZGUsIHByb2plY3Rpb24sIHZlcnRpY2VzLCBpMSwgc2NyYXRjaFYxKTtcbiAgICB2YXIgdjIgPSBnZXRQb3NpdGlvbihlbmNvZGluZywgbW9kZSwgcHJvamVjdGlvbiwgdmVydGljZXMsIGkyLCBzY3JhdGNoVjIpO1xuXG4gICAgdmFyIHQgPSBJbnRlcnNlY3Rpb25UZXN0cy5yYXlUcmlhbmdsZVBhcmFtZXRyaWMoXG4gICAgICByYXksXG4gICAgICB2MCxcbiAgICAgIHYxLFxuICAgICAgdjIsXG4gICAgICBjdWxsQmFja0ZhY2VzXG4gICAgKTtcbiAgICBpZiAoZGVmaW5lZCh0KSAmJiB0IDwgbWluVCAmJiB0ID49IDAuMCkge1xuICAgICAgbWluVCA9IHQ7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG1pblQgIT09IE51bWJlci5NQVhfVkFMVUVcbiAgICA/IFJheS5nZXRQb2ludChyYXksIG1pblQsIHJlc3VsdClcbiAgICA6IHVuZGVmaW5lZDtcbn07XG5cbkdsb2JlU3VyZmFjZVRpbGUucHJvdG90eXBlLmZyZWVSZXNvdXJjZXMgPSBmdW5jdGlvbiAoKSB7XG4gIGlmIChkZWZpbmVkKHRoaXMud2F0ZXJNYXNrVGV4dHVyZSkpIHtcbiAgICAtLXRoaXMud2F0ZXJNYXNrVGV4dHVyZS5yZWZlcmVuY2VDb3VudDtcbiAgICBpZiAodGhpcy53YXRlck1hc2tUZXh0dXJlLnJlZmVyZW5jZUNvdW50ID09PSAwKSB7XG4gICAgICB0aGlzLndhdGVyTWFza1RleHR1cmUuZGVzdHJveSgpO1xuICAgIH1cbiAgICB0aGlzLndhdGVyTWFza1RleHR1cmUgPSB1bmRlZmluZWQ7XG4gIH1cblxuICB0aGlzLnRlcnJhaW5EYXRhID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMudGVycmFpblN0YXRlID0gVGVycmFpblN0YXRlLlVOTE9BREVEO1xuICB0aGlzLm1lc2ggPSB1bmRlZmluZWQ7XG4gIHRoaXMuZmlsbCA9IHRoaXMuZmlsbCAmJiB0aGlzLmZpbGwuZGVzdHJveSgpO1xuXG4gIHZhciBpbWFnZXJ5TGlzdCA9IHRoaXMuaW1hZ2VyeTtcbiAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGltYWdlcnlMaXN0Lmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgaW1hZ2VyeUxpc3RbaV0uZnJlZVJlc291cmNlcygpO1xuICB9XG4gIHRoaXMuaW1hZ2VyeS5sZW5ndGggPSAwO1xuXG4gIHRoaXMuZnJlZVZlcnRleEFycmF5KCk7XG59O1xuXG5HbG9iZVN1cmZhY2VUaWxlLnByb3RvdHlwZS5mcmVlVmVydGV4QXJyYXkgPSBmdW5jdGlvbiAoKSB7XG4gIEdsb2JlU3VyZmFjZVRpbGUuX2ZyZWVWZXJ0ZXhBcnJheSh0aGlzLnZlcnRleEFycmF5KTtcbiAgdGhpcy52ZXJ0ZXhBcnJheSA9IHVuZGVmaW5lZDtcbiAgR2xvYmVTdXJmYWNlVGlsZS5fZnJlZVZlcnRleEFycmF5KHRoaXMud2lyZWZyYW1lVmVydGV4QXJyYXkpO1xuICB0aGlzLndpcmVmcmFtZVZlcnRleEFycmF5ID0gdW5kZWZpbmVkO1xufTtcblxuR2xvYmVTdXJmYWNlVGlsZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKFxuICB0aWxlLFxuICB0ZXJyYWluUHJvdmlkZXIsXG4gIGltYWdlcnlMYXllckNvbGxlY3Rpb25cbikge1xuICB2YXIgc3VyZmFjZVRpbGUgPSB0aWxlLmRhdGE7XG4gIGlmICghZGVmaW5lZChzdXJmYWNlVGlsZSkpIHtcbiAgICBzdXJmYWNlVGlsZSA9IHRpbGUuZGF0YSA9IG5ldyBHbG9iZVN1cmZhY2VUaWxlKCk7XG4gIH1cblxuICBpZiAodGlsZS5zdGF0ZSA9PT0gUXVhZHRyZWVUaWxlTG9hZFN0YXRlLlNUQVJUKSB7XG4gICAgcHJlcGFyZU5ld1RpbGUodGlsZSwgdGVycmFpblByb3ZpZGVyLCBpbWFnZXJ5TGF5ZXJDb2xsZWN0aW9uKTtcbiAgICB0aWxlLnN0YXRlID0gUXVhZHRyZWVUaWxlTG9hZFN0YXRlLkxPQURJTkc7XG4gIH1cbn07XG5cbkdsb2JlU3VyZmFjZVRpbGUucHJvY2Vzc1N0YXRlTWFjaGluZSA9IGZ1bmN0aW9uIChcbiAgdGlsZSxcbiAgZnJhbWVTdGF0ZSxcbiAgdGVycmFpblByb3ZpZGVyLFxuICBpbWFnZXJ5TGF5ZXJDb2xsZWN0aW9uLFxuICBxdWFkdHJlZSxcbiAgdmVydGV4QXJyYXlzVG9EZXN0cm95LFxuICB0ZXJyYWluT25seVxuKSB7XG4gIEdsb2JlU3VyZmFjZVRpbGUuaW5pdGlhbGl6ZSh0aWxlLCB0ZXJyYWluUHJvdmlkZXIsIGltYWdlcnlMYXllckNvbGxlY3Rpb24pO1xuXG4gIHZhciBzdXJmYWNlVGlsZSA9IHRpbGUuZGF0YTtcblxuICBpZiAodGlsZS5zdGF0ZSA9PT0gUXVhZHRyZWVUaWxlTG9hZFN0YXRlLkxPQURJTkcpIHtcbiAgICBwcm9jZXNzVGVycmFpblN0YXRlTWFjaGluZShcbiAgICAgIHRpbGUsXG4gICAgICBmcmFtZVN0YXRlLFxuICAgICAgdGVycmFpblByb3ZpZGVyLFxuICAgICAgaW1hZ2VyeUxheWVyQ29sbGVjdGlvbixcbiAgICAgIHF1YWR0cmVlLFxuICAgICAgdmVydGV4QXJyYXlzVG9EZXN0cm95XG4gICAgKTtcbiAgfVxuXG4gIC8vIEZyb20gaGVyZSBkb3duIHdlJ3JlIGxvYWRpbmcgaW1hZ2VyeSwgbm90IHRlcnJhaW4uIFdlIGRvbid0IHdhbnQgdG8gbG9hZCBpbWFnZXJ5IHVudGlsXG4gIC8vIHdlJ3JlIGNlcnRhaW4gdGhhdCB0aGUgdGVycmFpbiB0aWxlcyBhcmUgYWN0dWFsbHkgdmlzaWJsZSwgdGhvdWdoLiBXZSdsbCBsb2FkIHRlcnJhaW5Pbmx5XG4gIC8vIGluIHRoZXNlIHNjZW5hcmlvczpcbiAgLy8gICAqIG91ciBib3VuZGluZyB2b2x1bWUgaXNuJ3QgYWNjdXJhdGUgc28gd2UncmUgbm90IGNlcnRhaW4gdGhpcyB0aWxlIGlzIHJlYWxseSB2aXNpYmxlIChzZWUgR2xvYmVTdXJmYWNlVGlsZVByb3ZpZGVyI2xvYWRUaWxlKS5cbiAgLy8gICAqIHdlIHdhbnQgdG8gdXBzYW1wbGUgZnJvbSB0aGlzIHRpbGUgYnV0IGRvbid0IHBsYW4gdG8gcmVuZGVyIGl0IChzZWUgcHJvY2Vzc1RlcnJhaW5TdGF0ZU1hY2hpbmUpLlxuICBpZiAodGVycmFpbk9ubHkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgd2FzQWxyZWFkeVJlbmRlcmFibGUgPSB0aWxlLnJlbmRlcmFibGU7XG5cbiAgLy8gVGhlIHRlcnJhaW4gaXMgcmVuZGVyYWJsZSBhcyBzb29uIGFzIHdlIGhhdmUgYSB2YWxpZCB2ZXJ0ZXggYXJyYXkuXG4gIHRpbGUucmVuZGVyYWJsZSA9IGRlZmluZWQoc3VyZmFjZVRpbGUudmVydGV4QXJyYXkpO1xuXG4gIC8vIEJ1dCBpdCdzIG5vdCBkb25lIGxvYWRpbmcgdW50aWwgaXQncyBpbiB0aGUgUkVBRFkgc3RhdGUuXG4gIHZhciBpc1RlcnJhaW5Eb25lTG9hZGluZyA9IHN1cmZhY2VUaWxlLnRlcnJhaW5TdGF0ZSA9PT0gVGVycmFpblN0YXRlLlJFQURZO1xuXG4gIC8vIElmIHRoaXMgdGlsZSdzIHRlcnJhaW4gYW5kIGltYWdlcnkgYXJlIGp1c3QgdXBzYW1wbGVkIGZyb20gaXRzIHBhcmVudCwgbWFyayB0aGUgdGlsZSBhc1xuICAvLyB1cHNhbXBsZWQgb25seS4gIFdlIHdvbid0IHJlZmluZSBhIHRpbGUgaWYgaXRzIGZvdXIgY2hpbGRyZW4gYXJlIHVwc2FtcGxlZCBvbmx5LlxuICB0aWxlLnVwc2FtcGxlZEZyb21QYXJlbnQgPVxuICAgIGRlZmluZWQoc3VyZmFjZVRpbGUudGVycmFpbkRhdGEpICYmXG4gICAgc3VyZmFjZVRpbGUudGVycmFpbkRhdGEud2FzQ3JlYXRlZEJ5VXBzYW1wbGluZygpO1xuXG4gIHZhciBpc0ltYWdlcnlEb25lTG9hZGluZyA9IHN1cmZhY2VUaWxlLnByb2Nlc3NJbWFnZXJ5KFxuICAgIHRpbGUsXG4gICAgdGVycmFpblByb3ZpZGVyLFxuICAgIGZyYW1lU3RhdGVcbiAgKTtcblxuICBpZiAoaXNUZXJyYWluRG9uZUxvYWRpbmcgJiYgaXNJbWFnZXJ5RG9uZUxvYWRpbmcpIHtcbiAgICB2YXIgY2FsbGJhY2tzID0gdGlsZS5fbG9hZGVkQ2FsbGJhY2tzO1xuICAgIHZhciBuZXdDYWxsYmFja3MgPSB7fTtcbiAgICBmb3IgKHZhciBsYXllcklkIGluIGNhbGxiYWNrcykge1xuICAgICAgaWYgKGNhbGxiYWNrcy5oYXNPd25Qcm9wZXJ0eShsYXllcklkKSkge1xuICAgICAgICBpZiAoIWNhbGxiYWNrc1tsYXllcklkXSh0aWxlKSkge1xuICAgICAgICAgIG5ld0NhbGxiYWNrc1tsYXllcklkXSA9IGNhbGxiYWNrc1tsYXllcklkXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB0aWxlLl9sb2FkZWRDYWxsYmFja3MgPSBuZXdDYWxsYmFja3M7XG5cbiAgICB0aWxlLnN0YXRlID0gUXVhZHRyZWVUaWxlTG9hZFN0YXRlLkRPTkU7XG4gIH1cblxuICAvLyBPbmNlIGEgdGlsZSBpcyByZW5kZXJhYmxlLCBpdCBzdGF5cyByZW5kZXJhYmxlLCBiZWNhdXNlIGRvaW5nIG90aGVyd2lzZSB3b3VsZFxuICAvLyBjYXVzZSBkZXRhaWwgKG9yIG1heWJlIGV2ZW4gdGhlIGVudGlyZSBnbG9iZSkgdG8gdmFuaXNoIHdoZW4gYWRkaW5nIGEgbmV3XG4gIC8vIGltYWdlcnkgbGF5ZXIuIGBHbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIuX29uTGF5ZXJBZGRlZGAgc2V0cyByZW5kZXJhYmxlIHRvXG4gIC8vIGZhbHNlIGZvciBhbGwgYWZmZWN0ZWQgdGlsZXMgdGhhdCBhcmUgbm90IGN1cnJlbnRseSBiZWluZyByZW5kZXJlZC5cbiAgaWYgKHdhc0FscmVhZHlSZW5kZXJhYmxlKSB7XG4gICAgdGlsZS5yZW5kZXJhYmxlID0gdHJ1ZTtcbiAgfVxufTtcblxuR2xvYmVTdXJmYWNlVGlsZS5wcm90b3R5cGUucHJvY2Vzc0ltYWdlcnkgPSBmdW5jdGlvbiAoXG4gIHRpbGUsXG4gIHRlcnJhaW5Qcm92aWRlcixcbiAgZnJhbWVTdGF0ZSxcbiAgc2tpcExvYWRpbmdcbikge1xuICB2YXIgc3VyZmFjZVRpbGUgPSB0aWxlLmRhdGE7XG4gIHZhciBpc1Vwc2FtcGxlZE9ubHkgPSB0aWxlLnVwc2FtcGxlZEZyb21QYXJlbnQ7XG4gIHZhciBpc0FueVRpbGVMb2FkZWQgPSBmYWxzZTtcbiAgdmFyIGlzRG9uZUxvYWRpbmcgPSB0cnVlO1xuXG4gIC8vIFRyYW5zaXRpb24gaW1hZ2VyeSBzdGF0ZXNcbiAgdmFyIHRpbGVJbWFnZXJ5Q29sbGVjdGlvbiA9IHN1cmZhY2VUaWxlLmltYWdlcnk7XG4gIHZhciBpLCBsZW47XG4gIGZvciAoaSA9IDAsIGxlbiA9IHRpbGVJbWFnZXJ5Q29sbGVjdGlvbi5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgIHZhciB0aWxlSW1hZ2VyeSA9IHRpbGVJbWFnZXJ5Q29sbGVjdGlvbltpXTtcbiAgICBpZiAoIWRlZmluZWQodGlsZUltYWdlcnkubG9hZGluZ0ltYWdlcnkpKSB7XG4gICAgICBpc1Vwc2FtcGxlZE9ubHkgPSBmYWxzZTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmICh0aWxlSW1hZ2VyeS5sb2FkaW5nSW1hZ2VyeS5zdGF0ZSA9PT0gSW1hZ2VyeVN0YXRlLlBMQUNFSE9MREVSKSB7XG4gICAgICB2YXIgaW1hZ2VyeUxheWVyID0gdGlsZUltYWdlcnkubG9hZGluZ0ltYWdlcnkuaW1hZ2VyeUxheWVyO1xuICAgICAgaWYgKGltYWdlcnlMYXllci5pbWFnZXJ5UHJvdmlkZXIucmVhZHkpIHtcbiAgICAgICAgLy8gUmVtb3ZlIHRoZSBwbGFjZWhvbGRlciBhbmQgYWRkIHRoZSBhY3R1YWwgc2tlbGV0b25zIChpZiBhbnkpXG4gICAgICAgIC8vIGF0IHRoZSBzYW1lIHBvc2l0aW9uLiAgVGhlbiBjb250aW51ZSB0aGUgbG9vcCBhdCB0aGUgc2FtZSBpbmRleC5cbiAgICAgICAgdGlsZUltYWdlcnkuZnJlZVJlc291cmNlcygpO1xuICAgICAgICB0aWxlSW1hZ2VyeUNvbGxlY3Rpb24uc3BsaWNlKGksIDEpO1xuICAgICAgICBpbWFnZXJ5TGF5ZXIuX2NyZWF0ZVRpbGVJbWFnZXJ5U2tlbGV0b25zKHRpbGUsIHRlcnJhaW5Qcm92aWRlciwgaSk7XG4gICAgICAgIC0taTtcbiAgICAgICAgbGVuID0gdGlsZUltYWdlcnlDb2xsZWN0aW9uLmxlbmd0aDtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpc1Vwc2FtcGxlZE9ubHkgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgdGhpc1RpbGVEb25lTG9hZGluZyA9IHRpbGVJbWFnZXJ5LnByb2Nlc3NTdGF0ZU1hY2hpbmUoXG4gICAgICB0aWxlLFxuICAgICAgZnJhbWVTdGF0ZSxcbiAgICAgIHNraXBMb2FkaW5nXG4gICAgKTtcbiAgICBpc0RvbmVMb2FkaW5nID0gaXNEb25lTG9hZGluZyAmJiB0aGlzVGlsZURvbmVMb2FkaW5nO1xuXG4gICAgLy8gVGhlIGltYWdlcnkgaXMgcmVuZGVyYWJsZSBhcyBzb29uIGFzIHdlIGhhdmUgYW55IHJlbmRlcmFibGUgaW1hZ2VyeSBmb3IgdGhpcyByZWdpb24uXG4gICAgaXNBbnlUaWxlTG9hZGVkID1cbiAgICAgIGlzQW55VGlsZUxvYWRlZCB8fFxuICAgICAgdGhpc1RpbGVEb25lTG9hZGluZyB8fFxuICAgICAgZGVmaW5lZCh0aWxlSW1hZ2VyeS5yZWFkeUltYWdlcnkpO1xuXG4gICAgaXNVcHNhbXBsZWRPbmx5ID1cbiAgICAgIGlzVXBzYW1wbGVkT25seSAmJlxuICAgICAgZGVmaW5lZCh0aWxlSW1hZ2VyeS5sb2FkaW5nSW1hZ2VyeSkgJiZcbiAgICAgICh0aWxlSW1hZ2VyeS5sb2FkaW5nSW1hZ2VyeS5zdGF0ZSA9PT0gSW1hZ2VyeVN0YXRlLkZBSUxFRCB8fFxuICAgICAgICB0aWxlSW1hZ2VyeS5sb2FkaW5nSW1hZ2VyeS5zdGF0ZSA9PT0gSW1hZ2VyeVN0YXRlLklOVkFMSUQpO1xuICB9XG5cbiAgdGlsZS51cHNhbXBsZWRGcm9tUGFyZW50ID0gaXNVcHNhbXBsZWRPbmx5O1xuXG4gIC8vIEFsbG93IHJlbmRlcmluZyBpZiBhbnkgYXZhaWxhYmxlIGxheWVycyBhcmUgbG9hZGVkXG4gIHRpbGUucmVuZGVyYWJsZSA9IHRpbGUucmVuZGVyYWJsZSAmJiAoaXNBbnlUaWxlTG9hZGVkIHx8IGlzRG9uZUxvYWRpbmcpO1xuXG4gIHJldHVybiBpc0RvbmVMb2FkaW5nO1xufTtcblxuZnVuY3Rpb24gdG9nZ2xlR2VvZGV0aWNTdXJmYWNlTm9ybWFscyhcbiAgc3VyZmFjZVRpbGUsXG4gIGVuYWJsZWQsXG4gIGVsbGlwc29pZCxcbiAgZnJhbWVTdGF0ZVxuKSB7XG4gIHZhciByZW5kZXJlZE1lc2ggPSBzdXJmYWNlVGlsZS5yZW5kZXJlZE1lc2g7XG4gIHZhciB2ZXJ0ZXhCdWZmZXIgPSByZW5kZXJlZE1lc2gudmVydGljZXM7XG4gIHZhciBlbmNvZGluZyA9IHJlbmRlcmVkTWVzaC5lbmNvZGluZztcbiAgdmFyIHZlcnRleENvdW50ID0gdmVydGV4QnVmZmVyLmxlbmd0aCAvIGVuY29kaW5nLnN0cmlkZTtcblxuICAvLyBDYWxjdWxhdGUgdGhlIG5ldyBzdHJpZGUgYW5kIGdlbmVyYXRlIGEgbmV3IGJ1ZmZlclxuICAvLyBDbG9uZSB0aGUgb3RoZXIgZW5jb2RpbmcsIHRvZ2dsZSBnZW9kZXRpYyBzdXJmYWNlIG5vcm1hbHMsIHRoZW4gY2xvbmUgYWdhaW4gdG8gZ2V0IHVwZGF0ZWQgc3RyaWRlXG4gIHZhciBuZXdFbmNvZGluZyA9IFRlcnJhaW5FbmNvZGluZy5jbG9uZShlbmNvZGluZyk7XG4gIG5ld0VuY29kaW5nLmhhc0dlb2RldGljU3VyZmFjZU5vcm1hbHMgPSBlbmFibGVkO1xuICBuZXdFbmNvZGluZyA9IFRlcnJhaW5FbmNvZGluZy5jbG9uZShuZXdFbmNvZGluZyk7XG4gIHZhciBuZXdTdHJpZGUgPSBuZXdFbmNvZGluZy5zdHJpZGU7XG4gIHZhciBuZXdWZXJ0ZXhCdWZmZXIgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRleENvdW50ICogbmV3U3RyaWRlKTtcblxuICBpZiAoZW5hYmxlZCkge1xuICAgIGVuY29kaW5nLmFkZEdlb2RldGljU3VyZmFjZU5vcm1hbHMoXG4gICAgICB2ZXJ0ZXhCdWZmZXIsXG4gICAgICBuZXdWZXJ0ZXhCdWZmZXIsXG4gICAgICBlbGxpcHNvaWRcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIGVuY29kaW5nLnJlbW92ZUdlb2RldGljU3VyZmFjZU5vcm1hbHModmVydGV4QnVmZmVyLCBuZXdWZXJ0ZXhCdWZmZXIpO1xuICB9XG5cbiAgcmVuZGVyZWRNZXNoLnZlcnRpY2VzID0gbmV3VmVydGV4QnVmZmVyO1xuICByZW5kZXJlZE1lc2guc3RyaWRlID0gbmV3U3RyaWRlO1xuXG4gIC8vIGRlbGV0ZSB0aGUgb2xkIHZlcnRleCBhcnJheSAod2hpY2ggZGVsZXRlcyB0aGUgdmVydGV4IGJ1ZmZlciBhdHRhY2hlZCB0byBpdCksIGFuZCBjcmVhdGUgYSBuZXcgdmVydGV4IGFycmF5IHdpdGggdGhlIG5ldyB2ZXJ0ZXggYnVmZmVyXG4gIHZhciBpc0ZpbGwgPSByZW5kZXJlZE1lc2ggIT09IHN1cmZhY2VUaWxlLm1lc2g7XG4gIGlmIChpc0ZpbGwpIHtcbiAgICBHbG9iZVN1cmZhY2VUaWxlLl9mcmVlVmVydGV4QXJyYXkoc3VyZmFjZVRpbGUuZmlsbC52ZXJ0ZXhBcnJheSk7XG4gICAgc3VyZmFjZVRpbGUuZmlsbC52ZXJ0ZXhBcnJheSA9IEdsb2JlU3VyZmFjZVRpbGUuX2NyZWF0ZVZlcnRleEFycmF5Rm9yTWVzaChcbiAgICAgIGZyYW1lU3RhdGUuY29udGV4dCxcbiAgICAgIHJlbmRlcmVkTWVzaFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgR2xvYmVTdXJmYWNlVGlsZS5fZnJlZVZlcnRleEFycmF5KHN1cmZhY2VUaWxlLnZlcnRleEFycmF5KTtcbiAgICBzdXJmYWNlVGlsZS52ZXJ0ZXhBcnJheSA9IEdsb2JlU3VyZmFjZVRpbGUuX2NyZWF0ZVZlcnRleEFycmF5Rm9yTWVzaChcbiAgICAgIGZyYW1lU3RhdGUuY29udGV4dCxcbiAgICAgIHJlbmRlcmVkTWVzaFxuICAgICk7XG4gIH1cbiAgR2xvYmVTdXJmYWNlVGlsZS5fZnJlZVZlcnRleEFycmF5KHN1cmZhY2VUaWxlLndpcmVmcmFtZVZlcnRleEFycmF5KTtcbiAgc3VyZmFjZVRpbGUud2lyZWZyYW1lVmVydGV4QXJyYXkgPSB1bmRlZmluZWQ7XG59XG5cbkdsb2JlU3VyZmFjZVRpbGUucHJvdG90eXBlLmFkZEdlb2RldGljU3VyZmFjZU5vcm1hbHMgPSBmdW5jdGlvbiAoXG4gIGVsbGlwc29pZCxcbiAgZnJhbWVTdGF0ZVxuKSB7XG4gIHRvZ2dsZUdlb2RldGljU3VyZmFjZU5vcm1hbHModGhpcywgdHJ1ZSwgZWxsaXBzb2lkLCBmcmFtZVN0YXRlKTtcbn07XG5cbkdsb2JlU3VyZmFjZVRpbGUucHJvdG90eXBlLnJlbW92ZUdlb2RldGljU3VyZmFjZU5vcm1hbHMgPSBmdW5jdGlvbiAoXG4gIGZyYW1lU3RhdGVcbikge1xuICB0b2dnbGVHZW9kZXRpY1N1cmZhY2VOb3JtYWxzKHRoaXMsIGZhbHNlLCB1bmRlZmluZWQsIGZyYW1lU3RhdGUpO1xufTtcblxuR2xvYmVTdXJmYWNlVGlsZS5wcm90b3R5cGUudXBkYXRlRXhhZ2dlcmF0aW9uID0gZnVuY3Rpb24gKFxuICB0aWxlLFxuICBmcmFtZVN0YXRlLFxuICBxdWFkdHJlZVxuKSB7XG4gIHZhciBzdXJmYWNlVGlsZSA9IHRoaXM7XG4gIHZhciBtZXNoID0gc3VyZmFjZVRpbGUucmVuZGVyZWRNZXNoO1xuICBpZiAobWVzaCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gQ2hlY2sgdGhlIHRpbGUncyB0ZXJyYWluIGVuY29kaW5nIHRvIHNlZSBpZiBpdCBoYXMgYmVlbiBleGFnZ2VyYXRlZCB5ZXRcbiAgdmFyIGV4YWdnZXJhdGlvbiA9IGZyYW1lU3RhdGUudGVycmFpbkV4YWdnZXJhdGlvbjtcbiAgdmFyIGV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0ID0gZnJhbWVTdGF0ZS50ZXJyYWluRXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHQ7XG4gIHZhciBoYXNFeGFnZ2VyYXRpb25TY2FsZSA9IGV4YWdnZXJhdGlvbiAhPT0gMS4wO1xuXG4gIHZhciBlbmNvZGluZyA9IG1lc2guZW5jb2Rpbmc7XG4gIHZhciBlbmNvZGluZ0V4YWdnZXJhdGlvblNjYWxlQ2hhbmdlZCA9IGVuY29kaW5nLmV4YWdnZXJhdGlvbiAhPT0gZXhhZ2dlcmF0aW9uO1xuICB2YXIgZW5jb2RpbmdSZWxhdGl2ZUhlaWdodENoYW5nZWQgPVxuICAgIGVuY29kaW5nLmV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0ICE9PSBleGFnZ2VyYXRpb25SZWxhdGl2ZUhlaWdodDtcblxuICBpZiAoZW5jb2RpbmdFeGFnZ2VyYXRpb25TY2FsZUNoYW5nZWQgfHwgZW5jb2RpbmdSZWxhdGl2ZUhlaWdodENoYW5nZWQpIHtcbiAgICAvLyBUdXJuaW5nIGV4YWdnZXJhdGlvbiBzY2FsZSBvbi9vZmYgcmVxdWlyZXMgYWRkaW5nIG9yIHJlbW92aW5nIGdlb2RldGljIHN1cmZhY2Ugbm9ybWFsc1xuICAgIC8vIFJlbGF0aXZlIGhlaWdodCBvbmx5IHRyYW5zbGF0ZXMsIHNvIGl0IGhhcyBubyBlZmZlY3Qgb24gbm9ybWFsc1xuICAgIGlmIChlbmNvZGluZ0V4YWdnZXJhdGlvblNjYWxlQ2hhbmdlZCkge1xuICAgICAgaWYgKGhhc0V4YWdnZXJhdGlvblNjYWxlICYmICFlbmNvZGluZy5oYXNHZW9kZXRpY1N1cmZhY2VOb3JtYWxzKSB7XG4gICAgICAgIHZhciBlbGxpcHNvaWQgPSB0aWxlLnRpbGluZ1NjaGVtZS5lbGxpcHNvaWQ7XG4gICAgICAgIHN1cmZhY2VUaWxlLmFkZEdlb2RldGljU3VyZmFjZU5vcm1hbHMoZWxsaXBzb2lkLCBmcmFtZVN0YXRlKTtcbiAgICAgIH0gZWxzZSBpZiAoIWhhc0V4YWdnZXJhdGlvblNjYWxlICYmIGVuY29kaW5nLmhhc0dlb2RldGljU3VyZmFjZU5vcm1hbHMpIHtcbiAgICAgICAgc3VyZmFjZVRpbGUucmVtb3ZlR2VvZGV0aWNTdXJmYWNlTm9ybWFscyhmcmFtZVN0YXRlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBlbmNvZGluZy5leGFnZ2VyYXRpb24gPSBleGFnZ2VyYXRpb247XG4gICAgZW5jb2RpbmcuZXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHQgPSBleGFnZ2VyYXRpb25SZWxhdGl2ZUhlaWdodDtcblxuICAgIC8vIE5vdGlmeSB0aGUgcXVhZHRyZWUgdGhhdCB0aGlzIHRpbGUncyBoZWlnaHQgaGFzIGNoYW5nZWRcbiAgICBpZiAocXVhZHRyZWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcXVhZHRyZWUuX3RpbGVUb1VwZGF0ZUhlaWdodHMucHVzaCh0aWxlKTtcbiAgICAgIHZhciBjdXN0b21EYXRhID0gdGlsZS5jdXN0b21EYXRhO1xuICAgICAgdmFyIGN1c3RvbURhdGFMZW5ndGggPSBjdXN0b21EYXRhLmxlbmd0aDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3VzdG9tRGF0YUxlbmd0aDsgaSsrKSB7XG4gICAgICAgIC8vIFJlc3RhcnQgdGhlIGxldmVsIHNvIHRoYXQgYSBoZWlnaHQgdXBkYXRlIGlzIHRyaWdnZXJlZFxuICAgICAgICB2YXIgZGF0YSA9IGN1c3RvbURhdGFbaV07XG4gICAgICAgIGRhdGEubGV2ZWwgPSAtMTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmZ1bmN0aW9uIHByZXBhcmVOZXdUaWxlKHRpbGUsIHRlcnJhaW5Qcm92aWRlciwgaW1hZ2VyeUxheWVyQ29sbGVjdGlvbikge1xuICB2YXIgYXZhaWxhYmxlID0gdGVycmFpblByb3ZpZGVyLmdldFRpbGVEYXRhQXZhaWxhYmxlKFxuICAgIHRpbGUueCxcbiAgICB0aWxlLnksXG4gICAgdGlsZS5sZXZlbFxuICApO1xuXG4gIGlmICghZGVmaW5lZChhdmFpbGFibGUpICYmIGRlZmluZWQodGlsZS5wYXJlbnQpKSB7XG4gICAgLy8gUHJvdmlkZXIgZG9lc24ndCBrbm93IGlmIHRoaXMgdGlsZSBpcyBhdmFpbGFibGUuIERvZXMgdGhlIHBhcmVudCB0aWxlIGtub3c/XG4gICAgdmFyIHBhcmVudCA9IHRpbGUucGFyZW50O1xuICAgIHZhciBwYXJlbnRTdXJmYWNlVGlsZSA9IHBhcmVudC5kYXRhO1xuICAgIGlmIChkZWZpbmVkKHBhcmVudFN1cmZhY2VUaWxlKSAmJiBkZWZpbmVkKHBhcmVudFN1cmZhY2VUaWxlLnRlcnJhaW5EYXRhKSkge1xuICAgICAgYXZhaWxhYmxlID0gcGFyZW50U3VyZmFjZVRpbGUudGVycmFpbkRhdGEuaXNDaGlsZEF2YWlsYWJsZShcbiAgICAgICAgcGFyZW50LngsXG4gICAgICAgIHBhcmVudC55LFxuICAgICAgICB0aWxlLngsXG4gICAgICAgIHRpbGUueVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBpZiAoYXZhaWxhYmxlID09PSBmYWxzZSkge1xuICAgIC8vIFRoaXMgdGlsZSBpcyBub3QgYXZhaWxhYmxlLCBzbyBtYXJrIGl0IGZhaWxlZCBzbyB3ZSBzdGFydCB1cHNhbXBsaW5nIHJpZ2h0IGF3YXkuXG4gICAgdGlsZS5kYXRhLnRlcnJhaW5TdGF0ZSA9IFRlcnJhaW5TdGF0ZS5GQUlMRUQ7XG4gIH1cblxuICAvLyBNYXAgaW1hZ2VyeSB0aWxlcyB0byB0aGlzIHRlcnJhaW4gdGlsZVxuICBmb3IgKHZhciBpID0gMCwgbGVuID0gaW1hZ2VyeUxheWVyQ29sbGVjdGlvbi5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgIHZhciBsYXllciA9IGltYWdlcnlMYXllckNvbGxlY3Rpb24uZ2V0KGkpO1xuICAgIGlmIChsYXllci5zaG93KSB7XG4gICAgICBsYXllci5fY3JlYXRlVGlsZUltYWdlcnlTa2VsZXRvbnModGlsZSwgdGVycmFpblByb3ZpZGVyKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gcHJvY2Vzc1RlcnJhaW5TdGF0ZU1hY2hpbmUoXG4gIHRpbGUsXG4gIGZyYW1lU3RhdGUsXG4gIHRlcnJhaW5Qcm92aWRlcixcbiAgaW1hZ2VyeUxheWVyQ29sbGVjdGlvbixcbiAgcXVhZHRyZWUsXG4gIHZlcnRleEFycmF5c1RvRGVzdHJveVxuKSB7XG4gIHZhciBzdXJmYWNlVGlsZSA9IHRpbGUuZGF0YTtcblxuICAvLyBJZiB0aGlzIHRpbGUgaXMgRkFJTEVELCB3ZSdsbCBuZWVkIHRvIHVwc2FtcGxlIGZyb20gdGhlIHBhcmVudC4gSWYgdGhlIHBhcmVudCBpc24ndFxuICAvLyByZWFkeSBmb3IgdGhhdCwgbGV0J3MgcHVzaCBpdCBhbG9uZy5cbiAgdmFyIHBhcmVudCA9IHRpbGUucGFyZW50O1xuICBpZiAoXG4gICAgc3VyZmFjZVRpbGUudGVycmFpblN0YXRlID09PSBUZXJyYWluU3RhdGUuRkFJTEVEICYmXG4gICAgcGFyZW50ICE9PSB1bmRlZmluZWRcbiAgKSB7XG4gICAgdmFyIHBhcmVudFJlYWR5ID1cbiAgICAgIHBhcmVudC5kYXRhICE9PSB1bmRlZmluZWQgJiZcbiAgICAgIHBhcmVudC5kYXRhLnRlcnJhaW5EYXRhICE9PSB1bmRlZmluZWQgJiZcbiAgICAgIHBhcmVudC5kYXRhLnRlcnJhaW5EYXRhLmNhblVwc2FtcGxlICE9PSBmYWxzZTtcbiAgICBpZiAoIXBhcmVudFJlYWR5KSB7XG4gICAgICBHbG9iZVN1cmZhY2VUaWxlLnByb2Nlc3NTdGF0ZU1hY2hpbmUoXG4gICAgICAgIHBhcmVudCxcbiAgICAgICAgZnJhbWVTdGF0ZSxcbiAgICAgICAgdGVycmFpblByb3ZpZGVyLFxuICAgICAgICBpbWFnZXJ5TGF5ZXJDb2xsZWN0aW9uLFxuICAgICAgICBxdWFkdHJlZSxcbiAgICAgICAgdmVydGV4QXJyYXlzVG9EZXN0cm95LFxuICAgICAgICB0cnVlXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGlmIChzdXJmYWNlVGlsZS50ZXJyYWluU3RhdGUgPT09IFRlcnJhaW5TdGF0ZS5GQUlMRUQpIHtcbiAgICB1cHNhbXBsZShcbiAgICAgIHN1cmZhY2VUaWxlLFxuICAgICAgdGlsZSxcbiAgICAgIGZyYW1lU3RhdGUsXG4gICAgICB0ZXJyYWluUHJvdmlkZXIsXG4gICAgICB0aWxlLngsXG4gICAgICB0aWxlLnksXG4gICAgICB0aWxlLmxldmVsXG4gICAgKTtcbiAgfVxuXG4gIGlmIChzdXJmYWNlVGlsZS50ZXJyYWluU3RhdGUgPT09IFRlcnJhaW5TdGF0ZS5VTkxPQURFRCkge1xuICAgIHJlcXVlc3RUaWxlR2VvbWV0cnkoXG4gICAgICBzdXJmYWNlVGlsZSxcbiAgICAgIHRlcnJhaW5Qcm92aWRlcixcbiAgICAgIHRpbGUueCxcbiAgICAgIHRpbGUueSxcbiAgICAgIHRpbGUubGV2ZWxcbiAgICApO1xuICB9XG5cbiAgaWYgKHN1cmZhY2VUaWxlLnRlcnJhaW5TdGF0ZSA9PT0gVGVycmFpblN0YXRlLlJFQ0VJVkVEKSB7XG4gICAgdHJhbnNmb3JtKFxuICAgICAgc3VyZmFjZVRpbGUsXG4gICAgICBmcmFtZVN0YXRlLFxuICAgICAgdGVycmFpblByb3ZpZGVyLFxuICAgICAgdGlsZS54LFxuICAgICAgdGlsZS55LFxuICAgICAgdGlsZS5sZXZlbFxuICAgICk7XG4gIH1cblxuICBpZiAoc3VyZmFjZVRpbGUudGVycmFpblN0YXRlID09PSBUZXJyYWluU3RhdGUuVFJBTlNGT1JNRUQpIHtcbiAgICBjcmVhdGVSZXNvdXJjZXMoXG4gICAgICBzdXJmYWNlVGlsZSxcbiAgICAgIGZyYW1lU3RhdGUuY29udGV4dCxcbiAgICAgIHRlcnJhaW5Qcm92aWRlcixcbiAgICAgIHRpbGUueCxcbiAgICAgIHRpbGUueSxcbiAgICAgIHRpbGUubGV2ZWwsXG4gICAgICB2ZXJ0ZXhBcnJheXNUb0Rlc3Ryb3lcbiAgICApO1xuXG4gICAgLy8gVXBkYXRlIHRoZSB0aWxlJ3MgZXhhZ2dlcmF0aW9uIGluIGNhc2UgdGhlIGdsb2JlJ3MgZXhhZ2dlcmF0aW9uIGNoYW5nZWQgd2hpbGUgdGhlIHRpbGUgd2FzIGJlaW5nIHByb2Nlc3NlZFxuICAgIHN1cmZhY2VUaWxlLnVwZGF0ZUV4YWdnZXJhdGlvbih0aWxlLCBmcmFtZVN0YXRlLCBxdWFkdHJlZSk7XG4gIH1cblxuICBpZiAoXG4gICAgc3VyZmFjZVRpbGUudGVycmFpblN0YXRlID49IFRlcnJhaW5TdGF0ZS5SRUNFSVZFRCAmJlxuICAgIHN1cmZhY2VUaWxlLndhdGVyTWFza1RleHR1cmUgPT09IHVuZGVmaW5lZCAmJlxuICAgIHRlcnJhaW5Qcm92aWRlci5oYXNXYXRlck1hc2tcbiAgKSB7XG4gICAgdmFyIHRlcnJhaW5EYXRhID0gc3VyZmFjZVRpbGUudGVycmFpbkRhdGE7XG4gICAgaWYgKHRlcnJhaW5EYXRhLndhdGVyTWFzayAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjcmVhdGVXYXRlck1hc2tUZXh0dXJlSWZOZWVkZWQoZnJhbWVTdGF0ZS5jb250ZXh0LCBzdXJmYWNlVGlsZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBzb3VyY2VUaWxlID0gc3VyZmFjZVRpbGUuX2ZpbmRBbmNlc3RvclRpbGVXaXRoVGVycmFpbkRhdGEodGlsZSk7XG4gICAgICBpZiAoZGVmaW5lZChzb3VyY2VUaWxlKSAmJiBkZWZpbmVkKHNvdXJjZVRpbGUuZGF0YS53YXRlck1hc2tUZXh0dXJlKSkge1xuICAgICAgICBzdXJmYWNlVGlsZS53YXRlck1hc2tUZXh0dXJlID0gc291cmNlVGlsZS5kYXRhLndhdGVyTWFza1RleHR1cmU7XG4gICAgICAgICsrc3VyZmFjZVRpbGUud2F0ZXJNYXNrVGV4dHVyZS5yZWZlcmVuY2VDb3VudDtcbiAgICAgICAgc3VyZmFjZVRpbGUuX2NvbXB1dGVXYXRlck1hc2tUcmFuc2xhdGlvbkFuZFNjYWxlKFxuICAgICAgICAgIHRpbGUsXG4gICAgICAgICAgc291cmNlVGlsZSxcbiAgICAgICAgICBzdXJmYWNlVGlsZS53YXRlck1hc2tUcmFuc2xhdGlvbkFuZFNjYWxlXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHVwc2FtcGxlKHN1cmZhY2VUaWxlLCB0aWxlLCBmcmFtZVN0YXRlLCB0ZXJyYWluUHJvdmlkZXIsIHgsIHksIGxldmVsKSB7XG4gIHZhciBwYXJlbnQgPSB0aWxlLnBhcmVudDtcbiAgaWYgKCFwYXJlbnQpIHtcbiAgICAvLyBUcnlpbmcgdG8gdXBzYW1wbGUgZnJvbSBhIHJvb3QgdGlsZS4gTm8gY2FuIGRvLiBUaGlzIHRpbGUgaXMgYSBmYWlsdXJlLlxuICAgIHRpbGUuc3RhdGUgPSBRdWFkdHJlZVRpbGVMb2FkU3RhdGUuRkFJTEVEO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBzb3VyY2VEYXRhID0gcGFyZW50LmRhdGEudGVycmFpbkRhdGE7XG4gIHZhciBzb3VyY2VYID0gcGFyZW50Lng7XG4gIHZhciBzb3VyY2VZID0gcGFyZW50Lnk7XG4gIHZhciBzb3VyY2VMZXZlbCA9IHBhcmVudC5sZXZlbDtcblxuICBpZiAoIWRlZmluZWQoc291cmNlRGF0YSkpIHtcbiAgICAvLyBQYXJlbnQgaXMgbm90IGF2YWlsYWJsZSwgc28gd2UgY2FuJ3QgdXBzYW1wbGUgdGhpcyB0aWxlIHlldC5cbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgdGVycmFpbkRhdGFQcm9taXNlID0gc291cmNlRGF0YS51cHNhbXBsZShcbiAgICB0ZXJyYWluUHJvdmlkZXIudGlsaW5nU2NoZW1lLFxuICAgIHNvdXJjZVgsXG4gICAgc291cmNlWSxcbiAgICBzb3VyY2VMZXZlbCxcbiAgICB4LFxuICAgIHksXG4gICAgbGV2ZWxcbiAgKTtcbiAgaWYgKCFkZWZpbmVkKHRlcnJhaW5EYXRhUHJvbWlzZSkpIHtcbiAgICAvLyBUaGUgdXBzYW1wbGUgcmVxdWVzdCBoYXMgYmVlbiBkZWZlcnJlZCAtIHRyeSBhZ2FpbiBsYXRlci5cbiAgICByZXR1cm47XG4gIH1cblxuICBzdXJmYWNlVGlsZS50ZXJyYWluU3RhdGUgPSBUZXJyYWluU3RhdGUuUkVDRUlWSU5HO1xuXG4gIHdoZW4oXG4gICAgdGVycmFpbkRhdGFQcm9taXNlLFxuICAgIGZ1bmN0aW9uICh0ZXJyYWluRGF0YSkge1xuICAgICAgc3VyZmFjZVRpbGUudGVycmFpbkRhdGEgPSB0ZXJyYWluRGF0YTtcbiAgICAgIHN1cmZhY2VUaWxlLnRlcnJhaW5TdGF0ZSA9IFRlcnJhaW5TdGF0ZS5SRUNFSVZFRDtcbiAgICB9LFxuICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgIHN1cmZhY2VUaWxlLnRlcnJhaW5TdGF0ZSA9IFRlcnJhaW5TdGF0ZS5GQUlMRUQ7XG4gICAgfVxuICApO1xufVxuXG5mdW5jdGlvbiByZXF1ZXN0VGlsZUdlb21ldHJ5KHN1cmZhY2VUaWxlLCB0ZXJyYWluUHJvdmlkZXIsIHgsIHksIGxldmVsKSB7XG4gIGZ1bmN0aW9uIHN1Y2Nlc3ModGVycmFpbkRhdGEpIHtcbiAgICBzdXJmYWNlVGlsZS50ZXJyYWluRGF0YSA9IHRlcnJhaW5EYXRhO1xuICAgIHN1cmZhY2VUaWxlLnRlcnJhaW5TdGF0ZSA9IFRlcnJhaW5TdGF0ZS5SRUNFSVZFRDtcbiAgICBzdXJmYWNlVGlsZS5yZXF1ZXN0ID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgZnVuY3Rpb24gZmFpbHVyZShlcnJvcikge1xuICAgIGlmIChzdXJmYWNlVGlsZS5yZXF1ZXN0LnN0YXRlID09PSBSZXF1ZXN0U3RhdGUuQ0FOQ0VMTEVEKSB7XG4gICAgICAvLyBDYW5jZWxsZWQgZHVlIHRvIGxvdyBwcmlvcml0eSAtIHRyeSBhZ2FpbiBsYXRlci5cbiAgICAgIHN1cmZhY2VUaWxlLnRlcnJhaW5EYXRhID0gdW5kZWZpbmVkO1xuICAgICAgc3VyZmFjZVRpbGUudGVycmFpblN0YXRlID0gVGVycmFpblN0YXRlLlVOTE9BREVEO1xuICAgICAgc3VyZmFjZVRpbGUucmVxdWVzdCA9IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJbml0aWFsbHkgYXNzdW1lIGZhaWx1cmUuICBoYW5kbGVFcnJvciBtYXkgcmV0cnksIGluIHdoaWNoIGNhc2UgdGhlIHN0YXRlIHdpbGxcbiAgICAvLyBjaGFuZ2UgdG8gUkVDRUlWSU5HIG9yIFVOTE9BREVELlxuICAgIHN1cmZhY2VUaWxlLnRlcnJhaW5TdGF0ZSA9IFRlcnJhaW5TdGF0ZS5GQUlMRUQ7XG4gICAgc3VyZmFjZVRpbGUucmVxdWVzdCA9IHVuZGVmaW5lZDtcblxuICAgIHZhciBtZXNzYWdlID1cbiAgICAgIFwiRmFpbGVkIHRvIG9idGFpbiB0ZXJyYWluIHRpbGUgWDogXCIgK1xuICAgICAgeCArXG4gICAgICBcIiBZOiBcIiArXG4gICAgICB5ICtcbiAgICAgIFwiIExldmVsOiBcIiArXG4gICAgICBsZXZlbCArXG4gICAgICAnLiBFcnJvciBtZXNzYWdlOiBcIicgK1xuICAgICAgZXJyb3IgK1xuICAgICAgJ1wiJztcbiAgICB0ZXJyYWluUHJvdmlkZXIuX3JlcXVlc3RFcnJvciA9IFRpbGVQcm92aWRlckVycm9yLmhhbmRsZUVycm9yKFxuICAgICAgdGVycmFpblByb3ZpZGVyLl9yZXF1ZXN0RXJyb3IsXG4gICAgICB0ZXJyYWluUHJvdmlkZXIsXG4gICAgICB0ZXJyYWluUHJvdmlkZXIuZXJyb3JFdmVudCxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICB4LFxuICAgICAgeSxcbiAgICAgIGxldmVsLFxuICAgICAgZG9SZXF1ZXN0XG4gICAgKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRvUmVxdWVzdCgpIHtcbiAgICAvLyBSZXF1ZXN0IHRoZSB0ZXJyYWluIGZyb20gdGhlIHRlcnJhaW4gcHJvdmlkZXIuXG4gICAgdmFyIHJlcXVlc3QgPSBuZXcgUmVxdWVzdCh7XG4gICAgICB0aHJvdHRsZTogZmFsc2UsXG4gICAgICB0aHJvdHRsZUJ5U2VydmVyOiB0cnVlLFxuICAgICAgdHlwZTogUmVxdWVzdFR5cGUuVEVSUkFJTixcbiAgICB9KTtcbiAgICBzdXJmYWNlVGlsZS5yZXF1ZXN0ID0gcmVxdWVzdDtcblxuICAgIHZhciByZXF1ZXN0UHJvbWlzZSA9IHRlcnJhaW5Qcm92aWRlci5yZXF1ZXN0VGlsZUdlb21ldHJ5KFxuICAgICAgeCxcbiAgICAgIHksXG4gICAgICBsZXZlbCxcbiAgICAgIHJlcXVlc3RcbiAgICApO1xuXG4gICAgLy8gSWYgdGhlIHJlcXVlc3QgbWV0aG9kIHJldHVybnMgdW5kZWZpbmVkIChpbnN0ZWFkIG9mIGEgcHJvbWlzZSksIHRoZSByZXF1ZXN0XG4gICAgLy8gaGFzIGJlZW4gZGVmZXJyZWQuXG4gICAgaWYgKGRlZmluZWQocmVxdWVzdFByb21pc2UpKSB7XG4gICAgICBzdXJmYWNlVGlsZS50ZXJyYWluU3RhdGUgPSBUZXJyYWluU3RhdGUuUkVDRUlWSU5HO1xuICAgICAgd2hlbihyZXF1ZXN0UHJvbWlzZSwgc3VjY2VzcywgZmFpbHVyZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIERlZmVycmVkIC0gdHJ5IGFnYWluIGxhdGVyLlxuICAgICAgc3VyZmFjZVRpbGUudGVycmFpblN0YXRlID0gVGVycmFpblN0YXRlLlVOTE9BREVEO1xuICAgICAgc3VyZmFjZVRpbGUucmVxdWVzdCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBkb1JlcXVlc3QoKTtcbn1cblxudmFyIHNjcmF0Y2hDcmVhdGVNZXNoT3B0aW9ucyA9IHtcbiAgdGlsaW5nU2NoZW1lOiB1bmRlZmluZWQsXG4gIHg6IDAsXG4gIHk6IDAsXG4gIGxldmVsOiAwLFxuICBleGFnZ2VyYXRpb246IDEuMCxcbiAgZXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHQ6IDAuMCxcbiAgdGhyb3R0bGU6IHRydWUsXG59O1xuXG5mdW5jdGlvbiB0cmFuc2Zvcm0oc3VyZmFjZVRpbGUsIGZyYW1lU3RhdGUsIHRlcnJhaW5Qcm92aWRlciwgeCwgeSwgbGV2ZWwpIHtcbiAgdmFyIHRpbGluZ1NjaGVtZSA9IHRlcnJhaW5Qcm92aWRlci50aWxpbmdTY2hlbWU7XG5cbiAgdmFyIGNyZWF0ZU1lc2hPcHRpb25zID0gc2NyYXRjaENyZWF0ZU1lc2hPcHRpb25zO1xuICBjcmVhdGVNZXNoT3B0aW9ucy50aWxpbmdTY2hlbWUgPSB0aWxpbmdTY2hlbWU7XG4gIGNyZWF0ZU1lc2hPcHRpb25zLnggPSB4O1xuICBjcmVhdGVNZXNoT3B0aW9ucy55ID0geTtcbiAgY3JlYXRlTWVzaE9wdGlvbnMubGV2ZWwgPSBsZXZlbDtcbiAgY3JlYXRlTWVzaE9wdGlvbnMuZXhhZ2dlcmF0aW9uID0gZnJhbWVTdGF0ZS50ZXJyYWluRXhhZ2dlcmF0aW9uO1xuICBjcmVhdGVNZXNoT3B0aW9ucy5leGFnZ2VyYXRpb25SZWxhdGl2ZUhlaWdodCA9XG4gICAgZnJhbWVTdGF0ZS50ZXJyYWluRXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHQ7XG4gIGNyZWF0ZU1lc2hPcHRpb25zLnRocm90dGxlID0gdHJ1ZTtcblxuICB2YXIgdGVycmFpbkRhdGEgPSBzdXJmYWNlVGlsZS50ZXJyYWluRGF0YTtcbiAgdmFyIG1lc2hQcm9taXNlID0gdGVycmFpbkRhdGEuY3JlYXRlTWVzaChjcmVhdGVNZXNoT3B0aW9ucyk7XG5cbiAgaWYgKCFkZWZpbmVkKG1lc2hQcm9taXNlKSkge1xuICAgIC8vIFBvc3Rwb25lZC5cbiAgICByZXR1cm47XG4gIH1cblxuICBzdXJmYWNlVGlsZS50ZXJyYWluU3RhdGUgPSBUZXJyYWluU3RhdGUuVFJBTlNGT1JNSU5HO1xuXG4gIHdoZW4oXG4gICAgbWVzaFByb21pc2UsXG4gICAgZnVuY3Rpb24gKG1lc2gpIHtcbiAgICAgIHN1cmZhY2VUaWxlLm1lc2ggPSBtZXNoO1xuICAgICAgc3VyZmFjZVRpbGUudGVycmFpblN0YXRlID0gVGVycmFpblN0YXRlLlRSQU5TRk9STUVEO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKCkge1xuICAgICAgc3VyZmFjZVRpbGUudGVycmFpblN0YXRlID0gVGVycmFpblN0YXRlLkZBSUxFRDtcbiAgICB9XG4gICk7XG59XG5cbkdsb2JlU3VyZmFjZVRpbGUuX2NyZWF0ZVZlcnRleEFycmF5Rm9yTWVzaCA9IGZ1bmN0aW9uIChjb250ZXh0LCBtZXNoKSB7XG4gIHZhciB0eXBlZEFycmF5ID0gbWVzaC52ZXJ0aWNlcztcbiAgdmFyIGJ1ZmZlciA9IEJ1ZmZlci5jcmVhdGVWZXJ0ZXhCdWZmZXIoe1xuICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgdHlwZWRBcnJheTogdHlwZWRBcnJheSxcbiAgICB1c2FnZTogQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsXG4gIH0pO1xuICB2YXIgYXR0cmlidXRlcyA9IG1lc2guZW5jb2RpbmcuZ2V0QXR0cmlidXRlcyhidWZmZXIpO1xuXG4gIHZhciBpbmRleEJ1ZmZlcnMgPSBtZXNoLmluZGljZXMuaW5kZXhCdWZmZXJzIHx8IHt9O1xuICB2YXIgaW5kZXhCdWZmZXIgPSBpbmRleEJ1ZmZlcnNbY29udGV4dC5pZF07XG4gIGlmICghZGVmaW5lZChpbmRleEJ1ZmZlcikgfHwgaW5kZXhCdWZmZXIuaXNEZXN0cm95ZWQoKSkge1xuICAgIHZhciBpbmRpY2VzID0gbWVzaC5pbmRpY2VzO1xuICAgIGluZGV4QnVmZmVyID0gQnVmZmVyLmNyZWF0ZUluZGV4QnVmZmVyKHtcbiAgICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgICB0eXBlZEFycmF5OiBpbmRpY2VzLFxuICAgICAgdXNhZ2U6IEJ1ZmZlclVzYWdlLlNUQVRJQ19EUkFXLFxuICAgICAgaW5kZXhEYXRhdHlwZTogSW5kZXhEYXRhdHlwZS5mcm9tU2l6ZUluQnl0ZXMoaW5kaWNlcy5CWVRFU19QRVJfRUxFTUVOVCksXG4gICAgfSk7XG4gICAgaW5kZXhCdWZmZXIudmVydGV4QXJyYXlEZXN0cm95YWJsZSA9IGZhbHNlO1xuICAgIGluZGV4QnVmZmVyLnJlZmVyZW5jZUNvdW50ID0gMTtcbiAgICBpbmRleEJ1ZmZlcnNbY29udGV4dC5pZF0gPSBpbmRleEJ1ZmZlcjtcbiAgICBtZXNoLmluZGljZXMuaW5kZXhCdWZmZXJzID0gaW5kZXhCdWZmZXJzO1xuICB9IGVsc2Uge1xuICAgICsraW5kZXhCdWZmZXIucmVmZXJlbmNlQ291bnQ7XG4gIH1cblxuICByZXR1cm4gbmV3IFZlcnRleEFycmF5KHtcbiAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXMsXG4gICAgaW5kZXhCdWZmZXI6IGluZGV4QnVmZmVyLFxuICB9KTtcbn07XG5cbkdsb2JlU3VyZmFjZVRpbGUuX2ZyZWVWZXJ0ZXhBcnJheSA9IGZ1bmN0aW9uICh2ZXJ0ZXhBcnJheSkge1xuICBpZiAoZGVmaW5lZCh2ZXJ0ZXhBcnJheSkpIHtcbiAgICB2YXIgaW5kZXhCdWZmZXIgPSB2ZXJ0ZXhBcnJheS5pbmRleEJ1ZmZlcjtcblxuICAgIGlmICghdmVydGV4QXJyYXkuaXNEZXN0cm95ZWQoKSkge1xuICAgICAgdmVydGV4QXJyYXkuZGVzdHJveSgpO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGRlZmluZWQoaW5kZXhCdWZmZXIpICYmXG4gICAgICAhaW5kZXhCdWZmZXIuaXNEZXN0cm95ZWQoKSAmJlxuICAgICAgZGVmaW5lZChpbmRleEJ1ZmZlci5yZWZlcmVuY2VDb3VudClcbiAgICApIHtcbiAgICAgIC0taW5kZXhCdWZmZXIucmVmZXJlbmNlQ291bnQ7XG4gICAgICBpZiAoaW5kZXhCdWZmZXIucmVmZXJlbmNlQ291bnQgPT09IDApIHtcbiAgICAgICAgaW5kZXhCdWZmZXIuZGVzdHJveSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuZnVuY3Rpb24gY3JlYXRlUmVzb3VyY2VzKFxuICBzdXJmYWNlVGlsZSxcbiAgY29udGV4dCxcbiAgdGVycmFpblByb3ZpZGVyLFxuICB4LFxuICB5LFxuICBsZXZlbCxcbiAgdmVydGV4QXJyYXlzVG9EZXN0cm95XG4pIHtcbiAgc3VyZmFjZVRpbGUudmVydGV4QXJyYXkgPSBHbG9iZVN1cmZhY2VUaWxlLl9jcmVhdGVWZXJ0ZXhBcnJheUZvck1lc2goXG4gICAgY29udGV4dCxcbiAgICBzdXJmYWNlVGlsZS5tZXNoXG4gICk7XG4gIHN1cmZhY2VUaWxlLnRlcnJhaW5TdGF0ZSA9IFRlcnJhaW5TdGF0ZS5SRUFEWTtcbiAgc3VyZmFjZVRpbGUuZmlsbCA9XG4gICAgc3VyZmFjZVRpbGUuZmlsbCAmJiBzdXJmYWNlVGlsZS5maWxsLmRlc3Ryb3kodmVydGV4QXJyYXlzVG9EZXN0cm95KTtcbn1cblxuZnVuY3Rpb24gZ2V0Q29udGV4dFdhdGVyTWFza0RhdGEoY29udGV4dCkge1xuICB2YXIgZGF0YSA9IGNvbnRleHQuY2FjaGUudGlsZV93YXRlck1hc2tEYXRhO1xuXG4gIGlmICghZGVmaW5lZChkYXRhKSkge1xuICAgIHZhciBhbGxXYXRlclRleHR1cmUgPSBUZXh0dXJlLmNyZWF0ZSh7XG4gICAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgICAgcGl4ZWxGb3JtYXQ6IFBpeGVsRm9ybWF0LkxVTUlOQU5DRSxcbiAgICAgIHBpeGVsRGF0YXR5cGU6IFBpeGVsRGF0YXR5cGUuVU5TSUdORURfQllURSxcbiAgICAgIHNvdXJjZToge1xuICAgICAgICBhcnJheUJ1ZmZlclZpZXc6IG5ldyBVaW50OEFycmF5KFsyNTVdKSxcbiAgICAgICAgd2lkdGg6IDEsXG4gICAgICAgIGhlaWdodDogMSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgYWxsV2F0ZXJUZXh0dXJlLnJlZmVyZW5jZUNvdW50ID0gMTtcblxuICAgIHZhciBzYW1wbGVyID0gbmV3IFNhbXBsZXIoe1xuICAgICAgd3JhcFM6IFRleHR1cmVXcmFwLkNMQU1QX1RPX0VER0UsXG4gICAgICB3cmFwVDogVGV4dHVyZVdyYXAuQ0xBTVBfVE9fRURHRSxcbiAgICAgIG1pbmlmaWNhdGlvbkZpbHRlcjogVGV4dHVyZU1pbmlmaWNhdGlvbkZpbHRlci5MSU5FQVIsXG4gICAgICBtYWduaWZpY2F0aW9uRmlsdGVyOiBUZXh0dXJlTWFnbmlmaWNhdGlvbkZpbHRlci5MSU5FQVIsXG4gICAgfSk7XG5cbiAgICBkYXRhID0ge1xuICAgICAgYWxsV2F0ZXJUZXh0dXJlOiBhbGxXYXRlclRleHR1cmUsXG4gICAgICBzYW1wbGVyOiBzYW1wbGVyLFxuICAgICAgZGVzdHJveTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmFsbFdhdGVyVGV4dHVyZS5kZXN0cm95KCk7XG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb250ZXh0LmNhY2hlLnRpbGVfd2F0ZXJNYXNrRGF0YSA9IGRhdGE7XG4gIH1cblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlV2F0ZXJNYXNrVGV4dHVyZUlmTmVlZGVkKGNvbnRleHQsIHN1cmZhY2VUaWxlKSB7XG4gIHZhciB3YXRlck1hc2sgPSBzdXJmYWNlVGlsZS50ZXJyYWluRGF0YS53YXRlck1hc2s7XG4gIHZhciB3YXRlck1hc2tEYXRhID0gZ2V0Q29udGV4dFdhdGVyTWFza0RhdGEoY29udGV4dCk7XG4gIHZhciB0ZXh0dXJlO1xuXG4gIHZhciB3YXRlck1hc2tMZW5ndGggPSB3YXRlck1hc2subGVuZ3RoO1xuICBpZiAod2F0ZXJNYXNrTGVuZ3RoID09PSAxKSB7XG4gICAgLy8gTGVuZ3RoIDEgbWVhbnMgdGhlIHRpbGUgaXMgZW50aXJlbHkgbGFuZCBvciBlbnRpcmVseSB3YXRlci5cbiAgICAvLyBBIHZhbHVlIG9mIDAgaW5kaWNhdGVzIGVudGlyZWx5IGxhbmQsIGEgdmFsdWUgb2YgMSBpbmRpY2F0ZXMgZW50aXJlbHkgd2F0ZXIuXG4gICAgaWYgKHdhdGVyTWFza1swXSAhPT0gMCkge1xuICAgICAgdGV4dHVyZSA9IHdhdGVyTWFza0RhdGEuYWxsV2F0ZXJUZXh0dXJlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBMZWF2ZSB0aGUgdGV4dHVyZSB1bmRlZmluZWQgaWYgdGhlIHRpbGUgaXMgZW50aXJlbHkgbGFuZC5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdmFyIHRleHR1cmVTaXplID0gTWF0aC5zcXJ0KHdhdGVyTWFza0xlbmd0aCk7XG4gICAgdGV4dHVyZSA9IFRleHR1cmUuY3JlYXRlKHtcbiAgICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgICBwaXhlbEZvcm1hdDogUGl4ZWxGb3JtYXQuTFVNSU5BTkNFLFxuICAgICAgcGl4ZWxEYXRhdHlwZTogUGl4ZWxEYXRhdHlwZS5VTlNJR05FRF9CWVRFLFxuICAgICAgc291cmNlOiB7XG4gICAgICAgIHdpZHRoOiB0ZXh0dXJlU2l6ZSxcbiAgICAgICAgaGVpZ2h0OiB0ZXh0dXJlU2l6ZSxcbiAgICAgICAgYXJyYXlCdWZmZXJWaWV3OiB3YXRlck1hc2ssXG4gICAgICB9LFxuICAgICAgc2FtcGxlcjogd2F0ZXJNYXNrRGF0YS5zYW1wbGVyLFxuICAgICAgZmxpcFk6IGZhbHNlLFxuICAgIH0pO1xuXG4gICAgdGV4dHVyZS5yZWZlcmVuY2VDb3VudCA9IDA7XG4gIH1cblxuICArK3RleHR1cmUucmVmZXJlbmNlQ291bnQ7XG4gIHN1cmZhY2VUaWxlLndhdGVyTWFza1RleHR1cmUgPSB0ZXh0dXJlO1xuXG4gIENhcnRlc2lhbjQuZnJvbUVsZW1lbnRzKFxuICAgIDAuMCxcbiAgICAwLjAsXG4gICAgMS4wLFxuICAgIDEuMCxcbiAgICBzdXJmYWNlVGlsZS53YXRlck1hc2tUcmFuc2xhdGlvbkFuZFNjYWxlXG4gICk7XG59XG5cbkdsb2JlU3VyZmFjZVRpbGUucHJvdG90eXBlLl9maW5kQW5jZXN0b3JUaWxlV2l0aFRlcnJhaW5EYXRhID0gZnVuY3Rpb24gKHRpbGUpIHtcbiAgdmFyIHNvdXJjZVRpbGUgPSB0aWxlLnBhcmVudDtcblxuICB3aGlsZSAoXG4gICAgZGVmaW5lZChzb3VyY2VUaWxlKSAmJlxuICAgICghZGVmaW5lZChzb3VyY2VUaWxlLmRhdGEpIHx8XG4gICAgICAhZGVmaW5lZChzb3VyY2VUaWxlLmRhdGEudGVycmFpbkRhdGEpIHx8XG4gICAgICBzb3VyY2VUaWxlLmRhdGEudGVycmFpbkRhdGEud2FzQ3JlYXRlZEJ5VXBzYW1wbGluZygpKVxuICApIHtcbiAgICBzb3VyY2VUaWxlID0gc291cmNlVGlsZS5wYXJlbnQ7XG4gIH1cblxuICByZXR1cm4gc291cmNlVGlsZTtcbn07XG5cbkdsb2JlU3VyZmFjZVRpbGUucHJvdG90eXBlLl9jb21wdXRlV2F0ZXJNYXNrVHJhbnNsYXRpb25BbmRTY2FsZSA9IGZ1bmN0aW9uIChcbiAgdGlsZSxcbiAgc291cmNlVGlsZSxcbiAgcmVzdWx0XG4pIHtcbiAgdmFyIHNvdXJjZVRpbGVSZWN0YW5nbGUgPSBzb3VyY2VUaWxlLnJlY3RhbmdsZTtcbiAgdmFyIHRpbGVSZWN0YW5nbGUgPSB0aWxlLnJlY3RhbmdsZTtcbiAgdmFyIHRpbGVXaWR0aCA9IHRpbGVSZWN0YW5nbGUud2lkdGg7XG4gIHZhciB0aWxlSGVpZ2h0ID0gdGlsZVJlY3RhbmdsZS5oZWlnaHQ7XG5cbiAgdmFyIHNjYWxlWCA9IHRpbGVXaWR0aCAvIHNvdXJjZVRpbGVSZWN0YW5nbGUud2lkdGg7XG4gIHZhciBzY2FsZVkgPSB0aWxlSGVpZ2h0IC8gc291cmNlVGlsZVJlY3RhbmdsZS5oZWlnaHQ7XG4gIHJlc3VsdC54ID1cbiAgICAoc2NhbGVYICogKHRpbGVSZWN0YW5nbGUud2VzdCAtIHNvdXJjZVRpbGVSZWN0YW5nbGUud2VzdCkpIC8gdGlsZVdpZHRoO1xuICByZXN1bHQueSA9XG4gICAgKHNjYWxlWSAqICh0aWxlUmVjdGFuZ2xlLnNvdXRoIC0gc291cmNlVGlsZVJlY3RhbmdsZS5zb3V0aCkpIC8gdGlsZUhlaWdodDtcbiAgcmVzdWx0LnogPSBzY2FsZVg7XG4gIHJlc3VsdC53ID0gc2NhbGVZO1xuXG4gIHJldHVybiByZXN1bHQ7XG59O1xuZXhwb3J0IGRlZmF1bHQgR2xvYmVTdXJmYWNlVGlsZTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///14648\n')},32110:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(48243);\n/* harmony import */ var _Core_BoxOutlineGeometry_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(27495);\n/* harmony import */ var _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(60838);\n/* harmony import */ var _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(60216);\n/* harmony import */ var _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(63367);\n/* harmony import */ var _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(51688);\n/* harmony import */ var _Core_clone_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(83856);\n/* harmony import */ var _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(59947);\n/* harmony import */ var _Core_ColorGeometryInstanceAttribute_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(92062);\n/* harmony import */ var _Core_combine_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(8182);\n/* harmony import */ var _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(62200);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(82982);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(86511);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(12572);\n/* harmony import */ var _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(14459);\n/* harmony import */ var _Core_GeometryInstance_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(26865);\n/* harmony import */ var _Core_GeometryPipeline_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(57552);\n/* harmony import */ var _Core_IndexDatatype_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(22832);\n/* harmony import */ var _Core_Intersect_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(84935);\n/* harmony import */ var _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(99417);\n/* harmony import */ var _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(72248);\n/* harmony import */ var _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(15720);\n/* harmony import */ var _Core_OrientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(25405);\n/* harmony import */ var _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(91473);\n/* harmony import */ var _Core_PrimitiveType_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(97264);\n/* harmony import */ var _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(96190);\n/* harmony import */ var _Core_SphereOutlineGeometry_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(38779);\n/* harmony import */ var _Core_TerrainExaggeration_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(78257);\n/* harmony import */ var _Core_TerrainQuantization_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(735);\n/* harmony import */ var _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(54933);\n/* harmony import */ var _Core_WebMercatorProjection_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(79962);\n/* harmony import */ var _Renderer_Buffer_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(99095);\n/* harmony import */ var _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(58597);\n/* harmony import */ var _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(20521);\n/* harmony import */ var _Renderer_DrawCommand_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(60072);\n/* harmony import */ var _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(8379);\n/* harmony import */ var _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(10667);\n/* harmony import */ var _Renderer_VertexArray_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(18192);\n/* harmony import */ var _BlendingState_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(13633);\n/* harmony import */ var _ClippingPlaneCollection_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(21809);\n/* harmony import */ var _DepthFunction_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(7976);\n/* harmony import */ var _GlobeSurfaceTile_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(14648);\n/* harmony import */ var _ImageryLayer_js__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(59379);\n/* harmony import */ var _ImageryState_js__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(73919);\n/* harmony import */ var _PerInstanceColorAppearance_js__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(64060);\n/* harmony import */ var _Primitive_js__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(34380);\n/* harmony import */ var _QuadtreeTileLoadState_js__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(85828);\n/* harmony import */ var _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(89917);\n/* harmony import */ var _ShadowMode_js__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(34125);\n/* harmony import */ var _TerrainFillMesh_js__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(11590);\n/* harmony import */ var _TerrainState_js__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(46547);\n/* harmony import */ var _TileBoundingRegion_js__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(17106);\n/* harmony import */ var _TileSelectionResult_js__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(37728);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Provides quadtree tiles representing the surface of the globe.  This type is intended to be used\n * with {@link QuadtreePrimitive}.\n *\n * @alias GlobeSurfaceTileProvider\n * @constructor\n *\n * @param {TerrainProvider} options.terrainProvider The terrain provider that describes the surface geometry.\n * @param {ImageryLayerCollection} option.imageryLayers The collection of imagery layers describing the shading of the surface.\n * @param {GlobeSurfaceShaderSet} options.surfaceShaderSet The set of shaders used to render the surface.\n *\n * @private\n */\nfunction GlobeSurfaceTileProvider(options) {\n  //>>includeStart(\'debug\', pragmas.debug);\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(options)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z("options is required.");\n  }\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(options.terrainProvider)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z("options.terrainProvider is required.");\n  } else if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(options.imageryLayers)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z("options.imageryLayers is required.");\n  } else if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(options.surfaceShaderSet)) {\n    throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z("options.surfaceShaderSet is required.");\n  }\n  //>>includeEnd(\'debug\');\n\n  this.lightingFadeOutDistance = 6500000.0;\n  this.lightingFadeInDistance = 9000000.0;\n  this.hasWaterMask = false;\n  this.oceanNormalMap = undefined;\n  this.zoomedOutOceanSpecularIntensity = 0.5;\n  this.enableLighting = false;\n  this.dynamicAtmosphereLighting = false;\n  this.dynamicAtmosphereLightingFromSun = false;\n  this.showGroundAtmosphere = false;\n  this.shadows = _ShadowMode_js__WEBPACK_IMPORTED_MODULE_47__/* ["default"].RECEIVE_ONLY */ .Z.RECEIVE_ONLY;\n\n  /**\n   * The color to use to highlight terrain fill tiles. If undefined, fill tiles are not\n   * highlighted at all. The alpha value is used to alpha blend with the tile\'s\n   * actual color. Because terrain fill tiles do not represent the actual terrain surface,\n   * it may be useful in some applications to indicate visually that they are not to be trusted.\n   * @type {Color}\n   * @default undefined\n   */\n  this.fillHighlightColor = undefined;\n\n  this.hueShift = 0.0;\n  this.saturationShift = 0.0;\n  this.brightnessShift = 0.0;\n\n  this.showSkirts = true;\n  this.backFaceCulling = true;\n  this.undergroundColor = undefined;\n  this.undergroundColorAlphaByDistance = undefined;\n\n  this.materialUniformMap = undefined;\n  this._materialUniformMap = undefined;\n\n  this._quadtree = undefined;\n  this._terrainProvider = options.terrainProvider;\n  this._imageryLayers = options.imageryLayers;\n  this._surfaceShaderSet = options.surfaceShaderSet;\n\n  this._renderState = undefined;\n  this._blendRenderState = undefined;\n  this._disableCullingRenderState = undefined;\n  this._disableCullingBlendRenderState = undefined;\n\n  this._errorEvent = new _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\n\n  this._imageryLayers.layerAdded.addEventListener(\n    GlobeSurfaceTileProvider.prototype._onLayerAdded,\n    this\n  );\n  this._imageryLayers.layerRemoved.addEventListener(\n    GlobeSurfaceTileProvider.prototype._onLayerRemoved,\n    this\n  );\n  this._imageryLayers.layerMoved.addEventListener(\n    GlobeSurfaceTileProvider.prototype._onLayerMoved,\n    this\n  );\n  this._imageryLayers.layerShownOrHidden.addEventListener(\n    GlobeSurfaceTileProvider.prototype._onLayerShownOrHidden,\n    this\n  );\n  this._imageryLayersUpdatedEvent = new _Core_Event_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z();\n\n  this._layerOrderChanged = false;\n\n  this._tilesToRenderByTextureCount = [];\n  this._drawCommands = [];\n  this._uniformMaps = [];\n  this._usedDrawCommands = 0;\n\n  this._vertexArraysToDestroy = [];\n\n  this._debug = {\n    wireframe: false,\n    boundingSphereTile: undefined,\n  };\n\n  this._baseColor = undefined;\n  this._firstPassInitialColor = undefined;\n  this.baseColor = new _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z(0.0, 0.0, 0.5, 1.0);\n\n  /**\n   * A property specifying a {@link ClippingPlaneCollection} used to selectively disable rendering on the outside of each plane.\n   * @type {ClippingPlaneCollection}\n   * @private\n   */\n  this._clippingPlanes = undefined;\n\n  /**\n   * A property specifying a {@link Rectangle} used to selectively limit terrain and imagery rendering.\n   * @type {Rectangle}\n   */\n  this.cartographicLimitRectangle = _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].clone */ .Z.clone(_Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].MAX_VALUE */ .Z.MAX_VALUE);\n\n  this._hasLoadedTilesThisFrame = false;\n  this._hasFillTilesThisFrame = false;\n\n  this._oldTerrainExaggeration = undefined;\n  this._oldTerrainExaggerationRelativeHeight = undefined;\n}\n\nObject.defineProperties(GlobeSurfaceTileProvider.prototype, {\n  /**\n   * Gets or sets the color of the globe when no imagery is available.\n   * @memberof GlobeSurfaceTileProvider.prototype\n   * @type {Color}\n   */\n  baseColor: {\n    get: function () {\n      return this._baseColor;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(value)) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z("value is required.");\n      }\n      //>>includeEnd(\'debug\');\n\n      this._baseColor = value;\n      this._firstPassInitialColor = _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].fromColor */ .Z.fromColor(\n        value,\n        this._firstPassInitialColor\n      );\n    },\n  },\n  /**\n   * Gets or sets the {@link QuadtreePrimitive} for which this provider is\n   * providing tiles.  This property may be undefined if the provider is not yet associated\n   * with a {@link QuadtreePrimitive}.\n   * @memberof GlobeSurfaceTileProvider.prototype\n   * @type {QuadtreePrimitive}\n   */\n  quadtree: {\n    get: function () {\n      return this._quadtree;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(value)) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z("value is required.");\n      }\n      //>>includeEnd(\'debug\');\n\n      this._quadtree = value;\n    },\n  },\n\n  /**\n   * Gets a value indicating whether or not the provider is ready for use.\n   * @memberof GlobeSurfaceTileProvider.prototype\n   * @type {Boolean}\n   */\n  ready: {\n    get: function () {\n      return (\n        this._terrainProvider.ready &&\n        (this._imageryLayers.length === 0 ||\n          this._imageryLayers.get(0).imageryProvider.ready)\n      );\n    },\n  },\n\n  /**\n   * Gets the tiling scheme used by the provider.  This property should\n   * not be accessed before {@link GlobeSurfaceTileProvider#ready} returns true.\n   * @memberof GlobeSurfaceTileProvider.prototype\n   * @type {TilingScheme}\n   */\n  tilingScheme: {\n    get: function () {\n      return this._terrainProvider.tilingScheme;\n    },\n  },\n\n  /**\n   * Gets an event that is raised when the geometry provider encounters an asynchronous error.  By subscribing\n   * to the event, you will be notified of the error and can potentially recover from it.  Event listeners\n   * are passed an instance of {@link TileProviderError}.\n   * @memberof GlobeSurfaceTileProvider.prototype\n   * @type {Event}\n   */\n  errorEvent: {\n    get: function () {\n      return this._errorEvent;\n    },\n  },\n\n  /**\n   * Gets an event that is raised when an imagery layer is added, shown, hidden, moved, or removed.\n   * @memberof GlobeSurfaceTileProvider.prototype\n   * @type {Event}\n   */\n  imageryLayersUpdatedEvent: {\n    get: function () {\n      return this._imageryLayersUpdatedEvent;\n    },\n  },\n\n  /**\n   * Gets or sets the terrain provider that describes the surface geometry.\n   * @memberof GlobeSurfaceTileProvider.prototype\n   * @type {TerrainProvider}\n   */\n  terrainProvider: {\n    get: function () {\n      return this._terrainProvider;\n    },\n    set: function (terrainProvider) {\n      if (this._terrainProvider === terrainProvider) {\n        return;\n      }\n\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(terrainProvider)) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z("terrainProvider is required.");\n      }\n      //>>includeEnd(\'debug\');\n\n      this._terrainProvider = terrainProvider;\n\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(this._quadtree)) {\n        this._quadtree.invalidateAllTiles();\n      }\n    },\n  },\n  /**\n   * The {@link ClippingPlaneCollection} used to selectively disable rendering the tileset.\n   *\n   * @type {ClippingPlaneCollection}\n   *\n   * @private\n   */\n  clippingPlanes: {\n    get: function () {\n      return this._clippingPlanes;\n    },\n    set: function (value) {\n      _ClippingPlaneCollection_js__WEBPACK_IMPORTED_MODULE_38__/* ["default"].setOwner */ .Z.setOwner(value, this, "_clippingPlanes");\n    },\n  },\n});\n\nfunction sortTileImageryByLayerIndex(a, b) {\n  var aImagery = a.loadingImagery;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(aImagery)) {\n    aImagery = a.readyImagery;\n  }\n\n  var bImagery = b.loadingImagery;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(bImagery)) {\n    bImagery = b.readyImagery;\n  }\n\n  return aImagery.imageryLayer._layerIndex - bImagery.imageryLayer._layerIndex;\n}\n\n/**\n * Make updates to the tile provider that are not involved in rendering. Called before the render update cycle.\n */\nGlobeSurfaceTileProvider.prototype.update = function (frameState) {\n  // update collection: imagery indices, base layers, raise layer show/hide event\n  this._imageryLayers._update();\n};\n\nfunction updateCredits(surface, frameState) {\n  var creditDisplay = frameState.creditDisplay;\n  if (\n    surface._terrainProvider.ready &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surface._terrainProvider.credit)\n  ) {\n    creditDisplay.addCredit(surface._terrainProvider.credit);\n  }\n\n  var imageryLayers = surface._imageryLayers;\n  for (var i = 0, len = imageryLayers.length; i < len; ++i) {\n    var imageryProvider = imageryLayers.get(i).imageryProvider;\n    if (imageryProvider.ready && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(imageryProvider.credit)) {\n      creditDisplay.addCredit(imageryProvider.credit);\n    }\n  }\n}\n\n/**\n * Called at the beginning of each render frame, before {@link QuadtreeTileProvider#showTileThisFrame}\n * @param {FrameState} frameState The frame state.\n */\nGlobeSurfaceTileProvider.prototype.initialize = function (frameState) {\n  // update each layer for texture reprojection.\n  this._imageryLayers.queueReprojectionCommands(frameState);\n\n  if (this._layerOrderChanged) {\n    this._layerOrderChanged = false;\n\n    // Sort the TileImagery instances in each tile by the layer index.\n    this._quadtree.forEachLoadedTile(function (tile) {\n      tile.data.imagery.sort(sortTileImageryByLayerIndex);\n    });\n  }\n\n  // Add credits for terrain and imagery providers.\n  updateCredits(this, frameState);\n\n  var vertexArraysToDestroy = this._vertexArraysToDestroy;\n  var length = vertexArraysToDestroy.length;\n  for (var j = 0; j < length; ++j) {\n    _GlobeSurfaceTile_js__WEBPACK_IMPORTED_MODULE_40__/* ["default"]._freeVertexArray */ .Z._freeVertexArray(vertexArraysToDestroy[j]);\n  }\n  vertexArraysToDestroy.length = 0;\n};\n\n/**\n * Called at the beginning of the update cycle for each render frame, before {@link QuadtreeTileProvider#showTileThisFrame}\n * or any other functions.\n *\n * @param {FrameState} frameState The frame state.\n */\nGlobeSurfaceTileProvider.prototype.beginUpdate = function (frameState) {\n  var tilesToRenderByTextureCount = this._tilesToRenderByTextureCount;\n  for (var i = 0, len = tilesToRenderByTextureCount.length; i < len; ++i) {\n    var tiles = tilesToRenderByTextureCount[i];\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tiles)) {\n      tiles.length = 0;\n    }\n  }\n  // update clipping planes\n  var clippingPlanes = this._clippingPlanes;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(clippingPlanes) && clippingPlanes.enabled) {\n    clippingPlanes.update(frameState);\n  }\n  this._usedDrawCommands = 0;\n\n  this._hasLoadedTilesThisFrame = false;\n  this._hasFillTilesThisFrame = false;\n};\n\n/**\n * Called at the end of the update cycle for each render frame, after {@link QuadtreeTileProvider#showTileThisFrame}\n * and any other functions.\n *\n * @param {FrameState} frameState The frame state.\n */\nGlobeSurfaceTileProvider.prototype.endUpdate = function (frameState) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(this._renderState)) {\n    this._renderState = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_35__/* ["default"].fromCache */ .Z.fromCache({\n      // Write color and depth\n      cull: {\n        enabled: true,\n      },\n      depthTest: {\n        enabled: true,\n        func: _DepthFunction_js__WEBPACK_IMPORTED_MODULE_39__/* ["default"].LESS */ .Z.LESS,\n      },\n    });\n\n    this._blendRenderState = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_35__/* ["default"].fromCache */ .Z.fromCache({\n      // Write color and depth\n      cull: {\n        enabled: true,\n      },\n      depthTest: {\n        enabled: true,\n        func: _DepthFunction_js__WEBPACK_IMPORTED_MODULE_39__/* ["default"].LESS_OR_EQUAL */ .Z.LESS_OR_EQUAL,\n      },\n      blending: _BlendingState_js__WEBPACK_IMPORTED_MODULE_37__/* ["default"].ALPHA_BLEND */ .Z.ALPHA_BLEND,\n    });\n\n    var rs = (0,_Core_clone_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z)(this._renderState, true);\n    rs.cull.enabled = false;\n    this._disableCullingRenderState = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_35__/* ["default"].fromCache */ .Z.fromCache(rs);\n\n    rs = (0,_Core_clone_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z)(this._blendRenderState, true);\n    rs.cull.enabled = false;\n    this._disableCullingBlendRenderState = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_35__/* ["default"].fromCache */ .Z.fromCache(rs);\n  }\n\n  // If this frame has a mix of loaded and fill tiles, we need to propagate\n  // loaded heights to the fill tiles.\n  if (this._hasFillTilesThisFrame && this._hasLoadedTilesThisFrame) {\n    _TerrainFillMesh_js__WEBPACK_IMPORTED_MODULE_48__/* ["default"].updateFillTiles */ .Z.updateFillTiles(\n      this,\n      this._quadtree._tilesToRender,\n      frameState,\n      this._vertexArraysToDestroy\n    );\n  }\n\n  // When terrain exaggeration changes, all of the loaded tiles need to generate\n  // geodetic surface normals so they can scale properly when rendered.\n  // When exaggeration is reset, geodetic surface normals are removed to decrease\n  // memory usage. Some tiles might have been constructed with the correct\n  // exaggeration already, so skip over them.\n\n  // If the geodetic surface normals can\'t be created because the tile doesn\'t\n  // have a mesh, keep checking until the tile does have a mesh. This can happen\n  // if the tile\'s mesh starts construction in a worker thread right before the\n  // exaggeration changes.\n\n  var quadtree = this.quadtree;\n  var exaggeration = frameState.terrainExaggeration;\n  var exaggerationRelativeHeight = frameState.terrainExaggerationRelativeHeight;\n  var exaggerationChanged =\n    this._oldTerrainExaggeration !== exaggeration ||\n    this._oldTerrainExaggerationRelativeHeight !== exaggerationRelativeHeight;\n\n  // Keep track of the next time there is a change in exaggeration\n  this._oldTerrainExaggeration = exaggeration;\n  this._oldTerrainExaggerationRelativeHeight = exaggerationRelativeHeight;\n\n  if (exaggerationChanged) {\n    quadtree.forEachLoadedTile(function (tile) {\n      var surfaceTile = tile.data;\n      surfaceTile.updateExaggeration(tile, frameState, quadtree);\n    });\n  }\n\n  // Add the tile render commands to the command list, sorted by texture count.\n  var tilesToRenderByTextureCount = this._tilesToRenderByTextureCount;\n  for (\n    var textureCountIndex = 0,\n      textureCountLength = tilesToRenderByTextureCount.length;\n    textureCountIndex < textureCountLength;\n    ++textureCountIndex\n  ) {\n    var tilesToRender = tilesToRenderByTextureCount[textureCountIndex];\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tilesToRender)) {\n      continue;\n    }\n\n    for (\n      var tileIndex = 0, tileLength = tilesToRender.length;\n      tileIndex < tileLength;\n      ++tileIndex\n    ) {\n      var tile = tilesToRender[tileIndex];\n      var tileBoundingRegion = tile.data.tileBoundingRegion;\n      addDrawCommandsForTile(this, tile, frameState);\n      frameState.minimumTerrainHeight = Math.min(\n        frameState.minimumTerrainHeight,\n        tileBoundingRegion.minimumHeight\n      );\n    }\n  }\n};\n\nfunction pushCommand(command, frameState) {\n  var globeTranslucencyState = frameState.globeTranslucencyState;\n  if (globeTranslucencyState.translucent) {\n    var isBlendCommand = command.renderState.blending.enabled;\n    globeTranslucencyState.pushDerivedCommands(\n      command,\n      isBlendCommand,\n      frameState\n    );\n  } else {\n    frameState.commandList.push(command);\n  }\n}\n\n/**\n * Adds draw commands for tiles rendered in the previous frame for a pick pass.\n *\n * @param {FrameState} frameState The frame state.\n */\nGlobeSurfaceTileProvider.prototype.updateForPick = function (frameState) {\n  // Add the tile pick commands from the tiles drawn last frame.\n  var drawCommands = this._drawCommands;\n  for (var i = 0, length = this._usedDrawCommands; i < length; ++i) {\n    pushCommand(drawCommands[i], frameState);\n  }\n};\n\n/**\n * Cancels any imagery re-projections in the queue.\n */\nGlobeSurfaceTileProvider.prototype.cancelReprojections = function () {\n  this._imageryLayers.cancelReprojections();\n};\n\n/**\n * Gets the maximum geometric error allowed in a tile at a given level, in meters.  This function should not be\n * called before {@link GlobeSurfaceTileProvider#ready} returns true.\n *\n * @param {Number} level The tile level for which to get the maximum geometric error.\n * @returns {Number} The maximum geometric error in meters.\n */\nGlobeSurfaceTileProvider.prototype.getLevelMaximumGeometricError = function (\n  level\n) {\n  return this._terrainProvider.getLevelMaximumGeometricError(level);\n};\n\n/**\n * Loads, or continues loading, a given tile.  This function will continue to be called\n * until {@link QuadtreeTile#state} is no longer {@link QuadtreeTileLoadState#LOADING}.  This function should\n * not be called before {@link GlobeSurfaceTileProvider#ready} returns true.\n *\n * @param {FrameState} frameState The frame state.\n * @param {QuadtreeTile} tile The tile to load.\n *\n * @exception {DeveloperError} <code>loadTile</code> must not be called before the tile provider is ready.\n */\nGlobeSurfaceTileProvider.prototype.loadTile = function (frameState, tile) {\n  // We don\'t want to load imagery until we\'re certain that the terrain tiles are actually visible.\n  // So if our bounding volume isn\'t accurate because it came from another tile, load terrain only\n  // initially. If we load some terrain and suddenly have a more accurate bounding volume and the\n  // tile is _still_ visible, give the tile a chance to load imagery immediately rather than\n  // waiting for next frame.\n\n  var surfaceTile = tile.data;\n  var terrainOnly = true;\n  var terrainStateBefore;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile)) {\n    terrainOnly =\n      surfaceTile.boundingVolumeSourceTile !== tile ||\n      tile._lastSelectionResult === _TileSelectionResult_js__WEBPACK_IMPORTED_MODULE_51__/* ["default"].CULLED_BUT_NEEDED */ .Z.CULLED_BUT_NEEDED;\n    terrainStateBefore = surfaceTile.terrainState;\n  }\n\n  _GlobeSurfaceTile_js__WEBPACK_IMPORTED_MODULE_40__/* ["default"].processStateMachine */ .Z.processStateMachine(\n    tile,\n    frameState,\n    this.terrainProvider,\n    this._imageryLayers,\n    this.quadtree,\n    this._vertexArraysToDestroy,\n    terrainOnly\n  );\n\n  surfaceTile = tile.data;\n  if (terrainOnly && terrainStateBefore !== tile.data.terrainState) {\n    // Terrain state changed. If:\n    // a) The tile is visible, and\n    // b) The bounding volume is accurate (updated as a side effect of computing visibility)\n    // Then we\'ll load imagery, too.\n    if (\n      this.computeTileVisibility(tile, frameState, this.quadtree.occluders) !==\n        _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].NONE */ .Z.NONE &&\n      surfaceTile.boundingVolumeSourceTile === tile\n    ) {\n      terrainOnly = false;\n      _GlobeSurfaceTile_js__WEBPACK_IMPORTED_MODULE_40__/* ["default"].processStateMachine */ .Z.processStateMachine(\n        tile,\n        frameState,\n        this.terrainProvider,\n        this._imageryLayers,\n        this.quadtree,\n        this._vertexArraysToDestroy,\n        terrainOnly\n      );\n    }\n  }\n};\n\nvar boundingSphereScratch = new _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\nvar rectangleIntersectionScratch = new _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"] */ .Z();\nvar splitCartographicLimitRectangleScratch = new _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"] */ .Z();\nvar rectangleCenterScratch = new _Core_Cartographic_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z();\n\n// cartographicLimitRectangle may span the IDL, but tiles never will.\nfunction clipRectangleAntimeridian(tileRectangle, cartographicLimitRectangle) {\n  if (cartographicLimitRectangle.west < cartographicLimitRectangle.east) {\n    return cartographicLimitRectangle;\n  }\n  var splitRectangle = _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].clone */ .Z.clone(\n    cartographicLimitRectangle,\n    splitCartographicLimitRectangleScratch\n  );\n  var tileCenter = _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].center */ .Z.center(tileRectangle, rectangleCenterScratch);\n  if (tileCenter.longitude > 0.0) {\n    splitRectangle.east = _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].PI */ .Z.PI;\n  } else {\n    splitRectangle.west = -_Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].PI */ .Z.PI;\n  }\n  return splitRectangle;\n}\n\nfunction isUndergroundVisible(tileProvider, frameState) {\n  if (frameState.cameraUnderground) {\n    return true;\n  }\n\n  if (frameState.globeTranslucencyState.translucent) {\n    return true;\n  }\n\n  if (tileProvider.backFaceCulling) {\n    return false;\n  }\n\n  var clippingPlanes = tileProvider._clippingPlanes;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(clippingPlanes) && clippingPlanes.enabled) {\n    return true;\n  }\n\n  if (\n    !_Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].equals */ .Z.equals(\n      tileProvider.cartographicLimitRectangle,\n      _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].MAX_VALUE */ .Z.MAX_VALUE\n    )\n  ) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Determines the visibility of a given tile.  The tile may be fully visible, partially visible, or not\n * visible at all.  Tiles that are renderable and are at least partially visible will be shown by a call\n * to {@link GlobeSurfaceTileProvider#showTileThisFrame}.\n *\n * @param {QuadtreeTile} tile The tile instance.\n * @param {FrameState} frameState The state information about the current frame.\n * @param {QuadtreeOccluders} occluders The objects that may occlude this tile.\n *\n * @returns {Visibility} Visibility.NONE if the tile is not visible,\n *                       Visibility.PARTIAL if the tile is partially visible, or\n *                       Visibility.FULL if the tile is fully visible.\n */\nGlobeSurfaceTileProvider.prototype.computeTileVisibility = function (\n  tile,\n  frameState,\n  occluders\n) {\n  var distance = this.computeDistanceToTile(tile, frameState);\n  tile._distance = distance;\n\n  var undergroundVisible = isUndergroundVisible(this, frameState);\n\n  if (frameState.fog.enabled && !undergroundVisible) {\n    if (_Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].fog */ .Z.fog(distance, frameState.fog.density) >= 1.0) {\n      // Tile is completely in fog so return that it is not visible.\n      return _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].NONE */ .Z.NONE;\n    }\n  }\n\n  var surfaceTile = tile.data;\n  var tileBoundingRegion = surfaceTile.tileBoundingRegion;\n\n  if (surfaceTile.boundingVolumeSourceTile === undefined) {\n    // We have no idea where this tile is, so let\'s just call it partially visible.\n    return _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].PARTIAL */ .Z.PARTIAL;\n  }\n\n  var cullingVolume = frameState.cullingVolume;\n  var boundingVolume = tileBoundingRegion.boundingVolume;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(boundingVolume)) {\n    boundingVolume = tileBoundingRegion.boundingSphere;\n  }\n\n  // Check if the tile is outside the limit area in cartographic space\n  surfaceTile.clippedByBoundaries = false;\n  var clippedCartographicLimitRectangle = clipRectangleAntimeridian(\n    tile.rectangle,\n    this.cartographicLimitRectangle\n  );\n  var areaLimitIntersection = _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].simpleIntersection */ .Z.simpleIntersection(\n    clippedCartographicLimitRectangle,\n    tile.rectangle,\n    rectangleIntersectionScratch\n  );\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(areaLimitIntersection)) {\n    return _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].NONE */ .Z.NONE;\n  }\n  if (!_Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].equals */ .Z.equals(areaLimitIntersection, tile.rectangle)) {\n    surfaceTile.clippedByBoundaries = true;\n  }\n\n  if (frameState.mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    boundingVolume = boundingSphereScratch;\n    _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].fromRectangleWithHeights2D */ .Z.fromRectangleWithHeights2D(\n      tile.rectangle,\n      frameState.mapProjection,\n      tileBoundingRegion.minimumHeight,\n      tileBoundingRegion.maximumHeight,\n      boundingVolume\n    );\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].fromElements */ .Z.fromElements(\n      boundingVolume.center.z,\n      boundingVolume.center.x,\n      boundingVolume.center.y,\n      boundingVolume.center\n    );\n\n    if (\n      frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].MORPHING */ .Z.MORPHING &&\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.renderedMesh)\n    ) {\n      boundingVolume = _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].union */ .Z.union(\n        tileBoundingRegion.boundingSphere,\n        boundingVolume,\n        boundingVolume\n      );\n    }\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(boundingVolume)) {\n    return _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].PARTIAL */ .Z.PARTIAL;\n  }\n\n  var clippingPlanes = this._clippingPlanes;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(clippingPlanes) && clippingPlanes.enabled) {\n    var planeIntersection = clippingPlanes.computeIntersectionWithBoundingVolume(\n      boundingVolume\n    );\n    tile.isClipped = planeIntersection !== _Core_Intersect_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].INSIDE */ .Z.INSIDE;\n    if (planeIntersection === _Core_Intersect_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].OUTSIDE */ .Z.OUTSIDE) {\n      return _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].NONE */ .Z.NONE;\n    }\n  }\n\n  var visibility;\n  var intersection = cullingVolume.computeVisibility(boundingVolume);\n\n  if (intersection === _Core_Intersect_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].OUTSIDE */ .Z.OUTSIDE) {\n    visibility = _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].NONE */ .Z.NONE;\n  } else if (intersection === _Core_Intersect_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].INTERSECTING */ .Z.INTERSECTING) {\n    visibility = _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].PARTIAL */ .Z.PARTIAL;\n  } else if (intersection === _Core_Intersect_js__WEBPACK_IMPORTED_MODULE_17__/* ["default"].INSIDE */ .Z.INSIDE) {\n    visibility = _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].FULL */ .Z.FULL;\n  }\n\n  if (visibility === _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].NONE */ .Z.NONE) {\n    return visibility;\n  }\n\n  var ortho3D =\n    frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].SCENE3D */ .Z.SCENE3D &&\n    frameState.camera.frustum instanceof _Core_OrthographicFrustum_js__WEBPACK_IMPORTED_MODULE_22__/* ["default"] */ .Z;\n  if (\n    frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].SCENE3D */ .Z.SCENE3D &&\n    !ortho3D &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(occluders) &&\n    !undergroundVisible\n  ) {\n    var occludeePointInScaledSpace = surfaceTile.occludeePointInScaledSpace;\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(occludeePointInScaledSpace)) {\n      return visibility;\n    }\n\n    if (\n      occluders.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(\n        occludeePointInScaledSpace,\n        tileBoundingRegion.minimumHeight\n      )\n    ) {\n      return visibility;\n    }\n\n    return _Core_Visibility_js__WEBPACK_IMPORTED_MODULE_28__/* ["default"].NONE */ .Z.NONE;\n  }\n\n  return visibility;\n};\n\n/**\n * Determines if the given tile can be refined\n * @param {QuadtreeTile} tile The tile to check.\n * @returns {boolean} True if the tile can be refined, false if it cannot.\n */\nGlobeSurfaceTileProvider.prototype.canRefine = function (tile) {\n  // Only allow refinement it we know whether or not the children of this tile exist.\n  // For a tileset with `availability`, we\'ll always be able to refine.\n  // We can ask for availability of _any_ child tile because we only need to confirm\n  // that we get a yes or no answer, it doesn\'t matter what the answer is.\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tile.data.terrainData)) {\n    return true;\n  }\n  var childAvailable = this.terrainProvider.getTileDataAvailable(\n    tile.x * 2,\n    tile.y * 2,\n    tile.level + 1\n  );\n  return childAvailable !== undefined;\n};\n\nvar readyImageryScratch = [];\nvar canRenderTraversalStack = [];\n\n/**\n * Determines if the given not-fully-loaded tile can be rendered without losing detail that\n * was present last frame as a result of rendering descendant tiles. This method will only be\n * called if this tile\'s descendants were rendered last frame. If the tile is fully loaded,\n * it is assumed that this method will return true and it will not be called.\n * @param {QuadtreeTile} tile The tile to check.\n * @returns {boolean} True if the tile can be rendered without losing detail.\n */\nGlobeSurfaceTileProvider.prototype.canRenderWithoutLosingDetail = function (\n  tile,\n  frameState\n) {\n  var surfaceTile = tile.data;\n\n  var readyImagery = readyImageryScratch;\n  readyImagery.length = this._imageryLayers.length;\n\n  var terrainReady = false;\n  var initialImageryState = false;\n  var imagery;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile)) {\n    // We can render even with non-ready terrain as long as all our rendered descendants\n    // are missing terrain geometry too. i.e. if we rendered fills for more detailed tiles\n    // last frame, it\'s ok to render a fill for this tile this frame.\n    terrainReady = surfaceTile.terrainState === _TerrainState_js__WEBPACK_IMPORTED_MODULE_49__/* ["default"].READY */ .Z.READY;\n\n    // Initially assume all imagery layers are ready, unless imagery hasn\'t been initialized at all.\n    initialImageryState = true;\n\n    imagery = surfaceTile.imagery;\n  }\n\n  var i;\n  var len;\n\n  for (i = 0, len = readyImagery.length; i < len; ++i) {\n    readyImagery[i] = initialImageryState;\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(imagery)) {\n    for (i = 0, len = imagery.length; i < len; ++i) {\n      var tileImagery = imagery[i];\n      var loadingImagery = tileImagery.loadingImagery;\n      var isReady =\n        !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(loadingImagery) ||\n        loadingImagery.state === _ImageryState_js__WEBPACK_IMPORTED_MODULE_42__/* ["default"].FAILED */ .Z.FAILED ||\n        loadingImagery.state === _ImageryState_js__WEBPACK_IMPORTED_MODULE_42__/* ["default"].INVALID */ .Z.INVALID;\n      var layerIndex = (tileImagery.loadingImagery || tileImagery.readyImagery)\n        .imageryLayer._layerIndex;\n\n      // For a layer to be ready, all tiles belonging to that layer must be ready.\n      readyImagery[layerIndex] = isReady && readyImagery[layerIndex];\n    }\n  }\n\n  var lastFrame = this.quadtree._lastSelectionFrameNumber;\n\n  // Traverse the descendants looking for one with terrain or imagery that is not loaded on this tile.\n  var stack = canRenderTraversalStack;\n  stack.length = 0;\n  stack.push(\n    tile.southwestChild,\n    tile.southeastChild,\n    tile.northwestChild,\n    tile.northeastChild\n  );\n\n  while (stack.length > 0) {\n    var descendant = stack.pop();\n    var lastFrameSelectionResult =\n      descendant._lastSelectionResultFrame === lastFrame\n        ? descendant._lastSelectionResult\n        : _TileSelectionResult_js__WEBPACK_IMPORTED_MODULE_51__/* ["default"].NONE */ .Z.NONE;\n\n    if (lastFrameSelectionResult === _TileSelectionResult_js__WEBPACK_IMPORTED_MODULE_51__/* ["default"].RENDERED */ .Z.RENDERED) {\n      var descendantSurface = descendant.data;\n\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(descendantSurface)) {\n        // Descendant has no data, so it can\'t block rendering.\n        continue;\n      }\n\n      if (\n        !terrainReady &&\n        descendant.data.terrainState === _TerrainState_js__WEBPACK_IMPORTED_MODULE_49__/* ["default"].READY */ .Z.READY\n      ) {\n        // Rendered descendant has real terrain, but we don\'t. Rendering is blocked.\n        return false;\n      }\n\n      var descendantImagery = descendant.data.imagery;\n      for (i = 0, len = descendantImagery.length; i < len; ++i) {\n        var descendantTileImagery = descendantImagery[i];\n        var descendantLoadingImagery = descendantTileImagery.loadingImagery;\n        var descendantIsReady =\n          !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(descendantLoadingImagery) ||\n          descendantLoadingImagery.state === _ImageryState_js__WEBPACK_IMPORTED_MODULE_42__/* ["default"].FAILED */ .Z.FAILED ||\n          descendantLoadingImagery.state === _ImageryState_js__WEBPACK_IMPORTED_MODULE_42__/* ["default"].INVALID */ .Z.INVALID;\n        var descendantLayerIndex = (\n          descendantTileImagery.loadingImagery ||\n          descendantTileImagery.readyImagery\n        ).imageryLayer._layerIndex;\n\n        // If this imagery tile of a descendant is ready but the layer isn\'t ready in this tile,\n        // then rendering is blocked.\n        if (descendantIsReady && !readyImagery[descendantLayerIndex]) {\n          return false;\n        }\n      }\n    } else if (lastFrameSelectionResult === _TileSelectionResult_js__WEBPACK_IMPORTED_MODULE_51__/* ["default"].REFINED */ .Z.REFINED) {\n      stack.push(\n        descendant.southwestChild,\n        descendant.southeastChild,\n        descendant.northwestChild,\n        descendant.northeastChild\n      );\n    }\n  }\n\n  return true;\n};\n\nvar tileDirectionScratch = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\n\n/**\n * Determines the priority for loading this tile. Lower priority values load sooner.\n * @param {QuadtreeTile} tile The tile.\n * @param {FrameState} frameState The frame state.\n * @returns {Number} The load priority value.\n */\nGlobeSurfaceTileProvider.prototype.computeTileLoadPriority = function (\n  tile,\n  frameState\n) {\n  var surfaceTile = tile.data;\n  if (surfaceTile === undefined) {\n    return 0.0;\n  }\n\n  var obb = surfaceTile.tileBoundingRegion.boundingVolume;\n  if (obb === undefined) {\n    return 0.0;\n  }\n\n  var cameraPosition = frameState.camera.positionWC;\n  var cameraDirection = frameState.camera.directionWC;\n  var tileDirection = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].subtract */ .Z.subtract(\n    obb.center,\n    cameraPosition,\n    tileDirectionScratch\n  );\n  var magnitude = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].magnitude */ .Z.magnitude(tileDirection);\n  if (magnitude < _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].EPSILON5 */ .Z.EPSILON5) {\n    return 0.0;\n  }\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].divideByScalar */ .Z.divideByScalar(tileDirection, magnitude, tileDirection);\n  return (\n    (1.0 - _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].dot */ .Z.dot(tileDirection, cameraDirection)) * tile._distance\n  );\n};\n\nvar modifiedModelViewScratch = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z();\nvar modifiedModelViewProjectionScratch = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z();\nvar tileRectangleScratch = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z();\nvar localizedCartographicLimitRectangleScratch = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z();\nvar localizedTranslucencyRectangleScratch = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z();\nvar rtcScratch = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar centerEyeScratch = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar southwestScratch = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\nvar northeastScratch = new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z();\n\n/**\n * Shows a specified tile in this frame.  The provider can cause the tile to be shown by adding\n * render commands to the commandList, or use any other method as appropriate.  The tile is not\n * expected to be visible next frame as well, unless this method is called next frame, too.\n *\n * @param {QuadtreeTile} tile The tile instance.\n * @param {FrameState} frameState The state information of the current rendering frame.\n */\nGlobeSurfaceTileProvider.prototype.showTileThisFrame = function (\n  tile,\n  frameState\n) {\n  var readyTextureCount = 0;\n  var tileImageryCollection = tile.data.imagery;\n  for (var i = 0, len = tileImageryCollection.length; i < len; ++i) {\n    var tileImagery = tileImageryCollection[i];\n    if (\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tileImagery.readyImagery) &&\n      tileImagery.readyImagery.imageryLayer.alpha !== 0.0\n    ) {\n      ++readyTextureCount;\n    }\n  }\n\n  var tileSet = this._tilesToRenderByTextureCount[readyTextureCount];\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tileSet)) {\n    tileSet = [];\n    this._tilesToRenderByTextureCount[readyTextureCount] = tileSet;\n  }\n\n  tileSet.push(tile);\n\n  var surfaceTile = tile.data;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.vertexArray)) {\n    this._hasFillTilesThisFrame = true;\n  } else {\n    this._hasLoadedTilesThisFrame = true;\n  }\n\n  var debug = this._debug;\n  ++debug.tilesRendered;\n  debug.texturesRendered += readyTextureCount;\n};\n\nvar cornerPositionsScratch = [\n  new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z(),\n  new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z(),\n  new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z(),\n  new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z(),\n];\n\nfunction computeOccludeePoint(\n  tileProvider,\n  center,\n  rectangle,\n  minimumHeight,\n  maximumHeight,\n  result\n) {\n  var ellipsoidalOccluder = tileProvider.quadtree._occluders.ellipsoid;\n  var ellipsoid = ellipsoidalOccluder.ellipsoid;\n\n  var cornerPositions = cornerPositionsScratch;\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].fromRadians */ .Z.fromRadians(\n    rectangle.west,\n    rectangle.south,\n    maximumHeight,\n    ellipsoid,\n    cornerPositions[0]\n  );\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].fromRadians */ .Z.fromRadians(\n    rectangle.east,\n    rectangle.south,\n    maximumHeight,\n    ellipsoid,\n    cornerPositions[1]\n  );\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].fromRadians */ .Z.fromRadians(\n    rectangle.west,\n    rectangle.north,\n    maximumHeight,\n    ellipsoid,\n    cornerPositions[2]\n  );\n  _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].fromRadians */ .Z.fromRadians(\n    rectangle.east,\n    rectangle.north,\n    maximumHeight,\n    ellipsoid,\n    cornerPositions[3]\n  );\n\n  return ellipsoidalOccluder.computeHorizonCullingPointPossiblyUnderEllipsoid(\n    center,\n    cornerPositions,\n    minimumHeight,\n    result\n  );\n}\n\n/**\n * Gets the distance from the camera to the closest point on the tile.  This is used for level-of-detail selection.\n *\n * @param {QuadtreeTile} tile The tile instance.\n * @param {FrameState} frameState The state information of the current rendering frame.\n *\n * @returns {Number} The distance from the camera to the closest point on the tile, in meters.\n */\nGlobeSurfaceTileProvider.prototype.computeDistanceToTile = function (\n  tile,\n  frameState\n) {\n  // The distance should be:\n  // 1. the actual distance to the tight-fitting bounding volume, or\n  // 2. a distance that is equal to or greater than the actual distance to the tight-fitting bounding volume.\n  //\n  // When we don\'t know the min/max heights for a tile, but we do know the min/max of an ancestor tile, we can\n  // build a tight-fitting bounding volume horizontally, but not vertically. The min/max heights from the\n  // ancestor will likely form a volume that is much bigger than it needs to be. This means that the volume may\n  // be deemed to be much closer to the camera than it really is, causing us to select tiles that are too detailed.\n  // Loading too-detailed tiles is super expensive, so we don\'t want to do that. We don\'t know where the child\n  // tile really lies within the parent range of heights, but we _do_ know the child tile can\'t be any closer than\n  // the ancestor height surface (min or max) that is _farthest away_ from the camera. So if we compute distance\n  // based on that conservative metric, we may end up loading tiles that are not detailed enough, but that\'s much\n  // better (faster) than loading tiles that are too detailed.\n\n  updateTileBoundingRegion(tile, this, frameState);\n\n  var surfaceTile = tile.data;\n  var boundingVolumeSourceTile = surfaceTile.boundingVolumeSourceTile;\n  if (boundingVolumeSourceTile === undefined) {\n    // Can\'t find any min/max heights anywhere? Ok, let\'s just say the\n    // tile is really far away so we\'ll load and render it rather than\n    // refining.\n    return 9999999999.0;\n  }\n\n  var tileBoundingRegion = surfaceTile.tileBoundingRegion;\n  var min = tileBoundingRegion.minimumHeight;\n  var max = tileBoundingRegion.maximumHeight;\n\n  if (surfaceTile.boundingVolumeSourceTile !== tile) {\n    var cameraHeight = frameState.camera.positionCartographic.height;\n    var distanceToMin = Math.abs(cameraHeight - min);\n    var distanceToMax = Math.abs(cameraHeight - max);\n    if (distanceToMin > distanceToMax) {\n      tileBoundingRegion.minimumHeight = min;\n      tileBoundingRegion.maximumHeight = min;\n    } else {\n      tileBoundingRegion.minimumHeight = max;\n      tileBoundingRegion.maximumHeight = max;\n    }\n  }\n\n  var result = tileBoundingRegion.distanceToCamera(frameState);\n\n  tileBoundingRegion.minimumHeight = min;\n  tileBoundingRegion.maximumHeight = max;\n\n  return result;\n};\n\nfunction updateTileBoundingRegion(tile, tileProvider, frameState) {\n  var surfaceTile = tile.data;\n  if (surfaceTile === undefined) {\n    surfaceTile = tile.data = new _GlobeSurfaceTile_js__WEBPACK_IMPORTED_MODULE_40__/* ["default"] */ .Z();\n  }\n\n  var ellipsoid = tile.tilingScheme.ellipsoid;\n  if (surfaceTile.tileBoundingRegion === undefined) {\n    surfaceTile.tileBoundingRegion = new _TileBoundingRegion_js__WEBPACK_IMPORTED_MODULE_50__/* ["default"] */ .Z({\n      computeBoundingVolumes: false,\n      rectangle: tile.rectangle,\n      ellipsoid: ellipsoid,\n      minimumHeight: 0.0,\n      maximumHeight: 0.0,\n    });\n  }\n\n  var tileBoundingRegion = surfaceTile.tileBoundingRegion;\n  var oldMinimumHeight = tileBoundingRegion.minimumHeight;\n  var oldMaximumHeight = tileBoundingRegion.maximumHeight;\n  var hasBoundingVolumesFromMesh = false;\n  var sourceTile = tile;\n\n  // Get min and max heights from the mesh.\n  // If the mesh is not available, get them from the terrain data.\n  // If the terrain data is not available either, get them from an ancestor.\n  // If none of the ancestors are available, then there are no min and max heights for this tile at this time.\n  var mesh = surfaceTile.mesh;\n  var terrainData = surfaceTile.terrainData;\n  if (\n    mesh !== undefined &&\n    mesh.minimumHeight !== undefined &&\n    mesh.maximumHeight !== undefined\n  ) {\n    tileBoundingRegion.minimumHeight = mesh.minimumHeight;\n    tileBoundingRegion.maximumHeight = mesh.maximumHeight;\n    hasBoundingVolumesFromMesh = true;\n  } else if (\n    terrainData !== undefined &&\n    terrainData._minimumHeight !== undefined &&\n    terrainData._maximumHeight !== undefined\n  ) {\n    tileBoundingRegion.minimumHeight = terrainData._minimumHeight;\n    tileBoundingRegion.maximumHeight = terrainData._maximumHeight;\n  } else {\n    // No accurate min/max heights available, so we\'re stuck with min/max heights from an ancestor tile.\n    tileBoundingRegion.minimumHeight = Number.NaN;\n    tileBoundingRegion.maximumHeight = Number.NaN;\n\n    var ancestorTile = tile.parent;\n    while (ancestorTile !== undefined) {\n      var ancestorSurfaceTile = ancestorTile.data;\n      if (ancestorSurfaceTile !== undefined) {\n        var ancestorMesh = ancestorSurfaceTile.mesh;\n        var ancestorTerrainData = ancestorSurfaceTile.terrainData;\n        if (\n          ancestorMesh !== undefined &&\n          ancestorMesh.minimumHeight !== undefined &&\n          ancestorMesh.maximumHeight !== undefined\n        ) {\n          tileBoundingRegion.minimumHeight = ancestorMesh.minimumHeight;\n          tileBoundingRegion.maximumHeight = ancestorMesh.maximumHeight;\n          break;\n        } else if (\n          ancestorTerrainData !== undefined &&\n          ancestorTerrainData._minimumHeight !== undefined &&\n          ancestorTerrainData._maximumHeight !== undefined\n        ) {\n          tileBoundingRegion.minimumHeight = ancestorTerrainData._minimumHeight;\n          tileBoundingRegion.maximumHeight = ancestorTerrainData._maximumHeight;\n          break;\n        }\n      }\n      ancestorTile = ancestorTile.parent;\n    }\n    sourceTile = ancestorTile;\n  }\n\n  // Update bounding regions from the min and max heights\n  if (sourceTile !== undefined) {\n    var exaggeration = frameState.terrainExaggeration;\n    var exaggerationRelativeHeight =\n      frameState.terrainExaggerationRelativeHeight;\n    var hasExaggeration = exaggeration !== 1.0;\n    if (hasExaggeration) {\n      hasBoundingVolumesFromMesh = false;\n      tileBoundingRegion.minimumHeight = _Core_TerrainExaggeration_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].getHeight */ .Z.getHeight(\n        tileBoundingRegion.minimumHeight,\n        exaggeration,\n        exaggerationRelativeHeight\n      );\n      tileBoundingRegion.maximumHeight = _Core_TerrainExaggeration_js__WEBPACK_IMPORTED_MODULE_26__/* ["default"].getHeight */ .Z.getHeight(\n        tileBoundingRegion.maximumHeight,\n        exaggeration,\n        exaggerationRelativeHeight\n      );\n    }\n\n    if (hasBoundingVolumesFromMesh) {\n      if (!surfaceTile.boundingVolumeIsFromMesh) {\n        tileBoundingRegion._orientedBoundingBox = _Core_OrientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].clone */ .Z.clone(\n          mesh.orientedBoundingBox,\n          tileBoundingRegion._orientedBoundingBox\n        );\n        tileBoundingRegion._boundingSphere = _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(\n          mesh.boundingSphere3D,\n          tileBoundingRegion._boundingSphere\n        );\n        surfaceTile.occludeePointInScaledSpace = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(\n          mesh.occludeePointInScaledSpace,\n          surfaceTile.occludeePointInScaledSpace\n        );\n\n        // If the occludee point is not defined, fallback to calculating it from the OBB\n        if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.occludeePointInScaledSpace)) {\n          surfaceTile.occludeePointInScaledSpace = computeOccludeePoint(\n            tileProvider,\n            tileBoundingRegion._orientedBoundingBox.center,\n            tile.rectangle,\n            tileBoundingRegion.minimumHeight,\n            tileBoundingRegion.maximumHeight,\n            surfaceTile.occludeePointInScaledSpace\n          );\n        }\n      }\n    } else {\n      var needsBounds =\n        tileBoundingRegion._orientedBoundingBox === undefined ||\n        tileBoundingRegion._boundingSphere === undefined;\n      var heightChanged =\n        tileBoundingRegion.minimumHeight !== oldMinimumHeight ||\n        tileBoundingRegion.maximumHeight !== oldMaximumHeight;\n      if (heightChanged || needsBounds) {\n        // Bounding volumes need to be recomputed in some circumstances\n        tileBoundingRegion.computeBoundingVolumes(ellipsoid);\n        surfaceTile.occludeePointInScaledSpace = computeOccludeePoint(\n          tileProvider,\n          tileBoundingRegion._orientedBoundingBox.center,\n          tile.rectangle,\n          tileBoundingRegion.minimumHeight,\n          tileBoundingRegion.maximumHeight,\n          surfaceTile.occludeePointInScaledSpace\n        );\n      }\n    }\n    surfaceTile.boundingVolumeSourceTile = sourceTile;\n    surfaceTile.boundingVolumeIsFromMesh = hasBoundingVolumesFromMesh;\n  } else {\n    surfaceTile.boundingVolumeSourceTile = undefined;\n    surfaceTile.boundingVolumeIsFromMesh = false;\n  }\n}\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <br /><br />\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n *\n * @returns {Boolean} True if this object was destroyed; otherwise, false.\n *\n * @see GlobeSurfaceTileProvider#destroy\n */\nGlobeSurfaceTileProvider.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n * <br /><br />\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * provider = provider && provider();\n *\n * @see GlobeSurfaceTileProvider#isDestroyed\n */\nGlobeSurfaceTileProvider.prototype.destroy = function () {\n  this._tileProvider = this._tileProvider && this._tileProvider.destroy();\n  this._clippingPlanes = this._clippingPlanes && this._clippingPlanes.destroy();\n\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(this);\n};\n\nfunction getTileReadyCallback(tileImageriesToFree, layer, terrainProvider) {\n  return function (tile) {\n    var tileImagery;\n    var imagery;\n    var startIndex = -1;\n    var tileImageryCollection = tile.data.imagery;\n    var length = tileImageryCollection.length;\n    var i;\n    for (i = 0; i < length; ++i) {\n      tileImagery = tileImageryCollection[i];\n      imagery = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(\n        tileImagery.readyImagery,\n        tileImagery.loadingImagery\n      );\n      if (imagery.imageryLayer === layer) {\n        startIndex = i;\n        break;\n      }\n    }\n\n    if (startIndex !== -1) {\n      var endIndex = startIndex + tileImageriesToFree;\n      tileImagery = tileImageryCollection[endIndex];\n      imagery = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tileImagery)\n        ? (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(tileImagery.readyImagery, tileImagery.loadingImagery)\n        : undefined;\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(imagery) || imagery.imageryLayer !== layer) {\n        // Return false to keep the callback if we have to wait on the skeletons\n        // Return true to remove the callback if something went wrong\n        return !layer._createTileImagerySkeletons(\n          tile,\n          terrainProvider,\n          endIndex\n        );\n      }\n\n      for (i = startIndex; i < endIndex; ++i) {\n        tileImageryCollection[i].freeResources();\n      }\n\n      tileImageryCollection.splice(startIndex, tileImageriesToFree);\n    }\n\n    return true; // Everything is done, so remove the callback\n  };\n}\n\nGlobeSurfaceTileProvider.prototype._onLayerAdded = function (layer, index) {\n  if (layer.show) {\n    var terrainProvider = this._terrainProvider;\n\n    var that = this;\n    var imageryProvider = layer.imageryProvider;\n    var tileImageryUpdatedEvent = this._imageryLayersUpdatedEvent;\n    imageryProvider._reload = function () {\n      // Clear the layer\'s cache\n      layer._imageryCache = {};\n\n      that._quadtree.forEachLoadedTile(function (tile) {\n        // If this layer is still waiting to for the loaded callback, just return\n        if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tile._loadedCallbacks[layer._layerIndex])) {\n          return;\n        }\n\n        var i;\n\n        // Figure out how many TileImageries we will need to remove and where to insert new ones\n        var tileImageryCollection = tile.data.imagery;\n        var length = tileImageryCollection.length;\n        var startIndex = -1;\n        var tileImageriesToFree = 0;\n        for (i = 0; i < length; ++i) {\n          var tileImagery = tileImageryCollection[i];\n          var imagery = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(\n            tileImagery.readyImagery,\n            tileImagery.loadingImagery\n          );\n          if (imagery.imageryLayer === layer) {\n            if (startIndex === -1) {\n              startIndex = i;\n            }\n\n            ++tileImageriesToFree;\n          } else if (startIndex !== -1) {\n            // iterated past the section of TileImageries belonging to this layer, no need to continue.\n            break;\n          }\n        }\n\n        if (startIndex === -1) {\n          return;\n        }\n\n        // Insert immediately after existing TileImageries\n        var insertionPoint = startIndex + tileImageriesToFree;\n\n        // Create new TileImageries for all loaded tiles\n        if (\n          layer._createTileImagerySkeletons(\n            tile,\n            terrainProvider,\n            insertionPoint\n          )\n        ) {\n          // Add callback to remove old TileImageries when the new TileImageries are ready\n          tile._loadedCallbacks[layer._layerIndex] = getTileReadyCallback(\n            tileImageriesToFree,\n            layer,\n            terrainProvider\n          );\n\n          tile.state = _QuadtreeTileLoadState_js__WEBPACK_IMPORTED_MODULE_45__/* ["default"].LOADING */ .Z.LOADING;\n        }\n      });\n    };\n\n    // create TileImageries for this layer for all previously loaded tiles\n    this._quadtree.forEachLoadedTile(function (tile) {\n      if (layer._createTileImagerySkeletons(tile, terrainProvider)) {\n        tile.state = _QuadtreeTileLoadState_js__WEBPACK_IMPORTED_MODULE_45__/* ["default"].LOADING */ .Z.LOADING;\n\n        // Tiles that are not currently being rendered need to load the new layer before they\'re renderable.\n        // We don\'t mark the rendered tiles non-renderable, though, because that would make the globe disappear.\n        if (\n          tile.level !== 0 &&\n          (tile._lastSelectionResultFrame !==\n            that.quadtree._lastSelectionFrameNumber ||\n            tile._lastSelectionResult !== _TileSelectionResult_js__WEBPACK_IMPORTED_MODULE_51__/* ["default"].RENDERED */ .Z.RENDERED)\n        ) {\n          tile.renderable = false;\n        }\n      }\n    });\n\n    this._layerOrderChanged = true;\n    tileImageryUpdatedEvent.raiseEvent();\n  }\n};\n\nGlobeSurfaceTileProvider.prototype._onLayerRemoved = function (layer, index) {\n  // destroy TileImagerys for this layer for all previously loaded tiles\n  this._quadtree.forEachLoadedTile(function (tile) {\n    var tileImageryCollection = tile.data.imagery;\n\n    var startIndex = -1;\n    var numDestroyed = 0;\n    for (var i = 0, len = tileImageryCollection.length; i < len; ++i) {\n      var tileImagery = tileImageryCollection[i];\n      var imagery = tileImagery.loadingImagery;\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(imagery)) {\n        imagery = tileImagery.readyImagery;\n      }\n      if (imagery.imageryLayer === layer) {\n        if (startIndex === -1) {\n          startIndex = i;\n        }\n\n        tileImagery.freeResources();\n        ++numDestroyed;\n      } else if (startIndex !== -1) {\n        // iterated past the section of TileImagerys belonging to this layer, no need to continue.\n        break;\n      }\n    }\n\n    if (startIndex !== -1) {\n      tileImageryCollection.splice(startIndex, numDestroyed);\n    }\n  });\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(layer.imageryProvider)) {\n    layer.imageryProvider._reload = undefined;\n  }\n\n  this._imageryLayersUpdatedEvent.raiseEvent();\n};\n\nGlobeSurfaceTileProvider.prototype._onLayerMoved = function (\n  layer,\n  newIndex,\n  oldIndex\n) {\n  this._layerOrderChanged = true;\n  this._imageryLayersUpdatedEvent.raiseEvent();\n};\n\nGlobeSurfaceTileProvider.prototype._onLayerShownOrHidden = function (\n  layer,\n  index,\n  show\n) {\n  if (show) {\n    this._onLayerAdded(layer, index);\n  } else {\n    this._onLayerRemoved(layer, index);\n  }\n};\n\nvar scratchClippingPlanesMatrix = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z();\nvar scratchInverseTransposeClippingPlanesMatrix = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z();\nfunction createTileUniformMap(frameState, globeSurfaceTileProvider) {\n  var uniformMap = {\n    u_initialColor: function () {\n      return this.properties.initialColor;\n    },\n    u_fillHighlightColor: function () {\n      return this.properties.fillHighlightColor;\n    },\n    u_zoomedOutOceanSpecularIntensity: function () {\n      return this.properties.zoomedOutOceanSpecularIntensity;\n    },\n    u_oceanNormalMap: function () {\n      return this.properties.oceanNormalMap;\n    },\n    u_lightingFadeDistance: function () {\n      return this.properties.lightingFadeDistance;\n    },\n    u_nightFadeDistance: function () {\n      return this.properties.nightFadeDistance;\n    },\n    u_center3D: function () {\n      return this.properties.center3D;\n    },\n    u_terrainExaggerationAndRelativeHeight: function () {\n      return this.properties.terrainExaggerationAndRelativeHeight;\n    },\n    u_tileRectangle: function () {\n      return this.properties.tileRectangle;\n    },\n    u_modifiedModelView: function () {\n      var viewMatrix = frameState.context.uniformState.view;\n      var centerEye = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].multiplyByPoint */ .Z.multiplyByPoint(\n        viewMatrix,\n        this.properties.rtc,\n        centerEyeScratch\n      );\n      _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].setTranslation */ .Z.setTranslation(viewMatrix, centerEye, modifiedModelViewScratch);\n      return modifiedModelViewScratch;\n    },\n    u_modifiedModelViewProjection: function () {\n      var viewMatrix = frameState.context.uniformState.view;\n      var projectionMatrix = frameState.context.uniformState.projection;\n      var centerEye = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].multiplyByPoint */ .Z.multiplyByPoint(\n        viewMatrix,\n        this.properties.rtc,\n        centerEyeScratch\n      );\n      _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].setTranslation */ .Z.setTranslation(\n        viewMatrix,\n        centerEye,\n        modifiedModelViewProjectionScratch\n      );\n      _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].multiply */ .Z.multiply(\n        projectionMatrix,\n        modifiedModelViewProjectionScratch,\n        modifiedModelViewProjectionScratch\n      );\n      return modifiedModelViewProjectionScratch;\n    },\n    u_dayTextures: function () {\n      return this.properties.dayTextures;\n    },\n    u_dayTextureTranslationAndScale: function () {\n      return this.properties.dayTextureTranslationAndScale;\n    },\n    u_dayTextureTexCoordsRectangle: function () {\n      return this.properties.dayTextureTexCoordsRectangle;\n    },\n    u_dayTextureUseWebMercatorT: function () {\n      return this.properties.dayTextureUseWebMercatorT;\n    },\n    u_dayTextureAlpha: function () {\n      return this.properties.dayTextureAlpha;\n    },\n    u_dayTextureNightAlpha: function () {\n      return this.properties.dayTextureNightAlpha;\n    },\n    u_dayTextureDayAlpha: function () {\n      return this.properties.dayTextureDayAlpha;\n    },\n    u_dayTextureBrightness: function () {\n      return this.properties.dayTextureBrightness;\n    },\n    u_dayTextureContrast: function () {\n      return this.properties.dayTextureContrast;\n    },\n    u_dayTextureHue: function () {\n      return this.properties.dayTextureHue;\n    },\n    u_dayTextureSaturation: function () {\n      return this.properties.dayTextureSaturation;\n    },\n    u_dayTextureOneOverGamma: function () {\n      return this.properties.dayTextureOneOverGamma;\n    },\n    u_dayIntensity: function () {\n      return this.properties.dayIntensity;\n    },\n    u_southAndNorthLatitude: function () {\n      return this.properties.southAndNorthLatitude;\n    },\n    u_southMercatorYAndOneOverHeight: function () {\n      return this.properties.southMercatorYAndOneOverHeight;\n    },\n    u_waterMask: function () {\n      return this.properties.waterMask;\n    },\n    u_waterMaskTranslationAndScale: function () {\n      return this.properties.waterMaskTranslationAndScale;\n    },\n    u_minMaxHeight: function () {\n      return this.properties.minMaxHeight;\n    },\n    u_scaleAndBias: function () {\n      return this.properties.scaleAndBias;\n    },\n    u_dayTextureSplit: function () {\n      return this.properties.dayTextureSplit;\n    },\n    u_dayTextureCutoutRectangles: function () {\n      return this.properties.dayTextureCutoutRectangles;\n    },\n    u_clippingPlanes: function () {\n      var clippingPlanes = globeSurfaceTileProvider._clippingPlanes;\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(clippingPlanes) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(clippingPlanes.texture)) {\n        // Check in case clippingPlanes hasn\'t been updated yet.\n        return clippingPlanes.texture;\n      }\n      return frameState.context.defaultTexture;\n    },\n    u_cartographicLimitRectangle: function () {\n      return this.properties.localizedCartographicLimitRectangle;\n    },\n    u_clippingPlanesMatrix: function () {\n      var clippingPlanes = globeSurfaceTileProvider._clippingPlanes;\n      var transform = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(clippingPlanes)\n        ? _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].multiply */ .Z.multiply(\n            frameState.context.uniformState.view,\n            clippingPlanes.modelMatrix,\n            scratchClippingPlanesMatrix\n          )\n        : _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].IDENTITY */ .Z.IDENTITY;\n\n      return _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].inverseTranspose */ .Z.inverseTranspose(\n        transform,\n        scratchInverseTransposeClippingPlanesMatrix\n      );\n    },\n    u_clippingPlanesEdgeStyle: function () {\n      var style = this.properties.clippingPlanesEdgeColor;\n      style.alpha = this.properties.clippingPlanesEdgeWidth;\n      return style;\n    },\n    u_minimumBrightness: function () {\n      return frameState.fog.minimumBrightness;\n    },\n    u_hsbShift: function () {\n      return this.properties.hsbShift;\n    },\n    u_colorsToAlpha: function () {\n      return this.properties.colorsToAlpha;\n    },\n    u_frontFaceAlphaByDistance: function () {\n      return this.properties.frontFaceAlphaByDistance;\n    },\n    u_backFaceAlphaByDistance: function () {\n      return this.properties.backFaceAlphaByDistance;\n    },\n    u_translucencyRectangle: function () {\n      return this.properties.localizedTranslucencyRectangle;\n    },\n    u_undergroundColor: function () {\n      return this.properties.undergroundColor;\n    },\n    u_undergroundColorAlphaByDistance: function () {\n      return this.properties.undergroundColorAlphaByDistance;\n    },\n\n    // make a separate object so that changes to the properties are seen on\n    // derived commands that combine another uniform map with this one.\n    properties: {\n      initialColor: new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(0.0, 0.0, 0.5, 1.0),\n      fillHighlightColor: new _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z(0.0, 0.0, 0.0, 0.0),\n      zoomedOutOceanSpecularIntensity: 0.5,\n      oceanNormalMap: undefined,\n      lightingFadeDistance: new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(6500000.0, 9000000.0),\n      nightFadeDistance: new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(10000000.0, 40000000.0),\n      hsbShift: new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z(),\n\n      center3D: undefined,\n      rtc: new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z(),\n      modifiedModelView: new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z(),\n      tileRectangle: new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(),\n\n      terrainExaggerationAndRelativeHeight: new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(1.0, 0.0),\n\n      dayTextures: [],\n      dayTextureTranslationAndScale: [],\n      dayTextureTexCoordsRectangle: [],\n      dayTextureUseWebMercatorT: [],\n      dayTextureAlpha: [],\n      dayTextureNightAlpha: [],\n      dayTextureDayAlpha: [],\n      dayTextureBrightness: [],\n      dayTextureContrast: [],\n      dayTextureHue: [],\n      dayTextureSaturation: [],\n      dayTextureOneOverGamma: [],\n      dayTextureSplit: [],\n      dayTextureCutoutRectangles: [],\n      dayIntensity: 0.0,\n      colorsToAlpha: [],\n\n      southAndNorthLatitude: new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(),\n      southMercatorYAndOneOverHeight: new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(),\n\n      waterMask: undefined,\n      waterMaskTranslationAndScale: new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(),\n\n      minMaxHeight: new _Core_Cartesian2_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(),\n      scaleAndBias: new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z(),\n      clippingPlanesEdgeColor: _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].clone */ .Z.clone(_Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].WHITE */ .Z.WHITE),\n      clippingPlanesEdgeWidth: 0.0,\n\n      localizedCartographicLimitRectangle: new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(),\n\n      frontFaceAlphaByDistance: new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(),\n      backFaceAlphaByDistance: new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(),\n      localizedTranslucencyRectangle: new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(),\n      undergroundColor: _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].clone */ .Z.clone(_Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].TRANSPARENT */ .Z.TRANSPARENT),\n      undergroundColorAlphaByDistance: new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(),\n    },\n  };\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(globeSurfaceTileProvider.materialUniformMap)) {\n    return (0,_Core_combine_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(uniformMap, globeSurfaceTileProvider.materialUniformMap);\n  }\n\n  return uniformMap;\n}\n\nfunction createWireframeVertexArrayIfNecessary(context, provider, tile) {\n  var surfaceTile = tile.data;\n\n  var mesh;\n  var vertexArray;\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.vertexArray)) {\n    mesh = surfaceTile.mesh;\n    vertexArray = surfaceTile.vertexArray;\n  } else if (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.fill) &&\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.fill.vertexArray)\n  ) {\n    mesh = surfaceTile.fill.mesh;\n    vertexArray = surfaceTile.fill.vertexArray;\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(mesh) || !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(vertexArray)) {\n    return;\n  }\n\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.wireframeVertexArray)) {\n    if (surfaceTile.wireframeVertexArray.mesh === mesh) {\n      return;\n    }\n\n    surfaceTile.wireframeVertexArray.destroy();\n    surfaceTile.wireframeVertexArray = undefined;\n  }\n\n  surfaceTile.wireframeVertexArray = createWireframeVertexArray(\n    context,\n    vertexArray,\n    mesh\n  );\n  surfaceTile.wireframeVertexArray.mesh = mesh;\n}\n\n/**\n * Creates a vertex array for wireframe rendering of a terrain tile.\n *\n * @private\n *\n * @param {Context} context The context in which to create the vertex array.\n * @param {VertexArray} vertexArray The existing, non-wireframe vertex array.  The new vertex array\n *                      will share vertex buffers with this existing one.\n * @param {TerrainMesh} terrainMesh The terrain mesh containing non-wireframe indices.\n * @returns {VertexArray} The vertex array for wireframe rendering.\n */\nfunction createWireframeVertexArray(context, vertexArray, terrainMesh) {\n  var indices = terrainMesh.indices;\n\n  var geometry = {\n    indices: indices,\n    primitiveType: _Core_PrimitiveType_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].TRIANGLES */ .Z.TRIANGLES,\n  };\n\n  _Core_GeometryPipeline_js__WEBPACK_IMPORTED_MODULE_15__/* ["default"].toWireframe */ .Z.toWireframe(geometry);\n\n  var wireframeIndices = geometry.indices;\n  var wireframeIndexBuffer = _Renderer_Buffer_js__WEBPACK_IMPORTED_MODULE_30__/* ["default"].createIndexBuffer */ .Z.createIndexBuffer({\n    context: context,\n    typedArray: wireframeIndices,\n    usage: _Renderer_BufferUsage_js__WEBPACK_IMPORTED_MODULE_31__/* ["default"].STATIC_DRAW */ .Z.STATIC_DRAW,\n    indexDatatype: _Core_IndexDatatype_js__WEBPACK_IMPORTED_MODULE_16__/* ["default"].fromSizeInBytes */ .Z.fromSizeInBytes(\n      wireframeIndices.BYTES_PER_ELEMENT\n    ),\n  });\n  return new _Renderer_VertexArray_js__WEBPACK_IMPORTED_MODULE_36__/* ["default"] */ .Z({\n    context: context,\n    attributes: vertexArray._attributes,\n    indexBuffer: wireframeIndexBuffer,\n  });\n}\n\nvar getDebugOrientedBoundingBox;\nvar getDebugBoundingSphere;\nvar debugDestroyPrimitive;\n\n(function () {\n  var instanceOBB = new _Core_GeometryInstance_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"] */ .Z({\n    geometry: _Core_BoxOutlineGeometry_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"].fromDimensions */ .Z.fromDimensions({\n      dimensions: new _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z(2.0, 2.0, 2.0),\n    }),\n  });\n  var instanceSphere = new _Core_GeometryInstance_js__WEBPACK_IMPORTED_MODULE_14__/* ["default"] */ .Z({\n    geometry: new _Core_SphereOutlineGeometry_js__WEBPACK_IMPORTED_MODULE_25__/* ["default"] */ .Z({ radius: 1.0 }),\n  });\n  var modelMatrix = new _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"] */ .Z();\n  var previousVolume;\n  var primitive;\n\n  function createDebugPrimitive(instance) {\n    return new _Primitive_js__WEBPACK_IMPORTED_MODULE_44__/* ["default"] */ .Z({\n      geometryInstances: instance,\n      appearance: new _PerInstanceColorAppearance_js__WEBPACK_IMPORTED_MODULE_43__/* ["default"] */ .Z({\n        translucent: false,\n        flat: true,\n      }),\n      asynchronous: false,\n    });\n  }\n\n  getDebugOrientedBoundingBox = function (obb, color) {\n    if (obb === previousVolume) {\n      return primitive;\n    }\n    debugDestroyPrimitive();\n\n    previousVolume = obb;\n    modelMatrix = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].fromRotationTranslation */ .Z.fromRotationTranslation(\n      obb.halfAxes,\n      obb.center,\n      modelMatrix\n    );\n\n    instanceOBB.modelMatrix = modelMatrix;\n    instanceOBB.attributes.color = _Core_ColorGeometryInstanceAttribute_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].fromColor */ .Z.fromColor(\n      color\n    );\n\n    primitive = createDebugPrimitive(instanceOBB);\n    return primitive;\n  };\n\n  getDebugBoundingSphere = function (sphere, color) {\n    if (sphere === previousVolume) {\n      return primitive;\n    }\n    debugDestroyPrimitive();\n\n    previousVolume = sphere;\n    modelMatrix = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].fromTranslation */ .Z.fromTranslation(sphere.center, modelMatrix);\n    modelMatrix = _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].multiplyByUniformScale */ .Z.multiplyByUniformScale(\n      modelMatrix,\n      sphere.radius,\n      modelMatrix\n    );\n\n    instanceSphere.modelMatrix = modelMatrix;\n    instanceSphere.attributes.color = _Core_ColorGeometryInstanceAttribute_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].fromColor */ .Z.fromColor(\n      color\n    );\n\n    primitive = createDebugPrimitive(instanceSphere);\n    return primitive;\n  };\n\n  debugDestroyPrimitive = function () {\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(primitive)) {\n      primitive.destroy();\n      primitive = undefined;\n      previousVolume = undefined;\n    }\n  };\n})();\n\nvar otherPassesInitialColor = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(0.0, 0.0, 0.0, 0.0);\nvar surfaceShaderSetOptionsScratch = {\n  frameState: undefined,\n  surfaceTile: undefined,\n  numberOfDayTextures: undefined,\n  applyBrightness: undefined,\n  applyContrast: undefined,\n  applyHue: undefined,\n  applySaturation: undefined,\n  applyGamma: undefined,\n  applyAlpha: undefined,\n  applyDayNightAlpha: undefined,\n  applySplit: undefined,\n  showReflectiveOcean: undefined,\n  showOceanWaves: undefined,\n  enableLighting: undefined,\n  dynamicAtmosphereLighting: undefined,\n  dynamicAtmosphereLightingFromSun: undefined,\n  showGroundAtmosphere: undefined,\n  perFragmentGroundAtmosphere: undefined,\n  hasVertexNormals: undefined,\n  useWebMercatorProjection: undefined,\n  enableFog: undefined,\n  enableClippingPlanes: undefined,\n  clippingPlanes: undefined,\n  clippedByBoundaries: undefined,\n  hasImageryLayerCutout: undefined,\n  colorCorrect: undefined,\n  colorToAlpha: undefined,\n  hasGeodeticSurfaceNormals: undefined,\n  hasExaggeration: undefined,\n};\n\nvar defaultUndergroundColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].TRANSPARENT */ .Z.TRANSPARENT;\nvar defaultundergroundColorAlphaByDistance = new _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_20__/* ["default"] */ .Z();\n\nfunction addDrawCommandsForTile(tileProvider, tile, frameState) {\n  var surfaceTile = tile.data;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.vertexArray)) {\n    if (surfaceTile.fill === undefined) {\n      // No fill was created for this tile, probably because this tile is not connected to\n      // any renderable tiles. So create a simple tile in the middle of the tile\'s possible\n      // height range.\n      surfaceTile.fill = new _TerrainFillMesh_js__WEBPACK_IMPORTED_MODULE_48__/* ["default"] */ .Z(tile);\n    }\n    surfaceTile.fill.update(tileProvider, frameState);\n  }\n\n  var creditDisplay = frameState.creditDisplay;\n\n  var terrainData = surfaceTile.terrainData;\n  if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(terrainData) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(terrainData.credits)) {\n    var tileCredits = terrainData.credits;\n    for (\n      var tileCreditIndex = 0, tileCreditLength = tileCredits.length;\n      tileCreditIndex < tileCreditLength;\n      ++tileCreditIndex\n    ) {\n      creditDisplay.addCredit(tileCredits[tileCreditIndex]);\n    }\n  }\n\n  var maxTextures = _Renderer_ContextLimits_js__WEBPACK_IMPORTED_MODULE_32__/* ["default"].maximumTextureImageUnits */ .Z.maximumTextureImageUnits;\n\n  var waterMaskTexture = surfaceTile.waterMaskTexture;\n  var waterMaskTranslationAndScale = surfaceTile.waterMaskTranslationAndScale;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(waterMaskTexture) && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.fill)) {\n    waterMaskTexture = surfaceTile.fill.waterMaskTexture;\n    waterMaskTranslationAndScale =\n      surfaceTile.fill.waterMaskTranslationAndScale;\n  }\n\n  var cameraUnderground = frameState.cameraUnderground;\n\n  var globeTranslucencyState = frameState.globeTranslucencyState;\n  var translucent = globeTranslucencyState.translucent;\n  var frontFaceAlphaByDistance =\n    globeTranslucencyState.frontFaceAlphaByDistance;\n  var backFaceAlphaByDistance = globeTranslucencyState.backFaceAlphaByDistance;\n  var translucencyRectangle = globeTranslucencyState.rectangle;\n\n  var undergroundColor = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(\n    tileProvider.undergroundColor,\n    defaultUndergroundColor\n  );\n  var undergroundColorAlphaByDistance = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"] */ .Z)(\n    tileProvider.undergroundColorAlphaByDistance,\n    defaultundergroundColorAlphaByDistance\n  );\n  var showUndergroundColor =\n    isUndergroundVisible(tileProvider, frameState) &&\n    frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].SCENE3D */ .Z.SCENE3D &&\n    undergroundColor.alpha > 0.0 &&\n    (undergroundColorAlphaByDistance.nearValue > 0.0 ||\n      undergroundColorAlphaByDistance.farValue > 0.0);\n\n  var showReflectiveOcean =\n    tileProvider.hasWaterMask && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(waterMaskTexture);\n  var oceanNormalMap = tileProvider.oceanNormalMap;\n  var showOceanWaves = showReflectiveOcean && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(oceanNormalMap);\n  var hasVertexNormals =\n    tileProvider.terrainProvider.ready &&\n    tileProvider.terrainProvider.hasVertexNormals;\n  var enableFog = frameState.fog.enabled && !cameraUnderground;\n  var showGroundAtmosphere =\n    tileProvider.showGroundAtmosphere && frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].SCENE3D */ .Z.SCENE3D;\n  var castShadows =\n    _ShadowMode_js__WEBPACK_IMPORTED_MODULE_47__/* ["default"].castShadows */ .Z.castShadows(tileProvider.shadows) && !translucent;\n  var receiveShadows =\n    _ShadowMode_js__WEBPACK_IMPORTED_MODULE_47__/* ["default"].receiveShadows */ .Z.receiveShadows(tileProvider.shadows) && !translucent;\n\n  var hueShift = tileProvider.hueShift;\n  var saturationShift = tileProvider.saturationShift;\n  var brightnessShift = tileProvider.brightnessShift;\n\n  var colorCorrect = !(\n    _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].equalsEpsilon */ .Z.equalsEpsilon(hueShift, 0.0, _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].EPSILON7 */ .Z.EPSILON7) &&\n    _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].equalsEpsilon */ .Z.equalsEpsilon(saturationShift, 0.0, _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].EPSILON7 */ .Z.EPSILON7) &&\n    _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].equalsEpsilon */ .Z.equalsEpsilon(brightnessShift, 0.0, _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].EPSILON7 */ .Z.EPSILON7)\n  );\n\n  var perFragmentGroundAtmosphere = false;\n  if (showGroundAtmosphere) {\n    var cameraDistance = _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].magnitude */ .Z.magnitude(frameState.camera.positionWC);\n    var fadeOutDistance = tileProvider.nightFadeOutDistance;\n    perFragmentGroundAtmosphere = cameraDistance > fadeOutDistance;\n  }\n\n  if (showReflectiveOcean) {\n    --maxTextures;\n  }\n  if (showOceanWaves) {\n    --maxTextures;\n  }\n  if (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(frameState.shadowState) &&\n    frameState.shadowState.shadowsEnabled\n  ) {\n    --maxTextures;\n  }\n  if (\n    (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tileProvider.clippingPlanes) &&\n    tileProvider.clippingPlanes.enabled\n  ) {\n    --maxTextures;\n  }\n\n  maxTextures -= globeTranslucencyState.numberOfTextureUniforms;\n\n  var mesh = surfaceTile.renderedMesh;\n  var rtc = mesh.center;\n  var encoding = mesh.encoding;\n  var tileBoundingRegion = surfaceTile.tileBoundingRegion;\n\n  var exaggeration = frameState.terrainExaggeration;\n  var exaggerationRelativeHeight = frameState.terrainExaggerationRelativeHeight;\n  var hasExaggeration = exaggeration !== 1.0;\n  var hasGeodeticSurfaceNormals = encoding.hasGeodeticSurfaceNormals;\n\n  // Not used in 3D.\n  var tileRectangle = tileRectangleScratch;\n\n  // Only used for Mercator projections.\n  var southLatitude = 0.0;\n  var northLatitude = 0.0;\n  var southMercatorY = 0.0;\n  var oneOverMercatorHeight = 0.0;\n\n  var useWebMercatorProjection = false;\n\n  if (frameState.mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n    var projection = frameState.mapProjection;\n    var southwest = projection.project(\n      _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].southwest */ .Z.southwest(tile.rectangle),\n      southwestScratch\n    );\n    var northeast = projection.project(\n      _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].northeast */ .Z.northeast(tile.rectangle),\n      northeastScratch\n    );\n\n    tileRectangle.x = southwest.x;\n    tileRectangle.y = southwest.y;\n    tileRectangle.z = northeast.x;\n    tileRectangle.w = northeast.y;\n\n    // In 2D and Columbus View, use the center of the tile for RTC rendering.\n    if (frameState.mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].MORPHING */ .Z.MORPHING) {\n      rtc = rtcScratch;\n      rtc.x = 0.0;\n      rtc.y = (tileRectangle.z + tileRectangle.x) * 0.5;\n      rtc.z = (tileRectangle.w + tileRectangle.y) * 0.5;\n      tileRectangle.x -= rtc.y;\n      tileRectangle.y -= rtc.z;\n      tileRectangle.z -= rtc.y;\n      tileRectangle.w -= rtc.z;\n    }\n\n    if (\n      frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].SCENE2D */ .Z.SCENE2D &&\n      encoding.quantization === _Core_TerrainQuantization_js__WEBPACK_IMPORTED_MODULE_27__/* ["default"].BITS12 */ .Z.BITS12\n    ) {\n      // In 2D, the texture coordinates of the tile are interpolated over the rectangle to get the position in the vertex shader.\n      // When the texture coordinates are quantized, error is introduced. This can be seen through the 1px wide cracking\n      // between the quantized tiles in 2D. To compensate for the error, move the expand the rectangle in each direction by\n      // half the error amount.\n      var epsilon = (1.0 / (Math.pow(2.0, 12.0) - 1.0)) * 0.5;\n      var widthEpsilon = (tileRectangle.z - tileRectangle.x) * epsilon;\n      var heightEpsilon = (tileRectangle.w - tileRectangle.y) * epsilon;\n      tileRectangle.x -= widthEpsilon;\n      tileRectangle.y -= heightEpsilon;\n      tileRectangle.z += widthEpsilon;\n      tileRectangle.w += heightEpsilon;\n    }\n\n    if (projection instanceof _Core_WebMercatorProjection_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"] */ .Z) {\n      southLatitude = tile.rectangle.south;\n      northLatitude = tile.rectangle.north;\n\n      southMercatorY = _Core_WebMercatorProjection_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].geodeticLatitudeToMercatorAngle */ .Z.geodeticLatitudeToMercatorAngle(\n        southLatitude\n      );\n\n      oneOverMercatorHeight =\n        1.0 /\n        (_Core_WebMercatorProjection_js__WEBPACK_IMPORTED_MODULE_29__/* ["default"].geodeticLatitudeToMercatorAngle */ .Z.geodeticLatitudeToMercatorAngle(northLatitude) -\n          southMercatorY);\n\n      useWebMercatorProjection = true;\n    }\n  }\n\n  var surfaceShaderSetOptions = surfaceShaderSetOptionsScratch;\n  surfaceShaderSetOptions.frameState = frameState;\n  surfaceShaderSetOptions.surfaceTile = surfaceTile;\n  surfaceShaderSetOptions.showReflectiveOcean = showReflectiveOcean;\n  surfaceShaderSetOptions.showOceanWaves = showOceanWaves;\n  surfaceShaderSetOptions.enableLighting = tileProvider.enableLighting;\n  surfaceShaderSetOptions.dynamicAtmosphereLighting =\n    tileProvider.dynamicAtmosphereLighting;\n  surfaceShaderSetOptions.dynamicAtmosphereLightingFromSun =\n    tileProvider.dynamicAtmosphereLightingFromSun;\n  surfaceShaderSetOptions.showGroundAtmosphere = showGroundAtmosphere;\n  surfaceShaderSetOptions.perFragmentGroundAtmosphere = perFragmentGroundAtmosphere;\n  surfaceShaderSetOptions.hasVertexNormals = hasVertexNormals;\n  surfaceShaderSetOptions.useWebMercatorProjection = useWebMercatorProjection;\n  surfaceShaderSetOptions.clippedByBoundaries = surfaceTile.clippedByBoundaries;\n  surfaceShaderSetOptions.hasGeodeticSurfaceNormals = hasGeodeticSurfaceNormals;\n  surfaceShaderSetOptions.hasExaggeration = hasExaggeration;\n\n  var tileImageryCollection = surfaceTile.imagery;\n  var imageryIndex = 0;\n  var imageryLen = tileImageryCollection.length;\n\n  var showSkirts =\n    tileProvider.showSkirts && !cameraUnderground && !translucent;\n  var backFaceCulling =\n    tileProvider.backFaceCulling && !cameraUnderground && !translucent;\n  var firstPassRenderState = backFaceCulling\n    ? tileProvider._renderState\n    : tileProvider._disableCullingRenderState;\n  var otherPassesRenderState = backFaceCulling\n    ? tileProvider._blendRenderState\n    : tileProvider._disableCullingBlendRenderState;\n  var renderState = firstPassRenderState;\n\n  var initialColor = tileProvider._firstPassInitialColor;\n\n  var context = frameState.context;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tileProvider._debug.boundingSphereTile)) {\n    debugDestroyPrimitive();\n  }\n\n  var materialUniformMapChanged =\n    tileProvider._materialUniformMap !== tileProvider.materialUniformMap;\n  if (materialUniformMapChanged) {\n    tileProvider._materialUniformMap = tileProvider.materialUniformMap;\n    var drawCommandsLength = tileProvider._drawCommands.length;\n    for (var i = 0; i < drawCommandsLength; ++i) {\n      tileProvider._uniformMaps[i] = createTileUniformMap(\n        frameState,\n        tileProvider\n      );\n    }\n  }\n\n  do {\n    var numberOfDayTextures = 0;\n\n    var command;\n    var uniformMap;\n\n    if (tileProvider._drawCommands.length <= tileProvider._usedDrawCommands) {\n      command = new _Renderer_DrawCommand_js__WEBPACK_IMPORTED_MODULE_33__/* ["default"] */ .Z();\n      command.owner = tile;\n      command.cull = false;\n      command.boundingVolume = new _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n      command.orientedBoundingBox = undefined;\n\n      uniformMap = createTileUniformMap(frameState, tileProvider);\n\n      tileProvider._drawCommands.push(command);\n      tileProvider._uniformMaps.push(uniformMap);\n    } else {\n      command = tileProvider._drawCommands[tileProvider._usedDrawCommands];\n      uniformMap = tileProvider._uniformMaps[tileProvider._usedDrawCommands];\n    }\n\n    command.owner = tile;\n\n    ++tileProvider._usedDrawCommands;\n\n    if (tile === tileProvider._debug.boundingSphereTile) {\n      var obb = tileBoundingRegion.boundingVolume;\n      var boundingSphere = tileBoundingRegion.boundingSphere;\n      // If a debug primitive already exists for this tile, it will not be\n      // re-created, to avoid allocation every frame. If it were possible\n      // to have more than one selected tile, this would have to change.\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(obb)) {\n        getDebugOrientedBoundingBox(obb, _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].RED */ .Z.RED).update(frameState);\n      } else if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(boundingSphere)) {\n        getDebugBoundingSphere(boundingSphere, _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].RED */ .Z.RED).update(frameState);\n      }\n    }\n\n    var uniformMapProperties = uniformMap.properties;\n    _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].clone */ .Z.clone(initialColor, uniformMapProperties.initialColor);\n    uniformMapProperties.oceanNormalMap = oceanNormalMap;\n    uniformMapProperties.lightingFadeDistance.x =\n      tileProvider.lightingFadeOutDistance;\n    uniformMapProperties.lightingFadeDistance.y =\n      tileProvider.lightingFadeInDistance;\n    uniformMapProperties.nightFadeDistance.x =\n      tileProvider.nightFadeOutDistance;\n    uniformMapProperties.nightFadeDistance.y = tileProvider.nightFadeInDistance;\n    uniformMapProperties.zoomedOutOceanSpecularIntensity =\n      tileProvider.zoomedOutOceanSpecularIntensity;\n\n    var frontFaceAlphaByDistanceFinal = cameraUnderground\n      ? backFaceAlphaByDistance\n      : frontFaceAlphaByDistance;\n    var backFaceAlphaByDistanceFinal = cameraUnderground\n      ? frontFaceAlphaByDistance\n      : backFaceAlphaByDistance;\n\n    if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(frontFaceAlphaByDistanceFinal)) {\n      _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].fromElements */ .Z.fromElements(\n        frontFaceAlphaByDistanceFinal.near,\n        frontFaceAlphaByDistanceFinal.nearValue,\n        frontFaceAlphaByDistanceFinal.far,\n        frontFaceAlphaByDistanceFinal.farValue,\n        uniformMapProperties.frontFaceAlphaByDistance\n      );\n      _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].fromElements */ .Z.fromElements(\n        backFaceAlphaByDistanceFinal.near,\n        backFaceAlphaByDistanceFinal.nearValue,\n        backFaceAlphaByDistanceFinal.far,\n        backFaceAlphaByDistanceFinal.farValue,\n        uniformMapProperties.backFaceAlphaByDistance\n      );\n    }\n\n    _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].fromElements */ .Z.fromElements(\n      undergroundColorAlphaByDistance.near,\n      undergroundColorAlphaByDistance.nearValue,\n      undergroundColorAlphaByDistance.far,\n      undergroundColorAlphaByDistance.farValue,\n      uniformMapProperties.undergroundColorAlphaByDistance\n    );\n    _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].clone */ .Z.clone(undergroundColor, uniformMapProperties.undergroundColor);\n\n    var highlightFillTile =\n      !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.vertexArray) &&\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tileProvider.fillHighlightColor) &&\n      tileProvider.fillHighlightColor.alpha > 0.0;\n    if (highlightFillTile) {\n      _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].clone */ .Z.clone(\n        tileProvider.fillHighlightColor,\n        uniformMapProperties.fillHighlightColor\n      );\n    }\n\n    uniformMapProperties.terrainExaggerationAndRelativeHeight.x = exaggeration;\n    uniformMapProperties.terrainExaggerationAndRelativeHeight.y = exaggerationRelativeHeight;\n\n    uniformMapProperties.center3D = mesh.center;\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(rtc, uniformMapProperties.rtc);\n\n    _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].clone */ .Z.clone(tileRectangle, uniformMapProperties.tileRectangle);\n    uniformMapProperties.southAndNorthLatitude.x = southLatitude;\n    uniformMapProperties.southAndNorthLatitude.y = northLatitude;\n    uniformMapProperties.southMercatorYAndOneOverHeight.x = southMercatorY;\n    uniformMapProperties.southMercatorYAndOneOverHeight.y = oneOverMercatorHeight;\n\n    // Convert tile limiter rectangle from cartographic to texture space using the tileRectangle.\n    var localizedCartographicLimitRectangle = localizedCartographicLimitRectangleScratch;\n    var cartographicLimitRectangle = clipRectangleAntimeridian(\n      tile.rectangle,\n      tileProvider.cartographicLimitRectangle\n    );\n\n    var localizedTranslucencyRectangle = localizedTranslucencyRectangleScratch;\n    var clippedTranslucencyRectangle = clipRectangleAntimeridian(\n      tile.rectangle,\n      translucencyRectangle\n    );\n\n    _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].fromElements */ .Z.fromElements(\n      hueShift,\n      saturationShift,\n      brightnessShift,\n      uniformMapProperties.hsbShift\n    );\n\n    var cartographicTileRectangle = tile.rectangle;\n    var inverseTileWidth = 1.0 / cartographicTileRectangle.width;\n    var inverseTileHeight = 1.0 / cartographicTileRectangle.height;\n    localizedCartographicLimitRectangle.x =\n      (cartographicLimitRectangle.west - cartographicTileRectangle.west) *\n      inverseTileWidth;\n    localizedCartographicLimitRectangle.y =\n      (cartographicLimitRectangle.south - cartographicTileRectangle.south) *\n      inverseTileHeight;\n    localizedCartographicLimitRectangle.z =\n      (cartographicLimitRectangle.east - cartographicTileRectangle.west) *\n      inverseTileWidth;\n    localizedCartographicLimitRectangle.w =\n      (cartographicLimitRectangle.north - cartographicTileRectangle.south) *\n      inverseTileHeight;\n\n    _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].clone */ .Z.clone(\n      localizedCartographicLimitRectangle,\n      uniformMapProperties.localizedCartographicLimitRectangle\n    );\n\n    localizedTranslucencyRectangle.x =\n      (clippedTranslucencyRectangle.west - cartographicTileRectangle.west) *\n      inverseTileWidth;\n    localizedTranslucencyRectangle.y =\n      (clippedTranslucencyRectangle.south - cartographicTileRectangle.south) *\n      inverseTileHeight;\n    localizedTranslucencyRectangle.z =\n      (clippedTranslucencyRectangle.east - cartographicTileRectangle.west) *\n      inverseTileWidth;\n    localizedTranslucencyRectangle.w =\n      (clippedTranslucencyRectangle.north - cartographicTileRectangle.south) *\n      inverseTileHeight;\n\n    _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].clone */ .Z.clone(\n      localizedTranslucencyRectangle,\n      uniformMapProperties.localizedTranslucencyRectangle\n    );\n\n    // For performance, use fog in the shader only when the tile is in fog.\n    var applyFog =\n      enableFog &&\n      _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].fog */ .Z.fog(tile._distance, frameState.fog.density) >\n        _Core_Math_js__WEBPACK_IMPORTED_MODULE_18__/* ["default"].EPSILON3 */ .Z.EPSILON3;\n    colorCorrect = colorCorrect && (applyFog || showGroundAtmosphere);\n\n    var applyBrightness = false;\n    var applyContrast = false;\n    var applyHue = false;\n    var applySaturation = false;\n    var applyGamma = false;\n    var applyAlpha = false;\n    var applyDayNightAlpha = false;\n    var applySplit = false;\n    var applyCutout = false;\n    var applyColorToAlpha = false;\n\n    while (numberOfDayTextures < maxTextures && imageryIndex < imageryLen) {\n      var tileImagery = tileImageryCollection[imageryIndex];\n      var imagery = tileImagery.readyImagery;\n      ++imageryIndex;\n\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(imagery) || imagery.imageryLayer.alpha === 0.0) {\n        continue;\n      }\n\n      var texture = tileImagery.useWebMercatorT\n        ? imagery.textureWebMercator\n        : imagery.texture;\n\n      //>>includeStart(\'debug\', pragmas.debug);\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(texture)) {\n        // Our "ready" texture isn\'t actually ready.  This should never happen.\n        //\n        // Side note: It IS possible for it to not be in the READY ImageryState, though.\n        // This can happen when a single imagery tile is shared by two terrain tiles (common)\n        // and one of them (A) needs a geographic version of the tile because it is near the poles,\n        // and the other (B) does not.  B can and will transition the imagery tile to the READY state\n        // without reprojecting to geographic.  Then, later, A will deem that same tile not-ready-yet\n        // because it only has the Web Mercator texture, and flip it back to the TRANSITIONING state.\n        // The imagery tile won\'t be in the READY state anymore, but it\'s still READY enough for B\'s\n        // purposes.\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z("readyImagery is not actually ready!");\n      }\n      //>>includeEnd(\'debug\');\n\n      var imageryLayer = imagery.imageryLayer;\n\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(tileImagery.textureTranslationAndScale)) {\n        tileImagery.textureTranslationAndScale = imageryLayer._calculateTextureTranslationAndScale(\n          tile,\n          tileImagery\n        );\n      }\n\n      uniformMapProperties.dayTextures[numberOfDayTextures] = texture;\n      uniformMapProperties.dayTextureTranslationAndScale[numberOfDayTextures] =\n        tileImagery.textureTranslationAndScale;\n      uniformMapProperties.dayTextureTexCoordsRectangle[numberOfDayTextures] =\n        tileImagery.textureCoordinateRectangle;\n      uniformMapProperties.dayTextureUseWebMercatorT[numberOfDayTextures] =\n        tileImagery.useWebMercatorT;\n\n      uniformMapProperties.dayTextureAlpha[numberOfDayTextures] =\n        imageryLayer.alpha;\n      applyAlpha =\n        applyAlpha ||\n        uniformMapProperties.dayTextureAlpha[numberOfDayTextures] !== 1.0;\n\n      uniformMapProperties.dayTextureNightAlpha[numberOfDayTextures] =\n        imageryLayer.nightAlpha;\n      applyDayNightAlpha =\n        applyDayNightAlpha ||\n        uniformMapProperties.dayTextureNightAlpha[numberOfDayTextures] !== 1.0;\n\n      uniformMapProperties.dayTextureDayAlpha[numberOfDayTextures] =\n        imageryLayer.dayAlpha;\n      applyDayNightAlpha =\n        applyDayNightAlpha ||\n        uniformMapProperties.dayTextureDayAlpha[numberOfDayTextures] !== 1.0;\n\n      uniformMapProperties.dayTextureBrightness[numberOfDayTextures] =\n        imageryLayer.brightness;\n      applyBrightness =\n        applyBrightness ||\n        uniformMapProperties.dayTextureBrightness[numberOfDayTextures] !==\n          _ImageryLayer_js__WEBPACK_IMPORTED_MODULE_41__/* ["default"].DEFAULT_BRIGHTNESS */ .Z.DEFAULT_BRIGHTNESS;\n\n      uniformMapProperties.dayTextureContrast[numberOfDayTextures] =\n        imageryLayer.contrast;\n      applyContrast =\n        applyContrast ||\n        uniformMapProperties.dayTextureContrast[numberOfDayTextures] !==\n          _ImageryLayer_js__WEBPACK_IMPORTED_MODULE_41__/* ["default"].DEFAULT_CONTRAST */ .Z.DEFAULT_CONTRAST;\n\n      uniformMapProperties.dayTextureHue[numberOfDayTextures] =\n        imageryLayer.hue;\n      applyHue =\n        applyHue ||\n        uniformMapProperties.dayTextureHue[numberOfDayTextures] !==\n          _ImageryLayer_js__WEBPACK_IMPORTED_MODULE_41__/* ["default"].DEFAULT_HUE */ .Z.DEFAULT_HUE;\n\n      uniformMapProperties.dayTextureSaturation[numberOfDayTextures] =\n        imageryLayer.saturation;\n      applySaturation =\n        applySaturation ||\n        uniformMapProperties.dayTextureSaturation[numberOfDayTextures] !==\n          _ImageryLayer_js__WEBPACK_IMPORTED_MODULE_41__/* ["default"].DEFAULT_SATURATION */ .Z.DEFAULT_SATURATION;\n\n      uniformMapProperties.dayTextureOneOverGamma[numberOfDayTextures] =\n        1.0 / imageryLayer.gamma;\n      applyGamma =\n        applyGamma ||\n        uniformMapProperties.dayTextureOneOverGamma[numberOfDayTextures] !==\n          1.0 / _ImageryLayer_js__WEBPACK_IMPORTED_MODULE_41__/* ["default"].DEFAULT_GAMMA */ .Z.DEFAULT_GAMMA;\n\n      uniformMapProperties.dayTextureSplit[numberOfDayTextures] =\n        imageryLayer.splitDirection;\n      applySplit =\n        applySplit ||\n        uniformMapProperties.dayTextureSplit[numberOfDayTextures] !== 0.0;\n\n      // Update cutout rectangle\n      var dayTextureCutoutRectangle =\n        uniformMapProperties.dayTextureCutoutRectangles[numberOfDayTextures];\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(dayTextureCutoutRectangle)) {\n        dayTextureCutoutRectangle = uniformMapProperties.dayTextureCutoutRectangles[\n          numberOfDayTextures\n        ] = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z();\n      }\n\n      _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].clone */ .Z.clone(_Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].ZERO */ .Z.ZERO, dayTextureCutoutRectangle);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(imageryLayer.cutoutRectangle)) {\n        var cutoutRectangle = clipRectangleAntimeridian(\n          cartographicTileRectangle,\n          imageryLayer.cutoutRectangle\n        );\n        var intersection = _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_24__/* ["default"].simpleIntersection */ .Z.simpleIntersection(\n          cutoutRectangle,\n          cartographicTileRectangle,\n          rectangleIntersectionScratch\n        );\n        applyCutout = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(intersection) || applyCutout;\n\n        dayTextureCutoutRectangle.x =\n          (cutoutRectangle.west - cartographicTileRectangle.west) *\n          inverseTileWidth;\n        dayTextureCutoutRectangle.y =\n          (cutoutRectangle.south - cartographicTileRectangle.south) *\n          inverseTileHeight;\n        dayTextureCutoutRectangle.z =\n          (cutoutRectangle.east - cartographicTileRectangle.west) *\n          inverseTileWidth;\n        dayTextureCutoutRectangle.w =\n          (cutoutRectangle.north - cartographicTileRectangle.south) *\n          inverseTileHeight;\n      }\n\n      // Update color to alpha\n      var colorToAlpha =\n        uniformMapProperties.colorsToAlpha[numberOfDayTextures];\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(colorToAlpha)) {\n        colorToAlpha = uniformMapProperties.colorsToAlpha[\n          numberOfDayTextures\n        ] = new _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z();\n      }\n\n      var hasColorToAlpha =\n        (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(imageryLayer.colorToAlpha) &&\n        imageryLayer.colorToAlphaThreshold > 0.0;\n      applyColorToAlpha = applyColorToAlpha || hasColorToAlpha;\n\n      if (hasColorToAlpha) {\n        var color = imageryLayer.colorToAlpha;\n        colorToAlpha.x = color.red;\n        colorToAlpha.y = color.green;\n        colorToAlpha.z = color.blue;\n        colorToAlpha.w = imageryLayer.colorToAlphaThreshold;\n      } else {\n        colorToAlpha.w = -1.0;\n      }\n\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(imagery.credits)) {\n        var credits = imagery.credits;\n        for (\n          var creditIndex = 0, creditLength = credits.length;\n          creditIndex < creditLength;\n          ++creditIndex\n        ) {\n          creditDisplay.addCredit(credits[creditIndex]);\n        }\n      }\n\n      ++numberOfDayTextures;\n    }\n\n    // trim texture array to the used length so we don\'t end up using old textures\n    // which might get destroyed eventually\n    uniformMapProperties.dayTextures.length = numberOfDayTextures;\n    uniformMapProperties.waterMask = waterMaskTexture;\n    _Core_Cartesian4_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].clone */ .Z.clone(\n      waterMaskTranslationAndScale,\n      uniformMapProperties.waterMaskTranslationAndScale\n    );\n\n    uniformMapProperties.minMaxHeight.x = encoding.minimumHeight;\n    uniformMapProperties.minMaxHeight.y = encoding.maximumHeight;\n    _Core_Matrix4_js__WEBPACK_IMPORTED_MODULE_19__/* ["default"].clone */ .Z.clone(encoding.matrix, uniformMapProperties.scaleAndBias);\n\n    // update clipping planes\n    var clippingPlanes = tileProvider._clippingPlanes;\n    var clippingPlanesEnabled =\n      (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(clippingPlanes) && clippingPlanes.enabled && tile.isClipped;\n    if (clippingPlanesEnabled) {\n      uniformMapProperties.clippingPlanesEdgeColor = _Core_Color_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].clone */ .Z.clone(\n        clippingPlanes.edgeColor,\n        uniformMapProperties.clippingPlanesEdgeColor\n      );\n      uniformMapProperties.clippingPlanesEdgeWidth = clippingPlanes.edgeWidth;\n    }\n\n    surfaceShaderSetOptions.numberOfDayTextures = numberOfDayTextures;\n    surfaceShaderSetOptions.applyBrightness = applyBrightness;\n    surfaceShaderSetOptions.applyContrast = applyContrast;\n    surfaceShaderSetOptions.applyHue = applyHue;\n    surfaceShaderSetOptions.applySaturation = applySaturation;\n    surfaceShaderSetOptions.applyGamma = applyGamma;\n    surfaceShaderSetOptions.applyAlpha = applyAlpha;\n    surfaceShaderSetOptions.applyDayNightAlpha = applyDayNightAlpha;\n    surfaceShaderSetOptions.applySplit = applySplit;\n    surfaceShaderSetOptions.enableFog = applyFog;\n    surfaceShaderSetOptions.enableClippingPlanes = clippingPlanesEnabled;\n    surfaceShaderSetOptions.clippingPlanes = clippingPlanes;\n    surfaceShaderSetOptions.hasImageryLayerCutout = applyCutout;\n    surfaceShaderSetOptions.colorCorrect = colorCorrect;\n    surfaceShaderSetOptions.highlightFillTile = highlightFillTile;\n    surfaceShaderSetOptions.colorToAlpha = applyColorToAlpha;\n    surfaceShaderSetOptions.showUndergroundColor = showUndergroundColor;\n    surfaceShaderSetOptions.translucent = translucent;\n\n    var count = surfaceTile.renderedMesh.indices.length;\n    if (!showSkirts) {\n      count = surfaceTile.renderedMesh.indexCountWithoutSkirts;\n    }\n\n    command.shaderProgram = tileProvider._surfaceShaderSet.getShaderProgram(\n      surfaceShaderSetOptions\n    );\n    command.castShadows = castShadows;\n    command.receiveShadows = receiveShadows;\n    command.renderState = renderState;\n    command.primitiveType = _Core_PrimitiveType_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].TRIANGLES */ .Z.TRIANGLES;\n    command.vertexArray =\n      surfaceTile.vertexArray || surfaceTile.fill.vertexArray;\n    command.count = count;\n    command.uniformMap = uniformMap;\n    command.pass = _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_34__/* ["default"].GLOBE */ .Z.GLOBE;\n\n    if (tileProvider._debug.wireframe) {\n      createWireframeVertexArrayIfNecessary(context, tileProvider, tile);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_52__/* ["default"] */ .Z)(surfaceTile.wireframeVertexArray)) {\n        command.vertexArray = surfaceTile.wireframeVertexArray;\n        command.primitiveType = _Core_PrimitiveType_js__WEBPACK_IMPORTED_MODULE_23__/* ["default"].LINES */ .Z.LINES;\n        command.count = count * 2;\n      }\n    }\n\n    var boundingVolume = command.boundingVolume;\n    var orientedBoundingBox = command.orientedBoundingBox;\n\n    if (frameState.mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].SCENE3D */ .Z.SCENE3D) {\n      _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].fromRectangleWithHeights2D */ .Z.fromRectangleWithHeights2D(\n        tile.rectangle,\n        frameState.mapProjection,\n        tileBoundingRegion.minimumHeight,\n        tileBoundingRegion.maximumHeight,\n        boundingVolume\n      );\n      _Core_Cartesian3_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].fromElements */ .Z.fromElements(\n        boundingVolume.center.z,\n        boundingVolume.center.x,\n        boundingVolume.center.y,\n        boundingVolume.center\n      );\n\n      if (frameState.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_46__/* ["default"].MORPHING */ .Z.MORPHING) {\n        boundingVolume = _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].union */ .Z.union(\n          tileBoundingRegion.boundingSphere,\n          boundingVolume,\n          boundingVolume\n        );\n      }\n    } else {\n      command.boundingVolume = _Core_BoundingSphere_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(\n        tileBoundingRegion.boundingSphere,\n        boundingVolume\n      );\n      command.orientedBoundingBox = _Core_OrientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_21__/* ["default"].clone */ .Z.clone(\n        tileBoundingRegion.boundingVolume,\n        orientedBoundingBox\n      );\n    }\n\n    command.dirty = true;\n\n    if (translucent) {\n      globeTranslucencyState.updateDerivedCommands(command, frameState);\n    }\n\n    pushCommand(command, frameState);\n\n    renderState = otherPassesRenderState;\n    initialColor = otherPassesInitialColor;\n  } while (imageryIndex < imageryLen);\n}\n/* harmony default export */ __webpack_exports__["Z"] = (GlobeSurfaceTileProvider);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNBLE1BQU0sZ0dBQXNCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxvRkFBZ0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsVUFBVSxzRUFBTyxvQkFBb0Isc0VBQU87QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esc0JBQXNCLHNFQUFPO0FBQzdCLFVBQVUsb0ZBQWdCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxvRkFBZ0I7O0FBRTFCLGFBQWEsb0dBQXdCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztB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QUNBO0FBQ0E7QUFDQTs7QUFFQSw4QkFBOEIsaUZBQWtCO0FBQ2hELHlCQUF5QixvRkFBb0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTiwrQkFBK0Isb0ZBQW9CO0FBQ25EO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQywwRkFBeUI7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSx5REFBZSx3QkFBd0IsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3Z1ZTMtd2VicGFjazUvLi9ub2RlX21vZHVsZXMvY2VzaXVtL1NvdXJjZS9TY2VuZS9HbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIuanM/OTFkNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQm91bmRpbmdTcGhlcmUgZnJvbSBcIi4uL0NvcmUvQm91bmRpbmdTcGhlcmUuanNcIjtcbmltcG9ydCBCb3hPdXRsaW5lR2VvbWV0cnkgZnJvbSBcIi4uL0NvcmUvQm94T3V0bGluZUdlb21ldHJ5LmpzXCI7XG5pbXBvcnQgQ2FydGVzaWFuMiBmcm9tIFwiLi4vQ29yZS9DYXJ0ZXNpYW4yLmpzXCI7XG5pbXBvcnQgQ2FydGVzaWFuMyBmcm9tIFwiLi4vQ29yZS9DYXJ0ZXNpYW4zLmpzXCI7XG5pbXBvcnQgQ2FydGVzaWFuNCBmcm9tIFwiLi4vQ29yZS9DYXJ0ZXNpYW40LmpzXCI7XG5pbXBvcnQgQ2FydG9ncmFwaGljIGZyb20gXCIuLi9Db3JlL0NhcnRvZ3JhcGhpYy5qc1wiO1xuaW1wb3J0IGNsb25lIGZyb20gXCIuLi9Db3JlL2Nsb25lLmpzXCI7XG5pbXBvcnQgQ29sb3IgZnJvbSBcIi4uL0NvcmUvQ29sb3IuanNcIjtcbmltcG9ydCBDb2xvckdlb21ldHJ5SW5zdGFuY2VBdHRyaWJ1dGUgZnJvbSBcIi4uL0NvcmUvQ29sb3JHZW9tZXRyeUluc3RhbmNlQXR0cmlidXRlLmpzXCI7XG5pbXBvcnQgY29tYmluZSBmcm9tIFwiLi4vQ29yZS9jb21iaW5lLmpzXCI7XG5pbXBvcnQgZGVmYXVsdFZhbHVlIGZyb20gXCIuLi9Db3JlL2RlZmF1bHRWYWx1ZS5qc1wiO1xuaW1wb3J0IGRlZmluZWQgZnJvbSBcIi4uL0NvcmUvZGVmaW5lZC5qc1wiO1xuaW1wb3J0IGRlc3Ryb3lPYmplY3QgZnJvbSBcIi4uL0NvcmUvZGVzdHJveU9iamVjdC5qc1wiO1xuaW1wb3J0IERldmVsb3BlckVycm9yIGZyb20gXCIuLi9Db3JlL0RldmVsb3BlckVycm9yLmpzXCI7XG5pbXBvcnQgRXZlbnQgZnJvbSBcIi4uL0NvcmUvRXZlbnQuanNcIjtcbmltcG9ydCBHZW9tZXRyeUluc3RhbmNlIGZyb20gXCIuLi9Db3JlL0dlb21ldHJ5SW5zdGFuY2UuanNcIjtcbmltcG9ydCBHZW9tZXRyeVBpcGVsaW5lIGZyb20gXCIuLi9Db3JlL0dlb21ldHJ5UGlwZWxpbmUuanNcIjtcbmltcG9ydCBJbmRleERhdGF0eXBlIGZyb20gXCIuLi9Db3JlL0luZGV4RGF0YXR5cGUuanNcIjtcbmltcG9ydCBJbnRlcnNlY3QgZnJvbSBcIi4uL0NvcmUvSW50ZXJzZWN0LmpzXCI7XG5pbXBvcnQgQ2VzaXVtTWF0aCBmcm9tIFwiLi4vQ29yZS9NYXRoLmpzXCI7XG5pbXBvcnQgTWF0cml4NCBmcm9tIFwiLi4vQ29yZS9NYXRyaXg0LmpzXCI7XG5pbXBvcnQgTmVhckZhclNjYWxhciBmcm9tIFwiLi4vQ29yZS9OZWFyRmFyU2NhbGFyLmpzXCI7XG5pbXBvcnQgT3JpZW50ZWRCb3VuZGluZ0JveCBmcm9tIFwiLi4vQ29yZS9PcmllbnRlZEJvdW5kaW5nQm94LmpzXCI7XG5pbXBvcnQgT3J0aG9ncmFwaGljRnJ1c3R1bSBmcm9tIFwiLi4vQ29yZS9PcnRob2dyYXBoaWNGcnVzdHVtLmpzXCI7XG5pbXBvcnQgUHJpbWl0aXZlVHlwZSBmcm9tIFwiLi4vQ29yZS9QcmltaXRpdmVUeXBlLmpzXCI7XG5pbXBvcnQgUmVjdGFuZ2xlIGZyb20gXCIuLi9Db3JlL1JlY3RhbmdsZS5qc1wiO1xuaW1wb3J0IFNwaGVyZU91dGxpbmVHZW9tZXRyeSBmcm9tIFwiLi4vQ29yZS9TcGhlcmVPdXRsaW5lR2VvbWV0cnkuanNcIjtcbmltcG9ydCBUZXJyYWluRXhhZ2dlcmF0aW9uIGZyb20gXCIuLi9Db3JlL1RlcnJhaW5FeGFnZ2VyYXRpb24uanNcIjtcbmltcG9ydCBUZXJyYWluUXVhbnRpemF0aW9uIGZyb20gXCIuLi9Db3JlL1RlcnJhaW5RdWFudGl6YXRpb24uanNcIjtcbmltcG9ydCBWaXNpYmlsaXR5IGZyb20gXCIuLi9Db3JlL1Zpc2liaWxpdHkuanNcIjtcbmltcG9ydCBXZWJNZXJjYXRvclByb2plY3Rpb24gZnJvbSBcIi4uL0NvcmUvV2ViTWVyY2F0b3JQcm9qZWN0aW9uLmpzXCI7XG5pbXBvcnQgQnVmZmVyIGZyb20gXCIuLi9SZW5kZXJlci9CdWZmZXIuanNcIjtcbmltcG9ydCBCdWZmZXJVc2FnZSBmcm9tIFwiLi4vUmVuZGVyZXIvQnVmZmVyVXNhZ2UuanNcIjtcbmltcG9ydCBDb250ZXh0TGltaXRzIGZyb20gXCIuLi9SZW5kZXJlci9Db250ZXh0TGltaXRzLmpzXCI7XG5pbXBvcnQgRHJhd0NvbW1hbmQgZnJvbSBcIi4uL1JlbmRlcmVyL0RyYXdDb21tYW5kLmpzXCI7XG5pbXBvcnQgUGFzcyBmcm9tIFwiLi4vUmVuZGVyZXIvUGFzcy5qc1wiO1xuaW1wb3J0IFJlbmRlclN0YXRlIGZyb20gXCIuLi9SZW5kZXJlci9SZW5kZXJTdGF0ZS5qc1wiO1xuaW1wb3J0IFZlcnRleEFycmF5IGZyb20gXCIuLi9SZW5kZXJlci9WZXJ0ZXhBcnJheS5qc1wiO1xuaW1wb3J0IEJsZW5kaW5nU3RhdGUgZnJvbSBcIi4vQmxlbmRpbmdTdGF0ZS5qc1wiO1xuaW1wb3J0IENsaXBwaW5nUGxhbmVDb2xsZWN0aW9uIGZyb20gXCIuL0NsaXBwaW5nUGxhbmVDb2xsZWN0aW9uLmpzXCI7XG5pbXBvcnQgRGVwdGhGdW5jdGlvbiBmcm9tIFwiLi9EZXB0aEZ1bmN0aW9uLmpzXCI7XG5pbXBvcnQgR2xvYmVTdXJmYWNlVGlsZSBmcm9tIFwiLi9HbG9iZVN1cmZhY2VUaWxlLmpzXCI7XG5pbXBvcnQgSW1hZ2VyeUxheWVyIGZyb20gXCIuL0ltYWdlcnlMYXllci5qc1wiO1xuaW1wb3J0IEltYWdlcnlTdGF0ZSBmcm9tIFwiLi9JbWFnZXJ5U3RhdGUuanNcIjtcbmltcG9ydCBQZXJJbnN0YW5jZUNvbG9yQXBwZWFyYW5jZSBmcm9tIFwiLi9QZXJJbnN0YW5jZUNvbG9yQXBwZWFyYW5jZS5qc1wiO1xuaW1wb3J0IFByaW1pdGl2ZSBmcm9tIFwiLi9QcmltaXRpdmUuanNcIjtcbmltcG9ydCBRdWFkdHJlZVRpbGVMb2FkU3RhdGUgZnJvbSBcIi4vUXVhZHRyZWVUaWxlTG9hZFN0YXRlLmpzXCI7XG5pbXBvcnQgU2NlbmVNb2RlIGZyb20gXCIuL1NjZW5lTW9kZS5qc1wiO1xuaW1wb3J0IFNoYWRvd01vZGUgZnJvbSBcIi4vU2hhZG93TW9kZS5qc1wiO1xuaW1wb3J0IFRlcnJhaW5GaWxsTWVzaCBmcm9tIFwiLi9UZXJyYWluRmlsbE1lc2guanNcIjtcbmltcG9ydCBUZXJyYWluU3RhdGUgZnJvbSBcIi4vVGVycmFpblN0YXRlLmpzXCI7XG5pbXBvcnQgVGlsZUJvdW5kaW5nUmVnaW9uIGZyb20gXCIuL1RpbGVCb3VuZGluZ1JlZ2lvbi5qc1wiO1xuaW1wb3J0IFRpbGVTZWxlY3Rpb25SZXN1bHQgZnJvbSBcIi4vVGlsZVNlbGVjdGlvblJlc3VsdC5qc1wiO1xuXG4vKipcbiAqIFByb3ZpZGVzIHF1YWR0cmVlIHRpbGVzIHJlcHJlc2VudGluZyB0aGUgc3VyZmFjZSBvZiB0aGUgZ2xvYmUuICBUaGlzIHR5cGUgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZFxuICogd2l0aCB7QGxpbmsgUXVhZHRyZWVQcmltaXRpdmV9LlxuICpcbiAqIEBhbGlhcyBHbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXJcbiAqIEBjb25zdHJ1Y3RvclxuICpcbiAqIEBwYXJhbSB7VGVycmFpblByb3ZpZGVyfSBvcHRpb25zLnRlcnJhaW5Qcm92aWRlciBUaGUgdGVycmFpbiBwcm92aWRlciB0aGF0IGRlc2NyaWJlcyB0aGUgc3VyZmFjZSBnZW9tZXRyeS5cbiAqIEBwYXJhbSB7SW1hZ2VyeUxheWVyQ29sbGVjdGlvbn0gb3B0aW9uLmltYWdlcnlMYXllcnMgVGhlIGNvbGxlY3Rpb24gb2YgaW1hZ2VyeSBsYXllcnMgZGVzY3JpYmluZyB0aGUgc2hhZGluZyBvZiB0aGUgc3VyZmFjZS5cbiAqIEBwYXJhbSB7R2xvYmVTdXJmYWNlU2hhZGVyU2V0fSBvcHRpb25zLnN1cmZhY2VTaGFkZXJTZXQgVGhlIHNldCBvZiBzaGFkZXJzIHVzZWQgdG8gcmVuZGVyIHRoZSBzdXJmYWNlLlxuICpcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlcihvcHRpb25zKSB7XG4gIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gIGlmICghZGVmaW5lZChvcHRpb25zKSkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcIm9wdGlvbnMgaXMgcmVxdWlyZWQuXCIpO1xuICB9XG4gIGlmICghZGVmaW5lZChvcHRpb25zLnRlcnJhaW5Qcm92aWRlcikpIHtcbiAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXCJvcHRpb25zLnRlcnJhaW5Qcm92aWRlciBpcyByZXF1aXJlZC5cIik7XG4gIH0gZWxzZSBpZiAoIWRlZmluZWQob3B0aW9ucy5pbWFnZXJ5TGF5ZXJzKSkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcIm9wdGlvbnMuaW1hZ2VyeUxheWVycyBpcyByZXF1aXJlZC5cIik7XG4gIH0gZWxzZSBpZiAoIWRlZmluZWQob3B0aW9ucy5zdXJmYWNlU2hhZGVyU2V0KSkge1xuICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcIm9wdGlvbnMuc3VyZmFjZVNoYWRlclNldCBpcyByZXF1aXJlZC5cIik7XG4gIH1cbiAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgdGhpcy5saWdodGluZ0ZhZGVPdXREaXN0YW5jZSA9IDY1MDAwMDAuMDtcbiAgdGhpcy5saWdodGluZ0ZhZGVJbkRpc3RhbmNlID0gOTAwMDAwMC4wO1xuICB0aGlzLmhhc1dhdGVyTWFzayA9IGZhbHNlO1xuICB0aGlzLm9jZWFuTm9ybWFsTWFwID0gdW5kZWZpbmVkO1xuICB0aGlzLnpvb21lZE91dE9jZWFuU3BlY3VsYXJJbnRlbnNpdHkgPSAwLjU7XG4gIHRoaXMuZW5hYmxlTGlnaHRpbmcgPSBmYWxzZTtcbiAgdGhpcy5keW5hbWljQXRtb3NwaGVyZUxpZ2h0aW5nID0gZmFsc2U7XG4gIHRoaXMuZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZ0Zyb21TdW4gPSBmYWxzZTtcbiAgdGhpcy5zaG93R3JvdW5kQXRtb3NwaGVyZSA9IGZhbHNlO1xuICB0aGlzLnNoYWRvd3MgPSBTaGFkb3dNb2RlLlJFQ0VJVkVfT05MWTtcblxuICAvKipcbiAgICogVGhlIGNvbG9yIHRvIHVzZSB0byBoaWdobGlnaHQgdGVycmFpbiBmaWxsIHRpbGVzLiBJZiB1bmRlZmluZWQsIGZpbGwgdGlsZXMgYXJlIG5vdFxuICAgKiBoaWdobGlnaHRlZCBhdCBhbGwuIFRoZSBhbHBoYSB2YWx1ZSBpcyB1c2VkIHRvIGFscGhhIGJsZW5kIHdpdGggdGhlIHRpbGUnc1xuICAgKiBhY3R1YWwgY29sb3IuIEJlY2F1c2UgdGVycmFpbiBmaWxsIHRpbGVzIGRvIG5vdCByZXByZXNlbnQgdGhlIGFjdHVhbCB0ZXJyYWluIHN1cmZhY2UsXG4gICAqIGl0IG1heSBiZSB1c2VmdWwgaW4gc29tZSBhcHBsaWNhdGlvbnMgdG8gaW5kaWNhdGUgdmlzdWFsbHkgdGhhdCB0aGV5IGFyZSBub3QgdG8gYmUgdHJ1c3RlZC5cbiAgICogQHR5cGUge0NvbG9yfVxuICAgKiBAZGVmYXVsdCB1bmRlZmluZWRcbiAgICovXG4gIHRoaXMuZmlsbEhpZ2hsaWdodENvbG9yID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMuaHVlU2hpZnQgPSAwLjA7XG4gIHRoaXMuc2F0dXJhdGlvblNoaWZ0ID0gMC4wO1xuICB0aGlzLmJyaWdodG5lc3NTaGlmdCA9IDAuMDtcblxuICB0aGlzLnNob3dTa2lydHMgPSB0cnVlO1xuICB0aGlzLmJhY2tGYWNlQ3VsbGluZyA9IHRydWU7XG4gIHRoaXMudW5kZXJncm91bmRDb2xvciA9IHVuZGVmaW5lZDtcbiAgdGhpcy51bmRlcmdyb3VuZENvbG9yQWxwaGFCeURpc3RhbmNlID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMubWF0ZXJpYWxVbmlmb3JtTWFwID0gdW5kZWZpbmVkO1xuICB0aGlzLl9tYXRlcmlhbFVuaWZvcm1NYXAgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fcXVhZHRyZWUgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX3RlcnJhaW5Qcm92aWRlciA9IG9wdGlvbnMudGVycmFpblByb3ZpZGVyO1xuICB0aGlzLl9pbWFnZXJ5TGF5ZXJzID0gb3B0aW9ucy5pbWFnZXJ5TGF5ZXJzO1xuICB0aGlzLl9zdXJmYWNlU2hhZGVyU2V0ID0gb3B0aW9ucy5zdXJmYWNlU2hhZGVyU2V0O1xuXG4gIHRoaXMuX3JlbmRlclN0YXRlID0gdW5kZWZpbmVkO1xuICB0aGlzLl9ibGVuZFJlbmRlclN0YXRlID0gdW5kZWZpbmVkO1xuICB0aGlzLl9kaXNhYmxlQ3VsbGluZ1JlbmRlclN0YXRlID0gdW5kZWZpbmVkO1xuICB0aGlzLl9kaXNhYmxlQ3VsbGluZ0JsZW5kUmVuZGVyU3RhdGUgPSB1bmRlZmluZWQ7XG5cbiAgdGhpcy5fZXJyb3JFdmVudCA9IG5ldyBFdmVudCgpO1xuXG4gIHRoaXMuX2ltYWdlcnlMYXllcnMubGF5ZXJBZGRlZC5hZGRFdmVudExpc3RlbmVyKFxuICAgIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGUuX29uTGF5ZXJBZGRlZCxcbiAgICB0aGlzXG4gICk7XG4gIHRoaXMuX2ltYWdlcnlMYXllcnMubGF5ZXJSZW1vdmVkLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgR2xvYmVTdXJmYWNlVGlsZVByb3ZpZGVyLnByb3RvdHlwZS5fb25MYXllclJlbW92ZWQsXG4gICAgdGhpc1xuICApO1xuICB0aGlzLl9pbWFnZXJ5TGF5ZXJzLmxheWVyTW92ZWQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICBHbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlLl9vbkxheWVyTW92ZWQsXG4gICAgdGhpc1xuICApO1xuICB0aGlzLl9pbWFnZXJ5TGF5ZXJzLmxheWVyU2hvd25PckhpZGRlbi5hZGRFdmVudExpc3RlbmVyKFxuICAgIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGUuX29uTGF5ZXJTaG93bk9ySGlkZGVuLFxuICAgIHRoaXNcbiAgKTtcbiAgdGhpcy5faW1hZ2VyeUxheWVyc1VwZGF0ZWRFdmVudCA9IG5ldyBFdmVudCgpO1xuXG4gIHRoaXMuX2xheWVyT3JkZXJDaGFuZ2VkID0gZmFsc2U7XG5cbiAgdGhpcy5fdGlsZXNUb1JlbmRlckJ5VGV4dHVyZUNvdW50ID0gW107XG4gIHRoaXMuX2RyYXdDb21tYW5kcyA9IFtdO1xuICB0aGlzLl91bmlmb3JtTWFwcyA9IFtdO1xuICB0aGlzLl91c2VkRHJhd0NvbW1hbmRzID0gMDtcblxuICB0aGlzLl92ZXJ0ZXhBcnJheXNUb0Rlc3Ryb3kgPSBbXTtcblxuICB0aGlzLl9kZWJ1ZyA9IHtcbiAgICB3aXJlZnJhbWU6IGZhbHNlLFxuICAgIGJvdW5kaW5nU3BoZXJlVGlsZTogdW5kZWZpbmVkLFxuICB9O1xuXG4gIHRoaXMuX2Jhc2VDb2xvciA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fZmlyc3RQYXNzSW5pdGlhbENvbG9yID0gdW5kZWZpbmVkO1xuICB0aGlzLmJhc2VDb2xvciA9IG5ldyBDb2xvcigwLjAsIDAuMCwgMC41LCAxLjApO1xuXG4gIC8qKlxuICAgKiBBIHByb3BlcnR5IHNwZWNpZnlpbmcgYSB7QGxpbmsgQ2xpcHBpbmdQbGFuZUNvbGxlY3Rpb259IHVzZWQgdG8gc2VsZWN0aXZlbHkgZGlzYWJsZSByZW5kZXJpbmcgb24gdGhlIG91dHNpZGUgb2YgZWFjaCBwbGFuZS5cbiAgICogQHR5cGUge0NsaXBwaW5nUGxhbmVDb2xsZWN0aW9ufVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5fY2xpcHBpbmdQbGFuZXMgPSB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIEEgcHJvcGVydHkgc3BlY2lmeWluZyBhIHtAbGluayBSZWN0YW5nbGV9IHVzZWQgdG8gc2VsZWN0aXZlbHkgbGltaXQgdGVycmFpbiBhbmQgaW1hZ2VyeSByZW5kZXJpbmcuXG4gICAqIEB0eXBlIHtSZWN0YW5nbGV9XG4gICAqL1xuICB0aGlzLmNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlID0gUmVjdGFuZ2xlLmNsb25lKFJlY3RhbmdsZS5NQVhfVkFMVUUpO1xuXG4gIHRoaXMuX2hhc0xvYWRlZFRpbGVzVGhpc0ZyYW1lID0gZmFsc2U7XG4gIHRoaXMuX2hhc0ZpbGxUaWxlc1RoaXNGcmFtZSA9IGZhbHNlO1xuXG4gIHRoaXMuX29sZFRlcnJhaW5FeGFnZ2VyYXRpb24gPSB1bmRlZmluZWQ7XG4gIHRoaXMuX29sZFRlcnJhaW5FeGFnZ2VyYXRpb25SZWxhdGl2ZUhlaWdodCA9IHVuZGVmaW5lZDtcbn1cblxuT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoR2xvYmVTdXJmYWNlVGlsZVByb3ZpZGVyLnByb3RvdHlwZSwge1xuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSBjb2xvciBvZiB0aGUgZ2xvYmUgd2hlbiBubyBpbWFnZXJ5IGlzIGF2YWlsYWJsZS5cbiAgICogQG1lbWJlcm9mIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGVcbiAgICogQHR5cGUge0NvbG9yfVxuICAgKi9cbiAgYmFzZUNvbG9yOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYmFzZUNvbG9yO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBpZiAoIWRlZmluZWQodmFsdWUpKSB7XG4gICAgICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcInZhbHVlIGlzIHJlcXVpcmVkLlwiKTtcbiAgICAgIH1cbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgICB0aGlzLl9iYXNlQ29sb3IgPSB2YWx1ZTtcbiAgICAgIHRoaXMuX2ZpcnN0UGFzc0luaXRpYWxDb2xvciA9IENhcnRlc2lhbjQuZnJvbUNvbG9yKFxuICAgICAgICB2YWx1ZSxcbiAgICAgICAgdGhpcy5fZmlyc3RQYXNzSW5pdGlhbENvbG9yXG4gICAgICApO1xuICAgIH0sXG4gIH0sXG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgdGhlIHtAbGluayBRdWFkdHJlZVByaW1pdGl2ZX0gZm9yIHdoaWNoIHRoaXMgcHJvdmlkZXIgaXNcbiAgICogcHJvdmlkaW5nIHRpbGVzLiAgVGhpcyBwcm9wZXJ0eSBtYXkgYmUgdW5kZWZpbmVkIGlmIHRoZSBwcm92aWRlciBpcyBub3QgeWV0IGFzc29jaWF0ZWRcbiAgICogd2l0aCBhIHtAbGluayBRdWFkdHJlZVByaW1pdGl2ZX0uXG4gICAqIEBtZW1iZXJvZiBHbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlXG4gICAqIEB0eXBlIHtRdWFkdHJlZVByaW1pdGl2ZX1cbiAgICovXG4gIHF1YWR0cmVlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcXVhZHRyZWU7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICAgIGlmICghZGVmaW5lZCh2YWx1ZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwidmFsdWUgaXMgcmVxdWlyZWQuXCIpO1xuICAgICAgfVxuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIHRoaXMuX3F1YWR0cmVlID0gdmFsdWU7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBhIHZhbHVlIGluZGljYXRpbmcgd2hldGhlciBvciBub3QgdGhlIHByb3ZpZGVyIGlzIHJlYWR5IGZvciB1c2UuXG4gICAqIEBtZW1iZXJvZiBHbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKi9cbiAgcmVhZHk6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIHRoaXMuX3RlcnJhaW5Qcm92aWRlci5yZWFkeSAmJlxuICAgICAgICAodGhpcy5faW1hZ2VyeUxheWVycy5sZW5ndGggPT09IDAgfHxcbiAgICAgICAgICB0aGlzLl9pbWFnZXJ5TGF5ZXJzLmdldCgwKS5pbWFnZXJ5UHJvdmlkZXIucmVhZHkpXG4gICAgICApO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHRpbGluZyBzY2hlbWUgdXNlZCBieSB0aGUgcHJvdmlkZXIuICBUaGlzIHByb3BlcnR5IHNob3VsZFxuICAgKiBub3QgYmUgYWNjZXNzZWQgYmVmb3JlIHtAbGluayBHbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIjcmVhZHl9IHJldHVybnMgdHJ1ZS5cbiAgICogQG1lbWJlcm9mIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGVcbiAgICogQHR5cGUge1RpbGluZ1NjaGVtZX1cbiAgICovXG4gIHRpbGluZ1NjaGVtZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3RlcnJhaW5Qcm92aWRlci50aWxpbmdTY2hlbWU7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBhbiBldmVudCB0aGF0IGlzIHJhaXNlZCB3aGVuIHRoZSBnZW9tZXRyeSBwcm92aWRlciBlbmNvdW50ZXJzIGFuIGFzeW5jaHJvbm91cyBlcnJvci4gIEJ5IHN1YnNjcmliaW5nXG4gICAqIHRvIHRoZSBldmVudCwgeW91IHdpbGwgYmUgbm90aWZpZWQgb2YgdGhlIGVycm9yIGFuZCBjYW4gcG90ZW50aWFsbHkgcmVjb3ZlciBmcm9tIGl0LiAgRXZlbnQgbGlzdGVuZXJzXG4gICAqIGFyZSBwYXNzZWQgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIFRpbGVQcm92aWRlckVycm9yfS5cbiAgICogQG1lbWJlcm9mIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGVcbiAgICogQHR5cGUge0V2ZW50fVxuICAgKi9cbiAgZXJyb3JFdmVudDoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2Vycm9yRXZlbnQ7XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBhbiBldmVudCB0aGF0IGlzIHJhaXNlZCB3aGVuIGFuIGltYWdlcnkgbGF5ZXIgaXMgYWRkZWQsIHNob3duLCBoaWRkZW4sIG1vdmVkLCBvciByZW1vdmVkLlxuICAgKiBAbWVtYmVyb2YgR2xvYmVTdXJmYWNlVGlsZVByb3ZpZGVyLnByb3RvdHlwZVxuICAgKiBAdHlwZSB7RXZlbnR9XG4gICAqL1xuICBpbWFnZXJ5TGF5ZXJzVXBkYXRlZEV2ZW50OiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5faW1hZ2VyeUxheWVyc1VwZGF0ZWRFdmVudDtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgdGhlIHRlcnJhaW4gcHJvdmlkZXIgdGhhdCBkZXNjcmliZXMgdGhlIHN1cmZhY2UgZ2VvbWV0cnkuXG4gICAqIEBtZW1iZXJvZiBHbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlXG4gICAqIEB0eXBlIHtUZXJyYWluUHJvdmlkZXJ9XG4gICAqL1xuICB0ZXJyYWluUHJvdmlkZXI6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl90ZXJyYWluUHJvdmlkZXI7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh0ZXJyYWluUHJvdmlkZXIpIHtcbiAgICAgIGlmICh0aGlzLl90ZXJyYWluUHJvdmlkZXIgPT09IHRlcnJhaW5Qcm92aWRlcikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vPj5pbmNsdWRlU3RhcnQoJ2RlYnVnJywgcHJhZ21hcy5kZWJ1Zyk7XG4gICAgICBpZiAoIWRlZmluZWQodGVycmFpblByb3ZpZGVyKSkge1xuICAgICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXCJ0ZXJyYWluUHJvdmlkZXIgaXMgcmVxdWlyZWQuXCIpO1xuICAgICAgfVxuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG5cbiAgICAgIHRoaXMuX3RlcnJhaW5Qcm92aWRlciA9IHRlcnJhaW5Qcm92aWRlcjtcblxuICAgICAgaWYgKGRlZmluZWQodGhpcy5fcXVhZHRyZWUpKSB7XG4gICAgICAgIHRoaXMuX3F1YWR0cmVlLmludmFsaWRhdGVBbGxUaWxlcygpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG4gIC8qKlxuICAgKiBUaGUge0BsaW5rIENsaXBwaW5nUGxhbmVDb2xsZWN0aW9ufSB1c2VkIHRvIHNlbGVjdGl2ZWx5IGRpc2FibGUgcmVuZGVyaW5nIHRoZSB0aWxlc2V0LlxuICAgKlxuICAgKiBAdHlwZSB7Q2xpcHBpbmdQbGFuZUNvbGxlY3Rpb259XG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBjbGlwcGluZ1BsYW5lczoge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NsaXBwaW5nUGxhbmVzO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIENsaXBwaW5nUGxhbmVDb2xsZWN0aW9uLnNldE93bmVyKHZhbHVlLCB0aGlzLCBcIl9jbGlwcGluZ1BsYW5lc1wiKTtcbiAgICB9LFxuICB9LFxufSk7XG5cbmZ1bmN0aW9uIHNvcnRUaWxlSW1hZ2VyeUJ5TGF5ZXJJbmRleChhLCBiKSB7XG4gIHZhciBhSW1hZ2VyeSA9IGEubG9hZGluZ0ltYWdlcnk7XG4gIGlmICghZGVmaW5lZChhSW1hZ2VyeSkpIHtcbiAgICBhSW1hZ2VyeSA9IGEucmVhZHlJbWFnZXJ5O1xuICB9XG5cbiAgdmFyIGJJbWFnZXJ5ID0gYi5sb2FkaW5nSW1hZ2VyeTtcbiAgaWYgKCFkZWZpbmVkKGJJbWFnZXJ5KSkge1xuICAgIGJJbWFnZXJ5ID0gYi5yZWFkeUltYWdlcnk7XG4gIH1cblxuICByZXR1cm4gYUltYWdlcnkuaW1hZ2VyeUxheWVyLl9sYXllckluZGV4IC0gYkltYWdlcnkuaW1hZ2VyeUxheWVyLl9sYXllckluZGV4O1xufVxuXG4vKipcbiAqIE1ha2UgdXBkYXRlcyB0byB0aGUgdGlsZSBwcm92aWRlciB0aGF0IGFyZSBub3QgaW52b2x2ZWQgaW4gcmVuZGVyaW5nLiBDYWxsZWQgYmVmb3JlIHRoZSByZW5kZXIgdXBkYXRlIGN5Y2xlLlxuICovXG5HbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChmcmFtZVN0YXRlKSB7XG4gIC8vIHVwZGF0ZSBjb2xsZWN0aW9uOiBpbWFnZXJ5IGluZGljZXMsIGJhc2UgbGF5ZXJzLCByYWlzZSBsYXllciBzaG93L2hpZGUgZXZlbnRcbiAgdGhpcy5faW1hZ2VyeUxheWVycy5fdXBkYXRlKCk7XG59O1xuXG5mdW5jdGlvbiB1cGRhdGVDcmVkaXRzKHN1cmZhY2UsIGZyYW1lU3RhdGUpIHtcbiAgdmFyIGNyZWRpdERpc3BsYXkgPSBmcmFtZVN0YXRlLmNyZWRpdERpc3BsYXk7XG4gIGlmIChcbiAgICBzdXJmYWNlLl90ZXJyYWluUHJvdmlkZXIucmVhZHkgJiZcbiAgICBkZWZpbmVkKHN1cmZhY2UuX3RlcnJhaW5Qcm92aWRlci5jcmVkaXQpXG4gICkge1xuICAgIGNyZWRpdERpc3BsYXkuYWRkQ3JlZGl0KHN1cmZhY2UuX3RlcnJhaW5Qcm92aWRlci5jcmVkaXQpO1xuICB9XG5cbiAgdmFyIGltYWdlcnlMYXllcnMgPSBzdXJmYWNlLl9pbWFnZXJ5TGF5ZXJzO1xuICBmb3IgKHZhciBpID0gMCwgbGVuID0gaW1hZ2VyeUxheWVycy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgIHZhciBpbWFnZXJ5UHJvdmlkZXIgPSBpbWFnZXJ5TGF5ZXJzLmdldChpKS5pbWFnZXJ5UHJvdmlkZXI7XG4gICAgaWYgKGltYWdlcnlQcm92aWRlci5yZWFkeSAmJiBkZWZpbmVkKGltYWdlcnlQcm92aWRlci5jcmVkaXQpKSB7XG4gICAgICBjcmVkaXREaXNwbGF5LmFkZENyZWRpdChpbWFnZXJ5UHJvdmlkZXIuY3JlZGl0KTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBDYWxsZWQgYXQgdGhlIGJlZ2lubmluZyBvZiBlYWNoIHJlbmRlciBmcmFtZSwgYmVmb3JlIHtAbGluayBRdWFkdHJlZVRpbGVQcm92aWRlciNzaG93VGlsZVRoaXNGcmFtZX1cbiAqIEBwYXJhbSB7RnJhbWVTdGF0ZX0gZnJhbWVTdGF0ZSBUaGUgZnJhbWUgc3RhdGUuXG4gKi9cbkdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChmcmFtZVN0YXRlKSB7XG4gIC8vIHVwZGF0ZSBlYWNoIGxheWVyIGZvciB0ZXh0dXJlIHJlcHJvamVjdGlvbi5cbiAgdGhpcy5faW1hZ2VyeUxheWVycy5xdWV1ZVJlcHJvamVjdGlvbkNvbW1hbmRzKGZyYW1lU3RhdGUpO1xuXG4gIGlmICh0aGlzLl9sYXllck9yZGVyQ2hhbmdlZCkge1xuICAgIHRoaXMuX2xheWVyT3JkZXJDaGFuZ2VkID0gZmFsc2U7XG5cbiAgICAvLyBTb3J0IHRoZSBUaWxlSW1hZ2VyeSBpbnN0YW5jZXMgaW4gZWFjaCB0aWxlIGJ5IHRoZSBsYXllciBpbmRleC5cbiAgICB0aGlzLl9xdWFkdHJlZS5mb3JFYWNoTG9hZGVkVGlsZShmdW5jdGlvbiAodGlsZSkge1xuICAgICAgdGlsZS5kYXRhLmltYWdlcnkuc29ydChzb3J0VGlsZUltYWdlcnlCeUxheWVySW5kZXgpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQWRkIGNyZWRpdHMgZm9yIHRlcnJhaW4gYW5kIGltYWdlcnkgcHJvdmlkZXJzLlxuICB1cGRhdGVDcmVkaXRzKHRoaXMsIGZyYW1lU3RhdGUpO1xuXG4gIHZhciB2ZXJ0ZXhBcnJheXNUb0Rlc3Ryb3kgPSB0aGlzLl92ZXJ0ZXhBcnJheXNUb0Rlc3Ryb3k7XG4gIHZhciBsZW5ndGggPSB2ZXJ0ZXhBcnJheXNUb0Rlc3Ryb3kubGVuZ3RoO1xuICBmb3IgKHZhciBqID0gMDsgaiA8IGxlbmd0aDsgKytqKSB7XG4gICAgR2xvYmVTdXJmYWNlVGlsZS5fZnJlZVZlcnRleEFycmF5KHZlcnRleEFycmF5c1RvRGVzdHJveVtqXSk7XG4gIH1cbiAgdmVydGV4QXJyYXlzVG9EZXN0cm95Lmxlbmd0aCA9IDA7XG59O1xuXG4vKipcbiAqIENhbGxlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSB1cGRhdGUgY3ljbGUgZm9yIGVhY2ggcmVuZGVyIGZyYW1lLCBiZWZvcmUge0BsaW5rIFF1YWR0cmVlVGlsZVByb3ZpZGVyI3Nob3dUaWxlVGhpc0ZyYW1lfVxuICogb3IgYW55IG90aGVyIGZ1bmN0aW9ucy5cbiAqXG4gKiBAcGFyYW0ge0ZyYW1lU3RhdGV9IGZyYW1lU3RhdGUgVGhlIGZyYW1lIHN0YXRlLlxuICovXG5HbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlLmJlZ2luVXBkYXRlID0gZnVuY3Rpb24gKGZyYW1lU3RhdGUpIHtcbiAgdmFyIHRpbGVzVG9SZW5kZXJCeVRleHR1cmVDb3VudCA9IHRoaXMuX3RpbGVzVG9SZW5kZXJCeVRleHR1cmVDb3VudDtcbiAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRpbGVzVG9SZW5kZXJCeVRleHR1cmVDb3VudC5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgIHZhciB0aWxlcyA9IHRpbGVzVG9SZW5kZXJCeVRleHR1cmVDb3VudFtpXTtcbiAgICBpZiAoZGVmaW5lZCh0aWxlcykpIHtcbiAgICAgIHRpbGVzLmxlbmd0aCA9IDA7XG4gICAgfVxuICB9XG4gIC8vIHVwZGF0ZSBjbGlwcGluZyBwbGFuZXNcbiAgdmFyIGNsaXBwaW5nUGxhbmVzID0gdGhpcy5fY2xpcHBpbmdQbGFuZXM7XG4gIGlmIChkZWZpbmVkKGNsaXBwaW5nUGxhbmVzKSAmJiBjbGlwcGluZ1BsYW5lcy5lbmFibGVkKSB7XG4gICAgY2xpcHBpbmdQbGFuZXMudXBkYXRlKGZyYW1lU3RhdGUpO1xuICB9XG4gIHRoaXMuX3VzZWREcmF3Q29tbWFuZHMgPSAwO1xuXG4gIHRoaXMuX2hhc0xvYWRlZFRpbGVzVGhpc0ZyYW1lID0gZmFsc2U7XG4gIHRoaXMuX2hhc0ZpbGxUaWxlc1RoaXNGcmFtZSA9IGZhbHNlO1xufTtcblxuLyoqXG4gKiBDYWxsZWQgYXQgdGhlIGVuZCBvZiB0aGUgdXBkYXRlIGN5Y2xlIGZvciBlYWNoIHJlbmRlciBmcmFtZSwgYWZ0ZXIge0BsaW5rIFF1YWR0cmVlVGlsZVByb3ZpZGVyI3Nob3dUaWxlVGhpc0ZyYW1lfVxuICogYW5kIGFueSBvdGhlciBmdW5jdGlvbnMuXG4gKlxuICogQHBhcmFtIHtGcmFtZVN0YXRlfSBmcmFtZVN0YXRlIFRoZSBmcmFtZSBzdGF0ZS5cbiAqL1xuR2xvYmVTdXJmYWNlVGlsZVByb3ZpZGVyLnByb3RvdHlwZS5lbmRVcGRhdGUgPSBmdW5jdGlvbiAoZnJhbWVTdGF0ZSkge1xuICBpZiAoIWRlZmluZWQodGhpcy5fcmVuZGVyU3RhdGUpKSB7XG4gICAgdGhpcy5fcmVuZGVyU3RhdGUgPSBSZW5kZXJTdGF0ZS5mcm9tQ2FjaGUoe1xuICAgICAgLy8gV3JpdGUgY29sb3IgYW5kIGRlcHRoXG4gICAgICBjdWxsOiB7XG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICB9LFxuICAgICAgZGVwdGhUZXN0OiB7XG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGZ1bmM6IERlcHRoRnVuY3Rpb24uTEVTUyxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLl9ibGVuZFJlbmRlclN0YXRlID0gUmVuZGVyU3RhdGUuZnJvbUNhY2hlKHtcbiAgICAgIC8vIFdyaXRlIGNvbG9yIGFuZCBkZXB0aFxuICAgICAgY3VsbDoge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgfSxcbiAgICAgIGRlcHRoVGVzdDoge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBmdW5jOiBEZXB0aEZ1bmN0aW9uLkxFU1NfT1JfRVFVQUwsXG4gICAgICB9LFxuICAgICAgYmxlbmRpbmc6IEJsZW5kaW5nU3RhdGUuQUxQSEFfQkxFTkQsXG4gICAgfSk7XG5cbiAgICB2YXIgcnMgPSBjbG9uZSh0aGlzLl9yZW5kZXJTdGF0ZSwgdHJ1ZSk7XG4gICAgcnMuY3VsbC5lbmFibGVkID0gZmFsc2U7XG4gICAgdGhpcy5fZGlzYWJsZUN1bGxpbmdSZW5kZXJTdGF0ZSA9IFJlbmRlclN0YXRlLmZyb21DYWNoZShycyk7XG5cbiAgICBycyA9IGNsb25lKHRoaXMuX2JsZW5kUmVuZGVyU3RhdGUsIHRydWUpO1xuICAgIHJzLmN1bGwuZW5hYmxlZCA9IGZhbHNlO1xuICAgIHRoaXMuX2Rpc2FibGVDdWxsaW5nQmxlbmRSZW5kZXJTdGF0ZSA9IFJlbmRlclN0YXRlLmZyb21DYWNoZShycyk7XG4gIH1cblxuICAvLyBJZiB0aGlzIGZyYW1lIGhhcyBhIG1peCBvZiBsb2FkZWQgYW5kIGZpbGwgdGlsZXMsIHdlIG5lZWQgdG8gcHJvcGFnYXRlXG4gIC8vIGxvYWRlZCBoZWlnaHRzIHRvIHRoZSBmaWxsIHRpbGVzLlxuICBpZiAodGhpcy5faGFzRmlsbFRpbGVzVGhpc0ZyYW1lICYmIHRoaXMuX2hhc0xvYWRlZFRpbGVzVGhpc0ZyYW1lKSB7XG4gICAgVGVycmFpbkZpbGxNZXNoLnVwZGF0ZUZpbGxUaWxlcyhcbiAgICAgIHRoaXMsXG4gICAgICB0aGlzLl9xdWFkdHJlZS5fdGlsZXNUb1JlbmRlcixcbiAgICAgIGZyYW1lU3RhdGUsXG4gICAgICB0aGlzLl92ZXJ0ZXhBcnJheXNUb0Rlc3Ryb3lcbiAgICApO1xuICB9XG5cbiAgLy8gV2hlbiB0ZXJyYWluIGV4YWdnZXJhdGlvbiBjaGFuZ2VzLCBhbGwgb2YgdGhlIGxvYWRlZCB0aWxlcyBuZWVkIHRvIGdlbmVyYXRlXG4gIC8vIGdlb2RldGljIHN1cmZhY2Ugbm9ybWFscyBzbyB0aGV5IGNhbiBzY2FsZSBwcm9wZXJseSB3aGVuIHJlbmRlcmVkLlxuICAvLyBXaGVuIGV4YWdnZXJhdGlvbiBpcyByZXNldCwgZ2VvZGV0aWMgc3VyZmFjZSBub3JtYWxzIGFyZSByZW1vdmVkIHRvIGRlY3JlYXNlXG4gIC8vIG1lbW9yeSB1c2FnZS4gU29tZSB0aWxlcyBtaWdodCBoYXZlIGJlZW4gY29uc3RydWN0ZWQgd2l0aCB0aGUgY29ycmVjdFxuICAvLyBleGFnZ2VyYXRpb24gYWxyZWFkeSwgc28gc2tpcCBvdmVyIHRoZW0uXG5cbiAgLy8gSWYgdGhlIGdlb2RldGljIHN1cmZhY2Ugbm9ybWFscyBjYW4ndCBiZSBjcmVhdGVkIGJlY2F1c2UgdGhlIHRpbGUgZG9lc24ndFxuICAvLyBoYXZlIGEgbWVzaCwga2VlcCBjaGVja2luZyB1bnRpbCB0aGUgdGlsZSBkb2VzIGhhdmUgYSBtZXNoLiBUaGlzIGNhbiBoYXBwZW5cbiAgLy8gaWYgdGhlIHRpbGUncyBtZXNoIHN0YXJ0cyBjb25zdHJ1Y3Rpb24gaW4gYSB3b3JrZXIgdGhyZWFkIHJpZ2h0IGJlZm9yZSB0aGVcbiAgLy8gZXhhZ2dlcmF0aW9uIGNoYW5nZXMuXG5cbiAgdmFyIHF1YWR0cmVlID0gdGhpcy5xdWFkdHJlZTtcbiAgdmFyIGV4YWdnZXJhdGlvbiA9IGZyYW1lU3RhdGUudGVycmFpbkV4YWdnZXJhdGlvbjtcbiAgdmFyIGV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0ID0gZnJhbWVTdGF0ZS50ZXJyYWluRXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHQ7XG4gIHZhciBleGFnZ2VyYXRpb25DaGFuZ2VkID1cbiAgICB0aGlzLl9vbGRUZXJyYWluRXhhZ2dlcmF0aW9uICE9PSBleGFnZ2VyYXRpb24gfHxcbiAgICB0aGlzLl9vbGRUZXJyYWluRXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHQgIT09IGV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0O1xuXG4gIC8vIEtlZXAgdHJhY2sgb2YgdGhlIG5leHQgdGltZSB0aGVyZSBpcyBhIGNoYW5nZSBpbiBleGFnZ2VyYXRpb25cbiAgdGhpcy5fb2xkVGVycmFpbkV4YWdnZXJhdGlvbiA9IGV4YWdnZXJhdGlvbjtcbiAgdGhpcy5fb2xkVGVycmFpbkV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0ID0gZXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHQ7XG5cbiAgaWYgKGV4YWdnZXJhdGlvbkNoYW5nZWQpIHtcbiAgICBxdWFkdHJlZS5mb3JFYWNoTG9hZGVkVGlsZShmdW5jdGlvbiAodGlsZSkge1xuICAgICAgdmFyIHN1cmZhY2VUaWxlID0gdGlsZS5kYXRhO1xuICAgICAgc3VyZmFjZVRpbGUudXBkYXRlRXhhZ2dlcmF0aW9uKHRpbGUsIGZyYW1lU3RhdGUsIHF1YWR0cmVlKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEFkZCB0aGUgdGlsZSByZW5kZXIgY29tbWFuZHMgdG8gdGhlIGNvbW1hbmQgbGlzdCwgc29ydGVkIGJ5IHRleHR1cmUgY291bnQuXG4gIHZhciB0aWxlc1RvUmVuZGVyQnlUZXh0dXJlQ291bnQgPSB0aGlzLl90aWxlc1RvUmVuZGVyQnlUZXh0dXJlQ291bnQ7XG4gIGZvciAoXG4gICAgdmFyIHRleHR1cmVDb3VudEluZGV4ID0gMCxcbiAgICAgIHRleHR1cmVDb3VudExlbmd0aCA9IHRpbGVzVG9SZW5kZXJCeVRleHR1cmVDb3VudC5sZW5ndGg7XG4gICAgdGV4dHVyZUNvdW50SW5kZXggPCB0ZXh0dXJlQ291bnRMZW5ndGg7XG4gICAgKyt0ZXh0dXJlQ291bnRJbmRleFxuICApIHtcbiAgICB2YXIgdGlsZXNUb1JlbmRlciA9IHRpbGVzVG9SZW5kZXJCeVRleHR1cmVDb3VudFt0ZXh0dXJlQ291bnRJbmRleF07XG4gICAgaWYgKCFkZWZpbmVkKHRpbGVzVG9SZW5kZXIpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBmb3IgKFxuICAgICAgdmFyIHRpbGVJbmRleCA9IDAsIHRpbGVMZW5ndGggPSB0aWxlc1RvUmVuZGVyLmxlbmd0aDtcbiAgICAgIHRpbGVJbmRleCA8IHRpbGVMZW5ndGg7XG4gICAgICArK3RpbGVJbmRleFxuICAgICkge1xuICAgICAgdmFyIHRpbGUgPSB0aWxlc1RvUmVuZGVyW3RpbGVJbmRleF07XG4gICAgICB2YXIgdGlsZUJvdW5kaW5nUmVnaW9uID0gdGlsZS5kYXRhLnRpbGVCb3VuZGluZ1JlZ2lvbjtcbiAgICAgIGFkZERyYXdDb21tYW5kc0ZvclRpbGUodGhpcywgdGlsZSwgZnJhbWVTdGF0ZSk7XG4gICAgICBmcmFtZVN0YXRlLm1pbmltdW1UZXJyYWluSGVpZ2h0ID0gTWF0aC5taW4oXG4gICAgICAgIGZyYW1lU3RhdGUubWluaW11bVRlcnJhaW5IZWlnaHQsXG4gICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0XG4gICAgICApO1xuICAgIH1cbiAgfVxufTtcblxuZnVuY3Rpb24gcHVzaENvbW1hbmQoY29tbWFuZCwgZnJhbWVTdGF0ZSkge1xuICB2YXIgZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZSA9IGZyYW1lU3RhdGUuZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZTtcbiAgaWYgKGdsb2JlVHJhbnNsdWNlbmN5U3RhdGUudHJhbnNsdWNlbnQpIHtcbiAgICB2YXIgaXNCbGVuZENvbW1hbmQgPSBjb21tYW5kLnJlbmRlclN0YXRlLmJsZW5kaW5nLmVuYWJsZWQ7XG4gICAgZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZS5wdXNoRGVyaXZlZENvbW1hbmRzKFxuICAgICAgY29tbWFuZCxcbiAgICAgIGlzQmxlbmRDb21tYW5kLFxuICAgICAgZnJhbWVTdGF0ZVxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgZnJhbWVTdGF0ZS5jb21tYW5kTGlzdC5wdXNoKGNvbW1hbmQpO1xuICB9XG59XG5cbi8qKlxuICogQWRkcyBkcmF3IGNvbW1hbmRzIGZvciB0aWxlcyByZW5kZXJlZCBpbiB0aGUgcHJldmlvdXMgZnJhbWUgZm9yIGEgcGljayBwYXNzLlxuICpcbiAqIEBwYXJhbSB7RnJhbWVTdGF0ZX0gZnJhbWVTdGF0ZSBUaGUgZnJhbWUgc3RhdGUuXG4gKi9cbkdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGUudXBkYXRlRm9yUGljayA9IGZ1bmN0aW9uIChmcmFtZVN0YXRlKSB7XG4gIC8vIEFkZCB0aGUgdGlsZSBwaWNrIGNvbW1hbmRzIGZyb20gdGhlIHRpbGVzIGRyYXduIGxhc3QgZnJhbWUuXG4gIHZhciBkcmF3Q29tbWFuZHMgPSB0aGlzLl9kcmF3Q29tbWFuZHM7XG4gIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSB0aGlzLl91c2VkRHJhd0NvbW1hbmRzOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICBwdXNoQ29tbWFuZChkcmF3Q29tbWFuZHNbaV0sIGZyYW1lU3RhdGUpO1xuICB9XG59O1xuXG4vKipcbiAqIENhbmNlbHMgYW55IGltYWdlcnkgcmUtcHJvamVjdGlvbnMgaW4gdGhlIHF1ZXVlLlxuICovXG5HbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlLmNhbmNlbFJlcHJvamVjdGlvbnMgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuX2ltYWdlcnlMYXllcnMuY2FuY2VsUmVwcm9qZWN0aW9ucygpO1xufTtcblxuLyoqXG4gKiBHZXRzIHRoZSBtYXhpbXVtIGdlb21ldHJpYyBlcnJvciBhbGxvd2VkIGluIGEgdGlsZSBhdCBhIGdpdmVuIGxldmVsLCBpbiBtZXRlcnMuICBUaGlzIGZ1bmN0aW9uIHNob3VsZCBub3QgYmVcbiAqIGNhbGxlZCBiZWZvcmUge0BsaW5rIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlciNyZWFkeX0gcmV0dXJucyB0cnVlLlxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBsZXZlbCBUaGUgdGlsZSBsZXZlbCBmb3Igd2hpY2ggdG8gZ2V0IHRoZSBtYXhpbXVtIGdlb21ldHJpYyBlcnJvci5cbiAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBtYXhpbXVtIGdlb21ldHJpYyBlcnJvciBpbiBtZXRlcnMuXG4gKi9cbkdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGUuZ2V0TGV2ZWxNYXhpbXVtR2VvbWV0cmljRXJyb3IgPSBmdW5jdGlvbiAoXG4gIGxldmVsXG4pIHtcbiAgcmV0dXJuIHRoaXMuX3RlcnJhaW5Qcm92aWRlci5nZXRMZXZlbE1heGltdW1HZW9tZXRyaWNFcnJvcihsZXZlbCk7XG59O1xuXG4vKipcbiAqIExvYWRzLCBvciBjb250aW51ZXMgbG9hZGluZywgYSBnaXZlbiB0aWxlLiAgVGhpcyBmdW5jdGlvbiB3aWxsIGNvbnRpbnVlIHRvIGJlIGNhbGxlZFxuICogdW50aWwge0BsaW5rIFF1YWR0cmVlVGlsZSNzdGF0ZX0gaXMgbm8gbG9uZ2VyIHtAbGluayBRdWFkdHJlZVRpbGVMb2FkU3RhdGUjTE9BRElOR30uICBUaGlzIGZ1bmN0aW9uIHNob3VsZFxuICogbm90IGJlIGNhbGxlZCBiZWZvcmUge0BsaW5rIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlciNyZWFkeX0gcmV0dXJucyB0cnVlLlxuICpcbiAqIEBwYXJhbSB7RnJhbWVTdGF0ZX0gZnJhbWVTdGF0ZSBUaGUgZnJhbWUgc3RhdGUuXG4gKiBAcGFyYW0ge1F1YWR0cmVlVGlsZX0gdGlsZSBUaGUgdGlsZSB0byBsb2FkLlxuICpcbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSA8Y29kZT5sb2FkVGlsZTwvY29kZT4gbXVzdCBub3QgYmUgY2FsbGVkIGJlZm9yZSB0aGUgdGlsZSBwcm92aWRlciBpcyByZWFkeS5cbiAqL1xuR2xvYmVTdXJmYWNlVGlsZVByb3ZpZGVyLnByb3RvdHlwZS5sb2FkVGlsZSA9IGZ1bmN0aW9uIChmcmFtZVN0YXRlLCB0aWxlKSB7XG4gIC8vIFdlIGRvbid0IHdhbnQgdG8gbG9hZCBpbWFnZXJ5IHVudGlsIHdlJ3JlIGNlcnRhaW4gdGhhdCB0aGUgdGVycmFpbiB0aWxlcyBhcmUgYWN0dWFsbHkgdmlzaWJsZS5cbiAgLy8gU28gaWYgb3VyIGJvdW5kaW5nIHZvbHVtZSBpc24ndCBhY2N1cmF0ZSBiZWNhdXNlIGl0IGNhbWUgZnJvbSBhbm90aGVyIHRpbGUsIGxvYWQgdGVycmFpbiBvbmx5XG4gIC8vIGluaXRpYWxseS4gSWYgd2UgbG9hZCBzb21lIHRlcnJhaW4gYW5kIHN1ZGRlbmx5IGhhdmUgYSBtb3JlIGFjY3VyYXRlIGJvdW5kaW5nIHZvbHVtZSBhbmQgdGhlXG4gIC8vIHRpbGUgaXMgX3N0aWxsXyB2aXNpYmxlLCBnaXZlIHRoZSB0aWxlIGEgY2hhbmNlIHRvIGxvYWQgaW1hZ2VyeSBpbW1lZGlhdGVseSByYXRoZXIgdGhhblxuICAvLyB3YWl0aW5nIGZvciBuZXh0IGZyYW1lLlxuXG4gIHZhciBzdXJmYWNlVGlsZSA9IHRpbGUuZGF0YTtcbiAgdmFyIHRlcnJhaW5Pbmx5ID0gdHJ1ZTtcbiAgdmFyIHRlcnJhaW5TdGF0ZUJlZm9yZTtcbiAgaWYgKGRlZmluZWQoc3VyZmFjZVRpbGUpKSB7XG4gICAgdGVycmFpbk9ubHkgPVxuICAgICAgc3VyZmFjZVRpbGUuYm91bmRpbmdWb2x1bWVTb3VyY2VUaWxlICE9PSB0aWxlIHx8XG4gICAgICB0aWxlLl9sYXN0U2VsZWN0aW9uUmVzdWx0ID09PSBUaWxlU2VsZWN0aW9uUmVzdWx0LkNVTExFRF9CVVRfTkVFREVEO1xuICAgIHRlcnJhaW5TdGF0ZUJlZm9yZSA9IHN1cmZhY2VUaWxlLnRlcnJhaW5TdGF0ZTtcbiAgfVxuXG4gIEdsb2JlU3VyZmFjZVRpbGUucHJvY2Vzc1N0YXRlTWFjaGluZShcbiAgICB0aWxlLFxuICAgIGZyYW1lU3RhdGUsXG4gICAgdGhpcy50ZXJyYWluUHJvdmlkZXIsXG4gICAgdGhpcy5faW1hZ2VyeUxheWVycyxcbiAgICB0aGlzLnF1YWR0cmVlLFxuICAgIHRoaXMuX3ZlcnRleEFycmF5c1RvRGVzdHJveSxcbiAgICB0ZXJyYWluT25seVxuICApO1xuXG4gIHN1cmZhY2VUaWxlID0gdGlsZS5kYXRhO1xuICBpZiAodGVycmFpbk9ubHkgJiYgdGVycmFpblN0YXRlQmVmb3JlICE9PSB0aWxlLmRhdGEudGVycmFpblN0YXRlKSB7XG4gICAgLy8gVGVycmFpbiBzdGF0ZSBjaGFuZ2VkLiBJZjpcbiAgICAvLyBhKSBUaGUgdGlsZSBpcyB2aXNpYmxlLCBhbmRcbiAgICAvLyBiKSBUaGUgYm91bmRpbmcgdm9sdW1lIGlzIGFjY3VyYXRlICh1cGRhdGVkIGFzIGEgc2lkZSBlZmZlY3Qgb2YgY29tcHV0aW5nIHZpc2liaWxpdHkpXG4gICAgLy8gVGhlbiB3ZSdsbCBsb2FkIGltYWdlcnksIHRvby5cbiAgICBpZiAoXG4gICAgICB0aGlzLmNvbXB1dGVUaWxlVmlzaWJpbGl0eSh0aWxlLCBmcmFtZVN0YXRlLCB0aGlzLnF1YWR0cmVlLm9jY2x1ZGVycykgIT09XG4gICAgICAgIFZpc2liaWxpdHkuTk9ORSAmJlxuICAgICAgc3VyZmFjZVRpbGUuYm91bmRpbmdWb2x1bWVTb3VyY2VUaWxlID09PSB0aWxlXG4gICAgKSB7XG4gICAgICB0ZXJyYWluT25seSA9IGZhbHNlO1xuICAgICAgR2xvYmVTdXJmYWNlVGlsZS5wcm9jZXNzU3RhdGVNYWNoaW5lKFxuICAgICAgICB0aWxlLFxuICAgICAgICBmcmFtZVN0YXRlLFxuICAgICAgICB0aGlzLnRlcnJhaW5Qcm92aWRlcixcbiAgICAgICAgdGhpcy5faW1hZ2VyeUxheWVycyxcbiAgICAgICAgdGhpcy5xdWFkdHJlZSxcbiAgICAgICAgdGhpcy5fdmVydGV4QXJyYXlzVG9EZXN0cm95LFxuICAgICAgICB0ZXJyYWluT25seVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn07XG5cbnZhciBib3VuZGluZ1NwaGVyZVNjcmF0Y2ggPSBuZXcgQm91bmRpbmdTcGhlcmUoKTtcbnZhciByZWN0YW5nbGVJbnRlcnNlY3Rpb25TY3JhdGNoID0gbmV3IFJlY3RhbmdsZSgpO1xudmFyIHNwbGl0Q2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGVTY3JhdGNoID0gbmV3IFJlY3RhbmdsZSgpO1xudmFyIHJlY3RhbmdsZUNlbnRlclNjcmF0Y2ggPSBuZXcgQ2FydG9ncmFwaGljKCk7XG5cbi8vIGNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlIG1heSBzcGFuIHRoZSBJREwsIGJ1dCB0aWxlcyBuZXZlciB3aWxsLlxuZnVuY3Rpb24gY2xpcFJlY3RhbmdsZUFudGltZXJpZGlhbih0aWxlUmVjdGFuZ2xlLCBjYXJ0b2dyYXBoaWNMaW1pdFJlY3RhbmdsZSkge1xuICBpZiAoY2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGUud2VzdCA8IGNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlLmVhc3QpIHtcbiAgICByZXR1cm4gY2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGU7XG4gIH1cbiAgdmFyIHNwbGl0UmVjdGFuZ2xlID0gUmVjdGFuZ2xlLmNsb25lKFxuICAgIGNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlLFxuICAgIHNwbGl0Q2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGVTY3JhdGNoXG4gICk7XG4gIHZhciB0aWxlQ2VudGVyID0gUmVjdGFuZ2xlLmNlbnRlcih0aWxlUmVjdGFuZ2xlLCByZWN0YW5nbGVDZW50ZXJTY3JhdGNoKTtcbiAgaWYgKHRpbGVDZW50ZXIubG9uZ2l0dWRlID4gMC4wKSB7XG4gICAgc3BsaXRSZWN0YW5nbGUuZWFzdCA9IENlc2l1bU1hdGguUEk7XG4gIH0gZWxzZSB7XG4gICAgc3BsaXRSZWN0YW5nbGUud2VzdCA9IC1DZXNpdW1NYXRoLlBJO1xuICB9XG4gIHJldHVybiBzcGxpdFJlY3RhbmdsZTtcbn1cblxuZnVuY3Rpb24gaXNVbmRlcmdyb3VuZFZpc2libGUodGlsZVByb3ZpZGVyLCBmcmFtZVN0YXRlKSB7XG4gIGlmIChmcmFtZVN0YXRlLmNhbWVyYVVuZGVyZ3JvdW5kKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpZiAoZnJhbWVTdGF0ZS5nbG9iZVRyYW5zbHVjZW5jeVN0YXRlLnRyYW5zbHVjZW50KSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpZiAodGlsZVByb3ZpZGVyLmJhY2tGYWNlQ3VsbGluZykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBjbGlwcGluZ1BsYW5lcyA9IHRpbGVQcm92aWRlci5fY2xpcHBpbmdQbGFuZXM7XG4gIGlmIChkZWZpbmVkKGNsaXBwaW5nUGxhbmVzKSAmJiBjbGlwcGluZ1BsYW5lcy5lbmFibGVkKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpZiAoXG4gICAgIVJlY3RhbmdsZS5lcXVhbHMoXG4gICAgICB0aWxlUHJvdmlkZXIuY2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGUsXG4gICAgICBSZWN0YW5nbGUuTUFYX1ZBTFVFXG4gICAgKVxuICApIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBEZXRlcm1pbmVzIHRoZSB2aXNpYmlsaXR5IG9mIGEgZ2l2ZW4gdGlsZS4gIFRoZSB0aWxlIG1heSBiZSBmdWxseSB2aXNpYmxlLCBwYXJ0aWFsbHkgdmlzaWJsZSwgb3Igbm90XG4gKiB2aXNpYmxlIGF0IGFsbC4gIFRpbGVzIHRoYXQgYXJlIHJlbmRlcmFibGUgYW5kIGFyZSBhdCBsZWFzdCBwYXJ0aWFsbHkgdmlzaWJsZSB3aWxsIGJlIHNob3duIGJ5IGEgY2FsbFxuICogdG8ge0BsaW5rIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlciNzaG93VGlsZVRoaXNGcmFtZX0uXG4gKlxuICogQHBhcmFtIHtRdWFkdHJlZVRpbGV9IHRpbGUgVGhlIHRpbGUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge0ZyYW1lU3RhdGV9IGZyYW1lU3RhdGUgVGhlIHN0YXRlIGluZm9ybWF0aW9uIGFib3V0IHRoZSBjdXJyZW50IGZyYW1lLlxuICogQHBhcmFtIHtRdWFkdHJlZU9jY2x1ZGVyc30gb2NjbHVkZXJzIFRoZSBvYmplY3RzIHRoYXQgbWF5IG9jY2x1ZGUgdGhpcyB0aWxlLlxuICpcbiAqIEByZXR1cm5zIHtWaXNpYmlsaXR5fSBWaXNpYmlsaXR5Lk5PTkUgaWYgdGhlIHRpbGUgaXMgbm90IHZpc2libGUsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgVmlzaWJpbGl0eS5QQVJUSUFMIGlmIHRoZSB0aWxlIGlzIHBhcnRpYWxseSB2aXNpYmxlLCBvclxuICogICAgICAgICAgICAgICAgICAgICAgIFZpc2liaWxpdHkuRlVMTCBpZiB0aGUgdGlsZSBpcyBmdWxseSB2aXNpYmxlLlxuICovXG5HbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlLmNvbXB1dGVUaWxlVmlzaWJpbGl0eSA9IGZ1bmN0aW9uIChcbiAgdGlsZSxcbiAgZnJhbWVTdGF0ZSxcbiAgb2NjbHVkZXJzXG4pIHtcbiAgdmFyIGRpc3RhbmNlID0gdGhpcy5jb21wdXRlRGlzdGFuY2VUb1RpbGUodGlsZSwgZnJhbWVTdGF0ZSk7XG4gIHRpbGUuX2Rpc3RhbmNlID0gZGlzdGFuY2U7XG5cbiAgdmFyIHVuZGVyZ3JvdW5kVmlzaWJsZSA9IGlzVW5kZXJncm91bmRWaXNpYmxlKHRoaXMsIGZyYW1lU3RhdGUpO1xuXG4gIGlmIChmcmFtZVN0YXRlLmZvZy5lbmFibGVkICYmICF1bmRlcmdyb3VuZFZpc2libGUpIHtcbiAgICBpZiAoQ2VzaXVtTWF0aC5mb2coZGlzdGFuY2UsIGZyYW1lU3RhdGUuZm9nLmRlbnNpdHkpID49IDEuMCkge1xuICAgICAgLy8gVGlsZSBpcyBjb21wbGV0ZWx5IGluIGZvZyBzbyByZXR1cm4gdGhhdCBpdCBpcyBub3QgdmlzaWJsZS5cbiAgICAgIHJldHVybiBWaXNpYmlsaXR5Lk5PTkU7XG4gICAgfVxuICB9XG5cbiAgdmFyIHN1cmZhY2VUaWxlID0gdGlsZS5kYXRhO1xuICB2YXIgdGlsZUJvdW5kaW5nUmVnaW9uID0gc3VyZmFjZVRpbGUudGlsZUJvdW5kaW5nUmVnaW9uO1xuXG4gIGlmIChzdXJmYWNlVGlsZS5ib3VuZGluZ1ZvbHVtZVNvdXJjZVRpbGUgPT09IHVuZGVmaW5lZCkge1xuICAgIC8vIFdlIGhhdmUgbm8gaWRlYSB3aGVyZSB0aGlzIHRpbGUgaXMsIHNvIGxldCdzIGp1c3QgY2FsbCBpdCBwYXJ0aWFsbHkgdmlzaWJsZS5cbiAgICByZXR1cm4gVmlzaWJpbGl0eS5QQVJUSUFMO1xuICB9XG5cbiAgdmFyIGN1bGxpbmdWb2x1bWUgPSBmcmFtZVN0YXRlLmN1bGxpbmdWb2x1bWU7XG4gIHZhciBib3VuZGluZ1ZvbHVtZSA9IHRpbGVCb3VuZGluZ1JlZ2lvbi5ib3VuZGluZ1ZvbHVtZTtcblxuICBpZiAoIWRlZmluZWQoYm91bmRpbmdWb2x1bWUpKSB7XG4gICAgYm91bmRpbmdWb2x1bWUgPSB0aWxlQm91bmRpbmdSZWdpb24uYm91bmRpbmdTcGhlcmU7XG4gIH1cblxuICAvLyBDaGVjayBpZiB0aGUgdGlsZSBpcyBvdXRzaWRlIHRoZSBsaW1pdCBhcmVhIGluIGNhcnRvZ3JhcGhpYyBzcGFjZVxuICBzdXJmYWNlVGlsZS5jbGlwcGVkQnlCb3VuZGFyaWVzID0gZmFsc2U7XG4gIHZhciBjbGlwcGVkQ2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGUgPSBjbGlwUmVjdGFuZ2xlQW50aW1lcmlkaWFuKFxuICAgIHRpbGUucmVjdGFuZ2xlLFxuICAgIHRoaXMuY2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGVcbiAgKTtcbiAgdmFyIGFyZWFMaW1pdEludGVyc2VjdGlvbiA9IFJlY3RhbmdsZS5zaW1wbGVJbnRlcnNlY3Rpb24oXG4gICAgY2xpcHBlZENhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlLFxuICAgIHRpbGUucmVjdGFuZ2xlLFxuICAgIHJlY3RhbmdsZUludGVyc2VjdGlvblNjcmF0Y2hcbiAgKTtcbiAgaWYgKCFkZWZpbmVkKGFyZWFMaW1pdEludGVyc2VjdGlvbikpIHtcbiAgICByZXR1cm4gVmlzaWJpbGl0eS5OT05FO1xuICB9XG4gIGlmICghUmVjdGFuZ2xlLmVxdWFscyhhcmVhTGltaXRJbnRlcnNlY3Rpb24sIHRpbGUucmVjdGFuZ2xlKSkge1xuICAgIHN1cmZhY2VUaWxlLmNsaXBwZWRCeUJvdW5kYXJpZXMgPSB0cnVlO1xuICB9XG5cbiAgaWYgKGZyYW1lU3RhdGUubW9kZSAhPT0gU2NlbmVNb2RlLlNDRU5FM0QpIHtcbiAgICBib3VuZGluZ1ZvbHVtZSA9IGJvdW5kaW5nU3BoZXJlU2NyYXRjaDtcbiAgICBCb3VuZGluZ1NwaGVyZS5mcm9tUmVjdGFuZ2xlV2l0aEhlaWdodHMyRChcbiAgICAgIHRpbGUucmVjdGFuZ2xlLFxuICAgICAgZnJhbWVTdGF0ZS5tYXBQcm9qZWN0aW9uLFxuICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLm1pbmltdW1IZWlnaHQsXG4gICAgICB0aWxlQm91bmRpbmdSZWdpb24ubWF4aW11bUhlaWdodCxcbiAgICAgIGJvdW5kaW5nVm9sdW1lXG4gICAgKTtcbiAgICBDYXJ0ZXNpYW4zLmZyb21FbGVtZW50cyhcbiAgICAgIGJvdW5kaW5nVm9sdW1lLmNlbnRlci56LFxuICAgICAgYm91bmRpbmdWb2x1bWUuY2VudGVyLngsXG4gICAgICBib3VuZGluZ1ZvbHVtZS5jZW50ZXIueSxcbiAgICAgIGJvdW5kaW5nVm9sdW1lLmNlbnRlclxuICAgICk7XG5cbiAgICBpZiAoXG4gICAgICBmcmFtZVN0YXRlLm1vZGUgPT09IFNjZW5lTW9kZS5NT1JQSElORyAmJlxuICAgICAgZGVmaW5lZChzdXJmYWNlVGlsZS5yZW5kZXJlZE1lc2gpXG4gICAgKSB7XG4gICAgICBib3VuZGluZ1ZvbHVtZSA9IEJvdW5kaW5nU3BoZXJlLnVuaW9uKFxuICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24uYm91bmRpbmdTcGhlcmUsXG4gICAgICAgIGJvdW5kaW5nVm9sdW1lLFxuICAgICAgICBib3VuZGluZ1ZvbHVtZVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBpZiAoIWRlZmluZWQoYm91bmRpbmdWb2x1bWUpKSB7XG4gICAgcmV0dXJuIFZpc2liaWxpdHkuUEFSVElBTDtcbiAgfVxuXG4gIHZhciBjbGlwcGluZ1BsYW5lcyA9IHRoaXMuX2NsaXBwaW5nUGxhbmVzO1xuICBpZiAoZGVmaW5lZChjbGlwcGluZ1BsYW5lcykgJiYgY2xpcHBpbmdQbGFuZXMuZW5hYmxlZCkge1xuICAgIHZhciBwbGFuZUludGVyc2VjdGlvbiA9IGNsaXBwaW5nUGxhbmVzLmNvbXB1dGVJbnRlcnNlY3Rpb25XaXRoQm91bmRpbmdWb2x1bWUoXG4gICAgICBib3VuZGluZ1ZvbHVtZVxuICAgICk7XG4gICAgdGlsZS5pc0NsaXBwZWQgPSBwbGFuZUludGVyc2VjdGlvbiAhPT0gSW50ZXJzZWN0LklOU0lERTtcbiAgICBpZiAocGxhbmVJbnRlcnNlY3Rpb24gPT09IEludGVyc2VjdC5PVVRTSURFKSB7XG4gICAgICByZXR1cm4gVmlzaWJpbGl0eS5OT05FO1xuICAgIH1cbiAgfVxuXG4gIHZhciB2aXNpYmlsaXR5O1xuICB2YXIgaW50ZXJzZWN0aW9uID0gY3VsbGluZ1ZvbHVtZS5jb21wdXRlVmlzaWJpbGl0eShib3VuZGluZ1ZvbHVtZSk7XG5cbiAgaWYgKGludGVyc2VjdGlvbiA9PT0gSW50ZXJzZWN0Lk9VVFNJREUpIHtcbiAgICB2aXNpYmlsaXR5ID0gVmlzaWJpbGl0eS5OT05FO1xuICB9IGVsc2UgaWYgKGludGVyc2VjdGlvbiA9PT0gSW50ZXJzZWN0LklOVEVSU0VDVElORykge1xuICAgIHZpc2liaWxpdHkgPSBWaXNpYmlsaXR5LlBBUlRJQUw7XG4gIH0gZWxzZSBpZiAoaW50ZXJzZWN0aW9uID09PSBJbnRlcnNlY3QuSU5TSURFKSB7XG4gICAgdmlzaWJpbGl0eSA9IFZpc2liaWxpdHkuRlVMTDtcbiAgfVxuXG4gIGlmICh2aXNpYmlsaXR5ID09PSBWaXNpYmlsaXR5Lk5PTkUpIHtcbiAgICByZXR1cm4gdmlzaWJpbGl0eTtcbiAgfVxuXG4gIHZhciBvcnRobzNEID1cbiAgICBmcmFtZVN0YXRlLm1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTNEICYmXG4gICAgZnJhbWVTdGF0ZS5jYW1lcmEuZnJ1c3R1bSBpbnN0YW5jZW9mIE9ydGhvZ3JhcGhpY0ZydXN0dW07XG4gIGlmIChcbiAgICBmcmFtZVN0YXRlLm1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTNEICYmXG4gICAgIW9ydGhvM0QgJiZcbiAgICBkZWZpbmVkKG9jY2x1ZGVycykgJiZcbiAgICAhdW5kZXJncm91bmRWaXNpYmxlXG4gICkge1xuICAgIHZhciBvY2NsdWRlZVBvaW50SW5TY2FsZWRTcGFjZSA9IHN1cmZhY2VUaWxlLm9jY2x1ZGVlUG9pbnRJblNjYWxlZFNwYWNlO1xuICAgIGlmICghZGVmaW5lZChvY2NsdWRlZVBvaW50SW5TY2FsZWRTcGFjZSkpIHtcbiAgICAgIHJldHVybiB2aXNpYmlsaXR5O1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIG9jY2x1ZGVycy5lbGxpcHNvaWQuaXNTY2FsZWRTcGFjZVBvaW50VmlzaWJsZVBvc3NpYmx5VW5kZXJFbGxpcHNvaWQoXG4gICAgICAgIG9jY2x1ZGVlUG9pbnRJblNjYWxlZFNwYWNlLFxuICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24ubWluaW11bUhlaWdodFxuICAgICAgKVxuICAgICkge1xuICAgICAgcmV0dXJuIHZpc2liaWxpdHk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFZpc2liaWxpdHkuTk9ORTtcbiAgfVxuXG4gIHJldHVybiB2aXNpYmlsaXR5O1xufTtcblxuLyoqXG4gKiBEZXRlcm1pbmVzIGlmIHRoZSBnaXZlbiB0aWxlIGNhbiBiZSByZWZpbmVkXG4gKiBAcGFyYW0ge1F1YWR0cmVlVGlsZX0gdGlsZSBUaGUgdGlsZSB0byBjaGVjay5cbiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHRoZSB0aWxlIGNhbiBiZSByZWZpbmVkLCBmYWxzZSBpZiBpdCBjYW5ub3QuXG4gKi9cbkdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGUuY2FuUmVmaW5lID0gZnVuY3Rpb24gKHRpbGUpIHtcbiAgLy8gT25seSBhbGxvdyByZWZpbmVtZW50IGl0IHdlIGtub3cgd2hldGhlciBvciBub3QgdGhlIGNoaWxkcmVuIG9mIHRoaXMgdGlsZSBleGlzdC5cbiAgLy8gRm9yIGEgdGlsZXNldCB3aXRoIGBhdmFpbGFiaWxpdHlgLCB3ZSdsbCBhbHdheXMgYmUgYWJsZSB0byByZWZpbmUuXG4gIC8vIFdlIGNhbiBhc2sgZm9yIGF2YWlsYWJpbGl0eSBvZiBfYW55XyBjaGlsZCB0aWxlIGJlY2F1c2Ugd2Ugb25seSBuZWVkIHRvIGNvbmZpcm1cbiAgLy8gdGhhdCB3ZSBnZXQgYSB5ZXMgb3Igbm8gYW5zd2VyLCBpdCBkb2Vzbid0IG1hdHRlciB3aGF0IHRoZSBhbnN3ZXIgaXMuXG4gIGlmIChkZWZpbmVkKHRpbGUuZGF0YS50ZXJyYWluRGF0YSkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICB2YXIgY2hpbGRBdmFpbGFibGUgPSB0aGlzLnRlcnJhaW5Qcm92aWRlci5nZXRUaWxlRGF0YUF2YWlsYWJsZShcbiAgICB0aWxlLnggKiAyLFxuICAgIHRpbGUueSAqIDIsXG4gICAgdGlsZS5sZXZlbCArIDFcbiAgKTtcbiAgcmV0dXJuIGNoaWxkQXZhaWxhYmxlICE9PSB1bmRlZmluZWQ7XG59O1xuXG52YXIgcmVhZHlJbWFnZXJ5U2NyYXRjaCA9IFtdO1xudmFyIGNhblJlbmRlclRyYXZlcnNhbFN0YWNrID0gW107XG5cbi8qKlxuICogRGV0ZXJtaW5lcyBpZiB0aGUgZ2l2ZW4gbm90LWZ1bGx5LWxvYWRlZCB0aWxlIGNhbiBiZSByZW5kZXJlZCB3aXRob3V0IGxvc2luZyBkZXRhaWwgdGhhdFxuICogd2FzIHByZXNlbnQgbGFzdCBmcmFtZSBhcyBhIHJlc3VsdCBvZiByZW5kZXJpbmcgZGVzY2VuZGFudCB0aWxlcy4gVGhpcyBtZXRob2Qgd2lsbCBvbmx5IGJlXG4gKiBjYWxsZWQgaWYgdGhpcyB0aWxlJ3MgZGVzY2VuZGFudHMgd2VyZSByZW5kZXJlZCBsYXN0IGZyYW1lLiBJZiB0aGUgdGlsZSBpcyBmdWxseSBsb2FkZWQsXG4gKiBpdCBpcyBhc3N1bWVkIHRoYXQgdGhpcyBtZXRob2Qgd2lsbCByZXR1cm4gdHJ1ZSBhbmQgaXQgd2lsbCBub3QgYmUgY2FsbGVkLlxuICogQHBhcmFtIHtRdWFkdHJlZVRpbGV9IHRpbGUgVGhlIHRpbGUgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgdGlsZSBjYW4gYmUgcmVuZGVyZWQgd2l0aG91dCBsb3NpbmcgZGV0YWlsLlxuICovXG5HbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlLmNhblJlbmRlcldpdGhvdXRMb3NpbmdEZXRhaWwgPSBmdW5jdGlvbiAoXG4gIHRpbGUsXG4gIGZyYW1lU3RhdGVcbikge1xuICB2YXIgc3VyZmFjZVRpbGUgPSB0aWxlLmRhdGE7XG5cbiAgdmFyIHJlYWR5SW1hZ2VyeSA9IHJlYWR5SW1hZ2VyeVNjcmF0Y2g7XG4gIHJlYWR5SW1hZ2VyeS5sZW5ndGggPSB0aGlzLl9pbWFnZXJ5TGF5ZXJzLmxlbmd0aDtcblxuICB2YXIgdGVycmFpblJlYWR5ID0gZmFsc2U7XG4gIHZhciBpbml0aWFsSW1hZ2VyeVN0YXRlID0gZmFsc2U7XG4gIHZhciBpbWFnZXJ5O1xuXG4gIGlmIChkZWZpbmVkKHN1cmZhY2VUaWxlKSkge1xuICAgIC8vIFdlIGNhbiByZW5kZXIgZXZlbiB3aXRoIG5vbi1yZWFkeSB0ZXJyYWluIGFzIGxvbmcgYXMgYWxsIG91ciByZW5kZXJlZCBkZXNjZW5kYW50c1xuICAgIC8vIGFyZSBtaXNzaW5nIHRlcnJhaW4gZ2VvbWV0cnkgdG9vLiBpLmUuIGlmIHdlIHJlbmRlcmVkIGZpbGxzIGZvciBtb3JlIGRldGFpbGVkIHRpbGVzXG4gICAgLy8gbGFzdCBmcmFtZSwgaXQncyBvayB0byByZW5kZXIgYSBmaWxsIGZvciB0aGlzIHRpbGUgdGhpcyBmcmFtZS5cbiAgICB0ZXJyYWluUmVhZHkgPSBzdXJmYWNlVGlsZS50ZXJyYWluU3RhdGUgPT09IFRlcnJhaW5TdGF0ZS5SRUFEWTtcblxuICAgIC8vIEluaXRpYWxseSBhc3N1bWUgYWxsIGltYWdlcnkgbGF5ZXJzIGFyZSByZWFkeSwgdW5sZXNzIGltYWdlcnkgaGFzbid0IGJlZW4gaW5pdGlhbGl6ZWQgYXQgYWxsLlxuICAgIGluaXRpYWxJbWFnZXJ5U3RhdGUgPSB0cnVlO1xuXG4gICAgaW1hZ2VyeSA9IHN1cmZhY2VUaWxlLmltYWdlcnk7XG4gIH1cblxuICB2YXIgaTtcbiAgdmFyIGxlbjtcblxuICBmb3IgKGkgPSAwLCBsZW4gPSByZWFkeUltYWdlcnkubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICByZWFkeUltYWdlcnlbaV0gPSBpbml0aWFsSW1hZ2VyeVN0YXRlO1xuICB9XG5cbiAgaWYgKGRlZmluZWQoaW1hZ2VyeSkpIHtcbiAgICBmb3IgKGkgPSAwLCBsZW4gPSBpbWFnZXJ5Lmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICB2YXIgdGlsZUltYWdlcnkgPSBpbWFnZXJ5W2ldO1xuICAgICAgdmFyIGxvYWRpbmdJbWFnZXJ5ID0gdGlsZUltYWdlcnkubG9hZGluZ0ltYWdlcnk7XG4gICAgICB2YXIgaXNSZWFkeSA9XG4gICAgICAgICFkZWZpbmVkKGxvYWRpbmdJbWFnZXJ5KSB8fFxuICAgICAgICBsb2FkaW5nSW1hZ2VyeS5zdGF0ZSA9PT0gSW1hZ2VyeVN0YXRlLkZBSUxFRCB8fFxuICAgICAgICBsb2FkaW5nSW1hZ2VyeS5zdGF0ZSA9PT0gSW1hZ2VyeVN0YXRlLklOVkFMSUQ7XG4gICAgICB2YXIgbGF5ZXJJbmRleCA9ICh0aWxlSW1hZ2VyeS5sb2FkaW5nSW1hZ2VyeSB8fCB0aWxlSW1hZ2VyeS5yZWFkeUltYWdlcnkpXG4gICAgICAgIC5pbWFnZXJ5TGF5ZXIuX2xheWVySW5kZXg7XG5cbiAgICAgIC8vIEZvciBhIGxheWVyIHRvIGJlIHJlYWR5LCBhbGwgdGlsZXMgYmVsb25naW5nIHRvIHRoYXQgbGF5ZXIgbXVzdCBiZSByZWFkeS5cbiAgICAgIHJlYWR5SW1hZ2VyeVtsYXllckluZGV4XSA9IGlzUmVhZHkgJiYgcmVhZHlJbWFnZXJ5W2xheWVySW5kZXhdO1xuICAgIH1cbiAgfVxuXG4gIHZhciBsYXN0RnJhbWUgPSB0aGlzLnF1YWR0cmVlLl9sYXN0U2VsZWN0aW9uRnJhbWVOdW1iZXI7XG5cbiAgLy8gVHJhdmVyc2UgdGhlIGRlc2NlbmRhbnRzIGxvb2tpbmcgZm9yIG9uZSB3aXRoIHRlcnJhaW4gb3IgaW1hZ2VyeSB0aGF0IGlzIG5vdCBsb2FkZWQgb24gdGhpcyB0aWxlLlxuICB2YXIgc3RhY2sgPSBjYW5SZW5kZXJUcmF2ZXJzYWxTdGFjaztcbiAgc3RhY2subGVuZ3RoID0gMDtcbiAgc3RhY2sucHVzaChcbiAgICB0aWxlLnNvdXRod2VzdENoaWxkLFxuICAgIHRpbGUuc291dGhlYXN0Q2hpbGQsXG4gICAgdGlsZS5ub3J0aHdlc3RDaGlsZCxcbiAgICB0aWxlLm5vcnRoZWFzdENoaWxkXG4gICk7XG5cbiAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHtcbiAgICB2YXIgZGVzY2VuZGFudCA9IHN0YWNrLnBvcCgpO1xuICAgIHZhciBsYXN0RnJhbWVTZWxlY3Rpb25SZXN1bHQgPVxuICAgICAgZGVzY2VuZGFudC5fbGFzdFNlbGVjdGlvblJlc3VsdEZyYW1lID09PSBsYXN0RnJhbWVcbiAgICAgICAgPyBkZXNjZW5kYW50Ll9sYXN0U2VsZWN0aW9uUmVzdWx0XG4gICAgICAgIDogVGlsZVNlbGVjdGlvblJlc3VsdC5OT05FO1xuXG4gICAgaWYgKGxhc3RGcmFtZVNlbGVjdGlvblJlc3VsdCA9PT0gVGlsZVNlbGVjdGlvblJlc3VsdC5SRU5ERVJFRCkge1xuICAgICAgdmFyIGRlc2NlbmRhbnRTdXJmYWNlID0gZGVzY2VuZGFudC5kYXRhO1xuXG4gICAgICBpZiAoIWRlZmluZWQoZGVzY2VuZGFudFN1cmZhY2UpKSB7XG4gICAgICAgIC8vIERlc2NlbmRhbnQgaGFzIG5vIGRhdGEsIHNvIGl0IGNhbid0IGJsb2NrIHJlbmRlcmluZy5cbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgIXRlcnJhaW5SZWFkeSAmJlxuICAgICAgICBkZXNjZW5kYW50LmRhdGEudGVycmFpblN0YXRlID09PSBUZXJyYWluU3RhdGUuUkVBRFlcbiAgICAgICkge1xuICAgICAgICAvLyBSZW5kZXJlZCBkZXNjZW5kYW50IGhhcyByZWFsIHRlcnJhaW4sIGJ1dCB3ZSBkb24ndC4gUmVuZGVyaW5nIGlzIGJsb2NrZWQuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdmFyIGRlc2NlbmRhbnRJbWFnZXJ5ID0gZGVzY2VuZGFudC5kYXRhLmltYWdlcnk7XG4gICAgICBmb3IgKGkgPSAwLCBsZW4gPSBkZXNjZW5kYW50SW1hZ2VyeS5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICB2YXIgZGVzY2VuZGFudFRpbGVJbWFnZXJ5ID0gZGVzY2VuZGFudEltYWdlcnlbaV07XG4gICAgICAgIHZhciBkZXNjZW5kYW50TG9hZGluZ0ltYWdlcnkgPSBkZXNjZW5kYW50VGlsZUltYWdlcnkubG9hZGluZ0ltYWdlcnk7XG4gICAgICAgIHZhciBkZXNjZW5kYW50SXNSZWFkeSA9XG4gICAgICAgICAgIWRlZmluZWQoZGVzY2VuZGFudExvYWRpbmdJbWFnZXJ5KSB8fFxuICAgICAgICAgIGRlc2NlbmRhbnRMb2FkaW5nSW1hZ2VyeS5zdGF0ZSA9PT0gSW1hZ2VyeVN0YXRlLkZBSUxFRCB8fFxuICAgICAgICAgIGRlc2NlbmRhbnRMb2FkaW5nSW1hZ2VyeS5zdGF0ZSA9PT0gSW1hZ2VyeVN0YXRlLklOVkFMSUQ7XG4gICAgICAgIHZhciBkZXNjZW5kYW50TGF5ZXJJbmRleCA9IChcbiAgICAgICAgICBkZXNjZW5kYW50VGlsZUltYWdlcnkubG9hZGluZ0ltYWdlcnkgfHxcbiAgICAgICAgICBkZXNjZW5kYW50VGlsZUltYWdlcnkucmVhZHlJbWFnZXJ5XG4gICAgICAgICkuaW1hZ2VyeUxheWVyLl9sYXllckluZGV4O1xuXG4gICAgICAgIC8vIElmIHRoaXMgaW1hZ2VyeSB0aWxlIG9mIGEgZGVzY2VuZGFudCBpcyByZWFkeSBidXQgdGhlIGxheWVyIGlzbid0IHJlYWR5IGluIHRoaXMgdGlsZSxcbiAgICAgICAgLy8gdGhlbiByZW5kZXJpbmcgaXMgYmxvY2tlZC5cbiAgICAgICAgaWYgKGRlc2NlbmRhbnRJc1JlYWR5ICYmICFyZWFkeUltYWdlcnlbZGVzY2VuZGFudExheWVySW5kZXhdKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChsYXN0RnJhbWVTZWxlY3Rpb25SZXN1bHQgPT09IFRpbGVTZWxlY3Rpb25SZXN1bHQuUkVGSU5FRCkge1xuICAgICAgc3RhY2sucHVzaChcbiAgICAgICAgZGVzY2VuZGFudC5zb3V0aHdlc3RDaGlsZCxcbiAgICAgICAgZGVzY2VuZGFudC5zb3V0aGVhc3RDaGlsZCxcbiAgICAgICAgZGVzY2VuZGFudC5ub3J0aHdlc3RDaGlsZCxcbiAgICAgICAgZGVzY2VuZGFudC5ub3J0aGVhc3RDaGlsZFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnZhciB0aWxlRGlyZWN0aW9uU2NyYXRjaCA9IG5ldyBDYXJ0ZXNpYW4zKCk7XG5cbi8qKlxuICogRGV0ZXJtaW5lcyB0aGUgcHJpb3JpdHkgZm9yIGxvYWRpbmcgdGhpcyB0aWxlLiBMb3dlciBwcmlvcml0eSB2YWx1ZXMgbG9hZCBzb29uZXIuXG4gKiBAcGFyYW0ge1F1YWR0cmVlVGlsZX0gdGlsZSBUaGUgdGlsZS5cbiAqIEBwYXJhbSB7RnJhbWVTdGF0ZX0gZnJhbWVTdGF0ZSBUaGUgZnJhbWUgc3RhdGUuXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgbG9hZCBwcmlvcml0eSB2YWx1ZS5cbiAqL1xuR2xvYmVTdXJmYWNlVGlsZVByb3ZpZGVyLnByb3RvdHlwZS5jb21wdXRlVGlsZUxvYWRQcmlvcml0eSA9IGZ1bmN0aW9uIChcbiAgdGlsZSxcbiAgZnJhbWVTdGF0ZVxuKSB7XG4gIHZhciBzdXJmYWNlVGlsZSA9IHRpbGUuZGF0YTtcbiAgaWYgKHN1cmZhY2VUaWxlID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gMC4wO1xuICB9XG5cbiAgdmFyIG9iYiA9IHN1cmZhY2VUaWxlLnRpbGVCb3VuZGluZ1JlZ2lvbi5ib3VuZGluZ1ZvbHVtZTtcbiAgaWYgKG9iYiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIDAuMDtcbiAgfVxuXG4gIHZhciBjYW1lcmFQb3NpdGlvbiA9IGZyYW1lU3RhdGUuY2FtZXJhLnBvc2l0aW9uV0M7XG4gIHZhciBjYW1lcmFEaXJlY3Rpb24gPSBmcmFtZVN0YXRlLmNhbWVyYS5kaXJlY3Rpb25XQztcbiAgdmFyIHRpbGVEaXJlY3Rpb24gPSBDYXJ0ZXNpYW4zLnN1YnRyYWN0KFxuICAgIG9iYi5jZW50ZXIsXG4gICAgY2FtZXJhUG9zaXRpb24sXG4gICAgdGlsZURpcmVjdGlvblNjcmF0Y2hcbiAgKTtcbiAgdmFyIG1hZ25pdHVkZSA9IENhcnRlc2lhbjMubWFnbml0dWRlKHRpbGVEaXJlY3Rpb24pO1xuICBpZiAobWFnbml0dWRlIDwgQ2VzaXVtTWF0aC5FUFNJTE9ONSkge1xuICAgIHJldHVybiAwLjA7XG4gIH1cbiAgQ2FydGVzaWFuMy5kaXZpZGVCeVNjYWxhcih0aWxlRGlyZWN0aW9uLCBtYWduaXR1ZGUsIHRpbGVEaXJlY3Rpb24pO1xuICByZXR1cm4gKFxuICAgICgxLjAgLSBDYXJ0ZXNpYW4zLmRvdCh0aWxlRGlyZWN0aW9uLCBjYW1lcmFEaXJlY3Rpb24pKSAqIHRpbGUuX2Rpc3RhbmNlXG4gICk7XG59O1xuXG52YXIgbW9kaWZpZWRNb2RlbFZpZXdTY3JhdGNoID0gbmV3IE1hdHJpeDQoKTtcbnZhciBtb2RpZmllZE1vZGVsVmlld1Byb2plY3Rpb25TY3JhdGNoID0gbmV3IE1hdHJpeDQoKTtcbnZhciB0aWxlUmVjdGFuZ2xlU2NyYXRjaCA9IG5ldyBDYXJ0ZXNpYW40KCk7XG52YXIgbG9jYWxpemVkQ2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGVTY3JhdGNoID0gbmV3IENhcnRlc2lhbjQoKTtcbnZhciBsb2NhbGl6ZWRUcmFuc2x1Y2VuY3lSZWN0YW5nbGVTY3JhdGNoID0gbmV3IENhcnRlc2lhbjQoKTtcbnZhciBydGNTY3JhdGNoID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBjZW50ZXJFeWVTY3JhdGNoID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBzb3V0aHdlc3RTY3JhdGNoID0gbmV3IENhcnRlc2lhbjMoKTtcbnZhciBub3J0aGVhc3RTY3JhdGNoID0gbmV3IENhcnRlc2lhbjMoKTtcblxuLyoqXG4gKiBTaG93cyBhIHNwZWNpZmllZCB0aWxlIGluIHRoaXMgZnJhbWUuICBUaGUgcHJvdmlkZXIgY2FuIGNhdXNlIHRoZSB0aWxlIHRvIGJlIHNob3duIGJ5IGFkZGluZ1xuICogcmVuZGVyIGNvbW1hbmRzIHRvIHRoZSBjb21tYW5kTGlzdCwgb3IgdXNlIGFueSBvdGhlciBtZXRob2QgYXMgYXBwcm9wcmlhdGUuICBUaGUgdGlsZSBpcyBub3RcbiAqIGV4cGVjdGVkIHRvIGJlIHZpc2libGUgbmV4dCBmcmFtZSBhcyB3ZWxsLCB1bmxlc3MgdGhpcyBtZXRob2QgaXMgY2FsbGVkIG5leHQgZnJhbWUsIHRvby5cbiAqXG4gKiBAcGFyYW0ge1F1YWR0cmVlVGlsZX0gdGlsZSBUaGUgdGlsZSBpbnN0YW5jZS5cbiAqIEBwYXJhbSB7RnJhbWVTdGF0ZX0gZnJhbWVTdGF0ZSBUaGUgc3RhdGUgaW5mb3JtYXRpb24gb2YgdGhlIGN1cnJlbnQgcmVuZGVyaW5nIGZyYW1lLlxuICovXG5HbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlLnNob3dUaWxlVGhpc0ZyYW1lID0gZnVuY3Rpb24gKFxuICB0aWxlLFxuICBmcmFtZVN0YXRlXG4pIHtcbiAgdmFyIHJlYWR5VGV4dHVyZUNvdW50ID0gMDtcbiAgdmFyIHRpbGVJbWFnZXJ5Q29sbGVjdGlvbiA9IHRpbGUuZGF0YS5pbWFnZXJ5O1xuICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGlsZUltYWdlcnlDb2xsZWN0aW9uLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgdmFyIHRpbGVJbWFnZXJ5ID0gdGlsZUltYWdlcnlDb2xsZWN0aW9uW2ldO1xuICAgIGlmIChcbiAgICAgIGRlZmluZWQodGlsZUltYWdlcnkucmVhZHlJbWFnZXJ5KSAmJlxuICAgICAgdGlsZUltYWdlcnkucmVhZHlJbWFnZXJ5LmltYWdlcnlMYXllci5hbHBoYSAhPT0gMC4wXG4gICAgKSB7XG4gICAgICArK3JlYWR5VGV4dHVyZUNvdW50O1xuICAgIH1cbiAgfVxuXG4gIHZhciB0aWxlU2V0ID0gdGhpcy5fdGlsZXNUb1JlbmRlckJ5VGV4dHVyZUNvdW50W3JlYWR5VGV4dHVyZUNvdW50XTtcbiAgaWYgKCFkZWZpbmVkKHRpbGVTZXQpKSB7XG4gICAgdGlsZVNldCA9IFtdO1xuICAgIHRoaXMuX3RpbGVzVG9SZW5kZXJCeVRleHR1cmVDb3VudFtyZWFkeVRleHR1cmVDb3VudF0gPSB0aWxlU2V0O1xuICB9XG5cbiAgdGlsZVNldC5wdXNoKHRpbGUpO1xuXG4gIHZhciBzdXJmYWNlVGlsZSA9IHRpbGUuZGF0YTtcbiAgaWYgKCFkZWZpbmVkKHN1cmZhY2VUaWxlLnZlcnRleEFycmF5KSkge1xuICAgIHRoaXMuX2hhc0ZpbGxUaWxlc1RoaXNGcmFtZSA9IHRydWU7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5faGFzTG9hZGVkVGlsZXNUaGlzRnJhbWUgPSB0cnVlO1xuICB9XG5cbiAgdmFyIGRlYnVnID0gdGhpcy5fZGVidWc7XG4gICsrZGVidWcudGlsZXNSZW5kZXJlZDtcbiAgZGVidWcudGV4dHVyZXNSZW5kZXJlZCArPSByZWFkeVRleHR1cmVDb3VudDtcbn07XG5cbnZhciBjb3JuZXJQb3NpdGlvbnNTY3JhdGNoID0gW1xuICBuZXcgQ2FydGVzaWFuMygpLFxuICBuZXcgQ2FydGVzaWFuMygpLFxuICBuZXcgQ2FydGVzaWFuMygpLFxuICBuZXcgQ2FydGVzaWFuMygpLFxuXTtcblxuZnVuY3Rpb24gY29tcHV0ZU9jY2x1ZGVlUG9pbnQoXG4gIHRpbGVQcm92aWRlcixcbiAgY2VudGVyLFxuICByZWN0YW5nbGUsXG4gIG1pbmltdW1IZWlnaHQsXG4gIG1heGltdW1IZWlnaHQsXG4gIHJlc3VsdFxuKSB7XG4gIHZhciBlbGxpcHNvaWRhbE9jY2x1ZGVyID0gdGlsZVByb3ZpZGVyLnF1YWR0cmVlLl9vY2NsdWRlcnMuZWxsaXBzb2lkO1xuICB2YXIgZWxsaXBzb2lkID0gZWxsaXBzb2lkYWxPY2NsdWRlci5lbGxpcHNvaWQ7XG5cbiAgdmFyIGNvcm5lclBvc2l0aW9ucyA9IGNvcm5lclBvc2l0aW9uc1NjcmF0Y2g7XG4gIENhcnRlc2lhbjMuZnJvbVJhZGlhbnMoXG4gICAgcmVjdGFuZ2xlLndlc3QsXG4gICAgcmVjdGFuZ2xlLnNvdXRoLFxuICAgIG1heGltdW1IZWlnaHQsXG4gICAgZWxsaXBzb2lkLFxuICAgIGNvcm5lclBvc2l0aW9uc1swXVxuICApO1xuICBDYXJ0ZXNpYW4zLmZyb21SYWRpYW5zKFxuICAgIHJlY3RhbmdsZS5lYXN0LFxuICAgIHJlY3RhbmdsZS5zb3V0aCxcbiAgICBtYXhpbXVtSGVpZ2h0LFxuICAgIGVsbGlwc29pZCxcbiAgICBjb3JuZXJQb3NpdGlvbnNbMV1cbiAgKTtcbiAgQ2FydGVzaWFuMy5mcm9tUmFkaWFucyhcbiAgICByZWN0YW5nbGUud2VzdCxcbiAgICByZWN0YW5nbGUubm9ydGgsXG4gICAgbWF4aW11bUhlaWdodCxcbiAgICBlbGxpcHNvaWQsXG4gICAgY29ybmVyUG9zaXRpb25zWzJdXG4gICk7XG4gIENhcnRlc2lhbjMuZnJvbVJhZGlhbnMoXG4gICAgcmVjdGFuZ2xlLmVhc3QsXG4gICAgcmVjdGFuZ2xlLm5vcnRoLFxuICAgIG1heGltdW1IZWlnaHQsXG4gICAgZWxsaXBzb2lkLFxuICAgIGNvcm5lclBvc2l0aW9uc1szXVxuICApO1xuXG4gIHJldHVybiBlbGxpcHNvaWRhbE9jY2x1ZGVyLmNvbXB1dGVIb3Jpem9uQ3VsbGluZ1BvaW50UG9zc2libHlVbmRlckVsbGlwc29pZChcbiAgICBjZW50ZXIsXG4gICAgY29ybmVyUG9zaXRpb25zLFxuICAgIG1pbmltdW1IZWlnaHQsXG4gICAgcmVzdWx0XG4gICk7XG59XG5cbi8qKlxuICogR2V0cyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgY2FtZXJhIHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSB0aWxlLiAgVGhpcyBpcyB1c2VkIGZvciBsZXZlbC1vZi1kZXRhaWwgc2VsZWN0aW9uLlxuICpcbiAqIEBwYXJhbSB7UXVhZHRyZWVUaWxlfSB0aWxlIFRoZSB0aWxlIGluc3RhbmNlLlxuICogQHBhcmFtIHtGcmFtZVN0YXRlfSBmcmFtZVN0YXRlIFRoZSBzdGF0ZSBpbmZvcm1hdGlvbiBvZiB0aGUgY3VycmVudCByZW5kZXJpbmcgZnJhbWUuXG4gKlxuICogQHJldHVybnMge051bWJlcn0gVGhlIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYSB0byB0aGUgY2xvc2VzdCBwb2ludCBvbiB0aGUgdGlsZSwgaW4gbWV0ZXJzLlxuICovXG5HbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlLmNvbXB1dGVEaXN0YW5jZVRvVGlsZSA9IGZ1bmN0aW9uIChcbiAgdGlsZSxcbiAgZnJhbWVTdGF0ZVxuKSB7XG4gIC8vIFRoZSBkaXN0YW5jZSBzaG91bGQgYmU6XG4gIC8vIDEuIHRoZSBhY3R1YWwgZGlzdGFuY2UgdG8gdGhlIHRpZ2h0LWZpdHRpbmcgYm91bmRpbmcgdm9sdW1lLCBvclxuICAvLyAyLiBhIGRpc3RhbmNlIHRoYXQgaXMgZXF1YWwgdG8gb3IgZ3JlYXRlciB0aGFuIHRoZSBhY3R1YWwgZGlzdGFuY2UgdG8gdGhlIHRpZ2h0LWZpdHRpbmcgYm91bmRpbmcgdm9sdW1lLlxuICAvL1xuICAvLyBXaGVuIHdlIGRvbid0IGtub3cgdGhlIG1pbi9tYXggaGVpZ2h0cyBmb3IgYSB0aWxlLCBidXQgd2UgZG8ga25vdyB0aGUgbWluL21heCBvZiBhbiBhbmNlc3RvciB0aWxlLCB3ZSBjYW5cbiAgLy8gYnVpbGQgYSB0aWdodC1maXR0aW5nIGJvdW5kaW5nIHZvbHVtZSBob3Jpem9udGFsbHksIGJ1dCBub3QgdmVydGljYWxseS4gVGhlIG1pbi9tYXggaGVpZ2h0cyBmcm9tIHRoZVxuICAvLyBhbmNlc3RvciB3aWxsIGxpa2VseSBmb3JtIGEgdm9sdW1lIHRoYXQgaXMgbXVjaCBiaWdnZXIgdGhhbiBpdCBuZWVkcyB0byBiZS4gVGhpcyBtZWFucyB0aGF0IHRoZSB2b2x1bWUgbWF5XG4gIC8vIGJlIGRlZW1lZCB0byBiZSBtdWNoIGNsb3NlciB0byB0aGUgY2FtZXJhIHRoYW4gaXQgcmVhbGx5IGlzLCBjYXVzaW5nIHVzIHRvIHNlbGVjdCB0aWxlcyB0aGF0IGFyZSB0b28gZGV0YWlsZWQuXG4gIC8vIExvYWRpbmcgdG9vLWRldGFpbGVkIHRpbGVzIGlzIHN1cGVyIGV4cGVuc2l2ZSwgc28gd2UgZG9uJ3Qgd2FudCB0byBkbyB0aGF0LiBXZSBkb24ndCBrbm93IHdoZXJlIHRoZSBjaGlsZFxuICAvLyB0aWxlIHJlYWxseSBsaWVzIHdpdGhpbiB0aGUgcGFyZW50IHJhbmdlIG9mIGhlaWdodHMsIGJ1dCB3ZSBfZG9fIGtub3cgdGhlIGNoaWxkIHRpbGUgY2FuJ3QgYmUgYW55IGNsb3NlciB0aGFuXG4gIC8vIHRoZSBhbmNlc3RvciBoZWlnaHQgc3VyZmFjZSAobWluIG9yIG1heCkgdGhhdCBpcyBfZmFydGhlc3QgYXdheV8gZnJvbSB0aGUgY2FtZXJhLiBTbyBpZiB3ZSBjb21wdXRlIGRpc3RhbmNlXG4gIC8vIGJhc2VkIG9uIHRoYXQgY29uc2VydmF0aXZlIG1ldHJpYywgd2UgbWF5IGVuZCB1cCBsb2FkaW5nIHRpbGVzIHRoYXQgYXJlIG5vdCBkZXRhaWxlZCBlbm91Z2gsIGJ1dCB0aGF0J3MgbXVjaFxuICAvLyBiZXR0ZXIgKGZhc3RlcikgdGhhbiBsb2FkaW5nIHRpbGVzIHRoYXQgYXJlIHRvbyBkZXRhaWxlZC5cblxuICB1cGRhdGVUaWxlQm91bmRpbmdSZWdpb24odGlsZSwgdGhpcywgZnJhbWVTdGF0ZSk7XG5cbiAgdmFyIHN1cmZhY2VUaWxlID0gdGlsZS5kYXRhO1xuICB2YXIgYm91bmRpbmdWb2x1bWVTb3VyY2VUaWxlID0gc3VyZmFjZVRpbGUuYm91bmRpbmdWb2x1bWVTb3VyY2VUaWxlO1xuICBpZiAoYm91bmRpbmdWb2x1bWVTb3VyY2VUaWxlID09PSB1bmRlZmluZWQpIHtcbiAgICAvLyBDYW4ndCBmaW5kIGFueSBtaW4vbWF4IGhlaWdodHMgYW55d2hlcmU/IE9rLCBsZXQncyBqdXN0IHNheSB0aGVcbiAgICAvLyB0aWxlIGlzIHJlYWxseSBmYXIgYXdheSBzbyB3ZSdsbCBsb2FkIGFuZCByZW5kZXIgaXQgcmF0aGVyIHRoYW5cbiAgICAvLyByZWZpbmluZy5cbiAgICByZXR1cm4gOTk5OTk5OTk5OS4wO1xuICB9XG5cbiAgdmFyIHRpbGVCb3VuZGluZ1JlZ2lvbiA9IHN1cmZhY2VUaWxlLnRpbGVCb3VuZGluZ1JlZ2lvbjtcbiAgdmFyIG1pbiA9IHRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0O1xuICB2YXIgbWF4ID0gdGlsZUJvdW5kaW5nUmVnaW9uLm1heGltdW1IZWlnaHQ7XG5cbiAgaWYgKHN1cmZhY2VUaWxlLmJvdW5kaW5nVm9sdW1lU291cmNlVGlsZSAhPT0gdGlsZSkge1xuICAgIHZhciBjYW1lcmFIZWlnaHQgPSBmcmFtZVN0YXRlLmNhbWVyYS5wb3NpdGlvbkNhcnRvZ3JhcGhpYy5oZWlnaHQ7XG4gICAgdmFyIGRpc3RhbmNlVG9NaW4gPSBNYXRoLmFicyhjYW1lcmFIZWlnaHQgLSBtaW4pO1xuICAgIHZhciBkaXN0YW5jZVRvTWF4ID0gTWF0aC5hYnMoY2FtZXJhSGVpZ2h0IC0gbWF4KTtcbiAgICBpZiAoZGlzdGFuY2VUb01pbiA+IGRpc3RhbmNlVG9NYXgpIHtcbiAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0ID0gbWluO1xuICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLm1heGltdW1IZWlnaHQgPSBtaW47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0ID0gbWF4O1xuICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLm1heGltdW1IZWlnaHQgPSBtYXg7XG4gICAgfVxuICB9XG5cbiAgdmFyIHJlc3VsdCA9IHRpbGVCb3VuZGluZ1JlZ2lvbi5kaXN0YW5jZVRvQ2FtZXJhKGZyYW1lU3RhdGUpO1xuXG4gIHRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0ID0gbWluO1xuICB0aWxlQm91bmRpbmdSZWdpb24ubWF4aW11bUhlaWdodCA9IG1heDtcblxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuZnVuY3Rpb24gdXBkYXRlVGlsZUJvdW5kaW5nUmVnaW9uKHRpbGUsIHRpbGVQcm92aWRlciwgZnJhbWVTdGF0ZSkge1xuICB2YXIgc3VyZmFjZVRpbGUgPSB0aWxlLmRhdGE7XG4gIGlmIChzdXJmYWNlVGlsZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgc3VyZmFjZVRpbGUgPSB0aWxlLmRhdGEgPSBuZXcgR2xvYmVTdXJmYWNlVGlsZSgpO1xuICB9XG5cbiAgdmFyIGVsbGlwc29pZCA9IHRpbGUudGlsaW5nU2NoZW1lLmVsbGlwc29pZDtcbiAgaWYgKHN1cmZhY2VUaWxlLnRpbGVCb3VuZGluZ1JlZ2lvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgc3VyZmFjZVRpbGUudGlsZUJvdW5kaW5nUmVnaW9uID0gbmV3IFRpbGVCb3VuZGluZ1JlZ2lvbih7XG4gICAgICBjb21wdXRlQm91bmRpbmdWb2x1bWVzOiBmYWxzZSxcbiAgICAgIHJlY3RhbmdsZTogdGlsZS5yZWN0YW5nbGUsXG4gICAgICBlbGxpcHNvaWQ6IGVsbGlwc29pZCxcbiAgICAgIG1pbmltdW1IZWlnaHQ6IDAuMCxcbiAgICAgIG1heGltdW1IZWlnaHQ6IDAuMCxcbiAgICB9KTtcbiAgfVxuXG4gIHZhciB0aWxlQm91bmRpbmdSZWdpb24gPSBzdXJmYWNlVGlsZS50aWxlQm91bmRpbmdSZWdpb247XG4gIHZhciBvbGRNaW5pbXVtSGVpZ2h0ID0gdGlsZUJvdW5kaW5nUmVnaW9uLm1pbmltdW1IZWlnaHQ7XG4gIHZhciBvbGRNYXhpbXVtSGVpZ2h0ID0gdGlsZUJvdW5kaW5nUmVnaW9uLm1heGltdW1IZWlnaHQ7XG4gIHZhciBoYXNCb3VuZGluZ1ZvbHVtZXNGcm9tTWVzaCA9IGZhbHNlO1xuICB2YXIgc291cmNlVGlsZSA9IHRpbGU7XG5cbiAgLy8gR2V0IG1pbiBhbmQgbWF4IGhlaWdodHMgZnJvbSB0aGUgbWVzaC5cbiAgLy8gSWYgdGhlIG1lc2ggaXMgbm90IGF2YWlsYWJsZSwgZ2V0IHRoZW0gZnJvbSB0aGUgdGVycmFpbiBkYXRhLlxuICAvLyBJZiB0aGUgdGVycmFpbiBkYXRhIGlzIG5vdCBhdmFpbGFibGUgZWl0aGVyLCBnZXQgdGhlbSBmcm9tIGFuIGFuY2VzdG9yLlxuICAvLyBJZiBub25lIG9mIHRoZSBhbmNlc3RvcnMgYXJlIGF2YWlsYWJsZSwgdGhlbiB0aGVyZSBhcmUgbm8gbWluIGFuZCBtYXggaGVpZ2h0cyBmb3IgdGhpcyB0aWxlIGF0IHRoaXMgdGltZS5cbiAgdmFyIG1lc2ggPSBzdXJmYWNlVGlsZS5tZXNoO1xuICB2YXIgdGVycmFpbkRhdGEgPSBzdXJmYWNlVGlsZS50ZXJyYWluRGF0YTtcbiAgaWYgKFxuICAgIG1lc2ggIT09IHVuZGVmaW5lZCAmJlxuICAgIG1lc2gubWluaW11bUhlaWdodCAhPT0gdW5kZWZpbmVkICYmXG4gICAgbWVzaC5tYXhpbXVtSGVpZ2h0ICE9PSB1bmRlZmluZWRcbiAgKSB7XG4gICAgdGlsZUJvdW5kaW5nUmVnaW9uLm1pbmltdW1IZWlnaHQgPSBtZXNoLm1pbmltdW1IZWlnaHQ7XG4gICAgdGlsZUJvdW5kaW5nUmVnaW9uLm1heGltdW1IZWlnaHQgPSBtZXNoLm1heGltdW1IZWlnaHQ7XG4gICAgaGFzQm91bmRpbmdWb2x1bWVzRnJvbU1lc2ggPSB0cnVlO1xuICB9IGVsc2UgaWYgKFxuICAgIHRlcnJhaW5EYXRhICE9PSB1bmRlZmluZWQgJiZcbiAgICB0ZXJyYWluRGF0YS5fbWluaW11bUhlaWdodCAhPT0gdW5kZWZpbmVkICYmXG4gICAgdGVycmFpbkRhdGEuX21heGltdW1IZWlnaHQgIT09IHVuZGVmaW5lZFxuICApIHtcbiAgICB0aWxlQm91bmRpbmdSZWdpb24ubWluaW11bUhlaWdodCA9IHRlcnJhaW5EYXRhLl9taW5pbXVtSGVpZ2h0O1xuICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5tYXhpbXVtSGVpZ2h0ID0gdGVycmFpbkRhdGEuX21heGltdW1IZWlnaHQ7XG4gIH0gZWxzZSB7XG4gICAgLy8gTm8gYWNjdXJhdGUgbWluL21heCBoZWlnaHRzIGF2YWlsYWJsZSwgc28gd2UncmUgc3R1Y2sgd2l0aCBtaW4vbWF4IGhlaWdodHMgZnJvbSBhbiBhbmNlc3RvciB0aWxlLlxuICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0ID0gTnVtYmVyLk5hTjtcbiAgICB0aWxlQm91bmRpbmdSZWdpb24ubWF4aW11bUhlaWdodCA9IE51bWJlci5OYU47XG5cbiAgICB2YXIgYW5jZXN0b3JUaWxlID0gdGlsZS5wYXJlbnQ7XG4gICAgd2hpbGUgKGFuY2VzdG9yVGlsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB2YXIgYW5jZXN0b3JTdXJmYWNlVGlsZSA9IGFuY2VzdG9yVGlsZS5kYXRhO1xuICAgICAgaWYgKGFuY2VzdG9yU3VyZmFjZVRpbGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB2YXIgYW5jZXN0b3JNZXNoID0gYW5jZXN0b3JTdXJmYWNlVGlsZS5tZXNoO1xuICAgICAgICB2YXIgYW5jZXN0b3JUZXJyYWluRGF0YSA9IGFuY2VzdG9yU3VyZmFjZVRpbGUudGVycmFpbkRhdGE7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBhbmNlc3Rvck1lc2ggIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGFuY2VzdG9yTWVzaC5taW5pbXVtSGVpZ2h0ICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBhbmNlc3Rvck1lc2gubWF4aW11bUhlaWdodCAhPT0gdW5kZWZpbmVkXG4gICAgICAgICkge1xuICAgICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0ID0gYW5jZXN0b3JNZXNoLm1pbmltdW1IZWlnaHQ7XG4gICAgICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLm1heGltdW1IZWlnaHQgPSBhbmNlc3Rvck1lc2gubWF4aW11bUhlaWdodDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICBhbmNlc3RvclRlcnJhaW5EYXRhICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBhbmNlc3RvclRlcnJhaW5EYXRhLl9taW5pbXVtSGVpZ2h0ICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBhbmNlc3RvclRlcnJhaW5EYXRhLl9tYXhpbXVtSGVpZ2h0ICE9PSB1bmRlZmluZWRcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLm1pbmltdW1IZWlnaHQgPSBhbmNlc3RvclRlcnJhaW5EYXRhLl9taW5pbXVtSGVpZ2h0O1xuICAgICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5tYXhpbXVtSGVpZ2h0ID0gYW5jZXN0b3JUZXJyYWluRGF0YS5fbWF4aW11bUhlaWdodDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYW5jZXN0b3JUaWxlID0gYW5jZXN0b3JUaWxlLnBhcmVudDtcbiAgICB9XG4gICAgc291cmNlVGlsZSA9IGFuY2VzdG9yVGlsZTtcbiAgfVxuXG4gIC8vIFVwZGF0ZSBib3VuZGluZyByZWdpb25zIGZyb20gdGhlIG1pbiBhbmQgbWF4IGhlaWdodHNcbiAgaWYgKHNvdXJjZVRpbGUgIT09IHVuZGVmaW5lZCkge1xuICAgIHZhciBleGFnZ2VyYXRpb24gPSBmcmFtZVN0YXRlLnRlcnJhaW5FeGFnZ2VyYXRpb247XG4gICAgdmFyIGV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0ID1cbiAgICAgIGZyYW1lU3RhdGUudGVycmFpbkV4YWdnZXJhdGlvblJlbGF0aXZlSGVpZ2h0O1xuICAgIHZhciBoYXNFeGFnZ2VyYXRpb24gPSBleGFnZ2VyYXRpb24gIT09IDEuMDtcbiAgICBpZiAoaGFzRXhhZ2dlcmF0aW9uKSB7XG4gICAgICBoYXNCb3VuZGluZ1ZvbHVtZXNGcm9tTWVzaCA9IGZhbHNlO1xuICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLm1pbmltdW1IZWlnaHQgPSBUZXJyYWluRXhhZ2dlcmF0aW9uLmdldEhlaWdodChcbiAgICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLm1pbmltdW1IZWlnaHQsXG4gICAgICAgIGV4YWdnZXJhdGlvbixcbiAgICAgICAgZXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHRcbiAgICAgICk7XG4gICAgICB0aWxlQm91bmRpbmdSZWdpb24ubWF4aW11bUhlaWdodCA9IFRlcnJhaW5FeGFnZ2VyYXRpb24uZ2V0SGVpZ2h0KFxuICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24ubWF4aW11bUhlaWdodCxcbiAgICAgICAgZXhhZ2dlcmF0aW9uLFxuICAgICAgICBleGFnZ2VyYXRpb25SZWxhdGl2ZUhlaWdodFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoaGFzQm91bmRpbmdWb2x1bWVzRnJvbU1lc2gpIHtcbiAgICAgIGlmICghc3VyZmFjZVRpbGUuYm91bmRpbmdWb2x1bWVJc0Zyb21NZXNoKSB7XG4gICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5fb3JpZW50ZWRCb3VuZGluZ0JveCA9IE9yaWVudGVkQm91bmRpbmdCb3guY2xvbmUoXG4gICAgICAgICAgbWVzaC5vcmllbnRlZEJvdW5kaW5nQm94LFxuICAgICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5fb3JpZW50ZWRCb3VuZGluZ0JveFxuICAgICAgICApO1xuICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24uX2JvdW5kaW5nU3BoZXJlID0gQm91bmRpbmdTcGhlcmUuY2xvbmUoXG4gICAgICAgICAgbWVzaC5ib3VuZGluZ1NwaGVyZTNELFxuICAgICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5fYm91bmRpbmdTcGhlcmVcbiAgICAgICAgKTtcbiAgICAgICAgc3VyZmFjZVRpbGUub2NjbHVkZWVQb2ludEluU2NhbGVkU3BhY2UgPSBDYXJ0ZXNpYW4zLmNsb25lKFxuICAgICAgICAgIG1lc2gub2NjbHVkZWVQb2ludEluU2NhbGVkU3BhY2UsXG4gICAgICAgICAgc3VyZmFjZVRpbGUub2NjbHVkZWVQb2ludEluU2NhbGVkU3BhY2VcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBJZiB0aGUgb2NjbHVkZWUgcG9pbnQgaXMgbm90IGRlZmluZWQsIGZhbGxiYWNrIHRvIGNhbGN1bGF0aW5nIGl0IGZyb20gdGhlIE9CQlxuICAgICAgICBpZiAoIWRlZmluZWQoc3VyZmFjZVRpbGUub2NjbHVkZWVQb2ludEluU2NhbGVkU3BhY2UpKSB7XG4gICAgICAgICAgc3VyZmFjZVRpbGUub2NjbHVkZWVQb2ludEluU2NhbGVkU3BhY2UgPSBjb21wdXRlT2NjbHVkZWVQb2ludChcbiAgICAgICAgICAgIHRpbGVQcm92aWRlcixcbiAgICAgICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5fb3JpZW50ZWRCb3VuZGluZ0JveC5jZW50ZXIsXG4gICAgICAgICAgICB0aWxlLnJlY3RhbmdsZSxcbiAgICAgICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0LFxuICAgICAgICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLm1heGltdW1IZWlnaHQsXG4gICAgICAgICAgICBzdXJmYWNlVGlsZS5vY2NsdWRlZVBvaW50SW5TY2FsZWRTcGFjZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIG5lZWRzQm91bmRzID1cbiAgICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLl9vcmllbnRlZEJvdW5kaW5nQm94ID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLl9ib3VuZGluZ1NwaGVyZSA9PT0gdW5kZWZpbmVkO1xuICAgICAgdmFyIGhlaWdodENoYW5nZWQgPVxuICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24ubWluaW11bUhlaWdodCAhPT0gb2xkTWluaW11bUhlaWdodCB8fFxuICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24ubWF4aW11bUhlaWdodCAhPT0gb2xkTWF4aW11bUhlaWdodDtcbiAgICAgIGlmIChoZWlnaHRDaGFuZ2VkIHx8IG5lZWRzQm91bmRzKSB7XG4gICAgICAgIC8vIEJvdW5kaW5nIHZvbHVtZXMgbmVlZCB0byBiZSByZWNvbXB1dGVkIGluIHNvbWUgY2lyY3Vtc3RhbmNlc1xuICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24uY29tcHV0ZUJvdW5kaW5nVm9sdW1lcyhlbGxpcHNvaWQpO1xuICAgICAgICBzdXJmYWNlVGlsZS5vY2NsdWRlZVBvaW50SW5TY2FsZWRTcGFjZSA9IGNvbXB1dGVPY2NsdWRlZVBvaW50KFxuICAgICAgICAgIHRpbGVQcm92aWRlcixcbiAgICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24uX29yaWVudGVkQm91bmRpbmdCb3guY2VudGVyLFxuICAgICAgICAgIHRpbGUucmVjdGFuZ2xlLFxuICAgICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0LFxuICAgICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5tYXhpbXVtSGVpZ2h0LFxuICAgICAgICAgIHN1cmZhY2VUaWxlLm9jY2x1ZGVlUG9pbnRJblNjYWxlZFNwYWNlXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIHN1cmZhY2VUaWxlLmJvdW5kaW5nVm9sdW1lU291cmNlVGlsZSA9IHNvdXJjZVRpbGU7XG4gICAgc3VyZmFjZVRpbGUuYm91bmRpbmdWb2x1bWVJc0Zyb21NZXNoID0gaGFzQm91bmRpbmdWb2x1bWVzRnJvbU1lc2g7XG4gIH0gZWxzZSB7XG4gICAgc3VyZmFjZVRpbGUuYm91bmRpbmdWb2x1bWVTb3VyY2VUaWxlID0gdW5kZWZpbmVkO1xuICAgIHN1cmZhY2VUaWxlLmJvdW5kaW5nVm9sdW1lSXNGcm9tTWVzaCA9IGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQ7IG90aGVyd2lzZSwgZmFsc2UuXG4gKiA8YnIgLz48YnIgLz5cbiAqIElmIHRoaXMgb2JqZWN0IHdhcyBkZXN0cm95ZWQsIGl0IHNob3VsZCBub3QgYmUgdXNlZDsgY2FsbGluZyBhbnkgZnVuY3Rpb24gb3RoZXIgdGhhblxuICogPGNvZGU+aXNEZXN0cm95ZWQ8L2NvZGU+IHdpbGwgcmVzdWx0IGluIGEge0BsaW5rIERldmVsb3BlckVycm9yfSBleGNlcHRpb24uXG4gKlxuICogQHJldHVybnMge0Jvb2xlYW59IFRydWUgaWYgdGhpcyBvYmplY3Qgd2FzIGRlc3Ryb3llZDsgb3RoZXJ3aXNlLCBmYWxzZS5cbiAqXG4gKiBAc2VlIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlciNkZXN0cm95XG4gKi9cbkdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGUuaXNEZXN0cm95ZWQgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8qKlxuICogRGVzdHJveXMgdGhlIFdlYkdMIHJlc291cmNlcyBoZWxkIGJ5IHRoaXMgb2JqZWN0LiAgRGVzdHJveWluZyBhbiBvYmplY3QgYWxsb3dzIGZvciBkZXRlcm1pbmlzdGljXG4gKiByZWxlYXNlIG9mIFdlYkdMIHJlc291cmNlcywgaW5zdGVhZCBvZiByZWx5aW5nIG9uIHRoZSBnYXJiYWdlIGNvbGxlY3RvciB0byBkZXN0cm95IHRoaXMgb2JqZWN0LlxuICogPGJyIC8+PGJyIC8+XG4gKiBPbmNlIGFuIG9iamVjdCBpcyBkZXN0cm95ZWQsIGl0IHNob3VsZCBub3QgYmUgdXNlZDsgY2FsbGluZyBhbnkgZnVuY3Rpb24gb3RoZXIgdGhhblxuICogPGNvZGU+aXNEZXN0cm95ZWQ8L2NvZGU+IHdpbGwgcmVzdWx0IGluIGEge0BsaW5rIERldmVsb3BlckVycm9yfSBleGNlcHRpb24uICBUaGVyZWZvcmUsXG4gKiBhc3NpZ24gdGhlIHJldHVybiB2YWx1ZSAoPGNvZGU+dW5kZWZpbmVkPC9jb2RlPikgdG8gdGhlIG9iamVjdCBhcyBkb25lIGluIHRoZSBleGFtcGxlLlxuICpcbiAqIEBleGNlcHRpb24ge0RldmVsb3BlckVycm9yfSBUaGlzIG9iamVjdCB3YXMgZGVzdHJveWVkLCBpLmUuLCBkZXN0cm95KCkgd2FzIGNhbGxlZC5cbiAqXG4gKlxuICogQGV4YW1wbGVcbiAqIHByb3ZpZGVyID0gcHJvdmlkZXIgJiYgcHJvdmlkZXIoKTtcbiAqXG4gKiBAc2VlIEdsb2JlU3VyZmFjZVRpbGVQcm92aWRlciNpc0Rlc3Ryb3llZFxuICovXG5HbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuX3RpbGVQcm92aWRlciA9IHRoaXMuX3RpbGVQcm92aWRlciAmJiB0aGlzLl90aWxlUHJvdmlkZXIuZGVzdHJveSgpO1xuICB0aGlzLl9jbGlwcGluZ1BsYW5lcyA9IHRoaXMuX2NsaXBwaW5nUGxhbmVzICYmIHRoaXMuX2NsaXBwaW5nUGxhbmVzLmRlc3Ryb3koKTtcblxuICByZXR1cm4gZGVzdHJveU9iamVjdCh0aGlzKTtcbn07XG5cbmZ1bmN0aW9uIGdldFRpbGVSZWFkeUNhbGxiYWNrKHRpbGVJbWFnZXJpZXNUb0ZyZWUsIGxheWVyLCB0ZXJyYWluUHJvdmlkZXIpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0aWxlKSB7XG4gICAgdmFyIHRpbGVJbWFnZXJ5O1xuICAgIHZhciBpbWFnZXJ5O1xuICAgIHZhciBzdGFydEluZGV4ID0gLTE7XG4gICAgdmFyIHRpbGVJbWFnZXJ5Q29sbGVjdGlvbiA9IHRpbGUuZGF0YS5pbWFnZXJ5O1xuICAgIHZhciBsZW5ndGggPSB0aWxlSW1hZ2VyeUNvbGxlY3Rpb24ubGVuZ3RoO1xuICAgIHZhciBpO1xuICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgdGlsZUltYWdlcnkgPSB0aWxlSW1hZ2VyeUNvbGxlY3Rpb25baV07XG4gICAgICBpbWFnZXJ5ID0gZGVmYXVsdFZhbHVlKFxuICAgICAgICB0aWxlSW1hZ2VyeS5yZWFkeUltYWdlcnksXG4gICAgICAgIHRpbGVJbWFnZXJ5LmxvYWRpbmdJbWFnZXJ5XG4gICAgICApO1xuICAgICAgaWYgKGltYWdlcnkuaW1hZ2VyeUxheWVyID09PSBsYXllcikge1xuICAgICAgICBzdGFydEluZGV4ID0gaTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHN0YXJ0SW5kZXggIT09IC0xKSB7XG4gICAgICB2YXIgZW5kSW5kZXggPSBzdGFydEluZGV4ICsgdGlsZUltYWdlcmllc1RvRnJlZTtcbiAgICAgIHRpbGVJbWFnZXJ5ID0gdGlsZUltYWdlcnlDb2xsZWN0aW9uW2VuZEluZGV4XTtcbiAgICAgIGltYWdlcnkgPSBkZWZpbmVkKHRpbGVJbWFnZXJ5KVxuICAgICAgICA/IGRlZmF1bHRWYWx1ZSh0aWxlSW1hZ2VyeS5yZWFkeUltYWdlcnksIHRpbGVJbWFnZXJ5LmxvYWRpbmdJbWFnZXJ5KVxuICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgIGlmICghZGVmaW5lZChpbWFnZXJ5KSB8fCBpbWFnZXJ5LmltYWdlcnlMYXllciAhPT0gbGF5ZXIpIHtcbiAgICAgICAgLy8gUmV0dXJuIGZhbHNlIHRvIGtlZXAgdGhlIGNhbGxiYWNrIGlmIHdlIGhhdmUgdG8gd2FpdCBvbiB0aGUgc2tlbGV0b25zXG4gICAgICAgIC8vIFJldHVybiB0cnVlIHRvIHJlbW92ZSB0aGUgY2FsbGJhY2sgaWYgc29tZXRoaW5nIHdlbnQgd3JvbmdcbiAgICAgICAgcmV0dXJuICFsYXllci5fY3JlYXRlVGlsZUltYWdlcnlTa2VsZXRvbnMoXG4gICAgICAgICAgdGlsZSxcbiAgICAgICAgICB0ZXJyYWluUHJvdmlkZXIsXG4gICAgICAgICAgZW5kSW5kZXhcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgZm9yIChpID0gc3RhcnRJbmRleDsgaSA8IGVuZEluZGV4OyArK2kpIHtcbiAgICAgICAgdGlsZUltYWdlcnlDb2xsZWN0aW9uW2ldLmZyZWVSZXNvdXJjZXMoKTtcbiAgICAgIH1cblxuICAgICAgdGlsZUltYWdlcnlDb2xsZWN0aW9uLnNwbGljZShzdGFydEluZGV4LCB0aWxlSW1hZ2VyaWVzVG9GcmVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTsgLy8gRXZlcnl0aGluZyBpcyBkb25lLCBzbyByZW1vdmUgdGhlIGNhbGxiYWNrXG4gIH07XG59XG5cbkdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGUuX29uTGF5ZXJBZGRlZCA9IGZ1bmN0aW9uIChsYXllciwgaW5kZXgpIHtcbiAgaWYgKGxheWVyLnNob3cpIHtcbiAgICB2YXIgdGVycmFpblByb3ZpZGVyID0gdGhpcy5fdGVycmFpblByb3ZpZGVyO1xuXG4gICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgIHZhciBpbWFnZXJ5UHJvdmlkZXIgPSBsYXllci5pbWFnZXJ5UHJvdmlkZXI7XG4gICAgdmFyIHRpbGVJbWFnZXJ5VXBkYXRlZEV2ZW50ID0gdGhpcy5faW1hZ2VyeUxheWVyc1VwZGF0ZWRFdmVudDtcbiAgICBpbWFnZXJ5UHJvdmlkZXIuX3JlbG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIENsZWFyIHRoZSBsYXllcidzIGNhY2hlXG4gICAgICBsYXllci5faW1hZ2VyeUNhY2hlID0ge307XG5cbiAgICAgIHRoYXQuX3F1YWR0cmVlLmZvckVhY2hMb2FkZWRUaWxlKGZ1bmN0aW9uICh0aWxlKSB7XG4gICAgICAgIC8vIElmIHRoaXMgbGF5ZXIgaXMgc3RpbGwgd2FpdGluZyB0byBmb3IgdGhlIGxvYWRlZCBjYWxsYmFjaywganVzdCByZXR1cm5cbiAgICAgICAgaWYgKGRlZmluZWQodGlsZS5fbG9hZGVkQ2FsbGJhY2tzW2xheWVyLl9sYXllckluZGV4XSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaTtcblxuICAgICAgICAvLyBGaWd1cmUgb3V0IGhvdyBtYW55IFRpbGVJbWFnZXJpZXMgd2Ugd2lsbCBuZWVkIHRvIHJlbW92ZSBhbmQgd2hlcmUgdG8gaW5zZXJ0IG5ldyBvbmVzXG4gICAgICAgIHZhciB0aWxlSW1hZ2VyeUNvbGxlY3Rpb24gPSB0aWxlLmRhdGEuaW1hZ2VyeTtcbiAgICAgICAgdmFyIGxlbmd0aCA9IHRpbGVJbWFnZXJ5Q29sbGVjdGlvbi5sZW5ndGg7XG4gICAgICAgIHZhciBzdGFydEluZGV4ID0gLTE7XG4gICAgICAgIHZhciB0aWxlSW1hZ2VyaWVzVG9GcmVlID0gMDtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgdmFyIHRpbGVJbWFnZXJ5ID0gdGlsZUltYWdlcnlDb2xsZWN0aW9uW2ldO1xuICAgICAgICAgIHZhciBpbWFnZXJ5ID0gZGVmYXVsdFZhbHVlKFxuICAgICAgICAgICAgdGlsZUltYWdlcnkucmVhZHlJbWFnZXJ5LFxuICAgICAgICAgICAgdGlsZUltYWdlcnkubG9hZGluZ0ltYWdlcnlcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChpbWFnZXJ5LmltYWdlcnlMYXllciA9PT0gbGF5ZXIpIHtcbiAgICAgICAgICAgIGlmIChzdGFydEluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgICBzdGFydEluZGV4ID0gaTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgKyt0aWxlSW1hZ2VyaWVzVG9GcmVlO1xuICAgICAgICAgIH0gZWxzZSBpZiAoc3RhcnRJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIC8vIGl0ZXJhdGVkIHBhc3QgdGhlIHNlY3Rpb24gb2YgVGlsZUltYWdlcmllcyBiZWxvbmdpbmcgdG8gdGhpcyBsYXllciwgbm8gbmVlZCB0byBjb250aW51ZS5cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdGFydEluZGV4ID09PSAtMSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEluc2VydCBpbW1lZGlhdGVseSBhZnRlciBleGlzdGluZyBUaWxlSW1hZ2VyaWVzXG4gICAgICAgIHZhciBpbnNlcnRpb25Qb2ludCA9IHN0YXJ0SW5kZXggKyB0aWxlSW1hZ2VyaWVzVG9GcmVlO1xuXG4gICAgICAgIC8vIENyZWF0ZSBuZXcgVGlsZUltYWdlcmllcyBmb3IgYWxsIGxvYWRlZCB0aWxlc1xuICAgICAgICBpZiAoXG4gICAgICAgICAgbGF5ZXIuX2NyZWF0ZVRpbGVJbWFnZXJ5U2tlbGV0b25zKFxuICAgICAgICAgICAgdGlsZSxcbiAgICAgICAgICAgIHRlcnJhaW5Qcm92aWRlcixcbiAgICAgICAgICAgIGluc2VydGlvblBvaW50XG4gICAgICAgICAgKVxuICAgICAgICApIHtcbiAgICAgICAgICAvLyBBZGQgY2FsbGJhY2sgdG8gcmVtb3ZlIG9sZCBUaWxlSW1hZ2VyaWVzIHdoZW4gdGhlIG5ldyBUaWxlSW1hZ2VyaWVzIGFyZSByZWFkeVxuICAgICAgICAgIHRpbGUuX2xvYWRlZENhbGxiYWNrc1tsYXllci5fbGF5ZXJJbmRleF0gPSBnZXRUaWxlUmVhZHlDYWxsYmFjayhcbiAgICAgICAgICAgIHRpbGVJbWFnZXJpZXNUb0ZyZWUsXG4gICAgICAgICAgICBsYXllcixcbiAgICAgICAgICAgIHRlcnJhaW5Qcm92aWRlclxuICAgICAgICAgICk7XG5cbiAgICAgICAgICB0aWxlLnN0YXRlID0gUXVhZHRyZWVUaWxlTG9hZFN0YXRlLkxPQURJTkc7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvLyBjcmVhdGUgVGlsZUltYWdlcmllcyBmb3IgdGhpcyBsYXllciBmb3IgYWxsIHByZXZpb3VzbHkgbG9hZGVkIHRpbGVzXG4gICAgdGhpcy5fcXVhZHRyZWUuZm9yRWFjaExvYWRlZFRpbGUoZnVuY3Rpb24gKHRpbGUpIHtcbiAgICAgIGlmIChsYXllci5fY3JlYXRlVGlsZUltYWdlcnlTa2VsZXRvbnModGlsZSwgdGVycmFpblByb3ZpZGVyKSkge1xuICAgICAgICB0aWxlLnN0YXRlID0gUXVhZHRyZWVUaWxlTG9hZFN0YXRlLkxPQURJTkc7XG5cbiAgICAgICAgLy8gVGlsZXMgdGhhdCBhcmUgbm90IGN1cnJlbnRseSBiZWluZyByZW5kZXJlZCBuZWVkIHRvIGxvYWQgdGhlIG5ldyBsYXllciBiZWZvcmUgdGhleSdyZSByZW5kZXJhYmxlLlxuICAgICAgICAvLyBXZSBkb24ndCBtYXJrIHRoZSByZW5kZXJlZCB0aWxlcyBub24tcmVuZGVyYWJsZSwgdGhvdWdoLCBiZWNhdXNlIHRoYXQgd291bGQgbWFrZSB0aGUgZ2xvYmUgZGlzYXBwZWFyLlxuICAgICAgICBpZiAoXG4gICAgICAgICAgdGlsZS5sZXZlbCAhPT0gMCAmJlxuICAgICAgICAgICh0aWxlLl9sYXN0U2VsZWN0aW9uUmVzdWx0RnJhbWUgIT09XG4gICAgICAgICAgICB0aGF0LnF1YWR0cmVlLl9sYXN0U2VsZWN0aW9uRnJhbWVOdW1iZXIgfHxcbiAgICAgICAgICAgIHRpbGUuX2xhc3RTZWxlY3Rpb25SZXN1bHQgIT09IFRpbGVTZWxlY3Rpb25SZXN1bHQuUkVOREVSRUQpXG4gICAgICAgICkge1xuICAgICAgICAgIHRpbGUucmVuZGVyYWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLl9sYXllck9yZGVyQ2hhbmdlZCA9IHRydWU7XG4gICAgdGlsZUltYWdlcnlVcGRhdGVkRXZlbnQucmFpc2VFdmVudCgpO1xuICB9XG59O1xuXG5HbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIucHJvdG90eXBlLl9vbkxheWVyUmVtb3ZlZCA9IGZ1bmN0aW9uIChsYXllciwgaW5kZXgpIHtcbiAgLy8gZGVzdHJveSBUaWxlSW1hZ2VyeXMgZm9yIHRoaXMgbGF5ZXIgZm9yIGFsbCBwcmV2aW91c2x5IGxvYWRlZCB0aWxlc1xuICB0aGlzLl9xdWFkdHJlZS5mb3JFYWNoTG9hZGVkVGlsZShmdW5jdGlvbiAodGlsZSkge1xuICAgIHZhciB0aWxlSW1hZ2VyeUNvbGxlY3Rpb24gPSB0aWxlLmRhdGEuaW1hZ2VyeTtcblxuICAgIHZhciBzdGFydEluZGV4ID0gLTE7XG4gICAgdmFyIG51bURlc3Ryb3llZCA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRpbGVJbWFnZXJ5Q29sbGVjdGlvbi5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgdmFyIHRpbGVJbWFnZXJ5ID0gdGlsZUltYWdlcnlDb2xsZWN0aW9uW2ldO1xuICAgICAgdmFyIGltYWdlcnkgPSB0aWxlSW1hZ2VyeS5sb2FkaW5nSW1hZ2VyeTtcbiAgICAgIGlmICghZGVmaW5lZChpbWFnZXJ5KSkge1xuICAgICAgICBpbWFnZXJ5ID0gdGlsZUltYWdlcnkucmVhZHlJbWFnZXJ5O1xuICAgICAgfVxuICAgICAgaWYgKGltYWdlcnkuaW1hZ2VyeUxheWVyID09PSBsYXllcikge1xuICAgICAgICBpZiAoc3RhcnRJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICBzdGFydEluZGV4ID0gaTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRpbGVJbWFnZXJ5LmZyZWVSZXNvdXJjZXMoKTtcbiAgICAgICAgKytudW1EZXN0cm95ZWQ7XG4gICAgICB9IGVsc2UgaWYgKHN0YXJ0SW5kZXggIT09IC0xKSB7XG4gICAgICAgIC8vIGl0ZXJhdGVkIHBhc3QgdGhlIHNlY3Rpb24gb2YgVGlsZUltYWdlcnlzIGJlbG9uZ2luZyB0byB0aGlzIGxheWVyLCBubyBuZWVkIHRvIGNvbnRpbnVlLlxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc3RhcnRJbmRleCAhPT0gLTEpIHtcbiAgICAgIHRpbGVJbWFnZXJ5Q29sbGVjdGlvbi5zcGxpY2Uoc3RhcnRJbmRleCwgbnVtRGVzdHJveWVkKTtcbiAgICB9XG4gIH0pO1xuXG4gIGlmIChkZWZpbmVkKGxheWVyLmltYWdlcnlQcm92aWRlcikpIHtcbiAgICBsYXllci5pbWFnZXJ5UHJvdmlkZXIuX3JlbG9hZCA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHRoaXMuX2ltYWdlcnlMYXllcnNVcGRhdGVkRXZlbnQucmFpc2VFdmVudCgpO1xufTtcblxuR2xvYmVTdXJmYWNlVGlsZVByb3ZpZGVyLnByb3RvdHlwZS5fb25MYXllck1vdmVkID0gZnVuY3Rpb24gKFxuICBsYXllcixcbiAgbmV3SW5kZXgsXG4gIG9sZEluZGV4XG4pIHtcbiAgdGhpcy5fbGF5ZXJPcmRlckNoYW5nZWQgPSB0cnVlO1xuICB0aGlzLl9pbWFnZXJ5TGF5ZXJzVXBkYXRlZEV2ZW50LnJhaXNlRXZlbnQoKTtcbn07XG5cbkdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5wcm90b3R5cGUuX29uTGF5ZXJTaG93bk9ySGlkZGVuID0gZnVuY3Rpb24gKFxuICBsYXllcixcbiAgaW5kZXgsXG4gIHNob3dcbikge1xuICBpZiAoc2hvdykge1xuICAgIHRoaXMuX29uTGF5ZXJBZGRlZChsYXllciwgaW5kZXgpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuX29uTGF5ZXJSZW1vdmVkKGxheWVyLCBpbmRleCk7XG4gIH1cbn07XG5cbnZhciBzY3JhdGNoQ2xpcHBpbmdQbGFuZXNNYXRyaXggPSBuZXcgTWF0cml4NCgpO1xudmFyIHNjcmF0Y2hJbnZlcnNlVHJhbnNwb3NlQ2xpcHBpbmdQbGFuZXNNYXRyaXggPSBuZXcgTWF0cml4NCgpO1xuZnVuY3Rpb24gY3JlYXRlVGlsZVVuaWZvcm1NYXAoZnJhbWVTdGF0ZSwgZ2xvYmVTdXJmYWNlVGlsZVByb3ZpZGVyKSB7XG4gIHZhciB1bmlmb3JtTWFwID0ge1xuICAgIHVfaW5pdGlhbENvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmluaXRpYWxDb2xvcjtcbiAgICB9LFxuICAgIHVfZmlsbEhpZ2hsaWdodENvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmZpbGxIaWdobGlnaHRDb2xvcjtcbiAgICB9LFxuICAgIHVfem9vbWVkT3V0T2NlYW5TcGVjdWxhckludGVuc2l0eTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy56b29tZWRPdXRPY2VhblNwZWN1bGFySW50ZW5zaXR5O1xuICAgIH0sXG4gICAgdV9vY2Vhbk5vcm1hbE1hcDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy5vY2Vhbk5vcm1hbE1hcDtcbiAgICB9LFxuICAgIHVfbGlnaHRpbmdGYWRlRGlzdGFuY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMubGlnaHRpbmdGYWRlRGlzdGFuY2U7XG4gICAgfSxcbiAgICB1X25pZ2h0RmFkZURpc3RhbmNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLm5pZ2h0RmFkZURpc3RhbmNlO1xuICAgIH0sXG4gICAgdV9jZW50ZXIzRDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy5jZW50ZXIzRDtcbiAgICB9LFxuICAgIHVfdGVycmFpbkV4YWdnZXJhdGlvbkFuZFJlbGF0aXZlSGVpZ2h0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLnRlcnJhaW5FeGFnZ2VyYXRpb25BbmRSZWxhdGl2ZUhlaWdodDtcbiAgICB9LFxuICAgIHVfdGlsZVJlY3RhbmdsZTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy50aWxlUmVjdGFuZ2xlO1xuICAgIH0sXG4gICAgdV9tb2RpZmllZE1vZGVsVmlldzogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHZpZXdNYXRyaXggPSBmcmFtZVN0YXRlLmNvbnRleHQudW5pZm9ybVN0YXRlLnZpZXc7XG4gICAgICB2YXIgY2VudGVyRXllID0gTWF0cml4NC5tdWx0aXBseUJ5UG9pbnQoXG4gICAgICAgIHZpZXdNYXRyaXgsXG4gICAgICAgIHRoaXMucHJvcGVydGllcy5ydGMsXG4gICAgICAgIGNlbnRlckV5ZVNjcmF0Y2hcbiAgICAgICk7XG4gICAgICBNYXRyaXg0LnNldFRyYW5zbGF0aW9uKHZpZXdNYXRyaXgsIGNlbnRlckV5ZSwgbW9kaWZpZWRNb2RlbFZpZXdTY3JhdGNoKTtcbiAgICAgIHJldHVybiBtb2RpZmllZE1vZGVsVmlld1NjcmF0Y2g7XG4gICAgfSxcbiAgICB1X21vZGlmaWVkTW9kZWxWaWV3UHJvamVjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHZpZXdNYXRyaXggPSBmcmFtZVN0YXRlLmNvbnRleHQudW5pZm9ybVN0YXRlLnZpZXc7XG4gICAgICB2YXIgcHJvamVjdGlvbk1hdHJpeCA9IGZyYW1lU3RhdGUuY29udGV4dC51bmlmb3JtU3RhdGUucHJvamVjdGlvbjtcbiAgICAgIHZhciBjZW50ZXJFeWUgPSBNYXRyaXg0Lm11bHRpcGx5QnlQb2ludChcbiAgICAgICAgdmlld01hdHJpeCxcbiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzLnJ0YyxcbiAgICAgICAgY2VudGVyRXllU2NyYXRjaFxuICAgICAgKTtcbiAgICAgIE1hdHJpeDQuc2V0VHJhbnNsYXRpb24oXG4gICAgICAgIHZpZXdNYXRyaXgsXG4gICAgICAgIGNlbnRlckV5ZSxcbiAgICAgICAgbW9kaWZpZWRNb2RlbFZpZXdQcm9qZWN0aW9uU2NyYXRjaFxuICAgICAgKTtcbiAgICAgIE1hdHJpeDQubXVsdGlwbHkoXG4gICAgICAgIHByb2plY3Rpb25NYXRyaXgsXG4gICAgICAgIG1vZGlmaWVkTW9kZWxWaWV3UHJvamVjdGlvblNjcmF0Y2gsXG4gICAgICAgIG1vZGlmaWVkTW9kZWxWaWV3UHJvamVjdGlvblNjcmF0Y2hcbiAgICAgICk7XG4gICAgICByZXR1cm4gbW9kaWZpZWRNb2RlbFZpZXdQcm9qZWN0aW9uU2NyYXRjaDtcbiAgICB9LFxuICAgIHVfZGF5VGV4dHVyZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMuZGF5VGV4dHVyZXM7XG4gICAgfSxcbiAgICB1X2RheVRleHR1cmVUcmFuc2xhdGlvbkFuZFNjYWxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmRheVRleHR1cmVUcmFuc2xhdGlvbkFuZFNjYWxlO1xuICAgIH0sXG4gICAgdV9kYXlUZXh0dXJlVGV4Q29vcmRzUmVjdGFuZ2xlOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmRheVRleHR1cmVUZXhDb29yZHNSZWN0YW5nbGU7XG4gICAgfSxcbiAgICB1X2RheVRleHR1cmVVc2VXZWJNZXJjYXRvclQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMuZGF5VGV4dHVyZVVzZVdlYk1lcmNhdG9yVDtcbiAgICB9LFxuICAgIHVfZGF5VGV4dHVyZUFscGhhOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmRheVRleHR1cmVBbHBoYTtcbiAgICB9LFxuICAgIHVfZGF5VGV4dHVyZU5pZ2h0QWxwaGE6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMuZGF5VGV4dHVyZU5pZ2h0QWxwaGE7XG4gICAgfSxcbiAgICB1X2RheVRleHR1cmVEYXlBbHBoYTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy5kYXlUZXh0dXJlRGF5QWxwaGE7XG4gICAgfSxcbiAgICB1X2RheVRleHR1cmVCcmlnaHRuZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmRheVRleHR1cmVCcmlnaHRuZXNzO1xuICAgIH0sXG4gICAgdV9kYXlUZXh0dXJlQ29udHJhc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMuZGF5VGV4dHVyZUNvbnRyYXN0O1xuICAgIH0sXG4gICAgdV9kYXlUZXh0dXJlSHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmRheVRleHR1cmVIdWU7XG4gICAgfSxcbiAgICB1X2RheVRleHR1cmVTYXR1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmRheVRleHR1cmVTYXR1cmF0aW9uO1xuICAgIH0sXG4gICAgdV9kYXlUZXh0dXJlT25lT3ZlckdhbW1hOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmRheVRleHR1cmVPbmVPdmVyR2FtbWE7XG4gICAgfSxcbiAgICB1X2RheUludGVuc2l0eTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy5kYXlJbnRlbnNpdHk7XG4gICAgfSxcbiAgICB1X3NvdXRoQW5kTm9ydGhMYXRpdHVkZTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy5zb3V0aEFuZE5vcnRoTGF0aXR1ZGU7XG4gICAgfSxcbiAgICB1X3NvdXRoTWVyY2F0b3JZQW5kT25lT3ZlckhlaWdodDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy5zb3V0aE1lcmNhdG9yWUFuZE9uZU92ZXJIZWlnaHQ7XG4gICAgfSxcbiAgICB1X3dhdGVyTWFzazogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy53YXRlck1hc2s7XG4gICAgfSxcbiAgICB1X3dhdGVyTWFza1RyYW5zbGF0aW9uQW5kU2NhbGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMud2F0ZXJNYXNrVHJhbnNsYXRpb25BbmRTY2FsZTtcbiAgICB9LFxuICAgIHVfbWluTWF4SGVpZ2h0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLm1pbk1heEhlaWdodDtcbiAgICB9LFxuICAgIHVfc2NhbGVBbmRCaWFzOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLnNjYWxlQW5kQmlhcztcbiAgICB9LFxuICAgIHVfZGF5VGV4dHVyZVNwbGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmRheVRleHR1cmVTcGxpdDtcbiAgICB9LFxuICAgIHVfZGF5VGV4dHVyZUN1dG91dFJlY3RhbmdsZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMuZGF5VGV4dHVyZUN1dG91dFJlY3RhbmdsZXM7XG4gICAgfSxcbiAgICB1X2NsaXBwaW5nUGxhbmVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgY2xpcHBpbmdQbGFuZXMgPSBnbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIuX2NsaXBwaW5nUGxhbmVzO1xuICAgICAgaWYgKGRlZmluZWQoY2xpcHBpbmdQbGFuZXMpICYmIGRlZmluZWQoY2xpcHBpbmdQbGFuZXMudGV4dHVyZSkpIHtcbiAgICAgICAgLy8gQ2hlY2sgaW4gY2FzZSBjbGlwcGluZ1BsYW5lcyBoYXNuJ3QgYmVlbiB1cGRhdGVkIHlldC5cbiAgICAgICAgcmV0dXJuIGNsaXBwaW5nUGxhbmVzLnRleHR1cmU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZnJhbWVTdGF0ZS5jb250ZXh0LmRlZmF1bHRUZXh0dXJlO1xuICAgIH0sXG4gICAgdV9jYXJ0b2dyYXBoaWNMaW1pdFJlY3RhbmdsZTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy5sb2NhbGl6ZWRDYXJ0b2dyYXBoaWNMaW1pdFJlY3RhbmdsZTtcbiAgICB9LFxuICAgIHVfY2xpcHBpbmdQbGFuZXNNYXRyaXg6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjbGlwcGluZ1BsYW5lcyA9IGdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5fY2xpcHBpbmdQbGFuZXM7XG4gICAgICB2YXIgdHJhbnNmb3JtID0gZGVmaW5lZChjbGlwcGluZ1BsYW5lcylcbiAgICAgICAgPyBNYXRyaXg0Lm11bHRpcGx5KFxuICAgICAgICAgICAgZnJhbWVTdGF0ZS5jb250ZXh0LnVuaWZvcm1TdGF0ZS52aWV3LFxuICAgICAgICAgICAgY2xpcHBpbmdQbGFuZXMubW9kZWxNYXRyaXgsXG4gICAgICAgICAgICBzY3JhdGNoQ2xpcHBpbmdQbGFuZXNNYXRyaXhcbiAgICAgICAgICApXG4gICAgICAgIDogTWF0cml4NC5JREVOVElUWTtcblxuICAgICAgcmV0dXJuIE1hdHJpeDQuaW52ZXJzZVRyYW5zcG9zZShcbiAgICAgICAgdHJhbnNmb3JtLFxuICAgICAgICBzY3JhdGNoSW52ZXJzZVRyYW5zcG9zZUNsaXBwaW5nUGxhbmVzTWF0cml4XG4gICAgICApO1xuICAgIH0sXG4gICAgdV9jbGlwcGluZ1BsYW5lc0VkZ2VTdHlsZTogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN0eWxlID0gdGhpcy5wcm9wZXJ0aWVzLmNsaXBwaW5nUGxhbmVzRWRnZUNvbG9yO1xuICAgICAgc3R5bGUuYWxwaGEgPSB0aGlzLnByb3BlcnRpZXMuY2xpcHBpbmdQbGFuZXNFZGdlV2lkdGg7XG4gICAgICByZXR1cm4gc3R5bGU7XG4gICAgfSxcbiAgICB1X21pbmltdW1CcmlnaHRuZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZnJhbWVTdGF0ZS5mb2cubWluaW11bUJyaWdodG5lc3M7XG4gICAgfSxcbiAgICB1X2hzYlNoaWZ0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmhzYlNoaWZ0O1xuICAgIH0sXG4gICAgdV9jb2xvcnNUb0FscGhhOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmNvbG9yc1RvQWxwaGE7XG4gICAgfSxcbiAgICB1X2Zyb250RmFjZUFscGhhQnlEaXN0YW5jZTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy5mcm9udEZhY2VBbHBoYUJ5RGlzdGFuY2U7XG4gICAgfSxcbiAgICB1X2JhY2tGYWNlQWxwaGFCeURpc3RhbmNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmJhY2tGYWNlQWxwaGFCeURpc3RhbmNlO1xuICAgIH0sXG4gICAgdV90cmFuc2x1Y2VuY3lSZWN0YW5nbGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMubG9jYWxpemVkVHJhbnNsdWNlbmN5UmVjdGFuZ2xlO1xuICAgIH0sXG4gICAgdV91bmRlcmdyb3VuZENvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLnVuZGVyZ3JvdW5kQ29sb3I7XG4gICAgfSxcbiAgICB1X3VuZGVyZ3JvdW5kQ29sb3JBbHBoYUJ5RGlzdGFuY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMudW5kZXJncm91bmRDb2xvckFscGhhQnlEaXN0YW5jZTtcbiAgICB9LFxuXG4gICAgLy8gbWFrZSBhIHNlcGFyYXRlIG9iamVjdCBzbyB0aGF0IGNoYW5nZXMgdG8gdGhlIHByb3BlcnRpZXMgYXJlIHNlZW4gb25cbiAgICAvLyBkZXJpdmVkIGNvbW1hbmRzIHRoYXQgY29tYmluZSBhbm90aGVyIHVuaWZvcm0gbWFwIHdpdGggdGhpcyBvbmUuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgaW5pdGlhbENvbG9yOiBuZXcgQ2FydGVzaWFuNCgwLjAsIDAuMCwgMC41LCAxLjApLFxuICAgICAgZmlsbEhpZ2hsaWdodENvbG9yOiBuZXcgQ29sb3IoMC4wLCAwLjAsIDAuMCwgMC4wKSxcbiAgICAgIHpvb21lZE91dE9jZWFuU3BlY3VsYXJJbnRlbnNpdHk6IDAuNSxcbiAgICAgIG9jZWFuTm9ybWFsTWFwOiB1bmRlZmluZWQsXG4gICAgICBsaWdodGluZ0ZhZGVEaXN0YW5jZTogbmV3IENhcnRlc2lhbjIoNjUwMDAwMC4wLCA5MDAwMDAwLjApLFxuICAgICAgbmlnaHRGYWRlRGlzdGFuY2U6IG5ldyBDYXJ0ZXNpYW4yKDEwMDAwMDAwLjAsIDQwMDAwMDAwLjApLFxuICAgICAgaHNiU2hpZnQ6IG5ldyBDYXJ0ZXNpYW4zKCksXG5cbiAgICAgIGNlbnRlcjNEOiB1bmRlZmluZWQsXG4gICAgICBydGM6IG5ldyBDYXJ0ZXNpYW4zKCksXG4gICAgICBtb2RpZmllZE1vZGVsVmlldzogbmV3IE1hdHJpeDQoKSxcbiAgICAgIHRpbGVSZWN0YW5nbGU6IG5ldyBDYXJ0ZXNpYW40KCksXG5cbiAgICAgIHRlcnJhaW5FeGFnZ2VyYXRpb25BbmRSZWxhdGl2ZUhlaWdodDogbmV3IENhcnRlc2lhbjIoMS4wLCAwLjApLFxuXG4gICAgICBkYXlUZXh0dXJlczogW10sXG4gICAgICBkYXlUZXh0dXJlVHJhbnNsYXRpb25BbmRTY2FsZTogW10sXG4gICAgICBkYXlUZXh0dXJlVGV4Q29vcmRzUmVjdGFuZ2xlOiBbXSxcbiAgICAgIGRheVRleHR1cmVVc2VXZWJNZXJjYXRvclQ6IFtdLFxuICAgICAgZGF5VGV4dHVyZUFscGhhOiBbXSxcbiAgICAgIGRheVRleHR1cmVOaWdodEFscGhhOiBbXSxcbiAgICAgIGRheVRleHR1cmVEYXlBbHBoYTogW10sXG4gICAgICBkYXlUZXh0dXJlQnJpZ2h0bmVzczogW10sXG4gICAgICBkYXlUZXh0dXJlQ29udHJhc3Q6IFtdLFxuICAgICAgZGF5VGV4dHVyZUh1ZTogW10sXG4gICAgICBkYXlUZXh0dXJlU2F0dXJhdGlvbjogW10sXG4gICAgICBkYXlUZXh0dXJlT25lT3ZlckdhbW1hOiBbXSxcbiAgICAgIGRheVRleHR1cmVTcGxpdDogW10sXG4gICAgICBkYXlUZXh0dXJlQ3V0b3V0UmVjdGFuZ2xlczogW10sXG4gICAgICBkYXlJbnRlbnNpdHk6IDAuMCxcbiAgICAgIGNvbG9yc1RvQWxwaGE6IFtdLFxuXG4gICAgICBzb3V0aEFuZE5vcnRoTGF0aXR1ZGU6IG5ldyBDYXJ0ZXNpYW4yKCksXG4gICAgICBzb3V0aE1lcmNhdG9yWUFuZE9uZU92ZXJIZWlnaHQ6IG5ldyBDYXJ0ZXNpYW4yKCksXG5cbiAgICAgIHdhdGVyTWFzazogdW5kZWZpbmVkLFxuICAgICAgd2F0ZXJNYXNrVHJhbnNsYXRpb25BbmRTY2FsZTogbmV3IENhcnRlc2lhbjQoKSxcblxuICAgICAgbWluTWF4SGVpZ2h0OiBuZXcgQ2FydGVzaWFuMigpLFxuICAgICAgc2NhbGVBbmRCaWFzOiBuZXcgTWF0cml4NCgpLFxuICAgICAgY2xpcHBpbmdQbGFuZXNFZGdlQ29sb3I6IENvbG9yLmNsb25lKENvbG9yLldISVRFKSxcbiAgICAgIGNsaXBwaW5nUGxhbmVzRWRnZVdpZHRoOiAwLjAsXG5cbiAgICAgIGxvY2FsaXplZENhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlOiBuZXcgQ2FydGVzaWFuNCgpLFxuXG4gICAgICBmcm9udEZhY2VBbHBoYUJ5RGlzdGFuY2U6IG5ldyBDYXJ0ZXNpYW40KCksXG4gICAgICBiYWNrRmFjZUFscGhhQnlEaXN0YW5jZTogbmV3IENhcnRlc2lhbjQoKSxcbiAgICAgIGxvY2FsaXplZFRyYW5zbHVjZW5jeVJlY3RhbmdsZTogbmV3IENhcnRlc2lhbjQoKSxcbiAgICAgIHVuZGVyZ3JvdW5kQ29sb3I6IENvbG9yLmNsb25lKENvbG9yLlRSQU5TUEFSRU5UKSxcbiAgICAgIHVuZGVyZ3JvdW5kQ29sb3JBbHBoYUJ5RGlzdGFuY2U6IG5ldyBDYXJ0ZXNpYW40KCksXG4gICAgfSxcbiAgfTtcblxuICBpZiAoZGVmaW5lZChnbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXIubWF0ZXJpYWxVbmlmb3JtTWFwKSkge1xuICAgIHJldHVybiBjb21iaW5lKHVuaWZvcm1NYXAsIGdsb2JlU3VyZmFjZVRpbGVQcm92aWRlci5tYXRlcmlhbFVuaWZvcm1NYXApO1xuICB9XG5cbiAgcmV0dXJuIHVuaWZvcm1NYXA7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVdpcmVmcmFtZVZlcnRleEFycmF5SWZOZWNlc3NhcnkoY29udGV4dCwgcHJvdmlkZXIsIHRpbGUpIHtcbiAgdmFyIHN1cmZhY2VUaWxlID0gdGlsZS5kYXRhO1xuXG4gIHZhciBtZXNoO1xuICB2YXIgdmVydGV4QXJyYXk7XG5cbiAgaWYgKGRlZmluZWQoc3VyZmFjZVRpbGUudmVydGV4QXJyYXkpKSB7XG4gICAgbWVzaCA9IHN1cmZhY2VUaWxlLm1lc2g7XG4gICAgdmVydGV4QXJyYXkgPSBzdXJmYWNlVGlsZS52ZXJ0ZXhBcnJheTtcbiAgfSBlbHNlIGlmIChcbiAgICBkZWZpbmVkKHN1cmZhY2VUaWxlLmZpbGwpICYmXG4gICAgZGVmaW5lZChzdXJmYWNlVGlsZS5maWxsLnZlcnRleEFycmF5KVxuICApIHtcbiAgICBtZXNoID0gc3VyZmFjZVRpbGUuZmlsbC5tZXNoO1xuICAgIHZlcnRleEFycmF5ID0gc3VyZmFjZVRpbGUuZmlsbC52ZXJ0ZXhBcnJheTtcbiAgfVxuXG4gIGlmICghZGVmaW5lZChtZXNoKSB8fCAhZGVmaW5lZCh2ZXJ0ZXhBcnJheSkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoZGVmaW5lZChzdXJmYWNlVGlsZS53aXJlZnJhbWVWZXJ0ZXhBcnJheSkpIHtcbiAgICBpZiAoc3VyZmFjZVRpbGUud2lyZWZyYW1lVmVydGV4QXJyYXkubWVzaCA9PT0gbWVzaCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN1cmZhY2VUaWxlLndpcmVmcmFtZVZlcnRleEFycmF5LmRlc3Ryb3koKTtcbiAgICBzdXJmYWNlVGlsZS53aXJlZnJhbWVWZXJ0ZXhBcnJheSA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHN1cmZhY2VUaWxlLndpcmVmcmFtZVZlcnRleEFycmF5ID0gY3JlYXRlV2lyZWZyYW1lVmVydGV4QXJyYXkoXG4gICAgY29udGV4dCxcbiAgICB2ZXJ0ZXhBcnJheSxcbiAgICBtZXNoXG4gICk7XG4gIHN1cmZhY2VUaWxlLndpcmVmcmFtZVZlcnRleEFycmF5Lm1lc2ggPSBtZXNoO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSB2ZXJ0ZXggYXJyYXkgZm9yIHdpcmVmcmFtZSByZW5kZXJpbmcgb2YgYSB0ZXJyYWluIHRpbGUuXG4gKlxuICogQHByaXZhdGVcbiAqXG4gKiBAcGFyYW0ge0NvbnRleHR9IGNvbnRleHQgVGhlIGNvbnRleHQgaW4gd2hpY2ggdG8gY3JlYXRlIHRoZSB2ZXJ0ZXggYXJyYXkuXG4gKiBAcGFyYW0ge1ZlcnRleEFycmF5fSB2ZXJ0ZXhBcnJheSBUaGUgZXhpc3RpbmcsIG5vbi13aXJlZnJhbWUgdmVydGV4IGFycmF5LiAgVGhlIG5ldyB2ZXJ0ZXggYXJyYXlcbiAqICAgICAgICAgICAgICAgICAgICAgIHdpbGwgc2hhcmUgdmVydGV4IGJ1ZmZlcnMgd2l0aCB0aGlzIGV4aXN0aW5nIG9uZS5cbiAqIEBwYXJhbSB7VGVycmFpbk1lc2h9IHRlcnJhaW5NZXNoIFRoZSB0ZXJyYWluIG1lc2ggY29udGFpbmluZyBub24td2lyZWZyYW1lIGluZGljZXMuXG4gKiBAcmV0dXJucyB7VmVydGV4QXJyYXl9IFRoZSB2ZXJ0ZXggYXJyYXkgZm9yIHdpcmVmcmFtZSByZW5kZXJpbmcuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVdpcmVmcmFtZVZlcnRleEFycmF5KGNvbnRleHQsIHZlcnRleEFycmF5LCB0ZXJyYWluTWVzaCkge1xuICB2YXIgaW5kaWNlcyA9IHRlcnJhaW5NZXNoLmluZGljZXM7XG5cbiAgdmFyIGdlb21ldHJ5ID0ge1xuICAgIGluZGljZXM6IGluZGljZXMsXG4gICAgcHJpbWl0aXZlVHlwZTogUHJpbWl0aXZlVHlwZS5UUklBTkdMRVMsXG4gIH07XG5cbiAgR2VvbWV0cnlQaXBlbGluZS50b1dpcmVmcmFtZShnZW9tZXRyeSk7XG5cbiAgdmFyIHdpcmVmcmFtZUluZGljZXMgPSBnZW9tZXRyeS5pbmRpY2VzO1xuICB2YXIgd2lyZWZyYW1lSW5kZXhCdWZmZXIgPSBCdWZmZXIuY3JlYXRlSW5kZXhCdWZmZXIoe1xuICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgdHlwZWRBcnJheTogd2lyZWZyYW1lSW5kaWNlcyxcbiAgICB1c2FnZTogQnVmZmVyVXNhZ2UuU1RBVElDX0RSQVcsXG4gICAgaW5kZXhEYXRhdHlwZTogSW5kZXhEYXRhdHlwZS5mcm9tU2l6ZUluQnl0ZXMoXG4gICAgICB3aXJlZnJhbWVJbmRpY2VzLkJZVEVTX1BFUl9FTEVNRU5UXG4gICAgKSxcbiAgfSk7XG4gIHJldHVybiBuZXcgVmVydGV4QXJyYXkoe1xuICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgYXR0cmlidXRlczogdmVydGV4QXJyYXkuX2F0dHJpYnV0ZXMsXG4gICAgaW5kZXhCdWZmZXI6IHdpcmVmcmFtZUluZGV4QnVmZmVyLFxuICB9KTtcbn1cblxudmFyIGdldERlYnVnT3JpZW50ZWRCb3VuZGluZ0JveDtcbnZhciBnZXREZWJ1Z0JvdW5kaW5nU3BoZXJlO1xudmFyIGRlYnVnRGVzdHJveVByaW1pdGl2ZTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGluc3RhbmNlT0JCID0gbmV3IEdlb21ldHJ5SW5zdGFuY2Uoe1xuICAgIGdlb21ldHJ5OiBCb3hPdXRsaW5lR2VvbWV0cnkuZnJvbURpbWVuc2lvbnMoe1xuICAgICAgZGltZW5zaW9uczogbmV3IENhcnRlc2lhbjMoMi4wLCAyLjAsIDIuMCksXG4gICAgfSksXG4gIH0pO1xuICB2YXIgaW5zdGFuY2VTcGhlcmUgPSBuZXcgR2VvbWV0cnlJbnN0YW5jZSh7XG4gICAgZ2VvbWV0cnk6IG5ldyBTcGhlcmVPdXRsaW5lR2VvbWV0cnkoeyByYWRpdXM6IDEuMCB9KSxcbiAgfSk7XG4gIHZhciBtb2RlbE1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7XG4gIHZhciBwcmV2aW91c1ZvbHVtZTtcbiAgdmFyIHByaW1pdGl2ZTtcblxuICBmdW5jdGlvbiBjcmVhdGVEZWJ1Z1ByaW1pdGl2ZShpbnN0YW5jZSkge1xuICAgIHJldHVybiBuZXcgUHJpbWl0aXZlKHtcbiAgICAgIGdlb21ldHJ5SW5zdGFuY2VzOiBpbnN0YW5jZSxcbiAgICAgIGFwcGVhcmFuY2U6IG5ldyBQZXJJbnN0YW5jZUNvbG9yQXBwZWFyYW5jZSh7XG4gICAgICAgIHRyYW5zbHVjZW50OiBmYWxzZSxcbiAgICAgICAgZmxhdDogdHJ1ZSxcbiAgICAgIH0pLFxuICAgICAgYXN5bmNocm9ub3VzOiBmYWxzZSxcbiAgICB9KTtcbiAgfVxuXG4gIGdldERlYnVnT3JpZW50ZWRCb3VuZGluZ0JveCA9IGZ1bmN0aW9uIChvYmIsIGNvbG9yKSB7XG4gICAgaWYgKG9iYiA9PT0gcHJldmlvdXNWb2x1bWUpIHtcbiAgICAgIHJldHVybiBwcmltaXRpdmU7XG4gICAgfVxuICAgIGRlYnVnRGVzdHJveVByaW1pdGl2ZSgpO1xuXG4gICAgcHJldmlvdXNWb2x1bWUgPSBvYmI7XG4gICAgbW9kZWxNYXRyaXggPSBNYXRyaXg0LmZyb21Sb3RhdGlvblRyYW5zbGF0aW9uKFxuICAgICAgb2JiLmhhbGZBeGVzLFxuICAgICAgb2JiLmNlbnRlcixcbiAgICAgIG1vZGVsTWF0cml4XG4gICAgKTtcblxuICAgIGluc3RhbmNlT0JCLm1vZGVsTWF0cml4ID0gbW9kZWxNYXRyaXg7XG4gICAgaW5zdGFuY2VPQkIuYXR0cmlidXRlcy5jb2xvciA9IENvbG9yR2VvbWV0cnlJbnN0YW5jZUF0dHJpYnV0ZS5mcm9tQ29sb3IoXG4gICAgICBjb2xvclxuICAgICk7XG5cbiAgICBwcmltaXRpdmUgPSBjcmVhdGVEZWJ1Z1ByaW1pdGl2ZShpbnN0YW5jZU9CQik7XG4gICAgcmV0dXJuIHByaW1pdGl2ZTtcbiAgfTtcblxuICBnZXREZWJ1Z0JvdW5kaW5nU3BoZXJlID0gZnVuY3Rpb24gKHNwaGVyZSwgY29sb3IpIHtcbiAgICBpZiAoc3BoZXJlID09PSBwcmV2aW91c1ZvbHVtZSkge1xuICAgICAgcmV0dXJuIHByaW1pdGl2ZTtcbiAgICB9XG4gICAgZGVidWdEZXN0cm95UHJpbWl0aXZlKCk7XG5cbiAgICBwcmV2aW91c1ZvbHVtZSA9IHNwaGVyZTtcbiAgICBtb2RlbE1hdHJpeCA9IE1hdHJpeDQuZnJvbVRyYW5zbGF0aW9uKHNwaGVyZS5jZW50ZXIsIG1vZGVsTWF0cml4KTtcbiAgICBtb2RlbE1hdHJpeCA9IE1hdHJpeDQubXVsdGlwbHlCeVVuaWZvcm1TY2FsZShcbiAgICAgIG1vZGVsTWF0cml4LFxuICAgICAgc3BoZXJlLnJhZGl1cyxcbiAgICAgIG1vZGVsTWF0cml4XG4gICAgKTtcblxuICAgIGluc3RhbmNlU3BoZXJlLm1vZGVsTWF0cml4ID0gbW9kZWxNYXRyaXg7XG4gICAgaW5zdGFuY2VTcGhlcmUuYXR0cmlidXRlcy5jb2xvciA9IENvbG9yR2VvbWV0cnlJbnN0YW5jZUF0dHJpYnV0ZS5mcm9tQ29sb3IoXG4gICAgICBjb2xvclxuICAgICk7XG5cbiAgICBwcmltaXRpdmUgPSBjcmVhdGVEZWJ1Z1ByaW1pdGl2ZShpbnN0YW5jZVNwaGVyZSk7XG4gICAgcmV0dXJuIHByaW1pdGl2ZTtcbiAgfTtcblxuICBkZWJ1Z0Rlc3Ryb3lQcmltaXRpdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGRlZmluZWQocHJpbWl0aXZlKSkge1xuICAgICAgcHJpbWl0aXZlLmRlc3Ryb3koKTtcbiAgICAgIHByaW1pdGl2ZSA9IHVuZGVmaW5lZDtcbiAgICAgIHByZXZpb3VzVm9sdW1lID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfTtcbn0pKCk7XG5cbnZhciBvdGhlclBhc3Nlc0luaXRpYWxDb2xvciA9IG5ldyBDYXJ0ZXNpYW40KDAuMCwgMC4wLCAwLjAsIDAuMCk7XG52YXIgc3VyZmFjZVNoYWRlclNldE9wdGlvbnNTY3JhdGNoID0ge1xuICBmcmFtZVN0YXRlOiB1bmRlZmluZWQsXG4gIHN1cmZhY2VUaWxlOiB1bmRlZmluZWQsXG4gIG51bWJlck9mRGF5VGV4dHVyZXM6IHVuZGVmaW5lZCxcbiAgYXBwbHlCcmlnaHRuZXNzOiB1bmRlZmluZWQsXG4gIGFwcGx5Q29udHJhc3Q6IHVuZGVmaW5lZCxcbiAgYXBwbHlIdWU6IHVuZGVmaW5lZCxcbiAgYXBwbHlTYXR1cmF0aW9uOiB1bmRlZmluZWQsXG4gIGFwcGx5R2FtbWE6IHVuZGVmaW5lZCxcbiAgYXBwbHlBbHBoYTogdW5kZWZpbmVkLFxuICBhcHBseURheU5pZ2h0QWxwaGE6IHVuZGVmaW5lZCxcbiAgYXBwbHlTcGxpdDogdW5kZWZpbmVkLFxuICBzaG93UmVmbGVjdGl2ZU9jZWFuOiB1bmRlZmluZWQsXG4gIHNob3dPY2VhbldhdmVzOiB1bmRlZmluZWQsXG4gIGVuYWJsZUxpZ2h0aW5nOiB1bmRlZmluZWQsXG4gIGR5bmFtaWNBdG1vc3BoZXJlTGlnaHRpbmc6IHVuZGVmaW5lZCxcbiAgZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZ0Zyb21TdW46IHVuZGVmaW5lZCxcbiAgc2hvd0dyb3VuZEF0bW9zcGhlcmU6IHVuZGVmaW5lZCxcbiAgcGVyRnJhZ21lbnRHcm91bmRBdG1vc3BoZXJlOiB1bmRlZmluZWQsXG4gIGhhc1ZlcnRleE5vcm1hbHM6IHVuZGVmaW5lZCxcbiAgdXNlV2ViTWVyY2F0b3JQcm9qZWN0aW9uOiB1bmRlZmluZWQsXG4gIGVuYWJsZUZvZzogdW5kZWZpbmVkLFxuICBlbmFibGVDbGlwcGluZ1BsYW5lczogdW5kZWZpbmVkLFxuICBjbGlwcGluZ1BsYW5lczogdW5kZWZpbmVkLFxuICBjbGlwcGVkQnlCb3VuZGFyaWVzOiB1bmRlZmluZWQsXG4gIGhhc0ltYWdlcnlMYXllckN1dG91dDogdW5kZWZpbmVkLFxuICBjb2xvckNvcnJlY3Q6IHVuZGVmaW5lZCxcbiAgY29sb3JUb0FscGhhOiB1bmRlZmluZWQsXG4gIGhhc0dlb2RldGljU3VyZmFjZU5vcm1hbHM6IHVuZGVmaW5lZCxcbiAgaGFzRXhhZ2dlcmF0aW9uOiB1bmRlZmluZWQsXG59O1xuXG52YXIgZGVmYXVsdFVuZGVyZ3JvdW5kQ29sb3IgPSBDb2xvci5UUkFOU1BBUkVOVDtcbnZhciBkZWZhdWx0dW5kZXJncm91bmRDb2xvckFscGhhQnlEaXN0YW5jZSA9IG5ldyBOZWFyRmFyU2NhbGFyKCk7XG5cbmZ1bmN0aW9uIGFkZERyYXdDb21tYW5kc0ZvclRpbGUodGlsZVByb3ZpZGVyLCB0aWxlLCBmcmFtZVN0YXRlKSB7XG4gIHZhciBzdXJmYWNlVGlsZSA9IHRpbGUuZGF0YTtcblxuICBpZiAoIWRlZmluZWQoc3VyZmFjZVRpbGUudmVydGV4QXJyYXkpKSB7XG4gICAgaWYgKHN1cmZhY2VUaWxlLmZpbGwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gTm8gZmlsbCB3YXMgY3JlYXRlZCBmb3IgdGhpcyB0aWxlLCBwcm9iYWJseSBiZWNhdXNlIHRoaXMgdGlsZSBpcyBub3QgY29ubmVjdGVkIHRvXG4gICAgICAvLyBhbnkgcmVuZGVyYWJsZSB0aWxlcy4gU28gY3JlYXRlIGEgc2ltcGxlIHRpbGUgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdGlsZSdzIHBvc3NpYmxlXG4gICAgICAvLyBoZWlnaHQgcmFuZ2UuXG4gICAgICBzdXJmYWNlVGlsZS5maWxsID0gbmV3IFRlcnJhaW5GaWxsTWVzaCh0aWxlKTtcbiAgICB9XG4gICAgc3VyZmFjZVRpbGUuZmlsbC51cGRhdGUodGlsZVByb3ZpZGVyLCBmcmFtZVN0YXRlKTtcbiAgfVxuXG4gIHZhciBjcmVkaXREaXNwbGF5ID0gZnJhbWVTdGF0ZS5jcmVkaXREaXNwbGF5O1xuXG4gIHZhciB0ZXJyYWluRGF0YSA9IHN1cmZhY2VUaWxlLnRlcnJhaW5EYXRhO1xuICBpZiAoZGVmaW5lZCh0ZXJyYWluRGF0YSkgJiYgZGVmaW5lZCh0ZXJyYWluRGF0YS5jcmVkaXRzKSkge1xuICAgIHZhciB0aWxlQ3JlZGl0cyA9IHRlcnJhaW5EYXRhLmNyZWRpdHM7XG4gICAgZm9yIChcbiAgICAgIHZhciB0aWxlQ3JlZGl0SW5kZXggPSAwLCB0aWxlQ3JlZGl0TGVuZ3RoID0gdGlsZUNyZWRpdHMubGVuZ3RoO1xuICAgICAgdGlsZUNyZWRpdEluZGV4IDwgdGlsZUNyZWRpdExlbmd0aDtcbiAgICAgICsrdGlsZUNyZWRpdEluZGV4XG4gICAgKSB7XG4gICAgICBjcmVkaXREaXNwbGF5LmFkZENyZWRpdCh0aWxlQ3JlZGl0c1t0aWxlQ3JlZGl0SW5kZXhdKTtcbiAgICB9XG4gIH1cblxuICB2YXIgbWF4VGV4dHVyZXMgPSBDb250ZXh0TGltaXRzLm1heGltdW1UZXh0dXJlSW1hZ2VVbml0cztcblxuICB2YXIgd2F0ZXJNYXNrVGV4dHVyZSA9IHN1cmZhY2VUaWxlLndhdGVyTWFza1RleHR1cmU7XG4gIHZhciB3YXRlck1hc2tUcmFuc2xhdGlvbkFuZFNjYWxlID0gc3VyZmFjZVRpbGUud2F0ZXJNYXNrVHJhbnNsYXRpb25BbmRTY2FsZTtcbiAgaWYgKCFkZWZpbmVkKHdhdGVyTWFza1RleHR1cmUpICYmIGRlZmluZWQoc3VyZmFjZVRpbGUuZmlsbCkpIHtcbiAgICB3YXRlck1hc2tUZXh0dXJlID0gc3VyZmFjZVRpbGUuZmlsbC53YXRlck1hc2tUZXh0dXJlO1xuICAgIHdhdGVyTWFza1RyYW5zbGF0aW9uQW5kU2NhbGUgPVxuICAgICAgc3VyZmFjZVRpbGUuZmlsbC53YXRlck1hc2tUcmFuc2xhdGlvbkFuZFNjYWxlO1xuICB9XG5cbiAgdmFyIGNhbWVyYVVuZGVyZ3JvdW5kID0gZnJhbWVTdGF0ZS5jYW1lcmFVbmRlcmdyb3VuZDtcblxuICB2YXIgZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZSA9IGZyYW1lU3RhdGUuZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZTtcbiAgdmFyIHRyYW5zbHVjZW50ID0gZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZS50cmFuc2x1Y2VudDtcbiAgdmFyIGZyb250RmFjZUFscGhhQnlEaXN0YW5jZSA9XG4gICAgZ2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZS5mcm9udEZhY2VBbHBoYUJ5RGlzdGFuY2U7XG4gIHZhciBiYWNrRmFjZUFscGhhQnlEaXN0YW5jZSA9IGdsb2JlVHJhbnNsdWNlbmN5U3RhdGUuYmFja0ZhY2VBbHBoYUJ5RGlzdGFuY2U7XG4gIHZhciB0cmFuc2x1Y2VuY3lSZWN0YW5nbGUgPSBnbG9iZVRyYW5zbHVjZW5jeVN0YXRlLnJlY3RhbmdsZTtcblxuICB2YXIgdW5kZXJncm91bmRDb2xvciA9IGRlZmF1bHRWYWx1ZShcbiAgICB0aWxlUHJvdmlkZXIudW5kZXJncm91bmRDb2xvcixcbiAgICBkZWZhdWx0VW5kZXJncm91bmRDb2xvclxuICApO1xuICB2YXIgdW5kZXJncm91bmRDb2xvckFscGhhQnlEaXN0YW5jZSA9IGRlZmF1bHRWYWx1ZShcbiAgICB0aWxlUHJvdmlkZXIudW5kZXJncm91bmRDb2xvckFscGhhQnlEaXN0YW5jZSxcbiAgICBkZWZhdWx0dW5kZXJncm91bmRDb2xvckFscGhhQnlEaXN0YW5jZVxuICApO1xuICB2YXIgc2hvd1VuZGVyZ3JvdW5kQ29sb3IgPVxuICAgIGlzVW5kZXJncm91bmRWaXNpYmxlKHRpbGVQcm92aWRlciwgZnJhbWVTdGF0ZSkgJiZcbiAgICBmcmFtZVN0YXRlLm1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTNEICYmXG4gICAgdW5kZXJncm91bmRDb2xvci5hbHBoYSA+IDAuMCAmJlxuICAgICh1bmRlcmdyb3VuZENvbG9yQWxwaGFCeURpc3RhbmNlLm5lYXJWYWx1ZSA+IDAuMCB8fFxuICAgICAgdW5kZXJncm91bmRDb2xvckFscGhhQnlEaXN0YW5jZS5mYXJWYWx1ZSA+IDAuMCk7XG5cbiAgdmFyIHNob3dSZWZsZWN0aXZlT2NlYW4gPVxuICAgIHRpbGVQcm92aWRlci5oYXNXYXRlck1hc2sgJiYgZGVmaW5lZCh3YXRlck1hc2tUZXh0dXJlKTtcbiAgdmFyIG9jZWFuTm9ybWFsTWFwID0gdGlsZVByb3ZpZGVyLm9jZWFuTm9ybWFsTWFwO1xuICB2YXIgc2hvd09jZWFuV2F2ZXMgPSBzaG93UmVmbGVjdGl2ZU9jZWFuICYmIGRlZmluZWQob2NlYW5Ob3JtYWxNYXApO1xuICB2YXIgaGFzVmVydGV4Tm9ybWFscyA9XG4gICAgdGlsZVByb3ZpZGVyLnRlcnJhaW5Qcm92aWRlci5yZWFkeSAmJlxuICAgIHRpbGVQcm92aWRlci50ZXJyYWluUHJvdmlkZXIuaGFzVmVydGV4Tm9ybWFscztcbiAgdmFyIGVuYWJsZUZvZyA9IGZyYW1lU3RhdGUuZm9nLmVuYWJsZWQgJiYgIWNhbWVyYVVuZGVyZ3JvdW5kO1xuICB2YXIgc2hvd0dyb3VuZEF0bW9zcGhlcmUgPVxuICAgIHRpbGVQcm92aWRlci5zaG93R3JvdW5kQXRtb3NwaGVyZSAmJiBmcmFtZVN0YXRlLm1vZGUgPT09IFNjZW5lTW9kZS5TQ0VORTNEO1xuICB2YXIgY2FzdFNoYWRvd3MgPVxuICAgIFNoYWRvd01vZGUuY2FzdFNoYWRvd3ModGlsZVByb3ZpZGVyLnNoYWRvd3MpICYmICF0cmFuc2x1Y2VudDtcbiAgdmFyIHJlY2VpdmVTaGFkb3dzID1cbiAgICBTaGFkb3dNb2RlLnJlY2VpdmVTaGFkb3dzKHRpbGVQcm92aWRlci5zaGFkb3dzKSAmJiAhdHJhbnNsdWNlbnQ7XG5cbiAgdmFyIGh1ZVNoaWZ0ID0gdGlsZVByb3ZpZGVyLmh1ZVNoaWZ0O1xuICB2YXIgc2F0dXJhdGlvblNoaWZ0ID0gdGlsZVByb3ZpZGVyLnNhdHVyYXRpb25TaGlmdDtcbiAgdmFyIGJyaWdodG5lc3NTaGlmdCA9IHRpbGVQcm92aWRlci5icmlnaHRuZXNzU2hpZnQ7XG5cbiAgdmFyIGNvbG9yQ29ycmVjdCA9ICEoXG4gICAgQ2VzaXVtTWF0aC5lcXVhbHNFcHNpbG9uKGh1ZVNoaWZ0LCAwLjAsIENlc2l1bU1hdGguRVBTSUxPTjcpICYmXG4gICAgQ2VzaXVtTWF0aC5lcXVhbHNFcHNpbG9uKHNhdHVyYXRpb25TaGlmdCwgMC4wLCBDZXNpdW1NYXRoLkVQU0lMT043KSAmJlxuICAgIENlc2l1bU1hdGguZXF1YWxzRXBzaWxvbihicmlnaHRuZXNzU2hpZnQsIDAuMCwgQ2VzaXVtTWF0aC5FUFNJTE9ONylcbiAgKTtcblxuICB2YXIgcGVyRnJhZ21lbnRHcm91bmRBdG1vc3BoZXJlID0gZmFsc2U7XG4gIGlmIChzaG93R3JvdW5kQXRtb3NwaGVyZSkge1xuICAgIHZhciBjYW1lcmFEaXN0YW5jZSA9IENhcnRlc2lhbjMubWFnbml0dWRlKGZyYW1lU3RhdGUuY2FtZXJhLnBvc2l0aW9uV0MpO1xuICAgIHZhciBmYWRlT3V0RGlzdGFuY2UgPSB0aWxlUHJvdmlkZXIubmlnaHRGYWRlT3V0RGlzdGFuY2U7XG4gICAgcGVyRnJhZ21lbnRHcm91bmRBdG1vc3BoZXJlID0gY2FtZXJhRGlzdGFuY2UgPiBmYWRlT3V0RGlzdGFuY2U7XG4gIH1cblxuICBpZiAoc2hvd1JlZmxlY3RpdmVPY2Vhbikge1xuICAgIC0tbWF4VGV4dHVyZXM7XG4gIH1cbiAgaWYgKHNob3dPY2VhbldhdmVzKSB7XG4gICAgLS1tYXhUZXh0dXJlcztcbiAgfVxuICBpZiAoXG4gICAgZGVmaW5lZChmcmFtZVN0YXRlLnNoYWRvd1N0YXRlKSAmJlxuICAgIGZyYW1lU3RhdGUuc2hhZG93U3RhdGUuc2hhZG93c0VuYWJsZWRcbiAgKSB7XG4gICAgLS1tYXhUZXh0dXJlcztcbiAgfVxuICBpZiAoXG4gICAgZGVmaW5lZCh0aWxlUHJvdmlkZXIuY2xpcHBpbmdQbGFuZXMpICYmXG4gICAgdGlsZVByb3ZpZGVyLmNsaXBwaW5nUGxhbmVzLmVuYWJsZWRcbiAgKSB7XG4gICAgLS1tYXhUZXh0dXJlcztcbiAgfVxuXG4gIG1heFRleHR1cmVzIC09IGdsb2JlVHJhbnNsdWNlbmN5U3RhdGUubnVtYmVyT2ZUZXh0dXJlVW5pZm9ybXM7XG5cbiAgdmFyIG1lc2ggPSBzdXJmYWNlVGlsZS5yZW5kZXJlZE1lc2g7XG4gIHZhciBydGMgPSBtZXNoLmNlbnRlcjtcbiAgdmFyIGVuY29kaW5nID0gbWVzaC5lbmNvZGluZztcbiAgdmFyIHRpbGVCb3VuZGluZ1JlZ2lvbiA9IHN1cmZhY2VUaWxlLnRpbGVCb3VuZGluZ1JlZ2lvbjtcblxuICB2YXIgZXhhZ2dlcmF0aW9uID0gZnJhbWVTdGF0ZS50ZXJyYWluRXhhZ2dlcmF0aW9uO1xuICB2YXIgZXhhZ2dlcmF0aW9uUmVsYXRpdmVIZWlnaHQgPSBmcmFtZVN0YXRlLnRlcnJhaW5FeGFnZ2VyYXRpb25SZWxhdGl2ZUhlaWdodDtcbiAgdmFyIGhhc0V4YWdnZXJhdGlvbiA9IGV4YWdnZXJhdGlvbiAhPT0gMS4wO1xuICB2YXIgaGFzR2VvZGV0aWNTdXJmYWNlTm9ybWFscyA9IGVuY29kaW5nLmhhc0dlb2RldGljU3VyZmFjZU5vcm1hbHM7XG5cbiAgLy8gTm90IHVzZWQgaW4gM0QuXG4gIHZhciB0aWxlUmVjdGFuZ2xlID0gdGlsZVJlY3RhbmdsZVNjcmF0Y2g7XG5cbiAgLy8gT25seSB1c2VkIGZvciBNZXJjYXRvciBwcm9qZWN0aW9ucy5cbiAgdmFyIHNvdXRoTGF0aXR1ZGUgPSAwLjA7XG4gIHZhciBub3J0aExhdGl0dWRlID0gMC4wO1xuICB2YXIgc291dGhNZXJjYXRvclkgPSAwLjA7XG4gIHZhciBvbmVPdmVyTWVyY2F0b3JIZWlnaHQgPSAwLjA7XG5cbiAgdmFyIHVzZVdlYk1lcmNhdG9yUHJvamVjdGlvbiA9IGZhbHNlO1xuXG4gIGlmIChmcmFtZVN0YXRlLm1vZGUgIT09IFNjZW5lTW9kZS5TQ0VORTNEKSB7XG4gICAgdmFyIHByb2plY3Rpb24gPSBmcmFtZVN0YXRlLm1hcFByb2plY3Rpb247XG4gICAgdmFyIHNvdXRod2VzdCA9IHByb2plY3Rpb24ucHJvamVjdChcbiAgICAgIFJlY3RhbmdsZS5zb3V0aHdlc3QodGlsZS5yZWN0YW5nbGUpLFxuICAgICAgc291dGh3ZXN0U2NyYXRjaFxuICAgICk7XG4gICAgdmFyIG5vcnRoZWFzdCA9IHByb2plY3Rpb24ucHJvamVjdChcbiAgICAgIFJlY3RhbmdsZS5ub3J0aGVhc3QodGlsZS5yZWN0YW5nbGUpLFxuICAgICAgbm9ydGhlYXN0U2NyYXRjaFxuICAgICk7XG5cbiAgICB0aWxlUmVjdGFuZ2xlLnggPSBzb3V0aHdlc3QueDtcbiAgICB0aWxlUmVjdGFuZ2xlLnkgPSBzb3V0aHdlc3QueTtcbiAgICB0aWxlUmVjdGFuZ2xlLnogPSBub3J0aGVhc3QueDtcbiAgICB0aWxlUmVjdGFuZ2xlLncgPSBub3J0aGVhc3QueTtcblxuICAgIC8vIEluIDJEIGFuZCBDb2x1bWJ1cyBWaWV3LCB1c2UgdGhlIGNlbnRlciBvZiB0aGUgdGlsZSBmb3IgUlRDIHJlbmRlcmluZy5cbiAgICBpZiAoZnJhbWVTdGF0ZS5tb2RlICE9PSBTY2VuZU1vZGUuTU9SUEhJTkcpIHtcbiAgICAgIHJ0YyA9IHJ0Y1NjcmF0Y2g7XG4gICAgICBydGMueCA9IDAuMDtcbiAgICAgIHJ0Yy55ID0gKHRpbGVSZWN0YW5nbGUueiArIHRpbGVSZWN0YW5nbGUueCkgKiAwLjU7XG4gICAgICBydGMueiA9ICh0aWxlUmVjdGFuZ2xlLncgKyB0aWxlUmVjdGFuZ2xlLnkpICogMC41O1xuICAgICAgdGlsZVJlY3RhbmdsZS54IC09IHJ0Yy55O1xuICAgICAgdGlsZVJlY3RhbmdsZS55IC09IHJ0Yy56O1xuICAgICAgdGlsZVJlY3RhbmdsZS56IC09IHJ0Yy55O1xuICAgICAgdGlsZVJlY3RhbmdsZS53IC09IHJ0Yy56O1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGZyYW1lU3RhdGUubW9kZSA9PT0gU2NlbmVNb2RlLlNDRU5FMkQgJiZcbiAgICAgIGVuY29kaW5nLnF1YW50aXphdGlvbiA9PT0gVGVycmFpblF1YW50aXphdGlvbi5CSVRTMTJcbiAgICApIHtcbiAgICAgIC8vIEluIDJELCB0aGUgdGV4dHVyZSBjb29yZGluYXRlcyBvZiB0aGUgdGlsZSBhcmUgaW50ZXJwb2xhdGVkIG92ZXIgdGhlIHJlY3RhbmdsZSB0byBnZXQgdGhlIHBvc2l0aW9uIGluIHRoZSB2ZXJ0ZXggc2hhZGVyLlxuICAgICAgLy8gV2hlbiB0aGUgdGV4dHVyZSBjb29yZGluYXRlcyBhcmUgcXVhbnRpemVkLCBlcnJvciBpcyBpbnRyb2R1Y2VkLiBUaGlzIGNhbiBiZSBzZWVuIHRocm91Z2ggdGhlIDFweCB3aWRlIGNyYWNraW5nXG4gICAgICAvLyBiZXR3ZWVuIHRoZSBxdWFudGl6ZWQgdGlsZXMgaW4gMkQuIFRvIGNvbXBlbnNhdGUgZm9yIHRoZSBlcnJvciwgbW92ZSB0aGUgZXhwYW5kIHRoZSByZWN0YW5nbGUgaW4gZWFjaCBkaXJlY3Rpb24gYnlcbiAgICAgIC8vIGhhbGYgdGhlIGVycm9yIGFtb3VudC5cbiAgICAgIHZhciBlcHNpbG9uID0gKDEuMCAvIChNYXRoLnBvdygyLjAsIDEyLjApIC0gMS4wKSkgKiAwLjU7XG4gICAgICB2YXIgd2lkdGhFcHNpbG9uID0gKHRpbGVSZWN0YW5nbGUueiAtIHRpbGVSZWN0YW5nbGUueCkgKiBlcHNpbG9uO1xuICAgICAgdmFyIGhlaWdodEVwc2lsb24gPSAodGlsZVJlY3RhbmdsZS53IC0gdGlsZVJlY3RhbmdsZS55KSAqIGVwc2lsb247XG4gICAgICB0aWxlUmVjdGFuZ2xlLnggLT0gd2lkdGhFcHNpbG9uO1xuICAgICAgdGlsZVJlY3RhbmdsZS55IC09IGhlaWdodEVwc2lsb247XG4gICAgICB0aWxlUmVjdGFuZ2xlLnogKz0gd2lkdGhFcHNpbG9uO1xuICAgICAgdGlsZVJlY3RhbmdsZS53ICs9IGhlaWdodEVwc2lsb247XG4gICAgfVxuXG4gICAgaWYgKHByb2plY3Rpb24gaW5zdGFuY2VvZiBXZWJNZXJjYXRvclByb2plY3Rpb24pIHtcbiAgICAgIHNvdXRoTGF0aXR1ZGUgPSB0aWxlLnJlY3RhbmdsZS5zb3V0aDtcbiAgICAgIG5vcnRoTGF0aXR1ZGUgPSB0aWxlLnJlY3RhbmdsZS5ub3J0aDtcblxuICAgICAgc291dGhNZXJjYXRvclkgPSBXZWJNZXJjYXRvclByb2plY3Rpb24uZ2VvZGV0aWNMYXRpdHVkZVRvTWVyY2F0b3JBbmdsZShcbiAgICAgICAgc291dGhMYXRpdHVkZVxuICAgICAgKTtcblxuICAgICAgb25lT3Zlck1lcmNhdG9ySGVpZ2h0ID1cbiAgICAgICAgMS4wIC9cbiAgICAgICAgKFdlYk1lcmNhdG9yUHJvamVjdGlvbi5nZW9kZXRpY0xhdGl0dWRlVG9NZXJjYXRvckFuZ2xlKG5vcnRoTGF0aXR1ZGUpIC1cbiAgICAgICAgICBzb3V0aE1lcmNhdG9yWSk7XG5cbiAgICAgIHVzZVdlYk1lcmNhdG9yUHJvamVjdGlvbiA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgdmFyIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zID0gc3VyZmFjZVNoYWRlclNldE9wdGlvbnNTY3JhdGNoO1xuICBzdXJmYWNlU2hhZGVyU2V0T3B0aW9ucy5mcmFtZVN0YXRlID0gZnJhbWVTdGF0ZTtcbiAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMuc3VyZmFjZVRpbGUgPSBzdXJmYWNlVGlsZTtcbiAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMuc2hvd1JlZmxlY3RpdmVPY2VhbiA9IHNob3dSZWZsZWN0aXZlT2NlYW47XG4gIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLnNob3dPY2VhbldhdmVzID0gc2hvd09jZWFuV2F2ZXM7XG4gIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLmVuYWJsZUxpZ2h0aW5nID0gdGlsZVByb3ZpZGVyLmVuYWJsZUxpZ2h0aW5nO1xuICBzdXJmYWNlU2hhZGVyU2V0T3B0aW9ucy5keW5hbWljQXRtb3NwaGVyZUxpZ2h0aW5nID1cbiAgICB0aWxlUHJvdmlkZXIuZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZztcbiAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMuZHluYW1pY0F0bW9zcGhlcmVMaWdodGluZ0Zyb21TdW4gPVxuICAgIHRpbGVQcm92aWRlci5keW5hbWljQXRtb3NwaGVyZUxpZ2h0aW5nRnJvbVN1bjtcbiAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMuc2hvd0dyb3VuZEF0bW9zcGhlcmUgPSBzaG93R3JvdW5kQXRtb3NwaGVyZTtcbiAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMucGVyRnJhZ21lbnRHcm91bmRBdG1vc3BoZXJlID0gcGVyRnJhZ21lbnRHcm91bmRBdG1vc3BoZXJlO1xuICBzdXJmYWNlU2hhZGVyU2V0T3B0aW9ucy5oYXNWZXJ0ZXhOb3JtYWxzID0gaGFzVmVydGV4Tm9ybWFscztcbiAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMudXNlV2ViTWVyY2F0b3JQcm9qZWN0aW9uID0gdXNlV2ViTWVyY2F0b3JQcm9qZWN0aW9uO1xuICBzdXJmYWNlU2hhZGVyU2V0T3B0aW9ucy5jbGlwcGVkQnlCb3VuZGFyaWVzID0gc3VyZmFjZVRpbGUuY2xpcHBlZEJ5Qm91bmRhcmllcztcbiAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMuaGFzR2VvZGV0aWNTdXJmYWNlTm9ybWFscyA9IGhhc0dlb2RldGljU3VyZmFjZU5vcm1hbHM7XG4gIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLmhhc0V4YWdnZXJhdGlvbiA9IGhhc0V4YWdnZXJhdGlvbjtcblxuICB2YXIgdGlsZUltYWdlcnlDb2xsZWN0aW9uID0gc3VyZmFjZVRpbGUuaW1hZ2VyeTtcbiAgdmFyIGltYWdlcnlJbmRleCA9IDA7XG4gIHZhciBpbWFnZXJ5TGVuID0gdGlsZUltYWdlcnlDb2xsZWN0aW9uLmxlbmd0aDtcblxuICB2YXIgc2hvd1NraXJ0cyA9XG4gICAgdGlsZVByb3ZpZGVyLnNob3dTa2lydHMgJiYgIWNhbWVyYVVuZGVyZ3JvdW5kICYmICF0cmFuc2x1Y2VudDtcbiAgdmFyIGJhY2tGYWNlQ3VsbGluZyA9XG4gICAgdGlsZVByb3ZpZGVyLmJhY2tGYWNlQ3VsbGluZyAmJiAhY2FtZXJhVW5kZXJncm91bmQgJiYgIXRyYW5zbHVjZW50O1xuICB2YXIgZmlyc3RQYXNzUmVuZGVyU3RhdGUgPSBiYWNrRmFjZUN1bGxpbmdcbiAgICA/IHRpbGVQcm92aWRlci5fcmVuZGVyU3RhdGVcbiAgICA6IHRpbGVQcm92aWRlci5fZGlzYWJsZUN1bGxpbmdSZW5kZXJTdGF0ZTtcbiAgdmFyIG90aGVyUGFzc2VzUmVuZGVyU3RhdGUgPSBiYWNrRmFjZUN1bGxpbmdcbiAgICA/IHRpbGVQcm92aWRlci5fYmxlbmRSZW5kZXJTdGF0ZVxuICAgIDogdGlsZVByb3ZpZGVyLl9kaXNhYmxlQ3VsbGluZ0JsZW5kUmVuZGVyU3RhdGU7XG4gIHZhciByZW5kZXJTdGF0ZSA9IGZpcnN0UGFzc1JlbmRlclN0YXRlO1xuXG4gIHZhciBpbml0aWFsQ29sb3IgPSB0aWxlUHJvdmlkZXIuX2ZpcnN0UGFzc0luaXRpYWxDb2xvcjtcblxuICB2YXIgY29udGV4dCA9IGZyYW1lU3RhdGUuY29udGV4dDtcblxuICBpZiAoIWRlZmluZWQodGlsZVByb3ZpZGVyLl9kZWJ1Zy5ib3VuZGluZ1NwaGVyZVRpbGUpKSB7XG4gICAgZGVidWdEZXN0cm95UHJpbWl0aXZlKCk7XG4gIH1cblxuICB2YXIgbWF0ZXJpYWxVbmlmb3JtTWFwQ2hhbmdlZCA9XG4gICAgdGlsZVByb3ZpZGVyLl9tYXRlcmlhbFVuaWZvcm1NYXAgIT09IHRpbGVQcm92aWRlci5tYXRlcmlhbFVuaWZvcm1NYXA7XG4gIGlmIChtYXRlcmlhbFVuaWZvcm1NYXBDaGFuZ2VkKSB7XG4gICAgdGlsZVByb3ZpZGVyLl9tYXRlcmlhbFVuaWZvcm1NYXAgPSB0aWxlUHJvdmlkZXIubWF0ZXJpYWxVbmlmb3JtTWFwO1xuICAgIHZhciBkcmF3Q29tbWFuZHNMZW5ndGggPSB0aWxlUHJvdmlkZXIuX2RyYXdDb21tYW5kcy5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkcmF3Q29tbWFuZHNMZW5ndGg7ICsraSkge1xuICAgICAgdGlsZVByb3ZpZGVyLl91bmlmb3JtTWFwc1tpXSA9IGNyZWF0ZVRpbGVVbmlmb3JtTWFwKFxuICAgICAgICBmcmFtZVN0YXRlLFxuICAgICAgICB0aWxlUHJvdmlkZXJcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgZG8ge1xuICAgIHZhciBudW1iZXJPZkRheVRleHR1cmVzID0gMDtcblxuICAgIHZhciBjb21tYW5kO1xuICAgIHZhciB1bmlmb3JtTWFwO1xuXG4gICAgaWYgKHRpbGVQcm92aWRlci5fZHJhd0NvbW1hbmRzLmxlbmd0aCA8PSB0aWxlUHJvdmlkZXIuX3VzZWREcmF3Q29tbWFuZHMpIHtcbiAgICAgIGNvbW1hbmQgPSBuZXcgRHJhd0NvbW1hbmQoKTtcbiAgICAgIGNvbW1hbmQub3duZXIgPSB0aWxlO1xuICAgICAgY29tbWFuZC5jdWxsID0gZmFsc2U7XG4gICAgICBjb21tYW5kLmJvdW5kaW5nVm9sdW1lID0gbmV3IEJvdW5kaW5nU3BoZXJlKCk7XG4gICAgICBjb21tYW5kLm9yaWVudGVkQm91bmRpbmdCb3ggPSB1bmRlZmluZWQ7XG5cbiAgICAgIHVuaWZvcm1NYXAgPSBjcmVhdGVUaWxlVW5pZm9ybU1hcChmcmFtZVN0YXRlLCB0aWxlUHJvdmlkZXIpO1xuXG4gICAgICB0aWxlUHJvdmlkZXIuX2RyYXdDb21tYW5kcy5wdXNoKGNvbW1hbmQpO1xuICAgICAgdGlsZVByb3ZpZGVyLl91bmlmb3JtTWFwcy5wdXNoKHVuaWZvcm1NYXApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb21tYW5kID0gdGlsZVByb3ZpZGVyLl9kcmF3Q29tbWFuZHNbdGlsZVByb3ZpZGVyLl91c2VkRHJhd0NvbW1hbmRzXTtcbiAgICAgIHVuaWZvcm1NYXAgPSB0aWxlUHJvdmlkZXIuX3VuaWZvcm1NYXBzW3RpbGVQcm92aWRlci5fdXNlZERyYXdDb21tYW5kc107XG4gICAgfVxuXG4gICAgY29tbWFuZC5vd25lciA9IHRpbGU7XG5cbiAgICArK3RpbGVQcm92aWRlci5fdXNlZERyYXdDb21tYW5kcztcblxuICAgIGlmICh0aWxlID09PSB0aWxlUHJvdmlkZXIuX2RlYnVnLmJvdW5kaW5nU3BoZXJlVGlsZSkge1xuICAgICAgdmFyIG9iYiA9IHRpbGVCb3VuZGluZ1JlZ2lvbi5ib3VuZGluZ1ZvbHVtZTtcbiAgICAgIHZhciBib3VuZGluZ1NwaGVyZSA9IHRpbGVCb3VuZGluZ1JlZ2lvbi5ib3VuZGluZ1NwaGVyZTtcbiAgICAgIC8vIElmIGEgZGVidWcgcHJpbWl0aXZlIGFscmVhZHkgZXhpc3RzIGZvciB0aGlzIHRpbGUsIGl0IHdpbGwgbm90IGJlXG4gICAgICAvLyByZS1jcmVhdGVkLCB0byBhdm9pZCBhbGxvY2F0aW9uIGV2ZXJ5IGZyYW1lLiBJZiBpdCB3ZXJlIHBvc3NpYmxlXG4gICAgICAvLyB0byBoYXZlIG1vcmUgdGhhbiBvbmUgc2VsZWN0ZWQgdGlsZSwgdGhpcyB3b3VsZCBoYXZlIHRvIGNoYW5nZS5cbiAgICAgIGlmIChkZWZpbmVkKG9iYikpIHtcbiAgICAgICAgZ2V0RGVidWdPcmllbnRlZEJvdW5kaW5nQm94KG9iYiwgQ29sb3IuUkVEKS51cGRhdGUoZnJhbWVTdGF0ZSk7XG4gICAgICB9IGVsc2UgaWYgKGRlZmluZWQoYm91bmRpbmdTcGhlcmUpKSB7XG4gICAgICAgIGdldERlYnVnQm91bmRpbmdTcGhlcmUoYm91bmRpbmdTcGhlcmUsIENvbG9yLlJFRCkudXBkYXRlKGZyYW1lU3RhdGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciB1bmlmb3JtTWFwUHJvcGVydGllcyA9IHVuaWZvcm1NYXAucHJvcGVydGllcztcbiAgICBDYXJ0ZXNpYW40LmNsb25lKGluaXRpYWxDb2xvciwgdW5pZm9ybU1hcFByb3BlcnRpZXMuaW5pdGlhbENvbG9yKTtcbiAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5vY2Vhbk5vcm1hbE1hcCA9IG9jZWFuTm9ybWFsTWFwO1xuICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmxpZ2h0aW5nRmFkZURpc3RhbmNlLnggPVxuICAgICAgdGlsZVByb3ZpZGVyLmxpZ2h0aW5nRmFkZU91dERpc3RhbmNlO1xuICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmxpZ2h0aW5nRmFkZURpc3RhbmNlLnkgPVxuICAgICAgdGlsZVByb3ZpZGVyLmxpZ2h0aW5nRmFkZUluRGlzdGFuY2U7XG4gICAgdW5pZm9ybU1hcFByb3BlcnRpZXMubmlnaHRGYWRlRGlzdGFuY2UueCA9XG4gICAgICB0aWxlUHJvdmlkZXIubmlnaHRGYWRlT3V0RGlzdGFuY2U7XG4gICAgdW5pZm9ybU1hcFByb3BlcnRpZXMubmlnaHRGYWRlRGlzdGFuY2UueSA9IHRpbGVQcm92aWRlci5uaWdodEZhZGVJbkRpc3RhbmNlO1xuICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLnpvb21lZE91dE9jZWFuU3BlY3VsYXJJbnRlbnNpdHkgPVxuICAgICAgdGlsZVByb3ZpZGVyLnpvb21lZE91dE9jZWFuU3BlY3VsYXJJbnRlbnNpdHk7XG5cbiAgICB2YXIgZnJvbnRGYWNlQWxwaGFCeURpc3RhbmNlRmluYWwgPSBjYW1lcmFVbmRlcmdyb3VuZFxuICAgICAgPyBiYWNrRmFjZUFscGhhQnlEaXN0YW5jZVxuICAgICAgOiBmcm9udEZhY2VBbHBoYUJ5RGlzdGFuY2U7XG4gICAgdmFyIGJhY2tGYWNlQWxwaGFCeURpc3RhbmNlRmluYWwgPSBjYW1lcmFVbmRlcmdyb3VuZFxuICAgICAgPyBmcm9udEZhY2VBbHBoYUJ5RGlzdGFuY2VcbiAgICAgIDogYmFja0ZhY2VBbHBoYUJ5RGlzdGFuY2U7XG5cbiAgICBpZiAoZGVmaW5lZChmcm9udEZhY2VBbHBoYUJ5RGlzdGFuY2VGaW5hbCkpIHtcbiAgICAgIENhcnRlc2lhbjQuZnJvbUVsZW1lbnRzKFxuICAgICAgICBmcm9udEZhY2VBbHBoYUJ5RGlzdGFuY2VGaW5hbC5uZWFyLFxuICAgICAgICBmcm9udEZhY2VBbHBoYUJ5RGlzdGFuY2VGaW5hbC5uZWFyVmFsdWUsXG4gICAgICAgIGZyb250RmFjZUFscGhhQnlEaXN0YW5jZUZpbmFsLmZhcixcbiAgICAgICAgZnJvbnRGYWNlQWxwaGFCeURpc3RhbmNlRmluYWwuZmFyVmFsdWUsXG4gICAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmZyb250RmFjZUFscGhhQnlEaXN0YW5jZVxuICAgICAgKTtcbiAgICAgIENhcnRlc2lhbjQuZnJvbUVsZW1lbnRzKFxuICAgICAgICBiYWNrRmFjZUFscGhhQnlEaXN0YW5jZUZpbmFsLm5lYXIsXG4gICAgICAgIGJhY2tGYWNlQWxwaGFCeURpc3RhbmNlRmluYWwubmVhclZhbHVlLFxuICAgICAgICBiYWNrRmFjZUFscGhhQnlEaXN0YW5jZUZpbmFsLmZhcixcbiAgICAgICAgYmFja0ZhY2VBbHBoYUJ5RGlzdGFuY2VGaW5hbC5mYXJWYWx1ZSxcbiAgICAgICAgdW5pZm9ybU1hcFByb3BlcnRpZXMuYmFja0ZhY2VBbHBoYUJ5RGlzdGFuY2VcbiAgICAgICk7XG4gICAgfVxuXG4gICAgQ2FydGVzaWFuNC5mcm9tRWxlbWVudHMoXG4gICAgICB1bmRlcmdyb3VuZENvbG9yQWxwaGFCeURpc3RhbmNlLm5lYXIsXG4gICAgICB1bmRlcmdyb3VuZENvbG9yQWxwaGFCeURpc3RhbmNlLm5lYXJWYWx1ZSxcbiAgICAgIHVuZGVyZ3JvdW5kQ29sb3JBbHBoYUJ5RGlzdGFuY2UuZmFyLFxuICAgICAgdW5kZXJncm91bmRDb2xvckFscGhhQnlEaXN0YW5jZS5mYXJWYWx1ZSxcbiAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLnVuZGVyZ3JvdW5kQ29sb3JBbHBoYUJ5RGlzdGFuY2VcbiAgICApO1xuICAgIENvbG9yLmNsb25lKHVuZGVyZ3JvdW5kQ29sb3IsIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLnVuZGVyZ3JvdW5kQ29sb3IpO1xuXG4gICAgdmFyIGhpZ2hsaWdodEZpbGxUaWxlID1cbiAgICAgICFkZWZpbmVkKHN1cmZhY2VUaWxlLnZlcnRleEFycmF5KSAmJlxuICAgICAgZGVmaW5lZCh0aWxlUHJvdmlkZXIuZmlsbEhpZ2hsaWdodENvbG9yKSAmJlxuICAgICAgdGlsZVByb3ZpZGVyLmZpbGxIaWdobGlnaHRDb2xvci5hbHBoYSA+IDAuMDtcbiAgICBpZiAoaGlnaGxpZ2h0RmlsbFRpbGUpIHtcbiAgICAgIENvbG9yLmNsb25lKFxuICAgICAgICB0aWxlUHJvdmlkZXIuZmlsbEhpZ2hsaWdodENvbG9yLFxuICAgICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5maWxsSGlnaGxpZ2h0Q29sb3JcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdW5pZm9ybU1hcFByb3BlcnRpZXMudGVycmFpbkV4YWdnZXJhdGlvbkFuZFJlbGF0aXZlSGVpZ2h0LnggPSBleGFnZ2VyYXRpb247XG4gICAgdW5pZm9ybU1hcFByb3BlcnRpZXMudGVycmFpbkV4YWdnZXJhdGlvbkFuZFJlbGF0aXZlSGVpZ2h0LnkgPSBleGFnZ2VyYXRpb25SZWxhdGl2ZUhlaWdodDtcblxuICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmNlbnRlcjNEID0gbWVzaC5jZW50ZXI7XG4gICAgQ2FydGVzaWFuMy5jbG9uZShydGMsIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLnJ0Yyk7XG5cbiAgICBDYXJ0ZXNpYW40LmNsb25lKHRpbGVSZWN0YW5nbGUsIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLnRpbGVSZWN0YW5nbGUpO1xuICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLnNvdXRoQW5kTm9ydGhMYXRpdHVkZS54ID0gc291dGhMYXRpdHVkZTtcbiAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5zb3V0aEFuZE5vcnRoTGF0aXR1ZGUueSA9IG5vcnRoTGF0aXR1ZGU7XG4gICAgdW5pZm9ybU1hcFByb3BlcnRpZXMuc291dGhNZXJjYXRvcllBbmRPbmVPdmVySGVpZ2h0LnggPSBzb3V0aE1lcmNhdG9yWTtcbiAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5zb3V0aE1lcmNhdG9yWUFuZE9uZU92ZXJIZWlnaHQueSA9IG9uZU92ZXJNZXJjYXRvckhlaWdodDtcblxuICAgIC8vIENvbnZlcnQgdGlsZSBsaW1pdGVyIHJlY3RhbmdsZSBmcm9tIGNhcnRvZ3JhcGhpYyB0byB0ZXh0dXJlIHNwYWNlIHVzaW5nIHRoZSB0aWxlUmVjdGFuZ2xlLlxuICAgIHZhciBsb2NhbGl6ZWRDYXJ0b2dyYXBoaWNMaW1pdFJlY3RhbmdsZSA9IGxvY2FsaXplZENhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlU2NyYXRjaDtcbiAgICB2YXIgY2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGUgPSBjbGlwUmVjdGFuZ2xlQW50aW1lcmlkaWFuKFxuICAgICAgdGlsZS5yZWN0YW5nbGUsXG4gICAgICB0aWxlUHJvdmlkZXIuY2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGVcbiAgICApO1xuXG4gICAgdmFyIGxvY2FsaXplZFRyYW5zbHVjZW5jeVJlY3RhbmdsZSA9IGxvY2FsaXplZFRyYW5zbHVjZW5jeVJlY3RhbmdsZVNjcmF0Y2g7XG4gICAgdmFyIGNsaXBwZWRUcmFuc2x1Y2VuY3lSZWN0YW5nbGUgPSBjbGlwUmVjdGFuZ2xlQW50aW1lcmlkaWFuKFxuICAgICAgdGlsZS5yZWN0YW5nbGUsXG4gICAgICB0cmFuc2x1Y2VuY3lSZWN0YW5nbGVcbiAgICApO1xuXG4gICAgQ2FydGVzaWFuMy5mcm9tRWxlbWVudHMoXG4gICAgICBodWVTaGlmdCxcbiAgICAgIHNhdHVyYXRpb25TaGlmdCxcbiAgICAgIGJyaWdodG5lc3NTaGlmdCxcbiAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmhzYlNoaWZ0XG4gICAgKTtcblxuICAgIHZhciBjYXJ0b2dyYXBoaWNUaWxlUmVjdGFuZ2xlID0gdGlsZS5yZWN0YW5nbGU7XG4gICAgdmFyIGludmVyc2VUaWxlV2lkdGggPSAxLjAgLyBjYXJ0b2dyYXBoaWNUaWxlUmVjdGFuZ2xlLndpZHRoO1xuICAgIHZhciBpbnZlcnNlVGlsZUhlaWdodCA9IDEuMCAvIGNhcnRvZ3JhcGhpY1RpbGVSZWN0YW5nbGUuaGVpZ2h0O1xuICAgIGxvY2FsaXplZENhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlLnggPVxuICAgICAgKGNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlLndlc3QgLSBjYXJ0b2dyYXBoaWNUaWxlUmVjdGFuZ2xlLndlc3QpICpcbiAgICAgIGludmVyc2VUaWxlV2lkdGg7XG4gICAgbG9jYWxpemVkQ2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGUueSA9XG4gICAgICAoY2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGUuc291dGggLSBjYXJ0b2dyYXBoaWNUaWxlUmVjdGFuZ2xlLnNvdXRoKSAqXG4gICAgICBpbnZlcnNlVGlsZUhlaWdodDtcbiAgICBsb2NhbGl6ZWRDYXJ0b2dyYXBoaWNMaW1pdFJlY3RhbmdsZS56ID1cbiAgICAgIChjYXJ0b2dyYXBoaWNMaW1pdFJlY3RhbmdsZS5lYXN0IC0gY2FydG9ncmFwaGljVGlsZVJlY3RhbmdsZS53ZXN0KSAqXG4gICAgICBpbnZlcnNlVGlsZVdpZHRoO1xuICAgIGxvY2FsaXplZENhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlLncgPVxuICAgICAgKGNhcnRvZ3JhcGhpY0xpbWl0UmVjdGFuZ2xlLm5vcnRoIC0gY2FydG9ncmFwaGljVGlsZVJlY3RhbmdsZS5zb3V0aCkgKlxuICAgICAgaW52ZXJzZVRpbGVIZWlnaHQ7XG5cbiAgICBDYXJ0ZXNpYW40LmNsb25lKFxuICAgICAgbG9jYWxpemVkQ2FydG9ncmFwaGljTGltaXRSZWN0YW5nbGUsXG4gICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5sb2NhbGl6ZWRDYXJ0b2dyYXBoaWNMaW1pdFJlY3RhbmdsZVxuICAgICk7XG5cbiAgICBsb2NhbGl6ZWRUcmFuc2x1Y2VuY3lSZWN0YW5nbGUueCA9XG4gICAgICAoY2xpcHBlZFRyYW5zbHVjZW5jeVJlY3RhbmdsZS53ZXN0IC0gY2FydG9ncmFwaGljVGlsZVJlY3RhbmdsZS53ZXN0KSAqXG4gICAgICBpbnZlcnNlVGlsZVdpZHRoO1xuICAgIGxvY2FsaXplZFRyYW5zbHVjZW5jeVJlY3RhbmdsZS55ID1cbiAgICAgIChjbGlwcGVkVHJhbnNsdWNlbmN5UmVjdGFuZ2xlLnNvdXRoIC0gY2FydG9ncmFwaGljVGlsZVJlY3RhbmdsZS5zb3V0aCkgKlxuICAgICAgaW52ZXJzZVRpbGVIZWlnaHQ7XG4gICAgbG9jYWxpemVkVHJhbnNsdWNlbmN5UmVjdGFuZ2xlLnogPVxuICAgICAgKGNsaXBwZWRUcmFuc2x1Y2VuY3lSZWN0YW5nbGUuZWFzdCAtIGNhcnRvZ3JhcGhpY1RpbGVSZWN0YW5nbGUud2VzdCkgKlxuICAgICAgaW52ZXJzZVRpbGVXaWR0aDtcbiAgICBsb2NhbGl6ZWRUcmFuc2x1Y2VuY3lSZWN0YW5nbGUudyA9XG4gICAgICAoY2xpcHBlZFRyYW5zbHVjZW5jeVJlY3RhbmdsZS5ub3J0aCAtIGNhcnRvZ3JhcGhpY1RpbGVSZWN0YW5nbGUuc291dGgpICpcbiAgICAgIGludmVyc2VUaWxlSGVpZ2h0O1xuXG4gICAgQ2FydGVzaWFuNC5jbG9uZShcbiAgICAgIGxvY2FsaXplZFRyYW5zbHVjZW5jeVJlY3RhbmdsZSxcbiAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmxvY2FsaXplZFRyYW5zbHVjZW5jeVJlY3RhbmdsZVxuICAgICk7XG5cbiAgICAvLyBGb3IgcGVyZm9ybWFuY2UsIHVzZSBmb2cgaW4gdGhlIHNoYWRlciBvbmx5IHdoZW4gdGhlIHRpbGUgaXMgaW4gZm9nLlxuICAgIHZhciBhcHBseUZvZyA9XG4gICAgICBlbmFibGVGb2cgJiZcbiAgICAgIENlc2l1bU1hdGguZm9nKHRpbGUuX2Rpc3RhbmNlLCBmcmFtZVN0YXRlLmZvZy5kZW5zaXR5KSA+XG4gICAgICAgIENlc2l1bU1hdGguRVBTSUxPTjM7XG4gICAgY29sb3JDb3JyZWN0ID0gY29sb3JDb3JyZWN0ICYmIChhcHBseUZvZyB8fCBzaG93R3JvdW5kQXRtb3NwaGVyZSk7XG5cbiAgICB2YXIgYXBwbHlCcmlnaHRuZXNzID0gZmFsc2U7XG4gICAgdmFyIGFwcGx5Q29udHJhc3QgPSBmYWxzZTtcbiAgICB2YXIgYXBwbHlIdWUgPSBmYWxzZTtcbiAgICB2YXIgYXBwbHlTYXR1cmF0aW9uID0gZmFsc2U7XG4gICAgdmFyIGFwcGx5R2FtbWEgPSBmYWxzZTtcbiAgICB2YXIgYXBwbHlBbHBoYSA9IGZhbHNlO1xuICAgIHZhciBhcHBseURheU5pZ2h0QWxwaGEgPSBmYWxzZTtcbiAgICB2YXIgYXBwbHlTcGxpdCA9IGZhbHNlO1xuICAgIHZhciBhcHBseUN1dG91dCA9IGZhbHNlO1xuICAgIHZhciBhcHBseUNvbG9yVG9BbHBoYSA9IGZhbHNlO1xuXG4gICAgd2hpbGUgKG51bWJlck9mRGF5VGV4dHVyZXMgPCBtYXhUZXh0dXJlcyAmJiBpbWFnZXJ5SW5kZXggPCBpbWFnZXJ5TGVuKSB7XG4gICAgICB2YXIgdGlsZUltYWdlcnkgPSB0aWxlSW1hZ2VyeUNvbGxlY3Rpb25baW1hZ2VyeUluZGV4XTtcbiAgICAgIHZhciBpbWFnZXJ5ID0gdGlsZUltYWdlcnkucmVhZHlJbWFnZXJ5O1xuICAgICAgKytpbWFnZXJ5SW5kZXg7XG5cbiAgICAgIGlmICghZGVmaW5lZChpbWFnZXJ5KSB8fCBpbWFnZXJ5LmltYWdlcnlMYXllci5hbHBoYSA9PT0gMC4wKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgdGV4dHVyZSA9IHRpbGVJbWFnZXJ5LnVzZVdlYk1lcmNhdG9yVFxuICAgICAgICA/IGltYWdlcnkudGV4dHVyZVdlYk1lcmNhdG9yXG4gICAgICAgIDogaW1hZ2VyeS50ZXh0dXJlO1xuXG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgaWYgKCFkZWZpbmVkKHRleHR1cmUpKSB7XG4gICAgICAgIC8vIE91ciBcInJlYWR5XCIgdGV4dHVyZSBpc24ndCBhY3R1YWxseSByZWFkeS4gIFRoaXMgc2hvdWxkIG5ldmVyIGhhcHBlbi5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gU2lkZSBub3RlOiBJdCBJUyBwb3NzaWJsZSBmb3IgaXQgdG8gbm90IGJlIGluIHRoZSBSRUFEWSBJbWFnZXJ5U3RhdGUsIHRob3VnaC5cbiAgICAgICAgLy8gVGhpcyBjYW4gaGFwcGVuIHdoZW4gYSBzaW5nbGUgaW1hZ2VyeSB0aWxlIGlzIHNoYXJlZCBieSB0d28gdGVycmFpbiB0aWxlcyAoY29tbW9uKVxuICAgICAgICAvLyBhbmQgb25lIG9mIHRoZW0gKEEpIG5lZWRzIGEgZ2VvZ3JhcGhpYyB2ZXJzaW9uIG9mIHRoZSB0aWxlIGJlY2F1c2UgaXQgaXMgbmVhciB0aGUgcG9sZXMsXG4gICAgICAgIC8vIGFuZCB0aGUgb3RoZXIgKEIpIGRvZXMgbm90LiAgQiBjYW4gYW5kIHdpbGwgdHJhbnNpdGlvbiB0aGUgaW1hZ2VyeSB0aWxlIHRvIHRoZSBSRUFEWSBzdGF0ZVxuICAgICAgICAvLyB3aXRob3V0IHJlcHJvamVjdGluZyB0byBnZW9ncmFwaGljLiAgVGhlbiwgbGF0ZXIsIEEgd2lsbCBkZWVtIHRoYXQgc2FtZSB0aWxlIG5vdC1yZWFkeS15ZXRcbiAgICAgICAgLy8gYmVjYXVzZSBpdCBvbmx5IGhhcyB0aGUgV2ViIE1lcmNhdG9yIHRleHR1cmUsIGFuZCBmbGlwIGl0IGJhY2sgdG8gdGhlIFRSQU5TSVRJT05JTkcgc3RhdGUuXG4gICAgICAgIC8vIFRoZSBpbWFnZXJ5IHRpbGUgd29uJ3QgYmUgaW4gdGhlIFJFQURZIHN0YXRlIGFueW1vcmUsIGJ1dCBpdCdzIHN0aWxsIFJFQURZIGVub3VnaCBmb3IgQidzXG4gICAgICAgIC8vIHB1cnBvc2VzLlxuICAgICAgICB0aHJvdyBuZXcgRGV2ZWxvcGVyRXJyb3IoXCJyZWFkeUltYWdlcnkgaXMgbm90IGFjdHVhbGx5IHJlYWR5IVwiKTtcbiAgICAgIH1cbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuXG4gICAgICB2YXIgaW1hZ2VyeUxheWVyID0gaW1hZ2VyeS5pbWFnZXJ5TGF5ZXI7XG5cbiAgICAgIGlmICghZGVmaW5lZCh0aWxlSW1hZ2VyeS50ZXh0dXJlVHJhbnNsYXRpb25BbmRTY2FsZSkpIHtcbiAgICAgICAgdGlsZUltYWdlcnkudGV4dHVyZVRyYW5zbGF0aW9uQW5kU2NhbGUgPSBpbWFnZXJ5TGF5ZXIuX2NhbGN1bGF0ZVRleHR1cmVUcmFuc2xhdGlvbkFuZFNjYWxlKFxuICAgICAgICAgIHRpbGUsXG4gICAgICAgICAgdGlsZUltYWdlcnlcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgdW5pZm9ybU1hcFByb3BlcnRpZXMuZGF5VGV4dHVyZXNbbnVtYmVyT2ZEYXlUZXh0dXJlc10gPSB0ZXh0dXJlO1xuICAgICAgdW5pZm9ybU1hcFByb3BlcnRpZXMuZGF5VGV4dHVyZVRyYW5zbGF0aW9uQW5kU2NhbGVbbnVtYmVyT2ZEYXlUZXh0dXJlc10gPVxuICAgICAgICB0aWxlSW1hZ2VyeS50ZXh0dXJlVHJhbnNsYXRpb25BbmRTY2FsZTtcbiAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmRheVRleHR1cmVUZXhDb29yZHNSZWN0YW5nbGVbbnVtYmVyT2ZEYXlUZXh0dXJlc10gPVxuICAgICAgICB0aWxlSW1hZ2VyeS50ZXh0dXJlQ29vcmRpbmF0ZVJlY3RhbmdsZTtcbiAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmRheVRleHR1cmVVc2VXZWJNZXJjYXRvclRbbnVtYmVyT2ZEYXlUZXh0dXJlc10gPVxuICAgICAgICB0aWxlSW1hZ2VyeS51c2VXZWJNZXJjYXRvclQ7XG5cbiAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmRheVRleHR1cmVBbHBoYVtudW1iZXJPZkRheVRleHR1cmVzXSA9XG4gICAgICAgIGltYWdlcnlMYXllci5hbHBoYTtcbiAgICAgIGFwcGx5QWxwaGEgPVxuICAgICAgICBhcHBseUFscGhhIHx8XG4gICAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmRheVRleHR1cmVBbHBoYVtudW1iZXJPZkRheVRleHR1cmVzXSAhPT0gMS4wO1xuXG4gICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5kYXlUZXh0dXJlTmlnaHRBbHBoYVtudW1iZXJPZkRheVRleHR1cmVzXSA9XG4gICAgICAgIGltYWdlcnlMYXllci5uaWdodEFscGhhO1xuICAgICAgYXBwbHlEYXlOaWdodEFscGhhID1cbiAgICAgICAgYXBwbHlEYXlOaWdodEFscGhhIHx8XG4gICAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmRheVRleHR1cmVOaWdodEFscGhhW251bWJlck9mRGF5VGV4dHVyZXNdICE9PSAxLjA7XG5cbiAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmRheVRleHR1cmVEYXlBbHBoYVtudW1iZXJPZkRheVRleHR1cmVzXSA9XG4gICAgICAgIGltYWdlcnlMYXllci5kYXlBbHBoYTtcbiAgICAgIGFwcGx5RGF5TmlnaHRBbHBoYSA9XG4gICAgICAgIGFwcGx5RGF5TmlnaHRBbHBoYSB8fFxuICAgICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5kYXlUZXh0dXJlRGF5QWxwaGFbbnVtYmVyT2ZEYXlUZXh0dXJlc10gIT09IDEuMDtcblxuICAgICAgdW5pZm9ybU1hcFByb3BlcnRpZXMuZGF5VGV4dHVyZUJyaWdodG5lc3NbbnVtYmVyT2ZEYXlUZXh0dXJlc10gPVxuICAgICAgICBpbWFnZXJ5TGF5ZXIuYnJpZ2h0bmVzcztcbiAgICAgIGFwcGx5QnJpZ2h0bmVzcyA9XG4gICAgICAgIGFwcGx5QnJpZ2h0bmVzcyB8fFxuICAgICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5kYXlUZXh0dXJlQnJpZ2h0bmVzc1tudW1iZXJPZkRheVRleHR1cmVzXSAhPT1cbiAgICAgICAgICBJbWFnZXJ5TGF5ZXIuREVGQVVMVF9CUklHSFRORVNTO1xuXG4gICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5kYXlUZXh0dXJlQ29udHJhc3RbbnVtYmVyT2ZEYXlUZXh0dXJlc10gPVxuICAgICAgICBpbWFnZXJ5TGF5ZXIuY29udHJhc3Q7XG4gICAgICBhcHBseUNvbnRyYXN0ID1cbiAgICAgICAgYXBwbHlDb250cmFzdCB8fFxuICAgICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5kYXlUZXh0dXJlQ29udHJhc3RbbnVtYmVyT2ZEYXlUZXh0dXJlc10gIT09XG4gICAgICAgICAgSW1hZ2VyeUxheWVyLkRFRkFVTFRfQ09OVFJBU1Q7XG5cbiAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmRheVRleHR1cmVIdWVbbnVtYmVyT2ZEYXlUZXh0dXJlc10gPVxuICAgICAgICBpbWFnZXJ5TGF5ZXIuaHVlO1xuICAgICAgYXBwbHlIdWUgPVxuICAgICAgICBhcHBseUh1ZSB8fFxuICAgICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5kYXlUZXh0dXJlSHVlW251bWJlck9mRGF5VGV4dHVyZXNdICE9PVxuICAgICAgICAgIEltYWdlcnlMYXllci5ERUZBVUxUX0hVRTtcblxuICAgICAgdW5pZm9ybU1hcFByb3BlcnRpZXMuZGF5VGV4dHVyZVNhdHVyYXRpb25bbnVtYmVyT2ZEYXlUZXh0dXJlc10gPVxuICAgICAgICBpbWFnZXJ5TGF5ZXIuc2F0dXJhdGlvbjtcbiAgICAgIGFwcGx5U2F0dXJhdGlvbiA9XG4gICAgICAgIGFwcGx5U2F0dXJhdGlvbiB8fFxuICAgICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5kYXlUZXh0dXJlU2F0dXJhdGlvbltudW1iZXJPZkRheVRleHR1cmVzXSAhPT1cbiAgICAgICAgICBJbWFnZXJ5TGF5ZXIuREVGQVVMVF9TQVRVUkFUSU9OO1xuXG4gICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5kYXlUZXh0dXJlT25lT3ZlckdhbW1hW251bWJlck9mRGF5VGV4dHVyZXNdID1cbiAgICAgICAgMS4wIC8gaW1hZ2VyeUxheWVyLmdhbW1hO1xuICAgICAgYXBwbHlHYW1tYSA9XG4gICAgICAgIGFwcGx5R2FtbWEgfHxcbiAgICAgICAgdW5pZm9ybU1hcFByb3BlcnRpZXMuZGF5VGV4dHVyZU9uZU92ZXJHYW1tYVtudW1iZXJPZkRheVRleHR1cmVzXSAhPT1cbiAgICAgICAgICAxLjAgLyBJbWFnZXJ5TGF5ZXIuREVGQVVMVF9HQU1NQTtcblxuICAgICAgdW5pZm9ybU1hcFByb3BlcnRpZXMuZGF5VGV4dHVyZVNwbGl0W251bWJlck9mRGF5VGV4dHVyZXNdID1cbiAgICAgICAgaW1hZ2VyeUxheWVyLnNwbGl0RGlyZWN0aW9uO1xuICAgICAgYXBwbHlTcGxpdCA9XG4gICAgICAgIGFwcGx5U3BsaXQgfHxcbiAgICAgICAgdW5pZm9ybU1hcFByb3BlcnRpZXMuZGF5VGV4dHVyZVNwbGl0W251bWJlck9mRGF5VGV4dHVyZXNdICE9PSAwLjA7XG5cbiAgICAgIC8vIFVwZGF0ZSBjdXRvdXQgcmVjdGFuZ2xlXG4gICAgICB2YXIgZGF5VGV4dHVyZUN1dG91dFJlY3RhbmdsZSA9XG4gICAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmRheVRleHR1cmVDdXRvdXRSZWN0YW5nbGVzW251bWJlck9mRGF5VGV4dHVyZXNdO1xuICAgICAgaWYgKCFkZWZpbmVkKGRheVRleHR1cmVDdXRvdXRSZWN0YW5nbGUpKSB7XG4gICAgICAgIGRheVRleHR1cmVDdXRvdXRSZWN0YW5nbGUgPSB1bmlmb3JtTWFwUHJvcGVydGllcy5kYXlUZXh0dXJlQ3V0b3V0UmVjdGFuZ2xlc1tcbiAgICAgICAgICBudW1iZXJPZkRheVRleHR1cmVzXG4gICAgICAgIF0gPSBuZXcgQ2FydGVzaWFuNCgpO1xuICAgICAgfVxuXG4gICAgICBDYXJ0ZXNpYW40LmNsb25lKENhcnRlc2lhbjQuWkVSTywgZGF5VGV4dHVyZUN1dG91dFJlY3RhbmdsZSk7XG4gICAgICBpZiAoZGVmaW5lZChpbWFnZXJ5TGF5ZXIuY3V0b3V0UmVjdGFuZ2xlKSkge1xuICAgICAgICB2YXIgY3V0b3V0UmVjdGFuZ2xlID0gY2xpcFJlY3RhbmdsZUFudGltZXJpZGlhbihcbiAgICAgICAgICBjYXJ0b2dyYXBoaWNUaWxlUmVjdGFuZ2xlLFxuICAgICAgICAgIGltYWdlcnlMYXllci5jdXRvdXRSZWN0YW5nbGVcbiAgICAgICAgKTtcbiAgICAgICAgdmFyIGludGVyc2VjdGlvbiA9IFJlY3RhbmdsZS5zaW1wbGVJbnRlcnNlY3Rpb24oXG4gICAgICAgICAgY3V0b3V0UmVjdGFuZ2xlLFxuICAgICAgICAgIGNhcnRvZ3JhcGhpY1RpbGVSZWN0YW5nbGUsXG4gICAgICAgICAgcmVjdGFuZ2xlSW50ZXJzZWN0aW9uU2NyYXRjaFxuICAgICAgICApO1xuICAgICAgICBhcHBseUN1dG91dCA9IGRlZmluZWQoaW50ZXJzZWN0aW9uKSB8fCBhcHBseUN1dG91dDtcblxuICAgICAgICBkYXlUZXh0dXJlQ3V0b3V0UmVjdGFuZ2xlLnggPVxuICAgICAgICAgIChjdXRvdXRSZWN0YW5nbGUud2VzdCAtIGNhcnRvZ3JhcGhpY1RpbGVSZWN0YW5nbGUud2VzdCkgKlxuICAgICAgICAgIGludmVyc2VUaWxlV2lkdGg7XG4gICAgICAgIGRheVRleHR1cmVDdXRvdXRSZWN0YW5nbGUueSA9XG4gICAgICAgICAgKGN1dG91dFJlY3RhbmdsZS5zb3V0aCAtIGNhcnRvZ3JhcGhpY1RpbGVSZWN0YW5nbGUuc291dGgpICpcbiAgICAgICAgICBpbnZlcnNlVGlsZUhlaWdodDtcbiAgICAgICAgZGF5VGV4dHVyZUN1dG91dFJlY3RhbmdsZS56ID1cbiAgICAgICAgICAoY3V0b3V0UmVjdGFuZ2xlLmVhc3QgLSBjYXJ0b2dyYXBoaWNUaWxlUmVjdGFuZ2xlLndlc3QpICpcbiAgICAgICAgICBpbnZlcnNlVGlsZVdpZHRoO1xuICAgICAgICBkYXlUZXh0dXJlQ3V0b3V0UmVjdGFuZ2xlLncgPVxuICAgICAgICAgIChjdXRvdXRSZWN0YW5nbGUubm9ydGggLSBjYXJ0b2dyYXBoaWNUaWxlUmVjdGFuZ2xlLnNvdXRoKSAqXG4gICAgICAgICAgaW52ZXJzZVRpbGVIZWlnaHQ7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBjb2xvciB0byBhbHBoYVxuICAgICAgdmFyIGNvbG9yVG9BbHBoYSA9XG4gICAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmNvbG9yc1RvQWxwaGFbbnVtYmVyT2ZEYXlUZXh0dXJlc107XG4gICAgICBpZiAoIWRlZmluZWQoY29sb3JUb0FscGhhKSkge1xuICAgICAgICBjb2xvclRvQWxwaGEgPSB1bmlmb3JtTWFwUHJvcGVydGllcy5jb2xvcnNUb0FscGhhW1xuICAgICAgICAgIG51bWJlck9mRGF5VGV4dHVyZXNcbiAgICAgICAgXSA9IG5ldyBDYXJ0ZXNpYW40KCk7XG4gICAgICB9XG5cbiAgICAgIHZhciBoYXNDb2xvclRvQWxwaGEgPVxuICAgICAgICBkZWZpbmVkKGltYWdlcnlMYXllci5jb2xvclRvQWxwaGEpICYmXG4gICAgICAgIGltYWdlcnlMYXllci5jb2xvclRvQWxwaGFUaHJlc2hvbGQgPiAwLjA7XG4gICAgICBhcHBseUNvbG9yVG9BbHBoYSA9IGFwcGx5Q29sb3JUb0FscGhhIHx8IGhhc0NvbG9yVG9BbHBoYTtcblxuICAgICAgaWYgKGhhc0NvbG9yVG9BbHBoYSkge1xuICAgICAgICB2YXIgY29sb3IgPSBpbWFnZXJ5TGF5ZXIuY29sb3JUb0FscGhhO1xuICAgICAgICBjb2xvclRvQWxwaGEueCA9IGNvbG9yLnJlZDtcbiAgICAgICAgY29sb3JUb0FscGhhLnkgPSBjb2xvci5ncmVlbjtcbiAgICAgICAgY29sb3JUb0FscGhhLnogPSBjb2xvci5ibHVlO1xuICAgICAgICBjb2xvclRvQWxwaGEudyA9IGltYWdlcnlMYXllci5jb2xvclRvQWxwaGFUaHJlc2hvbGQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb2xvclRvQWxwaGEudyA9IC0xLjA7XG4gICAgICB9XG5cbiAgICAgIGlmIChkZWZpbmVkKGltYWdlcnkuY3JlZGl0cykpIHtcbiAgICAgICAgdmFyIGNyZWRpdHMgPSBpbWFnZXJ5LmNyZWRpdHM7XG4gICAgICAgIGZvciAoXG4gICAgICAgICAgdmFyIGNyZWRpdEluZGV4ID0gMCwgY3JlZGl0TGVuZ3RoID0gY3JlZGl0cy5sZW5ndGg7XG4gICAgICAgICAgY3JlZGl0SW5kZXggPCBjcmVkaXRMZW5ndGg7XG4gICAgICAgICAgKytjcmVkaXRJbmRleFxuICAgICAgICApIHtcbiAgICAgICAgICBjcmVkaXREaXNwbGF5LmFkZENyZWRpdChjcmVkaXRzW2NyZWRpdEluZGV4XSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgKytudW1iZXJPZkRheVRleHR1cmVzO1xuICAgIH1cblxuICAgIC8vIHRyaW0gdGV4dHVyZSBhcnJheSB0byB0aGUgdXNlZCBsZW5ndGggc28gd2UgZG9uJ3QgZW5kIHVwIHVzaW5nIG9sZCB0ZXh0dXJlc1xuICAgIC8vIHdoaWNoIG1pZ2h0IGdldCBkZXN0cm95ZWQgZXZlbnR1YWxseVxuICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmRheVRleHR1cmVzLmxlbmd0aCA9IG51bWJlck9mRGF5VGV4dHVyZXM7XG4gICAgdW5pZm9ybU1hcFByb3BlcnRpZXMud2F0ZXJNYXNrID0gd2F0ZXJNYXNrVGV4dHVyZTtcbiAgICBDYXJ0ZXNpYW40LmNsb25lKFxuICAgICAgd2F0ZXJNYXNrVHJhbnNsYXRpb25BbmRTY2FsZSxcbiAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLndhdGVyTWFza1RyYW5zbGF0aW9uQW5kU2NhbGVcbiAgICApO1xuXG4gICAgdW5pZm9ybU1hcFByb3BlcnRpZXMubWluTWF4SGVpZ2h0LnggPSBlbmNvZGluZy5taW5pbXVtSGVpZ2h0O1xuICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLm1pbk1heEhlaWdodC55ID0gZW5jb2RpbmcubWF4aW11bUhlaWdodDtcbiAgICBNYXRyaXg0LmNsb25lKGVuY29kaW5nLm1hdHJpeCwgdW5pZm9ybU1hcFByb3BlcnRpZXMuc2NhbGVBbmRCaWFzKTtcblxuICAgIC8vIHVwZGF0ZSBjbGlwcGluZyBwbGFuZXNcbiAgICB2YXIgY2xpcHBpbmdQbGFuZXMgPSB0aWxlUHJvdmlkZXIuX2NsaXBwaW5nUGxhbmVzO1xuICAgIHZhciBjbGlwcGluZ1BsYW5lc0VuYWJsZWQgPVxuICAgICAgZGVmaW5lZChjbGlwcGluZ1BsYW5lcykgJiYgY2xpcHBpbmdQbGFuZXMuZW5hYmxlZCAmJiB0aWxlLmlzQ2xpcHBlZDtcbiAgICBpZiAoY2xpcHBpbmdQbGFuZXNFbmFibGVkKSB7XG4gICAgICB1bmlmb3JtTWFwUHJvcGVydGllcy5jbGlwcGluZ1BsYW5lc0VkZ2VDb2xvciA9IENvbG9yLmNsb25lKFxuICAgICAgICBjbGlwcGluZ1BsYW5lcy5lZGdlQ29sb3IsXG4gICAgICAgIHVuaWZvcm1NYXBQcm9wZXJ0aWVzLmNsaXBwaW5nUGxhbmVzRWRnZUNvbG9yXG4gICAgICApO1xuICAgICAgdW5pZm9ybU1hcFByb3BlcnRpZXMuY2xpcHBpbmdQbGFuZXNFZGdlV2lkdGggPSBjbGlwcGluZ1BsYW5lcy5lZGdlV2lkdGg7XG4gICAgfVxuXG4gICAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMubnVtYmVyT2ZEYXlUZXh0dXJlcyA9IG51bWJlck9mRGF5VGV4dHVyZXM7XG4gICAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMuYXBwbHlCcmlnaHRuZXNzID0gYXBwbHlCcmlnaHRuZXNzO1xuICAgIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLmFwcGx5Q29udHJhc3QgPSBhcHBseUNvbnRyYXN0O1xuICAgIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLmFwcGx5SHVlID0gYXBwbHlIdWU7XG4gICAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMuYXBwbHlTYXR1cmF0aW9uID0gYXBwbHlTYXR1cmF0aW9uO1xuICAgIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLmFwcGx5R2FtbWEgPSBhcHBseUdhbW1hO1xuICAgIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLmFwcGx5QWxwaGEgPSBhcHBseUFscGhhO1xuICAgIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLmFwcGx5RGF5TmlnaHRBbHBoYSA9IGFwcGx5RGF5TmlnaHRBbHBoYTtcbiAgICBzdXJmYWNlU2hhZGVyU2V0T3B0aW9ucy5hcHBseVNwbGl0ID0gYXBwbHlTcGxpdDtcbiAgICBzdXJmYWNlU2hhZGVyU2V0T3B0aW9ucy5lbmFibGVGb2cgPSBhcHBseUZvZztcbiAgICBzdXJmYWNlU2hhZGVyU2V0T3B0aW9ucy5lbmFibGVDbGlwcGluZ1BsYW5lcyA9IGNsaXBwaW5nUGxhbmVzRW5hYmxlZDtcbiAgICBzdXJmYWNlU2hhZGVyU2V0T3B0aW9ucy5jbGlwcGluZ1BsYW5lcyA9IGNsaXBwaW5nUGxhbmVzO1xuICAgIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLmhhc0ltYWdlcnlMYXllckN1dG91dCA9IGFwcGx5Q3V0b3V0O1xuICAgIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLmNvbG9yQ29ycmVjdCA9IGNvbG9yQ29ycmVjdDtcbiAgICBzdXJmYWNlU2hhZGVyU2V0T3B0aW9ucy5oaWdobGlnaHRGaWxsVGlsZSA9IGhpZ2hsaWdodEZpbGxUaWxlO1xuICAgIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLmNvbG9yVG9BbHBoYSA9IGFwcGx5Q29sb3JUb0FscGhhO1xuICAgIHN1cmZhY2VTaGFkZXJTZXRPcHRpb25zLnNob3dVbmRlcmdyb3VuZENvbG9yID0gc2hvd1VuZGVyZ3JvdW5kQ29sb3I7XG4gICAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnMudHJhbnNsdWNlbnQgPSB0cmFuc2x1Y2VudDtcblxuICAgIHZhciBjb3VudCA9IHN1cmZhY2VUaWxlLnJlbmRlcmVkTWVzaC5pbmRpY2VzLmxlbmd0aDtcbiAgICBpZiAoIXNob3dTa2lydHMpIHtcbiAgICAgIGNvdW50ID0gc3VyZmFjZVRpbGUucmVuZGVyZWRNZXNoLmluZGV4Q291bnRXaXRob3V0U2tpcnRzO1xuICAgIH1cblxuICAgIGNvbW1hbmQuc2hhZGVyUHJvZ3JhbSA9IHRpbGVQcm92aWRlci5fc3VyZmFjZVNoYWRlclNldC5nZXRTaGFkZXJQcm9ncmFtKFxuICAgICAgc3VyZmFjZVNoYWRlclNldE9wdGlvbnNcbiAgICApO1xuICAgIGNvbW1hbmQuY2FzdFNoYWRvd3MgPSBjYXN0U2hhZG93cztcbiAgICBjb21tYW5kLnJlY2VpdmVTaGFkb3dzID0gcmVjZWl2ZVNoYWRvd3M7XG4gICAgY29tbWFuZC5yZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlO1xuICAgIGNvbW1hbmQucHJpbWl0aXZlVHlwZSA9IFByaW1pdGl2ZVR5cGUuVFJJQU5HTEVTO1xuICAgIGNvbW1hbmQudmVydGV4QXJyYXkgPVxuICAgICAgc3VyZmFjZVRpbGUudmVydGV4QXJyYXkgfHwgc3VyZmFjZVRpbGUuZmlsbC52ZXJ0ZXhBcnJheTtcbiAgICBjb21tYW5kLmNvdW50ID0gY291bnQ7XG4gICAgY29tbWFuZC51bmlmb3JtTWFwID0gdW5pZm9ybU1hcDtcbiAgICBjb21tYW5kLnBhc3MgPSBQYXNzLkdMT0JFO1xuXG4gICAgaWYgKHRpbGVQcm92aWRlci5fZGVidWcud2lyZWZyYW1lKSB7XG4gICAgICBjcmVhdGVXaXJlZnJhbWVWZXJ0ZXhBcnJheUlmTmVjZXNzYXJ5KGNvbnRleHQsIHRpbGVQcm92aWRlciwgdGlsZSk7XG4gICAgICBpZiAoZGVmaW5lZChzdXJmYWNlVGlsZS53aXJlZnJhbWVWZXJ0ZXhBcnJheSkpIHtcbiAgICAgICAgY29tbWFuZC52ZXJ0ZXhBcnJheSA9IHN1cmZhY2VUaWxlLndpcmVmcmFtZVZlcnRleEFycmF5O1xuICAgICAgICBjb21tYW5kLnByaW1pdGl2ZVR5cGUgPSBQcmltaXRpdmVUeXBlLkxJTkVTO1xuICAgICAgICBjb21tYW5kLmNvdW50ID0gY291bnQgKiAyO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBib3VuZGluZ1ZvbHVtZSA9IGNvbW1hbmQuYm91bmRpbmdWb2x1bWU7XG4gICAgdmFyIG9yaWVudGVkQm91bmRpbmdCb3ggPSBjb21tYW5kLm9yaWVudGVkQm91bmRpbmdCb3g7XG5cbiAgICBpZiAoZnJhbWVTdGF0ZS5tb2RlICE9PSBTY2VuZU1vZGUuU0NFTkUzRCkge1xuICAgICAgQm91bmRpbmdTcGhlcmUuZnJvbVJlY3RhbmdsZVdpdGhIZWlnaHRzMkQoXG4gICAgICAgIHRpbGUucmVjdGFuZ2xlLFxuICAgICAgICBmcmFtZVN0YXRlLm1hcFByb2plY3Rpb24sXG4gICAgICAgIHRpbGVCb3VuZGluZ1JlZ2lvbi5taW5pbXVtSGVpZ2h0LFxuICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24ubWF4aW11bUhlaWdodCxcbiAgICAgICAgYm91bmRpbmdWb2x1bWVcbiAgICAgICk7XG4gICAgICBDYXJ0ZXNpYW4zLmZyb21FbGVtZW50cyhcbiAgICAgICAgYm91bmRpbmdWb2x1bWUuY2VudGVyLnosXG4gICAgICAgIGJvdW5kaW5nVm9sdW1lLmNlbnRlci54LFxuICAgICAgICBib3VuZGluZ1ZvbHVtZS5jZW50ZXIueSxcbiAgICAgICAgYm91bmRpbmdWb2x1bWUuY2VudGVyXG4gICAgICApO1xuXG4gICAgICBpZiAoZnJhbWVTdGF0ZS5tb2RlID09PSBTY2VuZU1vZGUuTU9SUEhJTkcpIHtcbiAgICAgICAgYm91bmRpbmdWb2x1bWUgPSBCb3VuZGluZ1NwaGVyZS51bmlvbihcbiAgICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24uYm91bmRpbmdTcGhlcmUsXG4gICAgICAgICAgYm91bmRpbmdWb2x1bWUsXG4gICAgICAgICAgYm91bmRpbmdWb2x1bWVcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29tbWFuZC5ib3VuZGluZ1ZvbHVtZSA9IEJvdW5kaW5nU3BoZXJlLmNsb25lKFxuICAgICAgICB0aWxlQm91bmRpbmdSZWdpb24uYm91bmRpbmdTcGhlcmUsXG4gICAgICAgIGJvdW5kaW5nVm9sdW1lXG4gICAgICApO1xuICAgICAgY29tbWFuZC5vcmllbnRlZEJvdW5kaW5nQm94ID0gT3JpZW50ZWRCb3VuZGluZ0JveC5jbG9uZShcbiAgICAgICAgdGlsZUJvdW5kaW5nUmVnaW9uLmJvdW5kaW5nVm9sdW1lLFxuICAgICAgICBvcmllbnRlZEJvdW5kaW5nQm94XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbW1hbmQuZGlydHkgPSB0cnVlO1xuXG4gICAgaWYgKHRyYW5zbHVjZW50KSB7XG4gICAgICBnbG9iZVRyYW5zbHVjZW5jeVN0YXRlLnVwZGF0ZURlcml2ZWRDb21tYW5kcyhjb21tYW5kLCBmcmFtZVN0YXRlKTtcbiAgICB9XG5cbiAgICBwdXNoQ29tbWFuZChjb21tYW5kLCBmcmFtZVN0YXRlKTtcblxuICAgIHJlbmRlclN0YXRlID0gb3RoZXJQYXNzZXNSZW5kZXJTdGF0ZTtcbiAgICBpbml0aWFsQ29sb3IgPSBvdGhlclBhc3Nlc0luaXRpYWxDb2xvcjtcbiAgfSB3aGlsZSAoaW1hZ2VyeUluZGV4IDwgaW1hZ2VyeUxlbik7XG59XG5leHBvcnQgZGVmYXVsdCBHbG9iZVN1cmZhY2VUaWxlUHJvdmlkZXI7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///32110\n')},90538:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_Check_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(66553);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(82982);\n/* harmony import */ var _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(12572);\n/* harmony import */ var _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(15720);\n/* harmony import */ var _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(96190);\n\n\n\n\n\n\n/**\n * Properties for controlling globe translucency.\n *\n * @alias GlobeTranslucency\n * @constructor\n */\nfunction GlobeTranslucency() {\n  this._enabled = false;\n  this._frontFaceAlpha = 1.0;\n  this._frontFaceAlphaByDistance = undefined;\n  this._backFaceAlpha = 1.0;\n  this._backFaceAlphaByDistance = undefined;\n  this._rectangle = _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(_Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].MAX_VALUE */ .Z.MAX_VALUE);\n}\n\nObject.defineProperties(GlobeTranslucency.prototype, {\n  /**\n   * When true, the globe is rendered as a translucent surface.\n   * <br /><br />\n   * The alpha is computed by blending {@link Globe#material}, {@link Globe#imageryLayers},\n   * and {@link Globe#baseColor}, all of which may contain translucency, and then multiplying by\n   * {@link GlobeTranslucency#frontFaceAlpha} and {@link GlobeTranslucency#frontFaceAlphaByDistance} for front faces and\n   * {@link GlobeTranslucency#backFaceAlpha} and {@link GlobeTranslucency#backFaceAlphaByDistance} for back faces.\n   * When the camera is underground back faces and front faces are swapped, i.e. back-facing geometry\n   * is considered front facing.\n   * <br /><br />\n   * Translucency is disabled by default.\n   *\n   * @memberof GlobeTranslucency.prototype\n   *\n   * @type {Boolean}\n   * @default false\n   *\n   * @see GlobeTranslucency#frontFaceAlpha\n   * @see GlobeTranslucency#frontFaceAlphaByDistance\n   * @see GlobeTranslucency#backFaceAlpha\n   * @see GlobeTranslucency#backFaceAlphaByDistance\n   */\n  enabled: {\n    get: function () {\n      return this._enabled;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].typeOf.bool */ .Z.typeOf.bool("enabled", value);\n      //>>includeEnd(\'debug\');\n      this._enabled = value;\n    },\n  },\n\n  /**\n   * A constant translucency to apply to front faces of the globe.\n   * <br /><br />\n   * {@link GlobeTranslucency#enabled} must be set to true for this option to take effect.\n   *\n   * @memberof GlobeTranslucency.prototype\n   *\n   * @type {Number}\n   * @default 1.0\n   *\n   * @see GlobeTranslucency#enabled\n   * @see GlobeTranslucency#frontFaceAlphaByDistance\n   *\n   * @example\n   * // Set front face translucency to 0.5.\n   * globe.translucency.frontFaceAlpha = 0.5;\n   * globe.translucency.enabled = true;\n   */\n  frontFaceAlpha: {\n    get: function () {\n      return this._frontFaceAlpha;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].typeOf.number.greaterThanOrEquals */ .Z.typeOf.number.greaterThanOrEquals("frontFaceAlpha", value, 0.0);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].typeOf.number.lessThanOrEquals */ .Z.typeOf.number.lessThanOrEquals("frontFaceAlpha", value, 1.0);\n      //>>includeEnd(\'debug\');\n      this._frontFaceAlpha = value;\n    },\n  },\n  /**\n   * Gets or sets near and far translucency properties of front faces of the globe based on the distance to the camera.\n   * The translucency will interpolate between the {@link NearFarScalar#nearValue} and\n   * {@link NearFarScalar#farValue} while the camera distance falls within the lower and upper bounds\n   * of the specified {@link NearFarScalar#near} and {@link NearFarScalar#far}.\n   * Outside of these ranges the translucency remains clamped to the nearest bound.  If undefined,\n   * frontFaceAlphaByDistance will be disabled.\n   * <br /><br />\n   * {@link GlobeTranslucency#enabled} must be set to true for this option to take effect.\n   *\n   * @memberof GlobeTranslucency.prototype\n   *\n   * @type {NearFarScalar}\n   * @default undefined\n   *\n   * @see GlobeTranslucency#enabled\n   * @see GlobeTranslucency#frontFaceAlpha\n   *\n   * @example\n   * // Example 1.\n   * // Set front face translucency to 0.5 when the\n   * // camera is 1500 meters from the surface and 1.0\n   * // as the camera distance approaches 8.0e6 meters.\n   * globe.translucency.frontFaceAlphaByDistance = new Cesium.NearFarScalar(1.5e2, 0.5, 8.0e6, 1.0);\n   * globe.translucency.enabled = true;\n   *\n   * @example\n   * // Example 2.\n   * // Disable front face translucency by distance\n   * globe.translucency.frontFaceAlphaByDistance = undefined;\n   */\n  frontFaceAlphaByDistance: {\n    get: function () {\n      return this._frontFaceAlphaByDistance;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z)(value) && value.far < value.near) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z(\n          "far distance must be greater than near distance."\n        );\n      }\n      //>>includeEnd(\'debug\');\n      this._frontFaceAlphaByDistance = _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(\n        value,\n        this._frontFaceAlphaByDistance\n      );\n    },\n  },\n\n  /**\n   * A constant translucency to apply to back faces of the globe.\n   * <br /><br />\n   * {@link GlobeTranslucency#enabled} must be set to true for this option to take effect.\n   *\n   * @memberof GlobeTranslucency.prototype\n   *\n   * @type {Number}\n   * @default 1.0\n   *\n   * @see GlobeTranslucency#enabled\n   * @see GlobeTranslucency#backFaceAlphaByDistance\n   *\n   * @example\n   * // Set back face translucency to 0.5.\n   * globe.translucency.backFaceAlpha = 0.5;\n   * globe.translucency.enabled = true;\n   */\n  backFaceAlpha: {\n    get: function () {\n      return this._backFaceAlpha;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].typeOf.number.greaterThanOrEquals */ .Z.typeOf.number.greaterThanOrEquals("backFaceAlpha", value, 0.0);\n      _Core_Check_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].typeOf.number.lessThanOrEquals */ .Z.typeOf.number.lessThanOrEquals("backFaceAlpha", value, 1.0);\n      //>>includeEnd(\'debug\');\n      this._backFaceAlpha = value;\n    },\n  },\n  /**\n   * Gets or sets near and far translucency properties of back faces of the globe based on the distance to the camera.\n   * The translucency will interpolate between the {@link NearFarScalar#nearValue} and\n   * {@link NearFarScalar#farValue} while the camera distance falls within the lower and upper bounds\n   * of the specified {@link NearFarScalar#near} and {@link NearFarScalar#far}.\n   * Outside of these ranges the translucency remains clamped to the nearest bound.  If undefined,\n   * backFaceAlphaByDistance will be disabled.\n   * <br /><br />\n   * {@link GlobeTranslucency#enabled} must be set to true for this option to take effect.\n   *\n   * @memberof GlobeTranslucency.prototype\n   *\n   * @type {NearFarScalar}\n   * @default undefined\n   *\n   * @see GlobeTranslucency#enabled\n   * @see GlobeTranslucency#backFaceAlpha\n   *\n   * @example\n   * // Example 1.\n   * // Set back face translucency to 0.5 when the\n   * // camera is 1500 meters from the surface and 1.0\n   * // as the camera distance approaches 8.0e6 meters.\n   * globe.translucency.backFaceAlphaByDistance = new Cesium.NearFarScalar(1.5e2, 0.5, 8.0e6, 1.0);\n   * globe.translucency.enabled = true;\n   *\n   * @example\n   * // Example 2.\n   * // Disable back face translucency by distance\n   * globe.translucency.backFaceAlphaByDistance = undefined;\n   */\n  backFaceAlphaByDistance: {\n    get: function () {\n      return this._backFaceAlphaByDistance;\n    },\n    set: function (value) {\n      //>>includeStart(\'debug\', pragmas.debug);\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z)(value) && value.far < value.near) {\n        throw new _Core_DeveloperError_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z(\n          "far distance must be greater than near distance."\n        );\n      }\n      //>>includeEnd(\'debug\');\n      this._backFaceAlphaByDistance = _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(\n        value,\n        this._backFaceAlphaByDistance\n      );\n    },\n  },\n\n  /**\n   * A property specifying a {@link Rectangle} used to limit translucency to a cartographic area.\n   * Defaults to the maximum extent of cartographic coordinates.\n   *\n   * @memberof GlobeTranslucency.prototype\n   *\n   * @type {Rectangle}\n   * @default {@link Rectangle.MAX_VALUE}\n   */\n  rectangle: {\n    get: function () {\n      return this._rectangle;\n    },\n    set: function (value) {\n      if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z)(value)) {\n        value = _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(_Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].MAX_VALUE */ .Z.MAX_VALUE);\n      }\n      _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(value, this._rectangle);\n    },\n  },\n});\n\n/* harmony default export */ __webpack_exports__["Z"] = (GlobeTranslucency);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFlO0FBQ3JCLEtBQUs7QUFDTCxHQUFHO0FBQ0gsQ0FBQzs7QUFFRCx5REFBZSxpQkFBaUIsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3Z1ZTMtd2VicGFjazUvLi9ub2RlX21vZHVsZXMvY2VzaXVtL1NvdXJjZS9TY2VuZS9HbG9iZVRyYW5zbHVjZW5jeS5qcz9jNThlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDaGVjayBmcm9tIFwiLi4vQ29yZS9DaGVjay5qc1wiO1xuaW1wb3J0IGRlZmluZWQgZnJvbSBcIi4uL0NvcmUvZGVmaW5lZC5qc1wiO1xuaW1wb3J0IERldmVsb3BlckVycm9yIGZyb20gXCIuLi9Db3JlL0RldmVsb3BlckVycm9yLmpzXCI7XG5pbXBvcnQgTmVhckZhclNjYWxhciBmcm9tIFwiLi4vQ29yZS9OZWFyRmFyU2NhbGFyLmpzXCI7XG5pbXBvcnQgUmVjdGFuZ2xlIGZyb20gXCIuLi9Db3JlL1JlY3RhbmdsZS5qc1wiO1xuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGNvbnRyb2xsaW5nIGdsb2JlIHRyYW5zbHVjZW5jeS5cbiAqXG4gKiBAYWxpYXMgR2xvYmVUcmFuc2x1Y2VuY3lcbiAqIEBjb25zdHJ1Y3RvclxuICovXG5mdW5jdGlvbiBHbG9iZVRyYW5zbHVjZW5jeSgpIHtcbiAgdGhpcy5fZW5hYmxlZCA9IGZhbHNlO1xuICB0aGlzLl9mcm9udEZhY2VBbHBoYSA9IDEuMDtcbiAgdGhpcy5fZnJvbnRGYWNlQWxwaGFCeURpc3RhbmNlID0gdW5kZWZpbmVkO1xuICB0aGlzLl9iYWNrRmFjZUFscGhhID0gMS4wO1xuICB0aGlzLl9iYWNrRmFjZUFscGhhQnlEaXN0YW5jZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fcmVjdGFuZ2xlID0gUmVjdGFuZ2xlLmNsb25lKFJlY3RhbmdsZS5NQVhfVkFMVUUpO1xufVxuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhHbG9iZVRyYW5zbHVjZW5jeS5wcm90b3R5cGUsIHtcbiAgLyoqXG4gICAqIFdoZW4gdHJ1ZSwgdGhlIGdsb2JlIGlzIHJlbmRlcmVkIGFzIGEgdHJhbnNsdWNlbnQgc3VyZmFjZS5cbiAgICogPGJyIC8+PGJyIC8+XG4gICAqIFRoZSBhbHBoYSBpcyBjb21wdXRlZCBieSBibGVuZGluZyB7QGxpbmsgR2xvYmUjbWF0ZXJpYWx9LCB7QGxpbmsgR2xvYmUjaW1hZ2VyeUxheWVyc30sXG4gICAqIGFuZCB7QGxpbmsgR2xvYmUjYmFzZUNvbG9yfSwgYWxsIG9mIHdoaWNoIG1heSBjb250YWluIHRyYW5zbHVjZW5jeSwgYW5kIHRoZW4gbXVsdGlwbHlpbmcgYnlcbiAgICoge0BsaW5rIEdsb2JlVHJhbnNsdWNlbmN5I2Zyb250RmFjZUFscGhhfSBhbmQge0BsaW5rIEdsb2JlVHJhbnNsdWNlbmN5I2Zyb250RmFjZUFscGhhQnlEaXN0YW5jZX0gZm9yIGZyb250IGZhY2VzIGFuZFxuICAgKiB7QGxpbmsgR2xvYmVUcmFuc2x1Y2VuY3kjYmFja0ZhY2VBbHBoYX0gYW5kIHtAbGluayBHbG9iZVRyYW5zbHVjZW5jeSNiYWNrRmFjZUFscGhhQnlEaXN0YW5jZX0gZm9yIGJhY2sgZmFjZXMuXG4gICAqIFdoZW4gdGhlIGNhbWVyYSBpcyB1bmRlcmdyb3VuZCBiYWNrIGZhY2VzIGFuZCBmcm9udCBmYWNlcyBhcmUgc3dhcHBlZCwgaS5lLiBiYWNrLWZhY2luZyBnZW9tZXRyeVxuICAgKiBpcyBjb25zaWRlcmVkIGZyb250IGZhY2luZy5cbiAgICogPGJyIC8+PGJyIC8+XG4gICAqIFRyYW5zbHVjZW5jeSBpcyBkaXNhYmxlZCBieSBkZWZhdWx0LlxuICAgKlxuICAgKiBAbWVtYmVyb2YgR2xvYmVUcmFuc2x1Y2VuY3kucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKlxuICAgKiBAc2VlIEdsb2JlVHJhbnNsdWNlbmN5I2Zyb250RmFjZUFscGhhXG4gICAqIEBzZWUgR2xvYmVUcmFuc2x1Y2VuY3kjZnJvbnRGYWNlQWxwaGFCeURpc3RhbmNlXG4gICAqIEBzZWUgR2xvYmVUcmFuc2x1Y2VuY3kjYmFja0ZhY2VBbHBoYVxuICAgKiBAc2VlIEdsb2JlVHJhbnNsdWNlbmN5I2JhY2tGYWNlQWxwaGFCeURpc3RhbmNlXG4gICAqL1xuICBlbmFibGVkOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgQ2hlY2sudHlwZU9mLmJvb2woXCJlbmFibGVkXCIsIHZhbHVlKTtcbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuICAgICAgdGhpcy5fZW5hYmxlZCA9IHZhbHVlO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEEgY29uc3RhbnQgdHJhbnNsdWNlbmN5IHRvIGFwcGx5IHRvIGZyb250IGZhY2VzIG9mIHRoZSBnbG9iZS5cbiAgICogPGJyIC8+PGJyIC8+XG4gICAqIHtAbGluayBHbG9iZVRyYW5zbHVjZW5jeSNlbmFibGVkfSBtdXN0IGJlIHNldCB0byB0cnVlIGZvciB0aGlzIG9wdGlvbiB0byB0YWtlIGVmZmVjdC5cbiAgICpcbiAgICogQG1lbWJlcm9mIEdsb2JlVHJhbnNsdWNlbmN5LnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAxLjBcbiAgICpcbiAgICogQHNlZSBHbG9iZVRyYW5zbHVjZW5jeSNlbmFibGVkXG4gICAqIEBzZWUgR2xvYmVUcmFuc2x1Y2VuY3kjZnJvbnRGYWNlQWxwaGFCeURpc3RhbmNlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIC8vIFNldCBmcm9udCBmYWNlIHRyYW5zbHVjZW5jeSB0byAwLjUuXG4gICAqIGdsb2JlLnRyYW5zbHVjZW5jeS5mcm9udEZhY2VBbHBoYSA9IDAuNTtcbiAgICogZ2xvYmUudHJhbnNsdWNlbmN5LmVuYWJsZWQgPSB0cnVlO1xuICAgKi9cbiAgZnJvbnRGYWNlQWxwaGE6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9mcm9udEZhY2VBbHBoYTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgQ2hlY2sudHlwZU9mLm51bWJlci5ncmVhdGVyVGhhbk9yRXF1YWxzKFwiZnJvbnRGYWNlQWxwaGFcIiwgdmFsdWUsIDAuMCk7XG4gICAgICBDaGVjay50eXBlT2YubnVtYmVyLmxlc3NUaGFuT3JFcXVhbHMoXCJmcm9udEZhY2VBbHBoYVwiLCB2YWx1ZSwgMS4wKTtcbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuICAgICAgdGhpcy5fZnJvbnRGYWNlQWxwaGEgPSB2YWx1ZTtcbiAgICB9LFxuICB9LFxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIG5lYXIgYW5kIGZhciB0cmFuc2x1Y2VuY3kgcHJvcGVydGllcyBvZiBmcm9udCBmYWNlcyBvZiB0aGUgZ2xvYmUgYmFzZWQgb24gdGhlIGRpc3RhbmNlIHRvIHRoZSBjYW1lcmEuXG4gICAqIFRoZSB0cmFuc2x1Y2VuY3kgd2lsbCBpbnRlcnBvbGF0ZSBiZXR3ZWVuIHRoZSB7QGxpbmsgTmVhckZhclNjYWxhciNuZWFyVmFsdWV9IGFuZFxuICAgKiB7QGxpbmsgTmVhckZhclNjYWxhciNmYXJWYWx1ZX0gd2hpbGUgdGhlIGNhbWVyYSBkaXN0YW5jZSBmYWxscyB3aXRoaW4gdGhlIGxvd2VyIGFuZCB1cHBlciBib3VuZHNcbiAgICogb2YgdGhlIHNwZWNpZmllZCB7QGxpbmsgTmVhckZhclNjYWxhciNuZWFyfSBhbmQge0BsaW5rIE5lYXJGYXJTY2FsYXIjZmFyfS5cbiAgICogT3V0c2lkZSBvZiB0aGVzZSByYW5nZXMgdGhlIHRyYW5zbHVjZW5jeSByZW1haW5zIGNsYW1wZWQgdG8gdGhlIG5lYXJlc3QgYm91bmQuICBJZiB1bmRlZmluZWQsXG4gICAqIGZyb250RmFjZUFscGhhQnlEaXN0YW5jZSB3aWxsIGJlIGRpc2FibGVkLlxuICAgKiA8YnIgLz48YnIgLz5cbiAgICoge0BsaW5rIEdsb2JlVHJhbnNsdWNlbmN5I2VuYWJsZWR9IG11c3QgYmUgc2V0IHRvIHRydWUgZm9yIHRoaXMgb3B0aW9uIHRvIHRha2UgZWZmZWN0LlxuICAgKlxuICAgKiBAbWVtYmVyb2YgR2xvYmVUcmFuc2x1Y2VuY3kucHJvdG90eXBlXG4gICAqXG4gICAqIEB0eXBlIHtOZWFyRmFyU2NhbGFyfVxuICAgKiBAZGVmYXVsdCB1bmRlZmluZWRcbiAgICpcbiAgICogQHNlZSBHbG9iZVRyYW5zbHVjZW5jeSNlbmFibGVkXG4gICAqIEBzZWUgR2xvYmVUcmFuc2x1Y2VuY3kjZnJvbnRGYWNlQWxwaGFcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogLy8gRXhhbXBsZSAxLlxuICAgKiAvLyBTZXQgZnJvbnQgZmFjZSB0cmFuc2x1Y2VuY3kgdG8gMC41IHdoZW4gdGhlXG4gICAqIC8vIGNhbWVyYSBpcyAxNTAwIG1ldGVycyBmcm9tIHRoZSBzdXJmYWNlIGFuZCAxLjBcbiAgICogLy8gYXMgdGhlIGNhbWVyYSBkaXN0YW5jZSBhcHByb2FjaGVzIDguMGU2IG1ldGVycy5cbiAgICogZ2xvYmUudHJhbnNsdWNlbmN5LmZyb250RmFjZUFscGhhQnlEaXN0YW5jZSA9IG5ldyBDZXNpdW0uTmVhckZhclNjYWxhcigxLjVlMiwgMC41LCA4LjBlNiwgMS4wKTtcbiAgICogZ2xvYmUudHJhbnNsdWNlbmN5LmVuYWJsZWQgPSB0cnVlO1xuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBFeGFtcGxlIDIuXG4gICAqIC8vIERpc2FibGUgZnJvbnQgZmFjZSB0cmFuc2x1Y2VuY3kgYnkgZGlzdGFuY2VcbiAgICogZ2xvYmUudHJhbnNsdWNlbmN5LmZyb250RmFjZUFscGhhQnlEaXN0YW5jZSA9IHVuZGVmaW5lZDtcbiAgICovXG4gIGZyb250RmFjZUFscGhhQnlEaXN0YW5jZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2Zyb250RmFjZUFscGhhQnlEaXN0YW5jZTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLz4+aW5jbHVkZVN0YXJ0KCdkZWJ1ZycsIHByYWdtYXMuZGVidWcpO1xuICAgICAgaWYgKGRlZmluZWQodmFsdWUpICYmIHZhbHVlLmZhciA8IHZhbHVlLm5lYXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFxuICAgICAgICAgIFwiZmFyIGRpc3RhbmNlIG11c3QgYmUgZ3JlYXRlciB0aGFuIG5lYXIgZGlzdGFuY2UuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIC8vPj5pbmNsdWRlRW5kKCdkZWJ1ZycpO1xuICAgICAgdGhpcy5fZnJvbnRGYWNlQWxwaGFCeURpc3RhbmNlID0gTmVhckZhclNjYWxhci5jbG9uZShcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIHRoaXMuX2Zyb250RmFjZUFscGhhQnlEaXN0YW5jZVxuICAgICAgKTtcbiAgICB9LFxuICB9LFxuXG4gIC8qKlxuICAgKiBBIGNvbnN0YW50IHRyYW5zbHVjZW5jeSB0byBhcHBseSB0byBiYWNrIGZhY2VzIG9mIHRoZSBnbG9iZS5cbiAgICogPGJyIC8+PGJyIC8+XG4gICAqIHtAbGluayBHbG9iZVRyYW5zbHVjZW5jeSNlbmFibGVkfSBtdXN0IGJlIHNldCB0byB0cnVlIGZvciB0aGlzIG9wdGlvbiB0byB0YWtlIGVmZmVjdC5cbiAgICpcbiAgICogQG1lbWJlcm9mIEdsb2JlVHJhbnNsdWNlbmN5LnByb3RvdHlwZVxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAZGVmYXVsdCAxLjBcbiAgICpcbiAgICogQHNlZSBHbG9iZVRyYW5zbHVjZW5jeSNlbmFibGVkXG4gICAqIEBzZWUgR2xvYmVUcmFuc2x1Y2VuY3kjYmFja0ZhY2VBbHBoYUJ5RGlzdGFuY2VcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogLy8gU2V0IGJhY2sgZmFjZSB0cmFuc2x1Y2VuY3kgdG8gMC41LlxuICAgKiBnbG9iZS50cmFuc2x1Y2VuY3kuYmFja0ZhY2VBbHBoYSA9IDAuNTtcbiAgICogZ2xvYmUudHJhbnNsdWNlbmN5LmVuYWJsZWQgPSB0cnVlO1xuICAgKi9cbiAgYmFja0ZhY2VBbHBoYToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2JhY2tGYWNlQWxwaGE7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICAgIENoZWNrLnR5cGVPZi5udW1iZXIuZ3JlYXRlclRoYW5PckVxdWFscyhcImJhY2tGYWNlQWxwaGFcIiwgdmFsdWUsIDAuMCk7XG4gICAgICBDaGVjay50eXBlT2YubnVtYmVyLmxlc3NUaGFuT3JFcXVhbHMoXCJiYWNrRmFjZUFscGhhXCIsIHZhbHVlLCAxLjApO1xuICAgICAgLy8+PmluY2x1ZGVFbmQoJ2RlYnVnJyk7XG4gICAgICB0aGlzLl9iYWNrRmFjZUFscGhhID0gdmFsdWU7XG4gICAgfSxcbiAgfSxcbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyBuZWFyIGFuZCBmYXIgdHJhbnNsdWNlbmN5IHByb3BlcnRpZXMgb2YgYmFjayBmYWNlcyBvZiB0aGUgZ2xvYmUgYmFzZWQgb24gdGhlIGRpc3RhbmNlIHRvIHRoZSBjYW1lcmEuXG4gICAqIFRoZSB0cmFuc2x1Y2VuY3kgd2lsbCBpbnRlcnBvbGF0ZSBiZXR3ZWVuIHRoZSB7QGxpbmsgTmVhckZhclNjYWxhciNuZWFyVmFsdWV9IGFuZFxuICAgKiB7QGxpbmsgTmVhckZhclNjYWxhciNmYXJWYWx1ZX0gd2hpbGUgdGhlIGNhbWVyYSBkaXN0YW5jZSBmYWxscyB3aXRoaW4gdGhlIGxvd2VyIGFuZCB1cHBlciBib3VuZHNcbiAgICogb2YgdGhlIHNwZWNpZmllZCB7QGxpbmsgTmVhckZhclNjYWxhciNuZWFyfSBhbmQge0BsaW5rIE5lYXJGYXJTY2FsYXIjZmFyfS5cbiAgICogT3V0c2lkZSBvZiB0aGVzZSByYW5nZXMgdGhlIHRyYW5zbHVjZW5jeSByZW1haW5zIGNsYW1wZWQgdG8gdGhlIG5lYXJlc3QgYm91bmQuICBJZiB1bmRlZmluZWQsXG4gICAqIGJhY2tGYWNlQWxwaGFCeURpc3RhbmNlIHdpbGwgYmUgZGlzYWJsZWQuXG4gICAqIDxiciAvPjxiciAvPlxuICAgKiB7QGxpbmsgR2xvYmVUcmFuc2x1Y2VuY3kjZW5hYmxlZH0gbXVzdCBiZSBzZXQgdG8gdHJ1ZSBmb3IgdGhpcyBvcHRpb24gdG8gdGFrZSBlZmZlY3QuXG4gICAqXG4gICAqIEBtZW1iZXJvZiBHbG9iZVRyYW5zbHVjZW5jeS5wcm90b3R5cGVcbiAgICpcbiAgICogQHR5cGUge05lYXJGYXJTY2FsYXJ9XG4gICAqIEBkZWZhdWx0IHVuZGVmaW5lZFxuICAgKlxuICAgKiBAc2VlIEdsb2JlVHJhbnNsdWNlbmN5I2VuYWJsZWRcbiAgICogQHNlZSBHbG9iZVRyYW5zbHVjZW5jeSNiYWNrRmFjZUFscGhhXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIC8vIEV4YW1wbGUgMS5cbiAgICogLy8gU2V0IGJhY2sgZmFjZSB0cmFuc2x1Y2VuY3kgdG8gMC41IHdoZW4gdGhlXG4gICAqIC8vIGNhbWVyYSBpcyAxNTAwIG1ldGVycyBmcm9tIHRoZSBzdXJmYWNlIGFuZCAxLjBcbiAgICogLy8gYXMgdGhlIGNhbWVyYSBkaXN0YW5jZSBhcHByb2FjaGVzIDguMGU2IG1ldGVycy5cbiAgICogZ2xvYmUudHJhbnNsdWNlbmN5LmJhY2tGYWNlQWxwaGFCeURpc3RhbmNlID0gbmV3IENlc2l1bS5OZWFyRmFyU2NhbGFyKDEuNWUyLCAwLjUsIDguMGU2LCAxLjApO1xuICAgKiBnbG9iZS50cmFuc2x1Y2VuY3kuZW5hYmxlZCA9IHRydWU7XG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIC8vIEV4YW1wbGUgMi5cbiAgICogLy8gRGlzYWJsZSBiYWNrIGZhY2UgdHJhbnNsdWNlbmN5IGJ5IGRpc3RhbmNlXG4gICAqIGdsb2JlLnRyYW5zbHVjZW5jeS5iYWNrRmFjZUFscGhhQnlEaXN0YW5jZSA9IHVuZGVmaW5lZDtcbiAgICovXG4gIGJhY2tGYWNlQWxwaGFCeURpc3RhbmNlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYmFja0ZhY2VBbHBoYUJ5RGlzdGFuY2U7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgLy8+PmluY2x1ZGVTdGFydCgnZGVidWcnLCBwcmFnbWFzLmRlYnVnKTtcbiAgICAgIGlmIChkZWZpbmVkKHZhbHVlKSAmJiB2YWx1ZS5mYXIgPCB2YWx1ZS5uZWFyKSB7XG4gICAgICAgIHRocm93IG5ldyBEZXZlbG9wZXJFcnJvcihcbiAgICAgICAgICBcImZhciBkaXN0YW5jZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBuZWFyIGRpc3RhbmNlLlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICAvLz4+aW5jbHVkZUVuZCgnZGVidWcnKTtcbiAgICAgIHRoaXMuX2JhY2tGYWNlQWxwaGFCeURpc3RhbmNlID0gTmVhckZhclNjYWxhci5jbG9uZShcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIHRoaXMuX2JhY2tGYWNlQWxwaGFCeURpc3RhbmNlXG4gICAgICApO1xuICAgIH0sXG4gIH0sXG5cbiAgLyoqXG4gICAqIEEgcHJvcGVydHkgc3BlY2lmeWluZyBhIHtAbGluayBSZWN0YW5nbGV9IHVzZWQgdG8gbGltaXQgdHJhbnNsdWNlbmN5IHRvIGEgY2FydG9ncmFwaGljIGFyZWEuXG4gICAqIERlZmF1bHRzIHRvIHRoZSBtYXhpbXVtIGV4dGVudCBvZiBjYXJ0b2dyYXBoaWMgY29vcmRpbmF0ZXMuXG4gICAqXG4gICAqIEBtZW1iZXJvZiBHbG9iZVRyYW5zbHVjZW5jeS5wcm90b3R5cGVcbiAgICpcbiAgICogQHR5cGUge1JlY3RhbmdsZX1cbiAgICogQGRlZmF1bHQge0BsaW5rIFJlY3RhbmdsZS5NQVhfVkFMVUV9XG4gICAqL1xuICByZWN0YW5nbGU6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9yZWN0YW5nbGU7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKCFkZWZpbmVkKHZhbHVlKSkge1xuICAgICAgICB2YWx1ZSA9IFJlY3RhbmdsZS5jbG9uZShSZWN0YW5nbGUuTUFYX1ZBTFVFKTtcbiAgICAgIH1cbiAgICAgIFJlY3RhbmdsZS5jbG9uZSh2YWx1ZSwgdGhpcy5fcmVjdGFuZ2xlKTtcbiAgICB9LFxuICB9LFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IEdsb2JlVHJhbnNsdWNlbmN5O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///90538\n')},55606:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(88108);\n/* harmony import */ var _Core_Color_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(59947);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(82982);\n/* harmony import */ var _Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(86511);\n/* harmony import */ var _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(38443);\n/* harmony import */ var _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(39899);\n/* harmony import */ var _Renderer_Framebuffer_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(2932);\n/* harmony import */ var _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(21572);\n/* harmony import */ var _Renderer_Renderbuffer_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(17941);\n/* harmony import */ var _Renderer_RenderbufferFormat_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(89032);\n/* harmony import */ var _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(10667);\n/* harmony import */ var _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(87721);\n/* harmony import */ var _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(8743);\n/* harmony import */ var _Shaders_PostProcessStages_PassThroughDepth_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(82239);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * @private\n */\nfunction GlobeTranslucencyFramebuffer() {\n  this._colorTexture = undefined;\n  this._depthStencilTexture = undefined;\n  this._depthStencilRenderbuffer = undefined;\n  this._framebuffer = undefined;\n\n  this._packedDepthTexture = undefined;\n  this._packedDepthFramebuffer = undefined;\n\n  this._renderState = undefined;\n\n  this._packedDepthCommand = undefined;\n  this._clearCommand = undefined;\n\n  this._viewport = new _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z();\n  this._useScissorTest = false;\n  this._scissorRectangle = undefined;\n  this._useHdr = undefined;\n}\n\nObject.defineProperties(GlobeTranslucencyFramebuffer.prototype, {\n  classificationTexture: {\n    get: function () {\n      return this._colorTexture;\n    },\n  },\n  classificationFramebuffer: {\n    get: function () {\n      return this._framebuffer;\n    },\n  },\n});\n\nfunction destroyResources(globeTranslucency) {\n  globeTranslucency._colorTexture =\n    globeTranslucency._colorTexture &&\n    !globeTranslucency._colorTexture.isDestroyed() &&\n    globeTranslucency._colorTexture.destroy();\n  globeTranslucency._depthStencilTexture =\n    globeTranslucency._depthStencilTexture &&\n    !globeTranslucency._depthStencilTexture.isDestroyed() &&\n    globeTranslucency._depthStencilTexture.destroy();\n  globeTranslucency._depthStencilRenderbuffer =\n    globeTranslucency._depthStencilRenderbuffer &&\n    !globeTranslucency._depthStencilRenderbuffer.isDestroyed() &&\n    globeTranslucency._depthStencilRenderbuffer.destroy();\n  globeTranslucency._framebuffer =\n    globeTranslucency._framebuffer &&\n    !globeTranslucency._framebuffer.isDestroyed() &&\n    globeTranslucency._framebuffer.destroy();\n  globeTranslucency._packedDepthTexture =\n    globeTranslucency._packedDepthTexture &&\n    !globeTranslucency._packedDepthTexture.isDestroyed() &&\n    globeTranslucency._packedDepthTexture.destroy();\n  globeTranslucency._packedDepthFramebuffer =\n    globeTranslucency._packedDepthFramebuffer &&\n    !globeTranslucency._packedDepthFramebuffer.isDestroyed() &&\n    globeTranslucency._packedDepthFramebuffer.destroy();\n}\n\nfunction createResources(globeTranslucency, context, width, height, hdr) {\n  var pixelDatatype = hdr\n    ? context.halfFloatingPointTexture\n      ? _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].HALF_FLOAT */ .Z.HALF_FLOAT\n      : _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].FLOAT */ .Z.FLOAT\n    : _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE;\n  globeTranslucency._colorTexture = new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].RGBA */ .Z.RGBA,\n    pixelDatatype: pixelDatatype,\n    sampler: _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].NEAREST */ .Z.NEAREST,\n  });\n\n  if (context.depthTexture) {\n    globeTranslucency._depthStencilTexture = new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z({\n      context: context,\n      width: width,\n      height: height,\n      pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].DEPTH_STENCIL */ .Z.DEPTH_STENCIL,\n      pixelDatatype: _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].UNSIGNED_INT_24_8 */ .Z.UNSIGNED_INT_24_8,\n    });\n  } else {\n    globeTranslucency._depthStencilRenderbuffer = new _Renderer_Renderbuffer_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z({\n      context: context,\n      width: width,\n      height: height,\n      format: _Renderer_RenderbufferFormat_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].DEPTH_STENCIL */ .Z.DEPTH_STENCIL,\n    });\n  }\n\n  globeTranslucency._framebuffer = new _Renderer_Framebuffer_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z({\n    context: context,\n    colorTextures: [globeTranslucency._colorTexture],\n    depthStencilTexture: globeTranslucency._depthStencilTexture,\n    depthStencilRenderbuffer: globeTranslucency._depthStencilRenderbuffer,\n    destroyAttachments: false,\n  });\n\n  globeTranslucency._packedDepthTexture = new _Renderer_Texture_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: _Core_PixelFormat_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].RGBA */ .Z.RGBA,\n    pixelDatatype: _Renderer_PixelDatatype_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].UNSIGNED_BYTE */ .Z.UNSIGNED_BYTE,\n    sampler: _Renderer_Sampler_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].NEAREST */ .Z.NEAREST,\n  });\n\n  globeTranslucency._packedDepthFramebuffer = new _Renderer_Framebuffer_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"] */ .Z({\n    context: context,\n    colorTextures: [globeTranslucency._packedDepthTexture],\n    destroyAttachments: false,\n  });\n}\n\nfunction updateResources(globeTranslucency, context, width, height, hdr) {\n  var colorTexture = globeTranslucency._colorTexture;\n  var textureChanged =\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(colorTexture) ||\n    colorTexture.width !== width ||\n    colorTexture.height !== height ||\n    hdr !== globeTranslucency._useHdr;\n  if (textureChanged) {\n    destroyResources(globeTranslucency);\n    createResources(globeTranslucency, context, width, height, hdr);\n  }\n}\n\nfunction updateCommands(globeTranslucency, context, width, height, passState) {\n  globeTranslucency._viewport.width = width;\n  globeTranslucency._viewport.height = height;\n\n  var useScissorTest = !_Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(\n    globeTranslucency._viewport,\n    passState.viewport\n  );\n  var updateScissor = useScissorTest !== globeTranslucency._useScissorTest;\n  globeTranslucency._useScissorTest = useScissorTest;\n\n  if (\n    !_Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(\n      globeTranslucency._scissorRectangle,\n      passState.viewport\n    )\n  ) {\n    globeTranslucency._scissorRectangle = _Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].clone */ .Z.clone(\n      passState.viewport,\n      globeTranslucency._scissorRectangle\n    );\n    updateScissor = true;\n  }\n\n  if (\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(globeTranslucency._renderState) ||\n    !_Core_BoundingRectangle_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"].equals */ .Z.equals(\n      globeTranslucency._viewport,\n      globeTranslucency._renderState.viewport\n    ) ||\n    updateScissor\n  ) {\n    globeTranslucency._renderState = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].fromCache */ .Z.fromCache({\n      viewport: globeTranslucency._viewport,\n      scissorTest: {\n        enabled: globeTranslucency._useScissorTest,\n        rectangle: globeTranslucency._scissorRectangle,\n      },\n    });\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(globeTranslucency._packedDepthCommand)) {\n    globeTranslucency._packedDepthCommand = context.createViewportQuadCommand(\n      _Shaders_PostProcessStages_PassThroughDepth_js__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z,\n      {\n        uniformMap: {\n          u_depthTexture: function () {\n            return globeTranslucency._depthStencilTexture;\n          },\n        },\n        owner: globeTranslucency,\n      }\n    );\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(globeTranslucency._clearCommand)) {\n    globeTranslucency._clearCommand = new _Renderer_ClearCommand_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z({\n      color: new _Core_Color_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z(0.0, 0.0, 0.0, 0.0),\n      depth: 1.0,\n      stencil: 0.0,\n      owner: globeTranslucency,\n    });\n  }\n\n  globeTranslucency._packedDepthCommand.framebuffer =\n    globeTranslucency._packedDepthFramebuffer;\n  globeTranslucency._packedDepthCommand.renderState =\n    globeTranslucency._renderState;\n  globeTranslucency._clearCommand.framebuffer = globeTranslucency._framebuffer;\n  globeTranslucency._clearCommand.renderState = globeTranslucency._renderState;\n}\n\nGlobeTranslucencyFramebuffer.prototype.updateAndClear = function (\n  hdr,\n  viewport,\n  context,\n  passState\n) {\n  var width = viewport.width;\n  var height = viewport.height;\n\n  updateResources(this, context, width, height, hdr);\n  updateCommands(this, context, width, height, passState);\n\n  this._useHdr = hdr;\n};\n\nGlobeTranslucencyFramebuffer.prototype.clearClassification = function (\n  context,\n  passState\n) {\n  this._clearCommand.execute(context, passState);\n};\n\nGlobeTranslucencyFramebuffer.prototype.packDepth = function (\n  context,\n  passState\n) {\n  this._packedDepthCommand.execute(context, passState);\n  return this._packedDepthTexture;\n};\n\nGlobeTranslucencyFramebuffer.prototype.isDestroyed = function () {\n  return false;\n};\n\nGlobeTranslucencyFramebuffer.prototype.destroy = function () {\n  destroyResources(this);\n  return (0,_Core_destroyObject_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z)(this);\n};\n\n/* harmony default export */ __webpack_exports__["Z"] = (GlobeTranslucencyFramebuffer);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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NS8uL25vZGVfbW9kdWxlcy9jZXNpdW0vU291cmNlL1NjZW5lL0dsb2JlVHJhbnNsdWNlbmN5RnJhbWVidWZmZXIuanM/MDdlNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQm91bmRpbmdSZWN0YW5nbGUgZnJvbSBcIi4uL0NvcmUvQm91bmRpbmdSZWN0YW5nbGUuanNcIjtcbmltcG9ydCBDb2xvciBmcm9tIFwiLi4vQ29yZS9Db2xvci5qc1wiO1xuaW1wb3J0IGRlZmluZWQgZnJvbSBcIi4uL0NvcmUvZGVmaW5lZC5qc1wiO1xuaW1wb3J0IGRlc3Ryb3lPYmplY3QgZnJvbSBcIi4uL0NvcmUvZGVzdHJveU9iamVjdC5qc1wiO1xuaW1wb3J0IFBpeGVsRm9ybWF0IGZyb20gXCIuLi9Db3JlL1BpeGVsRm9ybWF0LmpzXCI7XG5pbXBvcnQgQ2xlYXJDb21tYW5kIGZyb20gXCIuLi9SZW5kZXJlci9DbGVhckNvbW1hbmQuanNcIjtcbmltcG9ydCBGcmFtZWJ1ZmZlciBmcm9tIFwiLi4vUmVuZGVyZXIvRnJhbWVidWZmZXIuanNcIjtcbmltcG9ydCBQaXhlbERhdGF0eXBlIGZyb20gXCIuLi9SZW5kZXJlci9QaXhlbERhdGF0eXBlLmpzXCI7XG5pbXBvcnQgUmVuZGVyYnVmZmVyIGZyb20gXCIuLi9SZW5kZXJlci9SZW5kZXJidWZmZXIuanNcIjtcbmltcG9ydCBSZW5kZXJidWZmZXJGb3JtYXQgZnJvbSBcIi4uL1JlbmRlcmVyL1JlbmRlcmJ1ZmZlckZvcm1hdC5qc1wiO1xuaW1wb3J0IFJlbmRlclN0YXRlIGZyb20gXCIuLi9SZW5kZXJlci9SZW5kZXJTdGF0ZS5qc1wiO1xuaW1wb3J0IFNhbXBsZXIgZnJvbSBcIi4uL1JlbmRlcmVyL1NhbXBsZXIuanNcIjtcbmltcG9ydCBUZXh0dXJlIGZyb20gXCIuLi9SZW5kZXJlci9UZXh0dXJlLmpzXCI7XG5pbXBvcnQgUGFzc1Rocm91Z2hEZXB0aCBmcm9tIFwiLi4vU2hhZGVycy9Qb3N0UHJvY2Vzc1N0YWdlcy9QYXNzVGhyb3VnaERlcHRoLmpzXCI7XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gR2xvYmVUcmFuc2x1Y2VuY3lGcmFtZWJ1ZmZlcigpIHtcbiAgdGhpcy5fY29sb3JUZXh0dXJlID0gdW5kZWZpbmVkO1xuICB0aGlzLl9kZXB0aFN0ZW5jaWxUZXh0dXJlID0gdW5kZWZpbmVkO1xuICB0aGlzLl9kZXB0aFN0ZW5jaWxSZW5kZXJidWZmZXIgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2ZyYW1lYnVmZmVyID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMuX3BhY2tlZERlcHRoVGV4dHVyZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5fcGFja2VkRGVwdGhGcmFtZWJ1ZmZlciA9IHVuZGVmaW5lZDtcblxuICB0aGlzLl9yZW5kZXJTdGF0ZSA9IHVuZGVmaW5lZDtcblxuICB0aGlzLl9wYWNrZWREZXB0aENvbW1hbmQgPSB1bmRlZmluZWQ7XG4gIHRoaXMuX2NsZWFyQ29tbWFuZCA9IHVuZGVmaW5lZDtcblxuICB0aGlzLl92aWV3cG9ydCA9IG5ldyBCb3VuZGluZ1JlY3RhbmdsZSgpO1xuICB0aGlzLl91c2VTY2lzc29yVGVzdCA9IGZhbHNlO1xuICB0aGlzLl9zY2lzc29yUmVjdGFuZ2xlID0gdW5kZWZpbmVkO1xuICB0aGlzLl91c2VIZHIgPSB1bmRlZmluZWQ7XG59XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEdsb2JlVHJhbnNsdWNlbmN5RnJhbWVidWZmZXIucHJvdG90eXBlLCB7XG4gIGNsYXNzaWZpY2F0aW9uVGV4dHVyZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvbG9yVGV4dHVyZTtcbiAgICB9LFxuICB9LFxuICBjbGFzc2lmaWNhdGlvbkZyYW1lYnVmZmVyOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZnJhbWVidWZmZXI7XG4gICAgfSxcbiAgfSxcbn0pO1xuXG5mdW5jdGlvbiBkZXN0cm95UmVzb3VyY2VzKGdsb2JlVHJhbnNsdWNlbmN5KSB7XG4gIGdsb2JlVHJhbnNsdWNlbmN5Ll9jb2xvclRleHR1cmUgPVxuICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll9jb2xvclRleHR1cmUgJiZcbiAgICAhZ2xvYmVUcmFuc2x1Y2VuY3kuX2NvbG9yVGV4dHVyZS5pc0Rlc3Ryb3llZCgpICYmXG4gICAgZ2xvYmVUcmFuc2x1Y2VuY3kuX2NvbG9yVGV4dHVyZS5kZXN0cm95KCk7XG4gIGdsb2JlVHJhbnNsdWNlbmN5Ll9kZXB0aFN0ZW5jaWxUZXh0dXJlID1cbiAgICBnbG9iZVRyYW5zbHVjZW5jeS5fZGVwdGhTdGVuY2lsVGV4dHVyZSAmJlxuICAgICFnbG9iZVRyYW5zbHVjZW5jeS5fZGVwdGhTdGVuY2lsVGV4dHVyZS5pc0Rlc3Ryb3llZCgpICYmXG4gICAgZ2xvYmVUcmFuc2x1Y2VuY3kuX2RlcHRoU3RlbmNpbFRleHR1cmUuZGVzdHJveSgpO1xuICBnbG9iZVRyYW5zbHVjZW5jeS5fZGVwdGhTdGVuY2lsUmVuZGVyYnVmZmVyID1cbiAgICBnbG9iZVRyYW5zbHVjZW5jeS5fZGVwdGhTdGVuY2lsUmVuZGVyYnVmZmVyICYmXG4gICAgIWdsb2JlVHJhbnNsdWNlbmN5Ll9kZXB0aFN0ZW5jaWxSZW5kZXJidWZmZXIuaXNEZXN0cm95ZWQoKSAmJlxuICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll9kZXB0aFN0ZW5jaWxSZW5kZXJidWZmZXIuZGVzdHJveSgpO1xuICBnbG9iZVRyYW5zbHVjZW5jeS5fZnJhbWVidWZmZXIgPVxuICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll9mcmFtZWJ1ZmZlciAmJlxuICAgICFnbG9iZVRyYW5zbHVjZW5jeS5fZnJhbWVidWZmZXIuaXNEZXN0cm95ZWQoKSAmJlxuICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll9mcmFtZWJ1ZmZlci5kZXN0cm95KCk7XG4gIGdsb2JlVHJhbnNsdWNlbmN5Ll9wYWNrZWREZXB0aFRleHR1cmUgPVxuICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll9wYWNrZWREZXB0aFRleHR1cmUgJiZcbiAgICAhZ2xvYmVUcmFuc2x1Y2VuY3kuX3BhY2tlZERlcHRoVGV4dHVyZS5pc0Rlc3Ryb3llZCgpICYmXG4gICAgZ2xvYmVUcmFuc2x1Y2VuY3kuX3BhY2tlZERlcHRoVGV4dHVyZS5kZXN0cm95KCk7XG4gIGdsb2JlVHJhbnNsdWNlbmN5Ll9wYWNrZWREZXB0aEZyYW1lYnVmZmVyID1cbiAgICBnbG9iZVRyYW5zbHVjZW5jeS5fcGFja2VkRGVwdGhGcmFtZWJ1ZmZlciAmJlxuICAgICFnbG9iZVRyYW5zbHVjZW5jeS5fcGFja2VkRGVwdGhGcmFtZWJ1ZmZlci5pc0Rlc3Ryb3llZCgpICYmXG4gICAgZ2xvYmVUcmFuc2x1Y2VuY3kuX3BhY2tlZERlcHRoRnJhbWVidWZmZXIuZGVzdHJveSgpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVSZXNvdXJjZXMoZ2xvYmVUcmFuc2x1Y2VuY3ksIGNvbnRleHQsIHdpZHRoLCBoZWlnaHQsIGhkcikge1xuICB2YXIgcGl4ZWxEYXRhdHlwZSA9IGhkclxuICAgID8gY29udGV4dC5oYWxmRmxvYXRpbmdQb2ludFRleHR1cmVcbiAgICAgID8gUGl4ZWxEYXRhdHlwZS5IQUxGX0ZMT0FUXG4gICAgICA6IFBpeGVsRGF0YXR5cGUuRkxPQVRcbiAgICA6IFBpeGVsRGF0YXR5cGUuVU5TSUdORURfQllURTtcbiAgZ2xvYmVUcmFuc2x1Y2VuY3kuX2NvbG9yVGV4dHVyZSA9IG5ldyBUZXh0dXJlKHtcbiAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIHdpZHRoOiB3aWR0aCxcbiAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICBwaXhlbEZvcm1hdDogUGl4ZWxGb3JtYXQuUkdCQSxcbiAgICBwaXhlbERhdGF0eXBlOiBwaXhlbERhdGF0eXBlLFxuICAgIHNhbXBsZXI6IFNhbXBsZXIuTkVBUkVTVCxcbiAgfSk7XG5cbiAgaWYgKGNvbnRleHQuZGVwdGhUZXh0dXJlKSB7XG4gICAgZ2xvYmVUcmFuc2x1Y2VuY3kuX2RlcHRoU3RlbmNpbFRleHR1cmUgPSBuZXcgVGV4dHVyZSh7XG4gICAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICBwaXhlbEZvcm1hdDogUGl4ZWxGb3JtYXQuREVQVEhfU1RFTkNJTCxcbiAgICAgIHBpeGVsRGF0YXR5cGU6IFBpeGVsRGF0YXR5cGUuVU5TSUdORURfSU5UXzI0XzgsXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgZ2xvYmVUcmFuc2x1Y2VuY3kuX2RlcHRoU3RlbmNpbFJlbmRlcmJ1ZmZlciA9IG5ldyBSZW5kZXJidWZmZXIoe1xuICAgICAgY29udGV4dDogY29udGV4dCxcbiAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgZm9ybWF0OiBSZW5kZXJidWZmZXJGb3JtYXQuREVQVEhfU1RFTkNJTCxcbiAgICB9KTtcbiAgfVxuXG4gIGdsb2JlVHJhbnNsdWNlbmN5Ll9mcmFtZWJ1ZmZlciA9IG5ldyBGcmFtZWJ1ZmZlcih7XG4gICAgY29udGV4dDogY29udGV4dCxcbiAgICBjb2xvclRleHR1cmVzOiBbZ2xvYmVUcmFuc2x1Y2VuY3kuX2NvbG9yVGV4dHVyZV0sXG4gICAgZGVwdGhTdGVuY2lsVGV4dHVyZTogZ2xvYmVUcmFuc2x1Y2VuY3kuX2RlcHRoU3RlbmNpbFRleHR1cmUsXG4gICAgZGVwdGhTdGVuY2lsUmVuZGVyYnVmZmVyOiBnbG9iZVRyYW5zbHVjZW5jeS5fZGVwdGhTdGVuY2lsUmVuZGVyYnVmZmVyLFxuICAgIGRlc3Ryb3lBdHRhY2htZW50czogZmFsc2UsXG4gIH0pO1xuXG4gIGdsb2JlVHJhbnNsdWNlbmN5Ll9wYWNrZWREZXB0aFRleHR1cmUgPSBuZXcgVGV4dHVyZSh7XG4gICAgY29udGV4dDogY29udGV4dCxcbiAgICB3aWR0aDogd2lkdGgsXG4gICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgcGl4ZWxGb3JtYXQ6IFBpeGVsRm9ybWF0LlJHQkEsXG4gICAgcGl4ZWxEYXRhdHlwZTogUGl4ZWxEYXRhdHlwZS5VTlNJR05FRF9CWVRFLFxuICAgIHNhbXBsZXI6IFNhbXBsZXIuTkVBUkVTVCxcbiAgfSk7XG5cbiAgZ2xvYmVUcmFuc2x1Y2VuY3kuX3BhY2tlZERlcHRoRnJhbWVidWZmZXIgPSBuZXcgRnJhbWVidWZmZXIoe1xuICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgY29sb3JUZXh0dXJlczogW2dsb2JlVHJhbnNsdWNlbmN5Ll9wYWNrZWREZXB0aFRleHR1cmVdLFxuICAgIGRlc3Ryb3lBdHRhY2htZW50czogZmFsc2UsXG4gIH0pO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVSZXNvdXJjZXMoZ2xvYmVUcmFuc2x1Y2VuY3ksIGNvbnRleHQsIHdpZHRoLCBoZWlnaHQsIGhkcikge1xuICB2YXIgY29sb3JUZXh0dXJlID0gZ2xvYmVUcmFuc2x1Y2VuY3kuX2NvbG9yVGV4dHVyZTtcbiAgdmFyIHRleHR1cmVDaGFuZ2VkID1cbiAgICAhZGVmaW5lZChjb2xvclRleHR1cmUpIHx8XG4gICAgY29sb3JUZXh0dXJlLndpZHRoICE9PSB3aWR0aCB8fFxuICAgIGNvbG9yVGV4dHVyZS5oZWlnaHQgIT09IGhlaWdodCB8fFxuICAgIGhkciAhPT0gZ2xvYmVUcmFuc2x1Y2VuY3kuX3VzZUhkcjtcbiAgaWYgKHRleHR1cmVDaGFuZ2VkKSB7XG4gICAgZGVzdHJveVJlc291cmNlcyhnbG9iZVRyYW5zbHVjZW5jeSk7XG4gICAgY3JlYXRlUmVzb3VyY2VzKGdsb2JlVHJhbnNsdWNlbmN5LCBjb250ZXh0LCB3aWR0aCwgaGVpZ2h0LCBoZHIpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUNvbW1hbmRzKGdsb2JlVHJhbnNsdWNlbmN5LCBjb250ZXh0LCB3aWR0aCwgaGVpZ2h0LCBwYXNzU3RhdGUpIHtcbiAgZ2xvYmVUcmFuc2x1Y2VuY3kuX3ZpZXdwb3J0LndpZHRoID0gd2lkdGg7XG4gIGdsb2JlVHJhbnNsdWNlbmN5Ll92aWV3cG9ydC5oZWlnaHQgPSBoZWlnaHQ7XG5cbiAgdmFyIHVzZVNjaXNzb3JUZXN0ID0gIUJvdW5kaW5nUmVjdGFuZ2xlLmVxdWFscyhcbiAgICBnbG9iZVRyYW5zbHVjZW5jeS5fdmlld3BvcnQsXG4gICAgcGFzc1N0YXRlLnZpZXdwb3J0XG4gICk7XG4gIHZhciB1cGRhdGVTY2lzc29yID0gdXNlU2Npc3NvclRlc3QgIT09IGdsb2JlVHJhbnNsdWNlbmN5Ll91c2VTY2lzc29yVGVzdDtcbiAgZ2xvYmVUcmFuc2x1Y2VuY3kuX3VzZVNjaXNzb3JUZXN0ID0gdXNlU2Npc3NvclRlc3Q7XG5cbiAgaWYgKFxuICAgICFCb3VuZGluZ1JlY3RhbmdsZS5lcXVhbHMoXG4gICAgICBnbG9iZVRyYW5zbHVjZW5jeS5fc2Npc3NvclJlY3RhbmdsZSxcbiAgICAgIHBhc3NTdGF0ZS52aWV3cG9ydFxuICAgIClcbiAgKSB7XG4gICAgZ2xvYmVUcmFuc2x1Y2VuY3kuX3NjaXNzb3JSZWN0YW5nbGUgPSBCb3VuZGluZ1JlY3RhbmdsZS5jbG9uZShcbiAgICAgIHBhc3NTdGF0ZS52aWV3cG9ydCxcbiAgICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll9zY2lzc29yUmVjdGFuZ2xlXG4gICAgKTtcbiAgICB1cGRhdGVTY2lzc29yID0gdHJ1ZTtcbiAgfVxuXG4gIGlmIChcbiAgICAhZGVmaW5lZChnbG9iZVRyYW5zbHVjZW5jeS5fcmVuZGVyU3RhdGUpIHx8XG4gICAgIUJvdW5kaW5nUmVjdGFuZ2xlLmVxdWFscyhcbiAgICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll92aWV3cG9ydCxcbiAgICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll9yZW5kZXJTdGF0ZS52aWV3cG9ydFxuICAgICkgfHxcbiAgICB1cGRhdGVTY2lzc29yXG4gICkge1xuICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll9yZW5kZXJTdGF0ZSA9IFJlbmRlclN0YXRlLmZyb21DYWNoZSh7XG4gICAgICB2aWV3cG9ydDogZ2xvYmVUcmFuc2x1Y2VuY3kuX3ZpZXdwb3J0LFxuICAgICAgc2Npc3NvclRlc3Q6IHtcbiAgICAgICAgZW5hYmxlZDogZ2xvYmVUcmFuc2x1Y2VuY3kuX3VzZVNjaXNzb3JUZXN0LFxuICAgICAgICByZWN0YW5nbGU6IGdsb2JlVHJhbnNsdWNlbmN5Ll9zY2lzc29yUmVjdGFuZ2xlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGlmICghZGVmaW5lZChnbG9iZVRyYW5zbHVjZW5jeS5fcGFja2VkRGVwdGhDb21tYW5kKSkge1xuICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll9wYWNrZWREZXB0aENvbW1hbmQgPSBjb250ZXh0LmNyZWF0ZVZpZXdwb3J0UXVhZENvbW1hbmQoXG4gICAgICBQYXNzVGhyb3VnaERlcHRoLFxuICAgICAge1xuICAgICAgICB1bmlmb3JtTWFwOiB7XG4gICAgICAgICAgdV9kZXB0aFRleHR1cmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnbG9iZVRyYW5zbHVjZW5jeS5fZGVwdGhTdGVuY2lsVGV4dHVyZTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBvd25lcjogZ2xvYmVUcmFuc2x1Y2VuY3ksXG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIGlmICghZGVmaW5lZChnbG9iZVRyYW5zbHVjZW5jeS5fY2xlYXJDb21tYW5kKSkge1xuICAgIGdsb2JlVHJhbnNsdWNlbmN5Ll9jbGVhckNvbW1hbmQgPSBuZXcgQ2xlYXJDb21tYW5kKHtcbiAgICAgIGNvbG9yOiBuZXcgQ29sb3IoMC4wLCAwLjAsIDAuMCwgMC4wKSxcbiAgICAgIGRlcHRoOiAxLjAsXG4gICAgICBzdGVuY2lsOiAwLjAsXG4gICAgICBvd25lcjogZ2xvYmVUcmFuc2x1Y2VuY3ksXG4gICAgfSk7XG4gIH1cblxuICBnbG9iZVRyYW5zbHVjZW5jeS5fcGFja2VkRGVwdGhDb21tYW5kLmZyYW1lYnVmZmVyID1cbiAgICBnbG9iZVRyYW5zbHVjZW5jeS5fcGFja2VkRGVwdGhGcmFtZWJ1ZmZlcjtcbiAgZ2xvYmVUcmFuc2x1Y2VuY3kuX3BhY2tlZERlcHRoQ29tbWFuZC5yZW5kZXJTdGF0ZSA9XG4gICAgZ2xvYmVUcmFuc2x1Y2VuY3kuX3JlbmRlclN0YXRlO1xuICBnbG9iZVRyYW5zbHVjZW5jeS5fY2xlYXJDb21tYW5kLmZyYW1lYnVmZmVyID0gZ2xvYmVUcmFuc2x1Y2VuY3kuX2ZyYW1lYnVmZmVyO1xuICBnbG9iZVRyYW5zbHVjZW5jeS5fY2xlYXJDb21tYW5kLnJlbmRlclN0YXRlID0gZ2xvYmVUcmFuc2x1Y2VuY3kuX3JlbmRlclN0YXRlO1xufVxuXG5HbG9iZVRyYW5zbHVjZW5jeUZyYW1lYnVmZmVyLnByb3RvdHlwZS51cGRhdGVBbmRDbGVhciA9IGZ1bmN0aW9uIChcbiAgaGRyLFxuICB2aWV3cG9ydCxcbiAgY29udGV4dCxcbiAgcGFzc1N0YXRlXG4pIHtcbiAgdmFyIHdpZHRoID0gdmlld3BvcnQud2lkdGg7XG4gIHZhciBoZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQ7XG5cbiAgdXBkYXRlUmVzb3VyY2VzKHRoaXMsIGNvbnRleHQsIHdpZHRoLCBoZWlnaHQsIGhkcik7XG4gIHVwZGF0ZUNvbW1hbmRzKHRoaXMsIGNvbnRleHQsIHdpZHRoLCBoZWlnaHQsIHBhc3NTdGF0ZSk7XG5cbiAgdGhpcy5fdXNlSGRyID0gaGRyO1xufTtcblxuR2xvYmVUcmFuc2x1Y2VuY3lGcmFtZWJ1ZmZlci5wcm90b3R5cGUuY2xlYXJDbGFzc2lmaWNhdGlvbiA9IGZ1bmN0aW9uIChcbiAgY29udGV4dCxcbiAgcGFzc1N0YXRlXG4pIHtcbiAgdGhpcy5fY2xlYXJDb21tYW5kLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbn07XG5cbkdsb2JlVHJhbnNsdWNlbmN5RnJhbWVidWZmZXIucHJvdG90eXBlLnBhY2tEZXB0aCA9IGZ1bmN0aW9uIChcbiAgY29udGV4dCxcbiAgcGFzc1N0YXRlXG4pIHtcbiAgdGhpcy5fcGFja2VkRGVwdGhDb21tYW5kLmV4ZWN1dGUoY29udGV4dCwgcGFzc1N0YXRlKTtcbiAgcmV0dXJuIHRoaXMuX3BhY2tlZERlcHRoVGV4dHVyZTtcbn07XG5cbkdsb2JlVHJhbnNsdWNlbmN5RnJhbWVidWZmZXIucHJvdG90eXBlLmlzRGVzdHJveWVkID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gZmFsc2U7XG59O1xuXG5HbG9iZVRyYW5zbHVjZW5jeUZyYW1lYnVmZmVyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICBkZXN0cm95UmVzb3VyY2VzKHRoaXMpO1xuICByZXR1cm4gZGVzdHJveU9iamVjdCh0aGlzKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEdsb2JlVHJhbnNsdWNlbmN5RnJhbWVidWZmZXI7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///55606\n')},85985:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){eval('/* harmony import */ var _Core_combine_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(8182);\n/* harmony import */ var _Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(62200);\n/* harmony import */ var _Core_defined_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(82982);\n/* harmony import */ var _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(15720);\n/* harmony import */ var _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(96190);\n/* harmony import */ var _Renderer_DrawCommand_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(60072);\n/* harmony import */ var _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(8379);\n/* harmony import */ var _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(10667);\n/* harmony import */ var _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(53642);\n/* harmony import */ var _BlendingState_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(13633);\n/* harmony import */ var _CullFace_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(71593);\n/* harmony import */ var _SceneMode_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(89917);\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar DerivedCommandType = {\n  OPAQUE_FRONT_FACE: 0,\n  OPAQUE_BACK_FACE: 1,\n  DEPTH_ONLY_FRONT_FACE: 2,\n  DEPTH_ONLY_BACK_FACE: 3,\n  DEPTH_ONLY_FRONT_AND_BACK_FACE: 4,\n  TRANSLUCENT_FRONT_FACE: 5,\n  TRANSLUCENT_BACK_FACE: 6,\n  TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST: 7,\n  TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST: 8,\n  PICK_FRONT_FACE: 9,\n  PICK_BACK_FACE: 10,\n  DERIVED_COMMANDS_MAXIMUM_LENGTH: 11,\n};\n\nvar derivedCommandsMaximumLength =\n  DerivedCommandType.DERIVED_COMMANDS_MAXIMUM_LENGTH;\n\nvar DerivedCommandNames = [\n  "opaqueFrontFaceCommand",\n  "opaqueBackFaceCommand",\n  "depthOnlyFrontFaceCommand",\n  "depthOnlyBackFaceCommand",\n  "depthOnlyFrontAndBackFaceCommand",\n  "translucentFrontFaceCommand",\n  "translucentBackFaceCommand",\n  "translucentFrontFaceManualDepthTestCommand",\n  "translucentBackFaceManualDepthTestCommand",\n  "pickFrontFaceCommand",\n  "pickBackFaceCommand",\n];\n\n/**\n * @private\n */\nfunction GlobeTranslucencyState() {\n  this._frontFaceAlphaByDistance = new _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(0.0, 1.0, 0.0, 1.0);\n  this._backFaceAlphaByDistance = new _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z(0.0, 1.0, 0.0, 1.0);\n\n  this._frontFaceTranslucent = false;\n  this._backFaceTranslucent = false;\n  this._requiresManualDepthTest = false;\n  this._sunVisibleThroughGlobe = false;\n  this._environmentVisible = false;\n  this._useDepthPlane = false;\n  this._numberOfTextureUniforms = 0;\n  this._globeTranslucencyFramebuffer = undefined;\n  this._rectangle = _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(_Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].MAX_VALUE */ .Z.MAX_VALUE);\n\n  this._derivedCommandKey = 0;\n  this._derivedCommandsDirty = false;\n  this._derivedCommandPacks = undefined;\n\n  this._derivedCommandTypes = new Array(derivedCommandsMaximumLength);\n  this._derivedBlendCommandTypes = new Array(derivedCommandsMaximumLength);\n  this._derivedPickCommandTypes = new Array(derivedCommandsMaximumLength);\n  this._derivedCommandTypesToUpdate = new Array(derivedCommandsMaximumLength);\n\n  this._derivedCommandsLength = 0;\n  this._derivedBlendCommandsLength = 0;\n  this._derivedPickCommandsLength = 0;\n  this._derivedCommandsToUpdateLength = 0;\n}\n\nObject.defineProperties(GlobeTranslucencyState.prototype, {\n  frontFaceAlphaByDistance: {\n    get: function () {\n      return this._frontFaceAlphaByDistance;\n    },\n  },\n  backFaceAlphaByDistance: {\n    get: function () {\n      return this._backFaceAlphaByDistance;\n    },\n  },\n  translucent: {\n    get: function () {\n      return this._frontFaceTranslucent;\n    },\n  },\n  sunVisibleThroughGlobe: {\n    get: function () {\n      return this._sunVisibleThroughGlobe;\n    },\n  },\n  environmentVisible: {\n    get: function () {\n      return this._environmentVisible;\n    },\n  },\n  useDepthPlane: {\n    get: function () {\n      return this._useDepthPlane;\n    },\n  },\n  numberOfTextureUniforms: {\n    get: function () {\n      return this._numberOfTextureUniforms;\n    },\n  },\n  rectangle: {\n    get: function () {\n      return this._rectangle;\n    },\n  },\n});\n\nGlobeTranslucencyState.prototype.update = function (scene) {\n  var globe = scene.globe;\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(globe) || !globe.show) {\n    this._frontFaceTranslucent = false;\n    this._backFaceTranslucent = false;\n    this._sunVisibleThroughGlobe = true;\n    this._environmentVisible = true;\n    this._useDepthPlane = false;\n    return;\n  }\n\n  this._frontFaceAlphaByDistance = updateAlphaByDistance(\n    globe.translucency.enabled,\n    globe.translucency.frontFaceAlpha,\n    globe.translucency.frontFaceAlphaByDistance,\n    this._frontFaceAlphaByDistance\n  );\n  this._backFaceAlphaByDistance = updateAlphaByDistance(\n    globe.translucency.enabled,\n    globe.translucency.backFaceAlpha,\n    globe.translucency.backFaceAlphaByDistance,\n    this._backFaceAlphaByDistance\n  );\n\n  this._frontFaceTranslucent = isFaceTranslucent(\n    globe.translucency.enabled,\n    this._frontFaceAlphaByDistance,\n    globe\n  );\n  this._backFaceTranslucent = isFaceTranslucent(\n    globe.translucency.enabled,\n    this._backFaceAlphaByDistance,\n    globe\n  );\n\n  this._requiresManualDepthTest = requiresManualDepthTest(this, scene, globe);\n\n  this._sunVisibleThroughGlobe = isSunVisibleThroughGlobe(this, scene);\n  this._environmentVisible = isEnvironmentVisible(this, scene);\n  this._useDepthPlane = useDepthPlane(this, scene);\n  this._numberOfTextureUniforms = getNumberOfTextureUniforms(this);\n\n  this._rectangle = _Core_Rectangle_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].clone */ .Z.clone(\n    globe.translucency.rectangle,\n    this._rectangle\n  );\n\n  gatherDerivedCommandRequirements(this, scene);\n};\n\nfunction updateAlphaByDistance(enabled, alpha, alphaByDistance, result) {\n  if (!enabled) {\n    result.nearValue = 1.0;\n    result.farValue = 1.0;\n    return result;\n  }\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(alphaByDistance)) {\n    result.nearValue = alpha;\n    result.farValue = alpha;\n    return result;\n  }\n\n  _Core_NearFarScalar_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"].clone */ .Z.clone(alphaByDistance, result);\n  result.nearValue *= alpha;\n  result.farValue *= alpha;\n  return result;\n}\n\nfunction isFaceTranslucent(translucencyEnabled, alphaByDistance, globe) {\n  return (\n    translucencyEnabled &&\n    (globe.baseColor.alpha < 1.0 ||\n      alphaByDistance.nearValue < 1.0 ||\n      alphaByDistance.farValue < 1.0)\n  );\n}\n\nfunction isSunVisibleThroughGlobe(state, scene) {\n  // The sun is visible through the globe if the front and back faces are translucent when above ground\n  // or if front faces are translucent when below ground\n  var frontTranslucent = state._frontFaceTranslucent;\n  var backTranslucent = state._backFaceTranslucent;\n  return frontTranslucent && (scene.cameraUnderground || backTranslucent);\n}\n\nfunction isEnvironmentVisible(state, scene) {\n  // The environment is visible if the camera is above ground or underground with translucency\n  return !scene.cameraUnderground || state._frontFaceTranslucent;\n}\n\nfunction useDepthPlane(state, scene) {\n  // Use the depth plane when the camera is above ground and the globe is opaque\n  return !scene.cameraUnderground && !state._frontFaceTranslucent;\n}\n\nfunction requiresManualDepthTest(state, scene, globe) {\n  return (\n    state._frontFaceTranslucent &&\n    !state._backFaceTranslucent &&\n    !globe.depthTestAgainstTerrain &&\n    scene.mode !== _SceneMode_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].SCENE2D */ .Z.SCENE2D &&\n    scene.context.depthTexture\n  );\n}\n\nfunction getNumberOfTextureUniforms(state) {\n  var numberOfTextureUniforms = 0;\n\n  if (state._frontFaceTranslucent) {\n    ++numberOfTextureUniforms; // classification texture\n  }\n\n  if (state._requiresManualDepthTest) {\n    ++numberOfTextureUniforms; // czm_globeDepthTexture for manual depth testing\n  }\n\n  return numberOfTextureUniforms;\n}\n\nfunction gatherDerivedCommandRequirements(state, scene) {\n  state._derivedCommandsLength = getDerivedCommandTypes(\n    state,\n    scene,\n    false,\n    false,\n    state._derivedCommandTypes\n  );\n\n  state._derivedBlendCommandsLength = getDerivedCommandTypes(\n    state,\n    scene,\n    true,\n    false,\n    state._derivedBlendCommandTypes\n  );\n\n  state._derivedPickCommandsLength = getDerivedCommandTypes(\n    state,\n    scene,\n    false,\n    true,\n    state._derivedPickCommandTypes\n  );\n\n  var i;\n\n  var derivedCommandKey = 0;\n  for (i = 0; i < state._derivedCommandsLength; ++i) {\n    derivedCommandKey |= 1 << state._derivedCommandTypes[i];\n  }\n  for (i = 0; i < state._derivedBlendCommandsLength; ++i) {\n    derivedCommandKey |= 1 << state._derivedBlendCommandTypes[i];\n  }\n  for (i = 0; i < state._derivedPickCommandsLength; ++i) {\n    derivedCommandKey |= 1 << state._derivedPickCommandTypes[i];\n  }\n\n  var derivedCommandsToUpdateLength = 0;\n  for (i = 0; i < derivedCommandsMaximumLength; ++i) {\n    if ((derivedCommandKey & (1 << i)) > 0) {\n      state._derivedCommandTypesToUpdate[derivedCommandsToUpdateLength++] = i;\n    }\n  }\n  state._derivedCommandsToUpdateLength = derivedCommandsToUpdateLength;\n\n  var derivedCommandsDirty = derivedCommandKey !== state._derivedCommandKey;\n  state._derivedCommandKey = derivedCommandKey;\n  state._derivedCommandsDirty = derivedCommandsDirty;\n\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(state._derivedCommandPacks) && state._frontFaceTranslucent) {\n    state._derivedCommandPacks = createDerivedCommandPacks();\n  }\n}\n\nfunction getDerivedCommandTypes(\n  state,\n  scene,\n  isBlendCommand,\n  isPickCommand,\n  types\n) {\n  var length = 0;\n\n  var frontTranslucent = state._frontFaceTranslucent;\n  var backTranslucent = state._backFaceTranslucent;\n\n  if (!frontTranslucent) {\n    // Don\'t use derived commands if the globe is opaque\n    return length;\n  }\n\n  var cameraUnderground = scene.cameraUnderground;\n  var requiresManualDepthTest = state._requiresManualDepthTest;\n\n  var translucentFrontFaceCommandType = isPickCommand\n    ? DerivedCommandType.PICK_FRONT_FACE\n    : requiresManualDepthTest\n    ? DerivedCommandType.TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST\n    : DerivedCommandType.TRANSLUCENT_FRONT_FACE;\n\n  var translucentBackFaceCommandType = isPickCommand\n    ? DerivedCommandType.PICK_BACK_FACE\n    : requiresManualDepthTest\n    ? DerivedCommandType.TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST\n    : DerivedCommandType.TRANSLUCENT_BACK_FACE;\n\n  if (scene.mode === _SceneMode_js__WEBPACK_IMPORTED_MODULE_10__/* ["default"].SCENE2D */ .Z.SCENE2D) {\n    types[length++] = DerivedCommandType.DEPTH_ONLY_FRONT_FACE;\n    types[length++] = translucentFrontFaceCommandType;\n    return length;\n  }\n\n  if (backTranslucent) {\n    // Push depth-only command for classification. Blend commands do not need to write depth.\n    // Push translucent commands for front and back faces.\n    if (!isBlendCommand) {\n      types[length++] = DerivedCommandType.DEPTH_ONLY_FRONT_AND_BACK_FACE;\n    }\n    if (cameraUnderground) {\n      types[length++] = translucentFrontFaceCommandType;\n      types[length++] = translucentBackFaceCommandType;\n    } else {\n      types[length++] = translucentBackFaceCommandType;\n      types[length++] = translucentFrontFaceCommandType;\n    }\n  } else {\n    // Push opaque command for the face that appears in back.\n    // Push depth-only command and translucent command for the face that appears in front.\n    // eslint-disable-next-line no-lonely-if\n    if (cameraUnderground) {\n      if (!isBlendCommand) {\n        types[length++] = DerivedCommandType.DEPTH_ONLY_BACK_FACE;\n      }\n      types[length++] = DerivedCommandType.OPAQUE_FRONT_FACE;\n      types[length++] = translucentBackFaceCommandType;\n    } else {\n      if (!isBlendCommand) {\n        types[length++] = DerivedCommandType.DEPTH_ONLY_FRONT_FACE;\n      }\n      types[length++] = DerivedCommandType.OPAQUE_BACK_FACE;\n      types[length++] = translucentFrontFaceCommandType;\n    }\n  }\n\n  return length;\n}\n\nfunction removeDefine(defines, defineToRemove) {\n  var index = defines.indexOf(defineToRemove);\n  if (index > -1) {\n    defines.splice(index, 1);\n  }\n}\n\nfunction hasDefine(defines, define) {\n  return defines.indexOf(define) > -1;\n}\n\nfunction getOpaqueFrontFaceShaderProgram(vs, fs) {\n  removeDefine(vs.defines, "TRANSLUCENT");\n  removeDefine(fs.defines, "TRANSLUCENT");\n}\n\nfunction getOpaqueBackFaceShaderProgram(vs, fs) {\n  removeDefine(vs.defines, "GROUND_ATMOSPHERE");\n  removeDefine(fs.defines, "GROUND_ATMOSPHERE");\n  removeDefine(vs.defines, "FOG");\n  removeDefine(fs.defines, "FOG");\n  removeDefine(vs.defines, "TRANSLUCENT");\n  removeDefine(fs.defines, "TRANSLUCENT");\n}\n\nfunction getDepthOnlyShaderProgram(vs, fs) {\n  if (\n    hasDefine(fs.defines, "TILE_LIMIT_RECTANGLE") ||\n    hasDefine(fs.defines, "ENABLE_CLIPPING_PLANES")\n  ) {\n    // Need to execute the full shader if discard is called\n    return;\n  }\n\n  var depthOnlyShader =\n    "void main() \\n" + "{ \\n" + "    gl_FragColor = vec4(1.0); \\n" + "} \\n";\n\n  fs.sources = [depthOnlyShader];\n}\n\nfunction getTranslucentShaderProgram(vs, fs) {\n  var sources = fs.sources;\n  var length = sources.length;\n  for (var i = 0; i < length; ++i) {\n    sources[i] = _Renderer_ShaderSource_js__WEBPACK_IMPORTED_MODULE_7__/* ["default"].replaceMain */ .Z.replaceMain(\n      sources[i],\n      "czm_globe_translucency_main"\n    );\n  }\n\n  var globeTranslucencyMain =\n    "\\n\\n" +\n    "uniform sampler2D u_classificationTexture; \\n" +\n    "void main() \\n" +\n    "{ \\n" +\n    "    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \\n" +\n    "#ifdef MANUAL_DEPTH_TEST \\n" +\n    "    float logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st)); \\n" +\n    "    if (logDepthOrDepth != 0.0) \\n" +\n    "    { \\n" +\n    "        vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth); \\n" +\n    "        float depthEC = eyeCoordinate.z / eyeCoordinate.w; \\n" +\n    "        if (v_positionEC.z < depthEC) \\n" +\n    "        { \\n" +\n    "            discard; \\n" +\n    "        } \\n" +\n    "    } \\n" +\n    "#endif \\n" +\n    "    czm_globe_translucency_main(); \\n" +\n    "    vec4 classificationColor = texture2D(u_classificationTexture, st); \\n" +\n    "    if (classificationColor.a > 0.0) \\n" +\n    "    { \\n" +\n    "        // Reverse premultiplication process to get the correct composited result of the classification primitives \\n" +\n    "        classificationColor.rgb /= classificationColor.a; \\n" +\n    "    } \\n" +\n    "    gl_FragColor = classificationColor * vec4(classificationColor.aaa, 1.0) + gl_FragColor * (1.0 - classificationColor.a); \\n" +\n    "} \\n";\n\n  sources.push(globeTranslucencyMain);\n}\n\nfunction getTranslucentBackFaceShaderProgram(vs, fs) {\n  getTranslucentShaderProgram(vs, fs);\n  removeDefine(vs.defines, "GROUND_ATMOSPHERE");\n  removeDefine(fs.defines, "GROUND_ATMOSPHERE");\n  removeDefine(vs.defines, "FOG");\n  removeDefine(fs.defines, "FOG");\n}\n\nfunction getTranslucentFrontFaceManualDepthTestShaderProgram(vs, fs) {\n  getTranslucentShaderProgram(vs, fs);\n  vs.defines.push("GENERATE_POSITION");\n  fs.defines.push("MANUAL_DEPTH_TEST");\n}\n\nfunction getTranslucentBackFaceManualDepthTestShaderProgram(vs, fs) {\n  getTranslucentBackFaceShaderProgram(vs, fs);\n  vs.defines.push("GENERATE_POSITION");\n  fs.defines.push("MANUAL_DEPTH_TEST");\n}\n\nfunction getPickShaderProgram(vs, fs) {\n  var pickShader =\n    "uniform sampler2D u_classificationTexture; \\n" +\n    "void main() \\n" +\n    "{ \\n" +\n    "    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \\n" +\n    "    vec4 pickColor = texture2D(u_classificationTexture, st); \\n" +\n    "    if (pickColor == vec4(0.0)) \\n" +\n    "    { \\n" +\n    "        discard; \\n" +\n    "    } \\n" +\n    "    gl_FragColor = pickColor; \\n" +\n    "} \\n";\n\n  fs.sources = [pickShader];\n}\n\nfunction getDerivedShaderProgram(\n  context,\n  shaderProgram,\n  derivedShaderProgram,\n  shaderProgramDirty,\n  getShaderProgramFunction,\n  cacheName\n) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(getShaderProgramFunction)) {\n    return shaderProgram;\n  }\n\n  if (!shaderProgramDirty && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(derivedShaderProgram)) {\n    return derivedShaderProgram;\n  }\n\n  var shader = context.shaderCache.getDerivedShaderProgram(\n    shaderProgram,\n    cacheName\n  );\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(shader)) {\n    var attributeLocations = shaderProgram._attributeLocations;\n    var vs = shaderProgram.vertexShaderSource.clone();\n    var fs = shaderProgram.fragmentShaderSource.clone();\n    vs.defines = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(vs.defines) ? vs.defines.slice(0) : [];\n    fs.defines = (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(fs.defines) ? fs.defines.slice(0) : [];\n\n    getShaderProgramFunction(vs, fs);\n\n    shader = context.shaderCache.createDerivedShaderProgram(\n      shaderProgram,\n      cacheName,\n      {\n        vertexShaderSource: vs,\n        fragmentShaderSource: fs,\n        attributeLocations: attributeLocations,\n      }\n    );\n  }\n\n  return shader;\n}\n\nfunction getOpaqueFrontFaceRenderState(renderState) {\n  renderState.cull.face = _CullFace_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].BACK */ .Z.BACK;\n  renderState.cull.enabled = true;\n}\n\nfunction getOpaqueBackFaceRenderState(renderState) {\n  renderState.cull.face = _CullFace_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].FRONT */ .Z.FRONT;\n  renderState.cull.enabled = true;\n}\n\nfunction getDepthOnlyFrontFaceRenderState(renderState) {\n  renderState.cull.face = _CullFace_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].BACK */ .Z.BACK;\n  renderState.cull.enabled = true;\n  renderState.colorMask = {\n    red: false,\n    green: false,\n    blue: false,\n    alpha: false,\n  };\n}\n\nfunction getDepthOnlyBackFaceRenderState(renderState) {\n  renderState.cull.face = _CullFace_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].FRONT */ .Z.FRONT;\n  renderState.cull.enabled = true;\n  renderState.colorMask = {\n    red: false,\n    green: false,\n    blue: false,\n    alpha: false,\n  };\n}\n\nfunction getDepthOnlyFrontAndBackFaceRenderState(renderState) {\n  renderState.cull.enabled = false;\n  renderState.colorMask = {\n    red: false,\n    green: false,\n    blue: false,\n    alpha: false,\n  };\n}\n\nfunction getTranslucentFrontFaceRenderState(renderState) {\n  renderState.cull.face = _CullFace_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].BACK */ .Z.BACK;\n  renderState.cull.enabled = true;\n  renderState.depthMask = false;\n  renderState.blending = _BlendingState_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].ALPHA_BLEND */ .Z.ALPHA_BLEND;\n}\n\nfunction getTranslucentBackFaceRenderState(renderState) {\n  renderState.cull.face = _CullFace_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].FRONT */ .Z.FRONT;\n  renderState.cull.enabled = true;\n  renderState.depthMask = false;\n  renderState.blending = _BlendingState_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"].ALPHA_BLEND */ .Z.ALPHA_BLEND;\n}\n\nfunction getPickFrontFaceRenderState(renderState) {\n  renderState.cull.face = _CullFace_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].BACK */ .Z.BACK;\n  renderState.cull.enabled = true;\n  renderState.blending.enabled = false;\n}\n\nfunction getPickBackFaceRenderState(renderState) {\n  renderState.cull.face = _CullFace_js__WEBPACK_IMPORTED_MODULE_9__/* ["default"].FRONT */ .Z.FRONT;\n  renderState.cull.enabled = true;\n  renderState.blending.enabled = false;\n}\n\nfunction getDerivedRenderState(\n  renderState,\n  derivedRenderState,\n  renderStateDirty,\n  getRenderStateFunction,\n  cache\n) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(getRenderStateFunction)) {\n    return renderState;\n  }\n\n  if (!renderStateDirty && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(derivedRenderState)) {\n    return derivedRenderState;\n  }\n\n  var cachedRenderState = cache[renderState.id];\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(cachedRenderState)) {\n    var rs = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].getState */ .Z.getState(renderState);\n    getRenderStateFunction(rs);\n    cachedRenderState = _Renderer_RenderState_js__WEBPACK_IMPORTED_MODULE_6__/* ["default"].fromCache */ .Z.fromCache(rs);\n    cache[renderState.id] = cachedRenderState;\n  }\n\n  return cachedRenderState;\n}\n\nfunction getTranslucencyUniformMap(state) {\n  return {\n    u_classificationTexture: function () {\n      return state._globeTranslucencyFramebuffer.classificationTexture;\n    },\n  };\n}\n\nfunction getDerivedUniformMap(\n  state,\n  uniformMap,\n  derivedUniformMap,\n  uniformMapDirty,\n  getDerivedUniformMapFunction\n) {\n  if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(getDerivedUniformMapFunction)) {\n    return uniformMap;\n  }\n\n  if (!uniformMapDirty && (0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(derivedUniformMap)) {\n    return derivedUniformMap;\n  }\n\n  return (0,_Core_combine_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z)(uniformMap, getDerivedUniformMapFunction(state), false);\n}\n\nfunction DerivedCommandPack(options) {\n  this.pass = options.pass;\n  this.pickOnly = options.pickOnly;\n  this.getShaderProgramFunction = options.getShaderProgramFunction;\n  this.getRenderStateFunction = options.getRenderStateFunction;\n  this.getUniformMapFunction = options.getUniformMapFunction;\n  this.renderStateCache = {};\n}\n\nfunction createDerivedCommandPacks() {\n  return [\n    // opaqueFrontFaceCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].GLOBE */ .Z.GLOBE,\n      pickOnly: false,\n      getShaderProgramFunction: getOpaqueFrontFaceShaderProgram,\n      getRenderStateFunction: getOpaqueFrontFaceRenderState,\n      getUniformMapFunction: undefined,\n    }),\n    // opaqueBackFaceCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].GLOBE */ .Z.GLOBE,\n      pickOnly: false,\n      getShaderProgramFunction: getOpaqueBackFaceShaderProgram,\n      getRenderStateFunction: getOpaqueBackFaceRenderState,\n      getUniformMapFunction: undefined,\n    }),\n    // depthOnlyFrontFaceCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].GLOBE */ .Z.GLOBE,\n      pickOnly: false,\n      getShaderProgramFunction: getDepthOnlyShaderProgram,\n      getRenderStateFunction: getDepthOnlyFrontFaceRenderState,\n      getUniformMapFunction: undefined,\n    }),\n    // depthOnlyBackFaceCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].GLOBE */ .Z.GLOBE,\n      pickOnly: false,\n      getShaderProgramFunction: getDepthOnlyShaderProgram,\n      getRenderStateFunction: getDepthOnlyBackFaceRenderState,\n      getUniformMapFunction: undefined,\n    }),\n    // depthOnlyFrontAndBackFaceCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].GLOBE */ .Z.GLOBE,\n      pickOnly: false,\n      getShaderProgramFunction: getDepthOnlyShaderProgram,\n      getRenderStateFunction: getDepthOnlyFrontAndBackFaceRenderState,\n      getUniformMapFunction: undefined,\n    }),\n    // translucentFrontFaceCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT,\n      pickOnly: false,\n      getShaderProgramFunction: getTranslucentShaderProgram,\n      getRenderStateFunction: getTranslucentFrontFaceRenderState,\n      getUniformMapFunction: getTranslucencyUniformMap,\n    }),\n    // translucentBackFaceCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT,\n      pickOnly: false,\n      getShaderProgramFunction: getTranslucentBackFaceShaderProgram,\n      getRenderStateFunction: getTranslucentBackFaceRenderState,\n      getUniformMapFunction: getTranslucencyUniformMap,\n    }),\n    // translucentFrontFaceManualDepthTestCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT,\n      pickOnly: false,\n      getShaderProgramFunction: getTranslucentFrontFaceManualDepthTestShaderProgram,\n      getRenderStateFunction: getTranslucentFrontFaceRenderState,\n      getUniformMapFunction: getTranslucencyUniformMap,\n    }),\n    // translucentBackFaceManualDepthTestCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT,\n      pickOnly: false,\n      getShaderProgramFunction: getTranslucentBackFaceManualDepthTestShaderProgram,\n      getRenderStateFunction: getTranslucentBackFaceRenderState,\n      getUniformMapFunction: getTranslucencyUniformMap,\n    }),\n    // pickFrontFaceCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT,\n      pickOnly: true,\n      getShaderProgramFunction: getPickShaderProgram,\n      getRenderStateFunction: getPickFrontFaceRenderState,\n      getUniformMapFunction: getTranslucencyUniformMap,\n    }),\n    // pickBackFaceCommand\n    new DerivedCommandPack({\n      pass: _Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].TRANSLUCENT */ .Z.TRANSLUCENT,\n      pickOnly: true,\n      getShaderProgramFunction: getPickShaderProgram,\n      getRenderStateFunction: getPickBackFaceRenderState,\n      getUniformMapFunction: getTranslucencyUniformMap,\n    }),\n  ];\n}\n\nvar derivedCommandNames = new Array(derivedCommandsMaximumLength);\nvar derivedCommandPacks = new Array(derivedCommandsMaximumLength);\n\nGlobeTranslucencyState.prototype.updateDerivedCommands = function (\n  command,\n  frameState\n) {\n  var derivedCommandTypes = this._derivedCommandTypesToUpdate;\n  var derivedCommandsLength = this._derivedCommandsToUpdateLength;\n\n  if (derivedCommandsLength === 0) {\n    return;\n  }\n\n  for (var i = 0; i < derivedCommandsLength; ++i) {\n    derivedCommandPacks[i] = this._derivedCommandPacks[derivedCommandTypes[i]];\n    derivedCommandNames[i] = DerivedCommandNames[derivedCommandTypes[i]];\n  }\n\n  updateDerivedCommands(\n    this,\n    command,\n    derivedCommandsLength,\n    derivedCommandTypes,\n    derivedCommandNames,\n    derivedCommandPacks,\n    frameState\n  );\n};\n\nfunction updateDerivedCommands(\n  state,\n  command,\n  derivedCommandsLength,\n  derivedCommandTypes,\n  derivedCommandNames,\n  derivedCommandPacks,\n  frameState\n) {\n  var derivedCommandsObject = command.derivedCommands.globeTranslucency;\n  var derivedCommandsDirty = state._derivedCommandsDirty;\n\n  if (\n    command.dirty ||\n    !(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(derivedCommandsObject) ||\n    derivedCommandsDirty\n  ) {\n    command.dirty = false;\n\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(derivedCommandsObject)) {\n      derivedCommandsObject = {};\n      command.derivedCommands.globeTranslucency = derivedCommandsObject;\n    }\n\n    var frameNumber = frameState.frameNumber;\n\n    var uniformMapDirtyFrame = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z)(\n      derivedCommandsObject.uniformMapDirtyFrame,\n      0\n    );\n    var shaderProgramDirtyFrame = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z)(\n      derivedCommandsObject.shaderProgramDirtyFrame,\n      0\n    );\n    var renderStateDirtyFrame = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z)(\n      derivedCommandsObject.renderStateDirtyFrame,\n      0\n    );\n\n    var uniformMapDirty =\n      derivedCommandsObject.uniformMap !== command.uniformMap;\n\n    var shaderProgramDirty =\n      derivedCommandsObject.shaderProgramId !== command.shaderProgram.id;\n\n    var renderStateDirty =\n      derivedCommandsObject.renderStateId !== command.renderState.id;\n\n    if (uniformMapDirty) {\n      derivedCommandsObject.uniformMapDirtyFrame = frameNumber;\n    }\n    if (shaderProgramDirty) {\n      derivedCommandsObject.shaderProgramDirtyFrame = frameNumber;\n    }\n    if (renderStateDirty) {\n      derivedCommandsObject.renderStateDirtyFrame = frameNumber;\n    }\n\n    derivedCommandsObject.uniformMap = command.uniformMap;\n    derivedCommandsObject.shaderProgramId = command.shaderProgram.id;\n    derivedCommandsObject.renderStateId = command.renderState.id;\n\n    for (var i = 0; i < derivedCommandsLength; ++i) {\n      var derivedCommandPack = derivedCommandPacks[i];\n      var derivedCommandType = derivedCommandTypes[i];\n      var derivedCommandName = derivedCommandNames[i];\n      var derivedCommand = derivedCommandsObject[derivedCommandName];\n\n      var derivedUniformMap;\n      var derivedShaderProgram;\n      var derivedRenderState;\n\n      if ((0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(derivedCommand)) {\n        derivedUniformMap = derivedCommand.uniformMap;\n        derivedShaderProgram = derivedCommand.shaderProgram;\n        derivedRenderState = derivedCommand.renderState;\n      } else {\n        derivedUniformMap = undefined;\n        derivedShaderProgram = undefined;\n        derivedRenderState = undefined;\n      }\n\n      derivedCommand = _Renderer_DrawCommand_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"].shallowClone */ .Z.shallowClone(command, derivedCommand);\n      derivedCommandsObject[derivedCommandName] = derivedCommand;\n\n      var derivedUniformMapDirtyFrame = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z)(\n        derivedCommand.derivedCommands.uniformMapDirtyFrame,\n        0\n      );\n      var derivedShaderProgramDirtyFrame = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z)(\n        derivedCommand.derivedCommands.shaderProgramDirtyFrame,\n        0\n      );\n      var derivedRenderStateDirtyFrame = (0,_Core_defaultValue_js__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z)(\n        derivedCommand.derivedCommands.renderStateDirtyFrame,\n        0\n      );\n\n      var derivedUniformMapDirty =\n        uniformMapDirty || derivedUniformMapDirtyFrame < uniformMapDirtyFrame;\n      var derivedShaderProgramDirty =\n        shaderProgramDirty ||\n        derivedShaderProgramDirtyFrame < shaderProgramDirtyFrame;\n      var derivedRenderStateDirty =\n        renderStateDirty ||\n        derivedRenderStateDirtyFrame < renderStateDirtyFrame;\n\n      if (derivedUniformMapDirty) {\n        derivedCommand.derivedCommands.uniformMapDirtyFrame = frameNumber;\n      }\n      if (derivedShaderProgramDirty) {\n        derivedCommand.derivedCommands.shaderProgramDirtyFrame = frameNumber;\n      }\n      if (derivedRenderStateDirty) {\n        derivedCommand.derivedCommands.renderStateDirtyFrame = frameNumber;\n      }\n\n      derivedCommand.derivedCommands.type = derivedCommandType;\n      derivedCommand.pass = derivedCommandPack.pass;\n      derivedCommand.pickOnly = derivedCommandPack.pickOnly;\n      derivedCommand.uniformMap = getDerivedUniformMap(\n        state,\n        command.uniformMap,\n        derivedUniformMap,\n        derivedUniformMapDirty,\n        derivedCommandPack.getUniformMapFunction\n      );\n      derivedCommand.shaderProgram = getDerivedShaderProgram(\n        frameState.context,\n        command.shaderProgram,\n        derivedShaderProgram,\n        derivedShaderProgramDirty,\n        derivedCommandPack.getShaderProgramFunction,\n        derivedCommandName\n      );\n      derivedCommand.renderState = getDerivedRenderState(\n        command.renderState,\n        derivedRenderState,\n        derivedRenderStateDirty,\n        derivedCommandPack.getRenderStateFunction,\n        derivedCommandPack.renderStateCache\n      );\n    }\n  }\n}\n\nGlobeTranslucencyState.prototype.pushDerivedCommands = function (\n  command,\n  isBlendCommand,\n  frameState\n) {\n  var picking = frameState.passes.pick;\n  if (picking && isBlendCommand) {\n    // No need to push blend commands in the pick pass\n    return;\n  }\n\n  var derivedCommandTypes = this._derivedCommandTypes;\n  var derivedCommandsLength = this._derivedCommandsLength;\n\n  if (picking) {\n    derivedCommandTypes = this._derivedPickCommandTypes;\n    derivedCommandsLength = this._derivedPickCommandsLength;\n  } else if (isBlendCommand) {\n    derivedCommandTypes = this._derivedBlendCommandTypes;\n    derivedCommandsLength = this._derivedBlendCommandsLength;\n  }\n\n  if (derivedCommandsLength === 0) {\n    // No derived commands to push so just push the globe command\n    frameState.commandList.push(command);\n    return;\n  }\n\n  // Push derived commands\n  var derivedCommands = command.derivedCommands.globeTranslucency;\n  for (var i = 0; i < derivedCommandsLength; ++i) {\n    var derivedCommandName = DerivedCommandNames[derivedCommandTypes[i]];\n    frameState.commandList.push(derivedCommands[derivedCommandName]);\n  }\n};\n\nfunction executeCommandsMatchingType(\n  commands,\n  commandsLength,\n  executeCommandFunction,\n  scene,\n  context,\n  passState,\n  types\n) {\n  for (var i = 0; i < commandsLength; ++i) {\n    var command = commands[i];\n    var type = command.derivedCommands.type;\n    if (!(0,_Core_defined_js__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(types) || types.indexOf(type) > -1) {\n      executeCommandFunction(command, scene, context, passState);\n    }\n  }\n}\n\nfunction executeCommands(\n  commands,\n  commandsLength,\n  executeCommandFunction,\n  scene,\n  context,\n  passState\n) {\n  for (var i = 0; i < commandsLength; ++i) {\n    executeCommandFunction(commands[i], scene, context, passState);\n  }\n}\n\nvar opaqueTypes = [\n  DerivedCommandType.OPAQUE_FRONT_FACE,\n  DerivedCommandType.OPAQUE_BACK_FACE,\n];\nvar depthOnlyTypes = [\n  DerivedCommandType.DEPTH_ONLY_FRONT_FACE,\n  DerivedCommandType.DEPTH_ONLY_BACK_FACE,\n  DerivedCommandType.DEPTH_ONLY_FRONT_AND_BACK_FACE,\n];\n\nGlobeTranslucencyState.prototype.executeGlobeCommands = function (\n  frustumCommands,\n  executeCommandFunction,\n  globeTranslucencyFramebuffer,\n  scene,\n  passState\n) {\n  var context = scene.context;\n  var globeCommands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].GLOBE */ .Z.GLOBE];\n  var globeCommandsLength = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].GLOBE */ .Z.GLOBE];\n\n  if (globeCommandsLength === 0) {\n    return;\n  }\n\n  this._globeTranslucencyFramebuffer = globeTranslucencyFramebuffer;\n  globeTranslucencyFramebuffer.clearClassification(context, passState);\n\n  // Render opaque commands like normal\n  executeCommandsMatchingType(\n    globeCommands,\n    globeCommandsLength,\n    executeCommandFunction,\n    scene,\n    context,\n    passState,\n    opaqueTypes\n  );\n};\n\nGlobeTranslucencyState.prototype.executeGlobeClassificationCommands = function (\n  frustumCommands,\n  executeCommandFunction,\n  globeTranslucencyFramebuffer,\n  scene,\n  passState\n) {\n  var context = scene.context;\n  var globeCommands = frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].GLOBE */ .Z.GLOBE];\n  var globeCommandsLength = frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].GLOBE */ .Z.GLOBE];\n  var classificationCommands =\n    frustumCommands.commands[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].TERRAIN_CLASSIFICATION */ .Z.TERRAIN_CLASSIFICATION];\n  var classificationCommandsLength =\n    frustumCommands.indices[_Renderer_Pass_js__WEBPACK_IMPORTED_MODULE_5__/* ["default"].TERRAIN_CLASSIFICATION */ .Z.TERRAIN_CLASSIFICATION];\n\n  if (globeCommandsLength === 0 || classificationCommandsLength === 0) {\n    return;\n  }\n\n  var frontTranslucent = this._frontFaceTranslucent;\n  var backTranslucent = this._backFaceTranslucent;\n\n  if (!frontTranslucent || !backTranslucent) {\n    // Render classification on opaque faces like normal\n    executeCommands(\n      classificationCommands,\n      classificationCommandsLength,\n      executeCommandFunction,\n      scene,\n      context,\n      passState\n    );\n  }\n\n  if (!frontTranslucent && !backTranslucent) {\n    // No translucent commands to render. Skip translucent classification.\n    return;\n  }\n\n  this._globeTranslucencyFramebuffer = globeTranslucencyFramebuffer;\n\n  var originalGlobeDepthTexture = context.uniformState.globeDepthTexture;\n  var originalFramebuffer = passState.framebuffer;\n\n  // Render to internal framebuffer and get the first depth peel\n  passState.framebuffer =\n    globeTranslucencyFramebuffer.classificationFramebuffer;\n\n  executeCommandsMatchingType(\n    globeCommands,\n    globeCommandsLength,\n    executeCommandFunction,\n    scene,\n    context,\n    passState,\n    depthOnlyTypes\n  );\n\n  if (context.depthTexture) {\n    // Pack depth into separate texture for ground polylines and textured ground primitives\n    var packedDepthTexture = globeTranslucencyFramebuffer.packDepth(\n      context,\n      passState\n    );\n    context.uniformState.globeDepthTexture = packedDepthTexture;\n  }\n\n  // Render classification on translucent faces\n  executeCommands(\n    classificationCommands,\n    classificationCommandsLength,\n    executeCommandFunction,\n    scene,\n    context,\n    passState\n  );\n\n  // Unset temporary state\n  context.uniformState.globeDepthTexture = originalGlobeDepthTexture;\n  passState.framebuffer = originalFramebuffer;\n};\n\n/* harmony default export */ __webpack_exports__["Z"] = (GlobeTranslucencyState);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODU5ODUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQXlDO0FBQ1U7QUFDVjtBQUNZO0FBQ1I7QUFDUTtBQUNkO0FBQ2M7QUFDRTtBQUNSO0FBQ1Y7QUFDRTs7QUFFdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLHVFQUFhO0FBQ3BELHNDQUFzQyx1RUFBYTs7QUFFbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwrRUFBZSxDQUFDLHVGQUFtQjs7QUFFdkQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0gsQ0FBQzs7QUFFRDtBQUNBO0FBQ0EsT0FBTyxzRUFBTztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxvQkFBb0IsK0VBQWU7QUFDbkM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU8sc0VBQU87QUFDZDtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxFQUFFLG1GQUFtQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsK0VBQWlCO0FBQ3BDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsK0JBQStCO0FBQy9COztBQUVBO0FBQ0EsK0JBQStCO0FBQy9COztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGNBQWMsa0NBQWtDO0FBQ2hEO0FBQ0E7QUFDQSxjQUFjLHVDQUF1QztBQUNyRDtBQUNBO0FBQ0EsY0FBYyxzQ0FBc0M7QUFDcEQ7QUFDQTs7QUFFQTtBQUNBLGNBQWMsa0NBQWtDO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLE9BQU8sc0VBQU87QUFDZDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHFCQUFxQiwrRUFBaUI7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDBCQUEwQixxQ0FBcUMsU0FBUzs7QUFFeEU7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsWUFBWTtBQUM5QixpQkFBaUIsa0dBQXdCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQSxPQUFPO0FBQ1Asc0RBQXNEO0FBQ3REO0FBQ0Esd0ZBQXdGO0FBQ3hGO0FBQ0EsV0FBVztBQUNYLGdHQUFnRztBQUNoRyxnRUFBZ0U7QUFDaEU7QUFDQSxlQUFlO0FBQ2YsMEJBQTBCO0FBQzFCLGVBQWU7QUFDZixXQUFXO0FBQ1g7QUFDQSx3Q0FBd0M7QUFDeEMsNEVBQTRFO0FBQzVFO0FBQ0EsV0FBVztBQUNYO0FBQ0EsK0RBQStEO0FBQy9ELFdBQVc7QUFDWCxpSUFBaUk7QUFDakksT0FBTzs7QUFFUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZ0RBQWdEO0FBQ2hEO0FBQ0EsT0FBTztBQUNQLHNEQUFzRDtBQUN0RCxrRUFBa0U7QUFDbEU7QUFDQSxXQUFXO0FBQ1gsc0JBQXNCO0FBQ3RCLFdBQVc7QUFDWCxtQ0FBbUM7QUFDbkMsT0FBTzs7QUFFUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLHNFQUFPO0FBQ2Q7QUFDQTs7QUFFQSw2QkFBNkIsc0VBQU87QUFDcEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sc0VBQU87QUFDZDtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsc0VBQU87QUFDeEIsaUJBQWlCLHNFQUFPOztBQUV4Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsMEJBQTBCLHVFQUFhO0FBQ3ZDO0FBQ0E7O0FBRUE7QUFDQSwwQkFBMEIseUVBQWM7QUFDeEM7QUFDQTs7QUFFQTtBQUNBLDBCQUEwQix1RUFBYTtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMEJBQTBCLHlFQUFjO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMEJBQTBCLHVFQUFhO0FBQ3ZDO0FBQ0E7QUFDQSx5QkFBeUIsMEZBQXlCO0FBQ2xEOztBQUVBO0FBQ0EsMEJBQTBCLHlFQUFjO0FBQ3hDO0FBQ0E7QUFDQSx5QkFBeUIsMEZBQXlCO0FBQ2xEOztBQUVBO0FBQ0EsMEJBQTBCLHVFQUFhO0FBQ3ZDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDBCQUEwQix5RUFBYztBQUN4QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLHNFQUFPO0FBQ2Q7QUFDQTs7QUFFQSwyQkFBMkIsc0VBQU87QUFDbEM7QUFDQTs7QUFFQTtBQUNBLE9BQU8sc0VBQU87QUFDZCxhQUFhLDJGQUFvQjtBQUNqQztBQUNBLHdCQUF3Qiw2RkFBcUI7QUFDN0M7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLHNFQUFPO0FBQ2Q7QUFDQTs7QUFFQSwwQkFBMEIsc0VBQU87QUFDakM7QUFDQTs7QUFFQSxTQUFTLHFFQUFPO0FBQ2hCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDhFQUFVO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZLDhFQUFVO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZLDhFQUFVO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZLDhFQUFVO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZLDhFQUFVO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZLDBGQUFnQjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWSwwRkFBZ0I7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVksMEZBQWdCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZLDBGQUFnQjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWSwwRkFBZ0I7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVksMEZBQWdCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLGtCQUFrQiwyQkFBMkI7QUFDN0M7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUssc0VBQU87QUFDWjtBQUNBO0FBQ0E7O0FBRUEsU0FBUyxzRUFBTztBQUNoQjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEsK0JBQStCLDBFQUFZO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQywwRUFBWTtBQUM5QztBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsMEVBQVk7QUFDNUM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsb0JBQW9CLDJCQUEyQjtBQUMvQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsVUFBVSxzRUFBTztBQUNqQjtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUJBQXVCLG1HQUF3QjtBQUMvQzs7QUFFQSx3Q0FBd0MsMEVBQVk7QUFDcEQ7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLDBFQUFZO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QywwRUFBWTtBQUNyRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGtCQUFrQiwyQkFBMkI7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLG9CQUFvQjtBQUN0QztBQUNBO0FBQ0EsU0FBUyxzRUFBTztBQUNoQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLG9CQUFvQjtBQUN0QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsOEVBQVU7QUFDekQsb0RBQW9ELDhFQUFVOztBQUU5RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsOEVBQVU7QUFDekQsb0RBQW9ELDhFQUFVO0FBQzlEO0FBQ0EsNkJBQTZCLGdIQUEyQjtBQUN4RDtBQUNBLDRCQUE0QixnSEFBMkI7O0FBRXZEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHlEQUFlLHNCQUFzQixFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdnVlMy13ZWJwYWNrNS8uL25vZGVfbW9kdWxlcy9jZXNpdW0vU291cmNlL1NjZW5lL0dsb2JlVHJhbnNsdWNlbmN5U3RhdGUuanM/ZDQ2NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY29tYmluZSBmcm9tIFwiLi4vQ29yZS9jb21iaW5lLmpzXCI7XG5pbXBvcnQgZGVmYXVsdFZhbHVlIGZyb20gXCIuLi9Db3JlL2RlZmF1bHRWYWx1ZS5qc1wiO1xuaW1wb3J0IGRlZmluZWQgZnJvbSBcIi4uL0NvcmUvZGVmaW5lZC5qc1wiO1xuaW1wb3J0IE5lYXJGYXJTY2FsYXIgZnJvbSBcIi4uL0NvcmUvTmVhckZhclNjYWxhci5qc1wiO1xuaW1wb3J0IFJlY3RhbmdsZSBmcm9tIFwiLi4vQ29yZS9SZWN0YW5nbGUuanNcIjtcbmltcG9ydCBEcmF3Q29tbWFuZCBmcm9tIFwiLi4vUmVuZGVyZXIvRHJhd0NvbW1hbmQuanNcIjtcbmltcG9ydCBQYXNzIGZyb20gXCIuLi9SZW5kZXJlci9QYXNzLmpzXCI7XG5pbXBvcnQgUmVuZGVyU3RhdGUgZnJvbSBcIi4uL1JlbmRlcmVyL1JlbmRlclN0YXRlLmpzXCI7XG5pbXBvcnQgU2hhZGVyU291cmNlIGZyb20gXCIuLi9SZW5kZXJlci9TaGFkZXJTb3VyY2UuanNcIjtcbmltcG9ydCBCbGVuZGluZ1N0YXRlIGZyb20gXCIuL0JsZW5kaW5nU3RhdGUuanNcIjtcbmltcG9ydCBDdWxsRmFjZSBmcm9tIFwiLi9DdWxsRmFjZS5qc1wiO1xuaW1wb3J0IFNjZW5lTW9kZSBmcm9tIFwiLi9TY2VuZU1vZGUuanNcIjtcblxudmFyIERlcml2ZWRDb21tYW5kVHlwZSA9IHtcbiAgT1BBUVVFX0ZST05UX0ZBQ0U6IDAsXG4gIE9QQVFVRV9CQUNLX0ZBQ0U6IDEsXG4gIERFUFRIX09OTFlfRlJPTlRfRkFDRTogMixcbiAgREVQVEhfT05MWV9CQUNLX0ZBQ0U6IDMsXG4gIERFUFRIX09OTFlfRlJPTlRfQU5EX0JBQ0tfRkFDRTogNCxcbiAgVFJBTlNMVUNFTlRfRlJPTlRfRkFDRTogNSxcbiAgVFJBTlNMVUNFTlRfQkFDS19GQUNFOiA2LFxuICBUUkFOU0xVQ0VOVF9GUk9OVF9GQUNFX01BTlVBTF9ERVBUSF9URVNUOiA3LFxuICBUUkFOU0xVQ0VOVF9CQUNLX0ZBQ0VfTUFOVUFMX0RFUFRIX1RFU1Q6IDgsXG4gIFBJQ0tfRlJPTlRfRkFDRTogOSxcbiAgUElDS19CQUNLX0ZBQ0U6IDEwLFxuICBERVJJVkVEX0NPTU1BTkRTX01BWElNVU1fTEVOR1RIOiAxMSxcbn07XG5cbnZhciBkZXJpdmVkQ29tbWFuZHNNYXhpbXVtTGVuZ3RoID1cbiAgRGVyaXZlZENvbW1hbmRUeXBlLkRFUklWRURfQ09NTUFORFNfTUFYSU1VTV9MRU5HVEg7XG5cbnZhciBEZXJpdmVkQ29tbWFuZE5hbWVzID0gW1xuICBcIm9wYXF1ZUZyb250RmFjZUNvbW1hbmRcIixcbiAgXCJvcGFxdWVCYWNrRmFjZUNvbW1hbmRcIixcbiAgXCJkZXB0aE9ubHlGcm9udEZhY2VDb21tYW5kXCIsXG4gIFwiZGVwdGhPbmx5QmFja0ZhY2VDb21tYW5kXCIsXG4gIFwiZGVwdGhPbmx5RnJvbnRBbmRCYWNrRmFjZUNvbW1hbmRcIixcbiAgXCJ0cmFuc2x1Y2VudEZyb250RmFjZUNvbW1hbmRcIixcbiAgXCJ0cmFuc2x1Y2VudEJhY2tGYWNlQ29tbWFuZFwiLFxuICBcInRyYW5zbHVjZW50RnJvbnRGYWNlTWFudWFsRGVwdGhUZXN0Q29tbWFuZFwiLFxuICBcInRyYW5zbHVjZW50QmFja0ZhY2VNYW51YWxEZXB0aFRlc3RDb21tYW5kXCIsXG4gIFwicGlja0Zyb250RmFjZUNvbW1hbmRcIixcbiAgXCJwaWNrQmFja0ZhY2VDb21tYW5kXCIsXG5dO1xuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIEdsb2JlVHJhbnNsdWNlbmN5U3RhdGUoKSB7XG4gIHRoaXMuX2Zyb250RmFjZUFscGhhQnlEaXN0YW5jZSA9IG5ldyBOZWFyRmFyU2NhbGFyKDAuMCwgMS4wLCAwLjAsIDEuMCk7XG4gIHRoaXMuX2JhY2tGYWNlQWxwaGFCeURpc3RhbmNlID0gbmV3IE5lYXJGYXJTY2FsYXIoMC4wLCAxLjAsIDAuMCwgMS4wKTtcblxuICB0aGlzLl9mcm9udEZhY2VUcmFuc2x1Y2VudCA9IGZhbHNlO1xuICB0aGlzLl9iYWNrRmFjZVRyYW5zbHVjZW50ID0gZmFsc2U7XG4gIHRoaXMuX3JlcXVpcmVzTWFudWFsRGVwdGhUZXN0ID0gZmFsc2U7XG4gIHRoaXMuX3N1blZpc2libGVUaHJvdWdoR2xvYmUgPSBmYWxzZTtcbiAgdGhpcy5fZW52aXJvbm1lbnRWaXNpYmxlID0gZmFsc2U7XG4gIHRoaXMuX3VzZURlcHRoUGxhbmUgPSBmYWxzZTtcbiAgdGhpcy5fbnVtYmVyT2ZUZXh0dXJlVW5pZm9ybXMgPSAwO1xuICB0aGlzLl9nbG9iZVRyYW5zbHVjZW5jeUZyYW1lYnVmZmVyID0gdW5kZWZpbmVkO1xuICB0aGlzLl9yZWN0YW5nbGUgPSBSZWN0YW5nbGUuY2xvbmUoUmVjdGFuZ2xlLk1BWF9WQUxVRSk7XG5cbiAgdGhpcy5fZGVyaXZlZENvbW1hbmRLZXkgPSAwO1xuICB0aGlzLl9kZXJpdmVkQ29tbWFuZHNEaXJ0eSA9IGZhbHNlO1xuICB0aGlzLl9kZXJpdmVkQ29tbWFuZFBhY2tzID0gdW5kZWZpbmVkO1xuXG4gIHRoaXMuX2Rlcml2ZWRDb21tYW5kVHlwZXMgPSBuZXcgQXJyYXkoZGVyaXZlZENvbW1hbmRzTWF4aW11bUxlbmd0aCk7XG4gIHRoaXMuX2Rlcml2ZWRCbGVuZENvbW1hbmRUeXBlcyA9IG5ldyBBcnJheShkZXJpdmVkQ29tbWFuZHNNYXhpbXVtTGVuZ3RoKTtcbiAgdGhpcy5fZGVyaXZlZFBpY2tDb21tYW5kVHlwZXMgPSBuZXcgQXJyYXkoZGVyaXZlZENvbW1hbmRzTWF4aW11bUxlbmd0aCk7XG4gIHRoaXMuX2Rlcml2ZWRDb21tYW5kVHlwZXNUb1VwZGF0ZSA9IG5ldyBBcnJheShkZXJpdmVkQ29tbWFuZHNNYXhpbXVtTGVuZ3RoKTtcblxuICB0aGlzLl9kZXJpdmVkQ29tbWFuZHNMZW5ndGggPSAwO1xuICB0aGlzLl9kZXJpdmVkQmxlbmRDb21tYW5kc0xlbmd0aCA9IDA7XG4gIHRoaXMuX2Rlcml2ZWRQaWNrQ29tbWFuZHNMZW5ndGggPSAwO1xuICB0aGlzLl9kZXJpdmVkQ29tbWFuZHNUb1VwZGF0ZUxlbmd0aCA9IDA7XG59XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEdsb2JlVHJhbnNsdWNlbmN5U3RhdGUucHJvdG90eXBlLCB7XG4gIGZyb250RmFjZUFscGhhQnlEaXN0YW5jZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2Zyb250RmFjZUFscGhhQnlEaXN0YW5jZTtcbiAgICB9LFxuICB9LFxuICBiYWNrRmFjZUFscGhhQnlEaXN0YW5jZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2JhY2tGYWNlQWxwaGFCeURpc3RhbmNlO1xuICAgIH0sXG4gIH0sXG4gIHRyYW5zbHVjZW50OiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZnJvbnRGYWNlVHJhbnNsdWNlbnQ7XG4gICAgfSxcbiAgfSxcbiAgc3VuVmlzaWJsZVRocm91Z2hHbG9iZToge1xuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3N1blZpc2libGVUaHJvdWdoR2xvYmU7XG4gICAgfSxcbiAgfSxcbiAgZW52aXJvbm1lbnRWaXNpYmxlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZW52aXJvbm1lbnRWaXNpYmxlO1xuICAgIH0sXG4gIH0sXG4gIHVzZURlcHRoUGxhbmU6IHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLl91c2VEZXB0aFBsYW5lO1xuICAgIH0sXG4gIH0sXG4gIG51bWJlck9mVGV4dHVyZVVuaWZvcm1zOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbnVtYmVyT2ZUZXh0dXJlVW5pZm9ybXM7XG4gICAgfSxcbiAgfSxcbiAgcmVjdGFuZ2xlOiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcmVjdGFuZ2xlO1xuICAgIH0sXG4gIH0sXG59KTtcblxuR2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKHNjZW5lKSB7XG4gIHZhciBnbG9iZSA9IHNjZW5lLmdsb2JlO1xuICBpZiAoIWRlZmluZWQoZ2xvYmUpIHx8ICFnbG9iZS5zaG93KSB7XG4gICAgdGhpcy5fZnJvbnRGYWNlVHJhbnNsdWNlbnQgPSBmYWxzZTtcbiAgICB0aGlzLl9iYWNrRmFjZVRyYW5zbHVjZW50ID0gZmFsc2U7XG4gICAgdGhpcy5fc3VuVmlzaWJsZVRocm91Z2hHbG9iZSA9IHRydWU7XG4gICAgdGhpcy5fZW52aXJvbm1lbnRWaXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLl91c2VEZXB0aFBsYW5lID0gZmFsc2U7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy5fZnJvbnRGYWNlQWxwaGFCeURpc3RhbmNlID0gdXBkYXRlQWxwaGFCeURpc3RhbmNlKFxuICAgIGdsb2JlLnRyYW5zbHVjZW5jeS5lbmFibGVkLFxuICAgIGdsb2JlLnRyYW5zbHVjZW5jeS5mcm9udEZhY2VBbHBoYSxcbiAgICBnbG9iZS50cmFuc2x1Y2VuY3kuZnJvbnRGYWNlQWxwaGFCeURpc3RhbmNlLFxuICAgIHRoaXMuX2Zyb250RmFjZUFscGhhQnlEaXN0YW5jZVxuICApO1xuICB0aGlzLl9iYWNrRmFjZUFscGhhQnlEaXN0YW5jZSA9IHVwZGF0ZUFscGhhQnlEaXN0YW5jZShcbiAgICBnbG9iZS50cmFuc2x1Y2VuY3kuZW5hYmxlZCxcbiAgICBnbG9iZS50cmFuc2x1Y2VuY3kuYmFja0ZhY2VBbHBoYSxcbiAgICBnbG9iZS50cmFuc2x1Y2VuY3kuYmFja0ZhY2VBbHBoYUJ5RGlzdGFuY2UsXG4gICAgdGhpcy5fYmFja0ZhY2VBbHBoYUJ5RGlzdGFuY2VcbiAgKTtcblxuICB0aGlzLl9mcm9udEZhY2VUcmFuc2x1Y2VudCA9IGlzRmFjZVRyYW5zbHVjZW50KFxuICAgIGdsb2JlLnRyYW5zbHVjZW5jeS5lbmFibGVkLFxuICAgIHRoaXMuX2Zyb250RmFjZUFscGhhQnlEaXN0YW5jZSxcbiAgICBnbG9iZVxuICApO1xuICB0aGlzLl9iYWNrRmFjZVRyYW5zbHVjZW50ID0gaXNGYWNlVHJhbnNsdWNlbnQoXG4gICAgZ2xvYmUudHJhbnNsdWNlbmN5LmVuYWJsZWQsXG4gICAgdGhpcy5fYmFja0ZhY2VBbHBoYUJ5RGlzdGFuY2UsXG4gICAgZ2xvYmVcbiAgKTtcblxuICB0aGlzLl9yZXF1aXJlc01hbnVhbERlcHRoVGVzdCA9IHJlcXVpcmVzTWFudWFsRGVwdGhUZXN0KHRoaXMsIHNjZW5lLCBnbG9iZSk7XG5cbiAgdGhpcy5fc3VuVmlzaWJsZVRocm91Z2hHbG9iZSA9IGlzU3VuVmlzaWJsZVRocm91Z2hHbG9iZSh0aGlzLCBzY2VuZSk7XG4gIHRoaXMuX2Vudmlyb25tZW50VmlzaWJsZSA9IGlzRW52aXJvbm1lbnRWaXNpYmxlKHRoaXMsIHNjZW5lKTtcbiAgdGhpcy5fdXNlRGVwdGhQbGFuZSA9IHVzZURlcHRoUGxhbmUodGhpcywgc2NlbmUpO1xuICB0aGlzLl9udW1iZXJPZlRleHR1cmVVbmlmb3JtcyA9IGdldE51bWJlck9mVGV4dHVyZVVuaWZvcm1zKHRoaXMpO1xuXG4gIHRoaXMuX3JlY3RhbmdsZSA9IFJlY3RhbmdsZS5jbG9uZShcbiAgICBnbG9iZS50cmFuc2x1Y2VuY3kucmVjdGFuZ2xlLFxuICAgIHRoaXMuX3JlY3RhbmdsZVxuICApO1xuXG4gIGdhdGhlckRlcml2ZWRDb21tYW5kUmVxdWlyZW1lbnRzKHRoaXMsIHNjZW5lKTtcbn07XG5cbmZ1bmN0aW9uIHVwZGF0ZUFscGhhQnlEaXN0YW5jZShlbmFibGVkLCBhbHBoYSwgYWxwaGFCeURpc3RhbmNlLCByZXN1bHQpIHtcbiAgaWYgKCFlbmFibGVkKSB7XG4gICAgcmVzdWx0Lm5lYXJWYWx1ZSA9IDEuMDtcbiAgICByZXN1bHQuZmFyVmFsdWUgPSAxLjA7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGlmICghZGVmaW5lZChhbHBoYUJ5RGlzdGFuY2UpKSB7XG4gICAgcmVzdWx0Lm5lYXJWYWx1ZSA9IGFscGhhO1xuICAgIHJlc3VsdC5mYXJWYWx1ZSA9IGFscGhhO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBOZWFyRmFyU2NhbGFyLmNsb25lKGFscGhhQnlEaXN0YW5jZSwgcmVzdWx0KTtcbiAgcmVzdWx0Lm5lYXJWYWx1ZSAqPSBhbHBoYTtcbiAgcmVzdWx0LmZhclZhbHVlICo9IGFscGhhO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBpc0ZhY2VUcmFuc2x1Y2VudCh0cmFuc2x1Y2VuY3lFbmFibGVkLCBhbHBoYUJ5RGlzdGFuY2UsIGdsb2JlKSB7XG4gIHJldHVybiAoXG4gICAgdHJhbnNsdWNlbmN5RW5hYmxlZCAmJlxuICAgIChnbG9iZS5iYXNlQ29sb3IuYWxwaGEgPCAxLjAgfHxcbiAgICAgIGFscGhhQnlEaXN0YW5jZS5uZWFyVmFsdWUgPCAxLjAgfHxcbiAgICAgIGFscGhhQnlEaXN0YW5jZS5mYXJWYWx1ZSA8IDEuMClcbiAgKTtcbn1cblxuZnVuY3Rpb24gaXNTdW5WaXNpYmxlVGhyb3VnaEdsb2JlKHN0YXRlLCBzY2VuZSkge1xuICAvLyBUaGUgc3VuIGlzIHZpc2libGUgdGhyb3VnaCB0aGUgZ2xvYmUgaWYgdGhlIGZyb250IGFuZCBiYWNrIGZhY2VzIGFyZSB0cmFuc2x1Y2VudCB3aGVuIGFib3ZlIGdyb3VuZFxuICAvLyBvciBpZiBmcm9udCBmYWNlcyBhcmUgdHJhbnNsdWNlbnQgd2hlbiBiZWxvdyBncm91bmRcbiAgdmFyIGZyb250VHJhbnNsdWNlbnQgPSBzdGF0ZS5fZnJvbnRGYWNlVHJhbnNsdWNlbnQ7XG4gIHZhciBiYWNrVHJhbnNsdWNlbnQgPSBzdGF0ZS5fYmFja0ZhY2VUcmFuc2x1Y2VudDtcbiAgcmV0dXJuIGZyb250VHJhbnNsdWNlbnQgJiYgKHNjZW5lLmNhbWVyYVVuZGVyZ3JvdW5kIHx8IGJhY2tUcmFuc2x1Y2VudCk7XG59XG5cbmZ1bmN0aW9uIGlzRW52aXJvbm1lbnRWaXNpYmxlKHN0YXRlLCBzY2VuZSkge1xuICAvLyBUaGUgZW52aXJvbm1lbnQgaXMgdmlzaWJsZSBpZiB0aGUgY2FtZXJhIGlzIGFib3ZlIGdyb3VuZCBvciB1bmRlcmdyb3VuZCB3aXRoIHRyYW5zbHVjZW5jeVxuICByZXR1cm4gIXNjZW5lLmNhbWVyYVVuZGVyZ3JvdW5kIHx8IHN0YXRlLl9mcm9udEZhY2VUcmFuc2x1Y2VudDtcbn1cblxuZnVuY3Rpb24gdXNlRGVwdGhQbGFuZShzdGF0ZSwgc2NlbmUpIHtcbiAgLy8gVXNlIHRoZSBkZXB0aCBwbGFuZSB3aGVuIHRoZSBjYW1lcmEgaXMgYWJvdmUgZ3JvdW5kIGFuZCB0aGUgZ2xvYmUgaXMgb3BhcXVlXG4gIHJldHVybiAhc2NlbmUuY2FtZXJhVW5kZXJncm91bmQgJiYgIXN0YXRlLl9mcm9udEZhY2VUcmFuc2x1Y2VudDtcbn1cblxuZnVuY3Rpb24gcmVxdWlyZXNNYW51YWxEZXB0aFRlc3Qoc3RhdGUsIHNjZW5lLCBnbG9iZSkge1xuICByZXR1cm4gKFxuICAgIHN0YXRlLl9mcm9udEZhY2VUcmFuc2x1Y2VudCAmJlxuICAgICFzdGF0ZS5fYmFja0ZhY2VUcmFuc2x1Y2VudCAmJlxuICAgICFnbG9iZS5kZXB0aFRlc3RBZ2FpbnN0VGVycmFpbiAmJlxuICAgIHNjZW5lLm1vZGUgIT09IFNjZW5lTW9kZS5TQ0VORTJEICYmXG4gICAgc2NlbmUuY29udGV4dC5kZXB0aFRleHR1cmVcbiAgKTtcbn1cblxuZnVuY3Rpb24gZ2V0TnVtYmVyT2ZUZXh0dXJlVW5pZm9ybXMoc3RhdGUpIHtcbiAgdmFyIG51bWJlck9mVGV4dHVyZVVuaWZvcm1zID0gMDtcblxuICBpZiAoc3RhdGUuX2Zyb250RmFjZVRyYW5zbHVjZW50KSB7XG4gICAgKytudW1iZXJPZlRleHR1cmVVbmlmb3JtczsgLy8gY2xhc3NpZmljYXRpb24gdGV4dHVyZVxuICB9XG5cbiAgaWYgKHN0YXRlLl9yZXF1aXJlc01hbnVhbERlcHRoVGVzdCkge1xuICAgICsrbnVtYmVyT2ZUZXh0dXJlVW5pZm9ybXM7IC8vIGN6bV9nbG9iZURlcHRoVGV4dHVyZSBmb3IgbWFudWFsIGRlcHRoIHRlc3RpbmdcbiAgfVxuXG4gIHJldHVybiBudW1iZXJPZlRleHR1cmVVbmlmb3Jtcztcbn1cblxuZnVuY3Rpb24gZ2F0aGVyRGVyaXZlZENvbW1hbmRSZXF1aXJlbWVudHMoc3RhdGUsIHNjZW5lKSB7XG4gIHN0YXRlLl9kZXJpdmVkQ29tbWFuZHNMZW5ndGggPSBnZXREZXJpdmVkQ29tbWFuZFR5cGVzKFxuICAgIHN0YXRlLFxuICAgIHNjZW5lLFxuICAgIGZhbHNlLFxuICAgIGZhbHNlLFxuICAgIHN0YXRlLl9kZXJpdmVkQ29tbWFuZFR5cGVzXG4gICk7XG5cbiAgc3RhdGUuX2Rlcml2ZWRCbGVuZENvbW1hbmRzTGVuZ3RoID0gZ2V0RGVyaXZlZENvbW1hbmRUeXBlcyhcbiAgICBzdGF0ZSxcbiAgICBzY2VuZSxcbiAgICB0cnVlLFxuICAgIGZhbHNlLFxuICAgIHN0YXRlLl9kZXJpdmVkQmxlbmRDb21tYW5kVHlwZXNcbiAgKTtcblxuICBzdGF0ZS5fZGVyaXZlZFBpY2tDb21tYW5kc0xlbmd0aCA9IGdldERlcml2ZWRDb21tYW5kVHlwZXMoXG4gICAgc3RhdGUsXG4gICAgc2NlbmUsXG4gICAgZmFsc2UsXG4gICAgdHJ1ZSxcbiAgICBzdGF0ZS5fZGVyaXZlZFBpY2tDb21tYW5kVHlwZXNcbiAgKTtcblxuICB2YXIgaTtcblxuICB2YXIgZGVyaXZlZENvbW1hbmRLZXkgPSAwO1xuICBmb3IgKGkgPSAwOyBpIDwgc3RhdGUuX2Rlcml2ZWRDb21tYW5kc0xlbmd0aDsgKytpKSB7XG4gICAgZGVyaXZlZENvbW1hbmRLZXkgfD0gMSA8PCBzdGF0ZS5fZGVyaXZlZENvbW1hbmRUeXBlc1tpXTtcbiAgfVxuICBmb3IgKGkgPSAwOyBpIDwgc3RhdGUuX2Rlcml2ZWRCbGVuZENvbW1hbmRzTGVuZ3RoOyArK2kpIHtcbiAgICBkZXJpdmVkQ29tbWFuZEtleSB8PSAxIDw8IHN0YXRlLl9kZXJpdmVkQmxlbmRDb21tYW5kVHlwZXNbaV07XG4gIH1cbiAgZm9yIChpID0gMDsgaSA8IHN0YXRlLl9kZXJpdmVkUGlja0NvbW1hbmRzTGVuZ3RoOyArK2kpIHtcbiAgICBkZXJpdmVkQ29tbWFuZEtleSB8PSAxIDw8IHN0YXRlLl9kZXJpdmVkUGlja0NvbW1hbmRUeXBlc1tpXTtcbiAgfVxuXG4gIHZhciBkZXJpdmVkQ29tbWFuZHNUb1VwZGF0ZUxlbmd0aCA9IDA7XG4gIGZvciAoaSA9IDA7IGkgPCBkZXJpdmVkQ29tbWFuZHNNYXhpbXVtTGVuZ3RoOyArK2kpIHtcbiAgICBpZiAoKGRlcml2ZWRDb21tYW5kS2V5ICYgKDEgPDwgaSkpID4gMCkge1xuICAgICAgc3RhdGUuX2Rlcml2ZWRDb21tYW5kVHlwZXNUb1VwZGF0ZVtkZXJpdmVkQ29tbWFuZHNUb1VwZGF0ZUxlbmd0aCsrXSA9IGk7XG4gICAgfVxuICB9XG4gIHN0YXRlLl9kZXJpdmVkQ29tbWFuZHNUb1VwZGF0ZUxlbmd0aCA9IGRlcml2ZWRDb21tYW5kc1RvVXBkYXRlTGVuZ3RoO1xuXG4gIHZhciBkZXJpdmVkQ29tbWFuZHNEaXJ0eSA9IGRlcml2ZWRDb21tYW5kS2V5ICE9PSBzdGF0ZS5fZGVyaXZlZENvbW1hbmRLZXk7XG4gIHN0YXRlLl9kZXJpdmVkQ29tbWFuZEtleSA9IGRlcml2ZWRDb21tYW5kS2V5O1xuICBzdGF0ZS5fZGVyaXZlZENvbW1hbmRzRGlydHkgPSBkZXJpdmVkQ29tbWFuZHNEaXJ0eTtcblxuICBpZiAoIWRlZmluZWQoc3RhdGUuX2Rlcml2ZWRDb21tYW5kUGFja3MpICYmIHN0YXRlLl9mcm9udEZhY2VUcmFuc2x1Y2VudCkge1xuICAgIHN0YXRlLl9kZXJpdmVkQ29tbWFuZFBhY2tzID0gY3JlYXRlRGVyaXZlZENvbW1hbmRQYWNrcygpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldERlcml2ZWRDb21tYW5kVHlwZXMoXG4gIHN0YXRlLFxuICBzY2VuZSxcbiAgaXNCbGVuZENvbW1hbmQsXG4gIGlzUGlja0NvbW1hbmQsXG4gIHR5cGVzXG4pIHtcbiAgdmFyIGxlbmd0aCA9IDA7XG5cbiAgdmFyIGZyb250VHJhbnNsdWNlbnQgPSBzdGF0ZS5fZnJvbnRGYWNlVHJhbnNsdWNlbnQ7XG4gIHZhciBiYWNrVHJhbnNsdWNlbnQgPSBzdGF0ZS5fYmFja0ZhY2VUcmFuc2x1Y2VudDtcblxuICBpZiAoIWZyb250VHJhbnNsdWNlbnQpIHtcbiAgICAvLyBEb24ndCB1c2UgZGVyaXZlZCBjb21tYW5kcyBpZiB0aGUgZ2xvYmUgaXMgb3BhcXVlXG4gICAgcmV0dXJuIGxlbmd0aDtcbiAgfVxuXG4gIHZhciBjYW1lcmFVbmRlcmdyb3VuZCA9IHNjZW5lLmNhbWVyYVVuZGVyZ3JvdW5kO1xuICB2YXIgcmVxdWlyZXNNYW51YWxEZXB0aFRlc3QgPSBzdGF0ZS5fcmVxdWlyZXNNYW51YWxEZXB0aFRlc3Q7XG5cbiAgdmFyIHRyYW5zbHVjZW50RnJvbnRGYWNlQ29tbWFuZFR5cGUgPSBpc1BpY2tDb21tYW5kXG4gICAgPyBEZXJpdmVkQ29tbWFuZFR5cGUuUElDS19GUk9OVF9GQUNFXG4gICAgOiByZXF1aXJlc01hbnVhbERlcHRoVGVzdFxuICAgID8gRGVyaXZlZENvbW1hbmRUeXBlLlRSQU5TTFVDRU5UX0ZST05UX0ZBQ0VfTUFOVUFMX0RFUFRIX1RFU1RcbiAgICA6IERlcml2ZWRDb21tYW5kVHlwZS5UUkFOU0xVQ0VOVF9GUk9OVF9GQUNFO1xuXG4gIHZhciB0cmFuc2x1Y2VudEJhY2tGYWNlQ29tbWFuZFR5cGUgPSBpc1BpY2tDb21tYW5kXG4gICAgPyBEZXJpdmVkQ29tbWFuZFR5cGUuUElDS19CQUNLX0ZBQ0VcbiAgICA6IHJlcXVpcmVzTWFudWFsRGVwdGhUZXN0XG4gICAgPyBEZXJpdmVkQ29tbWFuZFR5cGUuVFJBTlNMVUNFTlRfQkFDS19GQUNFX01BTlVBTF9ERVBUSF9URVNUXG4gICAgOiBEZXJpdmVkQ29tbWFuZFR5cGUuVFJBTlNMVUNFTlRfQkFDS19GQUNFO1xuXG4gIGlmIChzY2VuZS5tb2RlID09PSBTY2VuZU1vZGUuU0NFTkUyRCkge1xuICAgIHR5cGVzW2xlbmd0aCsrXSA9IERlcml2ZWRDb21tYW5kVHlwZS5ERVBUSF9PTkxZX0ZST05UX0ZBQ0U7XG4gICAgdHlwZXNbbGVuZ3RoKytdID0gdHJhbnNsdWNlbnRGcm9udEZhY2VDb21tYW5kVHlwZTtcbiAgICByZXR1cm4gbGVuZ3RoO1xuICB9XG5cbiAgaWYgKGJhY2tUcmFuc2x1Y2VudCkge1xuICAgIC8vIFB1c2ggZGVwdGgtb25seSBjb21tYW5kIGZvciBjbGFzc2lmaWNhdGlvbi4gQmxlbmQgY29tbWFuZHMgZG8gbm90IG5lZWQgdG8gd3JpdGUgZGVwdGguXG4gICAgLy8gUHVzaCB0cmFuc2x1Y2VudCBjb21tYW5kcyBmb3IgZnJvbnQgYW5kIGJhY2sgZmFjZXMuXG4gICAgaWYgKCFpc0JsZW5kQ29tbWFuZCkge1xuICAgICAgdHlwZXNbbGVuZ3RoKytdID0gRGVyaXZlZENvbW1hbmRUeXBlLkRFUFRIX09OTFlfRlJPTlRfQU5EX0JBQ0tfRkFDRTtcbiAgICB9XG4gICAgaWYgKGNhbWVyYVVuZGVyZ3JvdW5kKSB7XG4gICAgICB0eXBlc1tsZW5ndGgrK10gPSB0cmFuc2x1Y2VudEZyb250RmFjZUNvbW1hbmRUeXBlO1xuICAgICAgdHlwZXNbbGVuZ3RoKytdID0gdHJhbnNsdWNlbnRCYWNrRmFjZUNvbW1hbmRUeXBlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0eXBlc1tsZW5ndGgrK10gPSB0cmFuc2x1Y2VudEJhY2tGYWNlQ29tbWFuZFR5cGU7XG4gICAgICB0eXBlc1tsZW5ndGgrK10gPSB0cmFuc2x1Y2VudEZyb250RmFjZUNvbW1hbmRUeXBlO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBQdXNoIG9wYXF1ZSBjb21tYW5kIGZvciB0aGUgZmFjZSB0aGF0IGFwcGVhcnMgaW4gYmFjay5cbiAgICAvLyBQdXNoIGRlcHRoLW9ubHkgY29tbWFuZCBhbmQgdHJhbnNsdWNlbnQgY29tbWFuZCBmb3IgdGhlIGZhY2UgdGhhdCBhcHBlYXJzIGluIGZyb250LlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1sb25lbHktaWZcbiAgICBpZiAoY2FtZXJhVW5kZXJncm91bmQpIHtcbiAgICAgIGlmICghaXNCbGVuZENvbW1hbmQpIHtcbiAgICAgICAgdHlwZXNbbGVuZ3RoKytdID0gRGVyaXZlZENvbW1hbmRUeXBlLkRFUFRIX09OTFlfQkFDS19GQUNFO1xuICAgICAgfVxuICAgICAgdHlwZXNbbGVuZ3RoKytdID0gRGVyaXZlZENvbW1hbmRUeXBlLk9QQVFVRV9GUk9OVF9GQUNFO1xuICAgICAgdHlwZXNbbGVuZ3RoKytdID0gdHJhbnNsdWNlbnRCYWNrRmFjZUNvbW1hbmRUeXBlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIWlzQmxlbmRDb21tYW5kKSB7XG4gICAgICAgIHR5cGVzW2xlbmd0aCsrXSA9IERlcml2ZWRDb21tYW5kVHlwZS5ERVBUSF9PTkxZX0ZST05UX0ZBQ0U7XG4gICAgICB9XG4gICAgICB0eXBlc1tsZW5ndGgrK10gPSBEZXJpdmVkQ29tbWFuZFR5cGUuT1BBUVVFX0JBQ0tfRkFDRTtcbiAgICAgIHR5cGVzW2xlbmd0aCsrXSA9IHRyYW5zbHVjZW50RnJvbnRGYWNlQ29tbWFuZFR5cGU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGxlbmd0aDtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlRGVmaW5lKGRlZmluZXMsIGRlZmluZVRvUmVtb3ZlKSB7XG4gIHZhciBpbmRleCA9IGRlZmluZXMuaW5kZXhPZihkZWZpbmVUb1JlbW92ZSk7XG4gIGlmIChpbmRleCA+IC0xKSB7XG4gICAgZGVmaW5lcy5zcGxpY2UoaW5kZXgsIDEpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhc0RlZmluZShkZWZpbmVzLCBkZWZpbmUpIHtcbiAgcmV0dXJuIGRlZmluZXMuaW5kZXhPZihkZWZpbmUpID4gLTE7XG59XG5cbmZ1bmN0aW9uIGdldE9wYXF1ZUZyb250RmFjZVNoYWRlclByb2dyYW0odnMsIGZzKSB7XG4gIHJlbW92ZURlZmluZSh2cy5kZWZpbmVzLCBcIlRSQU5TTFVDRU5UXCIpO1xuICByZW1vdmVEZWZpbmUoZnMuZGVmaW5lcywgXCJUUkFOU0xVQ0VOVFwiKTtcbn1cblxuZnVuY3Rpb24gZ2V0T3BhcXVlQmFja0ZhY2VTaGFkZXJQcm9ncmFtKHZzLCBmcykge1xuICByZW1vdmVEZWZpbmUodnMuZGVmaW5lcywgXCJHUk9VTkRfQVRNT1NQSEVSRVwiKTtcbiAgcmVtb3ZlRGVmaW5lKGZzLmRlZmluZXMsIFwiR1JPVU5EX0FUTU9TUEhFUkVcIik7XG4gIHJlbW92ZURlZmluZSh2cy5kZWZpbmVzLCBcIkZPR1wiKTtcbiAgcmVtb3ZlRGVmaW5lKGZzLmRlZmluZXMsIFwiRk9HXCIpO1xuICByZW1vdmVEZWZpbmUodnMuZGVmaW5lcywgXCJUUkFOU0xVQ0VOVFwiKTtcbiAgcmVtb3ZlRGVmaW5lKGZzLmRlZmluZXMsIFwiVFJBTlNMVUNFTlRcIik7XG59XG5cbmZ1bmN0aW9uIGdldERlcHRoT25seVNoYWRlclByb2dyYW0odnMsIGZzKSB7XG4gIGlmIChcbiAgICBoYXNEZWZpbmUoZnMuZGVmaW5lcywgXCJUSUxFX0xJTUlUX1JFQ1RBTkdMRVwiKSB8fFxuICAgIGhhc0RlZmluZShmcy5kZWZpbmVzLCBcIkVOQUJMRV9DTElQUElOR19QTEFORVNcIilcbiAgKSB7XG4gICAgLy8gTmVlZCB0byBleGVjdXRlIHRoZSBmdWxsIHNoYWRlciBpZiBkaXNjYXJkIGlzIGNhbGxlZFxuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBkZXB0aE9ubHlTaGFkZXIgPVxuICAgIFwidm9pZCBtYWluKCkgXFxuXCIgKyBcInsgXFxuXCIgKyBcIiAgICBnbF9GcmFnQ29sb3IgPSB2ZWM0KDEuMCk7IFxcblwiICsgXCJ9IFxcblwiO1xuXG4gIGZzLnNvdXJjZXMgPSBbZGVwdGhPbmx5U2hhZGVyXTtcbn1cblxuZnVuY3Rpb24gZ2V0VHJhbnNsdWNlbnRTaGFkZXJQcm9ncmFtKHZzLCBmcykge1xuICB2YXIgc291cmNlcyA9IGZzLnNvdXJjZXM7XG4gIHZhciBsZW5ndGggPSBzb3VyY2VzLmxlbmd0aDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgIHNvdXJjZXNbaV0gPSBTaGFkZXJTb3VyY2UucmVwbGFjZU1haW4oXG4gICAgICBzb3VyY2VzW2ldLFxuICAgICAgXCJjem1fZ2xvYmVfdHJhbnNsdWNlbmN5X21haW5cIlxuICAgICk7XG4gIH1cblxuICB2YXIgZ2xvYmVUcmFuc2x1Y2VuY3lNYWluID1cbiAgICBcIlxcblxcblwiICtcbiAgICBcInVuaWZvcm0gc2FtcGxlcjJEIHVfY2xhc3NpZmljYXRpb25UZXh0dXJlOyBcXG5cIiArXG4gICAgXCJ2b2lkIG1haW4oKSBcXG5cIiArXG4gICAgXCJ7IFxcblwiICtcbiAgICBcIiAgICB2ZWMyIHN0ID0gZ2xfRnJhZ0Nvb3JkLnh5IC8gY3ptX3ZpZXdwb3J0Lnp3OyBcXG5cIiArXG4gICAgXCIjaWZkZWYgTUFOVUFMX0RFUFRIX1RFU1QgXFxuXCIgK1xuICAgIFwiICAgIGZsb2F0IGxvZ0RlcHRoT3JEZXB0aCA9IGN6bV91bnBhY2tEZXB0aCh0ZXh0dXJlMkQoY3ptX2dsb2JlRGVwdGhUZXh0dXJlLCBzdCkpOyBcXG5cIiArXG4gICAgXCIgICAgaWYgKGxvZ0RlcHRoT3JEZXB0aCAhPSAwLjApIFxcblwiICtcbiAgICBcIiAgICB7IFxcblwiICtcbiAgICBcIiAgICAgICAgdmVjNCBleWVDb29yZGluYXRlID0gY3ptX3dpbmRvd1RvRXllQ29vcmRpbmF0ZXMoZ2xfRnJhZ0Nvb3JkLnh5LCBsb2dEZXB0aE9yRGVwdGgpOyBcXG5cIiArXG4gICAgXCIgICAgICAgIGZsb2F0IGRlcHRoRUMgPSBleWVDb29yZGluYXRlLnogLyBleWVDb29yZGluYXRlLnc7IFxcblwiICtcbiAgICBcIiAgICAgICAgaWYgKHZfcG9zaXRpb25FQy56IDwgZGVwdGhFQykgXFxuXCIgK1xuICAgIFwiICAgICAgICB7IFxcblwiICtcbiAgICBcIiAgICAgICAgICAgIGRpc2NhcmQ7IFxcblwiICtcbiAgICBcIiAgICAgICAgfSBcXG5cIiArXG4gICAgXCIgICAgfSBcXG5cIiArXG4gICAgXCIjZW5kaWYgXFxuXCIgK1xuICAgIFwiICAgIGN6bV9nbG9iZV90cmFuc2x1Y2VuY3lfbWFpbigpOyBcXG5cIiArXG4gICAgXCIgICAgdmVjNCBjbGFzc2lmaWNhdGlvbkNvbG9yID0gdGV4dHVyZTJEKHVfY2xhc3NpZmljYXRpb25UZXh0dXJlLCBzdCk7IFxcblwiICtcbiAgICBcIiAgICBpZiAoY2xhc3NpZmljYXRpb25Db2xvci5hID4gMC4wKSBcXG5cIiArXG4gICAgXCIgICAgeyBcXG5cIiArXG4gICAgXCIgICAgICAgIC8vIFJldmVyc2UgcHJlbXVsdGlwbGljYXRpb24gcHJvY2VzcyB0byBnZXQgdGhlIGNvcnJlY3QgY29tcG9zaXRlZCByZXN1bHQgb2YgdGhlIGNsYXNzaWZpY2F0aW9uIHByaW1pdGl2ZXMgXFxuXCIgK1xuICAgIFwiICAgICAgICBjbGFzc2lmaWNhdGlvbkNvbG9yLnJnYiAvPSBjbGFzc2lmaWNhdGlvbkNvbG9yLmE7IFxcblwiICtcbiAgICBcIiAgICB9IFxcblwiICtcbiAgICBcIiAgICBnbF9GcmFnQ29sb3IgPSBjbGFzc2lmaWNhdGlvbkNvbG9yICogdmVjNChjbGFzc2lmaWNhdGlvbkNvbG9yLmFhYSwgMS4wKSArIGdsX0ZyYWdDb2xvciAqICgxLjAgLSBjbGFzc2lmaWNhdGlvbkNvbG9yLmEpOyBcXG5cIiArXG4gICAgXCJ9IFxcblwiO1xuXG4gIHNvdXJjZXMucHVzaChnbG9iZVRyYW5zbHVjZW5jeU1haW4pO1xufVxuXG5mdW5jdGlvbiBnZXRUcmFuc2x1Y2VudEJhY2tGYWNlU2hhZGVyUHJvZ3JhbSh2cywgZnMpIHtcbiAgZ2V0VHJhbnNsdWNlbnRTaGFkZXJQcm9ncmFtKHZzLCBmcyk7XG4gIHJlbW92ZURlZmluZSh2cy5kZWZpbmVzLCBcIkdST1VORF9BVE1PU1BIRVJFXCIpO1xuICByZW1vdmVEZWZpbmUoZnMuZGVmaW5lcywgXCJHUk9VTkRfQVRNT1NQSEVSRVwiKTtcbiAgcmVtb3ZlRGVmaW5lKHZzLmRlZmluZXMsIFwiRk9HXCIpO1xuICByZW1vdmVEZWZpbmUoZnMuZGVmaW5lcywgXCJGT0dcIik7XG59XG5cbmZ1bmN0aW9uIGdldFRyYW5zbHVjZW50RnJvbnRGYWNlTWFudWFsRGVwdGhUZXN0U2hhZGVyUHJvZ3JhbSh2cywgZnMpIHtcbiAgZ2V0VHJhbnNsdWNlbnRTaGFkZXJQcm9ncmFtKHZzLCBmcyk7XG4gIHZzLmRlZmluZXMucHVzaChcIkdFTkVSQVRFX1BPU0lUSU9OXCIpO1xuICBmcy5kZWZpbmVzLnB1c2goXCJNQU5VQUxfREVQVEhfVEVTVFwiKTtcbn1cblxuZnVuY3Rpb24gZ2V0VHJhbnNsdWNlbnRCYWNrRmFjZU1hbnVhbERlcHRoVGVzdFNoYWRlclByb2dyYW0odnMsIGZzKSB7XG4gIGdldFRyYW5zbHVjZW50QmFja0ZhY2VTaGFkZXJQcm9ncmFtKHZzLCBmcyk7XG4gIHZzLmRlZmluZXMucHVzaChcIkdFTkVSQVRFX1BPU0lUSU9OXCIpO1xuICBmcy5kZWZpbmVzLnB1c2goXCJNQU5VQUxfREVQVEhfVEVTVFwiKTtcbn1cblxuZnVuY3Rpb24gZ2V0UGlja1NoYWRlclByb2dyYW0odnMsIGZzKSB7XG4gIHZhciBwaWNrU2hhZGVyID1cbiAgICBcInVuaWZvcm0gc2FtcGxlcjJEIHVfY2xhc3NpZmljYXRpb25UZXh0dXJlOyBcXG5cIiArXG4gICAgXCJ2b2lkIG1haW4oKSBcXG5cIiArXG4gICAgXCJ7IFxcblwiICtcbiAgICBcIiAgICB2ZWMyIHN0ID0gZ2xfRnJhZ0Nvb3JkLnh5IC8gY3ptX3ZpZXdwb3J0Lnp3OyBcXG5cIiArXG4gICAgXCIgICAgdmVjNCBwaWNrQ29sb3IgPSB0ZXh0dXJlMkQodV9jbGFzc2lmaWNhdGlvblRleHR1cmUsIHN0KTsgXFxuXCIgK1xuICAgIFwiICAgIGlmIChwaWNrQ29sb3IgPT0gdmVjNCgwLjApKSBcXG5cIiArXG4gICAgXCIgICAgeyBcXG5cIiArXG4gICAgXCIgICAgICAgIGRpc2NhcmQ7IFxcblwiICtcbiAgICBcIiAgICB9IFxcblwiICtcbiAgICBcIiAgICBnbF9GcmFnQ29sb3IgPSBwaWNrQ29sb3I7IFxcblwiICtcbiAgICBcIn0gXFxuXCI7XG5cbiAgZnMuc291cmNlcyA9IFtwaWNrU2hhZGVyXTtcbn1cblxuZnVuY3Rpb24gZ2V0RGVyaXZlZFNoYWRlclByb2dyYW0oXG4gIGNvbnRleHQsXG4gIHNoYWRlclByb2dyYW0sXG4gIGRlcml2ZWRTaGFkZXJQcm9ncmFtLFxuICBzaGFkZXJQcm9ncmFtRGlydHksXG4gIGdldFNoYWRlclByb2dyYW1GdW5jdGlvbixcbiAgY2FjaGVOYW1lXG4pIHtcbiAgaWYgKCFkZWZpbmVkKGdldFNoYWRlclByb2dyYW1GdW5jdGlvbikpIHtcbiAgICByZXR1cm4gc2hhZGVyUHJvZ3JhbTtcbiAgfVxuXG4gIGlmICghc2hhZGVyUHJvZ3JhbURpcnR5ICYmIGRlZmluZWQoZGVyaXZlZFNoYWRlclByb2dyYW0pKSB7XG4gICAgcmV0dXJuIGRlcml2ZWRTaGFkZXJQcm9ncmFtO1xuICB9XG5cbiAgdmFyIHNoYWRlciA9IGNvbnRleHQuc2hhZGVyQ2FjaGUuZ2V0RGVyaXZlZFNoYWRlclByb2dyYW0oXG4gICAgc2hhZGVyUHJvZ3JhbSxcbiAgICBjYWNoZU5hbWVcbiAgKTtcbiAgaWYgKCFkZWZpbmVkKHNoYWRlcikpIHtcbiAgICB2YXIgYXR0cmlidXRlTG9jYXRpb25zID0gc2hhZGVyUHJvZ3JhbS5fYXR0cmlidXRlTG9jYXRpb25zO1xuICAgIHZhciB2cyA9IHNoYWRlclByb2dyYW0udmVydGV4U2hhZGVyU291cmNlLmNsb25lKCk7XG4gICAgdmFyIGZzID0gc2hhZGVyUHJvZ3JhbS5mcmFnbWVudFNoYWRlclNvdXJjZS5jbG9uZSgpO1xuICAgIHZzLmRlZmluZXMgPSBkZWZpbmVkKHZzLmRlZmluZXMpID8gdnMuZGVmaW5lcy5zbGljZSgwKSA6IFtdO1xuICAgIGZzLmRlZmluZXMgPSBkZWZpbmVkKGZzLmRlZmluZXMpID8gZnMuZGVmaW5lcy5zbGljZSgwKSA6IFtdO1xuXG4gICAgZ2V0U2hhZGVyUHJvZ3JhbUZ1bmN0aW9uKHZzLCBmcyk7XG5cbiAgICBzaGFkZXIgPSBjb250ZXh0LnNoYWRlckNhY2hlLmNyZWF0ZURlcml2ZWRTaGFkZXJQcm9ncmFtKFxuICAgICAgc2hhZGVyUHJvZ3JhbSxcbiAgICAgIGNhY2hlTmFtZSxcbiAgICAgIHtcbiAgICAgICAgdmVydGV4U2hhZGVyU291cmNlOiB2cyxcbiAgICAgICAgZnJhZ21lbnRTaGFkZXJTb3VyY2U6IGZzLFxuICAgICAgICBhdHRyaWJ1dGVMb2NhdGlvbnM6IGF0dHJpYnV0ZUxvY2F0aW9ucyxcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHNoYWRlcjtcbn1cblxuZnVuY3Rpb24gZ2V0T3BhcXVlRnJvbnRGYWNlUmVuZGVyU3RhdGUocmVuZGVyU3RhdGUpIHtcbiAgcmVuZGVyU3RhdGUuY3VsbC5mYWNlID0gQ3VsbEZhY2UuQkFDSztcbiAgcmVuZGVyU3RhdGUuY3VsbC5lbmFibGVkID0gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gZ2V0T3BhcXVlQmFja0ZhY2VSZW5kZXJTdGF0ZShyZW5kZXJTdGF0ZSkge1xuICByZW5kZXJTdGF0ZS5jdWxsLmZhY2UgPSBDdWxsRmFjZS5GUk9OVDtcbiAgcmVuZGVyU3RhdGUuY3VsbC5lbmFibGVkID0gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gZ2V0RGVwdGhPbmx5RnJvbnRGYWNlUmVuZGVyU3RhdGUocmVuZGVyU3RhdGUpIHtcbiAgcmVuZGVyU3RhdGUuY3VsbC5mYWNlID0gQ3VsbEZhY2UuQkFDSztcbiAgcmVuZGVyU3RhdGUuY3VsbC5lbmFibGVkID0gdHJ1ZTtcbiAgcmVuZGVyU3RhdGUuY29sb3JNYXNrID0ge1xuICAgIHJlZDogZmFsc2UsXG4gICAgZ3JlZW46IGZhbHNlLFxuICAgIGJsdWU6IGZhbHNlLFxuICAgIGFscGhhOiBmYWxzZSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gZ2V0RGVwdGhPbmx5QmFja0ZhY2VSZW5kZXJTdGF0ZShyZW5kZXJTdGF0ZSkge1xuICByZW5kZXJTdGF0ZS5jdWxsLmZhY2UgPSBDdWxsRmFjZS5GUk9OVDtcbiAgcmVuZGVyU3RhdGUuY3VsbC5lbmFibGVkID0gdHJ1ZTtcbiAgcmVuZGVyU3RhdGUuY29sb3JNYXNrID0ge1xuICAgIHJlZDogZmFsc2UsXG4gICAgZ3JlZW46IGZhbHNlLFxuICAgIGJsdWU6IGZhbHNlLFxuICAgIGFscGhhOiBmYWxzZSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gZ2V0RGVwdGhPbmx5RnJvbnRBbmRCYWNrRmFjZVJlbmRlclN0YXRlKHJlbmRlclN0YXRlKSB7XG4gIHJlbmRlclN0YXRlLmN1bGwuZW5hYmxlZCA9IGZhbHNlO1xuICByZW5kZXJTdGF0ZS5jb2xvck1hc2sgPSB7XG4gICAgcmVkOiBmYWxzZSxcbiAgICBncmVlbjogZmFsc2UsXG4gICAgYmx1ZTogZmFsc2UsXG4gICAgYWxwaGE6IGZhbHNlLFxuICB9O1xufVxuXG5mdW5jdGlvbiBnZXRUcmFuc2x1Y2VudEZyb250RmFjZVJlbmRlclN0YXRlKHJlbmRlclN0YXRlKSB7XG4gIHJlbmRlclN0YXRlLmN1bGwuZmFjZSA9IEN1bGxGYWNlLkJBQ0s7XG4gIHJlbmRlclN0YXRlLmN1bGwuZW5hYmxlZCA9IHRydWU7XG4gIHJlbmRlclN0YXRlLmRlcHRoTWFzayA9IGZhbHNlO1xuICByZW5kZXJTdGF0ZS5ibGVuZGluZyA9IEJsZW5kaW5nU3RhdGUuQUxQSEFfQkxFTkQ7XG59XG5cbmZ1bmN0aW9uIGdldFRyYW5zbHVjZW50QmFja0ZhY2VSZW5kZXJTdGF0ZShyZW5kZXJTdGF0ZSkge1xuICByZW5kZXJTdGF0ZS5jdWxsLmZhY2UgPSBDdWxsRmFjZS5GUk9OVDtcbiAgcmVuZGVyU3RhdGUuY3VsbC5lbmFibGVkID0gdHJ1ZTtcbiAgcmVuZGVyU3RhdGUuZGVwdGhNYXNrID0gZmFsc2U7XG4gIHJlbmRlclN0YXRlLmJsZW5kaW5nID0gQmxlbmRpbmdTdGF0ZS5BTFBIQV9CTEVORDtcbn1cblxuZnVuY3Rpb24gZ2V0UGlja0Zyb250RmFjZVJlbmRlclN0YXRlKHJlbmRlclN0YXRlKSB7XG4gIHJlbmRlclN0YXRlLmN1bGwuZmFjZSA9IEN1bGxGYWNlLkJBQ0s7XG4gIHJlbmRlclN0YXRlLmN1bGwuZW5hYmxlZCA9IHRydWU7XG4gIHJlbmRlclN0YXRlLmJsZW5kaW5nLmVuYWJsZWQgPSBmYWxzZTtcbn1cblxuZnVuY3Rpb24gZ2V0UGlja0JhY2tGYWNlUmVuZGVyU3RhdGUocmVuZGVyU3RhdGUpIHtcbiAgcmVuZGVyU3RhdGUuY3VsbC5mYWNlID0gQ3VsbEZhY2UuRlJPTlQ7XG4gIHJlbmRlclN0YXRlLmN1bGwuZW5hYmxlZCA9IHRydWU7XG4gIHJlbmRlclN0YXRlLmJsZW5kaW5nLmVuYWJsZWQgPSBmYWxzZTtcbn1cblxuZnVuY3Rpb24gZ2V0RGVyaXZlZFJlbmRlclN0YXRlKFxuICByZW5kZXJTdGF0ZSxcbiAgZGVyaXZlZFJlbmRlclN0YXRlLFxuICByZW5kZXJTdGF0ZURpcnR5LFxuICBnZXRSZW5kZXJTdGF0ZUZ1bmN0aW9uLFxuICBjYWNoZVxuKSB7XG4gIGlmICghZGVmaW5lZChnZXRSZW5kZXJTdGF0ZUZ1bmN0aW9uKSkge1xuICAgIHJldHVybiByZW5kZXJTdGF0ZTtcbiAgfVxuXG4gIGlmICghcmVuZGVyU3RhdGVEaXJ0eSAmJiBkZWZpbmVkKGRlcml2ZWRSZW5kZXJTdGF0ZSkpIHtcbiAgICByZXR1cm4gZGVyaXZlZFJlbmRlclN0YXRlO1xuICB9XG5cbiAgdmFyIGNhY2hlZFJlbmRlclN0YXRlID0gY2FjaGVbcmVuZGVyU3RhdGUuaWRdO1xuICBpZiAoIWRlZmluZWQoY2FjaGVkUmVuZGVyU3RhdGUpKSB7XG4gICAgdmFyIHJzID0gUmVuZGVyU3RhdGUuZ2V0U3RhdGUocmVuZGVyU3RhdGUpO1xuICAgIGdldFJlbmRlclN0YXRlRnVuY3Rpb24ocnMpO1xuICAgIGNhY2hlZFJlbmRlclN0YXRlID0gUmVuZGVyU3RhdGUuZnJvbUNhY2hlKHJzKTtcbiAgICBjYWNoZVtyZW5kZXJTdGF0ZS5pZF0gPSBjYWNoZWRSZW5kZXJTdGF0ZTtcbiAgfVxuXG4gIHJldHVybiBjYWNoZWRSZW5kZXJTdGF0ZTtcbn1cblxuZnVuY3Rpb24gZ2V0VHJhbnNsdWNlbmN5VW5pZm9ybU1hcChzdGF0ZSkge1xuICByZXR1cm4ge1xuICAgIHVfY2xhc3NpZmljYXRpb25UZXh0dXJlOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gc3RhdGUuX2dsb2JlVHJhbnNsdWNlbmN5RnJhbWVidWZmZXIuY2xhc3NpZmljYXRpb25UZXh0dXJlO1xuICAgIH0sXG4gIH07XG59XG5cbmZ1bmN0aW9uIGdldERlcml2ZWRVbmlmb3JtTWFwKFxuICBzdGF0ZSxcbiAgdW5pZm9ybU1hcCxcbiAgZGVyaXZlZFVuaWZvcm1NYXAsXG4gIHVuaWZvcm1NYXBEaXJ0eSxcbiAgZ2V0RGVyaXZlZFVuaWZvcm1NYXBGdW5jdGlvblxuKSB7XG4gIGlmICghZGVmaW5lZChnZXREZXJpdmVkVW5pZm9ybU1hcEZ1bmN0aW9uKSkge1xuICAgIHJldHVybiB1bmlmb3JtTWFwO1xuICB9XG5cbiAgaWYgKCF1bmlmb3JtTWFwRGlydHkgJiYgZGVmaW5lZChkZXJpdmVkVW5pZm9ybU1hcCkpIHtcbiAgICByZXR1cm4gZGVyaXZlZFVuaWZvcm1NYXA7XG4gIH1cblxuICByZXR1cm4gY29tYmluZSh1bmlmb3JtTWFwLCBnZXREZXJpdmVkVW5pZm9ybU1hcEZ1bmN0aW9uKHN0YXRlKSwgZmFsc2UpO1xufVxuXG5mdW5jdGlvbiBEZXJpdmVkQ29tbWFuZFBhY2sob3B0aW9ucykge1xuICB0aGlzLnBhc3MgPSBvcHRpb25zLnBhc3M7XG4gIHRoaXMucGlja09ubHkgPSBvcHRpb25zLnBpY2tPbmx5O1xuICB0aGlzLmdldFNoYWRlclByb2dyYW1GdW5jdGlvbiA9IG9wdGlvbnMuZ2V0U2hhZGVyUHJvZ3JhbUZ1bmN0aW9uO1xuICB0aGlzLmdldFJlbmRlclN0YXRlRnVuY3Rpb24gPSBvcHRpb25zLmdldFJlbmRlclN0YXRlRnVuY3Rpb247XG4gIHRoaXMuZ2V0VW5pZm9ybU1hcEZ1bmN0aW9uID0gb3B0aW9ucy5nZXRVbmlmb3JtTWFwRnVuY3Rpb247XG4gIHRoaXMucmVuZGVyU3RhdGVDYWNoZSA9IHt9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVEZXJpdmVkQ29tbWFuZFBhY2tzKCkge1xuICByZXR1cm4gW1xuICAgIC8vIG9wYXF1ZUZyb250RmFjZUNvbW1hbmRcbiAgICBuZXcgRGVyaXZlZENvbW1hbmRQYWNrKHtcbiAgICAgIHBhc3M6IFBhc3MuR0xPQkUsXG4gICAgICBwaWNrT25seTogZmFsc2UsXG4gICAgICBnZXRTaGFkZXJQcm9ncmFtRnVuY3Rpb246IGdldE9wYXF1ZUZyb250RmFjZVNoYWRlclByb2dyYW0sXG4gICAgICBnZXRSZW5kZXJTdGF0ZUZ1bmN0aW9uOiBnZXRPcGFxdWVGcm9udEZhY2VSZW5kZXJTdGF0ZSxcbiAgICAgIGdldFVuaWZvcm1NYXBGdW5jdGlvbjogdW5kZWZpbmVkLFxuICAgIH0pLFxuICAgIC8vIG9wYXF1ZUJhY2tGYWNlQ29tbWFuZFxuICAgIG5ldyBEZXJpdmVkQ29tbWFuZFBhY2soe1xuICAgICAgcGFzczogUGFzcy5HTE9CRSxcbiAgICAgIHBpY2tPbmx5OiBmYWxzZSxcbiAgICAgIGdldFNoYWRlclByb2dyYW1GdW5jdGlvbjogZ2V0T3BhcXVlQmFja0ZhY2VTaGFkZXJQcm9ncmFtLFxuICAgICAgZ2V0UmVuZGVyU3RhdGVGdW5jdGlvbjogZ2V0T3BhcXVlQmFja0ZhY2VSZW5kZXJTdGF0ZSxcbiAgICAgIGdldFVuaWZvcm1NYXBGdW5jdGlvbjogdW5kZWZpbmVkLFxuICAgIH0pLFxuICAgIC8vIGRlcHRoT25seUZyb250RmFjZUNvbW1hbmRcbiAgICBuZXcgRGVyaXZlZENvbW1hbmRQYWNrKHtcbiAgICAgIHBhc3M6IFBhc3MuR0xPQkUsXG4gICAgICBwaWNrT25seTogZmFsc2UsXG4gICAgICBnZXRTaGFkZXJQcm9ncmFtRnVuY3Rpb246IGdldERlcHRoT25seVNoYWRlclByb2dyYW0sXG4gICAgICBnZXRSZW5kZXJTdGF0ZUZ1bmN0aW9uOiBnZXREZXB0aE9ubHlGcm9udEZhY2VSZW5kZXJTdGF0ZSxcbiAgICAgIGdldFVuaWZvcm1NYXBGdW5jdGlvbjogdW5kZWZpbmVkLFxuICAgIH0pLFxuICAgIC8vIGRlcHRoT25seUJhY2tGYWNlQ29tbWFuZFxuICAgIG5ldyBEZXJpdmVkQ29tbWFuZFBhY2soe1xuICAgICAgcGFzczogUGFzcy5HTE9CRSxcbiAgICAgIHBpY2tPbmx5OiBmYWxzZSxcbiAgICAgIGdldFNoYWRlclByb2dyYW1GdW5jdGlvbjogZ2V0RGVwdGhPbmx5U2hhZGVyUHJvZ3JhbSxcbiAgICAgIGdldFJlbmRlclN0YXRlRnVuY3Rpb246IGdldERlcHRoT25seUJhY2tGYWNlUmVuZGVyU3RhdGUsXG4gICAgICBnZXRVbmlmb3JtTWFwRnVuY3Rpb246IHVuZGVmaW5lZCxcbiAgICB9KSxcbiAgICAvLyBkZXB0aE9ubHlGcm9udEFuZEJhY2tGYWNlQ29tbWFuZFxuICAgIG5ldyBEZXJpdmVkQ29tbWFuZFBhY2soe1xuICAgICAgcGFzczogUGFzcy5HTE9CRSxcbiAgICAgIHBpY2tPbmx5OiBmYWxzZSxcbiAgICAgIGdldFNoYWRlclByb2dyYW1GdW5jdGlvbjogZ2V0RGVwdGhPbmx5U2hhZGVyUHJvZ3JhbSxcbiAgICAgIGdldFJlbmRlclN0YXRlRnVuY3Rpb246IGdldERlcHRoT25seUZyb250QW5kQmFja0ZhY2VSZW5kZXJTdGF0ZSxcbiAgICAgIGdldFVuaWZvcm1NYXBGdW5jdGlvbjogdW5kZWZpbmVkLFxuICAgIH0pLFxuICAgIC8vIHRyYW5zbHVjZW50RnJvbnRGYWNlQ29tbWFuZFxuICAgIG5ldyBEZXJpdmVkQ29tbWFuZFBhY2soe1xuICAgICAgcGFzczogUGFzcy5UUkFOU0xVQ0VOVCxcbiAgICAgIHBpY2tPbmx5OiBmYWxzZSxcbiAgICAgIGdldFNoYWRlclByb2dyYW1GdW5jdGlvbjogZ2V0VHJhbnNsdWNlbnRTaGFkZXJQcm9ncmFtLFxuICAgICAgZ2V0UmVuZGVyU3RhdGVGdW5jdGlvbjogZ2V0VHJhbnNsdWNlbnRGcm9udEZhY2VSZW5kZXJTdGF0ZSxcbiAgICAgIGdldFVuaWZvcm1NYXBGdW5jdGlvbjogZ2V0VHJhbnNsdWNlbmN5VW5pZm9ybU1hcCxcbiAgICB9KSxcbiAgICAvLyB0cmFuc2x1Y2VudEJhY2tGYWNlQ29tbWFuZFxuICAgIG5ldyBEZXJpdmVkQ29tbWFuZFBhY2soe1xuICAgICAgcGFzczogUGFzcy5UUkFOU0xVQ0VOVCxcbiAgICAgIHBpY2tPbmx5OiBmYWxzZSxcbiAgICAgIGdldFNoYWRlclByb2dyYW1GdW5jdGlvbjogZ2V0VHJhbnNsdWNlbnRCYWNrRmFjZVNoYWRlclByb2dyYW0sXG4gICAgICBnZXRSZW5kZXJTdGF0ZUZ1bmN0aW9uOiBnZXRUcmFuc2x1Y2VudEJhY2tGYWNlUmVuZGVyU3RhdGUsXG4gICAgICBnZXRVbmlmb3JtTWFwRnVuY3Rpb246IGdldFRyYW5zbHVjZW5jeVVuaWZvcm1NYXAsXG4gICAgfSksXG4gICAgLy8gdHJhbnNsdWNlbnRGcm9udEZhY2VNYW51YWxEZXB0aFRlc3RDb21tYW5kXG4gICAgbmV3IERlcml2ZWRDb21tYW5kUGFjayh7XG4gICAgICBwYXNzOiBQYXNzLlRSQU5TTFVDRU5ULFxuICAgICAgcGlja09ubHk6IGZhbHNlLFxuICAgICAgZ2V0U2hhZGVyUHJvZ3JhbUZ1bmN0aW9uOiBnZXRUcmFuc2x1Y2VudEZyb250RmFjZU1hbnVhbERlcHRoVGVzdFNoYWRlclByb2dyYW0sXG4gICAgICBnZXRSZW5kZXJTdGF0ZUZ1bmN0aW9uOiBnZXRUcmFuc2x1Y2VudEZyb250RmFjZVJlbmRlclN0YXRlLFxuICAgICAgZ2V0VW5pZm9ybU1hcEZ1bmN0aW9uOiBnZXRUcmFuc2x1Y2VuY3lVbmlmb3JtTWFwLFxuICAgIH0pLFxuICAgIC8vIHRyYW5zbHVjZW50QmFja0ZhY2VNYW51YWxEZXB0aFRlc3RDb21tYW5kXG4gICAgbmV3IERlcml2ZWRDb21tYW5kUGFjayh7XG4gICAgICBwYXNzOiBQYXNzLlRSQU5TTFVDRU5ULFxuICAgICAgcGlja09ubHk6IGZhbHNlLFxuICAgICAgZ2V0U2hhZGVyUHJvZ3JhbUZ1bmN0aW9uOiBnZXRUcmFuc2x1Y2VudEJhY2tGYWNlTWFudWFsRGVwdGhUZXN0U2hhZGVyUHJvZ3JhbSxcbiAgICAgIGdldFJlbmRlclN0YXRlRnVuY3Rpb246IGdldFRyYW5zbHVjZW50QmFja0ZhY2VSZW5kZXJTdGF0ZSxcbiAgICAgIGdldFVuaWZvcm1NYXBGdW5jdGlvbjogZ2V0VHJhbnNsdWNlbmN5VW5pZm9ybU1hcCxcbiAgICB9KSxcbiAgICAvLyBwaWNrRnJvbnRGYWNlQ29tbWFuZFxuICAgIG5ldyBEZXJpdmVkQ29tbWFuZFBhY2soe1xuICAgICAgcGFzczogUGFzcy5UUkFOU0xVQ0VOVCxcbiAgICAgIHBpY2tPbmx5OiB0cnVlLFxuICAgICAgZ2V0U2hhZGVyUHJvZ3JhbUZ1bmN0aW9uOiBnZXRQaWNrU2hhZGVyUHJvZ3JhbSxcbiAgICAgIGdldFJlbmRlclN0YXRlRnVuY3Rpb246IGdldFBpY2tGcm9udEZhY2VSZW5kZXJTdGF0ZSxcbiAgICAgIGdldFVuaWZvcm1NYXBGdW5jdGlvbjogZ2V0VHJhbnNsdWNlbmN5VW5pZm9ybU1hcCxcbiAgICB9KSxcbiAgICAvLyBwaWNrQmFja0ZhY2VDb21tYW5kXG4gICAgbmV3IERlcml2ZWRDb21tYW5kUGFjayh7XG4gICAgICBwYXNzOiBQYXNzLlRSQU5TTFVDRU5ULFxuICAgICAgcGlja09ubHk6IHRydWUsXG4gICAgICBnZXRTaGFkZXJQcm9ncmFtRnVuY3Rpb246IGdldFBpY2tTaGFkZXJQcm9ncmFtLFxuICAgICAgZ2V0UmVuZGVyU3RhdGVGdW5jdGlvbjogZ2V0UGlja0JhY2tGYWNlUmVuZGVyU3RhdGUsXG4gICAgICBnZXRVbmlmb3JtTWFwRnVuY3Rpb246IGdldFRyYW5zbHVjZW5jeVVuaWZvcm1NYXAsXG4gICAgfSksXG4gIF07XG59XG5cbnZhciBkZXJpdmVkQ29tbWFuZE5hbWVzID0gbmV3IEFycmF5KGRlcml2ZWRDb21tYW5kc01heGltdW1MZW5ndGgpO1xudmFyIGRlcml2ZWRDb21tYW5kUGFja3MgPSBuZXcgQXJyYXkoZGVyaXZlZENvbW1hbmRzTWF4aW11bUxlbmd0aCk7XG5cbkdsb2JlVHJhbnNsdWNlbmN5U3RhdGUucHJvdG90eXBlLnVwZGF0ZURlcml2ZWRDb21tYW5kcyA9IGZ1bmN0aW9uIChcbiAgY29tbWFuZCxcbiAgZnJhbWVTdGF0ZVxuKSB7XG4gIHZhciBkZXJpdmVkQ29tbWFuZFR5cGVzID0gdGhpcy5fZGVyaXZlZENvbW1hbmRUeXBlc1RvVXBkYXRlO1xuICB2YXIgZGVyaXZlZENvbW1hbmRzTGVuZ3RoID0gdGhpcy5fZGVyaXZlZENvbW1hbmRzVG9VcGRhdGVMZW5ndGg7XG5cbiAgaWYgKGRlcml2ZWRDb21tYW5kc0xlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZGVyaXZlZENvbW1hbmRzTGVuZ3RoOyArK2kpIHtcbiAgICBkZXJpdmVkQ29tbWFuZFBhY2tzW2ldID0gdGhpcy5fZGVyaXZlZENvbW1hbmRQYWNrc1tkZXJpdmVkQ29tbWFuZFR5cGVzW2ldXTtcbiAgICBkZXJpdmVkQ29tbWFuZE5hbWVzW2ldID0gRGVyaXZlZENvbW1hbmROYW1lc1tkZXJpdmVkQ29tbWFuZFR5cGVzW2ldXTtcbiAgfVxuXG4gIHVwZGF0ZURlcml2ZWRDb21tYW5kcyhcbiAgICB0aGlzLFxuICAgIGNvbW1hbmQsXG4gICAgZGVyaXZlZENvbW1hbmRzTGVuZ3RoLFxuICAgIGRlcml2ZWRDb21tYW5kVHlwZXMsXG4gICAgZGVyaXZlZENvbW1hbmROYW1lcyxcbiAgICBkZXJpdmVkQ29tbWFuZFBhY2tzLFxuICAgIGZyYW1lU3RhdGVcbiAgKTtcbn07XG5cbmZ1bmN0aW9uIHVwZGF0ZURlcml2ZWRDb21tYW5kcyhcbiAgc3RhdGUsXG4gIGNvbW1hbmQsXG4gIGRlcml2ZWRDb21tYW5kc0xlbmd0aCxcbiAgZGVyaXZlZENvbW1hbmRUeXBlcyxcbiAgZGVyaXZlZENvbW1hbmROYW1lcyxcbiAgZGVyaXZlZENvbW1hbmRQYWNrcyxcbiAgZnJhbWVTdGF0ZVxuKSB7XG4gIHZhciBkZXJpdmVkQ29tbWFuZHNPYmplY3QgPSBjb21tYW5kLmRlcml2ZWRDb21tYW5kcy5nbG9iZVRyYW5zbHVjZW5jeTtcbiAgdmFyIGRlcml2ZWRDb21tYW5kc0RpcnR5ID0gc3RhdGUuX2Rlcml2ZWRDb21tYW5kc0RpcnR5O1xuXG4gIGlmIChcbiAgICBjb21tYW5kLmRpcnR5IHx8XG4gICAgIWRlZmluZWQoZGVyaXZlZENvbW1hbmRzT2JqZWN0KSB8fFxuICAgIGRlcml2ZWRDb21tYW5kc0RpcnR5XG4gICkge1xuICAgIGNvbW1hbmQuZGlydHkgPSBmYWxzZTtcblxuICAgIGlmICghZGVmaW5lZChkZXJpdmVkQ29tbWFuZHNPYmplY3QpKSB7XG4gICAgICBkZXJpdmVkQ29tbWFuZHNPYmplY3QgPSB7fTtcbiAgICAgIGNvbW1hbmQuZGVyaXZlZENvbW1hbmRzLmdsb2JlVHJhbnNsdWNlbmN5ID0gZGVyaXZlZENvbW1hbmRzT2JqZWN0O1xuICAgIH1cblxuICAgIHZhciBmcmFtZU51bWJlciA9IGZyYW1lU3RhdGUuZnJhbWVOdW1iZXI7XG5cbiAgICB2YXIgdW5pZm9ybU1hcERpcnR5RnJhbWUgPSBkZWZhdWx0VmFsdWUoXG4gICAgICBkZXJpdmVkQ29tbWFuZHNPYmplY3QudW5pZm9ybU1hcERpcnR5RnJhbWUsXG4gICAgICAwXG4gICAgKTtcbiAgICB2YXIgc2hhZGVyUHJvZ3JhbURpcnR5RnJhbWUgPSBkZWZhdWx0VmFsdWUoXG4gICAgICBkZXJpdmVkQ29tbWFuZHNPYmplY3Quc2hhZGVyUHJvZ3JhbURpcnR5RnJhbWUsXG4gICAgICAwXG4gICAgKTtcbiAgICB2YXIgcmVuZGVyU3RhdGVEaXJ0eUZyYW1lID0gZGVmYXVsdFZhbHVlKFxuICAgICAgZGVyaXZlZENvbW1hbmRzT2JqZWN0LnJlbmRlclN0YXRlRGlydHlGcmFtZSxcbiAgICAgIDBcbiAgICApO1xuXG4gICAgdmFyIHVuaWZvcm1NYXBEaXJ0eSA9XG4gICAgICBkZXJpdmVkQ29tbWFuZHNPYmplY3QudW5pZm9ybU1hcCAhPT0gY29tbWFuZC51bmlmb3JtTWFwO1xuXG4gICAgdmFyIHNoYWRlclByb2dyYW1EaXJ0eSA9XG4gICAgICBkZXJpdmVkQ29tbWFuZHNPYmplY3Quc2hhZGVyUHJvZ3JhbUlkICE9PSBjb21tYW5kLnNoYWRlclByb2dyYW0uaWQ7XG5cbiAgICB2YXIgcmVuZGVyU3RhdGVEaXJ0eSA9XG4gICAgICBkZXJpdmVkQ29tbWFuZHNPYmplY3QucmVuZGVyU3RhdGVJZCAhPT0gY29tbWFuZC5yZW5kZXJTdGF0ZS5pZDtcblxuICAgIGlmICh1bmlmb3JtTWFwRGlydHkpIHtcbiAgICAgIGRlcml2ZWRDb21tYW5kc09iamVjdC51bmlmb3JtTWFwRGlydHlGcmFtZSA9IGZyYW1lTnVtYmVyO1xuICAgIH1cbiAgICBpZiAoc2hhZGVyUHJvZ3JhbURpcnR5KSB7XG4gICAgICBkZXJpdmVkQ29tbWFuZHNPYmplY3Quc2hhZGVyUHJvZ3JhbURpcnR5RnJhbWUgPSBmcmFtZU51bWJlcjtcbiAgICB9XG4gICAgaWYgKHJlbmRlclN0YXRlRGlydHkpIHtcbiAgICAgIGRlcml2ZWRDb21tYW5kc09iamVjdC5yZW5kZXJTdGF0ZURpcnR5RnJhbWUgPSBmcmFtZU51bWJlcjtcbiAgICB9XG5cbiAgICBkZXJpdmVkQ29tbWFuZHNPYmplY3QudW5pZm9ybU1hcCA9IGNvbW1hbmQudW5pZm9ybU1hcDtcbiAgICBkZXJpdmVkQ29tbWFuZHNPYmplY3Quc2hhZGVyUHJvZ3JhbUlkID0gY29tbWFuZC5zaGFkZXJQcm9ncmFtLmlkO1xuICAgIGRlcml2ZWRDb21tYW5kc09iamVjdC5yZW5kZXJTdGF0ZUlkID0gY29tbWFuZC5yZW5kZXJTdGF0ZS5pZDtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGVyaXZlZENvbW1hbmRzTGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBkZXJpdmVkQ29tbWFuZFBhY2sgPSBkZXJpdmVkQ29tbWFuZFBhY2tzW2ldO1xuICAgICAgdmFyIGRlcml2ZWRDb21tYW5kVHlwZSA9IGRlcml2ZWRDb21tYW5kVHlwZXNbaV07XG4gICAgICB2YXIgZGVyaXZlZENvbW1hbmROYW1lID0gZGVyaXZlZENvbW1hbmROYW1lc1tpXTtcbiAgICAgIHZhciBkZXJpdmVkQ29tbWFuZCA9IGRlcml2ZWRDb21tYW5kc09iamVjdFtkZXJpdmVkQ29tbWFuZE5hbWVdO1xuXG4gICAgICB2YXIgZGVyaXZlZFVuaWZvcm1NYXA7XG4gICAgICB2YXIgZGVyaXZlZFNoYWRlclByb2dyYW07XG4gICAgICB2YXIgZGVyaXZlZFJlbmRlclN0YXRlO1xuXG4gICAgICBpZiAoZGVmaW5lZChkZXJpdmVkQ29tbWFuZCkpIHtcbiAgICAgICAgZGVyaXZlZFVuaWZvcm1NYXAgPSBkZXJpdmVkQ29tbWFuZC51bmlmb3JtTWFwO1xuICAgICAgICBkZXJpdmVkU2hhZGVyUHJvZ3JhbSA9IGRlcml2ZWRDb21tYW5kLnNoYWRlclByb2dyYW07XG4gICAgICAgIGRlcml2ZWRSZW5kZXJTdGF0ZSA9IGRlcml2ZWRDb21tYW5kLnJlbmRlclN0YXRlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVyaXZlZFVuaWZvcm1NYXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIGRlcml2ZWRTaGFkZXJQcm9ncmFtID0gdW5kZWZpbmVkO1xuICAgICAgICBkZXJpdmVkUmVuZGVyU3RhdGUgPSB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIGRlcml2ZWRDb21tYW5kID0gRHJhd0NvbW1hbmQuc2hhbGxvd0Nsb25lKGNvbW1hbmQsIGRlcml2ZWRDb21tYW5kKTtcbiAgICAgIGRlcml2ZWRDb21tYW5kc09iamVjdFtkZXJpdmVkQ29tbWFuZE5hbWVdID0gZGVyaXZlZENvbW1hbmQ7XG5cbiAgICAgIHZhciBkZXJpdmVkVW5pZm9ybU1hcERpcnR5RnJhbWUgPSBkZWZhdWx0VmFsdWUoXG4gICAgICAgIGRlcml2ZWRDb21tYW5kLmRlcml2ZWRDb21tYW5kcy51bmlmb3JtTWFwRGlydHlGcmFtZSxcbiAgICAgICAgMFxuICAgICAgKTtcbiAgICAgIHZhciBkZXJpdmVkU2hhZGVyUHJvZ3JhbURpcnR5RnJhbWUgPSBkZWZhdWx0VmFsdWUoXG4gICAgICAgIGRlcml2ZWRDb21tYW5kLmRlcml2ZWRDb21tYW5kcy5zaGFkZXJQcm9ncmFtRGlydHlGcmFtZSxcbiAgICAgICAgMFxuICAgICAgKTtcbiAgICAgIHZhciBkZXJpdmVkUmVuZGVyU3RhdGVEaXJ0eUZyYW1lID0gZGVmYXVsdFZhbHVlKFxuICAgICAgICBkZXJpdmVkQ29tbWFuZC5kZXJpdmVkQ29tbWFuZHMucmVuZGVyU3RhdGVEaXJ0eUZyYW1lLFxuICAgICAgICAwXG4gICAgICApO1xuXG4gICAgICB2YXIgZGVyaXZlZFVuaWZvcm1NYXBEaXJ0eSA9XG4gICAgICAgIHVuaWZvcm1NYXBEaXJ0eSB8fCBkZXJpdmVkVW5pZm9ybU1hcERpcnR5RnJhbWUgPCB1bmlmb3JtTWFwRGlydHlGcmFtZTtcbiAgICAgIHZhciBkZXJpdmVkU2hhZGVyUHJvZ3JhbURpcnR5ID1cbiAgICAgICAgc2hhZGVyUHJvZ3JhbURpcnR5IHx8XG4gICAgICAgIGRlcml2ZWRTaGFkZXJQcm9ncmFtRGlydHlGcmFtZSA8IHNoYWRlclByb2dyYW1EaXJ0eUZyYW1lO1xuICAgICAgdmFyIGRlcml2ZWRSZW5kZXJTdGF0ZURpcnR5ID1cbiAgICAgICAgcmVuZGVyU3RhdGVEaXJ0eSB8fFxuICAgICAgICBkZXJpdmVkUmVuZGVyU3RhdGVEaXJ0eUZyYW1lIDwgcmVuZGVyU3RhdGVEaXJ0eUZyYW1lO1xuXG4gICAgICBpZiAoZGVyaXZlZFVuaWZvcm1NYXBEaXJ0eSkge1xuICAgICAgICBkZXJpdmVkQ29tbWFuZC5kZXJpdmVkQ29tbWFuZHMudW5pZm9ybU1hcERpcnR5RnJhbWUgPSBmcmFtZU51bWJlcjtcbiAgICAgIH1cbiAgICAgIGlmIChkZXJpdmVkU2hhZGVyUHJvZ3JhbURpcnR5KSB7XG4gICAgICAgIGRlcml2ZWRDb21tYW5kLmRlcml2ZWRDb21tYW5kcy5zaGFkZXJQcm9ncmFtRGlydHlGcmFtZSA9IGZyYW1lTnVtYmVyO1xuICAgICAgfVxuICAgICAgaWYgKGRlcml2ZWRSZW5kZXJTdGF0ZURpcnR5KSB7XG4gICAgICAgIGRlcml2ZWRDb21tYW5kLmRlcml2ZWRDb21tYW5kcy5yZW5kZXJTdGF0ZURpcnR5RnJhbWUgPSBmcmFtZU51bWJlcjtcbiAgICAgIH1cblxuICAgICAgZGVyaXZlZENvbW1hbmQuZGVyaXZlZENvbW1hbmRzLnR5cGUgPSBkZXJpdmVkQ29tbWFuZFR5cGU7XG4gICAgICBkZXJpdmVkQ29tbWFuZC5wYXNzID0gZGVyaXZlZENvbW1hbmRQYWNrLnBhc3M7XG4gICAgICBkZXJpdmVkQ29tbWFuZC5waWNrT25seSA9IGRlcml2ZWRDb21tYW5kUGFjay5waWNrT25seTtcbiAgICAgIGRlcml2ZWRDb21tYW5kLnVuaWZvcm1NYXAgPSBnZXREZXJpdmVkVW5pZm9ybU1hcChcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIGNvbW1hbmQudW5pZm9ybU1hcCxcbiAgICAgICAgZGVyaXZlZFVuaWZvcm1NYXAsXG4gICAgICAgIGRlcml2ZWRVbmlmb3JtTWFwRGlydHksXG4gICAgICAgIGRlcml2ZWRDb21tYW5kUGFjay5nZXRVbmlmb3JtTWFwRnVuY3Rpb25cbiAgICAgICk7XG4gICAgICBkZXJpdmVkQ29tbWFuZC5zaGFkZXJQcm9ncmFtID0gZ2V0RGVyaXZlZFNoYWRlclByb2dyYW0oXG4gICAgICAgIGZyYW1lU3RhdGUuY29udGV4dCxcbiAgICAgICAgY29tbWFuZC5zaGFkZXJQcm9ncmFtLFxuICAgICAgICBkZXJpdmVkU2hhZGVyUHJvZ3JhbSxcbiAgICAgICAgZGVyaXZlZFNoYWRlclByb2dyYW1EaXJ0eSxcbiAgICAgICAgZGVyaXZlZENvbW1hbmRQYWNrLmdldFNoYWRlclByb2dyYW1GdW5jdGlvbixcbiAgICAgICAgZGVyaXZlZENvbW1hbmROYW1lXG4gICAgICApO1xuICAgICAgZGVyaXZlZENvbW1hbmQucmVuZGVyU3RhdGUgPSBnZXREZXJpdmVkUmVuZGVyU3RhdGUoXG4gICAgICAgIGNvbW1hbmQucmVuZGVyU3RhdGUsXG4gICAgICAgIGRlcml2ZWRSZW5kZXJTdGF0ZSxcbiAgICAgICAgZGVyaXZlZFJlbmRlclN0YXRlRGlydHksXG4gICAgICAgIGRlcml2ZWRDb21tYW5kUGFjay5nZXRSZW5kZXJTdGF0ZUZ1bmN0aW9uLFxuICAgICAgICBkZXJpdmVkQ29tbWFuZFBhY2sucmVuZGVyU3RhdGVDYWNoZVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuR2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZS5wcm90b3R5cGUucHVzaERlcml2ZWRDb21tYW5kcyA9IGZ1bmN0aW9uIChcbiAgY29tbWFuZCxcbiAgaXNCbGVuZENvbW1hbmQsXG4gIGZyYW1lU3RhdGVcbikge1xuICB2YXIgcGlja2luZyA9IGZyYW1lU3RhdGUucGFzc2VzLnBpY2s7XG4gIGlmIChwaWNraW5nICYmIGlzQmxlbmRDb21tYW5kKSB7XG4gICAgLy8gTm8gbmVlZCB0byBwdXNoIGJsZW5kIGNvbW1hbmRzIGluIHRoZSBwaWNrIHBhc3NcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgZGVyaXZlZENvbW1hbmRUeXBlcyA9IHRoaXMuX2Rlcml2ZWRDb21tYW5kVHlwZXM7XG4gIHZhciBkZXJpdmVkQ29tbWFuZHNMZW5ndGggPSB0aGlzLl9kZXJpdmVkQ29tbWFuZHNMZW5ndGg7XG5cbiAgaWYgKHBpY2tpbmcpIHtcbiAgICBkZXJpdmVkQ29tbWFuZFR5cGVzID0gdGhpcy5fZGVyaXZlZFBpY2tDb21tYW5kVHlwZXM7XG4gICAgZGVyaXZlZENvbW1hbmRzTGVuZ3RoID0gdGhpcy5fZGVyaXZlZFBpY2tDb21tYW5kc0xlbmd0aDtcbiAgfSBlbHNlIGlmIChpc0JsZW5kQ29tbWFuZCkge1xuICAgIGRlcml2ZWRDb21tYW5kVHlwZXMgPSB0aGlzLl9kZXJpdmVkQmxlbmRDb21tYW5kVHlwZXM7XG4gICAgZGVyaXZlZENvbW1hbmRzTGVuZ3RoID0gdGhpcy5fZGVyaXZlZEJsZW5kQ29tbWFuZHNMZW5ndGg7XG4gIH1cblxuICBpZiAoZGVyaXZlZENvbW1hbmRzTGVuZ3RoID09PSAwKSB7XG4gICAgLy8gTm8gZGVyaXZlZCBjb21tYW5kcyB0byBwdXNoIHNvIGp1c3QgcHVzaCB0aGUgZ2xvYmUgY29tbWFuZFxuICAgIGZyYW1lU3RhdGUuY29tbWFuZExpc3QucHVzaChjb21tYW5kKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBQdXNoIGRlcml2ZWQgY29tbWFuZHNcbiAgdmFyIGRlcml2ZWRDb21tYW5kcyA9IGNvbW1hbmQuZGVyaXZlZENvbW1hbmRzLmdsb2JlVHJhbnNsdWNlbmN5O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGRlcml2ZWRDb21tYW5kc0xlbmd0aDsgKytpKSB7XG4gICAgdmFyIGRlcml2ZWRDb21tYW5kTmFtZSA9IERlcml2ZWRDb21tYW5kTmFtZXNbZGVyaXZlZENvbW1hbmRUeXBlc1tpXV07XG4gICAgZnJhbWVTdGF0ZS5jb21tYW5kTGlzdC5wdXNoKGRlcml2ZWRDb21tYW5kc1tkZXJpdmVkQ29tbWFuZE5hbWVdKTtcbiAgfVxufTtcblxuZnVuY3Rpb24gZXhlY3V0ZUNvbW1hbmRzTWF0Y2hpbmdUeXBlKFxuICBjb21tYW5kcyxcbiAgY29tbWFuZHNMZW5ndGgsXG4gIGV4ZWN1dGVDb21tYW5kRnVuY3Rpb24sXG4gIHNjZW5lLFxuICBjb250ZXh0LFxuICBwYXNzU3RhdGUsXG4gIHR5cGVzXG4pIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb21tYW5kc0xlbmd0aDsgKytpKSB7XG4gICAgdmFyIGNvbW1hbmQgPSBjb21tYW5kc1tpXTtcbiAgICB2YXIgdHlwZSA9IGNvbW1hbmQuZGVyaXZlZENvbW1hbmRzLnR5cGU7XG4gICAgaWYgKCFkZWZpbmVkKHR5cGVzKSB8fCB0eXBlcy5pbmRleE9mKHR5cGUpID4gLTEpIHtcbiAgICAgIGV4ZWN1dGVDb21tYW5kRnVuY3Rpb24oY29tbWFuZCwgc2NlbmUsIGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGV4ZWN1dGVDb21tYW5kcyhcbiAgY29tbWFuZHMsXG4gIGNvbW1hbmRzTGVuZ3RoLFxuICBleGVjdXRlQ29tbWFuZEZ1bmN0aW9uLFxuICBzY2VuZSxcbiAgY29udGV4dCxcbiAgcGFzc1N0YXRlXG4pIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb21tYW5kc0xlbmd0aDsgKytpKSB7XG4gICAgZXhlY3V0ZUNvbW1hbmRGdW5jdGlvbihjb21tYW5kc1tpXSwgc2NlbmUsIGNvbnRleHQsIHBhc3NTdGF0ZSk7XG4gIH1cbn1cblxudmFyIG9wYXF1ZVR5cGVzID0gW1xuICBEZXJpdmVkQ29tbWFuZFR5cGUuT1BBUVVFX0ZST05UX0ZBQ0UsXG4gIERlcml2ZWRDb21tYW5kVHlwZS5PUEFRVUVfQkFDS19GQUNFLFxuXTtcbnZhciBkZXB0aE9ubHlUeXBlcyA9IFtcbiAgRGVyaXZlZENvbW1hbmRUeXBlLkRFUFRIX09OTFlfRlJPTlRfRkFDRSxcbiAgRGVyaXZlZENvbW1hbmRUeXBlLkRFUFRIX09OTFlfQkFDS19GQUNFLFxuICBEZXJpdmVkQ29tbWFuZFR5cGUuREVQVEhfT05MWV9GUk9OVF9BTkRfQkFDS19GQUNFLFxuXTtcblxuR2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZS5wcm90b3R5cGUuZXhlY3V0ZUdsb2JlQ29tbWFuZHMgPSBmdW5jdGlvbiAoXG4gIGZydXN0dW1Db21tYW5kcyxcbiAgZXhlY3V0ZUNvbW1hbmRGdW5jdGlvbixcbiAgZ2xvYmVUcmFuc2x1Y2VuY3lGcmFtZWJ1ZmZlcixcbiAgc2NlbmUsXG4gIHBhc3NTdGF0ZVxuKSB7XG4gIHZhciBjb250ZXh0ID0gc2NlbmUuY29udGV4dDtcbiAgdmFyIGdsb2JlQ29tbWFuZHMgPSBmcnVzdHVtQ29tbWFuZHMuY29tbWFuZHNbUGFzcy5HTE9CRV07XG4gIHZhciBnbG9iZUNvbW1hbmRzTGVuZ3RoID0gZnJ1c3R1bUNvbW1hbmRzLmluZGljZXNbUGFzcy5HTE9CRV07XG5cbiAgaWYgKGdsb2JlQ29tbWFuZHNMZW5ndGggPT09IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLl9nbG9iZVRyYW5zbHVjZW5jeUZyYW1lYnVmZmVyID0gZ2xvYmVUcmFuc2x1Y2VuY3lGcmFtZWJ1ZmZlcjtcbiAgZ2xvYmVUcmFuc2x1Y2VuY3lGcmFtZWJ1ZmZlci5jbGVhckNsYXNzaWZpY2F0aW9uKGNvbnRleHQsIHBhc3NTdGF0ZSk7XG5cbiAgLy8gUmVuZGVyIG9wYXF1ZSBjb21tYW5kcyBsaWtlIG5vcm1hbFxuICBleGVjdXRlQ29tbWFuZHNNYXRjaGluZ1R5cGUoXG4gICAgZ2xvYmVDb21tYW5kcyxcbiAgICBnbG9iZUNvbW1hbmRzTGVuZ3RoLFxuICAgIGV4ZWN1dGVDb21tYW5kRnVuY3Rpb24sXG4gICAgc2NlbmUsXG4gICAgY29udGV4dCxcbiAgICBwYXNzU3RhdGUsXG4gICAgb3BhcXVlVHlwZXNcbiAgKTtcbn07XG5cbkdsb2JlVHJhbnNsdWNlbmN5U3RhdGUucHJvdG90eXBlLmV4ZWN1dGVHbG9iZUNsYXNzaWZpY2F0aW9uQ29tbWFuZHMgPSBmdW5jdGlvbiAoXG4gIGZydXN0dW1Db21tYW5kcyxcbiAgZXhlY3V0ZUNvbW1hbmRGdW5jdGlvbixcbiAgZ2xvYmVUcmFuc2x1Y2VuY3lGcmFtZWJ1ZmZlcixcbiAgc2NlbmUsXG4gIHBhc3NTdGF0ZVxuKSB7XG4gIHZhciBjb250ZXh0ID0gc2NlbmUuY29udGV4dDtcbiAgdmFyIGdsb2JlQ29tbWFuZHMgPSBmcnVzdHVtQ29tbWFuZHMuY29tbWFuZHNbUGFzcy5HTE9CRV07XG4gIHZhciBnbG9iZUNvbW1hbmRzTGVuZ3RoID0gZnJ1c3R1bUNvbW1hbmRzLmluZGljZXNbUGFzcy5HTE9CRV07XG4gIHZhciBjbGFzc2lmaWNhdGlvbkNvbW1hbmRzID1cbiAgICBmcnVzdHVtQ29tbWFuZHMuY29tbWFuZHNbUGFzcy5URVJSQUlOX0NMQVNTSUZJQ0FUSU9OXTtcbiAgdmFyIGNsYXNzaWZpY2F0aW9uQ29tbWFuZHNMZW5ndGggPVxuICAgIGZydXN0dW1Db21tYW5kcy5pbmRpY2VzW1Bhc3MuVEVSUkFJTl9DTEFTU0lGSUNBVElPTl07XG5cbiAgaWYgKGdsb2JlQ29tbWFuZHNMZW5ndGggPT09IDAgfHwgY2xhc3NpZmljYXRpb25Db21tYW5kc0xlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBmcm9udFRyYW5zbHVjZW50ID0gdGhpcy5fZnJvbnRGYWNlVHJhbnNsdWNlbnQ7XG4gIHZhciBiYWNrVHJhbnNsdWNlbnQgPSB0aGlzLl9iYWNrRmFjZVRyYW5zbHVjZW50O1xuXG4gIGlmICghZnJvbnRUcmFuc2x1Y2VudCB8fCAhYmFja1RyYW5zbHVjZW50KSB7XG4gICAgLy8gUmVuZGVyIGNsYXNzaWZpY2F0aW9uIG9uIG9wYXF1ZSBmYWNlcyBsaWtlIG5vcm1hbFxuICAgIGV4ZWN1dGVDb21tYW5kcyhcbiAgICAgIGNsYXNzaWZpY2F0aW9uQ29tbWFuZHMsXG4gICAgICBjbGFzc2lmaWNhdGlvbkNvbW1hbmRzTGVuZ3RoLFxuICAgICAgZXhlY3V0ZUNvbW1hbmRGdW5jdGlvbixcbiAgICAgIHNjZW5lLFxuICAgICAgY29udGV4dCxcbiAgICAgIHBhc3NTdGF0ZVxuICAgICk7XG4gIH1cblxuICBpZiAoIWZyb250VHJhbnNsdWNlbnQgJiYgIWJhY2tUcmFuc2x1Y2VudCkge1xuICAgIC8vIE5vIHRyYW5zbHVjZW50IGNvbW1hbmRzIHRvIHJlbmRlci4gU2tpcCB0cmFuc2x1Y2VudCBjbGFzc2lmaWNhdGlvbi5cbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLl9nbG9iZVRyYW5zbHVjZW5jeUZyYW1lYnVmZmVyID0gZ2xvYmVUcmFuc2x1Y2VuY3lGcmFtZWJ1ZmZlcjtcblxuICB2YXIgb3JpZ2luYWxHbG9iZURlcHRoVGV4dHVyZSA9IGNvbnRleHQudW5pZm9ybVN0YXRlLmdsb2JlRGVwdGhUZXh0dXJlO1xuICB2YXIgb3JpZ2luYWxGcmFtZWJ1ZmZlciA9IHBhc3NTdGF0ZS5mcmFtZWJ1ZmZlcjtcblxuICAvLyBSZW5kZXIgdG8gaW50ZXJuYWwgZnJhbWVidWZmZXIgYW5kIGdldCB0aGUgZmlyc3QgZGVwdGggcGVlbFxuICBwYXNzU3RhdGUuZnJhbWVidWZmZXIgPVxuICAgIGdsb2JlVHJhbnNsdWNlbmN5RnJhbWVidWZmZXIuY2xhc3NpZmljYXRpb25GcmFtZWJ1ZmZlcjtcblxuICBleGVjdXRlQ29tbWFuZHNNYXRjaGluZ1R5cGUoXG4gICAgZ2xvYmVDb21tYW5kcyxcbiAgICBnbG9iZUNvbW1hbmRzTGVuZ3RoLFxuICAgIGV4ZWN1dGVDb21tYW5kRnVuY3Rpb24sXG4gICAgc2NlbmUsXG4gICAgY29udGV4dCxcbiAgICBwYXNzU3RhdGUsXG4gICAgZGVwdGhPbmx5VHlwZXNcbiAgKTtcblxuICBpZiAoY29udGV4dC5kZXB0aFRleHR1cmUpIHtcbiAgICAvLyBQYWNrIGRlcHRoIGludG8gc2VwYXJhdGUgdGV4dHVyZSBmb3IgZ3JvdW5kIHBvbHlsaW5lcyBhbmQgdGV4dHVyZWQgZ3JvdW5kIHByaW1pdGl2ZXNcbiAgICB2YXIgcGFja2VkRGVwdGhUZXh0dXJlID0gZ2xvYmVUcmFuc2x1Y2VuY3lGcmFtZWJ1ZmZlci5wYWNrRGVwdGgoXG4gICAgICBjb250ZXh0LFxuICAgICAgcGFzc1N0YXRlXG4gICAgKTtcbiAgICBjb250ZXh0LnVuaWZvcm1TdGF0ZS5nbG9iZURlcHRoVGV4dHVyZSA9IHBhY2tlZERlcHRoVGV4dHVyZTtcbiAgfVxuXG4gIC8vIFJlbmRlciBjbGFzc2lmaWNhdGlvbiBvbiB0cmFuc2x1Y2VudCBmYWNlc1xuICBleGVjdXRlQ29tbWFuZHMoXG4gICAgY2xhc3NpZmljYXRpb25Db21tYW5kcyxcbiAgICBjbGFzc2lmaWNhdGlvbkNvbW1hbmRzTGVuZ3RoLFxuICAgIGV4ZWN1dGVDb21tYW5kRnVuY3Rpb24sXG4gICAgc2NlbmUsXG4gICAgY29udGV4dCxcbiAgICBwYXNzU3RhdGVcbiAgKTtcblxuICAvLyBVbnNldCB0ZW1wb3Jhcnkgc3RhdGVcbiAgY29udGV4dC51bmlmb3JtU3RhdGUuZ2xvYmVEZXB0aFRleHR1cmUgPSBvcmlnaW5hbEdsb2JlRGVwdGhUZXh0dXJlO1xuICBwYXNzU3RhdGUuZnJhbWVidWZmZXIgPSBvcmlnaW5hbEZyYW1lYnVmZmVyO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgR2xvYmVUcmFuc2x1Y2VuY3lTdGF0ZTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///85985\n')}}]);