define(["./when-8166c7dd","./Matrix2-92b7fb9d","./GeometryOffsetAttribute-e8e698d7","./Transforms-62a339c3","./RuntimeError-4fdc4459","./ComponentDatatype-9ed50558","./GeometryAttribute-6f4c3b93","./GeometryAttributes-50becc99","./GeometryInstance-c790ce17","./GeometryPipeline-54fb0bb4","./IndexDatatype-797210ca","./PolygonPipeline-7fb6627c","./RectangleGeometryLibrary-fdac9734","./VertexFormat-c0801687","./combine-a5c4cc47","./WebGLConstants-0664004c","./AttributeCompression-212262a3","./EncodedCartesian3-4a314cb8","./IntersectionTests-4f28a69c","./Plane-049255eb","./EllipsoidRhumbLine-51654311"],(function(t,e,a,r,n,o,i,s,l,u,c,m,p,d,g,y,f,h,v,b,_){"use strict";var A=new e.Cartesian3,w=new e.Cartesian3,x=new e.Cartesian3,C=new e.Cartesian3,R=new e.Rectangle,E=new e.Cartesian2,F=new r.BoundingSphere,G=new r.BoundingSphere;function P(t,e){var a=new i.Geometry({attributes:new s.GeometryAttributes,primitiveType:i.PrimitiveType.TRIANGLES});return a.attributes.position=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}function V(t,a,r,n){var o=t.length,i=a.normal?new Float32Array(o):void 0,s=a.tangent?new Float32Array(o):void 0,l=a.bitangent?new Float32Array(o):void 0,u=0,c=C,m=x,p=w;if(a.normal||a.tangent||a.bitangent)for(var d=0;d<o;d+=3){var g=e.Cartesian3.fromArray(t,d,A),y=u+1,f=u+2;p=r.geodeticSurfaceNormal(g,p),(a.tangent||a.bitangent)&&(e.Cartesian3.cross(e.Cartesian3.UNIT_Z,p,m),e.Matrix3.multiplyByVector(n,m,m),e.Cartesian3.normalize(m,m),a.bitangent&&e.Cartesian3.normalize(e.Cartesian3.cross(p,m,c),c)),a.normal&&(i[u]=p.x,i[y]=p.y,i[f]=p.z),a.tangent&&(s[u]=m.x,s[y]=m.y,s[f]=m.z),a.bitangent&&(l[u]=c.x,l[y]=c.y,l[f]=c.z),u+=3}return P(a,{positions:t,normals:i,tangents:s,bitangents:l})}var D=new e.Cartesian3,L=new e.Cartesian3;function M(t,a,r){var n=t.length,i=a.normal?new Float32Array(n):void 0,s=a.tangent?new Float32Array(n):void 0,l=a.bitangent?new Float32Array(n):void 0,u=0,c=0,m=0,p=!0,d=C,g=x,y=w;if(a.normal||a.tangent||a.bitangent)for(var f=0;f<n;f+=6){var h=e.Cartesian3.fromArray(t,f,A),v=e.Cartesian3.fromArray(t,(f+6)%n,D);if(p){var b=e.Cartesian3.fromArray(t,(f+3)%n,L);e.Cartesian3.subtract(v,h,v),e.Cartesian3.subtract(b,h,b),y=e.Cartesian3.normalize(e.Cartesian3.cross(b,v,y),y),p=!1}e.Cartesian3.equalsEpsilon(v,h,o.CesiumMath.EPSILON10)&&(p=!0),(a.tangent||a.bitangent)&&(d=r.geodeticSurfaceNormal(h,d),a.tangent&&(g=e.Cartesian3.normalize(e.Cartesian3.cross(d,y,g),g))),a.normal&&(i[u++]=y.x,i[u++]=y.y,i[u++]=y.z,i[u++]=y.x,i[u++]=y.y,i[u++]=y.z),a.tangent&&(s[c++]=g.x,s[c++]=g.y,s[c++]=g.z,s[c++]=g.x,s[c++]=g.y,s[c++]=g.z),a.bitangent&&(l[m++]=d.x,l[m++]=d.y,l[m++]=d.z,l[m++]=d.x,l[m++]=d.y,l[m++]=d.z)}return P(a,{positions:t,normals:i,tangents:s,bitangents:l})}function O(t,e){var a=t._vertexFormat,r=t._ellipsoid,n=e.height,s=e.width,l=e.northCap,u=e.southCap,m=0,d=n,g=n,y=0;l&&(m=1,g-=1,y+=1),u&&(d-=1,g-=1,y+=1),y+=s*g;for(var f=a.position?new Float64Array(3*y):void 0,h=a.st?new Float32Array(2*y):void 0,v=0,b=0,_=A,w=E,x=Number.MAX_VALUE,C=Number.MAX_VALUE,R=-Number.MAX_VALUE,F=-Number.MAX_VALUE,G=m;G<d;++G)for(var P=0;P<s;++P)p.RectangleGeometryLibrary.computePosition(e,r,a.st,G,P,_,w),f[v++]=_.x,f[v++]=_.y,f[v++]=_.z,a.st&&(h[b++]=w.x,h[b++]=w.y,x=Math.min(x,w.x),C=Math.min(C,w.y),R=Math.max(R,w.x),F=Math.max(F,w.y));if(l&&(p.RectangleGeometryLibrary.computePosition(e,r,a.st,0,0,_,w),f[v++]=_.x,f[v++]=_.y,f[v++]=_.z,a.st&&(h[b++]=w.x,h[b++]=w.y,x=w.x,C=w.y,R=w.x,F=w.y)),u&&(p.RectangleGeometryLibrary.computePosition(e,r,a.st,n-1,0,_,w),f[v++]=_.x,f[v++]=_.y,f[v]=_.z,a.st&&(h[b++]=w.x,h[b]=w.y,x=Math.min(x,w.x),C=Math.min(C,w.y),R=Math.max(R,w.x),F=Math.max(F,w.y))),a.st&&(x<0||C<0||R>1||F>1))for(var D=0;D<h.length;D+=2)h[D]=(h[D]-x)/(R-x),h[D+1]=(h[D+1]-C)/(F-C);var L=V(f,a,r,e.tangentRotationMatrix),M=6*(s-1)*(g-1);l&&(M+=3*(s-1)),u&&(M+=3*(s-1));var O,T=c.IndexDatatype.createTypedArray(y,M),N=0,k=0;for(O=0;O<g-1;++O){for(var S=0;S<s-1;++S){var I=N,H=I+s,z=H+1,B=I+1;T[k++]=I,T[k++]=H,T[k++]=B,T[k++]=B,T[k++]=H,T[k++]=z,++N}++N}if(l||u){var U,q,Y=y-1,j=y-1;if(l&&u&&(Y=y-2),N=0,l)for(O=0;O<s-1;O++)U=N,q=U+1,T[k++]=Y,T[k++]=U,T[k++]=q,++N;if(u)for(N=(g-1)*s,O=0;O<s-1;O++)U=N,q=U+1,T[k++]=U,T[k++]=j,T[k++]=q,++N}return L.indices=T,a.st&&(L.attributes.st=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:h})),L}function T(t,e,a,r,n){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function N(t,e,a,r){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a],t[e]=r[a+1],t}var k=new d.VertexFormat;function S(r,n){var s,p=r._shadowVolume,g=r._offsetAttribute,y=r._vertexFormat,f=r._extrudedHeight,h=r._surfaceHeight,v=r._ellipsoid,b=n.height,_=n.width;if(p){var A=d.VertexFormat.clone(y,k);A.normal=!0,r._vertexFormat=A}var w=O(r,n);p&&(r._vertexFormat=y);var x=m.PolygonPipeline.scaleToGeodeticHeight(w.attributes.position.values,h,v,!1);x=new Float64Array(x);var C=x.length,R=2*C,E=new Float64Array(R);E.set(x);var F=m.PolygonPipeline.scaleToGeodeticHeight(w.attributes.position.values,f,v);E.set(F,C),w.attributes.position.values=E;var G,P,V,S=y.normal?new Float32Array(R):void 0,I=y.tangent?new Float32Array(R):void 0,H=y.bitangent?new Float32Array(R):void 0,z=y.st?new Float32Array(R/3*2):void 0;if(y.normal){for(P=w.attributes.normal.values,S.set(P),s=0;s<C;s++)P[s]=-P[s];S.set(P,C),w.attributes.normal.values=S}if(p){P=w.attributes.normal.values,y.normal||(w.attributes.normal=void 0);var B=new Float32Array(R);for(s=0;s<C;s++)P[s]=-P[s];B.set(P,C),w.attributes.extrudeDirection=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:B})}var U=t.defined(g);if(U){var q=C/3*2,Y=new Uint8Array(q);g===a.GeometryOffsetAttribute.TOP?Y=a.arrayFill(Y,1,0,q/2):(V=g===a.GeometryOffsetAttribute.NONE?0:1,Y=a.arrayFill(Y,V)),w.attributes.applyOffset=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:Y})}if(y.tangent){var j=w.attributes.tangent.values;for(I.set(j),s=0;s<C;s++)j[s]=-j[s];I.set(j,C),w.attributes.tangent.values=I}if(y.bitangent){var X=w.attributes.bitangent.values;H.set(X),H.set(X,C),w.attributes.bitangent.values=H}y.st&&(G=w.attributes.st.values,z.set(G),z.set(G,C/3*2),w.attributes.st.values=z);var Q=w.indices,W=Q.length,J=C/3,Z=c.IndexDatatype.createTypedArray(R/3,2*W);for(Z.set(Q),s=0;s<W;s+=3)Z[s+W]=Q[s+2]+J,Z[s+1+W]=Q[s+1]+J,Z[s+2+W]=Q[s]+J;w.indices=Z;var K=n.northCap,$=n.southCap,tt=b,et=2,at=0,rt=4,nt=4;K&&(et-=1,tt-=1,at+=1,rt-=2,nt-=1),$&&(et-=1,tt-=1,at+=1,rt-=2,nt-=1),at+=et*_+2*tt-rt;var ot=2*(at+nt),it=new Float64Array(3*ot),st=p?new Float32Array(3*ot):void 0,lt=U?new Uint8Array(ot):void 0,ut=y.st?new Float32Array(2*ot):void 0,ct=g===a.GeometryOffsetAttribute.TOP;U&&!ct&&(V=g===a.GeometryOffsetAttribute.ALL?1:0,lt=a.arrayFill(lt,V));var mt,pt=0,dt=0,gt=0,yt=0,ft=_*tt;for(s=0;s<ft;s+=_)mt=3*s,it=T(it,pt,mt,x,F),pt+=6,y.st&&(ut=N(ut,dt,2*s,G),dt+=4),p&&(gt+=3,st[gt++]=P[mt],st[gt++]=P[mt+1],st[gt++]=P[mt+2]),ct&&(lt[yt++]=1,yt+=1);if($){var ht=K?ft+1:ft;for(mt=3*ht,s=0;s<2;s++)it=T(it,pt,mt,x,F),pt+=6,y.st&&(ut=N(ut,dt,2*ht,G),dt+=4),p&&(gt+=3,st[gt++]=P[mt],st[gt++]=P[mt+1],st[gt++]=P[mt+2]),ct&&(lt[yt++]=1,yt+=1)}else for(s=ft-_;s<ft;s++)mt=3*s,it=T(it,pt,mt,x,F),pt+=6,y.st&&(ut=N(ut,dt,2*s,G),dt+=4),p&&(gt+=3,st[gt++]=P[mt],st[gt++]=P[mt+1],st[gt++]=P[mt+2]),ct&&(lt[yt++]=1,yt+=1);for(s=ft-1;s>0;s-=_)mt=3*s,it=T(it,pt,mt,x,F),pt+=6,y.st&&(ut=N(ut,dt,2*s,G),dt+=4),p&&(gt+=3,st[gt++]=P[mt],st[gt++]=P[mt+1],st[gt++]=P[mt+2]),ct&&(lt[yt++]=1,yt+=1);if(K){var vt=ft;for(mt=3*vt,s=0;s<2;s++)it=T(it,pt,mt,x,F),pt+=6,y.st&&(ut=N(ut,dt,2*vt,G),dt+=4),p&&(gt+=3,st[gt++]=P[mt],st[gt++]=P[mt+1],st[gt++]=P[mt+2]),ct&&(lt[yt++]=1,yt+=1)}else for(s=_-1;s>=0;s--)mt=3*s,it=T(it,pt,mt,x,F),pt+=6,y.st&&(ut=N(ut,dt,2*s,G),dt+=4),p&&(gt+=3,st[gt++]=P[mt],st[gt++]=P[mt+1],st[gt++]=P[mt+2]),ct&&(lt[yt++]=1,yt+=1);var bt=M(it,y,v);y.st&&(bt.attributes.st=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:ut})),p&&(bt.attributes.extrudeDirection=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:st})),U&&(bt.attributes.applyOffset=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:lt}));var _t,At,wt,xt,Ct=c.IndexDatatype.createTypedArray(ot,6*at);C=it.length/3;var Rt=0;for(s=0;s<C-1;s+=2){_t=s,xt=(_t+2)%C;var Et=e.Cartesian3.fromArray(it,3*_t,D),Ft=e.Cartesian3.fromArray(it,3*xt,L);e.Cartesian3.equalsEpsilon(Et,Ft,o.CesiumMath.EPSILON10)||(At=(_t+1)%C,wt=(At+2)%C,Ct[Rt++]=_t,Ct[Rt++]=At,Ct[Rt++]=xt,Ct[Rt++]=xt,Ct[Rt++]=At,Ct[Rt++]=wt)}return bt.indices=Ct,bt=u.GeometryPipeline.combineInstances([new l.GeometryInstance({geometry:w}),new l.GeometryInstance({geometry:bt})]),bt[0]}var I=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],H=new e.Cartographic,z=new e.Cartographic;function B(t,a,r,n,o){if(0===r)return e.Rectangle.clone(t,o);var i=p.RectangleGeometryLibrary.computeOptions(t,a,r,0,R,H),s=i.height,l=i.width,u=I;return p.RectangleGeometryLibrary.computePosition(i,n,!1,0,0,u[0]),p.RectangleGeometryLibrary.computePosition(i,n,!1,0,l-1,u[1]),p.RectangleGeometryLibrary.computePosition(i,n,!1,s-1,0,u[2]),p.RectangleGeometryLibrary.computePosition(i,n,!1,s-1,l-1,u[3]),e.Rectangle.fromCartesianArray(u,n,o)}function U(a){a=t.defaultValue(a,t.defaultValue.EMPTY_OBJECT);var r=a.rectangle;if(n.Check.typeOf.object("rectangle",r),e.Rectangle.validate(r),r.north<r.south)throw new n.DeveloperError("options.rectangle.north must be greater than or equal to options.rectangle.south");var i=t.defaultValue(a.height,0),s=t.defaultValue(a.extrudedHeight,i);this._rectangle=e.Rectangle.clone(r),this._granularity=t.defaultValue(a.granularity,o.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.Ellipsoid.clone(t.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84)),this._surfaceHeight=Math.max(i,s),this._rotation=t.defaultValue(a.rotation,0),this._stRotation=t.defaultValue(a.stRotation,0),this._vertexFormat=d.VertexFormat.clone(t.defaultValue(a.vertexFormat,d.VertexFormat.DEFAULT)),this._extrudedHeight=Math.min(i,s),this._shadowVolume=t.defaultValue(a.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=a.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}U.packedLength=e.Rectangle.packedLength+e.Ellipsoid.packedLength+d.VertexFormat.packedLength+7,U.pack=function(a,r,o){return n.Check.typeOf.object("value",a),n.Check.defined("array",r),o=t.defaultValue(o,0),e.Rectangle.pack(a._rectangle,r,o),o+=e.Rectangle.packedLength,e.Ellipsoid.pack(a._ellipsoid,r,o),o+=e.Ellipsoid.packedLength,d.VertexFormat.pack(a._vertexFormat,r,o),o+=d.VertexFormat.packedLength,r[o++]=a._granularity,r[o++]=a._surfaceHeight,r[o++]=a._rotation,r[o++]=a._stRotation,r[o++]=a._extrudedHeight,r[o++]=a._shadowVolume?1:0,r[o]=t.defaultValue(a._offsetAttribute,-1),r};var q=new e.Rectangle,Y=e.Ellipsoid.clone(e.Ellipsoid.UNIT_SPHERE),j={rectangle:q,ellipsoid:Y,vertexFormat:k,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};U.unpack=function(a,r,o){n.Check.defined("array",a),r=t.defaultValue(r,0);var i=e.Rectangle.unpack(a,r,q);r+=e.Rectangle.packedLength;var s=e.Ellipsoid.unpack(a,r,Y);r+=e.Ellipsoid.packedLength;var l=d.VertexFormat.unpack(a,r,k);r+=d.VertexFormat.packedLength;var u=a[r++],c=a[r++],m=a[r++],p=a[r++],g=a[r++],y=1===a[r++],f=a[r];return t.defined(o)?(o._rectangle=e.Rectangle.clone(i,o._rectangle),o._ellipsoid=e.Ellipsoid.clone(s,o._ellipsoid),o._vertexFormat=d.VertexFormat.clone(l,o._vertexFormat),o._granularity=u,o._surfaceHeight=c,o._rotation=m,o._stRotation=p,o._extrudedHeight=g,o._shadowVolume=y,o._offsetAttribute=-1===f?void 0:f,o):(j.granularity=u,j.height=c,j.rotation=m,j.stRotation=p,j.extrudedHeight=g,j.shadowVolume=y,j.offsetAttribute=-1===f?void 0:f,new U(j))},U.computeRectangle=function(a,r){a=t.defaultValue(a,t.defaultValue.EMPTY_OBJECT);var i=a.rectangle;if(n.Check.typeOf.object("rectangle",i),e.Rectangle.validate(i),i.north<i.south)throw new n.DeveloperError("options.rectangle.north must be greater than or equal to options.rectangle.south");var s=t.defaultValue(a.granularity,o.CesiumMath.RADIANS_PER_DEGREE),l=t.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84),u=t.defaultValue(a.rotation,0);return B(i,s,u,l,r)};var X=new e.Matrix3,Q=new r.Quaternion,W=new e.Cartographic;U.createGeometry=function(n){if(!o.CesiumMath.equalsEpsilon(n._rectangle.north,n._rectangle.south,o.CesiumMath.EPSILON10)&&!o.CesiumMath.equalsEpsilon(n._rectangle.east,n._rectangle.west,o.CesiumMath.EPSILON10)){var s=n._rectangle,l=n._ellipsoid,u=n._rotation,c=n._stRotation,d=n._vertexFormat,g=p.RectangleGeometryLibrary.computeOptions(s,n._granularity,u,c,R,H,z),y=X;if(0!==c||0!==u){var f=e.Rectangle.center(s,W),h=l.geodeticSurfaceNormalCartographic(f,D);r.Quaternion.fromAxisAngle(h,-c,Q),e.Matrix3.fromQuaternion(Q,y)}else e.Matrix3.clone(e.Matrix3.IDENTITY,y);var v,b,_=n._surfaceHeight,A=n._extrudedHeight,w=!o.CesiumMath.equalsEpsilon(_,A,0,o.CesiumMath.EPSILON2);if(g.lonScalar=1/n._rectangle.width,g.latScalar=1/n._rectangle.height,g.tangentRotationMatrix=y,s=n._rectangle,w){v=S(n,g);var x=r.BoundingSphere.fromRectangle3D(s,l,_,G),C=r.BoundingSphere.fromRectangle3D(s,l,A,F);b=r.BoundingSphere.union(x,C)}else{if(v=O(n,g),v.attributes.position.values=m.PolygonPipeline.scaleToGeodeticHeight(v.attributes.position.values,_,l,!1),t.defined(n._offsetAttribute)){var E=v.attributes.position.values.length,P=new Uint8Array(E/3),V=n._offsetAttribute===a.GeometryOffsetAttribute.NONE?0:1;a.arrayFill(P,V),v.attributes.applyOffset=new i.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:P})}b=r.BoundingSphere.fromRectangle3D(s,l,_)}return d.position||delete v.attributes.position,new i.Geometry({attributes:v.attributes,indices:v.indices,primitiveType:v.primitiveType,boundingSphere:b,offsetAttribute:n._offsetAttribute})}},U.createShadowVolume=function(t,e,a){var r=t._granularity,n=t._ellipsoid,o=e(r,n),i=a(r,n);return new U({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:r,extrudedHeight:i,height:o,vertexFormat:d.VertexFormat.POSITION_ONLY,shadowVolume:!0})};var J=new e.Rectangle,Z=[new e.Cartesian2,new e.Cartesian2,new e.Cartesian2],K=new e.Matrix2,$=new e.Cartographic;function tt(t){if(0===t._stRotation)return[0,0,0,1,1,0];var a=e.Rectangle.clone(t._rectangle,J),r=t._granularity,n=t._ellipsoid,o=t._rotation-t._stRotation,i=B(a,r,o,n,J),s=Z;s[0].x=i.west,s[0].y=i.south,s[1].x=i.west,s[1].y=i.north,s[2].x=i.east,s[2].y=i.south;for(var l=t.rectangle,u=e.Matrix2.fromRotation(t._stRotation,K),c=e.Rectangle.center(l,$),m=0;m<3;++m){var p=s[m];p.x-=c.longitude,p.y-=c.latitude,e.Matrix2.multiplyByVector(u,p,p),p.x+=c.longitude,p.y+=c.latitude,p.x=(p.x-l.west)/l.width,p.y=(p.y-l.south)/l.height}var d=s[0],g=s[1],y=s[2],f=new Array(6);return e.Cartesian2.pack(d,f),e.Cartesian2.pack(g,f,2),e.Cartesian2.pack(y,f,4),f}function et(a,r){return t.defined(r)&&(a=U.unpack(a,r)),a._ellipsoid=e.Ellipsoid.clone(a._ellipsoid),a._rectangle=e.Rectangle.clone(a._rectangle),U.createGeometry(a)}return Object.defineProperties(U.prototype,{rectangle:{get:function(){return t.defined(this._rotatedRectangle)||(this._rotatedRectangle=B(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return t.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=tt(this)),this._textureCoordinateRotationPoints}}}),et}));