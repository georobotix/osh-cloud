define(["./AxisAlignedBoundingBox-b0cd1e39","./Matrix2-92b7fb9d","./when-8166c7dd","./TerrainEncoding-315b224c","./IndexDatatype-797210ca","./ComponentDatatype-9ed50558","./RuntimeError-4fdc4459","./Transforms-62a339c3","./WebMercatorProjection-6ac42c0a","./createTaskProcessorWorker","./AttributeCompression-212262a3","./WebGLConstants-0664004c","./combine-a5c4cc47"],(function(e,t,r,i,n,o,a,s,h,c,d,u,I){"use strict";function l(){a.DeveloperError.throwInstantiationError()}Object.defineProperties(l.prototype,{errorEvent:{get:a.DeveloperError.throwInstantiationError},credit:{get:a.DeveloperError.throwInstantiationError},tilingScheme:{get:a.DeveloperError.throwInstantiationError},ready:{get:a.DeveloperError.throwInstantiationError},readyPromise:{get:a.DeveloperError.throwInstantiationError},hasWaterMask:{get:a.DeveloperError.throwInstantiationError},hasVertexNormals:{get:a.DeveloperError.throwInstantiationError},availability:{get:a.DeveloperError.throwInstantiationError}});var m=[];l.getRegularGridIndices=function(e,t){if(e*t>=o.CesiumMath.FOUR_GIGABYTES)throw new a.DeveloperError("The total number of vertices (width * height) must be less than 4,294,967,296.");var i=m[e];r.defined(i)||(m[e]=i=[]);var n=i[t];return r.defined(n)||(n=e*t<o.CesiumMath.SIXTY_FOUR_KILOBYTES?i[t]=new Uint16Array((e-1)*(t-1)*6):i[t]=new Uint32Array((e-1)*(t-1)*6),E(e,t,n,0)),n};var g=[];l.getRegularGridIndicesAndEdgeIndices=function(e,t){if(e*t>=o.CesiumMath.FOUR_GIGABYTES)throw new a.DeveloperError("The total number of vertices (width * height) must be less than 4,294,967,296.");var i=g[e];r.defined(i)||(g[e]=i=[]);var n=i[t];if(!r.defined(n)){var s=l.getRegularGridIndices(e,t),h=v(e,t),c=h.westIndicesSouthToNorth,d=h.southIndicesEastToWest,u=h.eastIndicesNorthToSouth,I=h.northIndicesWestToEast;n=i[t]={indices:s,westIndicesSouthToNorth:c,southIndicesEastToWest:d,eastIndicesNorthToSouth:u,northIndicesWestToEast:I}}return n};var T=[];function v(e,t){var r,i=new Array(t),n=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,n[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,i[r]=(t-r-1)*e;return{westIndicesSouthToNorth:i,southIndicesEastToWest:n,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function E(e,t,r,i){for(var n=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=n,h=s+e,c=h+1,d=s+1;r[i++]=s,r[i++]=h,r[i++]=d,r[i++]=d,r[i++]=h,r[i++]=c,++n}++n}}function f(e,t,r,i){for(var n=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[i++]=n,r[i++]=s,r[i++]=t,r[i++]=t,r[i++]=s,r[i++]=t+1,n=s,++t}return i}l.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){if(e*t>=o.CesiumMath.FOUR_GIGABYTES)throw new a.DeveloperError("The total number of vertices (width * height) must be less than 4,294,967,296.");var i=T[e];r.defined(i)||(T[e]=i=[]);var s=i[t];if(!r.defined(s)){var h=e*t,c=(e-1)*(t-1)*6,d=2*e+2*t,u=6*Math.max(0,d-4),I=h+d,m=c+u,g=v(e,t),f=g.westIndicesSouthToNorth,p=g.southIndicesEastToWest,w=g.eastIndicesNorthToSouth,y=g.northIndicesWestToEast,N=n.IndexDatatype.createTypedArray(I,m);E(e,t,N,0),l.addSkirtIndices(f,p,w,y,h,N,c),s=i[t]={indices:N,westIndicesSouthToNorth:f,southIndicesEastToWest:p,eastIndicesNorthToSouth:w,northIndicesWestToEast:y,indexCountWithoutSkirts:c}}return s},l.addSkirtIndices=function(e,t,r,i,n,o,a){var s=n;a=f(e,s,o,a),s+=e.length,a=f(t,s,o,a),s+=t.length,a=f(r,s,o,a),s+=r.length,f(i,s,o,a)},l.heightmapTerrainQuality=.25,l.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*l.heightmapTerrainQuality/(t*r)},l.prototype.requestTileGeometry=a.DeveloperError.throwInstantiationError,l.prototype.getLevelMaximumGeometricError=a.DeveloperError.throwInstantiationError,l.prototype.getTileDataAvailable=a.DeveloperError.throwInstantiationError,l.prototype.loadTileDataAvailability=a.DeveloperError.throwInstantiationError;var p=32767,w=new t.Cartesian3,y=new t.Cartesian3,N=new t.Cartesian3,S=new t.Cartographic,b=new t.Cartesian2;function M(a,c){var d,u,I=a.quantizedVertices,m=I.length/3,g=a.octEncodedNormals,T=a.westIndices.length+a.eastIndices.length+a.southIndices.length+a.northIndices.length,v=a.includeWebMercatorT,E=a.exaggeration,f=a.exaggerationRelativeHeight,M=1!==E,W=M,D=t.Rectangle.clone(a.rectangle),P=D.west,G=D.south,F=D.east,_=D.north,k=t.Ellipsoid.clone(a.ellipsoid),Y=a.minimumHeight,H=a.maximumHeight,O=a.relativeToCenter,B=s.Transforms.eastNorthUpToFixedFrame(O,k),V=t.Matrix4.inverseTransformation(B,new t.Matrix4);v&&(d=h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(G),u=1/(h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(_)-d));var R=I.subarray(0,m),L=I.subarray(m,2*m),U=I.subarray(2*m,3*m),j=r.defined(g),z=new Array(m),q=new Array(m),Q=new Array(m),K=v?new Array(m):[],X=W?new Array(m):[],Z=y;Z.x=Number.POSITIVE_INFINITY,Z.y=Number.POSITIVE_INFINITY,Z.z=Number.POSITIVE_INFINITY;var J=N;J.x=Number.NEGATIVE_INFINITY,J.y=Number.NEGATIVE_INFINITY,J.z=Number.NEGATIVE_INFINITY;for(var $=Number.POSITIVE_INFINITY,ee=Number.NEGATIVE_INFINITY,te=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,ie=0;ie<m;++ie){var ne=R[ie],oe=L[ie],ae=ne/p,se=oe/p,he=o.CesiumMath.lerp(Y,H,U[ie]/p);S.longitude=o.CesiumMath.lerp(P,F,ae),S.latitude=o.CesiumMath.lerp(G,_,se),S.height=he,$=Math.min(S.longitude,$),ee=Math.max(S.longitude,ee),te=Math.min(S.latitude,te),re=Math.max(S.latitude,re);var ce=k.cartographicToCartesian(S);z[ie]=new t.Cartesian2(ae,se),q[ie]=he,Q[ie]=ce,v&&(K[ie]=(h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(S.latitude)-d)*u),W&&(X[ie]=k.geodeticSurfaceNormal(ce)),t.Matrix4.multiplyByPoint(V,ce,w),t.Cartesian3.minimumByComponent(w,Z,Z),t.Cartesian3.maximumByComponent(w,J,J)}var de,ue=C(a.westIndices,(function(e,t){return z[e].y-z[t].y})),Ie=C(a.eastIndices,(function(e,t){return z[t].y-z[e].y})),le=C(a.southIndices,(function(e,t){return z[t].x-z[e].x})),me=C(a.northIndices,(function(e,t){return z[e].x-z[t].x}));if(Y<0){var ge=new i.EllipsoidalOccluder(k);de=ge.computeHorizonCullingPointPossiblyUnderEllipsoid(O,Q,Y)}var Te=Y;Te=Math.min(Te,x(a.westIndices,a.westSkirtHeight,q,z,D,k,V,Z,J)),Te=Math.min(Te,x(a.southIndices,a.southSkirtHeight,q,z,D,k,V,Z,J)),Te=Math.min(Te,x(a.eastIndices,a.eastSkirtHeight,q,z,D,k,V,Z,J)),Te=Math.min(Te,x(a.northIndices,a.northSkirtHeight,q,z,D,k,V,Z,J));for(var ve=new e.AxisAlignedBoundingBox(Z,J,O),Ee=new i.TerrainEncoding(O,ve,Te,H,B,j,v,W,E,f),fe=Ee.stride,pe=m*fe+T*fe,we=new Float32Array(pe),ye=0,Ne=0;Ne<m;++Ne){if(j){var Se=2*Ne;b.x=g[Se],b.y=g[Se+1]}ye=Ee.encode(we,ye,Q[Ne],z[Ne],q[Ne],b,K[Ne],X[Ne])}var be=Math.max(0,2*(T-4)),Me=a.indices.length+3*be,xe=n.IndexDatatype.createTypedArray(m+T,Me);xe.set(a.indices,0);var Ae=1e-4,Ce=(ee-$)*Ae,We=(re-te)*Ae,De=-Ce,Pe=0,Ge=Ce,Fe=0,_e=0,ke=We,Ye=0,He=-We,Oe=m*fe;return A(we,Oe,ue,Ee,q,z,g,k,D,a.westSkirtHeight,d,u,De,Pe),Oe+=a.westIndices.length*fe,A(we,Oe,le,Ee,q,z,g,k,D,a.southSkirtHeight,d,u,Ye,He),Oe+=a.southIndices.length*fe,A(we,Oe,Ie,Ee,q,z,g,k,D,a.eastSkirtHeight,d,u,Ge,Fe),Oe+=a.eastIndices.length*fe,A(we,Oe,me,Ee,q,z,g,k,D,a.northSkirtHeight,d,u,_e,ke),l.addSkirtIndices(ue,le,Ie,me,m,xe,a.indices.length),c.push(we.buffer,xe.buffer),{vertices:we.buffer,indices:xe.buffer,westIndicesSouthToNorth:ue,southIndicesEastToWest:le,eastIndicesNorthToSouth:Ie,northIndicesWestToEast:me,vertexStride:fe,center:O,minimumHeight:Y,maximumHeight:H,occludeePointInScaledSpace:de,encoding:Ee,indexCountWithoutSkirts:a.indices.length}}function x(e,r,i,n,a,s,h,c,d){var u=Number.POSITIVE_INFINITY,I=a.north,l=a.south,m=a.east,g=a.west;m<g&&(m+=o.CesiumMath.TWO_PI);for(var T=e.length,v=0;v<T;++v){var E=e[v],f=i[E],p=n[E];S.longitude=o.CesiumMath.lerp(g,m,p.x),S.latitude=o.CesiumMath.lerp(l,I,p.y),S.height=f-r;var y=s.cartographicToCartesian(S,w);t.Matrix4.multiplyByPoint(h,y,y),t.Cartesian3.minimumByComponent(y,c,c),t.Cartesian3.maximumByComponent(y,d,d),u=Math.min(u,S.height)}return u}function A(e,t,i,n,a,s,c,d,u,I,l,m,g,T){var v=r.defined(c),E=u.north,f=u.south,p=u.east,y=u.west;p<y&&(p+=o.CesiumMath.TWO_PI);for(var N=i.length,M=0;M<N;++M){var x=i[M],A=a[x],C=s[x];S.longitude=o.CesiumMath.lerp(y,p,C.x)+g,S.latitude=o.CesiumMath.lerp(f,E,C.y)+T,S.height=A-I;var W,D,P=d.cartographicToCartesian(S,w);if(v){var G=2*x;b.x=c[G],b.y=c[G+1]}n.hasWebMercatorT&&(W=(h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(S.latitude)-l)*m),n.hasGeodeticSurfaceNormals&&(D=d.geodeticSurfaceNormal(P)),t=n.encode(e,t,P,C,S.height,b,W,D)}}function C(e,t){var i;return"function"===typeof e.slice&&(i=e.slice(),"function"!==typeof i.sort&&(i=void 0)),r.defined(i)||(i=Array.prototype.slice.call(e)),i.sort(t),i}var W=c(M);return W}));