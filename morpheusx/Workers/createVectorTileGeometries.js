define(["./Transforms-62a339c3","./BoxGeometry-cbf2d438","./Matrix2-92b7fb9d","./Color-0181dacd","./CylinderGeometry-619912a5","./when-8166c7dd","./EllipsoidGeometry-59867814","./IndexDatatype-797210ca","./createTaskProcessorWorker","./RuntimeError-4fdc4459","./ComponentDatatype-9ed50558","./WebGLConstants-0664004c","./combine-a5c4cc47","./GeometryOffsetAttribute-e8e698d7","./GeometryAttribute-6f4c3b93","./GeometryAttributes-50becc99","./VertexFormat-c0801687","./CylinderGeometryLibrary-5924d4e5"],(function(e,t,n,r,a,i,o,d,s,c,f,l,u,h,p,b,y,x){"use strict";function v(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var g=new n.Cartesian3,m=n.Matrix4.packedLength+n.Cartesian3.packedLength,C=n.Matrix4.packedLength+2,I=n.Matrix4.packedLength+n.Cartesian3.packedLength,k=n.Cartesian3.packedLength+1,M={modelMatrix:new n.Matrix4,boundingVolume:new e.BoundingSphere};function B(e,t){var r=t*m,a=n.Cartesian3.unpack(e,r,g);r+=n.Cartesian3.packedLength;var i=n.Matrix4.unpack(e,r,M.modelMatrix);n.Matrix4.multiplyByScale(i,a,i);var o=M.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,o.center),o.radius=Math.sqrt(3),M}function w(e,t){var r=t*C,a=e[r++],i=e[r++],o=n.Cartesian3.fromElements(a,a,i,g),d=n.Matrix4.unpack(e,r,M.modelMatrix);n.Matrix4.multiplyByScale(d,o,d);var s=M.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,s.center),s.radius=Math.sqrt(2),M}function A(e,t){var r=t*I,a=n.Cartesian3.unpack(e,r,g);r+=n.Cartesian3.packedLength;var i=n.Matrix4.unpack(e,r,M.modelMatrix);n.Matrix4.multiplyByScale(i,a,i);var o=M.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,o.center),o.radius=1,M}function O(e,t){var r=t*k,a=e[r++],i=n.Cartesian3.unpack(e,r,g),o=n.Matrix4.fromTranslation(i,M.modelMatrix);n.Matrix4.multiplyByUniformScale(o,a,o);var d=M.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,d.center),d.radius=1,M}var L=new n.Cartesian3;function E(t,a,o,d,s){if(i.defined(a)){for(var c=o.length,f=d.attributes.position.values,l=d.indices,u=t.positions,h=t.vertexBatchIds,p=t.indices,b=t.batchIds,y=t.batchTableColors,x=t.batchedIndices,g=t.indexOffsets,m=t.indexCounts,C=t.boundingVolumes,I=t.modelMatrix,k=t.center,M=t.positionOffset,B=t.batchIdIndex,w=t.indexOffset,A=t.batchedIndicesOffset,O=0;O<c;++O){var E=s(a,O),U=E.modelMatrix;n.Matrix4.multiply(I,U,U);for(var G=o[O],S=f.length,T=0;T<S;T+=3){var V=n.Cartesian3.unpack(f,T,L);n.Matrix4.multiplyByPoint(U,V,V),n.Cartesian3.subtract(V,k,V),n.Cartesian3.pack(V,u,3*M+T),h[B++]=G}for(var F=l.length,R=0;R<F;++R)p[w+R]=l[R]+M;var Z=O+A;x[Z]=new v({offset:w,count:F,color:r.Color.fromRgba(y[G]),batchIds:[G]}),b[Z]=G,g[Z]=w,m[Z]=F,C[Z]=e.BoundingSphere.transform(E.boundingVolume,U),M+=S/3,w+=F}t.positionOffset=M,t.batchIdIndex=B,t.indexOffset=w,t.batchedIndicesOffset+=c}}var U=new n.Cartesian3,G=new n.Matrix4;function S(e){var t=new Float64Array(e),r=0;n.Cartesian3.unpack(t,r,U),r+=n.Cartesian3.packedLength,n.Matrix4.unpack(t,r,G)}function T(e){for(var t=e.length,n=0,a=0;a<t;++a)n+=r.Color.packedLength+3+e[a].batchIds.length;return n}function V(t,n,a){var i=a.length,o=2+i*e.BoundingSphere.packedLength+1+T(n),d=new Float64Array(o),s=0;d[s++]=t,d[s++]=i;for(var c=0;c<i;++c)e.BoundingSphere.pack(a[c],d,s),s+=e.BoundingSphere.packedLength;var f=n.length;d[s++]=f;for(var l=0;l<f;++l){var u=n[l];r.Color.pack(u.color,d,s),s+=r.Color.packedLength,d[s++]=u.offset,d[s++]=u.count;var h=u.batchIds,p=h.length;d[s++]=p;for(var b=0;b<p;++b)d[s++]=h[b]}return d}function F(e,n){var r=i.defined(e.boxes)?new Float32Array(e.boxes):void 0,s=i.defined(e.boxBatchIds)?new Uint16Array(e.boxBatchIds):void 0,c=i.defined(e.cylinders)?new Float32Array(e.cylinders):void 0,f=i.defined(e.cylinderBatchIds)?new Uint16Array(e.cylinderBatchIds):void 0,l=i.defined(e.ellipsoids)?new Float32Array(e.ellipsoids):void 0,u=i.defined(e.ellipsoidBatchIds)?new Uint16Array(e.ellipsoidBatchIds):void 0,h=i.defined(e.spheres)?new Float32Array(e.spheres):void 0,p=i.defined(e.sphereBatchIds)?new Uint16Array(e.sphereBatchIds):void 0,b=i.defined(r)?s.length:0,y=i.defined(c)?f.length:0,x=i.defined(l)?u.length:0,v=i.defined(h)?p.length:0,g=t.BoxGeometry.getUnitBox(),m=a.CylinderGeometry.getUnitCylinder(),C=o.EllipsoidGeometry.getUnitEllipsoid(),I=g.attributes.position.values,k=m.attributes.position.values,M=C.attributes.position.values,L=I.length*b;L+=k.length*y,L+=M.length*(x+v);var T=g.indices,F=m.indices,R=C.indices,Z=T.length*b;Z+=F.length*y,Z+=R.length*(x+v);var D=new Float32Array(L),P=new Uint16Array(L/3),q=d.IndexDatatype.createTypedArray(L/3,Z),W=b+y+x+v,_=new Uint16Array(W),N=new Array(W),Y=new Uint32Array(W),j=new Uint32Array(W),z=new Array(W);S(e.packedBuffer);var H={batchTableColors:new Uint32Array(e.batchTableColors),positions:D,vertexBatchIds:P,indices:q,batchIds:_,batchedIndices:N,indexOffsets:Y,indexCounts:j,boundingVolumes:z,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:G,center:U};E(H,r,s,g,B),E(H,c,f,m,w),E(H,l,u,C,A),E(H,h,p,C,O);var J=V(q.BYTES_PER_ELEMENT,N,z);return n.push(D.buffer,P.buffer,q.buffer),n.push(_.buffer,Y.buffer,j.buffer),n.push(J.buffer),{positions:D.buffer,vertexBatchIds:P.buffer,indices:q.buffer,indexOffsets:Y.buffer,indexCounts:j.buffer,batchIds:_.buffer,packedBuffer:J.buffer}}var R=s(F);return R}));