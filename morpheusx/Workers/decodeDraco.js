define(["./ComponentDatatype-9ed50558","./when-8166c7dd","./IndexDatatype-797210ca","./RuntimeError-4fdc4459","./createTaskProcessorWorker","./WebGLConstants-0664004c"],(function(e,r,t,n,a,o){"use strict";var i;function u(e,r){for(var n=e.num_points(),a=e.num_faces(),o=new i.DracoInt32Array,u=3*a,s=t.IndexDatatype.createTypedArray(n,u),d=0,c=0;c<a;++c)r.GetFaceFromMesh(e,c,o),s[d+0]=o.GetValue(0),s[d+1]=o.GetValue(1),s[d+2]=o.GetValue(2),d+=3;return i.destroy(o),{typedArray:s,numberOfIndices:u}}function s(e,r,t,n,a){var o,u;n.quantizationBits<=8?(u=new i.DracoUInt8Array,o=new Uint8Array(a),r.GetAttributeUInt8ForAllPoints(e,t,u)):(u=new i.DracoUInt16Array,o=new Uint16Array(a),r.GetAttributeUInt16ForAllPoints(e,t,u));for(var s=0;s<a;++s)o[s]=u.GetValue(s);return i.destroy(u),o}function d(e,r,t,n){var a,o;switch(t.data_type()){case 1:case 11:o=new i.DracoInt8Array,a=new Int8Array(n),r.GetAttributeInt8ForAllPoints(e,t,o);break;case 2:o=new i.DracoUInt8Array,a=new Uint8Array(n),r.GetAttributeUInt8ForAllPoints(e,t,o);break;case 3:o=new i.DracoInt16Array,a=new Int16Array(n),r.GetAttributeInt16ForAllPoints(e,t,o);break;case 4:o=new i.DracoUInt16Array,a=new Uint16Array(n),r.GetAttributeUInt16ForAllPoints(e,t,o);break;case 5:case 7:o=new i.DracoInt32Array,a=new Int32Array(n),r.GetAttributeInt32ForAllPoints(e,t,o);break;case 6:case 8:o=new i.DracoUInt32Array,a=new Uint32Array(n),r.GetAttributeUInt32ForAllPoints(e,t,o);break;case 9:case 10:o=new i.DracoFloat32Array,a=new Float32Array(n),r.GetAttributeFloatForAllPoints(e,t,o);break}for(var u=0;u<n;++u)a[u]=o.GetValue(u);return i.destroy(o),a}function c(t,n,a){var o,u=t.num_points(),c=a.num_components(),f=new i.AttributeQuantizationTransform;if(f.InitFromAttribute(a)){for(var y=new Array(c),A=0;A<c;++A)y[A]=f.min_value(A);o={quantizationBits:f.quantization_bits(),minValues:y,range:f.range(),octEncoded:!1}}i.destroy(f),f=new i.AttributeOctahedronTransform,f.InitFromAttribute(a)&&(o={quantizationBits:f.quantization_bits(),octEncoded:!0}),i.destroy(f);var m,w=u*c;m=r.defined(o)?s(t,n,a,o,w):d(t,n,a,w);var b=e.ComponentDatatype.fromTypedArray(m);return{array:m,data:{componentsPerAttribute:c,componentDatatype:b,byteOffset:a.byte_offset(),byteStride:e.ComponentDatatype.getSizeInBytes(b)*c,normalized:a.normalized(),quantization:o}}}function f(e){var r=new i.Decoder;e.dequantizeInShader&&(r.SkipAttributeTransform(i.POSITION),r.SkipAttributeTransform(i.NORMAL));var t=new i.DecoderBuffer;t.Init(e.buffer,e.buffer.length);var a=r.GetEncodedGeometryType(t);if(a!==i.POINT_CLOUD)throw new n.RuntimeError("Draco geometry type must be POINT_CLOUD.");var o=new i.PointCloud,u=r.DecodeBufferToPointCloud(t,o);if(!u.ok()||0===o.ptr)throw new n.RuntimeError("Error decoding draco point cloud: "+u.error_msg());i.destroy(t);var s={},d=e.properties;for(var f in d)if(d.hasOwnProperty(f)){var y=d[f],A=r.GetAttributeByUniqueId(o,y);s[f]=c(o,r,A)}return i.destroy(o),i.destroy(r),s}function y(e){var r=new i.Decoder,t=["POSITION","NORMAL","COLOR","TEX_COORD"];if(e.dequantizeInShader)for(var a=0;a<t.length;++a)r.SkipAttributeTransform(i[t[a]]);var o=e.bufferView,s=new i.DecoderBuffer;s.Init(e.array,o.byteLength);var d=r.GetEncodedGeometryType(s);if(d!==i.TRIANGULAR_MESH)throw new n.RuntimeError("Unsupported draco mesh geometry type.");var f=new i.Mesh,y=r.DecodeBufferToMesh(s,f);if(!y.ok()||0===f.ptr)throw new n.RuntimeError("Error decoding draco mesh geometry: "+y.error_msg());i.destroy(s);var A={},m=e.compressedAttributes;for(var w in m)if(m.hasOwnProperty(w)){var b=m[w],l=r.GetAttributeByUniqueId(f,b);A[w]=c(f,r,l)}var I={indexArray:u(f,r),attributeData:A};return i.destroy(f),i.destroy(r),I}function A(e){return r.defined(e.bufferView)?y(e):f(e)}function m(e){i=e,self.onmessage=a(A),self.postMessage(!0)}function w(e){var t=e.data,n=t.webAssemblyConfig;if(r.defined(n))return require([n.modulePath],(function(e){r.defined(n.wasmBinaryFile)?(r.defined(e)||(e=self.DracoDecoderModule),e(n).then((function(e){m(e)}))):m(e())}))}return w}));