define(["exports","./Matrix2-92b7fb9d","./when-8166c7dd","./RuntimeError-4fdc4459","./EllipsoidGeodesic-133bd147","./EllipsoidRhumbLine-51654311","./IntersectionTests-4f28a69c","./ComponentDatatype-9ed50558","./Plane-049255eb"],(function(a,e,r,i,t,n,o,s,c){"use strict";var l={numberOfPoints:function(a,r,i){var t=e.Cartesian3.distance(a,r);return Math.ceil(t/i)},numberOfPointsRhumbLine:function(a,e,r){var i=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(i/(r*r))))}},u=new e.Cartographic;l.extractHeights=function(a,e){for(var r=a.length,i=new Array(r),t=0;t<r;t++){var n=a[t];i[t]=e.cartesianToCartographic(n,u).height}return i};var h=new e.Matrix4,f=new e.Cartesian3,p=new e.Cartesian3,d=new c.Plane(e.Cartesian3.UNIT_X,0),g=new e.Cartesian3,C=new c.Plane(e.Cartesian3.UNIT_X,0),v=new e.Cartesian3,m=new e.Cartesian3,w=[];function P(a,e,r){var i,t=w;if(t.length=a,e===r){for(i=0;i<a;i++)t[i]=e;return t}var n=r-e,o=n/a;for(i=0;i<a;i++){var s=e+i*o;t[i]=s}return t}var T=new e.Cartographic,y=new e.Cartographic,E=new e.Cartesian3,A=new e.Cartesian3,b=new e.Cartesian3,R=new t.EllipsoidGeodesic,D=new n.EllipsoidRhumbLine;function M(a,r,i,t,n,o,s,c){var u=t.scaleToGeodeticSurface(a,A),h=t.scaleToGeodeticSurface(r,b),f=l.numberOfPoints(a,r,i),p=t.cartesianToCartographic(u,T),d=t.cartesianToCartographic(h,y),g=P(f,n,o);R.setEndPoints(p,d);var C=R.surfaceDistance/f,v=c;p.height=n;var m=t.cartographicToCartesian(p,E);e.Cartesian3.pack(m,s,v),v+=3;for(var w=1;w<f;w++){var D=R.interpolateUsingSurfaceDistance(w*C,y);D.height=g[w],m=t.cartographicToCartesian(D,E),e.Cartesian3.pack(m,s,v),v+=3}return v}function S(a,r,i,t,o,s,c,u){var h=t.cartesianToCartographic(a,T),f=t.cartesianToCartographic(r,y),p=l.numberOfPointsRhumbLine(h,f,i);h.height=0,f.height=0;var d=P(p,o,s);D.ellipsoid.equals(t)||(D=new n.EllipsoidRhumbLine(void 0,void 0,t)),D.setEndPoints(h,f);var g=D.surfaceDistance/p,C=u;h.height=o;var v=t.cartographicToCartesian(h,E);e.Cartesian3.pack(v,c,C),C+=3;for(var m=1;m<p;m++){var w=D.interpolateUsingSurfaceDistance(m*g,y);w.height=d[m],v=t.cartographicToCartesian(w,E),e.Cartesian3.pack(v,c,C),C+=3}return C}l.wrapLongitude=function(a,i){var t=[],n=[];if(r.defined(a)&&a.length>0){i=r.defaultValue(i,e.Matrix4.IDENTITY);var s=e.Matrix4.inverseTransformation(i,h),l=e.Matrix4.multiplyByPoint(s,e.Cartesian3.ZERO,f),u=e.Cartesian3.normalize(e.Matrix4.multiplyByPointAsVector(s,e.Cartesian3.UNIT_Y,p),p),w=c.Plane.fromPointNormal(l,u,d),P=e.Cartesian3.normalize(e.Matrix4.multiplyByPointAsVector(s,e.Cartesian3.UNIT_X,g),g),T=c.Plane.fromPointNormal(l,P,C),y=1;t.push(e.Cartesian3.clone(a[0]));for(var E=t[0],A=a.length,b=1;b<A;++b){var R=a[b];if(c.Plane.getPointDistance(T,E)<0||c.Plane.getPointDistance(T,R)<0){var D=o.IntersectionTests.lineSegmentPlane(E,R,w,v);if(r.defined(D)){var M=e.Cartesian3.multiplyByScalar(u,5e-9,m);c.Plane.getPointDistance(w,E)<0&&e.Cartesian3.negate(M,M),t.push(e.Cartesian3.add(D,M,new e.Cartesian3)),n.push(y+1),e.Cartesian3.negate(M,M),t.push(e.Cartesian3.add(D,M,new e.Cartesian3)),y=1}}t.push(e.Cartesian3.clone(a[b])),y++,E=R}n.push(y)}return{positions:t,lengths:n}},l.generateArc=function(a){r.defined(a)||(a={});var t=a.positions;if(!r.defined(t))throw new i.DeveloperError("options.positions is required.");var n=t.length,o=r.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84),c=r.defaultValue(a.height,0),u=Array.isArray(c);if(n<1)return[];if(1===n){var h=o.scaleToGeodeticSurface(t[0],A);if(c=u?c[0]:c,0!==c){var f=o.geodeticSurfaceNormal(h,E);e.Cartesian3.multiplyByScalar(f,c,f),e.Cartesian3.add(h,f,h)}return[h.x,h.y,h.z]}var p=a.minDistance;if(!r.defined(p)){var d=r.defaultValue(a.granularity,s.CesiumMath.RADIANS_PER_DEGREE);p=s.CesiumMath.chordLength(d,o.maximumRadius)}var g,C=0;for(g=0;g<n-1;g++)C+=l.numberOfPoints(t[g],t[g+1],p);var v=3*(C+1),m=new Array(v),P=0;for(g=0;g<n-1;g++){var y=t[g],b=t[g+1],R=u?c[g]:c,D=u?c[g+1]:c;P=M(y,b,p,o,R,D,m,P)}w.length=0;var S=t[n-1],x=o.cartesianToCartographic(S,T);x.height=u?c[n-1]:c;var N=o.cartographicToCartesian(x,E);return e.Cartesian3.pack(N,m,v-3),m};var x=new e.Cartographic,N=new e.Cartographic;l.generateRhumbArc=function(a){r.defined(a)||(a={});var t=a.positions;if(!r.defined(t))throw new i.DeveloperError("options.positions is required.");var n=t.length,o=r.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84),c=r.defaultValue(a.height,0),u=Array.isArray(c);if(n<1)return[];if(1===n){var h=o.scaleToGeodeticSurface(t[0],A);if(c=u?c[0]:c,0!==c){var f=o.geodeticSurfaceNormal(h,E);e.Cartesian3.multiplyByScalar(f,c,f),e.Cartesian3.add(h,f,h)}return[h.x,h.y,h.z]}var p,d,g=r.defaultValue(a.granularity,s.CesiumMath.RADIANS_PER_DEGREE),C=0,v=o.cartesianToCartographic(t[0],x);for(p=0;p<n-1;p++)d=o.cartesianToCartographic(t[p+1],N),C+=l.numberOfPointsRhumbLine(v,d,g),v=e.Cartographic.clone(d,x);var m=3*(C+1),P=new Array(m),y=0;for(p=0;p<n-1;p++){var b=t[p],R=t[p+1],D=u?c[p]:c,M=u?c[p+1]:c;y=S(b,R,g,o,D,M,P,y)}w.length=0;var G=t[n-1],I=o.cartesianToCartographic(G,T);I.height=u?c[n-1]:c;var V=o.cartographicToCartesian(I,E);return e.Cartesian3.pack(V,P,m-3),P},l.generateCartesianArc=function(a){for(var r=l.generateArc(a),i=r.length/3,t=new Array(i),n=0;n<i;n++)t[n]=e.Cartesian3.unpack(r,3*n);return t},l.generateCartesianRhumbArc=function(a){for(var r=l.generateRhumbArc(a),i=r.length/3,t=new Array(i),n=0;n<i;n++)t[n]=e.Cartesian3.unpack(r,3*n);return t},a.PolylinePipeline=l}));