define(["exports","./Matrix2-92b7fb9d","./EllipsoidTangentPlane-5d8b4bd3","./ComponentDatatype-9ed50558","./PolylinePipeline-fd9260c9","./Transforms-62a339c3","./when-8166c7dd","./RuntimeError-4fdc4459"],(function(e,a,r,n,t,i,o,s){"use strict";var l={ROUNDED:0,MITERED:1,BEVELED:2},C=Object.freeze(l),c={};function u(e,a){if(!o.defined(e))throw new s.DeveloperError("identifier is required.");o.defined(c[e])||(c[e]=!0,console.warn(o.defaultValue(a,e)))}u.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",u.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",u.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",u.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var d=[new a.Cartesian3,new a.Cartesian3],g=new a.Cartesian3,y=new a.Cartesian3,f=new a.Cartesian3,h=new a.Cartesian3,m=new a.Cartesian3,p=new a.Cartesian3,w=new a.Cartesian3,v=new a.Cartesian3,x=new a.Cartesian3,E=new a.Cartesian3,P=new a.Cartesian3,b={},M=new a.Cartographic;function T(e,a){for(var r=new Array(e.length),n=0;n<e.length;n++){var t=e[n];M=a.cartesianToCartographic(t,M),r[n]=M.height,e[n]=a.scaleToGeodeticSurface(t,t)}return r}function B(e,r,n,t){var i,o=e[0],s=e[1],l=a.Cartesian3.angleBetween(o,s),C=Math.ceil(l/t),c=new Array(C);if(r===n){for(i=0;i<C;i++)c[i]=r;return c.push(n),c}var u=n-r,d=u/C;for(i=1;i<C;i++){var g=r+i*d;c[i]=g}return c[0]=r,c.push(n),c}var z=new a.Cartesian3,S=new a.Cartesian3;function A(e,n,t,i){var o=new r.EllipsoidTangentPlane(t,i),s=o.projectPointOntoPlane(a.Cartesian3.add(t,e,z),z),l=o.projectPointOntoPlane(a.Cartesian3.add(t,n,S),S),C=a.Cartesian2.angleBetween(s,l);return l.x*s.y-l.y*s.x>=0?-C:C}var D=new a.Cartesian3(-1,0,0),R=new a.Matrix4,O=new a.Matrix4,I=new a.Matrix3,V=a.Matrix3.IDENTITY.clone(),N=new a.Cartesian3,G=new a.Cartesian4,H=new a.Cartesian3;function L(e,r,n,t,o,s,l,C){var c=N,u=G;R=i.Transforms.eastNorthUpToFixedFrame(e,o,R),c=a.Matrix4.multiplyByPointAsVector(R,D,c),c=a.Cartesian3.normalize(c,c);var d=A(c,r,e,o);I=a.Matrix3.fromRotationZ(d,I),H.z=s,R=a.Matrix4.multiplyTransformation(R,a.Matrix4.fromRotationTranslation(I,H,O),R);var g=V;g[0]=l;for(var y=0;y<C;y++)for(var f=0;f<n.length;f+=3)u=a.Cartesian3.fromArray(n,f,u),u=a.Matrix3.multiplyByVector(g,u,u),u=a.Matrix4.multiplyByPoint(R,u,u),t.push(u.x,u.y,u.z);return t}var j=new a.Cartesian3;function q(e,r,n,t,i,o,s){for(var l=0;l<e.length;l+=3){var C=a.Cartesian3.fromArray(e,l,j);t=L(C,r,n,t,i,o[l/3],s,1)}return t}function Q(e,a){var r=e.length,n=new Array(6*r),t=0,i=a.x+a.width/2,o=a.y+a.height/2,s=e[0];n[t++]=s.x-i,n[t++]=0,n[t++]=s.y-o;for(var l=1;l<r;l++){s=e[l];var C=s.x-i,c=s.y-o;n[t++]=C,n[t++]=0,n[t++]=c,n[t++]=C,n[t++]=0,n[t++]=c}return s=e[0],n[t++]=s.x-i,n[t++]=0,n[t++]=s.y-o,n}function F(e,a){for(var r=e.length,n=new Array(3*r),t=0,i=a.x+a.width/2,o=a.y+a.height/2,s=0;s<r;s++)n[t++]=e[s].x-i,n[t++]=0,n[t++]=e[s].y-o;return n}var U=new i.Quaternion,_=new a.Cartesian3,Z=new a.Matrix3;function W(e,r,t,o,s,l,c,u,d,g){var y,f,h,m=a.Cartesian3.angleBetween(a.Cartesian3.subtract(r,e,E),a.Cartesian3.subtract(t,e,P)),p=o===C.BEVELED?0:Math.ceil(m/n.CesiumMath.toRadians(5));if(y=s?a.Matrix3.fromQuaternion(i.Quaternion.fromAxisAngle(a.Cartesian3.negate(e,E),m/(p+1),U),Z):a.Matrix3.fromQuaternion(i.Quaternion.fromAxisAngle(e,m/(p+1),U),Z),r=a.Cartesian3.clone(r,_),p>0)for(var w=g?2:1,v=0;v<p;v++)r=a.Matrix3.multiplyByVector(y,r,r),f=a.Cartesian3.subtract(r,e,E),f=a.Cartesian3.normalize(f,f),s||(f=a.Cartesian3.negate(f,f)),h=l.scaleToGeodeticSurface(r,P),c=L(h,f,u,c,l,d,1,w);else f=a.Cartesian3.subtract(r,e,E),f=a.Cartesian3.normalize(f,f),s||(f=a.Cartesian3.negate(f,f)),h=l.scaleToGeodeticSurface(r,P),c=L(h,f,u,c,l,d,1,1),t=a.Cartesian3.clone(t,_),f=a.Cartesian3.subtract(t,e,E),f=a.Cartesian3.normalize(f,f),s||(f=a.Cartesian3.negate(f,f)),h=l.scaleToGeodeticSurface(t,P),c=L(h,f,u,c,l,d,1,1);return c}b.removeDuplicatesFromShape=function(e){for(var r=e.length,n=[],t=r-1,i=0;i<r;t=i++){var o=e[t],s=e[i];a.Cartesian2.equals(o,s)||n.push(s)}return n},b.angleIsGreaterThanPi=function(e,n,t,i){var o=new r.EllipsoidTangentPlane(t,i),s=o.projectPointOntoPlane(a.Cartesian3.add(t,e,z),z),l=o.projectPointOntoPlane(a.Cartesian3.add(t,n,S),S);return l.x*s.y-l.y*s.x>=0};var Y=new a.Cartesian3,k=new a.Cartesian3;b.computePositions=function(e,r,i,o,s){var l=o._ellipsoid,c=T(e,l),P=o._granularity,M=o._cornerType,z=s?Q(r,i):F(r,i),S=s?F(r,i):void 0,A=i.height/2,D=i.width/2,R=e.length,O=[],I=s?[]:void 0,V=g,N=y,G=f,H=h,j=m,U=p,_=w,Z=v,J=x,K=e[0],X=e[1];H=l.geodeticSurfaceNormal(K,H),V=a.Cartesian3.subtract(X,K,V),V=a.Cartesian3.normalize(V,V),Z=a.Cartesian3.cross(H,V,Z),Z=a.Cartesian3.normalize(Z,Z);var $,ee,ae=c[0],re=c[1];s&&(I=L(K,Z,S,I,l,ae+A,1,1)),J=a.Cartesian3.clone(K,J),K=X,N=a.Cartesian3.negate(V,N);for(var ne=1;ne<R-1;ne++){var te=s?2:1;if(X=e[ne+1],K.equals(X))u("Positions are too close and are considered equivalent with rounding error.");else{V=a.Cartesian3.subtract(X,K,V),V=a.Cartesian3.normalize(V,V),G=a.Cartesian3.add(V,N,G),G=a.Cartesian3.normalize(G,G),H=l.geodeticSurfaceNormal(K,H);var ie=a.Cartesian3.multiplyByScalar(H,a.Cartesian3.dot(V,H),Y);a.Cartesian3.subtract(V,ie,ie),a.Cartesian3.normalize(ie,ie);var oe=a.Cartesian3.multiplyByScalar(H,a.Cartesian3.dot(N,H),k);a.Cartesian3.subtract(N,oe,oe),a.Cartesian3.normalize(oe,oe);var se=!n.CesiumMath.equalsEpsilon(Math.abs(a.Cartesian3.dot(ie,oe)),1,n.CesiumMath.EPSILON7);if(se){G=a.Cartesian3.cross(G,H,G),G=a.Cartesian3.cross(H,G,G),G=a.Cartesian3.normalize(G,G);var le=1/Math.max(.25,a.Cartesian3.magnitude(a.Cartesian3.cross(G,N,E))),Ce=b.angleIsGreaterThanPi(V,N,K,l);Ce?(j=a.Cartesian3.add(K,a.Cartesian3.multiplyByScalar(G,le*D,G),j),U=a.Cartesian3.add(j,a.Cartesian3.multiplyByScalar(Z,D,U),U),d[0]=a.Cartesian3.clone(J,d[0]),d[1]=a.Cartesian3.clone(U,d[1]),$=B(d,ae+A,re+A,P),ee=t.PolylinePipeline.generateArc({positions:d,granularity:P,ellipsoid:l}),O=q(ee,Z,z,O,l,$,1),Z=a.Cartesian3.cross(H,V,Z),Z=a.Cartesian3.normalize(Z,Z),_=a.Cartesian3.add(j,a.Cartesian3.multiplyByScalar(Z,D,_),_),M===C.ROUNDED||M===C.BEVELED?W(j,U,_,M,Ce,l,O,z,re+A,s):(G=a.Cartesian3.negate(G,G),O=L(K,G,z,O,l,re+A,le,te)),J=a.Cartesian3.clone(_,J)):(j=a.Cartesian3.add(K,a.Cartesian3.multiplyByScalar(G,le*D,G),j),U=a.Cartesian3.add(j,a.Cartesian3.multiplyByScalar(Z,-D,U),U),d[0]=a.Cartesian3.clone(J,d[0]),d[1]=a.Cartesian3.clone(U,d[1]),$=B(d,ae+A,re+A,P),ee=t.PolylinePipeline.generateArc({positions:d,granularity:P,ellipsoid:l}),O=q(ee,Z,z,O,l,$,1),Z=a.Cartesian3.cross(H,V,Z),Z=a.Cartesian3.normalize(Z,Z),_=a.Cartesian3.add(j,a.Cartesian3.multiplyByScalar(Z,-D,_),_),M===C.ROUNDED||M===C.BEVELED?W(j,U,_,M,Ce,l,O,z,re+A,s):O=L(K,G,z,O,l,re+A,le,te),J=a.Cartesian3.clone(_,J)),N=a.Cartesian3.negate(V,N)}else O=L(J,Z,z,O,l,ae+A,1,1),J=K;ae=re,re=c[ne+1],K=X}}d[0]=a.Cartesian3.clone(J,d[0]),d[1]=a.Cartesian3.clone(K,d[1]),$=B(d,ae+A,re+A,P),ee=t.PolylinePipeline.generateArc({positions:d,granularity:P,ellipsoid:l}),O=q(ee,Z,z,O,l,$,1),s&&(I=L(K,Z,S,I,l,re+A,1,1)),R=O.length;var ce=s?R+I.length:R,ue=new Float64Array(ce);return ue.set(O),s&&ue.set(I,R),ue},e.CornerType=C,e.PolylineVolumeGeometryLibrary=b,e.oneTimeWarning=u}));