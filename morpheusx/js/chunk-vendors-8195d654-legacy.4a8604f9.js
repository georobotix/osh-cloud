"use strict";(self["webpackChunkvue3_webpack5"]=self["webpackChunkvue3_webpack5"]||[]).push([[7218],{63803:function(t,e,s){s.d(e,{Z:function(){return a},z:function(){return n}});var i=s(80744);let r={};function n(t){r=t}function a(t,e,s,n){i.Z.level>0&&r[t]&&r[t].call(null,e,s,n)}},91619:function(t,e,s){s.d(e,{AQ:function(){return a},DY:function(){return h},IV:function(){return l},M0:function(){return n},pi:function(){return c},w:function(){return o}});var i=s(49440);const r={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function n(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const s=t.type||"interpolation";return{...r[s],...e,...t,type:s}}function a(t,e){const s=e.getBuffer();return s?[s,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function o(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function h(t){t.push(t.shift())}function c(t,e){const{doublePrecision:s,settings:i,value:r,size:n}=t,a=s&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*n)*a}function l({buffer:t,numInstances:e,attribute:s,fromLength:r,fromStartIndices:n,getData:a=(t=>t)}){const o=s.doublePrecision&&s.value instanceof Float64Array?2:1,h=s.size*o,l=s.byteOffset,d=s.startIndices,u=n&&d,p=c(s,e),g=s.isConstant;if(!u&&r>=p)return;const f=g?s.value:s.getBuffer().getData({srcByteOffset:l});if(s.settings.normalized&&!g){const t=a;a=(e,i)=>s.normalizeConstant(t(e,i))}const v=g?(t,e)=>a(f,e):(t,e)=>a(f.subarray(t,t+h),e),y=t.getData({length:r}),w=new Float32Array(p);(0,i.T)({source:y,target:w,sourceStartIndices:n,targetStartIndices:d,size:h,getData:v}),t.byteLength<w.byteLength+l&&t.reallocate(w.byteLength+l),t.subData({data:w,offset:l})}},13906:function(t,e,s){s.d(e,{Z:function(){return _}});var i=s(82482),r=s(44211),n=s(6948),a=s(53478);class o{constructor(t,e){(0,i.Z)(this,"opts",void 0),(0,i.Z)(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:s}=this.source,{size:i}=e;let r=s;if(s&&s.length!==i){r=new Float32Array(i);const t=e.elementOffset||0;for(let e=0;e<i;++e)r[e]=s[t+e]}return r}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function h(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}var c=s(36610),l=s(75126),d=s(80744);function u(t){return t.stride||t.size*t.bytesPerElement}function p(t,e){e.offset&&d.Z.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const s=u(t),i=void 0!==e.vertexOffset?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,n=i*s+r*t.bytesPerElement+(t.offset||0);return{...e,offset:n,stride:s}}function g(t,e){const s=p(t,e);return{high:s,low:{...s,offset:s.offset+4*t.size}}}class f{constructor(t,e,s){(0,i.Z)(this,"gl",void 0),(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"size",void 0),(0,i.Z)(this,"settings",void 0),(0,i.Z)(this,"value",void 0),(0,i.Z)(this,"doublePrecision",void 0),(0,i.Z)(this,"_buffer",void 0),(0,i.Z)(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const a=e.logicalType||e.type,o=5130===a;let c,{defaultValue:l}=e;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0),c=o?5126:!a&&e.isIndexed?t&&(0,r.U6)(t,n.h.ELEMENT_INDEX_UINT32)?5125:5123:a||5126;let d=h(a||c||5126);this.doublePrecision=o,o&&!1===e.fp64&&(d=Float32Array),this.value=null,this.settings={...e,defaultType:d,defaultValue:l,logicalType:a,type:c,size:this.size,bytesPerElement:d.BYTES_PER_ELEMENT},this.state={...s,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new a.Z(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*u(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),c.Z.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const s={},i=this.value instanceof Float64Array,r=g(this.getAccessor(),e||{});return s[t]=new o(this,r.high),s["".concat(t,"64Low")]=i?new o(this,r.low):new Float32Array(this.size),s}if(e){const s=p(this.getAccessor(),e);return{[t]:new o(this,s)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:s,size:i}=this,r=s*i;if(e&&r&&e.length>=r){const s=new Array(i).fill(1/0),n=new Array(i).fill(-1/0);for(let t=0;t<r;)for(let r=0;r<i;r++){const i=e[t++];i<s[r]&&(s[r]=i),i>n[r]&&(n[r]=i)}t=[s,n]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let s;s=ArrayBuffer.isView(t)?{value:t}:t instanceof a.Z?{buffer:t}:t;const i={...this.settings,...s};if(e.bufferAccessor=i,e.bounds=null,s.constant){let t=s.value;t=this._normalizeValue(t,[],0),this.settings.normalized&&(t=this.normalizeConstant(t));const i=!e.constant||!this._areValuesEqual(t,this.value);if(!i)return!1;e.externalBuffer=null,e.constant=!0,this.value=t}else if(s.buffer){const t=s.buffer;e.externalBuffer=t,e.constant=!1,this.value=s.value||null;const r=s.value instanceof Float64Array;i.type=s.type||t.accessor.type,i.bytesPerElement=t.accessor.BYTES_PER_ELEMENT*(r?2:1),i.stride=u(i)}else if(s.value){this._checkExternalBuffer(s);let t=s.value;e.externalBuffer=null,e.constant=!1,this.value=t,i.bytesPerElement=t.BYTES_PER_ELEMENT,i.stride=u(i);const{buffer:r,byteOffset:n}=this;this.doublePrecision&&t instanceof Float64Array&&(t=(0,l.TK)(t,i));const a=t.byteLength+n+2*i.stride;r.byteLength<a&&r.reallocate(a),r.setAccessor(null),r.subData({data:t,offset:n}),i.type=s.type||r.accessor.type}return!0}updateSubBuffer(t={}){this.state.bounds=null;const e=this.value,{startOffset:s=0,endOffset:i}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?(0,l.TK)(e,{size:this.size,startIndex:s,endIndex:i}):e.subarray(s,i),offset:s*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t,e=!1){const{state:s}=this,i=s.allocatedValue,r=c.Z.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=r;const{buffer:n,byteOffset:a}=this;return n.byteLength<r.byteLength+a&&(n.reallocate(r.byteLength+a),e&&i&&n.subData({data:i instanceof Float64Array?(0,l.TK)(i,this):i,offset:a})),s.allocatedValue=r,s.constant=!1,s.externalBuffer=null,s.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const s=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=e.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));e instanceof s||!this.settings.normalized||"normalized"in t||d.Z.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map((t=>(t+128)/255*2-1));case 5122:return new Float32Array(t).map((t=>(t+32768)/65535*2-1));case 5121:return new Float32Array(t).map((t=>t/255));case 5123:return new Float32Array(t).map((t=>t/65535));default:return t}}_normalizeValue(t,e,s){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(t))return e[s]=t,e;if(!t){let t=r;while(--t>=0)e[s+t]=i[t];return e}switch(r){case 4:e[s+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[s+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[s+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[s+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let n=r;while(--n>=0)e[s+n]=Number.isFinite(t[n])?t[n]:i[n]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:s}=this;for(let i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}}var v=s(75304),y=s(38550),w=s(61855),m=s(47586),b=s(91619);class _ extends f{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:m.KO}),(0,i.Z)(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat("function"!==typeof t&&t||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,s=this.settings.transition,i=Array.isArray(e)?t[e.find((e=>t[e]))]:t[e];return(0,b.M0)(i,s)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:t=0,endRow:s=1/0}=e;this.state.updateRanges=m.IH(this.state.updateRanges,[t,s])}else this.state.updateRanges=m.KO}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=m.E_}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:s}=this;return!s.noAlloc&&(!!s.update&&(super.allocate(t,e.updateRanges!==m.KO),!0))}updateBuffer({numInstances:t,data:e,props:s,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:n,noAlloc:a}}=this;let o=!0;if(n){for(const[a,o]of r)n.call(i,this,{data:e,startRow:a,endRow:o,props:s,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[e,s]of r){const i=Number.isFinite(e)?this.getVertexOffset(e):0,r=Number.isFinite(s)?this.getVertexOffset(s):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}else;this._checkAttributeArray()}else o=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),o}setConstantValue(t){if(void 0===t||"function"===typeof t)return!1;const e=this.setData({constant:!0,value:t});return e&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:s,settings:i}=this;if(!t)return s.binaryValue=null,s.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(s.binaryValue===t)return this.clearNeedsUpdate(),!0;s.binaryValue=t,this.setNeedsRedraw();const r=i.transform||e!==this.startIndices;if(r){ArrayBuffer.isView(t)&&(t={value:t});const r=t;(0,v.Z)(ArrayBuffer.isView(r.value),"invalid ".concat(i.accessor));const n=Boolean(r.size)&&r.size!==this.size;return s.binaryAccessor=(0,y.jr)(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:e,nested:n}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this,s=e?t<e.length?e[t]:this.numInstances:t;return s*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const s in t)Object.assign(e,super.getShaderAttributes(s,t[s]));return e}_autoUpdater(t,{data:e,startRow:s,endRow:i,props:r,numInstances:n}){if(t.constant)return;const{settings:a,state:o,value:h,size:c,startIndices:l}=t,{accessor:d,transform:u}=a,p=o.binaryAccessor||("function"===typeof d?d:r[d]);(0,v.Z)("function"===typeof p,'accessor "'.concat(d,'" is not a function'));let g=t.getVertexOffset(s);const{iterable:f,objectInfo:m}=(0,y.jB)(e,s,i);for(const v of f){m.index++;let e=p(v,m);if(u&&(e=u.call(this,e)),l){const s=(m.index<l.length-1?l[m.index+1]:n)-l[m.index];if(e&&Array.isArray(e[0])){let s=g;for(const i of e)t._normalizeValue(i,h,s),s+=c}else e&&e.length>c?h.set(e,g):(t._normalizeValue(e,m.target,0),(0,w.k)({target:h,source:m.target,start:g,count:s}));g+=s*c}else t._normalizeValue(e,h,g),g+=c}}_validateAttributeUpdaters(){const{settings:t}=this,e=t.noAlloc||"function"===typeof t.update;if(!e)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let s=!0;switch(e){case 4:s=s&&Number.isFinite(t[3]);case 3:s=s&&Number.isFinite(t[2]);case 2:s=s&&Number.isFinite(t[1]);case 1:s=s&&Number.isFinite(t[0]);break;default:s=!1}if(!s)throw new Error("Illegal attribute generated for ".concat(this.id))}}}},78918:function(t,e,s){s.d(e,{Z:function(){return c}});var i=s(82482),r=s(52447),n=s(63803),a=s(61855),o=s(85409);const h="compositeLayer.renderLayers";class c extends r.Z{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((t=>t.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t,s=e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id;return s?(t.object=e.__source.object,t.index=e.__source.index,t):t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:s}=this.props;return s&&s[t]&&s[t].type||e}getSubLayerRow(t,e,s){return t.__source={parent:this,object:e,index:s},t}getSubLayerAccessor(t){if("function"===typeof t){const e={index:-1,data:this.props.data,target:[]};return(s,i)=>s&&s.__source?(e.index=s.__source.index,t(s.__source.object,e)):t(s,i)}return t}getSubLayerProps(t={}){var e;const{opacity:s,pickable:i,visible:r,parameters:n,getPolygonOffset:a,highlightedObjectIndex:h,autoHighlight:c,highlightColor:l,coordinateSystem:d,coordinateOrigin:u,wrapLongitude:p,positionFormat:g,modelMatrix:f,extensions:v,fetch:y,operation:w,_subLayerProps:m}=this.props,b={id:"",updateTriggers:{},opacity:s,pickable:i,visible:r,parameters:n,getPolygonOffset:a,highlightedObjectIndex:h,autoHighlight:c,highlightColor:l,coordinateSystem:d,coordinateOrigin:u,wrapLongitude:p,positionFormat:g,modelMatrix:f,extensions:v,fetch:y,operation:w},_=m&&t.id&&m[t.id],S=_&&_.updateTriggers,k=t.id||"sublayer";if(_){const e=this.props[o.Wb],s=t.type?t.type._propTypes:{};for(const t in _){const i=s[t]||e[t];i&&"accessor"===i.type&&(_[t]=this.getSubLayerAccessor(_[t]))}}Object.assign(b,t,_),b.id="".concat(this.props.id,"-").concat(k),b.updateTriggers={all:null===(e=this.props.updateTriggers)||void 0===e?void 0:e.all,...t.updateTriggers,...S};for(const o of v){const t=o.getSubLayerProps.call(this,o);t&&Object.assign(b,t,{updateTriggers:Object.assign(b.updateTriggers,t.updateTriggers)})}return b}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let s=this.internalState.subLayers;const i=!s||this.needsUpdate();if(i){const t=this.renderLayers();s=(0,a.x)(t,Boolean),this.internalState.subLayers=s}(0,n.Z)(h,this,i,s);for(const r of s)r.parent=this}}(0,i.Z)(c,"layerName","CompositeLayer")},24088:function(t,e,s){s.d(e,{Df:function(){return r},FP:function(){return o},iI:function(){return a},zG:function(){return n}});var i=s(80744);const r={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(r,"IDENTITY",{get:()=>(i.Z.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const n={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},a={common:0,meters:1,pixels:2},o={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}}},68315:function(t,e,s){s.d(e,{Z:function(){return pt}});var i=s(82482),r=s(48055),n=s(85409),a=s(80744),o=s(63803),h=s(61855),c=s(50009),l=s(50007),d=s(7013),u=s(15621);const p="layerManager.setLayers",g="layerManager.activateViewport";class f{constructor(t,{deck:e,stats:s,viewport:n,timeline:a}={}){(0,i.Z)(this,"layers",void 0),(0,i.Z)(this,"context",void 0),(0,i.Z)(this,"resourceManager",void 0),(0,i.Z)(this,"_lastRenderedLayers",[]),(0,i.Z)(this,"_needsRedraw",!1),(0,i.Z)(this,"_needsUpdate",!1),(0,i.Z)(this,"_nextLayers",null),(0,i.Z)(this,"_debug",!1),(0,i.Z)(this,"activateViewport",(t=>{(0,o.Z)(g,this,t),t&&(this.context.viewport=t)})),this.layers=[],this.resourceManager=new l.Z({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&(0,u.bs)(t),stats:s||new c.jk({id:"deck.gl"}),viewport:n||new d.Z({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new r.T,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const s of this.layers){const i=s.getNeedsRedraw(t);e=e||i}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter((e=>t.find((t=>0===e.id.indexOf(t))))):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){(0,o.Z)(p,this,e,t),this._lastRenderedLayers=t;const s=(0,h.x)(t,Boolean);for(const i of s)i.context=this.context;this._updateLayers(this.layers,s)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,s){s.raiseError(e,"".concat(t," of ").concat(s))}_updateLayers(t,e){const s={};for(const n of t)s[n.id]?a.Z.warn("Multiple old layers with same id ".concat(n.id))():s[n.id]=n;const i=[];this._updateSublayersRecursively(e,s,i),this._finalizeOldLayers(s);let r=!1;for(const n of i)if(n.hasUniformTransition()){r="Uniform transition in ".concat(n);break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(t,e,s){for(const r of t){r.context=this.context;const t=e[r.id];null===t&&a.Z.warn("Multiple new layers with same id ".concat(r.id))(),e[r.id]=null;let n=null;try{this._debug&&t!==r&&r.validateProps(),t?(this._transferLayerState(t,r),this._updateLayer(r)):this._initializeLayer(r),s.push(r),n=r.isComposite?r.getSubLayers():null}catch(i){this._handleError("matching",i,r)}n&&this._updateSublayersRecursively(n,e,s)}}_finalizeOldLayers(t){for(const e in t){const s=t[e];s&&this._finalizeLayer(s)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=n.dt.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=n.dt.MATCHED,e!==t&&(t.lifecycle=n.dt.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=n.dt.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=n.dt.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}var v=s(34779),y=s(56602),w=s(46871),m=s(43426),b=s(51621);const _=[255,255,255],S=1;let k=0;class A{constructor(t={}){(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"color",void 0),(0,i.Z)(this,"intensity",void 0),(0,i.Z)(this,"type","ambient");const{color:e=_}=t,{intensity:s=S}=t;this.id=t.id||"ambient-".concat(k++),this.color=e,this.intensity=s}}var P=s(43855);const R=[255,255,255],Z=1,M=[0,0,-1];let C=0;class L{constructor(t={}){(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"color",void 0),(0,i.Z)(this,"intensity",void 0),(0,i.Z)(this,"type","directional"),(0,i.Z)(this,"direction",void 0),(0,i.Z)(this,"shadow",void 0);const{color:e=R}=t,{intensity:s=Z}=t,{direction:r=M}=t,{_shadow:n=!1}=t;this.id=t.id||"directional-".concat(C++),this.color=e,this.intensity=s,this.type="directional",this.direction=new P.Z(r).normalize().toArray(),this.shadow=n}getProjectedLight(t){return this}}var x=s(85451),T=s(22944),I=s(33115);const O={color:[255,255,255],intensity:1},E=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],F=[0,0,0,200/255];class z{constructor(t={}){(0,i.Z)(this,"id","lighting-effect"),(0,i.Z)(this,"props",void 0),(0,i.Z)(this,"shadowColor",F),(0,i.Z)(this,"shadow",void 0),(0,i.Z)(this,"ambientLight",void 0),(0,i.Z)(this,"directionalLights",void 0),(0,i.Z)(this,"pointLights",void 0),(0,i.Z)(this,"shadowPasses",[]),(0,i.Z)(this,"shadowMaps",[]),(0,i.Z)(this,"dummyShadowMap",null),(0,i.Z)(this,"programManager",void 0),(0,i.Z)(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const s=t[e];switch(s.type){case"ambient":this.ambientLight=s;break;case"directional":this.directionalLights.push(s);break;case"point":this.pointLights.push(s);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some((t=>t.shadow)),this.props=t}preRender(t,{layers:e,layerFilter:s,viewports:i,onViewportActive:r,views:n}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),0===this.shadowPasses.length&&this._createShadowPasses(t),this.programManager||(this.programManager=m.Z.getDefaultProgramManager(t),I.Z&&this.programManager.addDefaultModule(I.Z)),this.dummyShadowMap||(this.dummyShadowMap=new b.Z(t,{width:1,height:1}));for(let t=0;t<this.shadowPasses.length;t++){const a=this.shadowPasses[t];a.render({layers:e,layerFilter:s,viewports:i,onViewportActive:r,views:n,moduleParameters:{shadowLightId:t,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((e=>e.getProjectedLight({layer:t}))),pointLights:this.pointLights.map((e=>e.getProjectedLight({layer:t})))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(I.Z),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const s=(new x.Z).lookAt({eye:new P.Z(e.direction).negate()});t.push(s)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const s=new T.Z(t);this.shadowPasses[e]=s,this.shadowMaps[e]=s.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:s}=this;t||0!==e.length||0!==s.length||(this.ambientLight=new A(O),this.directionalLights.push(new L(E[0]),new L(E[1])))}}const N=new z;function B(t,e){var s,i;const r=null!==(s=t.order)&&void 0!==s?s:1/0,n=null!==(i=e.order)&&void 0!==i?i:1/0;return r-n}class U{constructor(){(0,i.Z)(this,"effects",void 0),(0,i.Z)(this,"_resolvedEffects",[]),(0,i.Z)(this,"_defaultEffects",[]),(0,i.Z)(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find((e=>e.id===t.id))){const s=e.findIndex((e=>B(e,t)>0));s<0?e.push(t):e.splice(s,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&((0,w.v)(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const i of this.effects)e[i.id]=i;const s=[];for(const i of t){const t=e[i.id];t&&t!==i?t.setProps?(t.setProps(i.props),s.push(t)):(t.cleanup(),s.push(i)):s.push(i),delete e[i.id]}for(const i in e)e[i].cleanup();this.effects=s,this._resolvedEffects=s.concat(this._defaultEffects),t.some((t=>t instanceof z))||this._resolvedEffects.push(N),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}var V=s(13169),D=s(70930),j=s(53849);const H="deckRenderer.renderLayers";class G{constructor(t){(0,i.Z)(this,"gl",void 0),(0,i.Z)(this,"layerFilter",void 0),(0,i.Z)(this,"drawPickingColors",void 0),(0,i.Z)(this,"drawLayersPass",void 0),(0,i.Z)(this,"pickLayersPass",void 0),(0,i.Z)(this,"renderCount",void 0),(0,i.Z)(this,"_needsRedraw",void 0),(0,i.Z)(this,"renderBuffers",void 0),(0,i.Z)(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new V.Z(t),this.pickLayersPass=new D.Z(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,s={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||j.Z.getDefaultFramebuffer(this.gl)};s.effects&&this._preRender(s.effects,s);const i=this.lastPostProcessEffect?this.renderBuffers[0]:s.target,r=e.render({...s,target:i});s.effects&&this._postRender(s.effects,s),this.renderCount++,(0,o.Z)(H,this,r,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const s of t)e.preRenderStats[s.id]=s.preRender(this.gl,e),s.postRender&&(this.lastPostProcessEffect=s.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;0===t.length&&t.push(new j.Z(this.gl),new j.Z(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:s}=this,i={...e,inputBuffer:s[0],swapBuffer:s[1],target:null};for(const r of t)if(r.postRender){if(r.id===this.lastPostProcessEffect){i.target=e.target,r.postRender(this.gl,i);break}const t=r.postRender(this.gl,i);i.inputBuffer=t,i.swapBuffer=t===s[0]?s[1]:s[0]}}}var Y=s(1418),W=s(81913),q=s(96941),K=s(87838);class X{constructor(t){(0,i.Z)(this,"gl",void 0),(0,i.Z)(this,"pickingFBO",void 0),(0,i.Z)(this,"depthFBO",void 0),(0,i.Z)(this,"pickLayersPass",void 0),(0,i.Z)(this,"layerFilter",void 0),(0,i.Z)(this,"lastPickedInfo",void 0),(0,i.Z)(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new D.Z(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:s,viewports:i},r=this.lastPickedInfo.info){const n=r&&r.layer&&r.layer.id,a=r&&r.viewport&&r.viewport.id,o=n?s.find((t=>t.id===n)):null,h=a&&i.find((t=>t.id===a))||i[0],c=h&&h.unproject([t-h.x,e-h.y]),l={x:t,y:e,viewport:h,coordinate:c,layer:o};return{...r,...l}}_resizeBuffer(){var t,e;const{gl:s}=this;if(!this.pickingFBO&&(this.pickingFBO=new j.Z(s),j.Z.isSupported(s,{colorBufferFloat:!0}))){const t=new j.Z(s);t.attach({[36064]:new b.Z(s,{format:(0,Y.D0)(s)?34836:6408,type:5126})}),this.depthFBO=t}null===(t=this.pickingFBO)||void 0===t||t.resize({width:s.canvas.width,height:s.canvas.height}),null===(e=this.depthFBO)||void 0===e||e.resize({width:s.canvas.width,height:s.canvas.height})}_getPickable(t){if(!1===this._pickable)return null;const e=t.filter((t=>this.pickLayersPass.shouldDrawLayer(t)&&!t.isComposite));return e.length?e:null}_pickClosestObject({layers:t,views:e,viewports:s,x:i,y:r,radius:n=0,depth:a=1,mode:o="query",unproject3D:h,onViewportActive:c,effects:l}){const d=this._getPickable(t),u=(0,Y.w)(this.gl);if(!d)return{result:[],emptyInfo:(0,K.wy)({viewports:s,x:i,y:r,pixelRatio:u})};this._resizeBuffer();const p=(0,Y.JY)(this.gl,[i,r],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],f=Math.round(n*u),{width:v,height:y}=this.pickingFBO,w=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:f,deviceWidth:v,deviceHeight:y}),m={x:i-n,y:r-n,width:2*n+1,height:2*n+1};let b;const _=[],S=new Set;for(let k=0;k<a;k++){let t,n;if(w){const i=this._drawAndSample({layers:d,views:e,viewports:s,onViewportActive:c,deviceRect:w,cullRect:m,effects:l,pass:"picking:".concat(o)});t=(0,q.T)({...i,deviceX:g[0],deviceY:g[1],deviceRadius:f,deviceRect:w})}else t={pickedColor:null,pickedObjectIndex:-1};if(t.pickedLayer&&h&&this.depthFBO){const{pickedColors:i}=this._drawAndSample({layers:[t.pickedLayer],views:e,viewports:s,onViewportActive:c,deviceRect:{x:t.pickedX,y:t.pickedY,width:1,height:1},cullRect:m,effects:l,pass:"picking:".concat(o,":z")},!0);i[3]&&(n=i[0])}t.pickedLayer&&k+1<a&&(S.add(t.pickedLayer),t.pickedLayer.disablePickingIndex(t.pickedObjectIndex)),b=(0,K.I5)({pickInfo:t,lastPickedInfo:this.lastPickedInfo,mode:o,layers:d,viewports:s,x:i,y:r,z:n,pixelRatio:u});for(const e of b.values())e.layer&&_.push(e);if(!t.pickedColor)break}for(const k of S)k.restorePickingColors();return{result:_,emptyInfo:b.get(null)}}_pickVisibleObjects({layers:t,views:e,viewports:s,x:i,y:r,width:n=1,height:a=1,mode:o="query",maxObjects:h=null,onViewportActive:c,effects:l}){const d=this._getPickable(t);if(!d)return[];this._resizeBuffer();const u=(0,Y.w)(this.gl),p=(0,Y.JY)(this.gl,[i,r],!0),g=p.x,f=p.y+p.height,v=(0,Y.JY)(this.gl,[i+n,r+a],!0),y=v.x+v.width,w=v.y,m={x:g,y:w,width:y-g,height:f-w},b=this._drawAndSample({layers:d,views:e,viewports:s,onViewportActive:c,deviceRect:m,cullRect:{x:i,y:r,width:n,height:a},effects:l,pass:"picking:".concat(o)}),_=(0,q.K)(b),S=new Map,k=Number.isFinite(h);for(let A=0;A<_.length;A++){if(k&&h&&S.size>=h)break;const t=_[A];let e={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:r,pixelRatio:u};e=(0,K.iD)({layer:t.pickedLayer,info:e,mode:o}),S.has(e.object)||S.set(e.object,e)}return Array.from(S.values())}_drawAndSample({layers:t,views:e,viewports:s,onViewportActive:i,deviceRect:r,cullRect:n,effects:a,pass:o},h=!1){const c=h?this.depthFBO:this.pickingFBO,l={layers:t,layerFilter:this.layerFilter,views:e,viewports:s,onViewportActive:i,pickingFBO:c,deviceRect:r,cullRect:n,effects:a,pass:o,pickZ:h,preRenderStats:{}};for(const y of a)y.useInPicking&&(l.preRenderStats[y.id]=y.preRender(this.gl,l));const{decodePickingColor:d}=this.pickLayersPass.render(l),{x:u,y:p,width:g,height:f}=r,v=new(h?Float32Array:Uint8Array)(g*f*4);return(0,W.z6)(c,{sourceX:u,sourceY:p,sourceWidth:g,sourceHeight:f,target:v}),{pickedColors:v,decodePickingColor:d}}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:s,deviceWidth:i,deviceHeight:r}){const n=Math.max(0,t-s),a=Math.max(0,e-s),o=Math.min(i,t+s+1)-n,h=Math.min(r,e+s+1)-a;return o<=0||h<=0?null:{x:n,y:a,width:o,height:h}}}var Q=s(81862),J=s(36610),$=s(6228),tt=s(54022),et=s(6610);function st(){const t="8.9.4",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(a.Z.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:a.Z,_registerLoggers:o.z},(0,$.fh)([et.Z,[tt.S,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const it=st();var rt=s(3485),nt=s(16816),at=s(49835),ot=s(12798),ht=s(75304),ct=s(24088);function lt(){}const dt=({isDragging:t})=>t?"grabbing":"grab",ut={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:lt,onResize:lt,onViewStateChange:lt,onInteractionStateChange:lt,onBeforeRender:lt,onAfterRender:lt,onLoad:lt,onError:t=>a.Z.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:dt,getTooltip:null,debug:!1,drawPickingColors:!1};class pt{constructor(t){(0,i.Z)(this,"props",void 0),(0,i.Z)(this,"width",0),(0,i.Z)(this,"height",0),(0,i.Z)(this,"userData",{}),(0,i.Z)(this,"canvas",null),(0,i.Z)(this,"viewManager",null),(0,i.Z)(this,"layerManager",null),(0,i.Z)(this,"effectManager",null),(0,i.Z)(this,"deckRenderer",null),(0,i.Z)(this,"deckPicker",null),(0,i.Z)(this,"eventManager",null),(0,i.Z)(this,"tooltip",null),(0,i.Z)(this,"metrics",void 0),(0,i.Z)(this,"animationLoop",void 0),(0,i.Z)(this,"stats",void 0),(0,i.Z)(this,"viewState",void 0),(0,i.Z)(this,"cursorState",void 0),(0,i.Z)(this,"_needsRedraw",void 0),(0,i.Z)(this,"_pickRequest",void 0),(0,i.Z)(this,"_lastPointerDownInfo",null),(0,i.Z)(this,"_metricsCounter",void 0),(0,i.Z)(this,"_onPointerMove",(t=>{const{_pickRequest:e}=this;if("pointerleave"===t.type)e.x=-1,e.y=-1,e.radius=0;else{if(t.leftButton||t.rightButton)return;{const s=t.offsetCenter;if(!s)return;e.x=s.x,e.y=s.y,e.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:e.x,y:e.y}),e.event=t})),(0,i.Z)(this,"_onEvent",(t=>{const e=ct.FP[t.type],s=t.offsetCenter;if(!e||!s||!this.layerManager)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:i,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:n}=r,a=n&&(n[e.handler]||n.props[e.handler]),o=this.props[e.handler];let h=!1;a&&(h=a.call(n,r,t)),!h&&o&&o(r,t)})),(0,i.Z)(this,"_onPointerDown",(t=>{const e=t.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:e.x,y:e.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo})),this.props={...ut,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&a.Z.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===(0,rt.Z)()&&a.Z.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||"undefined"!==typeof document&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new c.jk({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&J.Z.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,s,i,r,n,a,o;(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,null===(t=this.layerManager)||void 0===t||t.finalize(),this.layerManager=null,null===(e=this.viewManager)||void 0===e||e.finalize(),this.viewManager=null,null===(s=this.effectManager)||void 0===s||s.finalize(),this.effectManager=null,null===(i=this.deckRenderer)||void 0===i||i.finalize(),this.deckRenderer=null,null===(r=this.deckPicker)||void 0===r||r.finalize(),this.deckPicker=null,null===(n=this.eventManager)||void 0===n||n.destroy(),this.eventManager=null,null===(a=this.tooltip)||void 0===a||a.remove(),this.tooltip=null,this.props.canvas||this.props.gl||!this.canvas)||(null===(o=this.canvas.parentElement)||void 0===o||o.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&a.Z.removed("onLayerHover","onHover")(),"onLayerClick"in t&&a.Z.removed("onLayerClick","onClick")(),t.initialViewState&&!(0,w.v)(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const s=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),n=this.deckRenderer.needsRedraw(t);return e=e||s||i||r||n,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return null!==this.viewManager}getViews(){return(0,ht.Z)(this.viewManager),this.viewManager.views}getViewports(t){return(0,ht.Z)(this.viewManager),this.viewManager.getViewports(t)}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const s in t)this.layerManager.resourceManager.add({resourceId:s,data:t[s],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,e,s){(0,ht.Z)(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(e).timeStart();const r=this.deckPicker[t]({layers:this.layerManager.getLayers(s),views:this.viewManager.getViews(),viewports:this.getViewports(s),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...s});return i.get(e).timeEnd(),r}_createCanvas(t){let e=t.canvas;if("string"===typeof e&&(e=document.getElementById(e),(0,ht.Z)(e)),!e){e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay";const s=t.parent||document.body;s.appendChild(e)}return Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:s}=t;if(e||0===e){const t=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=t}if(s||0===s){var i;const e=Number.isFinite(s)?"".concat(s,"px"):s;this.canvas.style.position=(null===(i=t.style)||void 0===i?void 0:i.position)||"absolute",this.canvas.style.height=e}}_updateCanvasSize(){const{canvas:t}=this;if(!t)return;const e=t.clientWidth||t.width,s=t.clientHeight||t.height;var i;e===this.width&&s===this.height||(this.width=e,this.height=s,null===(i=this.viewManager)||void 0===i||i.setProps({width:e,height:s}),this.props.onResize({width:e,height:s}))}_createAnimationLoop(t){const{width:e,height:s,gl:i,glOptions:r,debug:n,onError:a,onBeforeRender:o,onAfterRender:h,useDevicePixels:c}=t;return new nt.Z({width:e,height:s,useDevicePixels:c,autoResizeViewport:!1,gl:i,onCreateContext:t=>(0,Y.s9)({...r,...t,canvas:this.canvas,debug:n,onContextLost:()=>this._onContextLost()}),onInitialize:t=>this._setGLContext(t.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:o,onAfterRender:h,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new y.Z({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:s,emptyInfo:i}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=s.length>0;let r=i,n=!1;for(const a of s){var e;r=a,n=(null===(e=a.layer)||void 0===e?void 0:e.onHover(a,t.event))||n}if(!n&&this.props.onHover&&this.props.onHover(r,t.event),this.props.getTooltip&&this.tooltip){const t=this.props.getTooltip(r);this.tooltip.setTooltip(t,r.x,r.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,(0,Y.yW)(t,{enable:!0,copyState:!0})),this.tooltip=new Q.Z(this.canvas),(0,Y.dR)(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new r.T;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new ot.Q(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in ct.FP)this.eventManager.on(i,this._onEvent);this.viewManager=new v.Z({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const s=this.viewManager.getViewports()[0];this.layerManager=new f(t,{deck:this,stats:this.stats,viewport:s,timeline:e}),this.effectManager=new U,this.deckRenderer=new G(t),this.deckPicker=new X(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:s}=this.layerManager.context;(0,Y.dR)(s,this.props.parameters),this.props.onBeforeRender({gl:s}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:s})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),a.Z.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const s=at.lR.get("Memory Usage");t.bufferMemory=s.get("Buffer Memory").count,t.textureMemory=s.get("Texture Memory").count,t.renderbufferMemory=s.get("Renderbuffer Memory").count,t.gpuMemory=s.get("GPU Memory").count}}(0,i.Z)(pt,"defaultProps",ut),(0,i.Z)(pt,"VERSION",it)},52447:function(t,e,s){s.d(e,{Z:function(){return Y}});var i=s(82482),r=s(24088),n=s(13906),a=s(80744),o=s(88177),h=s(75126),c=s(63803),l=s(19718),d=s(20198),u=s(7563);const p={interpolation:d.Z,spring:u.Z};class g{constructor(t,{id:e,timeline:s}){(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"isSupported",void 0),(0,i.Z)(this,"gl",void 0),(0,i.Z)(this,"timeline",void 0),(0,i.Z)(this,"transitions",void 0),(0,i.Z)(this,"needsRedraw",void 0),(0,i.Z)(this,"numInstances",void 0),this.id=e,this.gl=t,this.timeline=s,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=l.Z.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:s}){this.numInstances=s||1;for(const i in t){const s=t[i],r=s.getTransitionSetting(e);r&&this._updateAttribute(i,s,r)}for(const i in this.transitions){const s=t[i];s&&s.getTransitionSetting(e)||this._removeTransition(i)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const s=this.transitions[e];s.inProgress&&(t[e]=s.attributeInTransition)}return t}run(){if(!this.isSupported||0===this.numInstances)return!1;for(const e in this.transitions){const t=this.transitions[e].update();t&&(this.needsRedraw=!0)}const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,s){const i=this.transitions[t];let r=!i||i.type!==s.type;if(r){if(!this.isSupported)return void a.Z.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();i&&this._removeTransition(t);const n=p[s.type];n?this.transitions[t]=new n({attribute:e,timeline:this.timeline,gl:this.gl}):(a.Z.error("unsupported transition type '".concat(s.type,"'"))(),r=!1)}(r||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(s,this.numInstances))}}const f="attributeManager.invalidate",v="attributeManager.updateStart",y="attributeManager.updateEnd",w="attribute.updateStart",m="attribute.allocate",b="attribute.updateEnd";class _{constructor(t,{id:e="attribute-manager",stats:s,timeline:r}={}){(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"gl",void 0),(0,i.Z)(this,"attributes",void 0),(0,i.Z)(this,"updateTriggers",void 0),(0,i.Z)(this,"needsRedraw",void 0),(0,i.Z)(this,"userData",void 0),(0,i.Z)(this,"stats",void 0),(0,i.Z)(this,"attributeTransitionManager",void 0),(0,i.Z)(this,"mergeBoundsMemoized",(0,o.Z)(h.cc)),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=s,this.attributeTransitionManager=new g(t,{id:"".concat(e,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)void 0!==this.attributes[e]&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const s=this._invalidateTrigger(t,e);(0,c.Z)(f,this,t,s)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);(0,c.Z)(f,this,"all")}update({data:t,numInstances:e,startIndices:s=null,transitions:i,props:r={},buffers:n={},context:o={}}){let h=!1;(0,c.Z)(v,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const i=this.attributes[c],l=i.settings.accessor;i.startIndices=s,i.numInstances=e,r[c]&&a.Z.removed("props.".concat(c),"data.attributes.".concat(c))(),i.setExternalBuffer(n[c])||i.setBinaryValue("string"===typeof l?n[l]:void 0,t.startIndices)||"string"===typeof l&&!n[l]&&i.setConstantValue(r[l])||i.needsUpdate()&&(h=!0,this._updateAttribute({attribute:i,numInstances:e,data:t,props:r,context:o})),this.needsRedraw=this.needsRedraw||i.needsRedraw()}h&&(0,c.Z)(y,this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:i})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getBounds(t){const e=t.map((t=>{var e;return null===(e=this.attributes[t])||void 0===e?void 0:e.getBounds()}));return this.mergeBoundsMemoized(e)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:s}=this,i={...s.getAttributes()};for(const r in e){const n=e[r];n.needsRedraw(t)&&!s.hasAttribute(r)&&(i[r]=n)}return i}getShaderAttributes(t,e={}){t||(t=this.getAttributes());const s={};for(const i in t)e[i]||Object.assign(s,t[i].getShaderAttributes());return s}_add(t,e={}){for(const s in t){const i=t[s];this.attributes[s]=this._createAttribute(s,i,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,s){const i={...e,id:t,size:(e.isIndexed?1:e.size)||1,divisor:s.instanced?1:e.divisor||0};return new n.Z(this.gl,i)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes){const s=this.attributes[e];s.getUpdateTriggers().forEach((s=>{t[s]||(t[s]=[]),t[s].push(e)}))}this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:s,updateTriggers:i}=this,r=i[t];return r&&r.forEach((t=>{const i=s[t];i&&i.setNeedsUpdate(i.id,e)})),r}_updateAttribute(t){const{attribute:e,numInstances:s}=t;if((0,c.Z)(w,e),e.constant)return void e.setConstantValue(e.value);e.allocate(s)&&(0,c.Z)(m,e,s);const i=e.updateBuffer(t);i&&(this.needsRedraw=!0,(0,c.Z)(b,e,s))}}var S=s(52413),k=s(71761),A=s(85409),P=s(75015),R=s(1418),Z=s(75304),M=s(27870),C=s(18547),L=s(36610),x=s(85089),T=s(88018);class I extends T.Z{constructor({attributeManager:t,layer:e}){super(e),(0,i.Z)(this,"attributeManager",void 0),(0,i.Z)(this,"needsRedraw",void 0),(0,i.Z)(this,"needsUpdate",void 0),(0,i.Z)(this,"subLayers",void 0),(0,i.Z)(this,"usesPickingColorCache",void 0),(0,i.Z)(this,"hasPickingBuffer",void 0),(0,i.Z)(this,"changeFlags",void 0),(0,i.Z)(this,"viewport",void 0),(0,i.Z)(this,"uniformTransitions",void 0),(0,i.Z)(this,"propsInTransition",void 0),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const s=this.layer,i=null===s||void 0===s?void 0:s.props.fetch;return i?i(e,{propName:t,layer:s}):super._fetch(t,e)}_onResolve(t,e){const s=this.layer;if(s){const i=s.props.onDataLoad;"data"===t&&i&&i(e,{propName:t,layer:s})}}_onError(t,e){const s=this.layer;s&&s.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}var O=s(78866),E=s(44534);const F="layer.changeFlag",z="layer.initialize",N="layer.update",B="layer.finalize",U="layer.matched",V=2**24-1,D=Object.freeze([]),j=(0,o.Z)((({oldViewport:t,viewport:e})=>t.equals(e)));let H=new Uint8ClampedArray(0);const G={data:{type:"data",value:D,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:s,loaders:i,loadOptions:r,signal:n})=>{const{resourceManager:a}=s.context;var o;(r=r||s.getLoadOptions(),i=i||s.props.loaders,n)&&(r={...r,fetch:{...null===(o=r)||void 0===o?void 0:o.fetch,signal:n}});let h=a.contains(t);return h||r||(a.add({resourceId:t,data:(0,E.z)(t,i),persistent:!1}),h=!0),h?a.subscribe({resourceId:t,onChange:t=>{var i;return null===(i=s.internalState)||void 0===i?void 0:i.reloadAsyncProp(e,t)},consumerId:s.id,requestId:e}):(0,E.z)(t,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:r.Df.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,100*-t]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Y extends x.Z{constructor(...t){super(...t),(0,i.Z)(this,"internalState",null),(0,i.Z)(this,"lifecycle",A.dt.NO_STATE),(0,i.Z)(this,"context",void 0),(0,i.Z)(this,"state",void 0),(0,i.Z)(this,"parent",null)}get root(){let t=this;while(t.parent)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){(0,Z.Z)(this.internalState);const e=this.internalState.viewport||this.context.viewport,s=(0,C.T)(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,n]=(0,O.aW)(s,e.pixelProjectionMatrix);return 2===t.length?[i,r]:[i,r,n]}unproject(t){(0,Z.Z)(this.internalState);const e=this.internalState.viewport||this.context.viewport;return e.unproject(t)}projectPosition(t,e){(0,Z.Z)(this.internalState);const s=this.internalState.viewport||this.context.viewport;return(0,C.D)(t,{viewport:s,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===r.Df.DEFAULT||t===r.Df.LNGLAT||t===r.Df.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){(0,Z.Z)(t instanceof Uint8Array);const[e,s,i]=t,r=e+256*s+65536*i-1;return r}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:(0,P.Q)(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return null===(t=this.getAttributeManager())||void 0===t?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const e of this.props.extensions)t=(0,M.l)(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:s}=t.changeFlags;if(s&&e)if(Array.isArray(s))for(const i of s)e.invalidateAll(i);else e.invalidateAll();if(e){const{props:s}=t,i=this.internalState.hasPickingBuffer,r=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some((t=>t.getNeedsPickingBuffer.call(this,t)));if(i!==r){this.internalState.hasPickingBuffer=r;const{pickingColors:t,instancePickingColors:s}=e.attributes,i=t||s;i&&(r&&i.constant&&(i.constant=!1,e.invalidate(i.id)),i.value||r||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(t){for(const s of this.getModels())s.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo({info:t,mode:e,sourceLayer:s}){const{index:i}=t;return i>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[i]),t}raiseError(t,e){var s,i,r,n;(e&&(t.message="".concat(e,": ").concat(t.message)),null!==(s=(i=this.props).onError)&&void 0!==s&&s.call(i,t))||(null===(r=this.context)||void 0===r||null===(n=r.onError)||void 0===n||n.call(r,t,this))}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var t;return(null===(t=this.internalState)||void 0===t?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,e&&j({oldViewport:e,viewport:t})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const e=this.getAttributeManager();e&&("all"===t?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,s=this.getNumInstances(),i=this.getStartIndices();t.update({data:e.data,numInstances:s,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const r=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),s=Object.create(this.props);for(const t in e)Object.defineProperty(s,t,{value:e[t]});return s}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const s=Math.floor(H.length/3);if(this.internalState.usesPickingColorCache=!0,s<e){e>V&&a.Z.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),H=L.Z.allocate(H,e,{size:3,copy:!0,maxCount:Math.max(e,V)});const t=Math.floor(H.length/3),i=[];for(let e=s;e<t;e++)this.encodePickingColor(e,i),H[3*e+0]=i[0],H[3*e+1]=i[1],H[3*e+2]=i[2]}t.value=H.subarray(0,3*e)}_setModelAttributes(t,e){const s=this.getAttributeManager(),i=t.userData.excludeAttributes||{},r=s.getShaderAttributes(e,i);t.setAttributes(r)}disablePickingIndex(t){this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:s}=this.getAttributeManager().attributes,i=e||s;if(!i)return;const r=i.getVertexOffset(t),n=i.getVertexOffset(t+1);i.buffer.subData({data:new Uint8Array(n-r),offset:r})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,s=t||e;s&&(this.internalState.usesPickingColorCache&&s.value.buffer!==H.buffer&&(s.value=H.subarray(0,s.value.length)),s.updateSubBuffer({startOffset:0}))}_initialize(){(0,Z.Z)(!this.internalState),(0,Z.Z)(Number.isFinite(this.props.coordinateSystem)),(0,c.Z)(z,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new I({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(a.Z.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new S.Z(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){(0,c.Z)(U,this,this===t);const{state:e,internalState:s}=t;this!==t&&(this.internalState=s,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if((0,c.Z)(N,this,t),!t)return;const e=this.props,s=this.context,i=this.internalState,r=s.viewport,n=this._updateUniformTransition();i.propsInTransition=n,s.viewport=i.viewport||r,this.props=n;try{const t=this._getUpdateParams(),e=this.getModels();if(s.gl)this.updateState(t);else try{this.updateState(t)}catch(a){}for(const s of this.props.extensions)s.updateState.call(this,t,s);const i=this.getModels()[0]!==e[0];this._postUpdate(t,i)}finally{s.viewport=r,this.props=e,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){(0,c.Z)(B,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({moduleParameters:t=null,uniforms:e={},parameters:s={}}){this._updateAttributeTransition();const i=this.props,r=this.context;this.props=this.internalState.propsInTransition||i;const n=this.props.opacity;e.opacity=Math.pow(n,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:i}=this.props,n=i&&i(e)||[0,0];(0,R.dR)(r.gl,{polygonOffset:n}),(0,R.s8)(r.gl,s,(()=>{const i={moduleParameters:t,uniforms:e,parameters:s,context:r};for(const t of this.props.extensions)t.draw.call(this,i,t);this.draw(i)}))}finally{this.props=i}}getChangeFlags(){var t;return null===(t=this.internalState)||void 0===t?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const i in t)if(t[i]){let s=!1;switch(i){case"dataChanged":const r=t[i],n=e[i];r&&Array.isArray(n)&&(e.dataChanged=Array.isArray(r)?n.concat(r):r,s=!0);default:e[i]||(e[i]=t[i],s=!0)}s&&(0,c.Z)(F,this,i,t)}const s=Boolean(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=s,e.somethingChanged=s||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const s=(0,k.Yt)(t,e);if(s.updateTriggersChanged)for(const r in s.updateTriggersChanged)s.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(s.transitionsChanged)for(const r in s.transitionsChanged){var i;this.internalState.uniformTransitions.add(r,e[r],t[r],null===(i=t.transitions)||void 0===i?void 0:i[r])}return this.setChangeFlags(s)}validateProps(){(0,k.eQ)(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:s}=this.props;t.picked&&"function"===typeof s&&(e.pickingHighlightColor=s(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new _(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:s,oldProps:i}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:r}=this.state;null===r||void 0===r||r.setInstanceCount(this.getNumInstances());const{autoHighlight:n,highlightedObjectIndex:a,highlightColor:o}=s;if(e||i.autoHighlight!==n||i.highlightedObjectIndex!==a||i.highlightColor!==o){const t={};n||(t.pickingSelectedColor=null),Array.isArray(o)&&(t.pickingHighlightColor=o),(e||a!==i.highlightedObjectIndex)&&(t.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(t)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const s=this.getAttributeManager(),i=!!s&&s.getNeedsRedraw(t);if(e=e||i,e)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}(0,i.Z)(Y,"defaultProps",G),(0,i.Z)(Y,"layerName","Layer")}}]);
//# sourceMappingURL=chunk-vendors-8195d654-legacy.4a8604f9.js.map