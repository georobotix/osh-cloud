"use strict";(self["webpackChunkvue3_webpack5"]=self["webpackChunkvue3_webpack5"]||[]).push([[6183],{79162:function(e,t,i){var r=i(88108),a=i(48243),n=i(27495),s=i(60838),o=i(60216),u=i(63367),h=i(51688),d=i(83856),c=i(59947),m=i(92062),p=i(8182),l=i(17711),_=i(62200),f=i(82982),Z=i(86511),w=i(12572),g=i(96037),v=i(26865),C=i(84935),S=i(99417),y=i(72248),x=i(35131),E=i(66854),b=i(38443),M=i(87811),O=i(38779),P=i(52200),A=i(39899),T=i(20521),D=i(51107),L=i(60072),N=i(2932),F=i(8379),z=i(65121),R=i(21572),I=i(17941),V=i(89032),W=i(10667),B=i(87721),U=i(8743),k=i(70561),q=i(71593),H=i(96548),Y=i(64060),G=i(34380),j=i(2143);function X(e){e=(0,_.Z)(e,_.Z.EMPTY_OBJECT);var t=e.context;if(!(0,f.Z)(t))throw new w.Z("context is required.");if(!(0,f.Z)(e.lightCamera))throw new w.Z("lightCamera is required.");if((0,f.Z)(e.numberOfCascades)&&1!==e.numberOfCascades&&4!==e.numberOfCascades)throw new w.Z("Only one or four cascades are supported.");this._enabled=(0,_.Z)(e.enabled,!0),this._softShadows=(0,_.Z)(e.softShadows,!1),this._normalOffset=(0,_.Z)(e.normalOffset,!0),this.dirty=!0,this.fromLightSource=(0,_.Z)(e.fromLightSource,!0),this.darkness=(0,_.Z)(e.darkness,.3),this._darkness=this.darkness,this.fadingEnabled=(0,_.Z)(e.fadingEnabled,!0),this.maximumDistance=(0,_.Z)(e.maximumDistance,5e3),this._outOfView=!1,this._outOfViewPrevious=!1,this._needsUpdate=!0;var i,r=!0;(g.Z.isInternetExplorer()||g.Z.isEdge()||(g.Z.isChrome()||g.Z.isFirefox())&&g.Z.isWindows()&&!t.depthTexture)&&(r=!1),this._polygonOffsetSupported=r,this._terrainBias={polygonOffset:r,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.5,normalShading:!0,normalShadingSmooth:.3,depthBias:1e-4},this._primitiveBias={polygonOffset:r,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.1,normalShading:!0,normalShadingSmooth:.05,depthBias:2e-5},this._pointBias={polygonOffset:!1,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:0,normalShading:!0,normalShadingSmooth:.1,depthBias:5e-4},this._depthAttachment=void 0,this._colorAttachment=void 0,this._shadowMapMatrix=new y.Z,this._shadowMapTexture=void 0,this._lightDirectionEC=new o.Z,this._lightPositionEC=new u.Z,this._distance=0,this._lightCamera=e.lightCamera,this._shadowMapCamera=new ge,this._shadowMapCullingVolume=void 0,this._sceneCamera=void 0,this._boundingSphere=new a.Z,this._isPointLight=(0,_.Z)(e.isPointLight,!1),this._pointLightRadius=(0,_.Z)(e.pointLightRadius,100),this._cascadesEnabled=!this._isPointLight&&(0,_.Z)(e.cascadesEnabled,!0),this._numberOfCascades=this._cascadesEnabled?(0,_.Z)(e.numberOfCascades,4):0,this._fitNearFar=!0,this._maximumCascadeDistances=[25,150,700,Number.MAX_VALUE],this._textureSize=new s.Z,this._isSpotLight=!1,this._cascadesEnabled?this._shadowMapCamera.frustum=new x.Z:(0,f.Z)(this._lightCamera.frustum.fov)&&(this._isSpotLight=!0),this._cascadeSplits=[new u.Z,new u.Z],this._cascadeMatrices=[new y.Z,new y.Z,new y.Z,new y.Z],this._cascadeDistances=new u.Z,i=this._isPointLight?6:this._cascadesEnabled?this._numberOfCascades:1,this._passes=new Array(i);for(var n=0;n<i;++n)this._passes[n]=new K(t);this.debugShow=!1,this.debugFreezeFrame=!1,this._debugFreezeFrame=!1,this._debugCascadeColors=!1,this._debugLightFrustum=void 0,this._debugCameraFrustum=void 0,this._debugCascadeFrustums=new Array(this._numberOfCascades),this._debugShadowViewCommand=void 0,this._usesDepthTexture=t.depthTexture,this._isPointLight&&(this._usesDepthTexture=!1),this._primitiveRenderState=void 0,this._terrainRenderState=void 0,this._pointRenderState=void 0,J(this),this._clearCommand=new A.Z({depth:1,color:new c.Z}),this._clearPassState=new z.Z(t),this._size=(0,_.Z)(e.size,2048),this.size=this._size}function K(e){this.camera=new ge,this.passState=new z.Z(e),this.framebuffer=void 0,this.textureOffsets=void 0,this.commandList=[],this.cullingVolume=void 0}function Q(e,t){return W.Z.fromCache({cull:{enabled:!0,face:q.Z.BACK},depthTest:{enabled:!0},colorMask:{red:e,green:e,blue:e,alpha:e},depthMask:!0,polygonOffset:{enabled:t.polygonOffset,factor:t.polygonOffsetFactor,units:t.polygonOffsetUnits}})}function J(e){var t=!e._usesDepthTexture;e._primitiveRenderState=Q(t,e._primitiveBias),e._terrainRenderState=Q(t,e._terrainBias),e._pointRenderState=Q(t,e._pointBias)}function $(e){for(var t=e._passes.length,i=0;i<t;++i){var r=e._passes[i],a=r.framebuffer;(0,f.Z)(a)&&!a.isDestroyed()&&a.destroy(),r.framebuffer=void 0}e._depthAttachment=e._depthAttachment&&e._depthAttachment.destroy(),e._colorAttachment=e._colorAttachment&&e._colorAttachment.destroy()}function ee(e,t){for(var i=new I.Z({context:t,width:e._textureSize.x,height:e._textureSize.y,format:V.Z.DEPTH_COMPONENT16}),r=new U.Z({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:b.Z.RGBA,pixelDatatype:R.Z.UNSIGNED_BYTE,sampler:B.Z.NEAREST}),a=new N.Z({context:t,depthRenderbuffer:i,colorTextures:[r],destroyAttachments:!1}),n=e._passes.length,s=0;s<n;++s){var o=e._passes[s];o.framebuffer=a,o.passState.framebuffer=a}e._shadowMapTexture=r,e._depthAttachment=i,e._colorAttachment=r}function te(e,t){for(var i=new U.Z({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:b.Z.DEPTH_STENCIL,pixelDatatype:R.Z.UNSIGNED_INT_24_8,sampler:B.Z.NEAREST}),r=new N.Z({context:t,depthStencilTexture:i,destroyAttachments:!1}),a=e._passes.length,n=0;n<a;++n){var s=e._passes[n];s.framebuffer=r,s.passState.framebuffer=r}e._shadowMapTexture=i,e._depthAttachment=i}function ie(e,t){for(var i=new I.Z({context:t,width:e._textureSize.x,height:e._textureSize.y,format:V.Z.DEPTH_COMPONENT16}),r=new D.Z({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:b.Z.RGBA,pixelDatatype:R.Z.UNSIGNED_BYTE,sampler:B.Z.NEAREST}),a=[r.negativeX,r.negativeY,r.negativeZ,r.positiveX,r.positiveY,r.positiveZ],n=0;n<6;++n){var s=new N.Z({context:t,depthRenderbuffer:i,colorTextures:[a[n]],destroyAttachments:!1}),o=e._passes[n];o.framebuffer=s,o.passState.framebuffer=s}e._shadowMapTexture=r,e._depthAttachment=i,e._colorAttachment=r}function re(e,t){e._isPointLight?ie(e,t):e._usesDepthTexture?te(e,t):ee(e,t)}function ae(e,t){e._usesDepthTexture&&e._passes[0].framebuffer.status!==P.Z.FRAMEBUFFER_COMPLETE&&(e._usesDepthTexture=!1,J(e),$(e),re(e,t))}function ne(e,t){(0,f.Z)(e._passes[0].framebuffer)&&e._shadowMapTexture.width===e._textureSize.x||($(e),re(e,t),ae(e,t),se(e,t))}function se(e,t,i){i=(0,_.Z)(i,0),(e._isPointLight||0===i)&&(e._clearCommand.framebuffer=e._passes[i].framebuffer,e._clearCommand.execute(t,e._clearPassState))}function oe(e,t){e._size=t;var i=e._passes,a=i.length,n=e._textureSize;if(e._isPointLight){t=T.Z.maximumCubeMapSize>=t?t:T.Z.maximumCubeMapSize,n.x=t,n.y=t;var s=new r.Z(0,0,t,t);i[0].passState.viewport=s,i[1].passState.viewport=s,i[2].passState.viewport=s,i[3].passState.viewport=s,i[4].passState.viewport=s,i[5].passState.viewport=s}else 1===a?(t=T.Z.maximumTextureSize>=t?t:T.Z.maximumTextureSize,n.x=t,n.y=t,i[0].passState.viewport=new r.Z(0,0,t,t)):4===a&&(t=T.Z.maximumTextureSize>=2*t?t:T.Z.maximumTextureSize/2,n.x=2*t,n.y=2*t,i[0].passState.viewport=new r.Z(0,0,t,t),i[1].passState.viewport=new r.Z(t,0,t,t),i[2].passState.viewport=new r.Z(0,t,t,t),i[3].passState.viewport=new r.Z(t,t,t,t));e._clearPassState.viewport=new r.Z(0,0,n.x,n.y);for(var o=0;o<a;++o){var u=i[o],h=u.passState.viewport,d=h.x/n.x,c=h.y/n.y,m=h.width/n.x,p=h.height/n.y;u.textureOffsets=new y.Z(m,0,0,d,0,p,0,c,0,0,1,0,0,0,0,1)}}X.MAXIMUM_DISTANCE=2e4,X.prototype.debugCreateRenderStates=function(){J(this)},Object.defineProperties(X.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this.dirty=this._enabled!==e,this._enabled=e}},normalOffset:{get:function(){return this._normalOffset},set:function(e){this.dirty=this._normalOffset!==e,this._normalOffset=e,this._terrainBias.normalOffset=e,this._primitiveBias.normalOffset=e,this._pointBias.normalOffset=e}},softShadows:{get:function(){return this._softShadows},set:function(e){this.dirty=this._softShadows!==e,this._softShadows=e}},size:{get:function(){return this._size},set:function(e){oe(this,e)}},outOfView:{get:function(){return this._outOfView}},shadowMapCullingVolume:{get:function(){return this._shadowMapCullingVolume}},passes:{get:function(){return this._passes}},isPointLight:{get:function(){return this._isPointLight}},debugCascadeColors:{get:function(){return this._debugCascadeColors},set:function(e){this.dirty=this._debugCascadeColors!==e,this._debugCascadeColors=e}}});var ue=new r.Z;function he(e,t){var i;i=e._isPointLight?"uniform samplerCube shadowMap_textureCube; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec2 uv = v_textureCoordinates; \n    vec3 dir; \n \n    if (uv.y < 0.5) \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = -1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = -1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else \n        { \n            dir.z = -1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 1.0; \n        } \n    } \n    else \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = 1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = 1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else \n        { \n            dir.z = 1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 3.0; \n        } \n    } \n \n    float shadow = czm_unpackDepth(textureCube(shadowMap_textureCube, dir)); \n    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n":"uniform sampler2D shadowMap_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n"+(e._usesDepthTexture?"    float shadow = texture2D(shadowMap_texture, v_textureCoordinates).r; \n":"    float shadow = czm_unpackDepth(texture2D(shadowMap_texture, v_textureCoordinates)); \n")+"    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n";var r=t.createViewportQuadCommand(i,{uniformMap:{shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture}}});return r.pass=F.Z.OVERLAY,r}function de(e,t){var i=t.context,a=t.context.drawingBufferWidth,n=t.context.drawingBufferHeight,s=.3*Math.min(a,n),o=ue;o.x=a-s,o.y=0,o.width=s,o.height=s;var u=e._debugShadowViewCommand;(0,f.Z)(u)||(u=he(e,i),e._debugShadowViewCommand=u),(0,f.Z)(u.renderState)&&r.Z.equals(u.renderState.viewport,o)||(u.renderState=W.Z.fromCache({viewport:r.Z.clone(o)})),t.commandList.push(e._debugShadowViewCommand)}var ce=new Array(8);ce[0]=new u.Z(-1,-1,-1,1),ce[1]=new u.Z(1,-1,-1,1),ce[2]=new u.Z(1,1,-1,1),ce[3]=new u.Z(-1,1,-1,1),ce[4]=new u.Z(-1,-1,1,1),ce[5]=new u.Z(1,-1,1,1),ce[6]=new u.Z(1,1,1,1),ce[7]=new u.Z(-1,1,1,1);for(var me=new y.Z,pe=new Array(8),le=0;le<8;++le)pe[le]=new u.Z;function _e(e,t){var i=new v.Z({geometry:new n.Z({minimum:new o.Z(-.5,-.5,-.5),maximum:new o.Z(.5,.5,.5)}),attributes:{color:m.Z.fromColor(t)}}),r=new v.Z({geometry:new O.Z({radius:.5}),attributes:{color:m.Z.fromColor(t)}});return new G.Z({geometryInstances:[i,r],appearance:new Y.Z({translucent:!1,flat:!0}),asynchronous:!1,modelMatrix:e})}var fe=[c.Z.RED,c.Z.GREEN,c.Z.BLUE,c.Z.MAGENTA],Ze=new o.Z;function we(e,t){de(e,t);var i=e.debugFreezeFrame&&!e._debugFreezeFrame;if(e._debugFreezeFrame=e.debugFreezeFrame,e.debugFreezeFrame&&(i&&(e._debugCameraFrustum=e._debugCameraFrustum&&e._debugCameraFrustum.destroy(),e._debugCameraFrustum=new H.Z({camera:e._sceneCamera,color:c.Z.CYAN,updateOnChange:!1})),e._debugCameraFrustum.update(t)),e._cascadesEnabled){if(e.debugFreezeFrame){i&&(e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=new H.Z({camera:e._shadowMapCamera,color:c.Z.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t);for(var r=0;r<e._numberOfCascades;++r)i&&(e._debugCascadeFrustums[r]=e._debugCascadeFrustums[r]&&e._debugCascadeFrustums[r].destroy(),e._debugCascadeFrustums[r]=new H.Z({camera:e._passes[r].camera,color:fe[r],updateOnChange:!1})),e._debugCascadeFrustums[r].update(t)}}else if(e._isPointLight){if(!(0,f.Z)(e._debugLightFrustum)||e._needsUpdate){var a=e._shadowMapCamera.positionWC,n=M.Z.IDENTITY,s=2*e._pointLightRadius,u=o.Z.fromElements(s,s,s,Ze),h=y.Z.fromTranslationQuaternionRotationScale(a,n,u,me);e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=_e(h,c.Z.YELLOW)}e._debugLightFrustum.update(t)}else(0,f.Z)(e._debugLightFrustum)&&!e._needsUpdate||(e._debugLightFrustum=new H.Z({camera:e._shadowMapCamera,color:c.Z.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t)}function ge(){this.viewMatrix=new y.Z,this.inverseViewMatrix=new y.Z,this.frustum=void 0,this.positionCartographic=new h.Z,this.positionWC=new o.Z,this.directionWC=o.Z.clone(o.Z.UNIT_Z),this.upWC=o.Z.clone(o.Z.UNIT_Y),this.rightWC=o.Z.clone(o.Z.UNIT_X),this.viewProjectionMatrix=new y.Z}ge.prototype.clone=function(e){y.Z.clone(e.viewMatrix,this.viewMatrix),y.Z.clone(e.inverseViewMatrix,this.inverseViewMatrix),this.frustum=e.frustum.clone(this.frustum),h.Z.clone(e.positionCartographic,this.positionCartographic),o.Z.clone(e.positionWC,this.positionWC),o.Z.clone(e.directionWC,this.directionWC),o.Z.clone(e.upWC,this.upWC),o.Z.clone(e.rightWC,this.rightWC)};var ve=new y.Z(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);ge.prototype.getViewProjection=function(){var e=this.viewMatrix,t=this.frustum.projectionMatrix;return y.Z.multiply(t,e,this.viewProjectionMatrix),y.Z.multiply(ve,this.viewProjectionMatrix,this.viewProjectionMatrix),this.viewProjectionMatrix};var Ce=new Array(5),Se=new E.Z,ye=new Array(4),xe=new o.Z,Ee=new o.Z;function be(e,t){var i,r=e._shadowMapCamera,a=e._sceneCamera,n=a.frustum.near,s=a.frustum.far,h=e._numberOfCascades,d=s-n,c=s/n,m=.9,p=!1;t.shadowState.closestObjectSize<200&&(p=!0,m=.9);var l=ye,_=Ce;for(_[0]=n,_[h]=s,i=0;i<h;++i){var f=(i+1)/h,Z=n*Math.pow(c,f),w=n+d*f,g=S.Z.lerp(w,Z,m);_[i+1]=g,l[i]=g-_[i]}if(p){for(i=0;i<h;++i)l[i]=Math.min(l[i],e._maximumCascadeDistances[i]);var v=_[0];for(i=0;i<h-1;++i)v+=l[i],_[i+1]=v}u.Z.unpack(_,0,e._cascadeSplits[0]),u.Z.unpack(_,1,e._cascadeSplits[1]),u.Z.unpack(l,0,e._cascadeDistances);var C=r.frustum,x=C.left,E=C.right,b=C.bottom,M=C.top,O=C.near,P=C.far,A=r.positionWC,T=r.directionWC,D=r.upWC,L=a.frustum.clone(Se),N=r.getViewProjection();for(i=0;i<h;++i){L.near=_[i],L.far=_[i+1];for(var F=y.Z.multiply(L.projectionMatrix,a.viewMatrix,me),z=y.Z.inverse(F,me),R=y.Z.multiply(N,z,me),I=o.Z.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,xe),V=o.Z.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Ee),W=0;W<8;++W){var B=u.Z.clone(ce[W],pe[W]);y.Z.multiplyByVector(R,B,B),o.Z.divideByScalar(B,B.w,B),o.Z.minimumByComponent(B,I,I),o.Z.maximumByComponent(B,V,V)}I.x=Math.max(I.x,0),I.y=Math.max(I.y,0),I.z=0,V.x=Math.min(V.x,1),V.y=Math.min(V.y,1),V.z=Math.min(V.z,1);var U=e._passes[i],k=U.camera;k.clone(r);var q=k.frustum;q.left=x+I.x*(E-x),q.right=x+V.x*(E-x),q.bottom=b+I.y*(M-b),q.top=b+V.y*(M-b),q.near=O+I.z*(P-O),q.far=O+V.z*(P-O),U.cullingVolume=k.frustum.computeCullingVolume(A,T,D);var H=e._cascadeMatrices[i];y.Z.multiply(k.getViewProjection(),a.inverseViewMatrix,H),y.Z.multiply(U.textureOffsets,H,H)}}var Me=new y.Z,Oe=new o.Z,Pe=new o.Z,Ae=new o.Z;function Te(e,t){var i=e._shadowMapCamera,r=e._sceneCamera,a=y.Z.multiply(r.frustum.projectionMatrix,r.viewMatrix,me),n=y.Z.inverse(a,me),s=i.directionWC,h=r.directionWC;o.Z.equalsEpsilon(s,h,S.Z.EPSILON10)&&(h=r.upWC);var d=o.Z.cross(s,h,Oe);h=o.Z.cross(d,s,Pe),o.Z.normalize(h,h),o.Z.normalize(d,d);for(var c=o.Z.fromElements(0,0,0,Ae),m=y.Z.computeView(c,s,h,d,Me),p=y.Z.multiply(m,n,me),l=o.Z.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,xe),_=o.Z.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Ee),f=0;f<8;++f){var Z=u.Z.clone(ce[f],pe[f]);y.Z.multiplyByVector(p,Z,Z),o.Z.divideByScalar(Z,Z.w,Z),o.Z.minimumByComponent(Z,l,l),o.Z.maximumByComponent(Z,_,_)}_.z+=1e3,l.z-=10;var w=Ae;w.x=-.5*(l.x+_.x),w.y=-.5*(l.y+_.y),w.z=-_.z;var g=y.Z.fromTranslation(w,me);m=y.Z.multiply(g,m,m);var v=.5*(_.x-l.x),C=.5*(_.y-l.y),x=_.z-l.z,E=i.frustum;E.left=-v,E.right=v,E.bottom=-C,E.top=C,E.near=.01,E.far=x,y.Z.clone(m,i.viewMatrix),y.Z.inverse(m,i.inverseViewMatrix),y.Z.getTranslation(i.inverseViewMatrix,i.positionWC),t.mapProjection.ellipsoid.cartesianToCartographic(i.positionWC,i.positionCartographic),o.Z.clone(s,i.directionWC),o.Z.clone(h,i.upWC),o.Z.clone(d,i.rightWC)}var De=[new o.Z(-1,0,0),new o.Z(0,-1,0),new o.Z(0,0,-1),new o.Z(1,0,0),new o.Z(0,1,0),new o.Z(0,0,1)],Le=[new o.Z(0,-1,0),new o.Z(0,0,-1),new o.Z(0,-1,0),new o.Z(0,-1,0),new o.Z(0,0,1),new o.Z(0,-1,0)],Ne=[new o.Z(0,0,1),new o.Z(1,0,0),new o.Z(-1,0,0),new o.Z(0,0,-1),new o.Z(1,0,0),new o.Z(1,0,0)];function Fe(e,t){var i=new E.Z;i.fov=S.Z.PI_OVER_TWO,i.near=1,i.far=e._pointLightRadius,i.aspectRatio=1;for(var r=0;r<6;++r){var a=e._passes[r].camera;a.positionWC=e._shadowMapCamera.positionWC,a.positionCartographic=t.mapProjection.ellipsoid.cartesianToCartographic(a.positionWC,a.positionCartographic),a.directionWC=De[r],a.upWC=Le[r],a.rightWC=Ne[r],y.Z.computeView(a.positionWC,a.directionWC,a.upWC,a.rightWC,a.viewMatrix),y.Z.inverse(a.viewMatrix,a.inverseViewMatrix),a.frustum=i}}var ze=new o.Z,Re=new o.Z,Ie=new a.Z,Ve=Ie.center;function We(e,t){var i=e._sceneCamera,r=e._shadowMapCamera,n=Ie;if(e._cascadesEnabled){if(i.frustum.near>=e.maximumDistance)return e._outOfView=!0,void(e._needsUpdate=!1);var s=t.mapProjection.ellipsoid.geodeticSurfaceNormal(i.positionWC,ze),u=o.Z.negate(r.directionWC,Re),h=o.Z.dot(s,u);if(e.fadingEnabled){var d=S.Z.clamp(h/.1,0,1);e._darkness=S.Z.lerp(1,e.darkness,d)}else e._darkness=e.darkness;if(h<0)return e._outOfView=!0,void(e._needsUpdate=!1);e._needsUpdate=!0,e._outOfView=!1}else if(e._isPointLight)n.center=r.positionWC,n.radius=e._pointLightRadius,e._outOfView=t.cullingVolume.computeVisibility(n)===C.Z.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(n),a.Z.clone(n,e._boundingSphere);else{var c=r.frustum.far/2,m=o.Z.add(r.positionWC,o.Z.multiplyByScalar(r.directionWC,c,Ve),Ve);n.center=m,n.radius=c,e._outOfView=t.cullingVolume.computeVisibility(n)===C.Z.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(n),a.Z.clone(n,e._boundingSphere)}}function Be(e,t){var i=t.camera,r=e._lightCamera,a=e._sceneCamera,n=e._shadowMapCamera;e._cascadesEnabled?o.Z.clone(r.directionWC,n.directionWC):e._isPointLight?o.Z.clone(r.positionWC,n.positionWC):n.clone(r);var s,u,h=e._lightDirectionEC;y.Z.multiplyByPointAsVector(i.viewMatrix,n.directionWC,h),o.Z.normalize(h,h),o.Z.negate(h,h),y.Z.multiplyByPoint(i.viewMatrix,n.positionWC,e._lightPositionEC),e._lightPositionEC.w=e._pointLightRadius,e._fitNearFar?(s=Math.min(t.shadowState.nearPlane,e.maximumDistance),u=Math.min(t.shadowState.farPlane,e.maximumDistance),u=Math.max(u,s+1)):(s=i.frustum.near,u=e.maximumDistance),e._sceneCamera=k.Z.clone(i,a),i.frustum.clone(e._sceneCamera.frustum),e._sceneCamera.frustum.near=s,e._sceneCamera.frustum.far=u,e._distance=u-s,We(e,t),!e._outOfViewPrevious&&e._outOfView&&(e._needsUpdate=!0),e._outOfViewPrevious=e._outOfView}X.prototype.update=function(e){if(Be(this,e),this._needsUpdate)if(ne(this,e.context),this._isPointLight&&Fe(this,e),this._cascadesEnabled&&(Te(this,e),this._numberOfCascades>1&&be(this,e)),this._isPointLight)this._shadowMapCullingVolume=l.Z.fromBoundingSphere(this._boundingSphere);else{var t=this._shadowMapCamera,i=t.positionWC,r=t.directionWC,a=t.upWC;this._shadowMapCullingVolume=t.frustum.computeCullingVolume(i,r,a),1===this._passes.length&&this._passes[0].camera.clone(t)}if(1===this._passes.length){var n=this._sceneCamera.inverseViewMatrix;y.Z.multiply(this._shadowMapCamera.getViewProjection(),n,this._shadowMapMatrix)}this.debugShow&&we(this,e)},X.prototype.updatePass=function(e,t){se(this,e,t)};var Ue=new s.Z;function ke(e,t,i){var r=e._isPointLight?e._pointBias:i?e._terrainBias:e._primitiveBias,a={shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture},shadowMap_matrix:function(){return e._shadowMapMatrix},shadowMap_cascadeSplits:function(){return e._cascadeSplits},shadowMap_cascadeMatrices:function(){return e._cascadeMatrices},shadowMap_lightDirectionEC:function(){return e._lightDirectionEC},shadowMap_lightPositionEC:function(){return e._lightPositionEC},shadowMap_cascadeDistances:function(){return e._cascadeDistances},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var t=Ue;return t.x=1/e._textureSize.x,t.y=1/e._textureSize.y,u.Z.fromElements(t.x,t.y,r.depthBias,r.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return u.Z.fromElements(r.normalOffsetScale,e._distance,e.maximumDistance,e._darkness,this.combinedUniforms2)},combinedUniforms1:new u.Z,combinedUniforms2:new u.Z};return(0,p.Z)(t,a,!1)}function qe(e,t,i,r,a,n){var s,o,u;if((0,f.Z)(n)&&(s=n.shaderProgram,o=n.renderState,u=n.uniformMap),n=L.Z.shallowClone(i,n),n.castShadows=!0,n.receiveShadows=!1,!(0,f.Z)(s)||a!==i.shaderProgram.id||t){var h=i.shaderProgram,c=i.pass===F.Z.GLOBE,m=i.pass!==F.Z.TRANSLUCENT,p=e._isPointLight,l=e._usesDepthTexture,_=j.Z.getShadowCastShaderKeyword(p,c,l,m);if(s=r.shaderCache.getDerivedShaderProgram(h,_),!(0,f.Z)(s)){var Z=h.vertexShaderSource,w=h.fragmentShaderSource,g=j.Z.createShadowCastVertexShader(Z,p,c),v=j.Z.createShadowCastFragmentShader(w,p,l,m);s=r.shaderCache.createDerivedShaderProgram(h,_,{vertexShaderSource:g,fragmentShaderSource:v,attributeLocations:h._attributeLocations})}o=e._primitiveRenderState,p?o=e._pointRenderState:c&&(o=e._terrainRenderState);var C=i.renderState.cull.enabled;C||(o=(0,d.Z)(o,!1),o.cull=(0,d.Z)(o.cull,!1),o.cull.enabled=!1,o=W.Z.fromCache(o)),u=ke(e,i.uniformMap,c)}return n.shaderProgram=s,n.renderState=o,n.uniformMap=u,n}X.createReceiveDerivedCommand=function(e,t,i,r,a){(0,f.Z)(a)||(a={});var n=e.length>0,s=t.shaderProgram,o=s.vertexShaderSource,u=s.fragmentShaderSource,h=t.pass===F.Z.GLOBE,d=!1;if(h&&(d=t.owner.data.renderedMesh.encoding.hasVertexNormals),t.receiveShadows&&n){var c,m;(0,f.Z)(a.receiveCommand)&&(c=a.receiveCommand.shaderProgram,m=a.receiveCommand.uniformMap),a.receiveCommand=L.Z.shallowClone(t,a.receiveCommand),a.castShadows=!1,a.receiveShadows=!0;var p=a.receiveShaderCastShadows!==t.castShadows,l=a.receiveShaderProgramId!==t.shaderProgram.id;if(!(0,f.Z)(c)||l||i||p){var _=j.Z.getShadowReceiveShaderKeyword(e[0],t.castShadows,h,d);if(c=r.shaderCache.getDerivedShaderProgram(s,_),!(0,f.Z)(c)){var Z=j.Z.createShadowReceiveVertexShader(o,h,d),w=j.Z.createShadowReceiveFragmentShader(u,e[0],t.castShadows,h,d);c=r.shaderCache.createDerivedShaderProgram(s,_,{vertexShaderSource:Z,fragmentShaderSource:w,attributeLocations:s._attributeLocations})}m=ke(e[0],t.uniformMap,h)}a.receiveCommand.shaderProgram=c,a.receiveCommand.uniformMap=m,a.receiveShaderProgramId=t.shaderProgram.id,a.receiveShaderCastShadows=t.castShadows}return a},X.createCastDerivedCommand=function(e,t,i,r,a){if((0,f.Z)(a)||(a={}),t.castShadows){var n=a.castCommands;(0,f.Z)(n)||(n=a.castCommands=[]);var s=a.castShaderProgramId,o=e.length;n.length=o;for(var u=0;u<o;++u)n[u]=qe(e[u],i,t,r,s,n[u]);a.castShaderProgramId=t.shaderProgram.id}return a},X.prototype.isDestroyed=function(){return!1},X.prototype.destroy=function(){$(this),this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy(),this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy(),this._debugShadowViewCommand=this._debugShadowViewCommand&&this._debugShadowViewCommand.shaderProgram&&this._debugShadowViewCommand.shaderProgram.destroy();for(var e=0;e<this._numberOfCascades;++e)this._debugCascadeFrustums[e]=this._debugCascadeFrustums[e]&&this._debugCascadeFrustums[e].destroy();return(0,Z.Z)(this)},t["Z"]=X},2143:function(e,t,i){var r=i(82982),a=i(53642);function n(){}n.getShadowCastShaderKeyword=function(e,t,i,r){return"castShadow "+e+" "+t+" "+i+" "+r},n.createShadowCastVertexShader=function(e,t,i){var n=e.defines.slice(0),s=e.sources.slice(0);n.push("SHADOW_MAP"),i&&n.push("GENERATE_POSITION");var o=a.Z.findPositionVarying(e),u=(0,r.Z)(o);if(t&&!u){for(var h=s.length,d=0;d<h;++d)s[d]=a.Z.replaceMain(s[d],"czm_shadow_cast_main");var c="varying vec3 v_positionEC; \nvoid main() \n{ \n    czm_shadow_cast_main(); \n    v_positionEC = (czm_inverseProjection * gl_Position).xyz; \n}";s.push(c)}return new a.Z({defines:n,sources:s})},n.createShadowCastFragmentShader=function(e,t,i,n){var s=e.defines.slice(0),o=e.sources.slice(0),u=a.Z.findPositionVarying(e),h=(0,r.Z)(u);h||(u="v_positionEC");for(var d=o.length,c=0;c<d;++c)o[c]=a.Z.replaceMain(o[c],"czm_shadow_cast_main");var m="";return t&&(h||(m+="varying vec3 v_positionEC; \n"),m+="uniform vec4 shadowMap_lightPositionEC; \n"),m+=n?"void main() \n{ \n":"void main() \n{ \n    czm_shadow_cast_main(); \n    if (gl_FragColor.a == 0.0) \n    { \n       discard; \n    } \n",m+=t?"    float distance = length("+u+"); \n    if (distance >= shadowMap_lightPositionEC.w) \n    { \n        discard; \n    } \n    distance /= shadowMap_lightPositionEC.w; // radius \n    gl_FragColor = czm_packDepth(distance); \n":i?"    gl_FragColor = vec4(1.0); \n":"    gl_FragColor = czm_packDepth(gl_FragCoord.z); \n",m+="} \n",o.push(m),new a.Z({defines:s,sources:o})},n.getShadowReceiveShaderKeyword=function(e,t,i,r){var a=e._usesDepthTexture,n=e._polygonOffsetSupported,s=e._isPointLight,o=e._isSpotLight,u=e._numberOfCascades>1,h=e.debugCascadeColors,d=e.softShadows;return"receiveShadow "+a+n+s+o+u+h+d+t+i+r},n.createShadowReceiveVertexShader=function(e,t,i){var r=e.defines.slice(0),n=e.sources.slice(0);return r.push("SHADOW_MAP"),t&&(i?r.push("GENERATE_POSITION_AND_NORMAL"):r.push("GENERATE_POSITION")),new a.Z({defines:r,sources:n})},n.createShadowReceiveFragmentShader=function(e,t,i,n,s){for(var o=a.Z.findNormalVarying(e),u=!n&&(0,r.Z)(o)||n&&s,h=a.Z.findPositionVarying(e),d=(0,r.Z)(h),c=t._usesDepthTexture,m=t._polygonOffsetSupported,p=t._isPointLight,l=t._isSpotLight,_=t._numberOfCascades>1,f=t.debugCascadeColors,Z=t.softShadows,w=p?t._pointBias:n?t._terrainBias:t._primitiveBias,g=e.defines.slice(0),v=e.sources.slice(0),C=v.length,S=0;S<C;++S)v[S]=a.Z.replaceMain(v[S],"czm_shadow_receive_main");p?g.push("USE_CUBE_MAP_SHADOW"):c&&g.push("USE_SHADOW_DEPTH_TEXTURE"),Z&&!p&&g.push("USE_SOFT_SHADOWS"),_&&i&&n&&(u?g.push("ENABLE_VERTEX_LIGHTING"):g.push("ENABLE_DAYNIGHT_SHADING")),i&&w.normalShading&&u&&(g.push("USE_NORMAL_SHADING"),w.normalShadingSmooth>0&&g.push("USE_NORMAL_SHADING_SMOOTH"));var y,x="";return x+=p?"uniform samplerCube shadowMap_textureCube; \n":"uniform sampler2D shadowMap_texture; \n",y=d?"    return vec4("+h+", 1.0); \n":"#ifndef LOG_DEPTH \n    return czm_windowToEyeCoordinates(gl_FragCoord); \n#else \n    return vec4(v_logPositionEC, 1.0); \n#endif \n",x+="uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \n#ifdef LOG_DEPTH \nvarying vec3 v_logPositionEC; \n#endif \nvec4 getPositionEC() \n{ \n"+y+"} \nvec3 getNormalEC() \n{ \n"+(u?"    return normalize("+o+"); \n":"    return vec3(1.0); \n")+"} \nvoid applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) \n{ \n"+(w.normalOffset&&u?"    float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; \n    float normalOffsetScale = 1.0 - nDotL; \n    vec3 offset = normalOffset * normalOffsetScale * normalEC; \n    positionEC.xyz += offset; \n":"")+"} \n",x+="void main() \n{ \n    czm_shadow_receive_main(); \n    vec4 positionEC = getPositionEC(); \n    vec3 normalEC = getNormalEC(); \n    float depth = -positionEC.z; \n",x+="    czm_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n",n?x+="    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \n":m||(x+="    shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); \n"),x+=p?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    directionEC = normalize(directionEC); \n    float radius = shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance > radius) \n    { \n        return; \n    } \n    vec3 directionWC  = czm_inverseViewRotation * directionEC; \n    shadowParameters.depth = distance / radius; \n    shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    shadowParameters.texCoords = directionWC; \n    float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":l?"    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /= shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n":_?"    float maxDepth = shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (depth > maxDepth) \n    { \n        return; \n    } \n    // Get the cascade based on the eye-space depth \n    vec4 weights = czm_cascadeWeights(depth); \n    // Apply normal offset \n    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    // Transform position into the cascade \n    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade = max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility = mix(visibility, 1.0, fade); \n"+(f?"    // Draw cascade colors for debugging \n    gl_FragColor *= czm_cascadeColor(weights); \n":""):"    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n",x+="    gl_FragColor.rgb *= visibility; \n} \n",v.push(x),new a.Z({defines:g,sources:v})},t["Z"]=n},34125:function(e,t){var i={DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3,NUMBER_OF_SHADOW_MODES:4,castShadows:function(e){return e===i.ENABLED||e===i.CAST_ONLY},receiveShadows:function(e){return e===i.ENABLED||e===i.RECEIVE_ONLY},fromCastReceive:function(e,t){return e&&t?i.ENABLED:e?i.CAST_ONLY:t?i.RECEIVE_ONLY:i.DISABLED}};t["Z"]=Object.freeze(i)},88472:function(e,t,i){var r=i(60838),a=i(60216),n=i(51688),s=i(66553),o=i(84828),u=i(62200),h=i(82982),d=i(74938),c=i(15361),m=i(99417),p=i(72248),l=i(96190),_=i(95555),f=i(53642),Z=i(64060),w=i(52965);function g(e,t,i){s.Z.typeOf.bool("extentsCulling",e),s.Z.typeOf.bool("planarExtents",t),s.Z.typeOf.object("appearance",i),this._projectionExtentDefines={eastMostYhighDefine:"",eastMostYlowDefine:"",westMostYhighDefine:"",westMostYlowDefine:""};var r=new x;r.requiresTextureCoordinates=e,r.requiresEC=!i.flat;var a=new x;if(a.requiresTextureCoordinates=e,i instanceof Z.Z)r.requiresNormalEC=!i.flat;else{var n=i.material.shaderSource+"\n"+i.fragmentShaderSource;r.normalEC=-1!==n.indexOf("materialInput.normalEC")||-1!==n.indexOf("czm_getDefaultMaterial"),r.positionToEyeEC=-1!==n.indexOf("materialInput.positionToEyeEC"),r.tangentToEyeMatrix=-1!==n.indexOf("materialInput.tangentToEyeMatrix"),r.st=-1!==n.indexOf("materialInput.st")}this._colorShaderDependencies=r,this._pickShaderDependencies=a,this._appearance=i,this._extentsCulling=e,this._planarExtents=t}g.prototype.createFragmentShader=function(e){s.Z.typeOf.bool("columbusView2D",e);var t=this._appearance,i=this._colorShaderDependencies,r=[];e||this._planarExtents||r.push("SPHERICAL"),i.requiresEC&&r.push("REQUIRES_EC"),i.requiresWC&&r.push("REQUIRES_WC"),i.requiresTextureCoordinates&&r.push("TEXTURE_COORDINATES"),this._extentsCulling&&r.push("CULL_FRAGMENTS"),i.requiresNormalEC&&r.push("NORMAL_EC"),t instanceof Z.Z&&r.push("PER_INSTANCE_COLOR"),i.normalEC&&r.push("USES_NORMAL_EC"),i.positionToEyeEC&&r.push("USES_POSITION_TO_EYE_EC"),i.tangentToEyeMatrix&&r.push("USES_TANGENT_TO_EYE"),i.st&&r.push("USES_ST"),t.flat&&r.push("FLAT");var a="";return t instanceof Z.Z||(a=t.material.shaderSource),new f.Z({defines:r,sources:[a,w.Z]})},g.prototype.createPickFragmentShader=function(e){s.Z.typeOf.bool("columbusView2D",e);var t=this._pickShaderDependencies,i=["PICK"];return e||this._planarExtents||i.push("SPHERICAL"),t.requiresEC&&i.push("REQUIRES_EC"),t.requiresWC&&i.push("REQUIRES_WC"),t.requiresTextureCoordinates&&i.push("TEXTURE_COORDINATES"),this._extentsCulling&&i.push("CULL_FRAGMENTS"),new f.Z({defines:i,sources:[w.Z],pickColorQualifier:"varying"})},g.prototype.createVertexShader=function(e,t,i,r){return s.Z.defined("defines",e),s.Z.typeOf.string("vertexShaderSource",t),s.Z.typeOf.bool("columbusView2D",i),s.Z.defined("mapProjection",r),y(this._colorShaderDependencies,this._planarExtents,i,e,t,this._appearance,r,this._projectionExtentDefines)},g.prototype.createPickVertexShader=function(e,t,i,r){return s.Z.defined("defines",e),s.Z.typeOf.string("vertexShaderSource",t),s.Z.typeOf.bool("columbusView2D",i),s.Z.defined("mapProjection",r),y(this._pickShaderDependencies,this._planarExtents,i,e,t,void 0,r,this._projectionExtentDefines)};var v=new a.Z,C=new n.Z,S={high:0,low:0};function y(e,t,i,r,a,n,s,o){var u=r.slice();if(""===o.eastMostYhighDefine){var c=C;c.longitude=m.Z.PI,c.latitude=0,c.height=0;var p=s.project(c,v),l=d.Z.encode(p.x,S);o.eastMostYhighDefine="EAST_MOST_X_HIGH "+l.high.toFixed((l.high+"").length+1),o.eastMostYlowDefine="EAST_MOST_X_LOW "+l.low.toFixed((l.low+"").length+1);var _=C;_.longitude=-m.Z.PI,_.latitude=0,_.height=0;var w=s.project(_,v);l=d.Z.encode(w.x,S),o.westMostYhighDefine="WEST_MOST_X_HIGH "+l.high.toFixed((l.high+"").length+1),o.westMostYlowDefine="WEST_MOST_X_LOW "+l.low.toFixed((l.low+"").length+1)}return i&&(u.push(o.eastMostYhighDefine),u.push(o.eastMostYlowDefine),u.push(o.westMostYhighDefine),u.push(o.westMostYlowDefine)),(0,h.Z)(n)&&n instanceof Z.Z&&u.push("PER_INSTANCE_COLOR"),e.requiresTextureCoordinates&&(u.push("TEXTURE_COORDINATES"),t||i||u.push("SPHERICAL"),i&&u.push("COLUMBUS_VIEW_2D")),new f.Z({defines:u,sources:[a]})}function x(){this._requiresEC=!1,this._requiresWC=!1,this._requiresNormalEC=!1,this._requiresTextureCoordinates=!1,this._usesNormalEC=!1,this._usesPositionToEyeEC=!1,this._usesTangentToEyeMat=!1,this._usesSt=!1}function E(e,t,i){return Math.abs((t.y-e.y)*i.x-(t.x-e.x)*i.y+t.x*e.y-t.y*e.x)/r.Z.distance(t,e)}Object.defineProperties(x.prototype,{requiresEC:{get:function(){return this._requiresEC},set:function(e){this._requiresEC=e||this._requiresEC}},requiresWC:{get:function(){return this._requiresWC},set:function(e){this._requiresWC=e||this._requiresWC,this.requiresEC=this._requiresWC}},requiresNormalEC:{get:function(){return this._requiresNormalEC},set:function(e){this._requiresNormalEC=e||this._requiresNormalEC,this.requiresEC=this._requiresNormalEC}},requiresTextureCoordinates:{get:function(){return this._requiresTextureCoordinates},set:function(e){this._requiresTextureCoordinates=e||this._requiresTextureCoordinates,this.requiresWC=this._requiresTextureCoordinates}},normalEC:{set:function(e){this.requiresNormalEC=e,this._usesNormalEC=e},get:function(){return this._usesNormalEC}},tangentToEyeMatrix:{set:function(e){this.requiresWC=e,this.requiresNormalEC=e,this._usesTangentToEyeMat=e},get:function(){return this._usesTangentToEyeMat}},positionToEyeEC:{set:function(e){this.requiresEC=e,this._usesPositionToEyeEC=e},get:function(){return this._usesPositionToEyeEC}},st:{set:function(e){this.requiresTextureCoordinates=e,this._usesSt=e},get:function(){return this._usesSt}}});var b=[new r.Z,new r.Z,new r.Z,new r.Z];function M(e,t){var i=b,a=r.Z.unpack(t,0,i[0]),n=r.Z.unpack(t,2,i[1]),s=r.Z.unpack(t,4,i[2]);e.uMaxVmax=new c.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:4,normalize:!1,value:[n.x,n.y,s.x,s.y]});var u=1/E(a,n,s),h=1/E(a,s,n);e.uvMinAndExtents=new c.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:4,normalize:!1,value:[a.x,a.y,u,h]})}var O=new n.Z,P=new a.Z,A=new a.Z,T=new a.Z,D={high:0,low:0};function L(e,t,i){var r=O;r.height=0,r.longitude=e.west,r.latitude=e.south;var a=t.project(r,P);r.latitude=e.north;var n=t.project(r,A);r.longitude=e.east,r.latitude=e.south;var s=t.project(r,T),u=[0,0,0,0],h=[0,0,0,0],m=d.Z.encode(a.x,D);u[0]=m.high,h[0]=m.low,m=d.Z.encode(a.y,D),u[1]=m.high,h[1]=m.low,m=d.Z.encode(n.y,D),u[2]=m.high,h[2]=m.low,m=d.Z.encode(s.x,D),u[3]=m.high,h[3]=m.low,i.planes2D_HIGH=new c.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:4,normalize:!1,value:u}),i.planes2D_LOW=new c.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:4,normalize:!1,value:h})}var N=new p.Z,F=new p.Z,z=new a.Z,R=new n.Z,I=[new n.Z,new n.Z,new n.Z,new n.Z,new n.Z,new n.Z,new n.Z,new n.Z];function V(e,t,i,r,s,o){var u=l.Z.center(e,R);u.height=i;var h=n.Z.toCartesian(u,t,z),d=_.Z.eastNorthUpToFixedFrame(h,t,N),c=p.Z.inverse(d,F),m=e.west,f=e.east,Z=e.north,w=e.south,g=I;g[0].latitude=w,g[0].longitude=m,g[1].latitude=Z,g[1].longitude=m,g[2].latitude=Z,g[2].longitude=f,g[3].latitude=w,g[3].longitude=f;var v=.5*(m+f),C=.5*(Z+w);g[4].latitude=w,g[4].longitude=v,g[5].latitude=Z,g[5].longitude=v,g[6].latitude=C,g[6].longitude=m,g[7].latitude=C,g[7].longitude=f;for(var S=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,x=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,b=0;b<8;b++){g[b].height=i;var M=n.Z.toCartesian(g[b],t,z);p.Z.multiplyByPoint(c,M,M),M.z=0,S=Math.min(S,M.x),y=Math.max(y,M.x),x=Math.min(x,M.y),E=Math.max(E,M.y)}var O=r;O.x=S,O.y=x,O.z=0,p.Z.multiplyByPoint(d,O,O);var P=s;P.x=y,P.y=x,P.z=0,p.Z.multiplyByPoint(d,P,P),a.Z.subtract(P,O,s);var A=o;A.x=S,A.y=E,A.z=0,p.Z.multiplyByPoint(d,A,A),a.Z.subtract(A,O,o)}var W=new a.Z,B=new a.Z,U=new d.Z;g.getPlanarTextureCoordinateAttributes=function(e,t,i,r,n){s.Z.typeOf.object("boundingRectangle",e),s.Z.defined("textureCoordinateRotationPoints",t),s.Z.typeOf.object("ellipsoid",i),s.Z.typeOf.object("projection",r);var h=P,m=W,p=B;V(e,i,(0,u.Z)(n,0),h,m,p);var l={};M(l,t);var _=d.Z.fromCartesian(h,U);return l.southWest_HIGH=new c.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:3,normalize:!1,value:a.Z.pack(_.high,[0,0,0])}),l.southWest_LOW=new c.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:3,normalize:!1,value:a.Z.pack(_.low,[0,0,0])}),l.eastward=new c.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:3,normalize:!1,value:a.Z.pack(m,[0,0,0])}),l.northward=new c.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:3,normalize:!1,value:a.Z.pack(p,[0,0,0])}),L(e,r,l),l};var k=new a.Z;function q(e,t,i,r){var a=O;a.latitude=e,a.longitude=t,a.height=0;var s=n.Z.toCartesian(a,i,k),o=Math.sqrt(s.x*s.x+s.y*s.y),u=m.Z.fastApproximateAtan2(o,s.z),h=m.Z.fastApproximateAtan2(s.x,s.y);return r.x=u,r.y=h,r}var H=new r.Z;function Y(e){return Math.max(e.width,e.height)>g.MAX_WIDTH_FOR_PLANAR_EXTENTS}g.getSphericalExtentGeometryInstanceAttributes=function(e,t,i,r){s.Z.typeOf.object("boundingRectangle",e),s.Z.defined("textureCoordinateRotationPoints",t),s.Z.typeOf.object("ellipsoid",i),s.Z.typeOf.object("projection",r);var a=q(e.south,e.west,i,H),n=a.x,u=a.y,h=q(e.north,e.east,i,H),d=h.x,p=h.y,l=0;u>p&&(l=m.Z.PI-u,u=-m.Z.PI,p+=l),n-=m.Z.EPSILON5,u-=m.Z.EPSILON5,d+=m.Z.EPSILON5,p+=m.Z.EPSILON5;var _=1/(p-u),f=1/(d-n),Z={sphericalExtents:new c.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:4,normalize:!1,value:[n,u,f,_]}),longitudeRotation:new c.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:1,normalize:!1,value:[l]})};return M(Z,t),L(e,r,Z),Z},g.hasAttributesForTextureCoordinatePlanes=function(e){return(0,h.Z)(e.southWest_HIGH)&&(0,h.Z)(e.southWest_LOW)&&(0,h.Z)(e.northward)&&(0,h.Z)(e.eastward)&&(0,h.Z)(e.planes2D_HIGH)&&(0,h.Z)(e.planes2D_LOW)&&(0,h.Z)(e.uMaxVmax)&&(0,h.Z)(e.uvMinAndExtents)},g.hasAttributesForSphericalExtents=function(e){return(0,h.Z)(e.sphericalExtents)&&(0,h.Z)(e.longitudeRotation)&&(0,h.Z)(e.planes2D_HIGH)&&(0,h.Z)(e.planes2D_LOW)&&(0,h.Z)(e.uMaxVmax)&&(0,h.Z)(e.uvMinAndExtents)},g.shouldUseSphericalCoordinates=function(e){return s.Z.typeOf.object("rectangle",e),Y(e)},g.MAX_WIDTH_FOR_PLANAR_EXTENTS=m.Z.toRadians(1),t["Z"]=g},57018:function(e,t,i){var r=i(52975),a=i(62200),n=i(82982),s=i(12572),o=i(14459),u=i(71351),h=i(96190),d=i(68985),c=i(9407),m=i(9121),p=i(13222),l=i(95451);function _(e){if(e=(0,a.Z)(e,a.Z.EMPTY_OBJECT),!(0,n.Z)(e.url))throw new s.Z("options.url is required.");this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0;var t=d.Z.createIfNeeded(e.url),i=(0,a.Z)(e.rectangle,h.Z.MAX_VALUE),_=new u.Z({rectangle:i,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:e.ellipsoid});this._tilingScheme=_,this._resource=t,this._image=void 0,this._texture=void 0,this._tileWidth=0,this._tileHeight=0,this._errorEvent=new o.Z,this._ready=!1,this._readyPromise=p.Z.defer();var f=e.credit;"string"===typeof f&&(f=new r.Z(f)),this._credit=f;var Z,w=this;function g(e){w._image=e,w._tileWidth=e.width,w._tileHeight=e.height,w._ready=!0,w._readyPromise.resolve(!0),m.Z.handleSuccess(w._errorEvent)}function v(e){var i="Failed to load image "+t.url+".";Z=m.Z.handleError(Z,w,w._errorEvent,i,0,0,0,C,e),w._readyPromise.reject(new c.Z(i))}function C(){l.Z.loadImage(null,t).then(g).otherwise(v)}C()}Object.defineProperties(_.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){if(!this._ready)throw new s.Z("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new s.Z("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new s.Z("maximumLevel must not be called before the imagery provider is ready.");return 0}},minimumLevel:{get:function(){if(!this._ready)throw new s.Z("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new s.Z("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new s.Z("tileDiscardPolicy must not be called before the imagery provider is ready.")}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),_.prototype.getTileCredits=function(e,t,i){},_.prototype.requestImage=function(e,t,i,r){if(!this._ready)throw new s.Z("requestImage must not be called before the imagery provider is ready.");return this._image},_.prototype.pickFeatures=function(e,t,i,r,a){},t["Z"]=_},80763:function(e,t,i){var r=i(60216),a=i(62200),n=i(82982),s=i(86511),o=i(50491),u=i(64727),h=i(57552),d=i(99417),c=i(72248),m=i(67252),p=i(58597),l=i(60072),_=i(10667),f=i(46588),Z=i(53642),w=i(18192),g=i(66629),v=i(79908),C=i(4399),S=i(66577),y=i(13633),x=i(71593),E=i(89917);function b(e){e=(0,a.Z)(e,o.Z.WGS84),this.show=!0,this.perFragmentAtmosphere=!1,this._ellipsoid=e;var t=1.025,i=r.Z.multiplyByScalar(e.radii,t,new r.Z);this._scaleMatrix=c.Z.fromScale(i),this._modelMatrix=new c.Z,this._command=new l.Z({owner:this,modelMatrix:this._modelMatrix}),this._spSkyFromSpace=void 0,this._spSkyFromAtmosphere=void 0,this._flags=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this._hueSaturationBrightness=new r.Z;var n=new r.Z;n.x=e.maximumRadius*t,n.y=e.maximumRadius,n.z=0,this._radiiAndDynamicAtmosphereColor=n;var s=this;this._command.uniformMap={u_radiiAndDynamicAtmosphereColor:function(){return s._radiiAndDynamicAtmosphereColor},u_hsbShift:function(){return s._hueSaturationBrightness.x=s.hueShift,s._hueSaturationBrightness.y=s.saturationShift,s._hueSaturationBrightness.z=s.brightnessShift,s._hueSaturationBrightness}}}Object.defineProperties(b.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),b.prototype.setDynamicAtmosphereColor=function(e,t){var i=e?t?2:1:0;this._radiiAndDynamicAtmosphereColor.z=i};var M=new c.Z;function O(e){return!(d.Z.equalsEpsilon(e.hueShift,0,d.Z.EPSILON7)&&d.Z.equalsEpsilon(e.saturationShift,0,d.Z.EPSILON7)&&d.Z.equalsEpsilon(e.brightnessShift,0,d.Z.EPSILON7))}b.prototype.update=function(e,t){if(this.show){var i=e.mode;if((i===E.Z.SCENE3D||i===E.Z.MORPHING)&&e.passes.render){var a=c.Z.fromRotationTranslation(e.context.uniformState.inverseViewRotation,r.Z.ZERO,M),s=c.Z.multiplyTransformation(a,S.Z.Y_UP_TO_Z_UP,M),o=c.Z.multiply(this._scaleMatrix,s,M);c.Z.clone(o,this._modelMatrix);var d=e.context,l=O(this),b=e.globeTranslucencyState.translucent,P=this.perFragmentAtmosphere||b||!(0,n.Z)(t)||!t.show,A=this._command;if(!(0,n.Z)(A.vertexArray)){var T=u.Z.createGeometry(new u.Z({radii:new r.Z(1,1,1),slicePartitions:256,stackPartitions:256,vertexFormat:m.Z.POSITION_ONLY}));A.vertexArray=w.Z.fromGeometry({context:d,geometry:T,attributeLocations:h.Z.createAttributeLocations(T),bufferUsage:p.Z.STATIC_DRAW}),A.renderState=_.Z.fromCache({cull:{enabled:!0,face:x.Z.FRONT},blending:y.Z.ALPHA_BLEND,depthMask:!1})}var D=l|P<<2|b<<3;if(D!==this._flags){this._flags=D;var L=[];l&&L.push("COLOR_CORRECT"),P&&L.push("PER_FRAGMENT_ATMOSPHERE"),b&&L.push("GLOBE_TRANSLUCENT");var N=new Z.Z({defines:L.concat("SKY_FROM_SPACE"),sources:[g.Z,C.Z]}),F=new Z.Z({defines:L.concat("SKY_FROM_SPACE"),sources:[g.Z,v.Z]});this._spSkyFromSpace=f.Z.fromCache({context:d,vertexShaderSource:N,fragmentShaderSource:F}),N=new Z.Z({defines:L.concat("SKY_FROM_ATMOSPHERE"),sources:[g.Z,C.Z]}),F=new Z.Z({defines:L.concat("SKY_FROM_ATMOSPHERE"),sources:[g.Z,v.Z]}),this._spSkyFromAtmosphere=f.Z.fromCache({context:d,vertexShaderSource:N,fragmentShaderSource:F})}var z=e.camera.positionWC,R=r.Z.magnitude(z);return R>this._radiiAndDynamicAtmosphereColor.x?A.shaderProgram=this._spSkyFromSpace:A.shaderProgram=this._spSkyFromAtmosphere,A}}},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.destroy(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.destroy(),(0,s.Z)(this)},t["Z"]=b},78149:function(e,t,i){var r=i(20305),a=i(60216),n=i(62200),s=i(82982),o=i(86511),u=i(12572),h=i(57552),d=i(72248),c=i(67252),m=i(58597),p=i(51107),l=i(60072),_=i(93958),f=i(10667),Z=i(46588),w=i(53642),g=i(18192),v=i(81277),C=i(8910),S=i(13633),y=i(89917);function x(e){this.sources=e.sources,this._sources=void 0,this.show=(0,n.Z)(e.show,!0),this._command=new l.Z({modelMatrix:d.Z.clone(d.Z.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0}x.prototype.update=function(e,t){var i=this;if(this.show&&(e.mode===y.Z.SCENE3D||e.mode===y.Z.MORPHING)&&e.passes.render){var n=e.context;if(this._sources!==this.sources){this._sources=this.sources;var o=this.sources;if(!(0,s.Z)(o.positiveX)||!(0,s.Z)(o.negativeX)||!(0,s.Z)(o.positiveY)||!(0,s.Z)(o.negativeY)||!(0,s.Z)(o.positiveZ)||!(0,s.Z)(o.negativeZ))throw new u.Z("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof o.positiveX!==typeof o.negativeX||typeof o.positiveX!==typeof o.positiveY||typeof o.positiveX!==typeof o.negativeY||typeof o.positiveX!==typeof o.positiveZ||typeof o.positiveX!==typeof o.negativeZ)throw new u.Z("this.sources properties must all be the same type.");"string"===typeof o.positiveX?(0,_.Z)(n,this._sources).then((function(e){i._cubeMap=i._cubeMap&&i._cubeMap.destroy(),i._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new p.Z({context:n,source:o}))}var d=this._command;if(!(0,s.Z)(d.vertexArray)){d.uniformMap={u_cubeMap:function(){return i._cubeMap}};var l=r.Z.createGeometry(r.Z.fromDimensions({dimensions:new a.Z(2,2,2),vertexFormat:c.Z.POSITION_ONLY})),x=this._attributeLocations=h.Z.createAttributeLocations(l);d.vertexArray=g.Z.fromGeometry({context:n,geometry:l,attributeLocations:x,bufferUsage:m.Z.STATIC_DRAW}),d.renderState=f.Z.fromCache({blending:S.Z.ALPHA_BLEND})}if(!(0,s.Z)(d.shaderProgram)||this._useHdr!==t){var E=new w.Z({defines:[t?"HDR":""],sources:[v.Z]});d.shaderProgram=Z.Z.fromCache({context:n,vertexShaderSource:C.Z,fragmentShaderSource:E,attributeLocations:this._attributeLocations}),this._useHdr=t}if((0,s.Z)(this._cubeMap))return d}},x.prototype.isDestroyed=function(){return!1},x.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),(0,o.Z)(this)},t["Z"]=x}}]);
//# sourceMappingURL=chunk-vendors-024abbc9-legacy.e9a333a7.js.map