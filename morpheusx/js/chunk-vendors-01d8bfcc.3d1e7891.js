"use strict";(self["webpackChunkvue3_webpack5"]=self["webpackChunkvue3_webpack5"]||[]).push([[798],{7164:function(e,t,i){var a=i(60838),n=i(60216),s=i(63367),r=i(8182),o=i(84828),h=i(82982),c=i(86511),l=i(12572),u=i(38443),_=i(20521),d=i(21572),f=i(87721),p=i(8743);function Z(e,t,i){if(!(0,h.Z)(e))throw new l.Z("context is required");if(!(0,h.Z)(t))throw new l.Z("attributes is required");if(!(0,h.Z)(i))throw new l.Z("numberOfInstances is required");if(this._attributes=t,this._numberOfInstances=i,0!==t.length){var n=b(t),r=e.floatingPointTexture,o=n===d.Z.FLOAT&&!r,c=g(t,o),u=y(c,t,o),f=Math.floor(_.Z.maximumTextureSize/u),p=Math.min(i,f),Z=u*p,m=Math.ceil(i/p),x=1/Z,T=.5*x,v=1/m,D=.5*v;this._textureDimensions=new a.Z(Z,m),this._textureStep=new s.Z(x,T,v,D),this._pixelDatatype=o?d.Z.UNSIGNED_BYTE:n,this._packFloats=o,this._offsets=c,this._stride=u,this._texture=void 0;var A=4*Z*m;this._batchValues=n!==d.Z.FLOAT||o?new Uint8Array(A):new Float32Array(A),this._batchValuesDirty=!1}}function b(e){for(var t=!1,i=e.length,a=0;a<i;++a)if(e[a].componentDatatype!==o.Z.UNSIGNED_BYTE){t=!0;break}return t?d.Z.FLOAT:d.Z.UNSIGNED_BYTE}function m(e,t){var i=e[t].componentsPerAttribute;return 2===i?a.Z:3===i?n.Z:4===i?s.Z:Number}function g(e,t){for(var i=new Array(e.length),a=0,n=e.length,s=0;s<n;++s){var r=e[s],h=r.componentDatatype;i[s]=a,h!==o.Z.UNSIGNED_BYTE&&t?a+=4:++a}return i}function y(e,t,i){var a=e.length,n=e[a-1],s=t[a-1],r=s.componentDatatype;return r!==o.Z.UNSIGNED_BYTE&&i?n+4:n+1}Object.defineProperties(Z.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});var x=new s.Z;function T(e,t,i){var a=s.Z.unpack(e,t,x),n=s.Z.unpackFloat(a);a=s.Z.unpack(e,t+4,x);var r=s.Z.unpackFloat(a);a=s.Z.unpack(e,t+8,x);var o=s.Z.unpackFloat(a);a=s.Z.unpack(e,t+12,x);var h=s.Z.unpackFloat(a);return s.Z.fromElements(n,r,o,h,i)}function v(e,t,i){var a=s.Z.packFloat(e.x,x);s.Z.pack(a,t,i),a=s.Z.packFloat(e.y,a),s.Z.pack(a,t,i+4),a=s.Z.packFloat(e.z,a),s.Z.pack(a,t,i+8),a=s.Z.packFloat(e.w,a),s.Z.pack(a,t,i+12)}var D=new s.Z;Z.prototype.getBatchedAttribute=function(e,t,i){if(e<0||e>=this._numberOfInstances)throw new l.Z("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new l.Z("attributeIndex is out of range");var a,n=this._attributes,r=this._offsets[t],o=this._stride,c=4*o*e+4*r;a=this._packFloats&&n[t].componentDatatype!==d.Z.UNSIGNED_BYTE?T(this._batchValues,c,D):s.Z.unpack(this._batchValues,c,D);var u=m(n,t);return(0,h.Z)(u.fromCartesian4)?u.fromCartesian4(a,i):(0,h.Z)(u.clone)?u.clone(a,i):a.x};var A=[void 0,void 0,new a.Z,new n.Z,new s.Z],I=new s.Z;function C(e,t){var i=e._textureDimensions;e._texture=new p.Z({context:t,pixelFormat:u.Z.RGBA,pixelDatatype:e._pixelDatatype,width:i.x,height:i.y,sampler:f.Z.NEAREST,flipY:!1})}function S(e){var t=e._textureDimensions;e._texture.copyFrom({source:{width:t.x,height:t.y,arrayBufferView:e._batchValues}})}function E(e){var t=e._stride;return 1===e._textureDimensions.y?"uniform vec4 batchTextureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float numberOfAttributes = float("+t+"); \n    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); \n} \n":"uniform vec4 batchTextureStep; \nuniform vec2 batchTextureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float stepY = batchTextureStep.z; \n    float centerY = batchTextureStep.w; \n    float numberOfAttributes = float("+t+"); \n    float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x); \n    float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n"}function O(e){return 1===e?"float":"vec"+e}function w(e){return 1===e?".x":2===e?".xy":3===e?".xyz":""}function N(e,t){var i=e._attributes,a=i[t],n=a.componentsPerAttribute,s=a.functionName,r=O(n),h=w(n),c=e._offsets[t],l=r+" "+s+"(float batchId) \n{ \n    vec2 st = computeSt(batchId); \n    st.x += batchTextureStep.x * float("+c+"); \n";return e._packFloats&&a.componentDatatype!==d.Z.UNSIGNED_BYTE?l+="vec4 textureValue; \ntextureValue.x = czm_unpackFloat(texture2D(batchTexture, st)); \ntextureValue.y = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x, 0.0))); \ntextureValue.z = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); \ntextureValue.w = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); \n":l+="    vec4 textureValue = texture2D(batchTexture, st); \n",l+="    "+r+" value = textureValue"+h+"; \n",e._pixelDatatype!==d.Z.UNSIGNED_BYTE||a.componentDatatype!==o.Z.UNSIGNED_BYTE||a.normalize?e._pixelDatatype===d.Z.FLOAT&&a.componentDatatype===o.Z.UNSIGNED_BYTE&&a.normalize&&(l+="value /= 255.0; \n"):l+="value *= 255.0; \n",l+="    return value; \n} \n",l}Z.prototype.setBatchedAttribute=function(e,t,i){if(e<0||e>=this._numberOfInstances)throw new l.Z("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new l.Z("attributeIndex is out of range");if(!(0,h.Z)(i))throw new l.Z("value is required.");var a=this._attributes,n=A[a[t].componentsPerAttribute],r=this.getBatchedAttribute(e,t,n),o=m(this._attributes,t),c=(0,h.Z)(o.equals)?o.equals(r,i):r===i;if(!c){var u=I;u.x=(0,h.Z)(i.x)?i.x:i,u.y=(0,h.Z)(i.y)?i.y:0,u.z=(0,h.Z)(i.z)?i.z:0,u.w=(0,h.Z)(i.w)?i.w:0;var _=this._offsets[t],f=this._stride,p=4*f*e+4*_;this._packFloats&&a[t].componentDatatype!==d.Z.UNSIGNED_BYTE?v(u,this._batchValues,p):s.Z.pack(u,this._batchValues,p),this._batchValuesDirty=!0}},Z.prototype.update=function(e){(0,h.Z)(this._texture)&&!this._batchValuesDirty||0===this._attributes.length||(this._batchValuesDirty=!1,(0,h.Z)(this._texture)||C(this,e.context),S(this))},Z.prototype.getUniformMapCallback=function(){var e=this;return function(t){if(0===e._attributes.length)return t;var i={batchTexture:function(){return e._texture},batchTextureDimensions:function(){return e._textureDimensions},batchTextureStep:function(){return e._textureStep}};return(0,r.Z)(t,i)}},Z.prototype.getVertexShaderCallback=function(){var e=this._attributes;if(0===e.length)return function(e){return e};var t="uniform highp sampler2D batchTexture; \n";t+=E(this)+"\n";for(var i=e.length,a=0;a<i;++a)t+=N(this,a);return function(e){var i=e.indexOf("void main"),a=e.substring(0,i),n=e.substring(i);return a+"\n"+t+"\n"+n}},Z.prototype.isDestroyed=function(){return!1},Z.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),(0,c.Z)(this)},t["Z"]=Z},40384:function(e,t,i){i.d(t,{Z:function(){return f}});var a=i(23401),n=i(77072),s=i(66553),r=i(83856),o=i(8182),h=i(84828),c=i(82982),l=i(62200),u=i(12572),_=i(17041),d=i(9407);function f(e){this._classes=void 0,this._classIds=void 0,this._classIndexes=void 0,this._parentCounts=void 0,this._parentIndexes=void 0,this._parentIds=void 0,s.Z.typeOf.object("options.extension",e.extension),p(this,e.extension,e.binaryBody),m(this)}function p(e,t,i){var s,r,u,d,f=t.instancesLength,p=t.classes,b=t.classIds,m=t.parentCounts,g=t.parentIds,y=f;if((0,c.Z)(b.byteOffset)&&(b.componentType=(0,l.Z)(b.componentType,h.Z.UNSIGNED_SHORT),b.type=n.Z.SCALAR,u=(0,_.Z)(b),b=u.createArrayBufferView(i.buffer,i.byteOffset+b.byteOffset,f)),(0,c.Z)(m))for((0,c.Z)(m.byteOffset)&&(m.componentType=(0,l.Z)(m.componentType,h.Z.UNSIGNED_SHORT),m.type=n.Z.SCALAR,u=(0,_.Z)(m),m=u.createArrayBufferView(i.buffer,i.byteOffset+m.byteOffset,f)),d=new Uint16Array(f),y=0,s=0;s<f;++s)d[s]=y,y+=m[s];(0,c.Z)(g)&&(0,c.Z)(g.byteOffset)&&(g.componentType=(0,l.Z)(g.componentType,h.Z.UNSIGNED_SHORT),g.type=n.Z.SCALAR,u=(0,_.Z)(g),g=u.createArrayBufferView(i.buffer,i.byteOffset+g.byteOffset,y));var x=p.length;for(s=0;s<x;++s){var T=p[s].length,v=p[s].instances,D=Z(T,v,i);p[s].instances=(0,o.Z)(D,v)}var A=(0,a.Z)(new Array(x),0),I=new Uint16Array(f);for(s=0;s<f;++s)r=b[s],I[s]=A[r],++A[r];e._classes=p,e._classIds=b,e._classIndexes=I,e._parentCounts=m,e._parentIndexes=d,e._parentIds=g}function Z(e,t,i){var a;for(var n in t)if(t.hasOwnProperty(n)){var s=t[n],r=s.byteOffset;if((0,c.Z)(r)){var o=s.componentType,h=s.type;if(!(0,c.Z)(o))throw new d.Z("componentType is required.");if(!(0,c.Z)(h))throw new d.Z("type is required.");if(!(0,c.Z)(i))throw new d.Z("Property "+n+" requires a batch table binary.");var l=(0,_.Z)(s),u=l.componentsPerAttribute,f=l.classType,p=l.createArrayBufferView(i.buffer,i.byteOffset+r,e);(0,c.Z)(a)||(a={}),a[n]={typedArray:p,componentCount:u,type:f}}}return a}var b=[];function m(e){var t=b;t.length=0;for(var i=e._classIds,a=i.length,n=0;n<a;++n)g(e,n,t)}function g(e,t,i){var a=e._parentCounts,n=e._parentIds,s=e._parentIndexes,r=e._classIds,o=r.length;if((0,c.Z)(n)){if(t>=o)throw new u.Z("Parent index "+t+" exceeds the total number of instances: "+o);if(i.indexOf(t)>-1)throw new u.Z("Circular dependency detected in the batch table hierarchy.");i.push(t);for(var h=(0,c.Z)(a)?a[t]:1,l=(0,c.Z)(a)?s[t]:t,_=0;_<h;++_){var d=n[l+_];d!==t&&g(e,d,i)}i.pop(t)}}var y=[],x=[],T=0;function v(e,t,i){var a=e._classIds,n=e._parentCounts,s=e._parentIds,r=e._parentIndexes,o=a.length,h=y;h.length=Math.max(h.length,o);var l=++T,u=x;u.length=0,u.push(t);while(u.length>0)if(t=u.pop(),h[t]!==l){h[t]=l;var _=i(e,t);if((0,c.Z)(_))return _;for(var d=n[t],f=r[t],p=0;p<d;++p){var Z=s[f+p];Z!==t&&u.push(Z)}}}function D(e,t,i){var a=!0;while(a){var n=i(e,t);if((0,c.Z)(n))return n;var s=e._parentIds[t];a=s!==t,t=s}}function A(e,t,i){var a=e._parentCounts,n=e._parentIds;return(0,c.Z)(n)?(0,c.Z)(a)?v(e,t,i):D(e,t,i):i(e,t)}function I(e,t){var i=e.typedArray,a=e.componentCount;return 1===a?i[t]:e.type.unpack(i,t*a)}function C(e,t,i){var a=e.typedArray,n=e.componentCount;1===n?a[t]=i:e.type.pack(i,a,t*n)}f.prototype.hasProperty=function(e,t){var i=A(this,e,(function(e,i){var a=e._classIds[i],n=e._classes[a].instances;if((0,c.Z)(n[t]))return!0}));return(0,c.Z)(i)},f.prototype.propertyExists=function(e){for(var t=this._classes,i=t.length,a=0;a<i;++a){var n=t[a].instances;if((0,c.Z)(n[e]))return!0}return!1},f.prototype.getPropertyIds=function(e,t){return t=(0,c.Z)(t)?t:[],t.length=0,A(this,e,(function(e,i){var a=e._classIds[i],n=e._classes[a].instances;for(var s in n)n.hasOwnProperty(s)&&-1===t.indexOf(s)&&t.push(s)})),t},f.prototype.getProperty=function(e,t){return A(this,e,(function(e,i){var a=e._classIds[i],n=e._classes[a],s=e._classIndexes[i],o=n.instances[t];if((0,c.Z)(o))return(0,c.Z)(o.typedArray)?I(o,s):(0,r.Z)(o[s],!0)}))},f.prototype.setProperty=function(e,t,i){var a=A(this,e,(function(a,n){var s=a._classIds[n],o=a._classes[s],h=a._classIndexes[n],l=o.instances[t];if((0,c.Z)(l)){if(n!==e)throw new u.Z('Inherited property "'+t+'" is read-only.');return(0,c.Z)(l.typedArray)?C(l,h,i):l[h]=(0,r.Z)(i,!0),!0}}));return(0,c.Z)(a)},f.prototype.isClass=function(e,t){var i=A(this,e,(function(e,i){var a=e._classIds[i],n=e._classes[a];if(n.name===t)return!0}));return(0,c.Z)(i)},f.prototype.getClassName=function(e){var t=this._classIds[e],i=this._classes[t];return i.name}},31937:function(e,t,i){i.d(t,{Z:function(){return Z}});var a=i(23401),n=i(60838),s=i(63367),r=i(66553),o=i(59947),h=i(82982),c=i(86511),l=i(12572),u=i(38443),_=i(20521),d=i(21572),f=i(87721),p=i(8743);function Z(e){r.Z.typeOf.number("options.featuresLength",e.featuresLength),r.Z.typeOf.object("options.content",e.content);var t,i,a=e.featuresLength;if(this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._pickTexture=void 0,this._pickIds=[],a>0){var o=Math.min(a,_.Z.maximumTextureSize),h=Math.ceil(a/_.Z.maximumTextureSize),c=1/o,l=.5*c,u=1/h,d=.5*u;t=new n.Z(o,h),i=new s.Z(c,l,u,d)}this._translucentFeaturesLength=0,this._featuresLength=a,this._textureDimensions=t,this._textureStep=i,this._content=e.content,this._colorChangedCallback=e.colorChangedCallback}function b(e){var t=e._textureDimensions;return t.x*t.y*4}function m(e){if(!(0,h.Z)(e._batchValues)){var t=b(e),i=new Uint8Array(t);(0,a.Z)(i,255),e._batchValues=i}return e._batchValues}function g(e){if(!(0,h.Z)(e._showAlphaProperties)){var t=2*e._featuresLength,i=new Uint8Array(t);(0,a.Z)(i,255),e._showAlphaProperties=i}return e._showAlphaProperties}function y(e,t){if(!(0,h.Z)(e)||e<0||e>=t)throw new l.Z("batchId is required and between zero and featuresLength - 1 ("+t-NaN)}Object.defineProperties(Z.prototype,{translucentFeaturesLength:{get:function(){return this._translucentFeaturesLength}},memorySizeInBytes:{get:function(){var e=0;return(0,h.Z)(this._pickTexture)&&(e+=this._pickTexture.sizeInBytes),(0,h.Z)(this._batchTexture)&&(e+=this._batchTexture.sizeInBytes),e}},textureDimensions:{get:function(){return this._textureDimensions}},textureStep:{get:function(){return this._textureStep}},batchTexture:{get:function(){return this._batchTexture}},defaultTexture:{get:function(){return this._defaultTexture}},pickTexture:{get:function(){return this._pickTexture}}}),Z.DEFAULT_COLOR_VALUE=o.Z.WHITE,Z.DEFAULT_SHOW_VALUE=!0,Z.prototype.setShow=function(e,t){if(y(e,this._featuresLength),r.Z.typeOf.bool("show",t),!t||(0,h.Z)(this._showAlphaProperties)){var i=g(this),a=2*e,n=t?255:0;if(i[a]!==n){i[a]=n;var s=m(this),o=4*e+3;s[o]=t?i[a+1]:0,this._batchValuesDirty=!0}}},Z.prototype.setAllShow=function(e){r.Z.typeOf.bool("show",e);for(var t=this._featuresLength,i=0;i<t;++i)this.setShow(i,e)},Z.prototype.getShow=function(e){if(y(e,this._featuresLength),!(0,h.Z)(this._showAlphaProperties))return!0;var t=2*e;return 255===this._showAlphaProperties[t]};var x=new Array(4);function T(e,t,i){var a=e._textureDimensions;return new p.Z({context:t,pixelFormat:u.Z.RGBA,pixelDatatype:d.Z.UNSIGNED_BYTE,source:{width:a.x,height:a.y,arrayBufferView:i},flipY:!1,sampler:f.Z.NEAREST})}function v(e,t){var i=e._featuresLength;if(!(0,h.Z)(e._pickTexture)&&i>0){for(var a=e._pickIds,n=b(e),s=new Uint8Array(n),r=e._content,c=0;c<i;++c){var l=t.createPickId(r.getFeature(c));a.push(l);var u=l.color,_=4*c;s[_]=o.Z.floatToByte(u.red),s[_+1]=o.Z.floatToByte(u.green),s[_+2]=o.Z.floatToByte(u.blue),s[_+3]=o.Z.floatToByte(u.alpha)}e._pickTexture=T(e,t,s),r.tileset._statistics.batchTableByteLength+=e._pickTexture.sizeInBytes}}function D(e){var t=e._textureDimensions;e._batchTexture.copyFrom({source:{width:t.x,height:t.y,arrayBufferView:e._batchValues}})}Z.prototype.setColor=function(e,t){if(y(e,this._featuresLength),r.Z.typeOf.object("color",t),!o.Z.equals(t,Z.DEFAULT_COLOR_VALUE)||(0,h.Z)(this._batchValues)){var i=t.toBytes(x),a=i[3],n=m(this),s=4*e,c=g(this),l=2*e;if(n[s]!==i[0]||n[s+1]!==i[1]||n[s+2]!==i[2]||c[l+1]!==a){n[s]=i[0],n[s+1]=i[1],n[s+2]=i[2];var u=255!==c[l+1],_=0!==c[l];n[s+3]=_?a:0,c[l+1]=a;var d=255!==a;d&&!u?++this._translucentFeaturesLength:!d&&u&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,(0,h.Z)(this._colorChangedCallback)&&this._colorChangedCallback(e,t)}}},Z.prototype.setAllColor=function(e){r.Z.typeOf.object("color",e);for(var t=this._featuresLength,i=0;i<t;++i)this.setColor(i,e)},Z.prototype.getColor=function(e,t){if(y(e,this._featuresLength),r.Z.typeOf.object("result",t),!(0,h.Z)(this._batchValues))return o.Z.clone(Z.DEFAULT_COLOR_VALUE,t);var i=this._batchValues,a=4*e,n=this._showAlphaProperties,s=2*e;return o.Z.fromBytes(i[a],i[a+1],i[a+2],n[s+1],t)},Z.prototype.getPickColor=function(e){return y(e,this._featuresLength),this._pickIds[e]},Z.prototype.update=function(e,t){var i=t.context;this._defaultTexture=i.defaultTexture;var a=t.passes;(a.pick||a.postProcess)&&v(this,i),this._batchValuesDirty&&(this._batchValuesDirty=!1,(0,h.Z)(this._batchTexture)||(this._batchTexture=T(this,i,this._batchValues),e._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes),D(this))},Z.prototype.isDestroyed=function(){return!1},Z.prototype.destroy=function(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();for(var e=this._pickIds,t=e.length,i=0;i<t;++i)e[i].destroy();return(0,c.Z)(this)}},68524:function(e,t,i){var a=i(60216),n=i(59947),s=i(8182),r=i(84828),o=i(62200),h=i(82982),c=i(11954),l=i(86511),u=i(12572),_=i(54862),d=i(12540),f=i(72248),p=i(82968),Z=i(9407),b=i(8379),m=i(66577),g=i(84020),y=i(52381),x=i(79553),T=i(40370),v=i(16626),D=i(61841),A=i(46521),I=i(15322);function C(e,t,i,a,n){this._tileset=e,this._tile=t,this._resource=i,this._model=void 0,this._batchTable=void 0,this._features=void 0,this._classificationType=e.vectorClassificationOnly?void 0:e.classificationType,this._batchIdAttributeName=void 0,this._diffuseAttributeOrUniformName={},this._rtcCenterTransform=void 0,this._contentModelMatrix=void 0,this.featurePropertiesDirty=!1,this._groupMetadata=void 0,P(this,a,n)}C._deprecationWarning=c.Z,Object.defineProperties(C.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return this._model.pointsLength}},trianglesLength:{get:function(){return this._model.trianglesLength}},geometryByteLength:{get:function(){return this._model.geometryByteLength}},texturesByteLength:{get:function(){return this._model.texturesByteLength}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._model.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}},groupMetadata:{get:function(){return this._groupMetadata},set:function(e){this._groupMetadata=e}}});var S=Uint32Array.BYTES_PER_ELEMENT;function E(e){var t=I.Z.getAttributeOrUniformBySemantic(e,"_BATCHID");return(0,h.Z)(t)||(t=I.Z.getAttributeOrUniformBySemantic(e,"BATCHID"),(0,h.Z)(t)&&C._deprecationWarning("b3dm-legacy-batchid","The glTF in this b3dm uses the semantic `BATCHID`. Application-specific semantics should be prefixed with an underscore: `_BATCHID`.")),t}function O(e){return function(t,i){var a=e._batchTable,n=!(0,h.Z)(e._classificationType),s=e._model.gltf;(0,h.Z)(s)&&(e._batchIdAttributeName=E(s),e._diffuseAttributeOrUniformName[i]=I.Z.getDiffuseAttributeOrUniform(s,i));var r=a.getVertexShaderCallback(n,e._batchIdAttributeName,e._diffuseAttributeOrUniformName[i]);return(0,h.Z)(r)?r(t):t}}function w(e){return function(t,i){var a=e._batchTable,n=!(0,h.Z)(e._classificationType),s=e._model.gltf;(0,h.Z)(s)&&(e._diffuseAttributeOrUniformName[i]=I.Z.getDiffuseAttributeOrUniform(s,i));var r=a.getFragmentShaderCallback(n,e._diffuseAttributeOrUniformName[i],!1);return(0,h.Z)(r)?r(t):t}}function N(e){return function(){return e._batchTable.getPickId()}}function B(e){return function(t){var i=e._batchTable,a=i.getClassificationFragmentShaderCallback();return(0,h.Z)(a)?a(t):t}}function L(e){return function(t,i){e._model.updateCommands(t,i)}}function P(e,t,i){var n=e._tileset,c=e._tile,l=e._resource,u=(0,o.Z)(i,0);i=u;var y=new Uint8Array(t),I=new DataView(t);i+=S;var E=I.getUint32(i,!0);if(1!==E)throw new Z.Z("Only Batched 3D Model version 1 is supported.  Version "+E+" is not.");i+=S;var P=I.getUint32(i,!0);i+=S;var R=I.getUint32(i,!0);i+=S;var U=I.getUint32(i,!0);i+=S;var k=I.getUint32(i,!0);i+=S;var F,M,V=I.getUint32(i,!0);i+=S,k>=570425344?(i-=2*S,F=R,k=U,V=0,R=0,U=0,C._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel.")):V>=570425344&&(i-=S,F=k,k=R,V=U,R=0,U=0,C._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel.")),0===R?M={BATCH_LENGTH:(0,o.Z)(F,0)}:(M=(0,d.Z)(y,i,R),i+=R);var H=new Uint8Array(t,i,U);i+=U;var z,G,W,X=new x.Z(M,H);F=X.getGlobalProperty("BATCH_LENGTH"),X.featuresLength=F,k>0&&(z=(0,d.Z)(y,i,k),i+=k,V>0&&(G=new Uint8Array(t,i,V),G=new Uint8Array(G),i+=V)),(0,h.Z)(e._classificationType)&&(W=L(e));var q=new g.Z(e,F,z,G,W);e._batchTable=q;var Y,j=u+P-i;if(0===j)throw new Z.Z("glTF byte length must be greater than 0.");i%4===0?Y=new Uint8Array(t,i,j):(C._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),Y=new Uint8Array(y.subarray(i,i+j)));var Q={content:e,primitive:n};e._rtcCenterTransform=f.Z.IDENTITY;var K=X.getGlobalProperty("RTC_CENTER",r.Z.FLOAT,3);if((0,h.Z)(K)&&(e._rtcCenterTransform=f.Z.fromTranslation(a.Z.fromArray(K))),e._contentModelMatrix=f.Z.multiply(c.computedTransform,e._rtcCenterTransform,new f.Z),(0,h.Z)(e._classificationType))e._model=new T.Z({gltf:Y,cull:!1,basePath:l,requestType:p.Z.TILES3D,modelMatrix:e._contentModelMatrix,upAxis:n._gltfUpAxis,forwardAxis:m.Z.X,debugWireframe:n.debugWireframe,vertexShaderLoaded:O(e),classificationShaderLoaded:B(e),uniformMapLoaded:q.getUniformMapCallback(),pickIdLoaded:N(e),classificationType:e._classificationType,batchTable:q});else{var J={gltf:Y,cull:!1,releaseGltfJson:!0,opaquePass:b.Z.CESIUM_3D_TILE,basePath:l,modelMatrix:e._contentModelMatrix,upAxis:n._gltfUpAxis,forwardAxis:m.Z.X,incrementallyLoadTextures:!1};_.Z.enableModelExperimental?(J.customShader=n.customShader,e._model=A.Z.fromGltf(J)):(J=(0,s.Z)(J,{requestType:p.Z.TILES3D,shadows:n.shadows,debugWireframe:n.debugWireframe,vertexShaderLoaded:O(e),fragmentShaderLoaded:w(e),uniformMapLoaded:q.getUniformMapCallback(),pickIdLoaded:N(e),addBatchIdToGeneratedShaders:F>0,pickObject:Q,imageBasedLightingFactor:n.imageBasedLightingFactor,lightColor:n.lightColor,luminanceAtZenith:n.luminanceAtZenith,sphericalHarmonicCoefficients:n.sphericalHarmonicCoefficients,specularEnvironmentMaps:n.specularEnvironmentMaps,backFaceCulling:n.backFaceCulling,showOutline:n.showOutline}),e._model=new v.Z(J)),e._model.readyPromise.then((function(e){(0,h.Z)(e.activeAnimations)&&e.activeAnimations.addAll({loop:D.Z.REPEAT})}))}}function R(e){var t=e.featuresLength;if(!(0,h.Z)(e._features)&&t>0){for(var i=new Array(t),a=0;a<t;++a)i[a]=new y.Z(e,a);e._features=i}}C.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},C.prototype.getFeature=function(e){var t=this.featuresLength;if(!(0,h.Z)(e)||e<0||e>=t)throw new u.Z("batchId is required and between zero and featuresLength - 1 ("+(t-1)+").");return R(this),this._features[e]},C.prototype.applyDebugSettings=function(e,t){t=e?t:n.Z.WHITE,0===this.featuresLength?this._model.color=t:this._batchTable.setAllColor(t)},C.prototype.applyStyle=function(e){if(0===this.featuresLength){var t=(0,h.Z)(e)&&(0,h.Z)(e.color),i=(0,h.Z)(e)&&(0,h.Z)(e.show);this._model.color=t?e.color.evaluateColor(void 0,this._model.color):n.Z.clone(n.Z.WHITE,this._model.color),this._model.show=!i||e.show.evaluate(void 0)}else this._batchTable.applyStyle(e)},C.prototype.update=function(e,t){var i=t.commandList.length,a=this._model,n=this._tile,s=this._batchTable;s.update(e,t),this._contentModelMatrix=f.Z.multiply(n.computedTransform,this._rtcCenterTransform,this._contentModelMatrix),a.modelMatrix=this._contentModelMatrix,a.shadows=e.shadows,a.imageBasedLightingFactor=e.imageBasedLightingFactor,a.lightColor=e.lightColor,a.luminanceAtZenith=e.luminanceAtZenith,a.sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,a.specularEnvironmentMaps=e.specularEnvironmentMaps,a.backFaceCulling=e.backFaceCulling,a.debugWireframe=e.debugWireframe;var r=e.clippingPlanes;a.referenceMatrix=e.clippingPlanesOriginMatrix,(0,h.Z)(r)&&n.clippingPlanesDirty&&(a._clippingPlanes=r.enabled&&n._isClipped?r:void 0),(0,h.Z)(r)&&(0,h.Z)(a._clippingPlanes)&&a._clippingPlanes!==r&&(a._clippingPlanes=r),a.update(t);var o=t.commandList.length;i<o&&(t.passes.render||t.passes.pick)&&!(0,h.Z)(this._classificationType)&&s.addDerivedCommands(t,i)},C.prototype.isDestroyed=function(){return!1},C.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),(0,l.Z)(this)},t["Z"]=C},80349:function(e,t,i){var a=i(88108),n=i(60838),s=i(60216),r=i(63367),o=i(51688),h=i(66553),c=i(59947),l=i(39960),u=i(62200),_=i(82982),d=i(12572),f=i(47861),p=i(72248),Z=i(15720),b=i(68985),m=i(4260),g=i(62919),y=i(89917),x=i(48244),T=i(60473);function v(e,t){if(e=(0,u.Z)(e,u.Z.EMPTY_OBJECT),(0,_.Z)(e.disableDepthTestDistance)&&e.disableDepthTestDistance<0)throw new d.Z("disableDepthTestDistance must be greater than or equal to 0.0.");var i=e.translucencyByDistance,a=e.pixelOffsetScaleByDistance,r=e.scaleByDistance,o=e.distanceDisplayCondition;if((0,_.Z)(i)){if(i.far<=i.near)throw new d.Z("translucencyByDistance.far must be greater than translucencyByDistance.near.");i=Z.Z.clone(i)}if((0,_.Z)(a)){if(a.far<=a.near)throw new d.Z("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");a=Z.Z.clone(a)}if((0,_.Z)(r)){if(r.far<=r.near)throw new d.Z("scaleByDistance.far must be greater than scaleByDistance.near.");r=Z.Z.clone(r)}if((0,_.Z)(o)){if(o.far<=o.near)throw new d.Z("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");o=f.Z.clone(o)}this._show=(0,u.Z)(e.show,!0),this._position=s.Z.clone((0,u.Z)(e.position,s.Z.ZERO)),this._actualPosition=s.Z.clone(this._position),this._pixelOffset=n.Z.clone((0,u.Z)(e.pixelOffset,n.Z.ZERO)),this._translate=new n.Z(0,0),this._eyeOffset=s.Z.clone((0,u.Z)(e.eyeOffset,s.Z.ZERO)),this._heightReference=(0,u.Z)(e.heightReference,m.Z.NONE),this._verticalOrigin=(0,u.Z)(e.verticalOrigin,T.Z.CENTER),this._horizontalOrigin=(0,u.Z)(e.horizontalOrigin,g.Z.CENTER),this._scale=(0,u.Z)(e.scale,1),this._color=c.Z.clone((0,u.Z)(e.color,c.Z.WHITE)),this._rotation=(0,u.Z)(e.rotation,0),this._alignedAxis=s.Z.clone((0,u.Z)(e.alignedAxis,s.Z.ZERO)),this._width=e.width,this._height=e.height,this._scaleByDistance=r,this._translucencyByDistance=i,this._pixelOffsetScaleByDistance=a,this._sizeInMeters=(0,u.Z)(e.sizeInMeters,!1),this._distanceDisplayCondition=o,this._disableDepthTestDistance=e.disableDepthTestDistance,this._id=e.id,this._collection=(0,u.Z)(e.collection,t),this._pickId=void 0,this._pickPrimitive=(0,u.Z)(e._pickPrimitive,this),this._billboardCollection=t,this._dirty=!1,this._index=-1,this._batchIndex=void 0,this._imageIndex=-1,this._imageIndexPromise=void 0,this._imageId=void 0,this._image=void 0,this._imageSubRegion=void 0,this._imageWidth=void 0,this._imageHeight=void 0,this._labelDimensions=void 0,this._labelHorizontalOrigin=void 0,this._labelTranslate=void 0;var h=e.image,p=e.imageId;(0,_.Z)(h)&&((0,_.Z)(p)||(p="string"===typeof h?h:(0,_.Z)(h.src)?h.src:(0,l.Z)()),this._imageId=p,this._image=h),(0,_.Z)(e.imageSubRegion)&&(this._imageId=p,this._imageSubRegion=e.imageSubRegion),(0,_.Z)(this._billboardCollection._textureAtlas)&&this._loadImage(),this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=y.Z.SCENE3D,this._clusterShow=!0,this._outlineColor=c.Z.clone((0,u.Z)(e.outlineColor,c.Z.BLACK)),this._outlineWidth=(0,u.Z)(e.outlineWidth,0),this._updateClamping()}var D=v.SHOW_INDEX=0,A=v.POSITION_INDEX=1,I=v.PIXEL_OFFSET_INDEX=2,C=v.EYE_OFFSET_INDEX=3,S=v.HORIZONTAL_ORIGIN_INDEX=4,E=v.VERTICAL_ORIGIN_INDEX=5,O=v.SCALE_INDEX=6,w=v.IMAGE_INDEX_INDEX=7,N=v.COLOR_INDEX=8,B=v.ROTATION_INDEX=9,L=v.ALIGNED_AXIS_INDEX=10,P=v.SCALE_BY_DISTANCE_INDEX=11,R=v.TRANSLUCENCY_BY_DISTANCE_INDEX=12,U=v.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,k=v.DISTANCE_DISPLAY_CONDITION=14,F=v.DISABLE_DEPTH_DISTANCE=15;v.TEXTURE_COORDINATE_BOUNDS=16;var M=v.SDF_INDEX=17;function V(e,t){var i=e._billboardCollection;(0,_.Z)(i)&&(i._updateBillboard(e,t),e._dirty=!0)}v.NUMBER_OF_PROPERTIES=18,Object.defineProperties(v.prototype,{show:{get:function(){return this._show},set:function(e){h.Z.typeOf.bool("value",e),this._show!==e&&(this._show=e,V(this,D))}},position:{get:function(){return this._position},set:function(e){h.Z.typeOf.object("value",e);var t=this._position;s.Z.equals(t,e)||(s.Z.clone(e,t),s.Z.clone(e,this._actualPosition),this._updateClamping(),V(this,A))}},heightReference:{get:function(){return this._heightReference},set:function(e){h.Z.typeOf.number("value",e);var t=this._heightReference;e!==t&&(this._heightReference=e,this._updateClamping(),V(this,A))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){h.Z.typeOf.object("value",e);var t=this._pixelOffset;n.Z.equals(t,e)||(n.Z.clone(e,t),V(this,I))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){if((0,_.Z)(e)&&(h.Z.typeOf.object("value",e),e.far<=e.near))throw new d.Z("far distance must be greater than near distance.");var t=this._scaleByDistance;Z.Z.equals(t,e)||(this._scaleByDistance=Z.Z.clone(e,t),V(this,P))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){if((0,_.Z)(e)&&(h.Z.typeOf.object("value",e),e.far<=e.near))throw new d.Z("far distance must be greater than near distance.");var t=this._translucencyByDistance;Z.Z.equals(t,e)||(this._translucencyByDistance=Z.Z.clone(e,t),V(this,R))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){if((0,_.Z)(e)&&(h.Z.typeOf.object("value",e),e.far<=e.near))throw new d.Z("far distance must be greater than near distance.");var t=this._pixelOffsetScaleByDistance;Z.Z.equals(t,e)||(this._pixelOffsetScaleByDistance=Z.Z.clone(e,t),V(this,U))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){h.Z.typeOf.object("value",e);var t=this._eyeOffset;s.Z.equals(t,e)||(s.Z.clone(e,t),V(this,C))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){h.Z.typeOf.number("value",e),this._horizontalOrigin!==e&&(this._horizontalOrigin=e,V(this,S))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){h.Z.typeOf.number("value",e),this._verticalOrigin!==e&&(this._verticalOrigin=e,V(this,E))}},scale:{get:function(){return this._scale},set:function(e){h.Z.typeOf.number("value",e),this._scale!==e&&(this._scale=e,V(this,O))}},color:{get:function(){return this._color},set:function(e){h.Z.typeOf.object("value",e);var t=this._color;c.Z.equals(t,e)||(c.Z.clone(e,t),V(this,N))}},rotation:{get:function(){return this._rotation},set:function(e){h.Z.typeOf.number("value",e),this._rotation!==e&&(this._rotation=e,V(this,B))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(e){h.Z.typeOf.object("value",e);var t=this._alignedAxis;s.Z.equals(t,e)||(s.Z.clone(e,t),V(this,L))}},width:{get:function(){return(0,u.Z)(this._width,this._imageWidth)},set:function(e){(0,_.Z)(e)&&h.Z.typeOf.number("value",e),this._width!==e&&(this._width=e,V(this,w))}},height:{get:function(){return(0,u.Z)(this._height,this._imageHeight)},set:function(e){(0,_.Z)(e)&&h.Z.typeOf.number("value",e),this._height!==e&&(this._height=e,V(this,w))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){h.Z.typeOf.bool("value",e),this._sizeInMeters!==e&&(this._sizeInMeters=e,V(this,N))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(!f.Z.equals(e,this._distanceDisplayCondition)){if((0,_.Z)(e)&&(h.Z.typeOf.object("value",e),e.far<=e.near))throw new d.Z("far distance must be greater than near distance.");this._distanceDisplayCondition=f.Z.clone(e,this._distanceDisplayCondition),V(this,k)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if((0,_.Z)(e)&&(h.Z.typeOf.number("value",e),e<0))throw new d.Z("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance!==e&&(this._disableDepthTestDistance=e,V(this,F))}},id:{get:function(){return this._id},set:function(e){this._id=e,(0,_.Z)(this._pickId)&&(this._pickId.object.id=e)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(e){this._pickPrimitive=e,(0,_.Z)(this._pickId)&&(this._pickId.object.primitive=e)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(e){(0,_.Z)(e)?"string"===typeof e?this.setImage(e,e):e instanceof b.Z?this.setImage(e.url,e):(0,_.Z)(e.src)?this.setImage(e.src,e):this.setImage((0,l.Z)(),e):(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=void 0,this._image=void 0,this._imageIndexPromise=void 0,V(this,w))}},ready:{get:function(){return-1!==this._imageIndex}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=s.Z.clone(e,this._actualClampedPosition),V(this,A)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,V(this,D))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){if(!(0,_.Z)(e))throw new d.Z("value is required.");var t=this._outlineColor;c.Z.equals(t,e)||(c.Z.clone(e,t),V(this,M))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,V(this,M))}}}),v.prototype.getPickId=function(e){return(0,_.Z)(this._pickId)||(this._pickId=e.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id})),this._pickId},v.prototype._updateClamping=function(){v._updateClamping(this._billboardCollection,this)};var H=new o.Z,z=new s.Z;v._updateClamping=function(e,t){var i=e._scene;if((0,_.Z)(i)&&(0,_.Z)(i.globe)){var a=i.globe,n=a.ellipsoid,r=a._surface,h=i.frameState.mode,c=h!==t._mode;if(t._mode=h,(t._heightReference===m.Z.NONE||c)&&(0,_.Z)(t._removeCallbackFunc)&&(t._removeCallbackFunc(),t._removeCallbackFunc=void 0,t._clampedPosition=void 0),t._heightReference!==m.Z.NONE&&(0,_.Z)(t._position)){var l=n.cartesianToCartographic(t._position);if((0,_.Z)(l)){(0,_.Z)(t._removeCallbackFunc)&&t._removeCallbackFunc(),t._removeCallbackFunc=r.updateHeight(l,f),o.Z.clone(l,H);var u=a.getHeight(l);(0,_.Z)(u)&&(H.height=u),n.cartographicToCartesian(H,z),f(z)}else t._actualClampedPosition=void 0}}else if(t._heightReference!==m.Z.NONE)throw new d.Z("Height reference is not supported without a scene and globe.");function f(e){if(t._heightReference===m.Z.RELATIVE_TO_GROUND)if(t._mode===y.Z.SCENE3D){var i=n.cartesianToCartographic(e,H);i.height+=l.height,n.cartographicToCartesian(i,e)}else e.x+=l.height;t._clampedPosition=s.Z.clone(e,t._clampedPosition)}},v.prototype._loadImage=function(){var e,t=this._billboardCollection._textureAtlas,i=this._imageId,n=this._image,s=this._imageSubRegion;if((0,_.Z)(n)&&(e=t.addImage(i,n)),(0,_.Z)(s)&&(e=t.addSubRegion(i,s)),this._imageIndexPromise=e,(0,_.Z)(e)){var r=this;e.then((function(e){if(r._imageId===i&&r._image===n&&a.Z.equals(r._imageSubRegion,s)){var o=t.textureCoordinates[e];r._imageWidth=t.texture.width*o.width,r._imageHeight=t.texture.height*o.height,r._imageIndex=e,r._ready=!0,r._image=void 0,r._imageIndexPromise=void 0,V(r,w)}})).otherwise((function(e){console.error("Error loading image for billboard: "+e),r._imageIndexPromise=void 0}))}},v.prototype.setImage=function(e,t){if(!(0,_.Z)(e))throw new d.Z("id is required.");if(!(0,_.Z)(t))throw new d.Z("image is required.");this._imageId!==e&&(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=e,this._image=t,(0,_.Z)(this._billboardCollection._textureAtlas)&&this._loadImage())},v.prototype.setImageSubRegion=function(e,t){if(!(0,_.Z)(e))throw new d.Z("id is required.");if(!(0,_.Z)(t))throw new d.Z("subRegion is required.");this._imageId===e&&a.Z.equals(this._imageSubRegion,t)||(this._imageIndex=-1,this._imageId=e,this._imageSubRegion=a.Z.clone(t),(0,_.Z)(this._billboardCollection._textureAtlas)&&this._loadImage())},v.prototype._setTranslate=function(e){if(!(0,_.Z)(e))throw new d.Z("value is required.");var t=this._translate;n.Z.equals(t,e)||(n.Z.clone(e,t),V(this,I))},v.prototype._getActualPosition=function(){return(0,_.Z)(this._clampedPosition)?this._clampedPosition:this._actualPosition},v.prototype._setActualPosition=function(e){(0,_.Z)(this._clampedPosition)||s.Z.clone(e,this._actualPosition),V(this,A)};var G=new r.Z;v._computeActualPosition=function(e,t,i,a){return(0,_.Z)(e._clampedPosition)?(i.mode!==e._mode&&e._updateClamping(),e._clampedPosition):i.mode===y.Z.SCENE3D?t:(p.Z.multiplyByPoint(a,t,G),x.Z.computeActualWgs84Position(i,G))};var W=new s.Z;v._computeScreenSpacePosition=function(e,t,i,a,s,r){var o=p.Z.multiplyByPoint(e,t,W),h=x.Z.wgs84WithEyeOffsetToWindowCoordinates(s,o,i,r);if((0,_.Z)(h))return n.Z.add(h,a,h),h};var X=new n.Z(0,0);v.prototype.computeScreenSpacePosition=function(e,t){var i=this._billboardCollection;if((0,_.Z)(t)||(t=new n.Z),!(0,_.Z)(i))throw new d.Z("Billboard must be in a collection.  Was it removed?");if(!(0,_.Z)(e))throw new d.Z("scene is required.");n.Z.clone(this._pixelOffset,X),n.Z.add(X,this._translate,X);var a=i.modelMatrix,s=this._position;if((0,_.Z)(this._clampedPosition)&&(s=this._clampedPosition,e.mode!==y.Z.SCENE3D)){var r=e.mapProjection,o=r.ellipsoid,h=r.unproject(s,H);s=o.cartographicToCartesian(h,W),a=p.Z.IDENTITY}var c=v._computeScreenSpacePosition(a,s,this._eyeOffset,X,e,t);return c},v.getScreenSpaceBoundingBox=function(e,t,i){var n=e.width,s=e.height,r=e.scale;n*=r,s*=r;var o=t.x;e.horizontalOrigin===g.Z.RIGHT?o-=n:e.horizontalOrigin===g.Z.CENTER&&(o-=.5*n);var h=t.y;return e.verticalOrigin===T.Z.BOTTOM||e.verticalOrigin===T.Z.BASELINE?h-=s:e.verticalOrigin===T.Z.CENTER&&(h-=.5*s),(0,_.Z)(i)||(i=new a.Z),i.x=o,i.y=h,i.width=n,i.height=s,i},v.prototype.equals=function(e){return this===e||(0,_.Z)(e)&&this._id===e._id&&s.Z.equals(this._position,e._position)&&this._imageId===e._imageId&&this._show===e._show&&this._scale===e._scale&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&a.Z.equals(this._imageSubRegion,e._imageSubRegion)&&c.Z.equals(this._color,e._color)&&n.Z.equals(this._pixelOffset,e._pixelOffset)&&n.Z.equals(this._translate,e._translate)&&s.Z.equals(this._eyeOffset,e._eyeOffset)&&Z.Z.equals(this._scaleByDistance,e._scaleByDistance)&&Z.Z.equals(this._translucencyByDistance,e._translucencyByDistance)&&Z.Z.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&f.Z.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance},v.prototype._destroy=function(){(0,_.Z)(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=void 0),(0,_.Z)(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this.image=void 0,this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0},t["Z"]=v},8044:function(e,t,i){var a,n,s=i(52323),r=i(48243),o=i(60838),h=i(60216),c=i(66553),l=i(59947),u=i(84828),_=i(62200),d=i(82982),f=i(86511),p=i(12572),Z=i(74938),b=i(22832),m=i(99417),g=i(72248),y=i(52200),x=i(99095),T=i(58597),v=i(20521),D=i(60072),A=i(8379),I=i(10667),C=i(46588),S=i(53642),E=i(52851),O=i(39111),w=i(64059),N=i(80349),B=i(13633),L=i(27384),P=i(4260),R=i(62919),U=i(89917),k=i(36191),F=i(54230),M=i(60473),V=N.Z.SHOW_INDEX,H=N.Z.POSITION_INDEX,z=N.Z.PIXEL_OFFSET_INDEX,G=N.Z.EYE_OFFSET_INDEX,W=N.Z.HORIZONTAL_ORIGIN_INDEX,X=N.Z.VERTICAL_ORIGIN_INDEX,q=N.Z.SCALE_INDEX,Y=N.Z.IMAGE_INDEX_INDEX,j=N.Z.COLOR_INDEX,Q=N.Z.ROTATION_INDEX,K=N.Z.ALIGNED_AXIS_INDEX,J=N.Z.SCALE_BY_DISTANCE_INDEX,$=N.Z.TRANSLUCENCY_BY_DISTANCE_INDEX,ee=N.Z.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,te=N.Z.DISTANCE_DISPLAY_CONDITION,ie=N.Z.DISABLE_DEPTH_DISTANCE,ae=N.Z.TEXTURE_COORDINATE_BOUNDS,ne=N.Z.SDF_INDEX,se=N.Z.NUMBER_OF_PROPERTIES,re={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10,sdf:11},oe={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11,sdf:12};function he(e){e=(0,_.Z)(e,_.Z.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(se),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._baseVolume=new r.Z,this._baseVolumeWC=new r.Z,this._baseVolume2D=new r.Z,this._boundingVolume=new r.Z,this._boundingVolumeDirty=!1,this._colorCommands=[],this.show=(0,_.Z)(e.show,!0),this.modelMatrix=g.Z.clone((0,_.Z)(e.modelMatrix,g.Z.IDENTITY)),this._modelMatrix=g.Z.clone(g.Z.IDENTITY),this.debugShowBoundingVolume=(0,_.Z)(e.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=(0,_.Z)(e.debugShowTextureAtlas,!1),this.blendOption=(0,_.Z)(e.blendOption,L.Z.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=U.Z.SCENE3D,this._buffersUsage=[T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW,T.Z.STATIC_DRAW],this._highlightColor=l.Z.clone(l.Z.WHITE);var t=this;this._uniforms={u_atlas:function(){return t._textureAtlas.texture},u_highlightColor:function(){return t._highlightColor}};var i=this._scene;(0,d.Z)(i)&&(0,d.Z)(i.terrainProviderChanged)&&(this._removeCallbackFunc=i.terrainProviderChanged.addEventListener((function(){for(var e=this._billboards,t=e.length,i=0;i<t;++i)(0,d.Z)(e[i])&&e[i]._updateClamping()}),this))}function ce(e){for(var t=e.length,i=0;i<t;++i)e[i]&&e[i]._destroy()}function le(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;for(var t=[],i=e._billboards,a=i.length,n=0,s=0;n<a;++n){var r=i[n];(0,d.Z)(r)&&(r._index=s++,t.push(r))}e._billboards=t}}function ue(e){var t=16384,i=e.cache.billboardCollection_indexBufferBatched;if((0,d.Z)(i))return i;for(var a=6*t-6,n=new Uint16Array(a),s=0,r=0;s<a;s+=6,r+=4)n[s]=r,n[s+1]=r+1,n[s+2]=r+2,n[s+3]=r+0,n[s+4]=r+2,n[s+5]=r+3;return i=x.Z.createIndexBuffer({context:e,typedArray:n,usage:T.Z.STATIC_DRAW,indexDatatype:b.Z.UNSIGNED_SHORT}),i.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferBatched=i,i}function _e(e){var t=e.cache.billboardCollection_indexBufferInstanced;return(0,d.Z)(t)||(t=x.Z.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:T.Z.STATIC_DRAW,indexDatatype:b.Z.UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferInstanced=t),t}function de(e){var t=e.cache.billboardCollection_vertexBufferInstanced;return(0,d.Z)(t)||(t=x.Z.createVertexBuffer({context:e,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:T.Z.STATIC_DRAW}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_vertexBufferInstanced=t),t}function fe(e,t,i,n,s,r){var o=[{index:a.positionHighAndScale,componentsPerAttribute:4,componentDatatype:u.Z.FLOAT,usage:i[H]},{index:a.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:u.Z.FLOAT,usage:i[H]},{index:a.compressedAttribute0,componentsPerAttribute:4,componentDatatype:u.Z.FLOAT,usage:i[z]},{index:a.compressedAttribute1,componentsPerAttribute:4,componentDatatype:u.Z.FLOAT,usage:i[$]},{index:a.compressedAttribute2,componentsPerAttribute:4,componentDatatype:u.Z.FLOAT,usage:i[j]},{index:a.eyeOffset,componentsPerAttribute:4,componentDatatype:u.Z.FLOAT,usage:i[G]},{index:a.scaleByDistance,componentsPerAttribute:4,componentDatatype:u.Z.FLOAT,usage:i[J]},{index:a.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:u.Z.FLOAT,usage:i[ee]},{index:a.compressedAttribute3,componentsPerAttribute:4,componentDatatype:u.Z.FLOAT,usage:i[te]},{index:a.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:u.Z.FLOAT,usage:i[ae]}];n&&o.push({index:a.direction,componentsPerAttribute:2,componentDatatype:u.Z.FLOAT,vertexBuffer:de(e)}),(0,d.Z)(s)&&o.push({index:a.a_batchId,componentsPerAttribute:1,componentDatatype:u.Z.FLOAT,bufferUsage:T.Z.STATIC_DRAW}),r&&o.push({index:a.sdf,componentsPerAttribute:2,componentDatatype:u.Z.FLOAT,usage:i[ne]});var h=n?t:4*t;return new E.Z(e,o,h,n)}Object.defineProperties(he.prototype,{length:{get:function(){return le(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(e){this._destroyTextureAtlas=e}}}),he.prototype.add=function(e){var t=new N.Z(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t},he.prototype.remove=function(e){return!!this.contains(e)&&(this._billboards[e._index]=void 0,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0)},he.prototype.removeAll=function(){ce(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0},he.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]},he.prototype.contains=function(e){return(0,d.Z)(e)&&e._billboardCollection===this},he.prototype.get=function(e){return c.Z.typeOf.number("index",e),le(this),this._billboards[e]},he.prototype.computeNewBuffersUsage=function(){for(var e=this._buffersUsage,t=!1,i=this._propertiesChanged,a=0;a<se;++a){var n=0===i[a]?T.Z.STATIC_DRAW:T.Z.STREAM_DRAW;t=t||e[a]!==n,e[a]=n}return t};var pe=new Z.Z;function Ze(e,t,i,n,s){var o,h=n[a.positionHighAndScale],c=n[a.positionLowAndRotation],l=s._getActualPosition();e._mode===U.Z.SCENE3D&&(r.Z.expand(e._baseVolume,l,e._baseVolume),e._boundingVolumeDirty=!0),Z.Z.fromCartesian(l,pe);var u=s.scale,_=s.rotation;0!==_&&(e._shaderRotation=!0),e._maxScale=Math.max(e._maxScale,u);var d=pe.high,f=pe.low;e._instanced?(o=s._index,h(o,d.x,d.y,d.z,u),c(o,f.x,f.y,f.z,_)):(o=4*s._index,h(o+0,d.x,d.y,d.z,u),h(o+1,d.x,d.y,d.z,u),h(o+2,d.x,d.y,d.z,u),h(o+3,d.x,d.y,d.z,u),c(o+0,f.x,f.y,f.z,_),c(o+1,f.x,f.y,f.z,_),c(o+2,f.x,f.y,f.z,_),c(o+3,f.x,f.y,f.z,_))}var be=new o.Z,me=32768,ge=65536,ye=4096,xe=256,Te=128,ve=32,De=8,Ae=4,Ie=1/256,Ce=0,Se=2,Ee=3,Oe=1;function we(e,t,i,n,r){var o,h=n[a.compressedAttribute0],c=r.pixelOffset,l=c.x,u=c.y,_=r._translate,f=_.x,Z=_.y;e._maxPixelOffset=Math.max(e._maxPixelOffset,Math.abs(l+f),Math.abs(-u+Z));var b=r.horizontalOrigin,g=r._verticalOrigin,y=r.show&&r.clusterShow;0===r.color.alpha&&(y=!1),g===M.Z.BASELINE&&(g=M.Z.BOTTOM),e._allHorizontalCenter=e._allHorizontalCenter&&b===R.Z.CENTER,e._allVerticalCenter=e._allVerticalCenter&&g===M.Z.CENTER;var x=0,T=0,v=0,D=0,A=r._imageIndex;if(-1!==A){var I=i[A];if(!(0,d.Z)(I))throw new p.Z("Invalid billboard image index: "+A);x=I.x,T=I.y,v=I.width,D=I.height}var C=x+v,S=T+D,E=Math.floor(m.Z.clamp(l,-me,me)+me)*Te;E+=(b+1)*ve,E+=(g+1)*De,E+=(y?1:0)*Ae;var O=Math.floor(m.Z.clamp(u,-me,me)+me)*xe,w=Math.floor(m.Z.clamp(f,-me,me)+me)*xe,N=(m.Z.clamp(Z,-me,me)+me)*Ie,B=Math.floor(N),L=Math.floor((N-B)*xe);O+=B,w+=L,be.x=x,be.y=T;var P=s.Z.compressTextureCoordinates(be);be.x=C;var U=s.Z.compressTextureCoordinates(be);be.y=S;var k=s.Z.compressTextureCoordinates(be);be.x=x;var F=s.Z.compressTextureCoordinates(be);e._instanced?(o=r._index,h(o,E,O,w,P)):(o=4*r._index,h(o+0,E+Ce,O,w,P),h(o+1,E+Se,O,w,U),h(o+2,E+Ee,O,w,k),h(o+3,E+Oe,O,w,F))}function Ne(e,t,i,n,r){var o,c=n[a.compressedAttribute1],l=r.alignedAxis;h.Z.equals(l,h.Z.ZERO)||(e._shaderAlignedAxis=!0);var u=0,f=1,Z=1,b=1,g=r.translucencyByDistance;(0,d.Z)(g)&&(u=g.near,f=g.nearValue,Z=g.far,b=g.farValue,1===f&&1===b||(e._shaderTranslucencyByDistance=!0));var y=0,x=r._imageIndex;if(-1!==x){var T=i[x];if(!(0,d.Z)(T))throw new p.Z("Invalid billboard image index: "+x);y=T.width}var v=e._textureAtlas.texture.width,D=Math.round((0,_.Z)(r.width,v*y));e._maxSize=Math.max(e._maxSize,D);var A=m.Z.clamp(D,0,ge),I=0;Math.abs(h.Z.magnitudeSquared(l)-1)<m.Z.EPSILON6&&(I=s.Z.octEncodeFloat(l)),f=m.Z.clamp(f,0,1),f=1===f?255:255*f|0,A=A*xe+f,b=m.Z.clamp(b,0,1),b=1===b?255:255*b|0,I=I*xe+b,e._instanced?(o=r._index,c(o,A,I,u,Z)):(o=4*r._index,c(o+0,A,I,u,Z),c(o+1,A,I,u,Z),c(o+2,A,I,u,Z),c(o+3,A,I,u,Z))}function Be(e,t,i,n,s){var r,o=n[a.compressedAttribute2],c=s.color,u=(0,d.Z)(e._batchTable)?l.Z.WHITE:s.getPickId(t.context).color,f=s.sizeInMeters?1:0,Z=Math.abs(h.Z.magnitudeSquared(s.alignedAxis)-1)<m.Z.EPSILON6?1:0;e._allSizedInMeters=e._allSizedInMeters&&1===f;var b=0,g=s._imageIndex;if(-1!==g){var y=i[g];if(!(0,d.Z)(y))throw new p.Z("Invalid billboard image index: "+g);b=y.height}var x=e._textureAtlas.texture.dimensions,T=Math.round((0,_.Z)(s.height,x.y*b));e._maxSize=Math.max(e._maxSize,T);var v=(0,_.Z)(s._labelHorizontalOrigin,-2);v+=2;var D=T*Ae+v,A=l.Z.floatToByte(c.red),I=l.Z.floatToByte(c.green),C=l.Z.floatToByte(c.blue),S=A*ge+I*xe+C;A=l.Z.floatToByte(u.red),I=l.Z.floatToByte(u.green),C=l.Z.floatToByte(u.blue);var E=A*ge+I*xe+C,O=l.Z.floatToByte(c.alpha)*ge+l.Z.floatToByte(u.alpha)*xe;O+=2*f+Z,e._instanced?(r=s._index,o(r,S,E,O,D)):(r=4*s._index,o(r+0,S,E,O,D),o(r+1,S,E,O,D),o(r+2,S,E,O,D),o(r+3,S,E,O,D))}function Le(e,t,i,n,r){var o,h=n[a.eyeOffset],c=r.eyeOffset,l=c.z;if(r._heightReference!==P.Z.NONE&&(l*=1.005),e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(c.x),Math.abs(c.y),Math.abs(l)),e._instanced){var u=0,_=0,f=r._imageIndex;if(-1!==f){var Z=i[f];if(!(0,d.Z)(Z))throw new p.Z("Invalid billboard image index: "+f);u=Z.width,_=Z.height}be.x=u,be.y=_;var b=s.Z.compressTextureCoordinates(be);o=r._index,h(o,c.x,c.y,l,b)}else o=4*r._index,h(o+0,c.x,c.y,l,0),h(o+1,c.x,c.y,l,0),h(o+2,c.x,c.y,l,0),h(o+3,c.x,c.y,l,0)}function Pe(e,t,i,n,s){var r,o=n[a.scaleByDistance],h=0,c=1,l=1,u=1,_=s.scaleByDistance;(0,d.Z)(_)&&(h=_.near,c=_.nearValue,l=_.far,u=_.farValue,1===c&&1===u||(e._shaderScaleByDistance=!0)),e._instanced?(r=s._index,o(r,h,c,l,u)):(r=4*s._index,o(r+0,h,c,l,u),o(r+1,h,c,l,u),o(r+2,h,c,l,u),o(r+3,h,c,l,u))}function Re(e,t,i,n,s){var r,o=n[a.pixelOffsetScaleByDistance],h=0,c=1,l=1,u=1,_=s.pixelOffsetScaleByDistance;(0,d.Z)(_)&&(h=_.near,c=_.nearValue,l=_.far,u=_.farValue,1===c&&1===u||(e._shaderPixelOffsetScaleByDistance=!0)),e._instanced?(r=s._index,o(r,h,c,l,u)):(r=4*s._index,o(r+0,h,c,l,u),o(r+1,h,c,l,u),o(r+2,h,c,l,u),o(r+3,h,c,l,u))}function Ue(e,t,i,n,s){var r,o=n[a.compressedAttribute3],h=0,c=Number.MAX_VALUE,l=s.distanceDisplayCondition;(0,d.Z)(l)&&(h=l.near,c=l.far,h*=h,c*=c,e._shaderDistanceDisplayCondition=!0);var u,f,Z=s.disableDepthTestDistance,b=s.heightReference===P.Z.CLAMP_TO_GROUND&&t.context.depthTexture;if((0,d.Z)(Z)||(Z=b?5e3:0),Z*=Z,(b||Z>0)&&(e._shaderDisableDepthDistance=!0,Z===Number.POSITIVE_INFINITY&&(Z=-1)),(0,d.Z)(s._labelDimensions))f=s._labelDimensions.x,u=s._labelDimensions.y;else{var g=0,y=0,x=s._imageIndex;if(-1!==x){var T=i[x];if(!(0,d.Z)(T))throw new p.Z("Invalid billboard image index: "+x);g=T.height,y=T.width}u=Math.round((0,_.Z)(s.height,e._textureAtlas.texture.dimensions.y*g));var v=e._textureAtlas.texture.width;f=Math.round((0,_.Z)(s.width,v*y))}var D=Math.floor(m.Z.clamp(f,0,ye)),A=Math.floor(m.Z.clamp(u,0,ye)),I=D*ye+A;e._instanced?(r=s._index,o(r,h,c,Z,I)):(r=4*s._index,o(r+0,h,c,Z,I),o(r+1,h,c,Z,I),o(r+2,h,c,Z,I),o(r+3,h,c,Z,I))}function ke(e,t,i,n,s){if(s.heightReference===P.Z.CLAMP_TO_GROUND){var r=e._scene,o=t.context,h=t.globeTranslucencyState.translucent,c=(0,d.Z)(r.globe)&&r.globe.depthTestAgainstTerrain;e._shaderClampToGround=o.depthTexture&&!h&&c}var l,u=n[a.textureCoordinateBoundsOrLabelTranslate];if(v.Z.maximumVertexTextureImageUnits>0){var _=0,f=0;return(0,d.Z)(s._labelTranslate)&&(_=s._labelTranslate.x,f=s._labelTranslate.y),void(e._instanced?(l=s._index,u(l,_,f,0,0)):(l=4*s._index,u(l+0,_,f,0,0),u(l+1,_,f,0,0),u(l+2,_,f,0,0),u(l+3,_,f,0,0)))}var Z=0,b=0,m=0,g=0,y=s._imageIndex;if(-1!==y){var x=i[y];if(!(0,d.Z)(x))throw new p.Z("Invalid billboard image index: "+y);Z=x.x,b=x.y,m=x.width,g=x.height}var T=Z+m,D=b+g;e._instanced?(l=s._index,u(l,Z,b,T,D)):(l=4*s._index,u(l+0,Z,b,T,D),u(l+1,Z,b,T,D),u(l+2,Z,b,T,D),u(l+3,Z,b,T,D))}function Fe(e,t,i,n,s){if((0,d.Z)(e._batchTable)){var r,o=n[a.a_batchId],h=s._batchIndex;e._instanced?(r=s._index,o(r,h)):(r=4*s._index,o(r+0,h),o(r+1,h),o(r+2,h),o(r+3,h))}}function Me(e,t,i,n,s){if(e._sdf){var r,o=n[a.sdf],h=s.outlineColor,c=s.outlineWidth,u=l.Z.floatToByte(h.red),_=l.Z.floatToByte(h.green),d=l.Z.floatToByte(h.blue),f=u*ge+_*xe+d,p=c/k.Z.RADIUS,Z=l.Z.floatToByte(h.alpha)*ge+l.Z.floatToByte(p)*xe;e._instanced?(r=s._index,o(r,f,Z)):(r=4*s._index,o(r+0,f+Ce,Z),o(r+1,f+Se,Z),o(r+2,f+Ee,Z),o(r+3,f+Oe,Z))}}function Ve(e,t,i,a,n){Ze(e,t,i,a,n),we(e,t,i,a,n),Ne(e,t,i,a,n),Be(e,t,i,a,n),Le(e,t,i,a,n),Pe(e,t,i,a,n),Re(e,t,i,a,n),Ue(e,t,i,a,n),ke(e,t,i,a,n),Fe(e,t,i,a,n),Me(e,t,i,a,n)}function He(e,t,i,a,n,s){var o;a.mode===U.Z.SCENE3D?(o=e._baseVolume,e._boundingVolumeDirty=!0):o=e._baseVolume2D;for(var h=[],c=0;c<i;++c){var l=t[c],u=l.position,_=N.Z._computeActualPosition(l,u,a,n);(0,d.Z)(_)&&(l._setActualPosition(_),s?h.push(_):r.Z.expand(o,_,o))}s&&r.Z.fromPoints(h,o)}function ze(e,t){var i=t.mode,a=e._billboards,n=e._billboardsToUpdate,s=e._modelMatrix;e._createVertexArray||e._mode!==i||i!==U.Z.SCENE3D&&!g.Z.equals(s,e.modelMatrix)?(e._mode=i,g.Z.clone(e.modelMatrix,s),e._createVertexArray=!0,i!==U.Z.SCENE3D&&i!==U.Z.SCENE2D&&i!==U.Z.COLUMBUS_VIEW||He(e,a,a.length,t,s,!0)):i===U.Z.MORPHING?He(e,a,a.length,t,s,!0):i!==U.Z.SCENE2D&&i!==U.Z.COLUMBUS_VIEW||He(e,n,e._billboardsToUpdateIndex,t,s,!1)}function Ge(e,t,i){var a=1;e._allSizedInMeters&&0===e._maxPixelOffset||(a=t.camera.getPixelSize(i,t.context.drawingBufferWidth,t.context.drawingBufferHeight));var n=a*e._maxScale*e._maxSize*2;e._allHorizontalCenter&&e._allVerticalCenter&&(n*=.5);var s=a*e._maxPixelOffset+e._maxEyeOffset;i.radius+=n+s}function We(e,t){var i;i="uniform sampler2D billboard_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    gl_FragColor = texture2D(billboard_texture, v_textureCoordinates); \n} \n";var a=t.createViewportQuadCommand(i,{uniformMap:{billboard_texture:function(){return e._textureAtlas.texture}}});return a.pass=A.Z.OVERLAY,a}var Xe=[];he.prototype.update=function(e){if(le(this),this.show){var t=this._billboards,i=t.length,s=e.context;this._instanced=s.instancedArrays,a=this._instanced?oe:re,n=this._instanced?_e:ue;var o=this._textureAtlas;if(!(0,d.Z)(o)){o=this._textureAtlas=new F.Z({context:s});for(var h=0;h<i;++h)t[h]._loadImage()}var c=o.textureCoordinates;if(0!==c.length){ze(this,e),t=this._billboards,i=t.length;var l,u=this._billboardsToUpdate,_=this._billboardsToUpdateIndex,f=this._propertiesChanged,p=o.guid,Z=this._createVertexArray||this._textureAtlasGUID!==p;this._textureAtlasGUID=p;var b=e.passes,m=b.pick;if(Z||!m&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(var x=0;x<se;++x)f[x]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),i>0){this._vaf=fe(s,i,this._buffersUsage,this._instanced,this._batchTable,this._sdf),l=this._vaf.writers;for(var T=0;T<i;++T){var E=this._billboards[T];E._dirty=!1,Ve(this,e,c,l,E)}this._vaf.commit(n(s))}this._billboardsToUpdateIndex=0}else if(_>0){var N=Xe;N.length=0,(f[H]||f[Q]||f[q])&&N.push(Ze),(f[Y]||f[z]||f[W]||f[X]||f[V])&&(N.push(we),this._instanced&&N.push(Le)),(f[Y]||f[K]||f[$])&&(N.push(Ne),N.push(Be)),(f[Y]||f[j])&&N.push(Be),f[G]&&N.push(Le),f[J]&&N.push(Pe),f[ee]&&N.push(Re),(f[te]||f[ie]||f[Y]||f[H])&&N.push(Ue),(f[Y]||f[H])&&N.push(ke),f[ne]&&N.push(Me);var P=N.length;if(l=this._vaf.writers,_/i>.1){for(var R=0;R<_;++R){var M=u[R];M._dirty=!1;for(var ae=0;ae<P;++ae)N[ae](this,e,c,l,M)}this._vaf.commit(n(s))}else{for(var he=0;he<_;++he){var ce=u[he];ce._dirty=!1;for(var de=0;de<P;++de)N[de](this,e,c,l,ce);this._instanced?this._vaf.subCommit(ce._index,1):this._vaf.subCommit(4*ce._index,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(_>1.5*i&&(u.length=i),(0,d.Z)(this._vaf)&&(0,d.Z)(this._vaf.va)){var pe;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,r.Z.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));var be=g.Z.IDENTITY;e.mode===U.Z.SCENE3D?(be=this.modelMatrix,pe=r.Z.clone(this._baseVolumeWC,this._boundingVolume)):pe=r.Z.clone(this._baseVolume2D,this._boundingVolume),Ge(this,e,pe);var me,ge,ye,xe,Te,ve=this._blendOption!==this.blendOption;if(this._blendOption=this.blendOption,ve){this._blendOption===L.Z.OPAQUE||this._blendOption===L.Z.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=I.Z.fromCache({depthTest:{enabled:!0,func:y.Z.LESS},depthMask:!0}):this._rsOpaque=void 0;var De=this._blendOption===L.Z.TRANSLUCENT;this._blendOption===L.Z.TRANSLUCENT||this._blendOption===L.Z.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=I.Z.fromCache({depthTest:{enabled:!0,func:De?y.Z.LEQUAL:y.Z.LESS},depthMask:De,blending:B.Z.ALPHA_BLEND}):this._rsTranslucent=void 0}this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==e.minimumDisableDepthTestDistance;var Ae=v.Z.maximumVertexTextureImageUnits>0;if(ve||this._shaderRotation!==this._compiledShaderRotation||this._shaderAlignedAxis!==this._compiledShaderAlignedAxis||this._shaderScaleByDistance!==this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance!==this._compiledShaderTranslucencyByDistance||this._shaderPixelOffsetScaleByDistance!==this._compiledShaderPixelOffsetScaleByDistance||this._shaderDistanceDisplayCondition!==this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance||this._shaderClampToGround!==this._compiledShaderClampToGround||this._sdf!==this._compiledSDF){me=w.Z,ge=O.Z,Te=[],(0,d.Z)(this._batchTable)&&(Te.push("VECTOR_TILE"),me=this._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(me),ge=this._batchTable.getFragmentShaderCallback(!1,void 0)(ge)),ye=new S.Z({defines:Te,sources:[me]}),this._instanced&&ye.defines.push("INSTANCED"),this._shaderRotation&&ye.defines.push("ROTATION"),this._shaderAlignedAxis&&ye.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&ye.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&ye.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&ye.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&ye.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&ye.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(Ae?ye.defines.push("VERTEX_DEPTH_CHECK"):ye.defines.push("FRAGMENT_DEPTH_CHECK"));var Ie=1-k.Z.CUTOFF;this._sdf&&ye.defines.push("SDF");var Ce=(0,d.Z)(this._batchTable)?"VECTOR_TILE":"";this._blendOption===L.Z.OPAQUE_AND_TRANSLUCENT&&(xe=new S.Z({defines:["OPAQUE",Ce],sources:[ge]}),this._shaderClampToGround&&(Ae?xe.defines.push("VERTEX_DEPTH_CHECK"):xe.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(xe.defines.push("SDF"),xe.defines.push("SDF_EDGE "+Ie)),this._sp=C.Z.replaceCache({context:s,shaderProgram:this._sp,vertexShaderSource:ye,fragmentShaderSource:xe,attributeLocations:a}),xe=new S.Z({defines:["TRANSLUCENT",Ce],sources:[ge]}),this._shaderClampToGround&&(Ae?xe.defines.push("VERTEX_DEPTH_CHECK"):xe.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(xe.defines.push("SDF"),xe.defines.push("SDF_EDGE "+Ie)),this._spTranslucent=C.Z.replaceCache({context:s,shaderProgram:this._spTranslucent,vertexShaderSource:ye,fragmentShaderSource:xe,attributeLocations:a})),this._blendOption===L.Z.OPAQUE&&(xe=new S.Z({defines:[Ce],sources:[ge]}),this._shaderClampToGround&&(Ae?xe.defines.push("VERTEX_DEPTH_CHECK"):xe.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(xe.defines.push("SDF"),xe.defines.push("SDF_EDGE "+Ie)),this._sp=C.Z.replaceCache({context:s,shaderProgram:this._sp,vertexShaderSource:ye,fragmentShaderSource:xe,attributeLocations:a})),this._blendOption===L.Z.TRANSLUCENT&&(xe=new S.Z({defines:[Ce],sources:[ge]}),this._shaderClampToGround&&(Ae?xe.defines.push("VERTEX_DEPTH_CHECK"):xe.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(xe.defines.push("SDF"),xe.defines.push("SDF_EDGE "+Ie)),this._spTranslucent=C.Z.replaceCache({context:s,shaderProgram:this._spTranslucent,vertexShaderSource:ye,fragmentShaderSource:xe,attributeLocations:a})),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround,this._compiledSDF=this._sdf}var Se=e.commandList;if(b.render||b.pick){var Ee,Oe=this._colorCommands,Fe=this._blendOption===L.Z.OPAQUE,He=this._blendOption===L.Z.OPAQUE_AND_TRANSLUCENT,qe=this._vaf.va,Ye=qe.length,je=this._uniforms;(0,d.Z)(this._batchTable)?(je=this._batchTable.getUniformMapCallback()(je),Ee=this._batchTable.getPickId()):Ee="v_pickColor",Oe.length=Ye;for(var Qe=He?2*Ye:Ye,Ke=0;Ke<Qe;++Ke){var Je=Oe[Ke];(0,d.Z)(Je)||(Je=Oe[Ke]=new D.Z);var $e=Fe||He&&Ke%2===0;Je.pass=$e||!He?A.Z.OPAQUE:A.Z.TRANSLUCENT,Je.owner=this;var et=He?Math.floor(Ke/2):Ke;Je.boundingVolume=pe,Je.modelMatrix=be,Je.count=qe[et].indicesCount,Je.shaderProgram=$e?this._sp:this._spTranslucent,Je.uniformMap=je,Je.vertexArray=qe[et].va,Je.renderState=$e?this._rsOpaque:this._rsTranslucent,Je.debugShowBoundingVolume=this.debugShowBoundingVolume,Je.pickId=Ee,this._instanced&&(Je.count=6,Je.instanceCount=i),Se.push(Je)}this.debugShowTextureAtlas&&((0,d.Z)(this.debugCommand)||(this.debugCommand=We(this,e.context)),Se.push(this.debugCommand))}}}}},he.prototype.isDestroyed=function(){return!1},he.prototype.destroy=function(){return(0,d.Z)(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),ce(this._billboards),(0,f.Z)(this)},t["Z"]=he}}]);
//# sourceMappingURL=chunk-vendors-01d8bfcc.3d1e7891.js.map