"use strict";(self["webpackChunkvue3_webpack5"]=self["webpackChunkvue3_webpack5"]||[]).push([[1882],{40370:function(e,t,i){var r=i(68591),n=i(48243),s=i(60216),o=i(63367),a=i(59947),c=i(8182),u=i(84828),d=i(62200),h=i(82982),l=i(86511),_=i(12572),p=i(96037),f=i(22832),m=i(72248),Z=i(97264),v=i(9407),g=i(95555),y=i(52200),S=i(32550),x=i(56629),C=i(93224),b=i(26806),T=i(52655),A=i(6186),I=i(13222),E=i(66577),w=i(28770),P=i(15322),D=i(51240),O=i(14503),L=i(89917),M=i(51867),R=i(90082),B=new s.Z,U=P.Z.ModelState;function k(e){e=(0,d.Z)(e,d.Z.EMPTY_OBJECT);var t=e.gltf;if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),!(t instanceof Uint8Array))throw new v.Z("Only binary glTF is supported as a classifier.");t=(0,T.Z)(t),(0,A.Z)(t),(0,S.Z)(t),(0,D.Z)(t),(0,O.Z)(t),x.Z.buffer(t,(function(e){if(!(0,h.Z)(e.extras._pipeline.source))throw new v.Z("Buffer data must be embedded in the binary gltf.")}));var i=t.nodes,r=t.meshes,s=i[0],o=s.mesh;if(1!==i.length||!(0,h.Z)(o))throw new v.Z("Only one node is supported for classification and it must have a mesh.");if(1!==r.length)throw new v.Z("Only one mesh is supported when using b3dm for classification.");var a=r[0].primitives;if(1!==a.length)throw new v.Z("Only one primitive per mesh is supported when using b3dm for classification.");var c=a[0].attributes.POSITION;if(!(0,h.Z)(c))throw new v.Z("The mesh must have a position attribute.");var u=a[0].attributes._BATCHID;if(!(0,h.Z)(u))throw new v.Z("The mesh must have a batch id attribute.");this._gltf=t,this.show=(0,d.Z)(e.show,!0),this.modelMatrix=m.Z.clone((0,d.Z)(e.modelMatrix,m.Z.IDENTITY)),this._modelMatrix=m.Z.clone(this.modelMatrix),this._ready=!1,this._readyPromise=I.Z.defer(),this.debugShowBoundingVolume=(0,d.Z)(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=(0,d.Z)(e.debugWireframe,!1),this._debugWireframe=!1,this._classificationType=e.classificationType,this._vertexShaderLoaded=e.vertexShaderLoaded,this._classificationShaderLoaded=e.classificationShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=(0,d.Z)(e.ignoreCommands,!1),this._upAxis=(0,d.Z)(e.upAxis,E.Z.Y),this._batchTable=e.batchTable,this._computedModelMatrix=new m.Z,this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new n.Z,this._state=U.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._dirty=!1,this._nodeMatrix=new m.Z,this._primitive=void 0,this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms=void 0,this._buffers={},this._vertexArray=void 0,this._shaderProgram=void 0,this._uniformMap=void 0,this._geometryByteLength=0,this._trianglesLength=0,this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0}function N(e){var t=e.gltf,i=e._loadResources;x.Z.buffer(t,(function(e,t){i.buffers[t]=e.extras._pipeline.source}))}function F(e){var t=e.gltf.bufferViews,i=e._loadResources.vertexBuffersToCreate;x.Z.bufferView(e.gltf,(function(e,t){e.target===y.Z.ARRAY_BUFFER&&i.enqueue(t)}));var r=e._loadResources.indexBuffersToCreate,n={};x.Z.accessor(e.gltf,(function(e){var i=e.bufferView,s=t[i];s.target!==y.Z.ELEMENT_ARRAY_BUFFER||(0,h.Z)(n[i])||(n[i]=!0,r.enqueue({id:i,componentType:e.componentType}))}))}function V(e,t){var i=t._loadResources,r=t.gltf.bufferViews,n=r[e],s=i.getBuffer(n);t._buffers[e]=s,t._geometryByteLength+=s.byteLength}function z(e,t,i){var r=i._loadResources,n=i.gltf.bufferViews,s=n[e],o={typedArray:r.getBuffer(s),indexDatatype:t};i._buffers[e]=o,i._geometryByteLength+=o.typedArray.byteLength}function G(e){var t=e._loadResources;if(0===t.pendingBufferLoads){var i=t.vertexBuffersToCreate,r=t.indexBuffersToCreate;while(i.length>0)V(i.dequeue(),e);while(r.length>0){var n=r.dequeue();z(n.id,n.componentType,e)}}}function W(e,t){var i=t.gltf.meshes[0].primitives[0],r=P.Z.modifyShaderForQuantizedAttributes(t.gltf,i,e);return t._quantizedUniforms=r.uniforms,r.shader}function q(e,t){return(0,h.Z)(t)&&(e=t(e)),e}function Y(e){var t=e.gltf,i=P.Z.getAttributeOrUniformBySemantic(t,"POSITION"),r=P.Z.getAttributeOrUniformBySemantic(t,"_BATCHID"),n={};n[i]=0,n[r]=1;var s,o,a=P.Z.getAttributeOrUniformBySemantic(t,"MODELVIEWPROJECTION");if((0,h.Z)(a))s="uniform mat4 "+a+";\n",o=a+" * vec4("+i+", 1.0)";else{var c=P.Z.getAttributeOrUniformBySemantic(t,"PROJECTION"),u=P.Z.getAttributeOrUniformBySemantic(t,"MODELVIEW");(0,h.Z)(u)||(u=P.Z.getAttributeOrUniformBySemantic(t,"CESIUM_RTC_MODELVIEW")),s="uniform mat4 "+u+";\nuniform mat4 "+c+";\n",o=c+" * "+u+" * vec4("+i+", 1.0)"}var d="    vec4 positionInClipCoords = "+o+";\n",l="attribute vec3 "+i+";\nattribute float "+r+";\n"+s+"void main() {\n"+d+"    gl_Position = czm_depthClamp(positionInClipCoords);\n}\n",_="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeDepthClamp();\n}\n";e.extensionsUsed.WEB3D_quantized_attributes&&(l=W(l,e));var p=q(l,e._vertexShaderLoaded),f=q(_,e._classificationShaderLoaded);e._shaderProgram={vertexShaderSource:p,fragmentShaderSource:f,attributeLocations:n}}function H(){return{POSITION:0,_BATCHID:1}}function j(e){var t=e._loadResources;if(t.finishedBuffersCreation()&&!(0,h.Z)(e._vertexArray)){var i,r=e._buffers,n=e.gltf,s=n.accessors,o=n.meshes,a=o[0].primitives,c=a[0],u=H(),d={};if(x.Z.meshPrimitiveAttribute(c,(function(e,t){var i=u[t];if((0,h.Z)(i)){var o=s[e];d[t]={index:i,vertexBuffer:r[o.bufferView],componentsPerAttribute:(0,b.Z)(o.type),componentDatatype:o.componentType,offsetInBytes:o.byteOffset,strideInBytes:(0,C.Z)(n,o)}}})),(0,h.Z)(c.indices)){var l=s[c.indices];i=r[l.bufferView]}e._vertexArray={attributes:d,indexBuffer:i}}}Object.defineProperties(k.prototype,{gltf:{get:function(){return this._gltf}},boundingSphere:{get:function(){if(this._state!==U.LOADED)throw new _.Z("The model is not loaded.  Use ClassificationModel.readyPromise or wait for ClassificationModel.ready to be true.");var e=this.modelMatrix,t=m.Z.getScale(e,B),i=this._scaledBoundingSphere;return i.center=s.Z.multiplyComponents(this._boundingSphere.center,t,i.center),i.radius=s.Z.maximumComponent(t)*this._initialRadius,(0,h.Z)(this._rtcCenter)&&s.Z.add(this._rtcCenter,i.center,i.center),i}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},dirty:{get:function(){return this._dirty}},extensionsUsed:{get:function(){return(0,h.Z)(this._extensionsUsed)||(this._extensionsUsed=P.Z.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return(0,h.Z)(this._extensionsRequired)||(this._extensionsRequired=P.Z.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return 0}},classificationType:{get:function(){return this._classificationType}}});var X={PROJECTION:function(e,t){return P.Z.getGltfSemanticUniforms().PROJECTION(e,t)},MODELVIEW:function(e,t){return P.Z.getGltfSemanticUniforms().MODELVIEW(e,t)},CESIUM_RTC_MODELVIEW:function(e,t){return P.Z.getGltfSemanticUniforms().CESIUM_RTC_MODELVIEW(e,t)},MODELVIEWPROJECTION:function(e,t){return P.Z.getGltfSemanticUniforms().MODELVIEWPROJECTION(e,t)}};function Q(e,t){if(!(0,h.Z)(e._uniformMap)){var i={};x.Z.technique(e.gltf,(function(r){x.Z.techniqueUniform(r,(function(r,n){(0,h.Z)(r.semantic)&&(0,h.Z)(X[r.semantic])&&(i[n]=X[r.semantic](t.uniformState,e))}))})),e._uniformMap=i}}function J(e,t){return P.Z.createUniformsForQuantizedAttributes(e.gltf,t,e._quantizedUniforms)}function K(e,t){switch(e.mode){case Z.Z.TRIANGLES:return t/3;case Z.Z.TRIANGLE_STRIP:case Z.Z.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function $(e){var t,i,o=e._batchTable,d=e._uniformMap,l=e._vertexArray,_=e.gltf,p=_.accessors,Z=_.meshes,v=Z[0].primitives[0],g=p[v.indices],y=v.attributes.POSITION,S=P.Z.getAccessorMinMax(_,y),x=n.Z.fromCornerPoints(s.Z.fromArray(S.min),s.Z.fromArray(S.max));if((0,h.Z)(g))i=g.count,t=g.byteOffset/f.Z.getSizeInBytes(g.componentType);else{var C=p[v.attributes.POSITION];i=C.count,t=0}if(e._trianglesLength+=K(v,i),(0,h.Z)(e._uniformMapLoaded)&&(d=e._uniformMapLoaded(d)),e.extensionsUsed.WEB3D_quantized_attributes){var b=J(e,v);d=(0,c.Z)(d,b)}var T=l.attributes.POSITION,A=T.componentDatatype,I=T.vertexBuffer,E=I.byteOffset,w=I.byteLength/u.Z.getSizeInBytes(A),D=u.Z.createArrayBufferView(A,I.buffer,E,w);T=l.attributes._BATCHID,A=T.componentDatatype,I=T.vertexBuffer,E=I.byteOffset,w=I.byteLength/u.Z.getSizeInBytes(A);var O,L=u.Z.createArrayBufferView(A,I.buffer,E,w),B=l.indexBuffer.typedArray;O=l.indexBuffer.indexDatatype===f.Z.UNSIGNED_SHORT?new Uint16Array(B.buffer,B.byteOffset,B.byteLength/Uint16Array.BYTES_PER_ELEMENT):new Uint32Array(B.buffer,B.byteOffset,B.byteLength/Uint32Array.BYTES_PER_ELEMENT),D=(0,r.Z)(D),L=(0,r.Z)(L),O=(0,r.Z)(O,t,t+i);var U,k,N,F=[],V=[],z=[],G=[],W=L[O[0]];F.push(W),z.push(0);for(var q=O.length,Y=1;Y<q;++Y)U=L[O[Y]],U!==W&&(k=z[z.length-1],N=Y-k,F.push(U),V.push(N),z.push(Y),G.push(new M.Z({offset:k,count:N,batchIds:[W],color:a.Z.WHITE})),W=U);k=z[z.length-1],N=q-k,V.push(N),G.push(new M.Z({offset:k,count:N,batchIds:[W],color:a.Z.WHITE}));var H=e._shaderProgram,j=H.vertexShaderSource,X=H.fragmentShaderSource,Q=H.attributeLocations,$=(0,h.Z)(e._pickIdLoaded)?e._pickIdLoaded():void 0;e._primitive=new R.Z({classificationType:e._classificationType,positions:D,indices:O,indexOffsets:z,indexCounts:V,batchIds:F,vertexBatchIds:L,batchedIndices:G,batchTable:o,boundingVolume:new n.Z,_vertexShaderSource:j,_fragmentShaderSource:X,_attributeLocations:Q,_uniformMap:d,_pickId:$,_modelMatrix:new m.Z,_boundingSphere:x}),e._buffers=void 0,e._vertexArray=void 0,e._shaderProgram=void 0,e._uniformMap=void 0}function ee(e){var t=e._loadResources;if(t.finished()&&!(0,h.Z)(e._primitive)){var i=e.gltf,r=i.nodes,n=r[0];e._nodeMatrix=P.Z.getTransform(n,e._nodeMatrix),$(e)}}function te(e,t){var i=t.context;P.Z.checkSupportedGlExtensions(e.gltf.glExtensionsUsed,i),G(e),Y(e),j(e),Q(e,i),ee(e)}var ie=new o.Z,re=new m.Z;function ne(e,t,i,r){var a=e._computedModelMatrix;if(e._mode!==L.Z.SCENE3D&&!e._ignoreCommands){var c=m.Z.getColumn(a,3,ie);if(o.Z.equals(c,o.Z.UNIT_W)){var u=e.boundingSphere.center,d=g.Z.wgs84To2DModelMatrix(r,u,re);a=m.Z.multiply(d,a,re),(0,h.Z)(e._rtcCenter)&&(m.Z.setTranslation(a,o.Z.UNIT_W,a),e._rtcCenter=e._rtcCenter2D)}else a=g.Z.basisTo2D(r,a,re),e._rtcCenter=e._rtcCenter3D}var l=e._primitive;(t||i)&&(m.Z.multiplyTransformation(a,e._nodeMatrix,l._modelMatrix),n.Z.transform(l._boundingSphere,l._modelMatrix,l._boundingVolume),(0,h.Z)(e._rtcCenter)&&s.Z.add(e._rtcCenter,l._boundingVolume.center,l._boundingVolume.center))}k.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},k.prototype.update=function(e){if(e.mode!==L.Z.MORPHING)if(p.Z.supportsWebP.initialized){var t=p.Z.supportsWebP();if(this._state===U.NEEDS_LOAD&&(0,h.Z)(this.gltf)&&(this._state=U.LOADING,this._state!==U.FAILED)){var i=this.gltf.extensions;if((0,h.Z)(i)&&(0,h.Z)(i.CESIUM_RTC)){var r=s.Z.fromArray(i.CESIUM_RTC.center);if(!s.Z.equals(r,s.Z.ZERO)){this._rtcCenter3D=r;var n=e.mapProjection,o=n.ellipsoid,a=o.cartesianToCartographic(this._rtcCenter3D),c=n.project(a);s.Z.fromElements(c.z,c.x,c.y,c),this._rtcCenter2D=c,this._rtcCenterEye=new s.Z,this._rtcCenter=this._rtcCenter3D}}this._loadResources=new w.Z,P.Z.parseBuffers(this)}var u=this._loadResources,d=!1;this._state===U.LOADING&&(0===u.pendingBufferLoads&&(P.Z.checkSupportedExtensions(this.extensionsRequired,t),N(this),F(this),this._boundingSphere=P.Z.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,te(this,e)),u.finished()&&(this._state=U.LOADED,d=!0)),(0,h.Z)(u)&&this._state===U.LOADED&&(d||te(this,e),u.finished()&&(this._loadResources=void 0));var l=this.show;if(l&&this._state===U.LOADED||d){this._dirty=!1;var _=this.modelMatrix,f=e.mode!==this._mode;this._mode=e.mode;var Z=!m.Z.equals(this._modelMatrix,_)||f;if(Z||d){m.Z.clone(_,this._modelMatrix);var v=this._computedModelMatrix;m.Z.clone(_,v),this._upAxis===E.Z.Y?m.Z.multiplyTransformation(v,E.Z.Y_UP_TO_Z_UP,v):this._upAxis===E.Z.X&&m.Z.multiplyTransformation(v,E.Z.X_UP_TO_Z_UP,v)}(Z||d)&&(ne(this,Z,d,e.mapProjection),this._dirty=!0)}if(d){var g=this;e.afterRender.push((function(){g._ready=!0,g._readyPromise.resolve(g)}))}else l&&!this._ignoreCommands&&(this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.debugWireframe=this.debugWireframe,this._primitive.update(e))}else p.Z.supportsWebP.initialize()},k.prototype.isDestroyed=function(){return!1},k.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),(0,l.Z)(this)},t["Z"]=k},14662:function(e,t,i){var r=i(92062),n=i(8182),s=i(62200),o=i(82982),a=i(86511),c=i(12572),u=i(26865),d=i(60072),h=i(8379),l=i(10667),_=i(46588),p=i(53642),f=i(73257),m=i(79863),Z=i(13222),v=i(13633),g=i(73001),y=i(7976),S=i(64060),x=i(34380),C=i(89917),b=i(88472),T=i(87233),A=i(77053),I=i(81255);function E(e){e=(0,s.Z)(e,s.Z.EMPTY_OBJECT);var t=e.geometryInstances;this.geometryInstances=t,this.show=(0,s.Z)(e.show,!0),this.classificationType=(0,s.Z)(e.classificationType,g.Z.BOTH),this.debugShowBoundingVolume=(0,s.Z)(e.debugShowBoundingVolume,!1),this.debugShowShadowVolume=(0,s.Z)(e.debugShowShadowVolume,!1),this._debugShowShadowVolume=!1,this._extruded=(0,s.Z)(e._extruded,!1),this._uniformMap=e._uniformMap,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._spColor=void 0,this._spPick2D=void 0,this._spColor2D=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._commandsIgnoreShow=[],this._ready=!1,this._readyPromise=Z.Z.defer(),this._primitive=void 0,this._pickPrimitive=e._pickPrimitive,this._hasSphericalExtentsAttribute=!1,this._hasPlanarExtentsAttributes=!1,this._hasPerColorAttribute=!1,this.appearance=e.appearance,this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._usePickOffsets=!1,this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:(0,s.Z)(e.vertexCacheOptimize,!1),interleave:(0,s.Z)(e.interleave,!1),releaseGeometryInstances:(0,s.Z)(e.releaseGeometryInstances,!0),allowPicking:(0,s.Z)(e.allowPicking,!0),asynchronous:(0,s.Z)(e.asynchronous,!0),compressVertices:(0,s.Z)(e.compressVertices,!0),_createBoundingVolumeFunction:void 0,_createRenderStatesFunction:void 0,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0,_createPickOffsets:!0}}function w(e,t){var i=t?A.Z.EQUAL:A.Z.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:e,frontFunction:i,frontOperation:{fail:I.Z.KEEP,zFail:I.Z.DECREMENT_WRAP,zPass:I.Z.KEEP},backFunction:i,backOperation:{fail:I.Z.KEEP,zFail:I.Z.INCREMENT_WRAP,zPass:I.Z.KEEP},reference:T.Z.CESIUM_3D_TILE_MASK,mask:T.Z.CESIUM_3D_TILE_MASK},stencilMask:T.Z.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:y.Z.LESS_OR_EQUAL},depthMask:!1}}function P(e){return{stencilTest:{enabled:e,frontFunction:A.Z.NOT_EQUAL,frontOperation:{fail:I.Z.ZERO,zFail:I.Z.ZERO,zPass:I.Z.ZERO},backFunction:A.Z.NOT_EQUAL,backOperation:{fail:I.Z.ZERO,zFail:I.Z.ZERO,zPass:I.Z.ZERO},reference:0,mask:T.Z.CLASSIFICATION_MASK},stencilMask:T.Z.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:v.Z.PRE_MULTIPLIED_ALPHA_BLEND}}Object.defineProperties(E.prototype,{vertexCacheOptimize:{get:function(){return this._primitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},compressVertices:{get:function(){return this._primitiveOptions.compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},_needs2DShader:{get:function(){return this._hasPlanarExtentsAttributes||this._hasSphericalExtentsAttribute}}}),E.isSupported=function(e){return e.context.stencilBuffer};var D={stencilTest:{enabled:!0,frontFunction:A.Z.NOT_EQUAL,frontOperation:{fail:I.Z.ZERO,zFail:I.Z.ZERO,zPass:I.Z.ZERO},backFunction:A.Z.NOT_EQUAL,backOperation:{fail:I.Z.ZERO,zFail:I.Z.ZERO,zPass:I.Z.ZERO},reference:0,mask:T.Z.CLASSIFICATION_MASK},stencilMask:T.Z.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};function O(e,t,i,r){if(!(0,o.Z)(e._rsStencilDepthPass)){var n=!e.debugShowShadowVolume;e._rsStencilDepthPass=l.Z.fromCache(w(n,!1)),e._rsStencilDepthPass3DTiles=l.Z.fromCache(w(n,!0)),e._rsColorPass=l.Z.fromCache(P(n,!1)),e._rsPickPass=l.Z.fromCache(D)}}function L(e,t){if(!e.compressVertices)return t;if(-1!==t.search(/attribute\s+vec3\s+extrudeDirection;/g)){var i="compressedAttributes",r="attribute vec2 "+i+";",n="vec3 extrudeDirection;\n",s="    extrudeDirection = czm_octDecode("+i+", 65535.0);\n",o=t;o=o.replace(/attribute\s+vec3\s+extrudeDirection;/g,""),o=p.Z.replaceMain(o,"czm_non_compressed_main");var a="void main() \n{ \n"+s+"    czm_non_compressed_main(); \n}";return[r,n,o,a].join("\n")}}function M(e,t){var i=t.context,r=e._primitive,n=f.Z;n=e._primitive._batchTable.getVertexShaderCallback()(n),n=x.Z._appendDistanceDisplayConditionToShader(r,n),n=x.Z._modifyShaderPosition(e,n,t.scene3DOnly),n=x.Z._updateColorAttribute(r,n);var s=e._hasPlanarExtentsAttributes,a=s||e._hasSphericalExtentsAttribute;e._extruded&&(n=L(r,n));var c=e._extruded?"EXTRUDED_GEOMETRY":"",u=new p.Z({defines:[c],sources:[n]}),d=new p.Z({sources:[m.Z]}),h=e._primitive._attributeLocations,l=new b.Z(a,s,e.appearance);if(e._spStencil=_.Z.replaceCache({context:i,shaderProgram:e._spStencil,vertexShaderSource:u,fragmentShaderSource:d,attributeLocations:h}),e._primitive.allowPicking){var Z=p.Z.createPickVertexShaderSource(n);Z=x.Z._appendShowToShader(r,Z),Z=x.Z._updatePickColorAttribute(Z);var v=l.createPickFragmentShader(!1),g=l.createPickVertexShader([c],Z,!1,t.mapProjection);if(e._spPick=_.Z.replaceCache({context:i,shaderProgram:e._spPick,vertexShaderSource:g,fragmentShaderSource:v,attributeLocations:h}),a){var y=i.shaderCache.getDerivedShaderProgram(e._spPick,"2dPick");if(!(0,o.Z)(y)){var S=l.createPickFragmentShader(!0),C=l.createPickVertexShader([c],Z,!0,t.mapProjection);y=i.shaderCache.createDerivedShaderProgram(e._spPick,"2dPick",{vertexShaderSource:C,fragmentShaderSource:S,attributeLocations:h})}e._spPick2D=y}}else e._spPick=_.Z.fromCache({context:i,vertexShaderSource:u,fragmentShaderSource:d,attributeLocations:h});n=x.Z._appendShowToShader(r,n),u=new p.Z({defines:[c],sources:[n]}),e._sp=_.Z.replaceCache({context:i,shaderProgram:e._sp,vertexShaderSource:u,fragmentShaderSource:d,attributeLocations:h});var T=l.createFragmentShader(!1),A=l.createVertexShader([c],n,!1,t.mapProjection);if(e._spColor=_.Z.replaceCache({context:i,shaderProgram:e._spColor,vertexShaderSource:A,fragmentShaderSource:T,attributeLocations:h}),a){var I=i.shaderCache.getDerivedShaderProgram(e._spColor,"2dColor");if(!(0,o.Z)(I)){var E=l.createFragmentShader(!0),w=l.createVertexShader([c],n,!0,t.mapProjection);I=i.shaderCache.createDerivedShaderProgram(e._spColor,"2dColor",{vertexShaderSource:w,fragmentShaderSource:E,attributeLocations:h})}e._spColor2D=I}}function R(e,t){var i,r,s,a=e._primitive,c=2*a._va.length;t.length=c;var u=0,l=a._batchTable.getUniformMapCallback()(e._uniformMap),_=e._needs2DShader;for(i=0;i<c;i+=2){var p=a._va[u++];r=t[i],(0,o.Z)(r)||(r=t[i]=new d.Z({owner:e,primitiveType:a._primitiveType})),r.vertexArray=p,r.renderState=e._rsStencilDepthPass,r.shaderProgram=e._sp,r.uniformMap=l,r.pass=h.Z.TERRAIN_CLASSIFICATION,s=d.Z.shallowClone(r,r.derivedCommands.tileset),s.renderState=e._rsStencilDepthPass3DTiles,s.pass=h.Z.CESIUM_3D_TILE_CLASSIFICATION,r.derivedCommands.tileset=s,r=t[i+1],(0,o.Z)(r)||(r=t[i+1]=new d.Z({owner:e,primitiveType:a._primitiveType})),r.vertexArray=p,r.renderState=e._rsColorPass,r.shaderProgram=e._spColor,r.pass=h.Z.TERRAIN_CLASSIFICATION;var f=e.appearance,m=f.material;if((0,o.Z)(m)&&(l=(0,n.Z)(l,m._uniforms)),r.uniformMap=l,s=d.Z.shallowClone(r,r.derivedCommands.tileset),s.pass=h.Z.CESIUM_3D_TILE_CLASSIFICATION,r.derivedCommands.tileset=s,_){var Z=d.Z.shallowClone(r,r.derivedCommands.appearance2D);Z.shaderProgram=e._spColor2D,r.derivedCommands.appearance2D=Z,Z=d.Z.shallowClone(s,s.derivedCommands.appearance2D),Z.shaderProgram=e._spColor2D,s.derivedCommands.appearance2D=Z}}var v=e._commandsIgnoreShow,g=e._spStencil,y=0;c=v.length=c/2;for(var S=0;S<c;++S){var x=v[S]=d.Z.shallowClone(t[y],v[S]);x.shaderProgram=g,x.pass=h.Z.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,y+=2}}function B(e,t){var i,r,n,s,a,c=e._usePickOffsets,u=e._primitive,l=2*u._va.length,_=0;c&&(i=u._pickOffsets,l=2*i.length),t.length=l;var p=0,f=u._batchTable.getUniformMapCallback()(e._uniformMap),m=e._needs2DShader;for(n=0;n<l;n+=2){var Z=u._va[p++];if(c&&(r=i[_++],Z=u._va[r.index]),s=t[n],(0,o.Z)(s)||(s=t[n]=new d.Z({owner:e,primitiveType:u._primitiveType,pickOnly:!0})),s.vertexArray=Z,s.renderState=e._rsStencilDepthPass,s.shaderProgram=e._sp,s.uniformMap=f,s.pass=h.Z.TERRAIN_CLASSIFICATION,c&&(s.offset=r.offset,s.count=r.count),a=d.Z.shallowClone(s,s.derivedCommands.tileset),a.renderState=e._rsStencilDepthPass3DTiles,a.pass=h.Z.CESIUM_3D_TILE_CLASSIFICATION,s.derivedCommands.tileset=a,s=t[n+1],(0,o.Z)(s)||(s=t[n+1]=new d.Z({owner:e,primitiveType:u._primitiveType,pickOnly:!0})),s.vertexArray=Z,s.renderState=e._rsPickPass,s.shaderProgram=e._spPick,s.uniformMap=f,s.pass=h.Z.TERRAIN_CLASSIFICATION,c&&(s.offset=r.offset,s.count=r.count),a=d.Z.shallowClone(s,s.derivedCommands.tileset),a.pass=h.Z.CESIUM_3D_TILE_CLASSIFICATION,s.derivedCommands.tileset=a,m){var v=d.Z.shallowClone(s,s.derivedCommands.pick2D);v.shaderProgram=e._spPick2D,s.derivedCommands.pick2D=v,v=d.Z.shallowClone(a,a.derivedCommands.pick2D),v.shaderProgram=e._spPick2D,a.derivedCommands.pick2D=v}}}function U(e,t,i,r,n,s,o){R(e,s),B(e,o)}function k(e,t){return Math.floor(e%t/2)}function N(e,t,i,r,n,s){e.modelMatrix=i,e.boundingVolume=n,e.cull=r,e.debugShowBoundingVolume=s,t.commandList.push(e)}function F(e,t,i,r,n){e.modelMatrix=i,e.boundingVolume=n,e.cull=r,t.commandList.push(e)}function V(e,t,i,r,n,s,a,c){var u,d=e._primitive;x.Z._updateBoundingVolumes(d,t,n),t.mode===C.Z.SCENE3D?u=d._boundingSphereWC:t.mode===C.Z.COLUMBUS_VIEW?u=d._boundingSphereCV:t.mode===C.Z.SCENE2D&&(0,o.Z)(d._boundingSphere2D)?u=d._boundingSphere2D:(0,o.Z)(d._boundingSphereMorph)&&(u=d._boundingSphereMorph);var h,l,_,p=e.classificationType,f=p!==g.Z.CESIUM_3D_TILE,m=p!==g.Z.TERRAIN,Z=t.passes;if(Z.render){var v=i.length;for(h=0;h<v;++h)l=u[k(h,v)],f&&(_=i[h],N(_,t,n,s,l,a)),m&&(_=i[h].derivedCommands.tileset,N(_,t,n,s,l,a));if(t.invertClassification){var y=e._commandsIgnoreShow,S=y.length;for(h=0;h<S;++h)l=u[h],_=y[h],N(_,t,n,s,l,a)}}if(Z.pick){var b=r.length,T=d._pickOffsets;for(h=0;h<b;++h){var A=T[k(h,b)];l=u[A.index],f&&(_=r[h],F(_,t,n,s,l)),m&&(_=r[h].derivedCommands.tileset,F(_,t,n,s,l))}}}E.prototype.update=function(e){if((0,o.Z)(this._primitive)||(0,o.Z)(this.geometryInstances)){var t=this.appearance;(0,o.Z)(t)&&(0,o.Z)(t.material)&&t.material.update(e.context);var i=this,n=this._primitiveOptions;if(!(0,o.Z)(this._primitive)){var a,d,h,_,p=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],f=p.length,m=!1,Z=!0,v=!1,g=!1;for(f>0&&(h=p[0].attributes,v=b.Z.hasAttributesForSphericalExtents(h),g=b.Z.hasAttributesForTextureCoordinatePlanes(h),_=h.color),a=0;a<f;a++){d=p[a];var y=d.attributes.color;if((0,o.Z)(y))m=!0;else if(m)throw new c.Z("All GeometryInstances must have color attributes to use per-instance color.");Z=Z&&(0,o.Z)(y)&&r.Z.equals(_,y)}if(!Z&&!v&&!g)throw new c.Z("All GeometryInstances must have the same color attribute except via GroundPrimitives");if(m&&!(0,o.Z)(t)&&(t=new S.Z({flat:!0}),this.appearance=t),!m&&t instanceof S.Z)throw new c.Z("PerInstanceColorAppearance requires color GeometryInstanceAttributes on all GeometryInstances");if((0,o.Z)(t.material)&&!v&&!g)throw new c.Z("Materials on ClassificationPrimitives are not supported except via GroundPrimitives");this._usePickOffsets=!v&&!g,this._hasSphericalExtentsAttribute=v,this._hasPlanarExtentsAttributes=g,this._hasPerColorAttribute=m;var C=new Array(f);for(a=0;a<f;++a)d=p[a],C[a]=new u.Z({geometry:d.geometry,attributes:d.attributes,modelMatrix:d.modelMatrix,id:d.id,pickPrimitive:(0,s.Z)(this._pickPrimitive,i)});n.appearance=t,n.geometryInstances=C,(0,o.Z)(this._createBoundingVolumeFunction)&&(n._createBoundingVolumeFunction=function(e,t){i._createBoundingVolumeFunction(e,t)}),n._createRenderStatesFunction=function(e,t,r,n){O(i,t)},n._createShaderProgramFunction=function(e,t,r){M(i,t)},n._createCommandsFunction=function(e,t,r,n,s,o,a){U(i,void 0,void 0,!0,!1,o,a)},(0,o.Z)(this._updateAndQueueCommandsFunction)?n._updateAndQueueCommandsFunction=function(e,t,r,n,s,o,a,c){i._updateAndQueueCommandsFunction(e,t,r,n,s,o,a,c)}:n._updateAndQueueCommandsFunction=function(e,t,r,n,s,o,a,c){V(i,t,r,n,s,o,a,c)},this._primitive=new x.Z(n),this._primitive.readyPromise.then((function(e){i._ready=!0,i.releaseGeometryInstances&&(i.geometryInstances=void 0);var t=e._error;(0,o.Z)(t)?i._readyPromise.reject(t):i._readyPromise.resolve(i)}))}if(this.debugShowShadowVolume&&!this._debugShowShadowVolume&&this._ready?(this._debugShowShadowVolume=!0,this._rsStencilDepthPass=l.Z.fromCache(w(!1,!1)),this._rsStencilDepthPass3DTiles=l.Z.fromCache(w(!1,!0)),this._rsColorPass=l.Z.fromCache(P(!1))):!this.debugShowShadowVolume&&this._debugShowShadowVolume&&(this._debugShowShadowVolume=!1,this._rsStencilDepthPass=l.Z.fromCache(w(!0,!1)),this._rsStencilDepthPass3DTiles=l.Z.fromCache(w(!0,!0)),this._rsColorPass=l.Z.fromCache(P(!0))),this._primitive.appearance!==t){if(!this._hasSphericalExtentsAttribute&&!this._hasPlanarExtentsAttributes&&(0,o.Z)(t.material))throw new c.Z("Materials on ClassificationPrimitives are not supported except via GroundPrimitive");if(!this._hasPerColorAttribute&&t instanceof S.Z)throw new c.Z("PerInstanceColorAppearance requires color GeometryInstanceAttribute");this._primitive.appearance=t}this._primitive.show=this.show,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e)}},E.prototype.getGeometryInstanceAttributes=function(e){if(!(0,o.Z)(this._primitive))throw new c.Z("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)},E.prototype.isDestroyed=function(){return!1},E.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._spColor=this._spColor&&this._spColor.destroy(),this._spPick2D=void 0,this._spColor2D=void 0,(0,a.Z)(this)},t["Z"]=E},73001:function(e,t){var i={TERRAIN:0,CESIUM_3D_TILE:1,BOTH:2,NUMBER_OF_CLASSIFICATION_TYPES:3};t["Z"]=Object.freeze(i)},44683:function(e,t,i){var r=i(60216),n=i(66553),s=i(82982);function o(e,t){n.Z.typeOf.object("normal",e),n.Z.typeOf.number("distance",t),this._distance=t,this._normal=new a(e,this),this.onChangeCallback=void 0,this.index=-1}function a(e,t){this._clippingPlane=t,this._cartesian3=r.Z.clone(e)}Object.defineProperties(o.prototype,{distance:{get:function(){return this._distance},set:function(e){n.Z.typeOf.number("value",e),(0,s.Z)(this.onChangeCallback)&&e!==this._distance&&this.onChangeCallback(this.index),this._distance=e}},normal:{get:function(){return this._normal},set:function(e){n.Z.typeOf.object("value",e),(0,s.Z)(this.onChangeCallback)&&!r.Z.equals(this._normal._cartesian3,e)&&this.onChangeCallback(this.index),r.Z.clone(e,this._normal._cartesian3)}}}),o.fromPlane=function(e,t){return n.Z.typeOf.object("plane",e),(0,s.Z)(t)?(t.normal=e.normal,t.distance=e.distance):t=new o(e.normal,e.distance),t},o.clone=function(e,t){return(0,s.Z)(t)?(t.normal=e.normal,t.distance=e.distance,t):new o(e.normal,e.distance)},Object.defineProperties(a.prototype,{x:{get:function(){return this._cartesian3.x},set:function(e){n.Z.typeOf.number("value",e),(0,s.Z)(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.x&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.x=e}},y:{get:function(){return this._cartesian3.y},set:function(e){n.Z.typeOf.number("value",e),(0,s.Z)(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.y&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.y=e}},z:{get:function(){return this._cartesian3.z},set:function(e){n.Z.typeOf.number("value",e),(0,s.Z)(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.z&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.z=e}}}),t["Z"]=o},21809:function(e,t,i){var r=i(52323),n=i(60838),s=i(60216),o=i(63367),a=i(66553),c=i(59947),u=i(62200),d=i(82982),h=i(86511),l=i(12572),_=i(14459),p=i(84935),f=i(72248),m=i(38443),Z=i(7749),v=i(20521),g=i(21572),y=i(87721),S=i(8743),x=i(44683);function C(e){e=(0,u.Z)(e,u.Z.EMPTY_OBJECT),this._planes=[],this._dirtyIndex=-1,this._multipleDirtyPlanes=!1,this._enabled=(0,u.Z)(e.enabled,!0),this.modelMatrix=f.Z.clone((0,u.Z)(e.modelMatrix,f.Z.IDENTITY)),this.edgeColor=c.Z.clone((0,u.Z)(e.edgeColor,c.Z.WHITE)),this.edgeWidth=(0,u.Z)(e.edgeWidth,0),this.planeAdded=new _.Z,this.planeRemoved=new _.Z,this._owner=void 0;var t=(0,u.Z)(e.unionClippingRegions,!1);this._unionClippingRegions=t,this._testIntersection=t?b:T,this._uint8View=void 0,this._float32View=void 0,this._clippingPlanesTexture=void 0;var i=e.planes;if((0,d.Z)(i))for(var r=i.length,n=0;n<r;++n)this.add(i[n])}function b(e){return e===p.Z.OUTSIDE}function T(e){return e===p.Z.INSIDE}function A(e,t){e._multipleDirtyPlanes=e._multipleDirtyPlanes||-1!==e._dirtyIndex&&e._dirtyIndex!==t,e._dirtyIndex=t}function I(e,t){for(var i=e.length,r=0;r<i;++r)if(Z.Z.equals(e[r],t))return r;return-1}Object.defineProperties(C.prototype,{length:{get:function(){return this._planes.length}},unionClippingRegions:{get:function(){return this._unionClippingRegions},set:function(e){this._unionClippingRegions!==e&&(this._unionClippingRegions=e,this._testIntersection=e?b:T)}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e)}},texture:{get:function(){return this._clippingPlanesTexture}},owner:{get:function(){return this._owner}},clippingPlanesState:{get:function(){return this._unionClippingRegions?this._planes.length:-this._planes.length}}}),C.prototype.add=function(e){var t=this._planes.length,i=this;e.onChangeCallback=function(e){A(i,e)},e.index=t,A(this,t),this._planes.push(e),this.planeAdded.raiseEvent(e,t)},C.prototype.get=function(e){return a.Z.typeOf.number("index",e),this._planes[e]},C.prototype.contains=function(e){return-1!==I(this._planes,e)},C.prototype.remove=function(e){var t=this._planes,i=I(t,e);if(-1===i)return!1;e instanceof x.Z&&(e.onChangeCallback=void 0,e.index=-1);for(var r=t.length-1,n=i;n<r;++n){var s=t[n+1];t[n]=s,s instanceof x.Z&&(s.index=n)}return this._multipleDirtyPlanes=!0,t.length=r,this.planeRemoved.raiseEvent(e,i),!0},C.prototype.removeAll=function(){for(var e=this._planes,t=e.length,i=0;i<t;++i){var r=e[i];r instanceof x.Z&&(r.onChangeCallback=void 0,r.index=-1),this.planeRemoved.raiseEvent(r,i)}this._multipleDirtyPlanes=!0,this._planes=[]};var E=new o.Z,w=new o.Z;function P(e,t,i){for(var n=e._uint8View,s=e._planes,a=0,c=t;c<i;++c){var u=s[c],d=r.Z.octEncodeToCartesian4(u.normal,w);n[a]=d.x,n[a+1]=d.y,n[a+2]=d.z,n[a+3]=d.w;var h=o.Z.packFloat(u.distance,E);n[a+4]=h.x,n[a+5]=h.y,n[a+6]=h.z,n[a+7]=h.w,a+=8}}function D(e,t,i){for(var r=e._float32View,n=e._planes,s=0,o=t;o<i;++o){var a=n[o],c=a.normal;r[s]=c.x,r[s+1]=c.y,r[s+2]=c.z,r[s+3]=a.distance,s+=4}}function O(e,t){var i=v.Z.maximumTextureSize;return t.x=Math.min(e,i),t.y=Math.ceil(e/t.x),t}var L=new n.Z;C.prototype.update=function(e){var t=this._clippingPlanesTexture,i=e.context,r=C.useFloatTexture(i),n=r?this.length:2*this.length;if((0,d.Z)(t)){var s=t.width*t.height;(s<n||n<.25*s)&&(t.destroy(),t=void 0,this._clippingPlanesTexture=void 0)}if(0!==this.length){if(!(0,d.Z)(t)){var o=O(n,L);o.y*=2,r?(t=new S.Z({context:i,width:o.x,height:o.y,pixelFormat:m.Z.RGBA,pixelDatatype:g.Z.FLOAT,sampler:y.Z.NEAREST,flipY:!1}),this._float32View=new Float32Array(o.x*o.y*4)):(t=new S.Z({context:i,width:o.x,height:o.y,pixelFormat:m.Z.RGBA,pixelDatatype:g.Z.UNSIGNED_BYTE,sampler:y.Z.NEAREST,flipY:!1}),this._uint8View=new Uint8Array(o.x*o.y*4)),this._clippingPlanesTexture=t,this._multipleDirtyPlanes=!0}var a=this._dirtyIndex;if(this._multipleDirtyPlanes||-1!==a){if(this._multipleDirtyPlanes)r?(D(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._float32View}})):(P(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._uint8View}}));else{var c=0,u=0;r?(u=Math.floor(a/t.width),c=Math.floor(a-u*t.width),D(this,a,a+1),t.copyFrom({source:{width:1,height:1,arrayBufferView:this._float32View},xOffset:c,yOffset:u})):(u=Math.floor(2*a/t.width),c=Math.floor(2*a-u*t.width),P(this,a,a+1),t.copyFrom({source:{width:2,height:1,arrayBufferView:this._uint8View},xOffset:c,yOffset:u}))}this._multipleDirtyPlanes=!1,this._dirtyIndex=-1}}};var M=new f.Z,R=new Z.Z(s.Z.UNIT_X,0);C.prototype.computeIntersectionWithBoundingVolume=function(e,t){var i=this._planes,r=i.length,n=this.modelMatrix;(0,d.Z)(t)&&(n=f.Z.multiply(t,n,M));var s=p.Z.INSIDE;!this.unionClippingRegions&&r>0&&(s=p.Z.OUTSIDE);for(var o=0;o<r;++o){var a=i[o];Z.Z.transform(a,n,R);var c=e.intersectPlane(R);if(c===p.Z.INTERSECTING)s=c;else if(this._testIntersection(c))return c}return s},C.setOwner=function(e,t,i){if(e!==t[i]&&(t[i]=t[i]&&t[i].destroy(),(0,d.Z)(e))){if((0,d.Z)(e._owner))throw new l.Z("ClippingPlaneCollection should only be assigned to one object");e._owner=t,t[i]=e}},C.useFloatTexture=function(e){return e.floatingPointTexture},C.getTextureResolution=function(e,t,i){var r=e.texture;if((0,d.Z)(r))return i.x=r.width,i.y=r.height,i;var n=C.useFloatTexture(t)?e.length:2*e.length,s=O(n,i);return s.y*=2,s},C.prototype.isDestroyed=function(){return!1},C.prototype.destroy=function(){return this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy(),(0,h.Z)(this)},t["Z"]=C},43495:function(e,t,i){var r,n=i(13633),s=i(99095),o=i(58597),a=i(60216),c=i(66553),u=i(92357),d=i(91757),h=i(50442),l=i(16999),_=i(12444),p=i(61968),f=i(84828),m=i(93030),Z=i(62200),v=i(82982),g=i(86511),y=i(12572),S=i(60072),x=i(74938),C=i(22832),b=i(8379),T=i(21572),A=i(38443),I=i(10667),E=i(87721),w=i(53642),P=i(46588),D=i(8743),O=i(42246),L=i(80188),M=i(88453),R=i(18192),B=i(52851),U=i(52200),k={positionHighAndScaleX:0,positionLowAndScaleY:1,packedAttribute0:2,packedAttribute1:3},N={direction:0,positionHighAndScaleX:1,positionLowAndScaleY:2,packedAttribute0:3,packedAttribute1:4},F=m.Z.SHOW_INDEX,V=m.Z.POSITION_INDEX,z=m.Z.SCALE_INDEX,G=m.Z.MAXIMUM_SIZE_INDEX,W=m.Z.SLICE_INDEX,q=m.Z.BRIGHTNESS_INDEX,Y=m.Z.NUMBER_OF_PROPERTIES;function H(e){e=(0,Z.Z)(e,Z.Z.EMPTY_OBJECT),this._clouds=[],this._cloudsToUpdate=[],this._cloudsToUpdateIndex=0,this._cloudsRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(Y),this._noiseTexture=void 0,this._noiseTextureLength=128,this.noiseDetail=(0,Z.Z)(e.noiseDetail,16),this.noiseOffset=a.Z.clone((0,Z.Z)(e.noiseOffset,a.Z.ZERO)),this._loading=!1,this._ready=!1;var t=this;this._uniforms={u_noiseTexture:function(){return t._noiseTexture},u_noiseTextureLength:function(){return t._noiseTextureLength},u_noiseDetail:function(){return t.noiseDetail}},this._vaNoise=void 0,this._spNoise=void 0,this._spCreated=!1,this._sp=void 0,this._rs=void 0,this.show=(0,Z.Z)(e.show,!0),this._colorCommands=[],this.debugBillboards=(0,Z.Z)(e.debugBillboards,!1),this._compiledDebugBillboards=!1,this.debugEllipsoids=(0,Z.Z)(e.debugEllipsoids,!1),this._compiledDebugEllipsoids=!1}function j(e){for(var t=e.length,i=0;i<t;++i)e[i]&&e[i]._destroy()}function X(e){if(e._cloudsRemoved){e._cloudsRemoved=!1;for(var t=[],i=e._clouds,r=i.length,n=0,s=0;n<r;++n){var o=i[n];(0,v.Z)(o)&&(i._index=s++,t.push(o))}e._clouds=t}}Object.defineProperties(H.prototype,{length:{get:function(){return X(this),this._clouds.length}}}),H.prototype.add=function(e){e=(0,Z.Z)(e,Z.Z.EMPTY_OBJECT);var t,i=(0,Z.Z)(e.cloudType,d.Z.CUMULUS);if(!d.Z.validate(i))throw new y.Z("invalid cloud type");return i===d.Z.CUMULUS&&(t=new m.Z(e,this),t._index=this._clouds.length,this._clouds.push(t),this._createVertexArray=!0),t},H.prototype.remove=function(e){return!!this.contains(e)&&(this._clouds[e._index]=void 0,this._cloudsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0)},H.prototype.removeAll=function(){j(this._clouds),this._clouds=[],this._cloudsToUpdate=[],this._cloudsToUpdateIndex=0,this._cloudsRemoved=!1,this._createVertexArray=!0},H.prototype._updateCloud=function(e,t){e._dirty||(this._cloudsToUpdate[this._cloudsToUpdateIndex++]=e),++this._propertiesChanged[t]},H.prototype.contains=function(e){return(0,v.Z)(e)&&e._cloudCollection===this},H.prototype.get=function(e){return c.Z.typeOf.number("index",e),X(this),this._clouds[e]};var Q,J=new Float32Array([-1,-1,1,-1,1,1,-1,1]),K=new Uint16Array([0,1,2,0,2,3]);function $(e){var t=s.Z.createVertexBuffer({context:e,typedArray:J,usage:o.Z.STATIC_DRAW}),i=s.Z.createIndexBuffer({context:e,typedArray:K,usage:o.Z.STATIC_DRAW,indexDatatype:C.Z.UNSIGNED_SHORT}),r=[{index:0,vertexBuffer:t,componentsPerAttribute:2,componentDatatype:f.Z.FLOAT}];return new R.Z({context:e,attributes:r,indexBuffer:i})}function ee(e){var t=16384,i=e.cache.cloudCollection_indexBufferBatched;if((0,v.Z)(i))return i;for(var r=6*t-6,n=new Uint16Array(r),a=0,c=0;a<r;a+=6,c+=4)n[a]=c,n[a+1]=c+1,n[a+2]=c+2,n[a+3]=c,n[a+4]=c+2,n[a+5]=c+3;return i=s.Z.createIndexBuffer({context:e,typedArray:n,usage:o.Z.STATIC_DRAW,indexDatatype:C.Z.UNSIGNED_SHORT}),i.vertexArrayDestroyable=!1,e.cache.cloudCollection_indexBufferBatched=i,i}function te(e){var t=e.cache.cloudCollection_indexBufferInstanced;return(0,v.Z)(t)||(t=s.Z.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:o.Z.STATIC_DRAW,indexDatatype:C.Z.UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,e.cache.cloudCollection_indexBufferInstanced=t),t}function ie(e){var t=e.cache.cloudCollection_vertexBufferInstanced;return(0,v.Z)(t)||(t=s.Z.createVertexBuffer({context:e,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:o.Z.STATIC_DRAW}),t.vertexArrayDestroyable=!1,e.cache.cloudCollection_vertexBufferInstanced=t),t}function re(e,t,i){var n=[{index:r.positionHighAndScaleX,componentsPerAttribute:4,componentDatatype:f.Z.FLOAT,usage:o.Z.STATIC_DRAW},{index:r.positionLowAndScaleY,componentsPerAttribute:4,componentDatatype:f.Z.FLOAT,usage:o.Z.STATIC_DRAW},{index:r.packedAttribute0,componentsPerAttribute:4,componentDatatype:f.Z.FLOAT,usage:o.Z.STATIC_DRAW},{index:r.packedAttribute1,componentsPerAttribute:4,componentDatatype:f.Z.FLOAT,usage:o.Z.STATIC_DRAW}];i&&n.push({index:r.direction,componentsPerAttribute:2,componentDatatype:f.Z.FLOAT,vertexBuffer:ie(e)});var s=i?t:4*t;return new B.Z(e,n,s,i)}var ne=new x.Z;function se(e,t,i,n){var s,o=i[r.positionHighAndScaleX],a=i[r.positionLowAndScaleY],c=n.position;x.Z.fromCartesian(c,ne);var u=n.scale,d=ne.high,h=ne.low;e._instanced?(s=n._index,o(s,d.x,d.y,d.z,u.x),a(s,h.x,h.y,h.z,u.y)):(s=4*n._index,o(s+0,d.x,d.y,d.z,u.x),o(s+1,d.x,d.y,d.z,u.x),o(s+2,d.x,d.y,d.z,u.x),o(s+3,d.x,d.y,d.z,u.x),a(s+0,h.x,h.y,h.z,u.y),a(s+1,h.x,h.y,h.z,u.y),a(s+2,h.x,h.y,h.z,u.y),a(s+3,h.x,h.y,h.z,u.y))}function oe(e,t,i,n){var s,o=i[r.packedAttribute0],a=n.show,c=n.brightness;e._instanced?(s=n._index,o(s,a,c,0,0)):(s=4*n._index,o(s+0,a,c,0,0),o(s+1,a,c,1,0),o(s+2,a,c,1,1),o(s+3,a,c,0,1))}function ae(e,t,i,n){var s,o=i[r.packedAttribute1],a=n.maximumSize,c=n.slice;e._instanced?(s=n._index,o(s,a.x,a.y,a.z,c)):(s=4*n._index,o(s+0,a.x,a.y,a.z,c),o(s+1,a.x,a.y,a.z,c),o(s+2,a.x,a.y,a.z,c),o(s+3,a.x,a.y,a.z,c))}function ce(e,t,i,r){se(e,t,i,r),oe(e,t,i,r),ae(e,t,i,r)}function ue(e,t,i,r){var n=e,s=t.context;n._vaNoise=$(s),n._spNoise=P.Z.fromCache({context:s,vertexShaderSource:i,fragmentShaderSource:r,attributeLocations:{position:0}});var o=n._noiseTextureLength,a=n.noiseDetail,c=n.noiseOffset;n._noiseTexture=new D.Z({context:s,width:o*o,height:o,pixelDatatype:T.Z.UNSIGNED_BYTE,pixelFormat:A.Z.RGBA,sampler:new E.Z({wrapS:M.Z.REPEAT,wrapT:M.Z.REPEAT,minificationFilter:L.Z.NEAREST,magnificationFilter:O.Z.NEAREST})});var d=new u.Z({vertexArray:n._vaNoise,shaderProgram:n._spNoise,outputTexture:n._noiseTexture,uniformMap:{u_noiseTextureLength:function(){return o},u_noiseDetail:function(){return a},u_noiseOffset:function(){return c}},persists:!1,owner:e,postExecute:function(e){n._ready=!0,n._loading=!1}});t.commandList.push(d),n._loading=!0}function de(e,t){var i=e,r=t.context;i._createVertexArray=!1,i._vaf=i._vaf&&i._vaf.destroy();var n=e._clouds,s=n.length;if(s>0){i._vaf=re(r,s,i._instanced);var o,a=i._vaf.writers;for(o=0;o<s;++o){var c=n[o];ce(e,t,a,c)}i._vaf.commit(Q(r))}}var he=[];function le(e,t){var i=t.context,r=e,n=r._clouds,s=n.length,o=r._cloudsToUpdate,a=r._cloudsToUpdateIndex,c=r._propertiesChanged,u=he;u.length=0,(c[V]||c[z])&&u.push(se),(c[F]||c[q])&&u.push(oe),(c[G]||c[W])&&u.push(ae);var d,h,l,_=u.length,p=r._vaf.writers;if(a/s>.1){for(d=0;d<a;++d)for(h=o[d],h._dirty=!1,l=0;l<_;++l)u[l](e,t,p,h);r._vaf.commit(Q(i))}else{for(d=0;d<a;++d){for(h=o[d],h._dirty=!1,l=0;l<_;++l)u[l](e,t,p,h);r._instanced?r._vaf.subCommit(h._index,1):r._vaf.subCommit(4*h._index,4)}r._vaf.endSubCommits()}r._cloudsToUpdateIndex=0}function _e(e,t,i,s){var o=t.context,a=e,c=new w.Z({defines:[],sources:[i]});a._instanced&&c.defines.push("INSTANCED");var u=new w.Z({defines:[],sources:[s]});a.debugBillboards&&u.defines.push("DEBUG_BILLBOARDS"),a.debugEllipsoids&&u.defines.push("DEBUG_ELLIPSOIDS"),a._sp=P.Z.replaceCache({context:o,shaderProgram:a._sp,vertexShaderSource:c,fragmentShaderSource:u,attributeLocations:r}),a._rs=I.Z.fromCache({depthTest:{enabled:!0,func:U.Z.LESS},depthMask:!1,blending:n.Z.ALPHA_BLEND}),a._spCreated=!0,a._compiledDebugBillboards=a.debugBillboards,a._compiledDebugEllipsoids=a.debugEllipsoids}function pe(e,t){var i=e,r=t.passes,n=i._uniforms,s=t.commandList;if(r.render){var o=i._colorCommands,a=i._vaf.va,c=a.length;o.length=c;for(var u=0;u<c;u++){var d=o[u];(0,v.Z)(d)||(d=o[u]=new S.Z),d.pass=b.Z.TRANSLUCENT,d.owner=e,d.uniformMap=n,d.count=a[u].indicesCount,d.vertexArray=a[u].va,d.shaderProgram=i._sp,d.renderState=i._rs,i._instanced&&(d.count=6,d.instanceCount=i._clouds.length),s.push(d)}}}H.prototype.update=function(e){if(X(this),this.show){var t=this.debugBillboards||this.debugEllipsoids;this._ready=!!t||(0,v.Z)(this._noiseTexture),this._ready||this._loading||t||ue(this,e,p.Z,_.Z),this._instanced=e.context.instancedArrays,r=this._instanced?N:k,Q=this._instanced?te:ee;var i=this._clouds,n=i.length,s=this._cloudsToUpdate,o=this._cloudsToUpdateIndex;this._createVertexArray?de(this,e):o>0&&le(this,e),o>1.5*n&&(s.length=n),!(0,v.Z)(this._vaf)||!(0,v.Z)(this._vaf.va)||!this._ready&!t||(this._spCreated&&this.debugBillboards===this._compiledDebugBillboards&&this.debugEllipsoids===this._compiledDebugEllipsoids||_e(this,e,l.Z,h.Z),pe(this,e))}},H.prototype.isDestroyed=function(){return!1},H.prototype.destroy=function(){return this._noiseTexture=this._noiseTexture&&this._noiseTexture.destroy(),this._sp=this._sp&&this._sp.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),j(this._clouds),(0,g.Z)(this)}},91757:function(e,t){var i={CUMULUS:0,validate:function(e){return e===i.CUMULUS}};t["Z"]=Object.freeze(i)}}]);
//# sourceMappingURL=chunk-vendors-9477cc7e-legacy.2f9225e1.js.map