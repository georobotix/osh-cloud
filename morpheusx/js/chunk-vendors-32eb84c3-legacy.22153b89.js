"use strict";(self["webpackChunkvue3_webpack5"]=self["webpackChunkvue3_webpack5"]||[]).push([[9233],{36033:function(e,t,i){var o=i(88108),r=i(48243),n=i(20305),a=i(60216),s=i(51688),m=i(83856),u=i(59947),l=i(92062),c=i(39960),d=i(17711),h=i(62200),p=i(82982),Z=i(86511),f=i(12572),_=i(64727),g=i(14459),v=i(39756),C=i(26865),b=i(57552),w=i(84935),S=i(55293),P=i(99417),y=i(72248),T=i(4197),E=i(52293),x=i(91473),D=i(35131),R=i(66854),I=i(36135),M=i(63181),k=i(2819),F=i(95555),L=i(39899),N=i(18157),A=i(19385),O=i(20521),U=i(8379),V=i(10667),W=i(24725),B=i(70561),z=i(94170),H=i(55715),G=i(67442),q=i(96548),j=i(47056),Y=i(999),Q=i(52440),X=i(8403),K=i(85079),J=i(55977),$=i(85985),ee=i(94229),te=i(38347),ie=i(95757),oe=i(22277),re=i(73829),ne=i(64060),ae=i(18441),se=i(13638),me=i(34380),ue=i(73316),le=i(89917),ce=i(48244),de=i(72984),he=i(60442),pe=i(79162),Ze=i(87233),fe=i(44747),_e=i(80480),ge=i(74476),ve=i(70419),Ce=i(55757),be=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function we(e){e=(0,h.Z)(e,h.Z.EMPTY_OBJECT);var t=e.canvas,i=e.creditContainer,r=e.creditViewport,n=(0,m.Z)(e.contextOptions);if((0,p.Z)(n)||(n={}),(0,p.Z)(n.webgl)||(n.webgl={}),n.webgl.powerPreference=(0,h.Z)(n.webgl.powerPreference,"high-performance"),!(0,p.Z)(t))throw new f.Z("options and options.canvas are required.");var a=(0,p.Z)(i),s=new A.Z(t,n);a||(i=document.createElement("div"),i.style.position="absolute",i.style.bottom="0",i.style["text-shadow"]="0 0 2px #000000",i.style.color="#ffffff",i.style["font-size"]="10px",i.style["padding-right"]="5px",t.parentNode.appendChild(i)),(0,p.Z)(r)||(r=t.parentNode),this._id=(0,c.Z)(),this._jobScheduler=new te.Z,this._frameState=new K.Z(s,new G.Z(i," â€¢ ",r),this._jobScheduler),this._frameState.scene3DOnly=(0,h.Z)(e.scene3DOnly,!1),this._removeCreditContainer=!a,this._creditContainer=i,this._canvas=t,this._context=s,this._computeEngine=new N.Z(s),this._globe=void 0,this._globeTranslucencyState=new $.Z,this._primitives=new ue.Z,this._groundPrimitives=new ue.Z,this._globeHeight=void 0,this._cameraUnderground=!1,this._logDepthBuffer=s.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new ge.Z,this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=(0,h.Z)(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new j.Z,this._clearColorCommand=new L.Z({color:new u.Z,stencil:0,owner:this}),this._depthClearCommand=new L.Z({depth:1,owner:this}),this._stencilClearCommand=new L.Z({stencil:0}),this._classificationStencilClearCommand=new L.Z({stencil:0,renderState:V.Z.fromCache({stencilMask:Ze.Z.CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new de.Z(this),this._preUpdate=new g.Z,this._postUpdate=new g.Z,this._renderError=new g.Z,this._preRender=new g.Z,this._postRender=new g.Z,this._minimumDisableDepthTestDistance=0,this._debugInspector=new Ce.Z,this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new g.Z,this.morphComplete=new g.Z,this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=u.Z.clone(u.Z.BLACK),this._mode=le.Z.SCENE3D,this._mapProjection=(0,p.Z)(e.mapProjection)?e.mapProjection:new v.Z,this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowGlobeDepth=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new X.Z,this._shadowMapCamera=new B.Z(this),this.shadowMap=new pe.Z({context:s,lightCamera:this._shadowMapCamera,enabled:(0,h.Z)(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=u.Z.clone(u.Z.WHITE),this._actualInvertClassificationColor=u.Z.clone(this._invertClassificationColor),this._invertClassification=new ee.Z,this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new se.Z,this._brdfLutGenerator=new W.Z,this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new he.Z(this),this._cameraUnderground=!1,this._mapMode2D=(0,h.Z)(e.mapMode2D,ie.Z.INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,separatePrimitiveFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=(0,h.Z)(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=(0,h.Z)(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=M.Z.requestCompletedEvent.addEventListener(be(this)),this._removeTaskProcessorListenerCallback=k.Z.taskCompletedEvent.addEventListener(be(this)),this._removeGlobeCallbacks=[];var l=new o.Z(0,0,s.drawingBufferWidth,s.drawingBufferHeight),d=new B.Z(this);this._logDepthBuffer&&(d.frustum.near=.1,d.frustum.far=1e10),this.preloadFlightCamera=new B.Z(this),this.preloadFlightCullingVolume=void 0,this._picking=new ae.Z(this),this._defaultView=new ve.Z(this,d,l),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new fe.Z,Me(this,0,S.Z.now()),this.updateFrameState(),this.initializeFrame()}function Se(e,t){for(var i=0;i<e._removeGlobeCallbacks.length;++i)e._removeGlobeCallbacks[i]();e._removeGlobeCallbacks.length=0;var o=[];(0,p.Z)(t)&&(o.push(t.imageryLayersUpdatedEvent.addEventListener(be(e))),o.push(t.terrainProviderChanged.addEventListener(be(e)))),e._removeGlobeCallbacks=o}function Pe(e,t,i){var o=e._frameState,r=e._context,n=e._view.oit,a=o.shadowState.lightShadowMaps,s=o.shadowState.lightShadowsEnabled,m=t.derivedCommands;(0,p.Z)(t.pickId)&&(m.picking=Y.Z.createPickDerivedCommand(e,t,r,m.picking)),t.pickOnly||(m.depth=Y.Z.createDepthOnlyDerivedCommand(e,t,r,m.depth)),m.originalCommand=t,e._hdr&&(m.hdr=Y.Z.createHdrCommand(t,r,m.hdr),t=m.hdr.command,m=t.derivedCommands),s&&t.receiveShadows&&(m.shadows=pe.Z.createReceiveDerivedCommand(a,t,i,r,m.shadows)),t.pass===U.Z.TRANSLUCENT&&(0,p.Z)(n)&&n.isSupported()&&(s&&t.receiveShadows?(m.oit=(0,p.Z)(m.oit)?m.oit:{},m.oit.shadows=n.createDerivedCommands(m.shadows.receiveCommand,r,m.oit.shadows)):m.oit=n.createDerivedCommands(t,r,m.oit))}Object.defineProperties(we.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return O.Z.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return O.Z.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return oe.Z.isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,Se(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if((0,p.Z)(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if((0,p.Z)(this.globe))return this.globe.terrainProvider},set:function(e){(0,p.Z)(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if((0,p.Z)(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){if(this.scene3DOnly&&e!==le.Z.SCENE3D)throw new f.Z("Only SceneMode.SCENE3D is valid when scene3DOnly is true.");if(e===le.Z.SCENE2D)this.morphTo2D(0);else if(e===le.Z.SCENE3D)this.morphTo3D(0);else{if(e!==le.Z.COLUMBUS_VIEW)throw new f.Z("value must be a valid SceneMode enumeration.");this.morphToColumbusView(0)}this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},useWebVR:{get:function(){return this._useWebVR},set:function(e){if(this.camera.frustum instanceof x.Z)throw new f.Z("VR is unsupported with an orthographic projection.");this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new B.Z(this),(0,p.Z)(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new Q.Z(this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},imagerySplitPosition:{get:function(){return this._frameState.imagerySplitPosition},set:function(e){this._frameState.imagerySplitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){if(!(0,p.Z)(e)||e<0)throw new f.Z("minimumDisableDepthTestDistance must be greater than or equal to 0.0.");this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){var t=this._context,i=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=i!==this._hdr,this._hdr=i}},highDynamicRangeSupported:{get:function(){var e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},cameraUnderground:{get:function(){return this._cameraUnderground}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return.9999}},globeHeight:{get:function(){return this._globeHeight}}}),we.prototype.getCompressedTextureFormatSupported=function(e){var t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc"===e||"etc"===e)&&t.etc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1||("WEBGL_compressed_texture_astc"===e||"astc"===e)&&t.astc||("EXT_texture_compression_bptc"===e||"bc7"===e)&&t.bc7},we.prototype.updateDerivedCommands=function(e){if((0,p.Z)(e.derivedCommands)){var t=this._frameState,i=this._context,o=!1,r=t.shadowState.lastDirtyTime;e.lastDirtyTime!==r&&(e.lastDirtyTime=r,e.dirty=!0,o=!0);var n=t.useLogDepth,a=this._hdr,s=e.derivedCommands,m=(0,p.Z)(s.logDepth),u=(0,p.Z)(s.hdr),l=(0,p.Z)(s.originalCommand),c=n&&!m,d=a&&!u,h=(!n||!a)&&!l;if(e.dirty=e.dirty||c||d||h,e.dirty){e.dirty=!1;var Z=t.shadowState.shadowMaps,f=t.shadowState.shadowsEnabled;f&&e.castShadows&&(s.shadows=pe.Z.createCastDerivedCommand(Z,e,o,i,s.shadows)),(m||c)&&(s.logDepth=Y.Z.createLogDepthCommand(e,i,s.logDepth),Pe(this,s.logDepth.command,o)),(l||h)&&Pe(this,e,o)}}};var ye,Te=new H.Z({pass:z.Z.RENDER}),Ee=new H.Z({pass:z.Z.PRELOAD}),xe=new H.Z({pass:z.Z.PRELOAD_FLIGHT}),De=new H.Z({pass:z.Z.REQUEST_RENDER_MODE_DEFER_CHECK}),Re=new r.Z;function Ie(e){var t=e.globe;if(e._mode===le.Z.SCENE3D&&(0,p.Z)(t)&&t.show&&!e._cameraUnderground&&!e._globeTranslucencyState.translucent){var i=t.ellipsoid,o=e.frameState.minimumTerrainHeight;return Re.radius=i.minimumRadius+o,ye=E.Z.fromBoundingSphere(Re,e.camera.positionWC,ye),ye}}function Me(e,t,i){var o=e._frameState;o.frameNumber=t,o.time=S.Z.clone(i,o.time)}we.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},we.prototype.updateFrameState=function(){var e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=Ie(this),t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof x.Z||this.camera.frustum instanceof D.Z),t.light=this.light,t.cameraUnderground=this._cameraUnderground,t.globeTranslucencyState=this._globeTranslucencyState,(0,p.Z)(this.globe)&&(t.terrainExaggeration=this.globe.terrainExaggeration,t.terrainExaggerationRelativeHeight=this.globe.terrainExaggerationRelativeHeight),(0,p.Z)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=u.Z.clone(this.invertClassificationColor,this._actualInvertClassificationColor),ee.Z.isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,(0,p.Z)(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},we.prototype.isVisible=function(e,t,i){return(0,p.Z)(e)&&(!(0,p.Z)(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==w.Z.OUTSIDE&&(!(0,p.Z)(i)||!e.occlude||!e.boundingVolume.isOccluded(i)))};var ke=new y.Z(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function Fe(e,t,i,o){var r,s=t._frameState,m=s.context,u=e.boundingVolume;(0,p.Z)(t._debugVolume)&&t._debugVolume.destroy();var c=a.Z.clone(u.center);if(s.mode!==le.Z.SCENE3D){c=y.Z.multiplyByPoint(ke,c,c);var d=s.mapProjection,h=d.unproject(c);c=d.ellipsoid.cartographicToCartesian(h)}if((0,p.Z)(u.radius)){var Z=u.radius;r=b.Z.toWireframe(_.Z.createGeometry(new _.Z({radii:new a.Z(Z,Z,Z),vertexFormat:ne.Z.FLAT_VERTEX_FORMAT}))),t._debugVolume=new me.Z({geometryInstances:new C.Z({geometry:r,modelMatrix:y.Z.fromTranslation(c),attributes:{color:new l.Z(1,0,0,1)}}),appearance:new ne.Z({flat:!0,translucent:!1}),asynchronous:!1})}else{var f=u.halfAxes;r=b.Z.toWireframe(n.Z.createGeometry(n.Z.fromDimensions({dimensions:new a.Z(2,2,2),vertexFormat:ne.Z.FLAT_VERTEX_FORMAT}))),t._debugVolume=new me.Z({geometryInstances:new C.Z({geometry:r,modelMatrix:y.Z.fromRotationTranslation(f,c,new y.Z),attributes:{color:new l.Z(1,0,0,1)}}),appearance:new ne.Z({flat:!0,translucent:!1}),asynchronous:!1})}var g,v=s.commandList,w=s.commandList=[];if(t._debugVolume.update(s),e=w[0],s.useLogDepth){var S=Y.Z.createLogDepthCommand(e,m);e=S.command}(0,p.Z)(o)&&(g=i.framebuffer,i.framebuffer=o),e.execute(m,i),(0,p.Z)(g)&&(i.framebuffer=g),s.commandList=v}function Le(e,t,i,o,r){var n=t._frameState;if(!(0,p.Z)(t.debugCommandFilter)||t.debugCommandFilter(e))if(e instanceof L.Z)e.execute(i,o);else{e.debugShowBoundingVolume&&(0,p.Z)(e.boundingVolume)&&Fe(e,t,o,r),n.useLogDepth&&(0,p.Z)(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);var a=n.passes;if(!a.pick&&!a.depth&&t._hdr&&(0,p.Z)(e.derivedCommands)&&(0,p.Z)(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),a.pick||a.depth){if(a.pick&&!a.depth&&(0,p.Z)(e.derivedCommands.picking))return e=e.derivedCommands.picking.pickCommand,void e.execute(i,o);if((0,p.Z)(e.derivedCommands.depth))return e=e.derivedCommands.depth.depthOnlyCommand,void e.execute(i,o)}t.debugShowCommands||t.debugShowFrustums?t._debugInspector.executeDebugShowFrustumsCommand(t,e,o):n.shadowState.lightShadowsEnabled&&e.receiveShadows&&(0,p.Z)(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(i,o):e.execute(i,o)}}function Ne(e,t,i,o){var r=t._frameState,n=e.derivedCommands;(0,p.Z)(n)&&(r.useLogDepth&&(0,p.Z)(n.logDepth)&&(e=n.logDepth.command),n=e.derivedCommands,(0,p.Z)(n.picking)?(e=n.picking.pickCommand,e.execute(i,o)):(0,p.Z)(n.depth)&&(e=n.depth.depthOnlyCommand,e.execute(i,o)))}function Ae(e,t,i){return t.boundingVolume.distanceSquaredTo(i)-e.boundingVolume.distanceSquaredTo(i)}function Oe(e,t,i){return e.boundingVolume.distanceSquaredTo(i)-t.boundingVolume.distanceSquaredTo(i)+P.Z.EPSILON12}function Ue(e,t,i,o,r){var n=e.context;(0,T.Z)(o,Ae,e.camera.positionWC),(0,p.Z)(r)&&t(r.unclassifiedCommand,e,n,i);for(var a=o.length,s=0;s<a;++s)t(o[s],e,n,i)}function Ve(e,t,i,o,r){var n=e.context;(0,T.Z)(o,Oe,e.camera.positionWC),(0,p.Z)(r)&&t(r.unclassifiedCommand,e,n,i);for(var a=o.length,s=0;s<a;++s)t(o[s],e,n,i)}function We(e,t){var i=e._view.debugGlobeDepths,o=i[t];return!(0,p.Z)(o)&&e.context.depthTexture&&(o=new J.Z,i[t]=o),o}ke=y.Z.inverseTransformation(ke,ke);var Be=new R.Z,ze=new I.Z,He=new x.Z,Ge=new D.Z;function qe(e,t){var i,o=e.camera,r=e.context,n=e.frameState,a=r.uniformState;a.updateCamera(o),i=(0,p.Z)(o.frustum.fov)?o.frustum.clone(Be):(0,p.Z)(o.frustum.infiniteProjectionMatrix)?o.frustum.clone(ze):(0,p.Z)(o.frustum.width)?o.frustum.clone(He):o.frustum.clone(Ge),i.near=o.frustum.near,i.far=o.frustum.far,a.updateFrustum(i),a.updatePass(U.Z.ENVIRONMENT);var s,m=n.passes,u=m.pick,l=e._environmentState,c=e._view,d=l.renderTranslucentDepthForPick,h=l.useWebVR;if(!u){var Z,f=l.skyBoxCommand;if((0,p.Z)(f)&&Le(f,e,r,t),l.isSkyAtmosphereVisible&&Le(l.skyAtmosphereCommand,e,r,t),l.isSunVisible)if(l.sunDrawCommand.execute(r,t),e.sunBloom&&!h)Z=l.useGlobeDepthFramebuffer?c.globeDepth.framebuffer:l.usePostProcess?c.sceneFramebuffer.getFramebuffer():l.originalFramebuffer,e._sunPostProcess.execute(r),e._sunPostProcess.copy(r,Z),t.framebuffer=Z;l.isMoonVisible&&l.moonCommand.execute(r,t)}l.useOIT?((0,p.Z)(e._executeOITFunction)||(e._executeOITFunction=function(e,t,i,o,r){c.oit.executeCommands(e,t,i,o,r)}),s=e._executeOITFunction):s=m.render?Ue:Ve;for(var _,g=c.frustumCommandsList,v=g.length,C=l.clearGlobeDepth,b=l.useDepthPlane,w=e._globeTranslucencyState,S=w.translucent,P=e._view.globeTranslucencyFramebuffer,y=l.separatePrimitiveFramebuffer=!1,T=e._depthClearCommand,E=e._stencilClearCommand,x=e._classificationStencilClearCommand,D=e._depthPlane,R=l.usePostProcessSelected,I=o.position.z,M=0;M<v;++M){var k=v-M-1,F=g[k];e.mode===le.Z.SCENE2D?(o.position.z=I-F.near+1,i.far=Math.max(1,F.far-F.near),i.near=1,a.update(n),a.updateFrustum(i)):(i.near=0!==k?F.near*e.opaqueFrustumNearOffset:F.near,i.far=F.far,a.updateFrustum(i));var L,N=e.debugShowGlobeDepth?We(e,k):c.globeDepth;y&&(t.framebuffer=N.framebuffer),e.debugShowGlobeDepth&&(0,p.Z)(N)&&l.useGlobeDepthFramebuffer&&(N.update(r,t,c.viewport,e._hdr,C),N.clear(r,t,e._clearColorCommand.color),L=t.framebuffer,t.framebuffer=N.framebuffer),T.execute(r,t),r.stencilBuffer&&E.execute(r,t),a.updatePass(U.Z.GLOBE);var A,O=F.commands[U.Z.GLOBE],V=F.indices[U.Z.GLOBE];if(S)w.executeGlobeCommands(F,Le,P,e,t);else for(_=0;_<V;++_)Le(O[_],e,r,t);if((0,p.Z)(N)&&l.useGlobeDepthFramebuffer&&N.executeCopyDepth(r,t),e.debugShowGlobeDepth&&(0,p.Z)(N)&&l.useGlobeDepthFramebuffer&&(t.framebuffer=L),!l.renderTranslucentDepthForPick)if(a.updatePass(U.Z.TERRAIN_CLASSIFICATION),O=F.commands[U.Z.TERRAIN_CLASSIFICATION],V=F.indices[U.Z.TERRAIN_CLASSIFICATION],S)w.executeGlobeClassificationCommands(F,Le,P,e,t);else for(_=0;_<V;++_)Le(O[_],e,r,t);if(C&&(T.execute(r,t),b&&D.execute(r,t)),y&&(t.framebuffer=N.primitiveFramebuffer),!l.useInvertClassification||u||l.renderTranslucentDepthForPick){for(a.updatePass(U.Z.CESIUM_3D_TILE),O=F.commands[U.Z.CESIUM_3D_TILE],V=F.indices[U.Z.CESIUM_3D_TILE],_=0;_<V;++_)Le(O[_],e,r,t);if(V>0&&((0,p.Z)(N)&&l.useGlobeDepthFramebuffer&&N.executeUpdateDepth(r,t,C),!l.renderTranslucentDepthForPick))for(a.updatePass(U.Z.CESIUM_3D_TILE_CLASSIFICATION),O=F.commands[U.Z.CESIUM_3D_TILE_CLASSIFICATION],V=F.indices[U.Z.CESIUM_3D_TILE_CLASSIFICATION],_=0;_<V;++_)Le(O[_],e,r,t)}else{e._invertClassification.clear(r,t);var W=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo,a.updatePass(U.Z.CESIUM_3D_TILE),O=F.commands[U.Z.CESIUM_3D_TILE],V=F.indices[U.Z.CESIUM_3D_TILE],_=0;_<V;++_)Le(O[_],e,r,t);for((0,p.Z)(N)&&l.useGlobeDepthFramebuffer&&N.executeUpdateDepth(r,t,C),a.updatePass(U.Z.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),O=F.commands[U.Z.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],V=F.indices[U.Z.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],_=0;_<V;++_)Le(O[_],e,r,t);for(t.framebuffer=W,e._invertClassification.executeClassified(r,t),1===n.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(r,t),V>0&&r.stencilBuffer&&x.execute(r,t),a.updatePass(U.Z.CESIUM_3D_TILE_CLASSIFICATION),O=F.commands[U.Z.CESIUM_3D_TILE_CLASSIFICATION],V=F.indices[U.Z.CESIUM_3D_TILE_CLASSIFICATION],_=0;_<V;++_)Le(O[_],e,r,t)}for(V>0&&r.stencilBuffer&&E.execute(r,t),a.updatePass(U.Z.OPAQUE),O=F.commands[U.Z.OPAQUE],V=F.indices[U.Z.OPAQUE],_=0;_<V;++_)Le(O[_],e,r,t);0!==k&&e.mode!==le.Z.SCENE2D&&(i.near=F.near,a.updateFrustum(i)),!u&&l.useInvertClassification&&n.invertClassificationColor.alpha<1&&(A=e._invertClassification),a.updatePass(U.Z.TRANSLUCENT),O=F.commands[U.Z.TRANSLUCENT],O.length=F.indices[U.Z.TRANSLUCENT],s(e,Le,t,O,A);var B=F.indices[U.Z.CESIUM_3D_TILE_CLASSIFICATION]>0;if(B&&c.translucentTileClassification.isSupported()&&(c.translucentTileClassification.executeTranslucentCommands(e,Le,t,O,N.framebuffer),c.translucentTileClassification.executeClassificationCommands(e,Le,t,F)),r.depthTexture&&e.useDepthPicking&&(l.useGlobeDepthFramebuffer||d)){var z=d?t.framebuffer.depthStencilTexture:N.framebuffer.depthStencilTexture,H=e._picking.getPickDepth(e,k);H.update(r,z),H.executeCopyDepth(r,t)}if(y&&(t.framebuffer=N.framebuffer),!u&&R){var G=t.framebuffer;if(t.framebuffer=c.sceneFramebuffer.getIdFramebuffer(),i.near=0!==k?F.near*e.opaqueFrustumNearOffset:F.near,i.far=F.far,a.updateFrustum(i),a.updatePass(U.Z.GLOBE),O=F.commands[U.Z.GLOBE],V=F.indices[U.Z.GLOBE],S)w.executeGlobeCommands(F,Ne,P,e,t);else for(_=0;_<V;++_)Ne(O[_],e,r,t);for(C&&(T.framebuffer=t.framebuffer,T.execute(r,t),T.framebuffer=void 0),C&&b&&D.execute(r,t),a.updatePass(U.Z.CESIUM_3D_TILE),O=F.commands[U.Z.CESIUM_3D_TILE],V=F.indices[U.Z.CESIUM_3D_TILE],_=0;_<V;++_)Ne(O[_],e,r,t);for(a.updatePass(U.Z.OPAQUE),O=F.commands[U.Z.OPAQUE],V=F.indices[U.Z.OPAQUE],_=0;_<V;++_)Ne(O[_],e,r,t);for(a.updatePass(U.Z.TRANSLUCENT),O=F.commands[U.Z.TRANSLUCENT],V=F.indices[U.Z.TRANSLUCENT],_=0;_<V;++_)Ne(O[_],e,r,t);t.framebuffer=G}}}function je(e){var t=e.context.uniformState;t.updatePass(U.Z.COMPUTE);var i=e._environmentState.sunComputeCommand;(0,p.Z)(i)&&i.execute(e._computeEngine);for(var o=e._computeCommandList,r=o.length,n=0;n<r;++n)o[n].execute(e._computeEngine)}function Ye(e,t){var i=e.context.uniformState;i.updatePass(U.Z.OVERLAY);for(var o=e.context,r=e._overlayCommandList,n=r.length,a=0;a<n;++a)r[a].execute(o,t)}function Qe(e,t,i){for(var o=i.shadowMapCullingVolume,r=i.isPointLight,n=i.passes,a=n.length,s=t.length,m=0;m<s;++m){var u=t[m];if(e.updateDerivedCommands(u),u.castShadows&&(u.pass===U.Z.GLOBE||u.pass===U.Z.CESIUM_3D_TILE||u.pass===U.Z.OPAQUE||u.pass===U.Z.TRANSLUCENT)&&e.isVisible(u,o))if(r)for(var l=0;l<a;++l)n[l].commandList.push(u);else if(1===a)n[0].commandList.push(u);else for(var c=!1,d=a-1;d>=0;--d){var h=n[d].cullingVolume;if(e.isVisible(u,h))n[d].commandList.push(u),c=!0;else if(c)break}}}function Xe(e){var t=e.frameState,i=t.shadowState.shadowMaps,o=i.length;if(t.shadowState.shadowsEnabled)for(var r=e.context,n=r.uniformState,a=0;a<o;++a){var s=i[a];if(!s.outOfView){var m,u=s.passes,l=u.length;for(m=0;m<l;++m)u[m].commandList.length=0;var c=e.frameState.commandList;for(Qe(e,c,s),m=0;m<l;++m){var d=s.passes[m];n.updateCamera(d.camera),s.updatePass(r,m);for(var h=d.commandList.length,p=0;p<h;++p){var Z=d.commandList[p];n.updatePass(Z.pass),Le(Z.derivedCommands.shadows.castCommands[a],e,r,d.passState)}}}}}var Ke=new a.Z;function Je(e,t,i){var o=e._view,r=o.camera,n=e._environmentState,s=n.renderTranslucentDepthForPick;ht(e,t,i),s||dt(e),o.createPotentiallyVisibleSet(e),s||(je(e),Xe(e));var m=t.viewport;m.x=0,m.y=0,m.width=.5*m.width;var u=B.Z.clone(r,e._cameraVR);u.frustum=r.frustum;var l=r.frustum.near,c=l*(0,h.Z)(e.focalLength,5),d=(0,h.Z)(e.eyeSeparation,c/30),p=a.Z.multiplyByScalar(u.right,.5*d,Ke);r.frustum.aspectRatio=m.width/m.height;var Z=.5*d*l/c;a.Z.add(u.position,p,r.position),r.frustum.xOffset=Z,qe(e,t),m.x=m.width,a.Z.subtract(u.position,p,r.position),r.frustum.xOffset=-Z,qe(e,t),B.Z.clone(u,r)}we.prototype.updateAndExecuteCommands=function(e,t){var i=this._frameState,o=i.mode,r=this._environmentState.useWebVR;r?Je(this,e,t):o!==le.Z.SCENE2D||this._mapMode2D===ie.Z.ROTATE?mt(!0,this,e,t):(ht(this,e,t),st(this,e))};var $e=new s.Z(Math.PI,P.Z.PI_OVER_TWO),et=new a.Z,tt=new a.Z,it=new y.Z,ot=new y.Z,rt=new a.Z,nt=new a.Z,at=new o.Z;function st(e,t){var i=e.context,r=e.frameState,n=e.camera,s=t.viewport,m=o.Z.clone(s,at);t.viewport=m;var u=$e,l=et,c=e.mapProjection;c.project(u,l);var d=a.Z.clone(n.position,tt),h=y.Z.clone(n.transform,ot),p=n.frustum.clone();n._setTransform(y.Z.IDENTITY);var Z=y.Z.computeViewportTransformation(m,0,1,it),f=n.frustum.projectionMatrix,_=n.positionWC.y,g=a.Z.fromElements(P.Z.sign(_)*l.x-_,0,-n.positionWC.x,rt),v=F.Z.pointToGLWindowCoordinates(f,Z,g,nt);v.x=Math.floor(v.x);var C=m.x,b=m.width;if(0===_||v.x<=C||v.x>=C+b)mt(!0,e,t);else if(Math.abs(C+.5*b-v.x)<1)m.width=v.x-m.x,n.position.x*=P.Z.sign(n.position.x),n.frustum.right=0,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),mt(!0,e,t),m.x=v.x,n.position.x=-n.position.x,n.frustum.right=-n.frustum.left,n.frustum.left=0,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),mt(!1,e,t);else if(v.x>C+.5*b){m.width=v.x-C;var w=n.frustum.right;n.frustum.right=l.x-_,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),mt(!0,e,t),m.x=v.x,m.width=C+b-v.x,n.position.x=-n.position.x,n.frustum.left=-n.frustum.right,n.frustum.right=w-2*n.frustum.right,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),mt(!1,e,t)}else{m.x=v.x,m.width=C+b-v.x;var S=n.frustum.left;n.frustum.left=-l.x-_,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),mt(!0,e,t),m.x=C,m.width=v.x-C,n.position.x=-n.position.x,n.frustum.right=-n.frustum.left,n.frustum.left=S-2*n.frustum.left,r.cullingVolume=n.frustum.computeCullingVolume(n.positionWC,n.directionWC,n.upWC),i.uniformState.update(r),mt(!1,e,t)}n._setTransform(h),a.Z.clone(d,n.position),n.frustum=p.clone(),t.viewport=s}function mt(e,t,i,o){var r=t._environmentState,n=t._view,a=r.renderTranslucentDepthForPick;e||a||(t.frameState.commandList.length=0),a||dt(t),n.createPotentiallyVisibleSet(t),e&&((0,p.Z)(o)&&ht(t,i,o),a||(je(t),Xe(t))),qe(t,i)}var ut=new d.Z;function lt(e){var t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new q.Z({camera:e.camera,updateOnChange:!1,frustumSplits:t.frustumSplits}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),(0,p.Z)(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}function ct(e){var t=e._frameState,i=t.shadowMaps,o=i.length,r=o>0&&!t.passes.pick&&e.mode===le.Z.SCENE3D;if(r!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=r),t.shadowState.lightShadowsEnabled=!1,r){for(var n=0;n<o;++n)if(i[n]!==t.shadowState.shadowMaps[n]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(var a=0;a<o;++a){var s=i[a];s.update(t),t.shadowState.shadowMaps.push(s),s.fromLightSource&&(t.shadowState.lightShadowMaps.push(s),t.shadowState.lightShadowsEnabled=!0),s.dirty&&(++t.shadowState.lastDirtyTime,s.dirty=!1)}}}function dt(e){var t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),lt(e),ct(e),e._globe&&e._globe.render(t)}function ht(e,t,i){var o=e._context,r=e._frameState,n=e._environmentState,a=e._view,s=e._frameState.passes,m=s.pick,l=n.useWebVR;n.originalFramebuffer=t.framebuffer,(0,p.Z)(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!l?e._sunPostProcess=new _e.Z:(0,p.Z)(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!(0,p.Z)(e.sun)&&(0,p.Z)(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);var c=e._clearColorCommand;u.Z.clone(i,c.color),c.execute(o,t);var d=n.useGlobeDepthFramebuffer=(0,p.Z)(a.globeDepth);d&&(a.globeDepth.update(o,t,a.viewport,e._hdr,n.clearGlobeDepth),a.globeDepth.clear(o,t,i));var h=a.oit,Z=n.useOIT=!m&&(0,p.Z)(h)&&h.isSupported();Z&&(h.update(o,t,a.globeDepth.framebuffer,e._hdr),h.clear(o,t,i),n.useOIT=h.isSupported());var f=e.postProcessStages,_=n.usePostProcess=!m&&(e._hdr||f.length>0||f.ambientOcclusion.enabled||f.fxaa.enabled||f.bloom.enabled);n.usePostProcessSelected=!1,_&&(a.sceneFramebuffer.update(o,a.viewport,e._hdr),a.sceneFramebuffer.clear(o,t,i),f.update(o,r.useLogDepth,e._hdr),f.clear(o),_=n.usePostProcess=f.ready,n.usePostProcessSelected=_&&f.hasSelected),n.isSunVisible&&e.sunBloom&&!l?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(o,t,i)):d?t.framebuffer=a.globeDepth.framebuffer:_&&(t.framebuffer=a.sceneFramebuffer.getFramebuffer()),(0,p.Z)(t.framebuffer)&&c.execute(o,t);var g,v=n.useInvertClassification=!m&&(0,p.Z)(t.framebuffer)&&e.invertClassification;if(v)if(1===e.frameState.invertClassificationColor.alpha&&n.useGlobeDepthFramebuffer&&(g=a.globeDepth.framebuffer),(0,p.Z)(g)||o.depthTexture){if(e._invertClassification.previousFramebuffer=g,e._invertClassification.update(o),e._invertClassification.clear(o,t),e.frameState.invertClassificationColor.alpha<1&&Z){var C=e._invertClassification.unclassifiedCommand,b=C.derivedCommands;b.oit=h.createDerivedCommands(C,o,b.oit)}}else n.useInvertClassification=!1;e._globeTranslucencyState.translucent&&a.globeTranslucencyFramebuffer.updateAndClear(e._hdr,a.viewport,o,t)}function pt(e){for(var t=e._frameState.afterRender,i=0,o=t.length;i<o;++i)t[i](),e.requestRender();t.length=0}function Zt(e){var t=e._globe,i=e.camera,o=i.positionCartographic;if((0,p.Z)(t)&&t.show&&(0,p.Z)(o))return t.getHeight(o)}function ft(e){var t=e.camera,i=e._mode,o=e.globe,r=e._screenSpaceCameraController,n=t.positionCartographic;if(!(0,p.Z)(n))return!1;if(!r.onMap()&&n.height<0)return!0;if(!(0,p.Z)(o)||!o.show||i===le.Z.SCENE2D||i===le.Z.MORPHING)return!1;var a=e._globeHeight;return(0,p.Z)(a)&&n.height<a}function _t(e,t){if(e.debugShowFramesPerSecond){if(!(0,p.Z)(e._performanceDisplay)){var i=document.createElement("div");i.className="cesium-performanceDisplay-defaultContainer";var o=e._canvas.parentNode;o.appendChild(i);var r=new re.Z({container:i});e._performanceDisplay=r,e._performanceContainer=i}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else(0,p.Z)(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}function gt(e){e._jobScheduler.resetBudgets();var t=e._frameState,i=e.primitives;i.prePassesUpdate(t),(0,p.Z)(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function vt(e){var t=e._frameState,i=e.primitives;i.postPassesUpdate(t),M.Z.update()}we.prototype.updateEnvironment=function(){var e=this._frameState,t=this._view,i=this._environmentState,o=e.passes.render,r=e.passes.offscreen,n=this.skyAtmosphere,a=this.globe,s=this._globeTranslucencyState;if(!o||this._mode!==le.Z.SCENE2D&&t.camera.frustum instanceof x.Z||!s.environmentVisible)i.skyAtmosphereCommand=void 0,i.skyBoxCommand=void 0,i.sunDrawCommand=void 0,i.sunComputeCommand=void 0,i.moonCommand=void 0;else{(0,p.Z)(n)?((0,p.Z)(a)&&(n.setDynamicAtmosphereColor(a.enableLighting&&a.dynamicAtmosphereLighting,a.dynamicAtmosphereLightingFromSun),i.isReadyForAtmosphere=i.isReadyForAtmosphere||a._surface._tilesToRender.length>0),i.skyAtmosphereCommand=n.update(e,a),(0,p.Z)(i.skyAtmosphereCommand)&&this.updateDerivedCommands(i.skyAtmosphereCommand)):i.skyAtmosphereCommand=void 0,i.skyBoxCommand=(0,p.Z)(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;var m=(0,p.Z)(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;i.sunDrawCommand=(0,p.Z)(m)?m.drawCommand:void 0,i.sunComputeCommand=(0,p.Z)(m)?m.computeCommand:void 0,i.moonCommand=(0,p.Z)(this.moon)?this.moon.update(e):void 0}var u=i.clearGlobeDepth=(0,p.Z)(a)&&a.show&&(!a.depthTestAgainstTerrain||this.mode===le.Z.SCENE2D),l=i.useDepthPlane=u&&this.mode===le.Z.SCENE3D&&s.useDepthPlane;l&&this._depthPlane.update(e),i.renderTranslucentDepthForPick=!1,i.useWebVR=this._useWebVR&&this.mode!==le.Z.SCENE2D&&!r;for(var c=e.mode!==le.Z.SCENE3D||s.sunVisibleThroughGlobe?void 0:e.occluder,d=e.cullingVolume,h=ut.planes,Z=0;Z<5;++Z)h[Z]=d.planes[Z];d=ut,i.isSkyAtmosphereVisible=(0,p.Z)(i.skyAtmosphereCommand)&&i.isReadyForAtmosphere,i.isSunVisible=this.isVisible(i.sunDrawCommand,d,c),i.isMoonVisible=this.isVisible(i.moonCommand,d,c);var f=this.specularEnvironmentMaps,_=this._specularEnvironmentMapAtlas;!(0,p.Z)(f)||(0,p.Z)(_)&&_.url===f?!(0,p.Z)(f)&&(0,p.Z)(_)&&(_.destroy(),this._specularEnvironmentMapAtlas=void 0):(_=_&&_.destroy(),this._specularEnvironmentMapAtlas=new oe.Z(f)),(0,p.Z)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},we.prototype.resolveFramebuffers=function(e){var t=this._context,i=this._frameState,o=this._environmentState,r=this._view,n=r.globeDepth,a=o.useOIT,s=o.useGlobeDepthFramebuffer,m=o.usePostProcess,u=o.originalFramebuffer,l=s?n.framebuffer:void 0,c=r.sceneFramebuffer.getFramebuffer(),d=r.sceneFramebuffer.getIdFramebuffer();o.separatePrimitiveFramebuffer&&n.executeMergeColor(t,e),a&&(e.framebuffer=m?c:u,r.oit.execute(t,e));var p=r.translucentTileClassification;if(p.hasTranslucentDepth&&p.isSupported()&&p.execute(this,e),m){var Z=c;s&&!a&&(Z=l);var f=this.postProcessStages,_=Z.getColorTexture(0),g=d.getColorTexture(0),v=(0,h.Z)(l,c).depthStencilTexture;f.execute(t,_,v,g),f.copy(t,u)}a||m||!s||(e.framebuffer=u,n.executeCopyColor(t,e));var C=i.useLogDepth;if(this.debugShowGlobeDepth&&s){var b=We(this,this.debugShowDepthFrustum-1);b.executeDebugGlobeDepth(t,e,C)}if(this.debugShowPickDepth&&s){var w=this._picking.getPickDepth(this,this.debugShowDepthFrustum-1);w.executeDebugPickDepth(t,e,C)}},we.prototype.initializeFrame=function(){120===this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._globeHeight=Zt(this),this._cameraUnderground=ft(this),this._globeTranslucencyState.update(this),this._screenSpaceCameraController.update(),(0,p.Z)(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};var Ct=new u.Z;function bt(e){var t=e._frameState,i=e.context,r=i.uniformState,n=e._defaultView;e._view=n,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=Te;var s=(0,h.Z)(e.backgroundColor,u.Z.BLACK);e._hdr&&(s=u.Z.clone(s,Ct),s.red=Math.pow(s.red,e.gamma),s.green=Math.pow(s.green,e.gamma),s.blue=Math.pow(s.blue,e.gamma)),t.backgroundColor=s,e.fog.update(t),r.update(t);var m=e.shadowMap;(0,p.Z)(m)&&m.enabled&&(!(0,p.Z)(e.light)||e.light instanceof fe.Z?a.Z.negate(r.sunDirectionWC,e._shadowMapCamera.direction):a.Z.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(m)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var l=n.viewport;l.x=0,l.y=0,l.width=i.drawingBufferWidth,l.height=i.drawingBufferHeight;var c=n.passState;c.framebuffer=void 0,c.blendingEnabled=void 0,c.scissorTest=void 0,c.viewport=o.Z.clone(l,c.viewport),(0,p.Z)(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(c,s),e.resolveFramebuffers(c),c.framebuffer=void 0,Ye(e,c),(0,p.Z)(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),i.endFrame()}function wt(e,t){try{t(e)}catch(i){if(e._renderError.raiseEvent(e,i),e.rethrowRenderErrors)throw i}}function St(e){return e._picking.updateMostDetailedRayPicks(e)}function Pt(e){var t=e._frameState;Ee.camera=t.camera,Ee.cullingVolume=t.cullingVolume;var i=e.primitives;i.updateForPass(t,Ee)}function yt(e){var t=e._frameState,i=t.camera;if(i.canPreloadFlight()){xe.camera=e.preloadFlightCamera,xe.cullingVolume=e.preloadFlightCullingVolume;var o=e.primitives;o.updateForPass(t,xe)}}function Tt(e){e.primitives.updateForPass(e._frameState,De)}we.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,(0,p.Z)(e)||(e=S.Z.now());var i=this._view.checkForCameraUpdates(this),o=!this.requestRenderMode||this._renderRequested||i||this._logDepthBufferDirty||this._hdrDirty||this.mode===le.Z.MORPHING;if(!o&&(0,p.Z)(this.maximumRenderTimeChange)&&(0,p.Z)(this._lastRenderTime)){var r=Math.abs(S.Z.secondsDifference(this._lastRenderTime,e));o=o||r>this.maximumRenderTimeChange}if(o){this._lastRenderTime=S.Z.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1;var n=P.Z.incrementWrap(t.frameNumber,15e6,1);Me(this,n,e),t.newFrame=!0}wt(this,gt),this.primitives.show&&(wt(this,St),wt(this,Pt),wt(this,yt),o||wt(this,Tt)),this._postUpdate.raiseEvent(this,e),o&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),wt(this,bt)),_t(this,o),wt(this,vt),pt(this),o&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},we.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},we.prototype.requestRender=function(){this._renderRequested=!0},we.prototype.clampLineWidth=function(e){return Math.max(O.Z.minimumAliasedLineWidth,Math.min(e,O.Z.maximumAliasedLineWidth))},we.prototype.pick=function(e,t,i){return this._picking.pick(this,e,t,i)},we.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},we.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},we.prototype.drillPick=function(e,t,i,o){return this._picking.drillPick(this,e,t,i,o)},we.prototype.pickFromRay=function(e,t,i){return this._picking.pickFromRay(this,e,t,i)},we.prototype.drillPickFromRay=function(e,t,i,o){return this._picking.drillPickFromRay(this,e,t,i,o)},we.prototype.pickFromRayMostDetailed=function(e,t,i){return this._picking.pickFromRayMostDetailed(this,e,t,i)},we.prototype.drillPickFromRayMostDetailed=function(e,t,i,o){return this._picking.drillPickFromRayMostDetailed(this,e,t,i,o)},we.prototype.sampleHeight=function(e,t,i){return this._picking.sampleHeight(this,e,t,i)},we.prototype.clampToHeight=function(e,t,i,o){return this._picking.clampToHeight(this,e,t,i,o)},we.prototype.sampleHeightMostDetailed=function(e,t,i){return this._picking.sampleHeightMostDetailed(this,e,t,i)},we.prototype.clampToHeightMostDetailed=function(e,t,i){return this._picking.clampToHeightMostDetailed(this,e,t,i)},we.prototype.cartesianToCanvasCoordinates=function(e,t){return ce.Z.wgs84ToWindowCoordinates(this,e,t)},we.prototype.completeMorph=function(){this._transitioner.completeMorph()},we.prototype.morphTo2D=function(e){var t,i=this.globe;t=(0,p.Z)(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=(0,h.Z)(e,2),this._transitioner.morphTo2D(e,t)},we.prototype.morphToColumbusView=function(e){var t,i=this.globe;t=(0,p.Z)(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=(0,h.Z)(e,2),this._transitioner.morphToColumbusView(e,t)},we.prototype.morphTo3D=function(e){var t,i=this.globe;t=(0,p.Z)(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=(0,h.Z)(e,2),this._transitioner.morphTo3D(e,t)},we.prototype.isDestroyed=function(){return!1},we.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),(0,p.Z)(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(var e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,(0,Z.Z)(this)},t["Z"]=we},60442:function(e,t,i){var o=i(60838),r=i(60216),n=i(63367),a=i(51688),s=i(62200),m=i(82982),u=i(86511),l=i(12572),c=i(50491),d=i(57674),h=i(67627),p=i(89232),Z=i(99417),f=i(68201),_=i(72248),g=i(91473),v=i(7749),C=i(87811),b=i(68457),w=i(78257),S=i(95555),P=i(90070),y=i(84321),T=i(95757),E=i(89917),x=i(48244),D=i(74476);function R(e){if(!(0,m.Z)(e))throw new l.Z("scene is required.");this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=y.Z.LEFT_DRAG,this.zoomEventTypes=[y.Z.RIGHT_DRAG,y.Z.WHEEL,y.Z.PINCH],this.rotateEventTypes=y.Z.LEFT_DRAG,this.tiltEventTypes=[y.Z.MIDDLE_DRAG,y.Z.PINCH,{eventType:y.Z.LEFT_DRAG,modifier:p.Z.CTRL},{eventType:y.Z.RIGHT_DRAG,modifier:p.Z.CTRL}],this.lookEventTypes={eventType:y.Z.LEFT_DRAG,modifier:p.Z.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=e,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new P.Z(e.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement"]},this._tweens=new D.Z,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new o.Z(-1,-1),this._tiltCenter=new r.Z,this._rotateMousePosition=new o.Z(-1,-1),this._rotateStartPosition=new r.Z,this._strafeStartPosition=new r.Z,this._strafeMousePosition=new o.Z,this._strafeEndMousePosition=new o.Z,this._zoomMouseStart=new o.Z(-1,-1),this._zoomWorldPosition=new r.Z,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1;var t=e.mapProjection;this._maxCoord=t.project(new a.Z(Math.PI,Z.Z.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4}function I(e,t){if(e<0)return 0;var i=25*(1-t);return Math.exp(-i*e)}function M(e){return o.Z.equalsEpsilon(e.startPosition,e.endPosition,Z.Z.EPSILON14)}var k=.4;function F(e,t,i,r,n,a,s){var u=a[s];(0,m.Z)(u)||(u=a[s]={startPosition:new o.Z,endPosition:new o.Z,motion:new o.Z,inertiaEnabled:!0});var l=e.getButtonPressTime(t,i),c=e.getButtonReleaseTime(t,i),d=l&&c&&(c.getTime()-l.getTime())/1e3,h=new Date,p=c&&(h.getTime()-c.getTime())/1e3;if(l&&c&&d<k){var Z=I(p,r),f=e.getLastMovement(t,i);if(!(0,m.Z)(f)||M(f)||!u.inertiaEnabled)return;if(u.motion.x=.5*(f.endPosition.x-f.startPosition.x),u.motion.y=.5*(f.endPosition.y-f.startPosition.y),u.startPosition=o.Z.clone(f.startPosition,u.startPosition),u.endPosition=o.Z.multiplyByScalar(u.motion,Z,u.endPosition),u.endPosition=o.Z.add(u.startPosition,u.endPosition,u.endPosition),isNaN(u.endPosition.x)||isNaN(u.endPosition.y)||o.Z.distance(u.startPosition,u.endPosition)<.5)return;if(!e.isButtonDown(t,i)){var _=e.getStartMousePosition(t,i);n(a,_,u)}}}function L(e,t){if((0,m.Z)(t)){var i=e[t];(0,m.Z)(i)&&(i.inertiaEnabled=!0);var o=e._inertiaDisablers[t];if((0,m.Z)(o))for(var r=o.length,n=0;n<r;++n)i=e[o[n]],(0,m.Z)(i)&&(i.inertiaEnabled=!1)}}var N=[];function A(e,t,i,o,r,n){if((0,m.Z)(i)){var a=e._aggregator;Array.isArray(i)||(N[0]=i,i=N);for(var s=i.length,u=0;u<s;++u){var l=i[u],c=(0,m.Z)(l.eventType)?l.eventType:l,d=l.modifier,h=a.isMoving(c,d)&&a.getMovement(c,d),p=a.getStartMousePosition(c,d);e.enableInputs&&t&&(h?(o(e,p,h),L(e,n)):r<1&&F(a,c,d,r,o,e,n))}}}var O=new b.Z,U=new r.Z,V=new o.Z,W=new r.Z,B=new o.Z,z=new r.Z,H=new r.Z,G=new r.Z,q=new r.Z,j=new r.Z,Y=new r.Z,Q=new r.Z,X=new r.Z,K=new r.Z,J=new r.Z,$=new r.Z,ee=new r.Z,te=new r.Z,ie=new r.Z,oe=new r.Z,re=new r.Z,ne=new r.Z,ae=new r.Z,se={orientation:new d.Z};function me(e,t,i,n,a,s){var u=1;(0,m.Z)(s)&&(u=Z.Z.clamp(Math.abs(s),.25,1));var l=e.minimumZoomDistance*u,c=e.maximumZoomDistance,d=a-l,h=n*d;h=Z.Z.clamp(h,e._minimumZoomRate,e._maximumZoomRate);var p=i.endPosition.y-i.startPosition.y,f=p/e._scene.canvas.clientHeight;f=Math.min(f,e.maximumMovementRatio);var _=h*f;if(e.enableCollisionDetection||0===e.minimumZoomDistance||!(0,m.Z)(e._globe)){if(_>0&&Math.abs(a-l)<1)return;if(_<0&&Math.abs(a-c)<1)return;a-_<l?_=a-l-1:a-_>c&&(_=a-c)}var v=e._scene,C=v.camera,b=v.mode,w=se.orientation;if(w.heading=C.heading,w.pitch=C.pitch,w.roll=C.roll,C.frustum instanceof g.Z)Math.abs(_)>0&&(C.zoomIn(_),C._adjustOrthographicFrustum());else{var S,P=o.Z.equals(t,e._zoomMouseStart),y=e._zoomingOnVector,T=e._rotatingZoom;if(P||(e._zoomMouseStart=o.Z.clone(t,e._zoomMouseStart),(0,m.Z)(e._globe)&&(b===E.Z.SCENE2D?(S=C.getPickRay(t,O).origin,S=r.Z.fromElements(S.y,S.z,S.x)):S=we(e,t,U)),(0,m.Z)(S)?(e._useZoomWorldPosition=!0,e._zoomWorldPosition=r.Z.clone(S,e._zoomWorldPosition)):e._useZoomWorldPosition=!1,y=e._zoomingOnVector=!1,T=e._rotatingZoom=!1,e._zoomingUnderground=e._cameraUnderground),e._useZoomWorldPosition){var D=b===E.Z.COLUMBUS_VIEW;if(C.positionCartographic.height<2e6&&(T=!0),!P||T){if(b===E.Z.SCENE2D){var R=e._zoomWorldPosition,I=C.position;if(!r.Z.equals(R,I)&&C.positionCartographic.height<2*e._maxCoord.x){var M=C.position.x,k=r.Z.subtract(R,I,W);r.Z.normalize(k,k);var F=r.Z.distance(R,I)*_/(.5*C.getMagnitude());C.move(k,.5*F),(C.position.x<0&&M>0||C.position.x>0&&M<0)&&(S=C.getPickRay(t,O).origin,S=r.Z.fromElements(S.y,S.z,S.x),e._zoomWorldPosition=r.Z.clone(S,e._zoomWorldPosition))}}else if(b===E.Z.SCENE3D){var L=r.Z.normalize(C.position,j);if(e._cameraUnderground||e._zoomingUnderground||C.positionCartographic.height<3e3&&Math.abs(r.Z.dot(C.direction,L))<.6)D=!0;else{var N=v.canvas,A=B;A.x=N.clientWidth/2,A.y=N.clientHeight/2;var me=we(e,A,z);if((0,m.Z)(me))if(C.positionCartographic.height<1e6){if(!(r.Z.dot(C.direction,L)>=-.5)){var ue=Q;r.Z.clone(C.position,ue);var le=e._zoomWorldPosition,ce=Y;if(ce=r.Z.normalize(le,ce),r.Z.dot(ce,L)<0)return;var de=oe,he=J;r.Z.clone(C.direction,he),r.Z.add(ue,r.Z.multiplyByScalar(he,1e3,re),de);var pe=$,Ze=ee;r.Z.subtract(le,ue,pe),r.Z.normalize(pe,Ze);var fe=r.Z.dot(L,Ze);if(fe>=0)return void(e._zoomMouseStart.x=-1);var _e=Math.acos(-fe),ge=r.Z.magnitude(ue),ve=r.Z.magnitude(le),Ce=ge-_,be=r.Z.magnitude(pe),Se=Math.asin(Z.Z.clamp(be/ve*Math.sin(_e),-1,1)),Pe=Math.asin(Z.Z.clamp(Ce/ve*Math.sin(_e),-1,1)),ye=Se-Pe+_e,Te=X;r.Z.normalize(ue,Te);var Ee=K;Ee=r.Z.cross(Ze,Te,Ee),Ee=r.Z.normalize(Ee,Ee),r.Z.normalize(r.Z.cross(Te,Ee,re),he),r.Z.multiplyByScalar(r.Z.normalize(de,re),r.Z.magnitude(de)-_,de),r.Z.normalize(ue,ue),r.Z.multiplyByScalar(ue,Ce,ue);var xe=te;r.Z.multiplyByScalar(r.Z.add(r.Z.multiplyByScalar(Te,Math.cos(ye)-1,ne),r.Z.multiplyByScalar(he,Math.sin(ye),ae),re),Ce,xe),r.Z.add(ue,xe,ue),r.Z.normalize(de,Te),r.Z.normalize(r.Z.cross(Te,Ee,re),he);var De=ie;return r.Z.multiplyByScalar(r.Z.add(r.Z.multiplyByScalar(Te,Math.cos(ye)-1,ne),r.Z.multiplyByScalar(he,Math.sin(ye),ae),re),r.Z.magnitude(de),De),r.Z.add(de,De,de),r.Z.clone(ue,C.position),r.Z.normalize(r.Z.subtract(de,ue,re),C.direction),r.Z.clone(C.direction,C.direction),r.Z.cross(C.direction,C.up,C.right),r.Z.cross(C.right,C.direction,C.up),void C.setView(se)}D=!0}else{var Re=r.Z.normalize(me,H),Ie=r.Z.normalize(e._zoomWorldPosition,G),Me=r.Z.dot(Ie,Re);if(Me>0&&Me<1){var ke=Z.Z.acosClamped(Me),Fe=r.Z.cross(Ie,Re,q),Le=Math.abs(ke)>Z.Z.toRadians(20)?.75*C.positionCartographic.height:C.positionCartographic.height-_,Ne=_/Le;C.rotate(Fe,ke*Ne)}}else D=!0}}e._rotatingZoom=!D}if(!P&&D||y){var Ae,Oe=x.Z.wgs84ToWindowCoordinates(v,e._zoomWorldPosition,V);Ae=b!==E.Z.COLUMBUS_VIEW&&o.Z.equals(t,e._zoomMouseStart)&&(0,m.Z)(Oe)?C.getPickRay(Oe,O):C.getPickRay(t,O);var Ue=Ae.direction;b!==E.Z.COLUMBUS_VIEW&&b!==E.Z.SCENE2D||r.Z.fromElements(Ue.y,Ue.z,Ue.x,Ue),C.move(Ue,_),e._zoomingOnVector=!0}else C.zoomIn(_);e._cameraUnderground||C.setView(se)}else C.zoomIn(_)}}var ue=new b.Z,le=new b.Z,ce=new r.Z;function de(e,t,i){var o=e._scene,n=o.camera,a=n.getPickRay(i.startPosition,ue).origin,s=n.getPickRay(i.endPosition,le).origin;a=r.Z.fromElements(a.y,a.z,a.x,a),s=r.Z.fromElements(s.y,s.z,s.x,s);var m=r.Z.subtract(a,s,ce),u=r.Z.magnitude(m);u>0&&(r.Z.normalize(m,m),n.move(m,u))}function he(e,t,i){(0,m.Z)(i.distance)&&(i=i.distance);var o=e._scene,r=o.camera;me(e,t,i,e._zoomFactor,r.getMagnitude())}var pe=new o.Z,Ze=new o.Z;function fe(e,t,i){if((0,m.Z)(i.angleAndHeight))_e(e,t,i.angleAndHeight);else{var r=e._scene,n=r.camera,a=r.canvas,s=a.clientWidth,u=a.clientHeight,l=pe;l.x=2/s*i.startPosition.x-1,l.y=2/u*(u-i.startPosition.y)-1,l=o.Z.normalize(l,l);var c=Ze;c.x=2/s*i.endPosition.x-1,c.y=2/u*(u-i.endPosition.y)-1,c=o.Z.normalize(c,c);var d=Z.Z.acosClamped(l.x);l.y<0&&(d=Z.Z.TWO_PI-d);var h=Z.Z.acosClamped(c.x);c.y<0&&(h=Z.Z.TWO_PI-h);var p=h-d;n.twistRight(p)}}function _e(e,t,i){var o=e._rotateFactor*e._rotateRateRangeAdjustment;o>e._maximumRotateRate&&(o=e._maximumRotateRate),o<e._minimumRotateRate&&(o=e._minimumRotateRate);var r=e._scene,n=r.camera,a=r.canvas,s=(i.endPosition.x-i.startPosition.x)/a.clientWidth;s=Math.min(s,e.maximumMovementRatio);var m=o*s*Math.PI*4;n.twistRight(m)}function ge(e){var t=e._scene.mapMode2D===T.Z.ROTATE;_.Z.equals(_.Z.IDENTITY,e._scene.camera.transform)?(A(e,e.enableTranslate,e.translateEventTypes,de,e.inertiaTranslate,"_lastInertiaTranslateMovement"),A(e,e.enableZoom,e.zoomEventTypes,he,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&A(e,e.enableRotate,e.tiltEventTypes,fe,e.inertiaSpin,"_lastInertiaTiltMovement")):(A(e,e.enableZoom,e.zoomEventTypes,he,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&A(e,e.enableRotate,e.translateEventTypes,fe,e.inertiaSpin,"_lastInertiaSpinMovement"))}var ve=new b.Z,Ce=new r.Z,be=new r.Z;function we(e,t,i){var o=e._scene,n=e._globe,a=o.camera;if((0,m.Z)(n)){var s,u=!e._cameraUnderground;o.pickPositionSupported&&(s=o.pickPositionWorldCoordinates(t,Ce));var l=a.getPickRay(t,ve),c=n.pickWorldCoordinates(l,o,u,be),d=(0,m.Z)(s)?r.Z.distance(s,a.positionWC):Number.POSITIVE_INFINITY,h=(0,m.Z)(c)?r.Z.distance(c,a.positionWC):Number.POSITIVE_INFINITY;return d<h?r.Z.clone(s,i):r.Z.clone(c,i)}}var Se=new a.Z;function Pe(e){var t=e._ellipsoid,i=e._scene,o=i.camera,r=i.mode,n=0;if(r===E.Z.SCENE3D){var a=t.cartesianToCartographic(o.position,Se);(0,m.Z)(a)&&(n=a.height)}else n=o.position.z;var u=(0,s.Z)(e._scene.globeHeight,0),l=Math.abs(u-n);return l}var ye=new r.Z;function Te(e,t){var i=t.origin,o=t.direction,n=Pe(e),a=r.Z.normalize(i,ye),s=Math.abs(r.Z.dot(a,o));return s=2*Math.max(s,.5),n*s}function Ee(e,t,i,o){var n=r.Z.distance(t.origin,i),a=Pe(e),s=Z.Z.clamp(5*a,e._minimumUndergroundPickDistance,e._maximumUndergroundPickDistance);return n>s&&(n=Math.min(n,a/5),n=Math.max(n,100)),b.Z.getPoint(t,n,o)}function xe(e,t,i,o){var n;return(0,m.Z)(i)?(n=r.Z.distance(t.origin,i),n>e._maximumUndergroundPickDistance&&(n=Pe(e))):n=Pe(e),b.Z.getPoint(t,n,o)}var De=new o.Z;function Re(e,t){var i=t.endPosition,r=o.Z.subtract(t.endPosition,t.startPosition,De),n=e._strafeEndMousePosition;o.Z.add(n,r,n),t.endPosition=n,pt(e,t,e._strafeStartPosition),t.endPosition=i}var Ie=new b.Z,Me=new b.Z,ke=new r.Z,Fe=new r.Z,Le=new r.Z,Ne=new r.Z,Ae=new v.Z(r.Z.UNIT_X,0),Oe=new o.Z,Ue=new o.Z;function Ve(e,t,i){if(r.Z.equals(t,e._translateMousePosition)||(e._looking=!1),r.Z.equals(t,e._strafeMousePosition)||(e._strafing=!1),e._looking)ii(e,t,i);else if(e._strafing)Re(e,i);else{var n,a=e._scene,s=a.camera,u=e._cameraUnderground,l=o.Z.clone(i.startPosition,Oe),c=o.Z.clone(i.endPosition,Ue),d=s.getPickRay(l,Ie),p=r.Z.clone(r.Z.ZERO,Ne),f=r.Z.UNIT_X;if(s.position.z<e._minimumPickingTerrainHeight&&(n=we(e,l,ke),(0,m.Z)(n)&&(p.x=n.x)),u||p.x>s.position.z&&(0,m.Z)(n)){var _=n;return u&&(_=xe(e,d,n,ke)),o.Z.clone(t,e._strafeMousePosition),o.Z.clone(t,e._strafeEndMousePosition),r.Z.clone(_,e._strafeStartPosition),e._strafing=!0,void pt(e,i,e._strafeStartPosition)}var g=v.Z.fromPointNormal(p,f,Ae);d=s.getPickRay(l,Ie);var C=h.Z.rayPlane(d,g,ke),b=s.getPickRay(c,Me),w=h.Z.rayPlane(b,g,Fe);if(!(0,m.Z)(C)||!(0,m.Z)(w))return e._looking=!0,ii(e,t,i),void o.Z.clone(t,e._translateMousePosition);var S=r.Z.subtract(C,w,Le),P=S.x;S.x=S.y,S.y=S.z,S.z=P;var y=r.Z.magnitude(S);y>Z.Z.EPSILON6&&(r.Z.normalize(S,S),s.move(S,y))}}var We=new o.Z,Be=new b.Z,ze=new r.Z,He=new r.Z,Ge=new _.Z,qe=new _.Z,je=new r.Z,Ye=new v.Z(r.Z.UNIT_X,0),Qe=new r.Z,Xe=new a.Z,Ke=new _.Z,Je=new C.Z,$e=new f.Z,et=new r.Z;function tt(e,t,i){if((0,m.Z)(i.angleAndHeight)&&(i=i.angleAndHeight),o.Z.equals(t,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking)ii(e,t,i);else{var r=e._scene,n=r.camera;e._tiltCVOffMap||!e.onMap()||Math.abs(n.position.z)>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,it(e,t,i)):ot(e,t,i)}}function it(e,t,i){var n=e._scene,a=n.camera,s=n.canvas,u=We;u.x=s.clientWidth/2,u.y=s.clientHeight/2;var l,d=a.getPickRay(u,Be),h=r.Z.UNIT_X,p=d.origin,f=d.direction,g=r.Z.dot(h,f);if(Math.abs(g)>Z.Z.EPSILON6&&(l=-r.Z.dot(h,p)/g),!(0,m.Z)(l)||l<=0)return e._looking=!0,ii(e,t,i),void o.Z.clone(t,e._tiltCenterMousePosition);var v=r.Z.multiplyByScalar(f,l,ze);r.Z.add(p,v,v);var C=n.mapProjection,b=C.ellipsoid;r.Z.fromElements(v.y,v.z,v.x,v);var w=C.unproject(v,Xe);b.cartographicToCartesian(w,v);var P=S.Z.eastNorthUpToFixedFrame(v,b,Ge),y=e._globe,T=e._ellipsoid;e._globe=void 0,e._ellipsoid=c.Z.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var E=_.Z.clone(a.transform,Ke);a._setTransform(P),wt(e,t,i,r.Z.UNIT_Z),a._setTransform(E),e._globe=y,e._ellipsoid=T;var x=T.maximumRadius;e._rotateFactor=1/x,e._rotateRateRangeAdjustment=x}function ot(e,t,i){var n,a,s=e._scene,u=s.camera,l=e._cameraUnderground,d=r.Z.UNIT_X;if(o.Z.equals(t,e._tiltCenterMousePosition))n=r.Z.clone(e._tiltCenter,ze);else{if(u.position.z<e._minimumPickingTerrainHeight&&(n=we(e,t,ze)),!(0,m.Z)(n)){a=u.getPickRay(t,Be);var p,g=a.origin,b=a.direction,w=r.Z.dot(d,b);if(Math.abs(w)>Z.Z.EPSILON6&&(p=-r.Z.dot(d,g)/w),!(0,m.Z)(p)||p<=0)return e._looking=!0,ii(e,t,i),void o.Z.clone(t,e._tiltCenterMousePosition);n=r.Z.multiplyByScalar(b,p,ze),r.Z.add(g,n,n)}l&&((0,m.Z)(a)||(a=u.getPickRay(t,Be)),Ee(e,a,n,n)),o.Z.clone(t,e._tiltCenterMousePosition),r.Z.clone(n,e._tiltCenter)}var P=s.canvas,y=We;y.x=P.clientWidth/2,y.y=e._tiltCenterMousePosition.y,a=u.getPickRay(y,Be);var T=r.Z.clone(r.Z.ZERO,je);T.x=n.x;var E=v.Z.fromPointNormal(T,d,Ye),x=h.Z.rayPlane(a,E,He),D=u._projection,R=D.ellipsoid;r.Z.fromElements(n.y,n.z,n.x,n);var I=D.unproject(n,Xe);R.cartographicToCartesian(I,n);var M,k=S.Z.eastNorthUpToFixedFrame(n,R,Ge);(0,m.Z)(x)?(r.Z.fromElements(x.y,x.z,x.x,x),I=D.unproject(x,Xe),R.cartographicToCartesian(I,x),M=S.Z.eastNorthUpToFixedFrame(x,R,qe)):M=k;var F=e._globe,L=e._ellipsoid;e._globe=void 0,e._ellipsoid=c.Z.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var N=r.Z.UNIT_Z,A=_.Z.clone(u.transform,Ke);u._setTransform(k);var O=r.Z.cross(r.Z.UNIT_Z,r.Z.normalize(u.position,Qe),Qe),U=r.Z.dot(u.right,O);if(wt(e,t,i,N,!1,!0),u._setTransform(M),U<0){var V=i.startPosition.y-i.endPosition.y;(l&&V<0||!l&&V>0)&&(N=void 0);var W=u.constrainedAxis;u.constrainedAxis=void 0,wt(e,t,i,N,!0,!1),u.constrainedAxis=W}else wt(e,t,i,N,!0,!1);if((0,m.Z)(u.constrainedAxis)){var B=r.Z.cross(u.direction,u.constrainedAxis,et);r.Z.equalsEpsilon(B,r.Z.ZERO,Z.Z.EPSILON6)||(r.Z.dot(B,u.right)<0&&r.Z.negate(B,B),r.Z.cross(B,u.direction,u.up),r.Z.cross(u.direction,u.up,u.right),r.Z.normalize(u.up,u.up),r.Z.normalize(u.right,u.right))}u._setTransform(A),e._globe=F,e._ellipsoid=L;var z=L.maximumRadius;e._rotateFactor=1/z,e._rotateRateRangeAdjustment=z;var H=r.Z.clone(u.positionWC,Qe);if(e.enableCollisionDetection&&ai(e),!r.Z.equals(u.positionWC,H)){u._setTransform(M),u.worldToCameraCoordinatesPoint(H,H);var G=r.Z.magnitudeSquared(H);r.Z.magnitudeSquared(u.position)>G&&(r.Z.normalize(u.position,u.position),r.Z.multiplyByScalar(u.position,Math.sqrt(G),u.position));var q=r.Z.angleBetween(H,u.position),j=r.Z.cross(H,u.position,H);r.Z.normalize(j,j);var Y=C.Z.fromAxisAngle(j,q,Je),Q=f.Z.fromQuaternion(Y,$e);f.Z.multiplyByVector(Q,u.direction,u.direction),f.Z.multiplyByVector(Q,u.up,u.up),r.Z.cross(u.direction,u.up,u.right),r.Z.cross(u.right,u.direction,u.up),u._setTransform(A)}}var rt=new o.Z,nt=new b.Z,at=new r.Z;function st(e,t,i){(0,m.Z)(i.distance)&&(i=i.distance);var o,n=e._scene,a=n.camera,s=n.canvas,u=e._cameraUnderground;u?o=t:(o=rt,o.x=s.clientWidth/2,o.y=s.clientHeight/2);var l,c,d=a.getPickRay(o,nt),h=d.origin,p=d.direction,Z=a.position.z;if(Z<e._minimumPickingTerrainHeight&&(l=we(e,o,at)),(0,m.Z)(l)&&(c=r.Z.distance(h,l)),u){var f=Te(e,d,Z);c=(0,m.Z)(c)?Math.min(c,f):f}if(!(0,m.Z)(c)){var _=r.Z.UNIT_X;c=-r.Z.dot(_,h)/r.Z.dot(_,p)}me(e,t,i,e._zoomFactor,c)}function mt(e){var t=e._scene,i=t.camera;if(_.Z.equals(_.Z.IDENTITY,i.transform)){var o=e._tweens;if(e._aggregator.anyButtonDown&&o.removeAll(),A(e,e.enableTilt,e.tiltEventTypes,tt,e.inertiaSpin,"_lastInertiaTiltMovement"),A(e,e.enableTranslate,e.translateEventTypes,Ve,e.inertiaTranslate,"_lastInertiaTranslateMovement"),A(e,e.enableZoom,e.zoomEventTypes,st,e.inertiaZoom,"_lastInertiaZoomMovement"),A(e,e.enableLook,e.lookEventTypes,ii),!e._aggregator.anyButtonDown&&!o.contains(e._tween)){var r=i.createCorrectPositionTween(e.bounceAnimationTime);(0,m.Z)(r)&&(e._tween=o.add(r))}o.update()}else A(e,e.enableRotate,e.rotateEventTypes,wt,e.inertiaSpin,"_lastInertiaSpinMovement"),A(e,e.enableZoom,e.zoomEventTypes,Ft,e.inertiaZoom,"_lastInertiaZoomMovement")}var ut=new b.Z,lt=new v.Z(r.Z.UNIT_X,0),ct=new r.Z,dt=new r.Z,ht=new r.Z;function pt(e,t,i){var o=e._scene,n=o.camera,a=n.getPickRay(t.endPosition,ut),s=r.Z.clone(n.direction,dt);o.mode===E.Z.COLUMBUS_VIEW&&r.Z.fromElements(s.z,s.x,s.y,s);var u=v.Z.fromPointNormal(i,s,lt),l=h.Z.rayPlane(a,u,ct);(0,m.Z)(l)&&(s=r.Z.subtract(i,l,s),o.mode===E.Z.COLUMBUS_VIEW&&r.Z.fromElements(s.y,s.z,s.x,s),r.Z.add(n.position,s,n.position))}var Zt=new r.Z,ft=new a.Z,_t=new r.Z,gt=new c.Z,vt=new r.Z,Ct=new r.Z;function bt(e,t,i){var n=e._scene,a=n.camera,s=e._cameraUnderground,u=e._ellipsoid;if(_.Z.equals(a.transform,_.Z.IDENTITY)){var l,d,h=u.geodeticSurfaceNormal(a.position,vt);if(o.Z.equals(t,e._rotateMousePosition))if(e._looking)ii(e,t,i,h);else if(e._rotating)wt(e,t,i);else if(e._strafing)Re(e,i);else{if(r.Z.magnitude(a.position)<r.Z.magnitude(e._rotateStartPosition))return;l=r.Z.magnitude(e._rotateStartPosition),d=_t,d.x=d.y=d.z=l,u=c.Z.fromCartesian3(d,gt),It(e,t,i,u)}else{e._looking=!1,e._rotating=!1,e._strafing=!1;var p=u.cartesianToCartographic(a.positionWC,ft).height,Z=e._globe;if((0,m.Z)(Z)&&p<e._minimumPickingTerrainHeight){var f=we(e,i.startPosition,ht);if((0,m.Z)(f)){var g=!1,v=a.getPickRay(i.startPosition,ve);if(s)g=!0,xe(e,v,f,f);else{var C=u.geodeticSurfaceNormal(f,Ct),b=Math.abs(r.Z.dot(v.direction,C))<.05;g=!!b||r.Z.magnitude(a.position)<r.Z.magnitude(f)}g?(o.Z.clone(t,e._strafeEndMousePosition),r.Z.clone(f,e._strafeStartPosition),e._strafing=!0,pt(e,i,e._strafeStartPosition)):(l=r.Z.magnitude(f),d=_t,d.x=d.y=d.z=l,u=c.Z.fromCartesian3(d,gt),It(e,t,i,u),r.Z.clone(f,e._rotateStartPosition))}else e._looking=!0,ii(e,t,i,h)}else(0,m.Z)(a.pickEllipsoid(i.startPosition,e._ellipsoid,Zt))?(It(e,t,i,e._ellipsoid),r.Z.clone(Zt,e._rotateStartPosition)):p>e._minimumTrackBallHeight?(e._rotating=!0,wt(e,t,i)):(e._looking=!0,ii(e,t,i,h));o.Z.clone(t,e._rotateMousePosition)}}else wt(e,t,i)}function wt(e,t,i,o,n,a){n=(0,s.Z)(n,!1),a=(0,s.Z)(a,!1);var u=e._scene,l=u.camera,c=u.canvas,d=l.constrainedAxis;(0,m.Z)(o)&&(l.constrainedAxis=o);var h=r.Z.magnitude(l.position),p=e._rotateFactor*(h-e._rotateRateRangeAdjustment);p>e._maximumRotateRate&&(p=e._maximumRotateRate),p<e._minimumRotateRate&&(p=e._minimumRotateRate);var Z=(i.startPosition.x-i.endPosition.x)/c.clientWidth,f=(i.startPosition.y-i.endPosition.y)/c.clientHeight;Z=Math.min(Z,e.maximumMovementRatio),f=Math.min(f,e.maximumMovementRatio);var _=p*Z*Math.PI*2,g=p*f*Math.PI;n||l.rotateRight(_),a||l.rotateUp(g),l.constrainedAxis=d}var St=n.Z.clone(n.Z.UNIT_W),Pt=n.Z.clone(n.Z.UNIT_W),yt=new r.Z,Tt=new r.Z,Et=new r.Z,xt=new r.Z,Dt=new o.Z,Rt=new o.Z;function It(e,t,i,n){var a=e._scene,s=a.camera,u=o.Z.clone(i.startPosition,Dt),l=o.Z.clone(i.endPosition,Rt),c=s.pickEllipsoid(u,n,St),d=s.pickEllipsoid(l,n,Pt);if(!(0,m.Z)(c)||!(0,m.Z)(d))return e._rotating=!0,void wt(e,t,i);if(c=s.worldToCameraCoordinates(c,c),d=s.worldToCameraCoordinates(d,d),(0,m.Z)(s.constrainedAxis)){var h=s.constrainedAxis,p=r.Z.mostOrthogonalAxis(h,yt);r.Z.cross(p,h,p),r.Z.normalize(p,p);var f=r.Z.cross(h,p,Tt),_=r.Z.magnitude(c),g=r.Z.dot(h,c),v=Math.acos(g/_),C=r.Z.multiplyByScalar(h,g,Et);r.Z.subtract(c,C,C),r.Z.normalize(C,C);var b=r.Z.magnitude(d),w=r.Z.dot(h,d),S=Math.acos(w/b),P=r.Z.multiplyByScalar(h,w,xt);r.Z.subtract(d,P,P),r.Z.normalize(P,P);var y=Math.acos(r.Z.dot(C,p));r.Z.dot(C,f)<0&&(y=Z.Z.TWO_PI-y);var T=Math.acos(r.Z.dot(P,p));r.Z.dot(P,f)<0&&(T=Z.Z.TWO_PI-T);var E,x=y-T;E=r.Z.equalsEpsilon(h,s.position,Z.Z.EPSILON2)?s.right:r.Z.cross(h,s.position,yt);var D,R=r.Z.cross(h,E,yt),I=r.Z.dot(R,r.Z.subtract(c,h,Tt)),M=r.Z.dot(R,r.Z.subtract(d,h,Tt));D=I>0&&M>0?S-v:I>0&&M<=0?r.Z.dot(s.position,h)>0?-v-S:v+S:v-S,s.rotateRight(x),s.rotateUp(D)}else{r.Z.normalize(c,c),r.Z.normalize(d,d);var k=r.Z.dot(c,d),F=r.Z.cross(c,d,yt);if(k<1&&!r.Z.equalsEpsilon(F,r.Z.ZERO,Z.Z.EPSILON14)){var L=Math.acos(k);s.rotate(F,L)}}}var Mt=new r.Z,kt=new a.Z;function Ft(e,t,i){(0,m.Z)(i.distance)&&(i=i.distance);var o,n=e._ellipsoid,a=e._scene,s=a.camera,u=a.canvas,l=e._cameraUnderground;l?o=t:(o=rt,o.x=u.clientWidth/2,o.y=u.clientHeight/2);var c,d,h=s.getPickRay(o,nt),p=n.cartesianToCartographic(s.position,kt).height;if(p<e._minimumPickingTerrainHeight&&(c=we(e,o,at)),(0,m.Z)(c)&&(d=r.Z.distance(h.origin,c)),l){var Z=Te(e,h,p);d=(0,m.Z)(d)?Math.min(d,Z):Z}(0,m.Z)(d)||(d=p);var f=r.Z.normalize(s.position,Mt);me(e,t,i,e._zoomFactor,d,r.Z.dot(f,s.direction))}var Lt=new o.Z,Nt=new b.Z,At=new r.Z,Ot=new r.Z,Ut=new _.Z,Vt=new _.Z,Wt=new _.Z,Bt=new C.Z,zt=new f.Z,Ht=new a.Z,Gt=new r.Z;function qt(e,t,i){var r=e._scene,n=r.camera;if(_.Z.equals(n.transform,_.Z.IDENTITY))if((0,m.Z)(i.angleAndHeight)&&(i=i.angleAndHeight),o.Z.equals(t,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){var a=e._ellipsoid.geodeticSurfaceNormal(n.position,Gt);ii(e,t,i,a)}else{var s=e._ellipsoid,u=s.cartesianToCartographic(n.position,Ht);e._tiltOnEllipsoid||u.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,Yt(e,t,i)):Qt(e,t,i)}}var jt=new a.Z;function Yt(e,t,i){var n=e._ellipsoid,a=e._scene,s=a.camera,u=.25*e.minimumZoomDistance,l=n.cartesianToCartographic(s.positionWC,jt).height;if(!(l-u-1<Z.Z.EPSILON3&&i.endPosition.y-i.startPosition.y<0)){var d=a.canvas,p=Lt;p.x=d.clientWidth/2,p.y=d.clientHeight/2;var f,g=s.getPickRay(p,Nt),v=h.Z.rayEllipsoid(g,n);if((0,m.Z)(v))f=b.Z.getPoint(g,v.start,At);else{if(!(l>e._minimumTrackBallHeight)){e._looking=!0;var C=e._ellipsoid.geodeticSurfaceNormal(s.position,Gt);return ii(e,t,i,C),void o.Z.clone(t,e._tiltCenterMousePosition)}var w=h.Z.grazingAltitudeLocation(g,n);if(!(0,m.Z)(w))return;var P=n.cartesianToCartographic(w,Ht);P.height=0,f=n.cartographicToCartesian(P,At)}var y=S.Z.eastNorthUpToFixedFrame(f,n,Ut),T=e._globe,E=e._ellipsoid;e._globe=void 0,e._ellipsoid=c.Z.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var x=_.Z.clone(s.transform,Wt);s._setTransform(y),wt(e,t,i,r.Z.UNIT_Z),s._setTransform(x),e._globe=T,e._ellipsoid=E;var D=E.maximumRadius;e._rotateFactor=1/D,e._rotateRateRangeAdjustment=D}}function Qt(e,t,i){var n,a,s,u=e._ellipsoid,l=e._scene,d=l.camera,p=e._cameraUnderground;if(o.Z.equals(t,e._tiltCenterMousePosition))n=r.Z.clone(e._tiltCenter,At);else{if(n=we(e,t,At),!(0,m.Z)(n)){if(a=d.getPickRay(t,Nt),s=h.Z.rayEllipsoid(a,u),!(0,m.Z)(s)){var g=u.cartesianToCartographic(d.position,Ht);if(g.height<=e._minimumTrackBallHeight){e._looking=!0;var v=e._ellipsoid.geodeticSurfaceNormal(d.position,Gt);ii(e,t,i,v),o.Z.clone(t,e._tiltCenterMousePosition)}return}n=b.Z.getPoint(a,s.start,At)}p&&((0,m.Z)(a)||(a=d.getPickRay(t,Nt)),Ee(e,a,n,n)),o.Z.clone(t,e._tiltCenterMousePosition),r.Z.clone(n,e._tiltCenter)}var w=l.canvas,P=Lt;P.x=w.clientWidth/2,P.y=e._tiltCenterMousePosition.y,a=d.getPickRay(P,Nt);var y=r.Z.magnitude(n),T=r.Z.fromElements(y,y,y,_t),E=c.Z.fromCartesian3(T,gt);if(s=h.Z.rayEllipsoid(a,E),(0,m.Z)(s)){var x=r.Z.magnitude(a.origin)>y?s.start:s.stop,D=b.Z.getPoint(a,x,Ot),R=S.Z.eastNorthUpToFixedFrame(n,u,Ut),I=S.Z.eastNorthUpToFixedFrame(D,E,Vt),M=e._globe,k=e._ellipsoid;e._globe=void 0,e._ellipsoid=c.Z.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var F=r.Z.UNIT_Z,L=_.Z.clone(d.transform,Wt);d._setTransform(I);var N=r.Z.cross(D,d.positionWC,et),A=r.Z.dot(d.rightWC,N);if(A<0){var O=i.startPosition.y-i.endPosition.y;(p&&O<0||!p&&O>0)&&(F=void 0);var U=d.constrainedAxis;d.constrainedAxis=void 0,wt(e,t,i,F,!0,!1),d.constrainedAxis=U}else wt(e,t,i,F,!0,!1);if(d._setTransform(R),wt(e,t,i,F,!1,!0),(0,m.Z)(d.constrainedAxis)){var V=r.Z.cross(d.direction,d.constrainedAxis,et);r.Z.equalsEpsilon(V,r.Z.ZERO,Z.Z.EPSILON6)||(r.Z.dot(V,d.right)<0&&r.Z.negate(V,V),r.Z.cross(V,d.direction,d.up),r.Z.cross(d.direction,d.up,d.right),r.Z.normalize(d.up,d.up),r.Z.normalize(d.right,d.right))}d._setTransform(L),e._globe=M,e._ellipsoid=k;var W=k.maximumRadius;e._rotateFactor=1/W,e._rotateRateRangeAdjustment=W;var B=r.Z.clone(d.positionWC,et);if(e.enableCollisionDetection&&ai(e),!r.Z.equals(d.positionWC,B)){d._setTransform(I),d.worldToCameraCoordinatesPoint(B,B);var z=r.Z.magnitudeSquared(B);r.Z.magnitudeSquared(d.position)>z&&(r.Z.normalize(d.position,d.position),r.Z.multiplyByScalar(d.position,Math.sqrt(z),d.position));var H=r.Z.angleBetween(B,d.position),G=r.Z.cross(B,d.position,B);r.Z.normalize(G,G);var q=C.Z.fromAxisAngle(G,H,Bt),j=f.Z.fromQuaternion(q,zt);f.Z.multiplyByVector(j,d.direction,d.direction),f.Z.multiplyByVector(j,d.up,d.up),r.Z.cross(d.direction,d.up,d.right),r.Z.cross(d.right,d.direction,d.up),d._setTransform(L)}}}var Xt=new o.Z,Kt=new o.Z,Jt=new b.Z,$t=new b.Z,ei=new r.Z,ti=new r.Z;function ii(e,t,i,o){var n=e._scene,a=n.camera,u=Xt;u.x=i.startPosition.x,u.y=0;var l=Kt;l.x=i.endPosition.x,l.y=0;var c,d,h=a.getPickRay(u,Jt),p=a.getPickRay(l,$t),f=0;a.frustum instanceof g.Z?(c=h.origin,d=p.origin,r.Z.add(a.direction,c,c),r.Z.add(a.direction,d,d),r.Z.subtract(c,a.position,c),r.Z.subtract(d,a.position,d),r.Z.normalize(c,c),r.Z.normalize(d,d)):(c=h.direction,d=p.direction);var _=r.Z.dot(c,d);_<1&&(f=Math.acos(_)),f=i.startPosition.x>i.endPosition.x?-f:f;var v=e._horizontalRotationAxis;if((0,m.Z)(o)?a.look(o,-f):(0,m.Z)(v)?a.look(v,-f):a.lookLeft(f),u.x=0,u.y=i.startPosition.y,l.x=0,l.y=i.endPosition.y,h=a.getPickRay(u,Jt),p=a.getPickRay(l,$t),f=0,a.frustum instanceof g.Z?(c=h.origin,d=p.origin,r.Z.add(a.direction,c,c),r.Z.add(a.direction,d,d),r.Z.subtract(c,a.position,c),r.Z.subtract(d,a.position,d),r.Z.normalize(c,c),r.Z.normalize(d,d)):(c=h.direction,d=p.direction),_=r.Z.dot(c,d),_<1&&(f=Math.acos(_)),f=i.startPosition.y>i.endPosition.y?-f:f,o=(0,s.Z)(o,v),(0,m.Z)(o)){var C=a.direction,b=r.Z.negate(o,ei),w=r.Z.equalsEpsilon(C,o,Z.Z.EPSILON2),S=r.Z.equalsEpsilon(C,b,Z.Z.EPSILON2);if(w||S)(w&&f<0||S&&f>0)&&a.look(a.right,-f);else{_=r.Z.dot(C,o);var P=Z.Z.acosClamped(_);f>0&&f>P&&(f=P-Z.Z.EPSILON4),_=r.Z.dot(C,b),P=Z.Z.acosClamped(_),f<0&&-f>P&&(f=-P+Z.Z.EPSILON4);var y=r.Z.cross(o,C,ti);a.look(y,f)}}else a.lookUp(f)}function oi(e){A(e,e.enableRotate,e.rotateEventTypes,bt,e.inertiaSpin,"_lastInertiaSpinMovement"),A(e,e.enableZoom,e.zoomEventTypes,Ft,e.inertiaZoom,"_lastInertiaZoomMovement"),A(e,e.enableTilt,e.tiltEventTypes,qt,e.inertiaSpin,"_lastInertiaTiltMovement"),A(e,e.enableLook,e.lookEventTypes,ii)}var ri=new _.Z,ni=new a.Z;function ai(e){e._adjustedHeightForTerrain=!0;var t=e._scene,i=t.mode,o=t.globe;if((0,m.Z)(o)&&i!==E.Z.SCENE2D&&i!==E.Z.MORPHING){var n,a,s=t.camera,u=o.ellipsoid,l=t.mapProjection;_.Z.equals(s.transform,_.Z.IDENTITY)||(n=_.Z.clone(s.transform,ri),a=r.Z.magnitude(s.position),s._setTransform(_.Z.IDENTITY));var c=ni;i===E.Z.SCENE3D?u.cartesianToCartographic(s.position,c):l.unproject(s.position,c);var d=!1;if(c.height<e._minimumCollisionTerrainHeight){var h=e._scene.globeHeight;if((0,m.Z)(h)){var p=h+e.minimumZoomDistance;c.height<p&&(c.height=p,i===E.Z.SCENE3D?u.cartographicToCartesian(c,s.position):l.project(c,s.position),d=!0)}}(0,m.Z)(n)&&(s._setTransform(n),d&&(r.Z.normalize(s.position,s.position),r.Z.negate(s.position,s.direction),r.Z.multiplyByScalar(s.position,Math.max(a,e.minimumZoomDistance),s.position),r.Z.normalize(s.direction,s.direction),r.Z.cross(s.direction,s.up,s.right),r.Z.cross(s.right,s.direction,s.up)))}}R.prototype.onMap=function(){var e=this._scene,t=e.mode,i=e.camera;return t!==E.Z.COLUMBUS_VIEW||Math.abs(i.position.x)-this._maxCoord.x<0&&Math.abs(i.position.y)-this._maxCoord.y<0};var si=new r.Z,mi=new r.Z;R.prototype.update=function(){var e=this._scene,t=e.camera,i=e.globe,o=e.mode;_.Z.equals(t.transform,_.Z.IDENTITY)?(this._globe=i,this._ellipsoid=(0,m.Z)(this._globe)?this._globe.ellipsoid:e.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=c.Z.UNIT_SPHERE);var n=(0,m.Z)(this._globe)?this._globe.terrainExaggeration:1,a=(0,m.Z)(this._globe)?this._globe.terrainExaggerationRelativeHeight:0;this._minimumCollisionTerrainHeight=w.Z.getHeight(this.minimumCollisionTerrainHeight,n,a),this._minimumPickingTerrainHeight=w.Z.getHeight(this.minimumPickingTerrainHeight,n,a),this._minimumTrackBallHeight=w.Z.getHeight(this.minimumTrackBallHeight,n,a),this._cameraUnderground=e.cameraUnderground&&(0,m.Z)(this._globe);var s=this._ellipsoid.maximumRadius;this._rotateFactor=1/s,this._rotateRateRangeAdjustment=s,this._adjustedHeightForTerrain=!1;var u=r.Z.clone(t.positionWC,si),l=r.Z.clone(t.directionWC,mi);if(o===E.Z.SCENE2D?ge(this):o===E.Z.COLUMBUS_VIEW?(this._horizontalRotationAxis=r.Z.UNIT_Z,mt(this)):o===E.Z.SCENE3D&&(this._horizontalRotationAxis=void 0,oi(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain){var d=!r.Z.equals(u,t.positionWC)||!r.Z.equals(l,t.directionWC);d&&ai(this)}this._aggregator.reset()},R.prototype.isDestroyed=function(){return!1},R.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),(0,u.Z)(this)},t["Z"]=R}}]);
//# sourceMappingURL=chunk-vendors-32eb84c3-legacy.22153b89.js.map